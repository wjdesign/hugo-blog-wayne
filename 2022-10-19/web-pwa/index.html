<!doctype html><html lang=zh-tw dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="漸進式網路應用程式（英語：Progressive Web Apps，簡稱：PWA）是一種普通網頁或網站架構起來的網路應用程式，但它可以以傳統應用程式或原生行動應用程式形式展示給使用者。這種應用程式形態視圖將目前最為現代化的瀏覽器提供的功能與行動裝置的體驗優勢相結合。"><meta name=keywords content="progressive web application,pwa,web app,manifest,manifest.json,service-worker,service-worker.js,web push,firebase,sw"><title>將網頁變成Progressive Web Application(PWA)，漸進式的網頁應用程式</title>
<link rel=canonical href=https://wayne-blog.com/2022-10-19/web-pwa/><link rel=stylesheet href=https://wayne-blog.com/scss/style.min.e3f888c5dd2d8234c7284a9b45d1b5916903fb544644cac31c873b6488e8d7a0.css><script>!function(e,t,n,s,o,i,a){if(e.fbq)return;o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],i=t.createElement(n),i.async=!0,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","843131703668116"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=843131703668116&ev=PageView&noscript=1"></noscript><meta property="og:title" content="將網頁變成Progressive Web Application(PWA)，漸進式的網頁應用程式"><meta property="og:description" content="漸進式網路應用程式（英語：Progressive Web Apps，簡稱：PWA）是一種普通網頁或網站架構起來的網路應用程式，但它可以以傳統應用程式或原生行動應用程式形式展示給使用者。這種應用程式形態視圖將目前最為現代化的瀏覽器提供的功能與行動裝置的體驗優勢相結合。"><meta property="og:url" content="https://wayne-blog.com/2022-10-19/web-pwa/"><meta property="og:site_name" content="Wayne's blog | 偉恩的部落格 | 技術博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="pwa"><meta property="article:tag" content="seo"><meta property="article:tag" content="firebase"><meta property="article:published_time" content="2022-10-19T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-19T00:00:00+00:00"><meta property="og:image" content="https://live.staticflickr.com/65535/52438994804_33f71b7e35_o.jpg"><meta name=twitter:site content="@4006wayne"><meta name=twitter:creator content="@4006wayne"><meta name=twitter:title content="將網頁變成Progressive Web Application(PWA)，漸進式的網頁應用程式"><meta name=twitter:description content="漸進式網路應用程式（英語：Progressive Web Apps，簡稱：PWA）是一種普通網頁或網站架構起來的網路應用程式，但它可以以傳統應用程式或原生行動應用程式形式展示給使用者。這種應用程式形態視圖將目前最為現代化的瀏覽器提供的功能與行動裝置的體驗優勢相結合。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://live.staticflickr.com/65535/52438994804_33f71b7e35_o.jpg"><link rel="shortcut icon" href=https://live.staticflickr.com/65535/52275825736_808b1fd4a8_o.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-FG6KQD7H6C"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FG6KQD7H6C",{anonymize_ip:!1})}</script><link rel=stylesheet type=text/css href=./toastify/style.min.css><script type=text/javascript src=./toastify/index.js></script><script>const hackKey="hack",author="Wayne (偉恩)",link="https://wayne-blog.com/",source="Wayne's blog | 偉恩的部落格 | 技術博客",warningText="請重視著作權，商業轉載請聯繫作者獲得授權，非商業轉載請註明出處。",warningBackgroundColor="linear-gradient(to right, rgb(108 47 87), rgb(191 86 86))",successBackgroundColor="linear-gradient(to right, rgb(47 151 127), rgb(69 195 137))",ignoreTagNames=["INPUT"];window.addEventListener("keyup",function(e){if(document.activeElement&&ignoreTagNames.includes(document.activeElement.tagName))return;if(e.key&&e.key.toLowerCase()==="h"){let e={text:"",duration:1e3,destination:"",newWindow:!0,close:!0,gravity:"top",position:"center",stopOnFocus:!1,style:{borderRadius:"50em"}};const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(n.has(hackKey)){e.text="Hack模式已關閉",e.style.background=warningBackgroundColor,Toastify(e).showToast(),n.delete(hackKey),t.search=n.toString(),window.history.replaceState(null,"",t.toString());return}e.text="Hack模式已開啟",e.style.background=successBackgroundColor,Toastify(e).showToast(),n.set(hackKey,"1"),t.search=n.toString(),window.history.replaceState(null,"",t.toString())}}),window.addEventListener("copy",function(e){const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(!n.has(hackKey)){e.preventDefault();const t=document.getSelection();e.clipboardData.setData("text/plain",`${t.toString()}

作者：${author}
連結：${link}
來源：${source}
${warningText}`)}})</script><style>:root{--zh-font-family:"Microsoft JhengHei", "微軟正黑體";--code-font-family:Menlo, Monaco, Consolas, "Courier New"}</style><meta name=theme-color content="#57BCB9"><link rel=manifest href=./manifest.json><link rel=apple-touch-icon sizes=57x57 href=./apple-touch-icon-57x57.webp><link rel=apple-touch-icon sizes=114x114 href=./apple-touch-icon-114x114.webp><link rel=apple-touch-icon sizes=120x120 href=./apple-touch-icon-120x120.webp><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon-180x180.webp><link rel=apple-touch-icon sizes=192x192 href=./apple-touch-icon-192x192.webp><link rel=apple-touch-icon sizes=512x512 href=./apple-touch-icon-512x512.png><meta name=msvalidate.01 content="D1D0687C3DAA5A891295FC82A5EDD3B0"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=https://wayne-blog.com/><img src=https://wayne-blog.com/img/avatar2d.webp width=256 height=256 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🧧</span></figure><div class=site-meta><h1 class=site-name><a href=https://wayne-blog.com/>Wayne (偉恩)</a></h1><h2 class=site-description>軟體開發 | 網路工程 | 技術博客</h2></div></header><ol class=social-menu><li><a href=https://wayneblog.bobaboba.me target=_blank title=Bobaboba rel=me><svg width="16" height="25" viewBox="0 0 108 156" fill="none" xmlns="http://www.w3.org/2000/svg" class="ant-menu-item-icon"><g id="Frame" clip-path="url(#clip0_1286_9119)"><path id="Vector" d="M103.092 68.82c3.923-10.88 3.425-22.877-1.386-33.3898-4.8113-10.5128-13.5473-18.6939-24.3139-22.7695C66.6255 8.58519 54.6963 8.94396 44.1907 13.6589 33.6852 18.3738 25.4501 27.065 21.2715 37.848L103.092 68.82z" fill="#e3e7f5"/><path id="Vector_2" d="M20.6297 41.1675.0942412 133.077C-.0317631 133.774.0878744 134.493.432471 135.11.777068 135.727 1.325 136.203 1.98169 136.457L52.9429 155.789C53.6062 156.055 54.3425 156.073 55.0179 155.84 55.6933 155.607 56.2629 155.137 56.6233 154.517L101.337 71.7598C101.535 71.3808 101.649 70.9635 101.672 70.5363 101.694 70.109 101.626 69.6817 101.47 69.2836 101.314 68.8855 101.075 68.5258 100.769 68.2289 100.463 67.932 100.096 67.705 99.6951 67.5631L24.4802 39.0787C24.0918 38.9392 23.6786 38.8833 23.2674 38.9148 22.8561 38.9462 22.456 39.0642 22.093 39.2611S21.4122 39.7294 21.1601 40.0578 20.7273 40.7643 20.6297 41.1675z" fill="#f2f2f2"/><path id="Vector_3" d="M82.9934.252578 82.9758.245884C80.9074-.537125 78.5998.515063 77.8216 2.59602L48.9735 79.7314C48.1953 81.8123 49.2411 84.134 51.3094 84.917L51.3271 84.9237C53.3954 85.7067 55.703 84.6545 56.4813 82.5736L85.3293 5.43823C86.1076 3.35727 85.0618 1.03559 82.9934.252578z" fill="#ced8ed"/><path id="Vector_4" d="M104.866 63.6606 24.7538 33.3326C22.2172 32.3723 19.3869 33.6626 18.4324 36.2147L18.4258 36.2325C17.4713 38.7846 18.7541 41.632 21.2907 42.5923L101.403 72.9204C103.94 73.8806 106.77 72.5902 107.724 70.0381L107.731 70.0203C108.685 67.4682 107.403 64.6209 104.866 63.6606z" fill="#cbd3e8"/><path id="Vector_5" d="M89.6538 93.0834 56.7178 154.572C56.3574 155.192 55.7878 155.662 55.1124 155.895 54.437 156.129 53.7006 156.111 53.0374 155.844L2.07618 136.513C1.41948 136.259.87155 135.782.526954 135.165.182357 134.548.0627193 133.829.188724 133.133L15.4204 64.9219 89.6538 93.0834z" fill="#f8e0be"/><path id="Vector_6" d="M74.3088 11.125C77.2135 11.8219 79.9953 12.9619 82.5572 14.5052L69.2128 50.1868 60.2285 46.7876S74.6297 11.2579 74.3088 11.125z" fill="#e3e7f5"/><path id="Vector_7" d="M15.1374 125.272C17.7851 125.272 19.9315 123.112 19.9315 120.448 19.9315 117.784 17.7851 115.625 15.1374 115.625S10.3433 117.784 10.3433 120.448C10.3433 123.112 12.4897 125.272 15.1374 125.272z" fill="#d79b7a"/><path id="Vector_8" d="M15.3261 108.756C17.9738 108.756 20.1202 106.597 20.1202 103.933 20.1202 101.269 17.9738 99.1094 15.3261 99.1094S10.532 101.269 10.532 103.933C10.532 106.597 12.6784 108.756 15.3261 108.756z" fill="#d79b7a"/><path id="Vector_9" d="M23.0837 141.303c2.6477.0 4.7941-2.16 4.7941-4.82300000000001C27.8778 133.816 25.7314 131.656 23.0837 131.656S18.2896 133.816 18.2896 136.48C18.2896 139.143 20.436 141.303 23.0837 141.303z" fill="#d79b7a"/><path id="Vector_10" d="M58.9829 119.678c2.6477.0 4.7941-2.16 4.7941-4.82299999999999.0-2.664-2.1464-4.824-4.7941-4.824-2.6478.0-4.7942 2.16-4.7942 4.824C54.1887 117.518 56.3351 119.678 58.9829 119.678z" fill="#d79b7a"/><path id="Vector_11" d="M59.9643 138.022C62.612 138.022 64.7584 135.862 64.7584 133.198 64.7584 130.534 62.612 128.375 59.9643 128.375S55.1702 130.534 55.1702 133.198C55.1702 135.862 57.3166 138.022 59.9643 138.022z" fill="#d79b7a"/><path id="Vector_12" d="M41.3351 136.631C43.9829 136.631 46.1293 134.472 46.1293 131.808c0-2.66399999999999-2.1464-4.824-4.7942-4.824C38.6874 126.984 36.541 129.144 36.541 131.808 36.541 134.472 38.6874 136.631 41.3351 136.631z" fill="#d79b7a"/><path id="Vector_13" d="M50.5837 150.701C53.2314 150.701 55.3778 148.542 55.3778 145.878 55.3778 143.214 53.2314 141.055 50.5837 141.055S45.7896 143.214 45.7896 145.878C45.7896 148.542 47.936 150.701 50.5837 150.701z" fill="#d79b7a"/><path id="Vector_14" d="M35.7106 121.381C38.3584 121.381 40.5048 119.222 40.5048 116.558 40.5048 113.894 38.3584 111.734 35.7106 111.734 33.0629 111.734 30.9165 113.894 30.9165 116.558 30.9165 119.222 33.0629 121.381 35.7106 121.381z" fill="#d79b7a"/><path id="Vector_15" d="M68.8354 37.6381C67.5686 37.1053 66.5083 36.1721 65.8153 34.9795 65.7527 34.8551 65.7394 34.7115 65.778 34.5775 65.8165 34.4436 65.9042 34.3294 66.0231 34.2579 66.1435 34.1884 66.2861 34.1695 66.4203 34.205 66.5545 34.2405 66.6695 34.3277 66.7404 34.4477 66.7404 34.5996 68.7787 37.9797 72.0251 36.4985 72.0885 36.4533 72.1611 36.4229 72.2375 36.409 72.314 36.3952 72.3924 36.3984 72.4675 36.4185 72.5425 36.4387 72.6122 36.4755 72.6716 36.5259 72.731 36.5762 72.7785 36.6392 72.811 36.7102 72.8435 36.7812 72.86 36.8585 72.8594 36.9366 72.8588 37.0148 72.8409 37.0917 72.8073 37.1622 72.7737 37.2326 72.7251 37.2947 72.6649 37.3442 72.6047 37.3936 72.5345 37.429 72.4592 37.448 71.8991 37.7239 71.2894 37.8829 70.6666 37.9156 70.0439 37.9482 69.421 37.8539 68.8354 37.6381z" fill="#42210b"/><path id="Vector_16" d="M52.3767 34.5824c3.4921.0 6.3229-2.8481 6.3229-6.3615s-2.8308-6.3615-6.3229-6.3615-6.323 2.8481-6.323 6.3615 2.8309 6.3615 6.323 6.3615z" fill="#f2f2f2"/><path id="Vector_17" d="M46.3936 25.979C46.6783 25.1869 47.1165 24.4595 47.6829 23.8392 48.2493 23.2188 48.9326 22.7179 49.6929 22.3653 50.4533 22.0128 51.2757 21.8156 52.1124 21.7854 52.949 21.7551 53.7833 21.8922 54.5668 22.1889 55.3504 22.4857 56.0677 22.9361 56.6768 23.5139 57.286 24.0918 57.7751 24.7855 58.1157 25.555 58.4563 26.3245 58.6416 27.1543 58.6608 27.9964 58.6801 28.8385 58.5329 29.6761 58.2279 30.4605" fill="#51260e"/><path id="Vector_18" d="M53.4147 28.5224C53.2968 29.0523 53.0675 29.5504 52.742 29.9835 52.4164 30.4166 52.0024 30.7745 51.5277 31.0329 51.0531 31.2913 50.5289 31.4443 49.9905 31.4817 49.4521 31.519 48.9121 31.4396 48.4067 31.2492 47.9014 31.0587 47.4424 30.7614 47.0609 30.3773 46.6795 29.9933 46.3841 29.5315 46.1951 29.0229 46.0061 28.5143 45.9277 27.9709 45.9652 27.4292 46.0026 26.8875 46.1552 26.3602 46.4124 25.8828" fill="#47220d"/><path id="Vector_19" d="M87.4079 47.8559C90.9 47.8559 93.7309 45.0077 93.7309 41.4943 93.7309 37.981 90.9 35.1328 87.4079 35.1328c-3.492.0-6.3229 2.8482-6.3229 6.3615.0 3.5134 2.8309 6.3616 6.3229 6.3616z" fill="#f2f2f2"/><path id="Vector_20" d="M81.4246 39.2313C82.0304 37.6734 83.222 36.4183 84.741 35.7378 86.26 35.0572 87.9843 35.0059 89.5405 35.5952 91.0967 36.1845 92.3595 37.3671 93.0555 38.8864S93.8245 42.1397 93.2589 43.7129" fill="#51260e"/><path id="Vector_21" d="M88.446 41.8148C88.0132 42.6263 87.302 43.2519 86.445 43.5752 85.5879 43.8985 84.6434 43.8975 83.787 43.5724 82.9307 43.2473 82.2208 42.62 81.7897 41.8077 81.3586 40.9953 81.2355 40.0531 81.4434 39.1562" fill="#47220d"/></g><defs><clipPath id="clip0_1286_9119"><rect width="108" height="156" fill="#fff"/></clipPath></defs></svg></a></li><li><a href=https://www.facebook.com/wayne.blog.ga/ target=_blank title=Facebook rel=me><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><linearGradient id="CXanuwD9EGkBgTn76_1mxa" x1="9.993" x2="40.615" y1="-299.993" y2="-330.615" gradientTransform="matrix(1 0 0 -1 0 -290)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2aa4f4"/><stop offset="1" stop-color="#007ad9"/></linearGradient><path fill="url(#CXanuwD9EGkBgTn76_1mxa)" d="M24 4C12.954 4 4 12.954 4 24c0 10.028 7.379 18.331 17.004 19.777C21.981 43.924 22.982 41 24 41c.919.0 1.824 2.938 2.711 2.818C36.475 42.495 44 34.127 44 24 44 12.954 35.046 4 24 4z"/><path d="M27.707 21.169c0-1.424.305-3.121 1.757-3.121h4.283l-.001-5.617-.05-.852-.846-.114c-.608-.082-1.873-.253-4.206-.253-5.569.0-8.636 3.315-8.636 9.334v2.498H15.06v7.258h4.948V43.6C21.298 43.861 22.633 44 24 44c1.268.0 2.504-.131 3.707-.357V30.301h5.033l1.122-7.258h-6.155V21.169z" opacity=".05"/><path d="M27.207 21.169c0-1.353.293-3.621 2.257-3.621h3.783V12.46l-.026-.44-.433-.059c-.597-.081-1.838-.249-4.143-.249-5.323.0-8.136 3.055-8.136 8.834v2.998H15.56v6.258h4.948v13.874C21.644 43.876 22.806 44 24 44c1.094.0 2.16-.112 3.207-.281V29.801h5.104l.967-6.258h-6.072V21.169z" opacity=".05"/><path fill="#fff" d="M26.707 29.301h5.176l.813-5.258h-5.989v-2.874c0-2.184.714-4.121 2.757-4.121h3.283V12.46c-.577-.078-1.797-.248-4.102-.248-4.814.0-7.636 2.542-7.636 8.334v3.498H16.06v5.258h4.948v14.475C21.988 43.923 22.981 44 24 44c.921.0 1.82-.062 2.707-.182V29.301z"/></svg></a></li><li><a href=https://github.com/wjdesign target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/4006wayne target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=https://wayne-blog.com/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>關於本站</span></a></li><li><a href=https://wayne-blog.com/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>文章卷宗</span></a></li><li><a href=https://wayne-blog.com/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜尋檢索</span></a></li><li><a href=https://wayne-blog.com/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>相關連結</span></a></li><li><a href=https://wayne-blog.com/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分類檢索</span></a></li><li><a href=https://wayne-blog.com/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>標籤檢索</span></a></li><li><a href=https://wayne-blog.com/index.xml target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg><span>RSS Feed</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://wayne-blog.com/ selected>繁體中文</option><option value=https://wayne-blog.com/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>夜晚模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#將網頁變成progressive-web-applicationpwa>將網頁變成Progressive Web Application(PWA)</a><ol><li><a href=#step1下載-chrome-擴充套件>Step1：下載 Chrome 擴充套件</a></li><li><a href=#step2檢查網頁>Step2：檢查網頁</a></li><li><a href=#step3建立-manifestjson>Step3：建立 manifest.json</a><ol><li></li></ol></li><li><a href=#step4html-加入-manifestjson>Step4：html 加入 manifest.json</a></li><li><a href=#step5打開開發人員工具檢查-manifestjson-的設定>Step5：打開開發人員工具檢查 manifest.json 的設定</a></li><li><a href=#step6加入-serviceworker-語法>Step6：加入 <code>serviceWorker</code> 語法</a></li><li><a href=#step7建立-service-workerjs-檔案>Step7：建立 <code>service-worker.js</code> 檔案</a><ol><li></li></ol></li><li><a href=#step8確認-service-workers-是否正常>Step8：確認 Service Workers 是否正常</a></li><li><a href=#step9安裝頁面>Step9：安裝「頁面」</a></li><li><a href=#step10安裝>Step10：安裝</a></li></ol></li><li><a href=#manifestjson-介紹>manifest.json 介紹</a><ol><li><a href=#manifestjson是做什麼用的>manifest.json是做什麼用的？</a></li><li><a href=#manifestjson-成員>manifest.json 成員</a><ol><li><a href=#theme_color>theme_color</a></li><li><a href=#background_color>background_color</a></li><li><a href=#icons>icons</a></li><li><a href=#name>name</a></li><li><a href=#short_name>short_name</a></li><li><a href=#lang>lang</a></li><li><a href=#description>description</a></li><li><a href=#dir>dir</a></li><li><a href=#display>display</a></li><li><a href=#orientation>orientation</a></li><li><a href=#prefer_related_applications>prefer_related_applications</a></li><li><a href=#related_applications>related_applications</a></li><li><a href=#start_url>start_url</a></li><li><a href=#scope>scope</a></li><li><a href=#manifestjson-基本檔案內容>manifest.json 基本檔案內容</a></li></ol></li><li><a href=#關於chrome-主動提示加入主畫面>關於「Chrome 主動提示加入主畫面」</a></li><li><a href=#manifest-觀摩>manifest 觀摩</a></li></ol></li><li><a href=#service-worker-介紹>Service Worker 介紹</a><ol><li><ol><li></li></ol></li><li><a href=#add-to-home-screen-banner>Add to home screen banner</a></li></ol></li><li><a href=#用-firebase-做-web-push>用 Firebase 做 Web Push</a><ol><li><a href=#用到的資源>用到的資源</a></li><li><a href=#取得-fcm-金鑰>取得 FCM 金鑰</a></li><li><a href=#新增-manifestjsonfirebase-config>新增 manifest.json、Firebase Config</a><ol><li></li></ol></li><li><a href=#firebase-config>Firebase Config</a><ol><li></li></ol></li><li><a href=#取得使用者的-token>取得使用者的 token</a></li><li><a href=#新增-swjs>新增 sw.js</a><ol><li></li></ol></li><li><a href=#註冊-swjs存-cookies存-firebase>註冊 sw.js、存 Cookies、存 Firebase</a><ol><li></li></ol></li><li><a href=#發送-web-push>發送 Web Push</a><ol><li></li></ol></li><li><a href=#接收-web-push>接收 Web Push</a><ol><li><a href=#使用者正開啟官網頁面>使用者正開啟官網頁面</a></li><li><a href=#使用者沒有開啟官網頁面>使用者沒有開啟官網頁面</a></li></ol></li><li><a href=#補充資源>補充資源</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><a class=btnBack href=javascript:void(0) onclick=backEvent()><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-back" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 11l-4 4 4 4m-4-4h11a4 4 0 000-8h-1"/></svg><span class=btnBackText>BACK</span>
</a><script>function backEvent(){if(document.referrer.indexOf(window.location.host)!==-1){history.go(-1);return}window.location.href=window.location.origin}</script><header class=article-header><div class=article-image><a href=https://wayne-blog.com/2022-10-19/web-pwa/><img src=https://live.staticflickr.com/65535/52438994804_33f71b7e35_o.jpg loading=lazy alt="Featured image of post 將網頁變成Progressive Web Application(PWA)，漸進式的網頁應用程式"></a></div><div class=article-details><header class=article-category><a href=https://wayne-blog.com/categories/pwa/ style=background-color:#161617;color:#fff>PWA
</a><a href=https://wayne-blog.com/categories/seo/ style=background-color:#6eccce;color:#fff>SEO
</a><a href=https://wayne-blog.com/categories/firebase/ style=background-color:#ffcc2e;color:#fff>Firebase</a></header><div class=article-title-wrapper><h2 class=article-title><a href=https://wayne-blog.com/2022-10-19/web-pwa/>將網頁變成Progressive Web Application(PWA)，漸進式的網頁應用程式</a></h2><h3 class=article-subtitle>漸進式網路應用程式（英語：Progressive Web Apps，簡稱：PWA）是一種普通網頁或網站架構起來的網路應用程式，但它可以以傳統應用程式或原生行動應用程式形式展示給使用者。這種應用程式形態視圖將目前最為現代化的瀏覽器提供的功能與行動裝置的體驗優勢相結合。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 19, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 14 分鐘</time></div></footer></div></header><section class=article-content><style>.article-content p code{background-color:#f5f5f5;color:#ff3860}.focus{background:#f1e2e2;color:#d62c2c;padding:0 5px}</style><p><a class=link href=https://www.letswrite.tw/pwa-manifest/ target=_blank rel=noopener>參考網站</a><br><a class=link href=https://www.letswrite.tw/pwa-web-push/ target=_blank rel=noopener>參考網站</a><br><a class=link href=https://www.minwt.com/pc/pc-browser/21592.html target=_blank rel=noopener>參考網站</a></p><p>前幾天與大家分享，當開啟Chrome內建的PWA功能，就可將PWA的網頁，一鍵變成一個應用程式，雖然說PWA只是在應用程式裡，包了Chrome的瀏覽器，但開啟時就像應用程式一般，讓網頁就像應用程式一般，其實簡單的來說，這就有點像PhoneGap的感覺，但比PhoneGap要來的簡單許多。</p><p>因此只要將網頁加入一些簡單的宣告與設定，立即就可將一般的網頁變成PWA的網頁應用程式，真心覺得PWA是個好物，因此只要你會寫網頁，就可將你所設計的網頁變成一隻應用程式！</p><hr><h2 id=將網頁變成progressive-web-applicationpwa>將網頁變成Progressive Web Application(PWA)</h2><h3 id=step1下載-chrome-擴充套件>Step1：下載 Chrome 擴充套件</h3><blockquote><p><a class=link href=https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb target=_blank rel=noopener>點我前往 「<strong>Web Server</strong>」 擴充套件</a></p></blockquote><p>首先，你可先下載Chrome的「<a class=link href=https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb target=_blank rel=noopener><strong>Web Server</strong></a>」擴充程式，再點「<strong>CHOSOSE FOLDER</strong>」鈕，選擇已製作好的網頁目錄。</p><p><img src=https://live.staticflickr.com/65535/52439025049_38acceb28e_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h3 id=step2檢查網頁>Step2：檢查網頁</h3><p>點一下連結，並檢查網頁是否能正常呈現。</p><p><img src=https://live.staticflickr.com/65535/52438749096_6e0af3876b_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h3 id=step3建立-manifestjson>Step3：建立 manifest.json</h3><blockquote><p><a class=link href=./#manifestjson-%e4%bb%8b%e7%b4%b9>更多 manifest.json 介紹，點我前往</a></p></blockquote><p>接著建立一個新的文件檔，並依的輸入應用程式名稱、圖示、與應用程式的URL，再將它儲存為「<strong>manifest.json</strong>」檔。</p><h5 id=manifestjson>manifest.json</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;偉恩的部落格，用於紀錄coding life查找的資料、筆記與文章，統整起來除了自己使用，也希望對各位有幫助。&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-57x57.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;57x57&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-114x114.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;114x114&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-120x120.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;120x120&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-180x180.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;180x180&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-192x192.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-512x512.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./maskable_icon.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;purpose&#34;</span><span class=p>:</span> <span class=s2>&#34;any maskable&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;lang&#34;</span><span class=p>:</span> <span class=s2>&#34;zh-Hant-TW&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;./?utm_source=web_app_manifest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#f5f5fa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#57BCB9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;orientation&#34;</span><span class=p>:</span> <span class=s2>&#34;landscape&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefer_related_applications&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=step4html-加入-manifestjson>Step4：html 加入 manifest.json</h3><p><img src=https://live.staticflickr.com/65535/52438247082_37e5c1b64e_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>在head標籤中加入 <code>manifest.json</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- ... --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;manifest&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./manifest.json&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- ... --&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>由於 <code>manifest</code> 在 IOS 上還不支援，因此如果 IOS 上也想要<code>自訂 icon</code>，就要改用 HTML 裡的 meta 來設定，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- ... --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;manifest&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./manifest.json&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;57x57&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-57x57.webp&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;114x114&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-114x114.webp&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;120x120&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-120x120.webp&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;180x180&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-180x180.webp&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;192x192&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-192x192.webp&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;512x512&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;./apple-touch-icon-512x512.png&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- ... --&gt;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=step5打開開發人員工具檢查-manifestjson-的設定>Step5：打開開發人員工具檢查 manifest.json 的設定</h3><p><img src=https://live.staticflickr.com/65535/52439205970_f9a2704fb2_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h3 id=step6加入-serviceworker-語法>Step6：加入 <code>serviceWorker</code> 語法</h3><blockquote><p><a class=link href=./#service-worker-%e4%bb%8b%e7%b4%b9>更多 Service Worker 介紹，點我前往</a></p></blockquote><p>在網頁前加入下方的語法。</p><p><img src=https://live.staticflickr.com/65535/52439205965_51d524f499_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=s2>&#34;serviceWorker&#34;</span> <span class=k>in</span> <span class=nx>navigator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Will service worker register?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>navigator</span><span class=p>.</span><span class=nx>serviceWorker</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;./service-worker.js&#34;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>reg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Yes it did.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;No, it didn&#39;t. This happened: &#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=step7建立-service-workerjs-檔案>Step7：建立 <code>service-worker.js</code> 檔案</h3><p>接著再建立一個文件，並貼上下方的語法，儲存為 <strong>service-worker.js</strong>，這時可看到在原來的網頁中，分別會多了 <code>manifest.json</code> 與 <code>service-worker.js</code> 和圖片資料夾。</p><h5 id=service-workerjs>service-worker.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;install&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>self</span><span class=p>.</span><span class=nx>skipWaiting</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>offlinePage</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Request</span><span class=p>(</span><span class=s1>&#39;offline.html&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>waitUntil</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>fetch</span><span class=p>(</span><span class=nx>offlinePage</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>caches</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;offline2&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>cache</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>offlinePage</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;fetch&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>respondWith</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>request</span><span class=p>).</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>caches</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;offline2&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>cache</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=s1>&#39;offline.html&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;refreshOffline&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>caches</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;offline2&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>cache</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>offlinePage</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;push&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>   <span class=kd>var</span> <span class=nx>opts</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>icon</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>icon</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>url</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>waitUntil</span><span class=p>(</span><span class=nx>self</span><span class=p>.</span><span class=nx>registration</span><span class=p>.</span><span class=nx>showNotification</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>title</span><span class=p>,</span> <span class=nx>opts</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;notificationclick&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>notification</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>   <span class=nx>event</span><span class=p>.</span><span class=nx>notification</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>   <span class=nx>event</span><span class=p>.</span><span class=nx>waitUntil</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>clients</span><span class=p>.</span><span class=nx>openWindow</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=step8確認-service-workers-是否正常>Step8：確認 Service Workers 是否正常</h3><p>接著再回到網頁的「開發人員工具」的 <strong>Service Workers</strong> 時，就會看到綠色燈號。</p><p><img src=https://live.staticflickr.com/65535/52438247047_03b64fc6a7_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h3 id=step9安裝頁面>Step9：安裝「頁面」</h3><p>都完成後，再點 Chrome 右上的選單圖示，就可看到「安裝XXX」。</p><p><img src=https://live.staticflickr.com/65535/52439271878_297265b0bc_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h3 id=step10安裝>Step10：安裝</h3><p>點一下，就會出現安裝畫面，再點「<strong>安裝</strong>」。</p><p><img src=https://live.staticflickr.com/65535/52439024999_3a2b4105e7_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>當安裝完畢後，就會開啟剛所安裝的應用程式，哈！是不是畫面乾淨許多，就像在使用一般的應用程式一樣，有了PWA後可實現透過網頁就能打造專屬的應用程式的夢想，且完全不用再學新語言，真是超方便的。</p><p><img src=https://live.staticflickr.com/65535/52439205910_65be017ebf_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><hr><h2 id=manifestjson-介紹>manifest.json 介紹</h2><p>以下來說明一下 manifest.json</p><p>manifest.json 是在學 PWA 這塊時最簡單的部份，主要是建一支 JSON 檔就可以，相關的參數 MDN上 或是 Google 一下就會看到，不用花太多的時間去記。</p><h3 id=manifestjson是做什麼用的>manifest.json是做什麼用的？</h3><p>根據 MDN 上的解釋，manifest.json 是這樣子的：</p><blockquote><p>它提供了應用程式相關的資訊（像是名稱、作者、圖示、描述）。 manifest 的功用是將 Web 應用程式安裝到設備的主畫面，為使用者提供更快速的訪問和更豐富的體驗。</p></blockquote><p>簡單的說明就是，PWA 主要就是<code>讓網頁</code>可以<code>模擬</code>成一個手機的 <code>App</code> 來使用，要當成 App，就要有 App 的樣子，就要能在手機的桌面上有一個 icon 可以按，按下去後有一個幾秒鐘的啟動畫面讓使用者知道開啟的 App 是什麼，manifest 就是在處理這段。</p><p>另外，一般我們在手機上開 Chrome 或 Safari 看網頁時，最頂部會有一條網址列，但一般 App 是不會有的，而 manifest.json 也可以設定開啟頁面時不顯示網址列。</p><p>PWA 是把頁面模擬成 App 的一個方法，如果公司本身也有製作 App 呢？manifest.json 上也可以設定 App 在 Google Play、App Store 上的連結，並呈現一個推薦通知讓使用者可以進入並下載。</p><p>最後補充一點，不論是 PWA 的 Cache 或是推播功能，都要求網站要是 <code>https</code>，manifest.json 這點也不意外，如果網站不是 <code>https</code>，即便引用了 manifest.json，也<code>不會</code>被 Chrome 主動詢問是否要將網站加入到主畫面。</p><p>關於 manifest 的功能，Google 有一隻影片介紹：</p><iframe width=804 height=452 src=https://www.youtube.com/embed/yQhFmPExcbs title="Web App Manifest: Totally Tooling Tips (S3, E4)" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p>Web App Manifest: Totally Tooling Tips</p><hr><h3 id=manifestjson-成員>manifest.json 成員</h3><p>成員列表整理如下：</p><div class=table-wrapper><table><thead><tr><th>欄位</th><th>說明</th></tr></thead><tbody><tr><td><a class=link href=./#theme_color>theme_color</a></td><td>應用程式的主要顏色</td></tr><tr><td><a class=link href=./#background_color>background_color</a></td><td>啟動畫面（splash screen）的背景色</td></tr><tr><td><a class=link href=./#icons>icons</a></td><td>應用程式的圖示</td></tr><tr><td><a class=link href=./#name>name</a></td><td>應用程式的名稱</td></tr><tr><td><a class=link href=./#short_name>short_name</a></td><td>應用程式的簡寫</td></tr><tr><td><a class=link href=./#lang>lang</a></td><td>主要語言</td></tr><tr><td><a class=link href=./#description>description</a></td><td>應用程式的描述</td></tr><tr><td><a class=link href=./#dir>dir</a></td><td>文字書寫方向</td></tr><tr><td><a class=link href=./#display>display</a></td><td>應用程式的顯示模式</td></tr><tr><td><a class=link href=./#orientation>orientation</a></td><td>預設顯示的方向是直的或橫的</td></tr><tr><td><a class=link href=./#prefer_related_applications>prefer_related_applications</a></td><td>是否要推薦一個原生的 App</td></tr><tr><td><a class=link href=./#related_applications>related_applications</a></td><td>推薦原生 App 的連結</td></tr><tr><td><a class=link href=./#start_url>start_url</a></td><td>開啟應用程式時的預設網址</td></tr><tr><td><a class=link href=./#scope>scope</a></td><td>應用程式的使用範圍</td></tr></tbody></table></div><h4 id=theme_color>theme_color</h4><p><strong>應用程式的主要顏色</strong>，主要可以改變網址列那一條的顏色。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;theme_color&#34;</span><span class=err>:</span> <span class=s2>&#34;#57BCB9&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=background_color>background_color</h4><p><strong>啟動畫面（splash screen）的背景色</strong>，App 啟動時，會有一個 Splash Screen，翻譯成快閃頁、過場頁，本篇稱為啟動畫面。</p><p>Splash Screen 需要3個成員：background_color、icons、name。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;background_color&#34;</span><span class=err>:</span> <span class=s2>&#34;red&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>補充一點，Splash Screen，在 <code>IOS</code> 上是<code>不支援</code>的，但可以直接讀取一張圖檔來當作啟動頁面，在 <code>head</code> 裡加入以下就行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-640x1136.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-750x1294.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-1125x2436.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-1242x2148.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-1536x2048.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-1668x2224.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-startup-image&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;images/splash-2048x2732.png&#34;</span> <span class=na>media</span><span class=o>=</span><span class=s>&#34;(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=icons>icons</h4><p><strong>應用程式的圖示</strong>，icons 裡放陣列，放不同尺寸下的主要圖示，如果 Splash Screen 裡要用的圖示，大小<code>必須</code>包含 <code>192px</code>、<code>512px</code>。</p><p>icons 裡，陣列裡的每一個物件有 3 個成員：</p><ul><li><code>sizes</code> 圖片尺寸，可用在多個尺寸上的話用空白鍵區隔。</li><li><code>src</code> 圖片的路徑，如果是相對路徑，是<code>以 manifest 所在的位置</code>為基準。</li><li><code>type</code> 圖檔類型，這項排必填，主要是告知裝置類型，讓不支援的裝置可以快速略過。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;icons&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;icon/lowres.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;48x48&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;icon/lowres&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;48x48&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;icon/hd_hi.ico&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;72x72 96x96 128x128 256x256&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;icon/hd_hi.svg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;72x72&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>由於 <code>manifest</code> 在 IOS 上還<code>不支援</code>，因此如果 IOS 上也想要<code>自訂 icon</code>，就要改用 HTML 裡的 <code>meta</code> 來設定，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;57x57&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;apple-icon-57x57.png&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;72x72&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;apple-icon-72x72.png&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&#34;apple-touch-icon&#34;</span> <span class=na>sizes</span><span class=o>=</span><span class=s>&#34;114x114&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;apple-icon-114x114.png&#34;</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=name>name</h4><p><strong>應用程式的完整名稱</strong>，會顯示在 Splash Screen上，以及主畫面上的名稱。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;name&#34;</span><span class=err>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=short_name>short_name</h4><p><strong>應用程式的簡寫</strong>，當 name 太長而無法顯示時，會改成顯示簡寫。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;short_name&#34;</span><span class=err>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=lang>lang</h4><p><strong>主要語言</strong>，針對 name、short_name 這兩個使用的。</p><p>語言列表可以在這找：<a class=link href=https://www.iana.org target=_blank rel=noopener>https://www.iana.org</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;lang&#34;</span><span class=err>:</span> <span class=s2>&#34;zh-Hant-TW&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=description>description</h4><p><strong>應用程式的描述</strong>，描述這個應用程式是做什麼的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;description&#34;</span><span class=err>:</span> <span class=s2>&#34;偉恩的部落格，用於紀錄coding life查找的資料、筆記與文章，統整起來除了自己使用，也希望對各位有幫助。&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dir>dir</h4><p><strong>文字書寫方向</strong>，值有 3 個：<code>ltr</code>（左至右）、<code>rtl</code>（右至左）、<code>auto</code>（讓瀏覽器自己決定），不填的話預設值是 <code>auto</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;dir&#34;</span><span class=err>:</span> <span class=s2>&#34;ltr&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=display>display</h4><p><strong>應用程式的顯示模式</strong>，顯示模式指的是從主畫面點開 App 後，要顯示的樣子，有 4 個值可用：</p><ul><li><code>fullscreen</code>： 全螢幕，就像在用原生 App 一樣，會隱藏所有的瀏覽器 UI。</li><li><code>standalone</code>： 會隱藏標準瀏覽器 UI 元素，如 URL 欄等。</li><li><code>browser</code>： 預設值，就像一般用瀏覽器一樣。</li><li><code>minimal</code>： ui 會有導覽列最小的 UI，這個值 Chrome 不支援。</li></ul><p>如果要 Chrome <code>主動提示</code>加入主畫面的話，設定值必須要是 <code>standalone</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;display&#34;</span><span class=err>:</span> <span class=s2>&#34;standalone&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=orientation>orientation</h4><p><strong>預設顯示的方向是直的或橫的</strong>，可以強制讓使用者必須裝置拿直的（<code>landscape</code>）或拿橫的（<code>portrait</code>）看。這點要設要仔細思考過才行，因為使用都大部份都喜歡自己決定是直看或横看。</p><p>如果是遊戲類型的，可以設定用橫的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;orientation&#34;</span><span class=err>:</span> <span class=s2>&#34;landscape&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=prefer_related_applications>prefer_related_applications</h4><p><strong>是否要推薦一個原生的 App</strong>，PWA 是模擬頁面為 App，如果網站本身有出 App，這項就可以設成 <code>true</code>，從主畫面點開頁面時就會出現可以下載 App 的提示。</p><p>如果這項為 <code>true</code>，則下面的 <code>related_applications</code> 就要填入值；這項的預設值為 <code>false</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;prefer_related_applications&#34;</span><span class=err>:</span> <span class=kc>false</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=related_applications>related_applications</h4><p><strong>推薦原生 App 的連結</strong>，值是陣列，裡面放 App 資訊的物件，每項物件有 2 個成員要填，是 Google Play 上的話則有 3 個成員。</p><ul><li><code>platform</code>： 應用程式的平台，可填 play、itunes。</li><li><code>url</code>： 應用程式的網址。</li><li><code>id</code>： Google Play上要填的 ID。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;related_applications&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;platform&#34;</span><span class=p>:</span> <span class=s2>&#34;play&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://play.google.com/store/apps/details?id=com.example.app1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;com.example.app1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;platform&#34;</span><span class=p>:</span> <span class=s2>&#34;itunes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://itunes.apple.com/app/example-app1/id123456789&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=start_url>start_url</h4><p><strong>開啟應用程式時的預設網址</strong>，如果有設定的話，開啟應用程式時就會進到設定的網址。沒設定的話就是使用者按加入主畫面時的那個網址。<br>如果填寫的是相對路徑，是以 manifest 所在的位置為基準。<br>建議可以在網址上加入 <code>Google Analytics</code> 的 <code>utm</code> 參數，這樣在 GA 上就可以看見多少來源是來自於 <code>PWA</code>，可以檢測成效。</p><blockquote><p>如果要 Chrome <code>主動提示加入主畫面</code>的話，這項必須填寫。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;start_url&#34;</span><span class=err>:</span> <span class=s2>&#34;./?utm_source=web_app_manifest&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=scope>scope</h4><p><strong>應用程式的使用範圍</strong>，這項如果有填，那應用程式的作用域就會限在指定的目錄裡，超過指定目錄，就會當成一般的網頁瀏覽。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;scope&#34;</span><span class=err>:</span> <span class=s2>&#34;/myapp/&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=manifestjson-基本檔案內容>manifest.json 基本檔案內容</h4><p>manifest 裡的成員不是每項都一定要填寫的，以下附上 manifest.json 的基本檔內容：</p><h5 id=manifestjson-1>manifest.json</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wayne&#39;s blog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;偉恩的部落格，用於紀錄coding life查找的資料、筆記與文章，統整起來除了自己使用，也希望對各位有幫助。&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-57x57.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;57x57&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-114x114.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;114x114&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-120x120.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;120x120&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-180x180.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;180x180&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-192x192.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./apple-touch-icon-512x512.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./maskable_icon.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;purpose&#34;</span><span class=p>:</span> <span class=s2>&#34;any maskable&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;lang&#34;</span><span class=p>:</span> <span class=s2>&#34;zh-Hant-TW&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;./?utm_source=web_app_manifest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#f5f5fa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#57BCB9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;orientation&#34;</span><span class=p>:</span> <span class=s2>&#34;landscape&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefer_related_applications&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=關於chrome-主動提示加入主畫面>關於「Chrome 主動提示加入主畫面」</h3><p>PWA 身為 Google 的親身兒子，在 Android 手機是很有吃香的點。<br>頁面引用了 <code>manifest.json</code> 後，使用者在手機上點選加入主畫面，頁面就可以像 App 一樣顯示在手機的主畫面上。</p><p>但很多使用者其實不知道有這功能，或是知道了也不常會去按。<br>貼心的 Google 針對這點做了一項措施，就是<code>主動詢問</code>使用者要不要將頁面加入主畫面。</p><p>根據 Google 的說明文件：<code>Add to Home Screen</code>，觸發 Chrome 主動詢問是否加入主畫面的條件如下：</p><ol><li>使用者<code>還沒</code>加入主畫面</li><li>在有 manifes.json 的網域下，互動了至少 <code>30</code> 秒</li><li>manifset.json 裡有幾項成員一定要有：<code>name</code> 或 <code>short_name</code>、<code>icons</code>、<code>start_url</code>、<code>display</code></li><li>頁面要是 <code>https</code></li><li>頁面有裝 <code>service-worker（sw.js）</code>，裡面有監聽並處理 <code>beforeinstallprompt</code> 事件</li></ol><p>第 5 點，是否要有寫 <code>beforeinstallprompt</code>，好像不是必填項目，即便沒填，在測試時也會在底部出現一條詢問框。</p><p>在參考了這篇以後：<a class=link href=https://blog.techbridge.cc/2018/10/13/pwa-in-action/ target=_blank rel=noopener>PWA 實戰經驗分享</a><br>發現別人是用在 UX 上更優化的地方，就是自己選擇要出現詢問框時用的。</p><h3 id=manifest-觀摩>manifest 觀摩</h3><p>我們來看看幾個知名的 PWA 都是怎麼寫他們的 <code>manifest.json</code>。</p><p>第一個是 PWA 界中很有名的 <a class=link href=https://www.flipkart.com/ target=_blank rel=noopener>flipkart</a>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Flipkart Lite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Flipkart Lite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;https:/https://static.coderbridge.com/img/techbridge/images1a.flixcart.com/www/linchpin/batman-returns/logo_lite-cbb3574d.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_sender_id&#34;</span><span class=p>:</span> <span class=s2>&#34;656085505957&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_user_visible_only&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/?start_url=homescreenicon&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;permissions&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gcm&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;orientation&#34;</span><span class=p>:</span> <span class=s2>&#34;portrait&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#2874f0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#2874f0&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>再來是鼎鼎大名的 <a class=link href=https://mobile.twitter.com/manifest.json target=_blank rel=noopener>twitter</a>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#ffffff&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;It&#39;s what&#39;s happening. From breaking news and entertainment, sports and politics, to big events and everyday interests.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_sender_id&#34;</span><span class=p>:</span> <span class=s2>&#34;49625052041&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_user_visible_only&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Twitter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;share_target&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;action&#34;</span><span class=p>:</span> <span class=s2>&#34;compose/tweet&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;params&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;title&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;text&#34;</span><span class=p>:</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;url&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;Twitter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#ffffff&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最後則是 <a class=link href=https://events.google.com/io target=_blank rel=noopener>Google I/O 2018</a>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Google I/O 2018&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;I/O 2018&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;./?utm_source=web_app_manifest&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#6284F3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#6284F3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen57.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;57x57&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen114.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;114x114&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen128.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;128x128&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen144.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;144x144&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen192.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;static/images/homescreen/homescreen512.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prefer_related_applications&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;related_applications&#34;</span><span class=p>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;platform&#34;</span><span class=p>:</span> <span class=s2>&#34;play&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;com.google.samples.apps.iosched&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_sender_id&#34;</span><span class=p>:</span> <span class=s2>&#34;103953800507&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>我滿喜歡觀察別人家的這些東西，因為你會發現很多你查資料時遺漏或是根本找不到的資訊，而且這些看久了你也會有個概念，知道哪些屬性特別常用，除了 <code>manifest.json</code> 以外，也可以參考 html 裡面的 tag，一樣能學習到很多。</p><hr><h2 id=service-worker-介紹>Service Worker 介紹</h2><p>加入 Service Worker 的目的就只有一個，那就是<code>快取</code>。透過 Service Worker（以下簡稱 SW），可以幫助我們在發送 request 之前就先攔截到並且做處理，而離線運行的原理也是這樣的，我們先在第一次開啟時註冊 SW，並且利用 SW 下載靜態檔案並快取住，之後若使用者離線，我們再用已經快取住的檔案來回覆，就不會發送真的 request，自然也不會發生無法連線的情況。</p><p>而 Google 有提供了一個方便的工具：<a class=link href=https://developers.google.com/web/tools/workbox/ target=_blank rel=noopener>Workbox</a> 來幫助我們自動產生出 SW 以及利用更方便的語法來攔截 request。</p><p>舉例來說，我自己用的是 Webpack 的 plugin：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>new</span> <span class=nx>workboxPlugin</span><span class=p>.</span><span class=nx>InjectManifest</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>swSrc</span><span class=o>:</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;..&#39;</span><span class=p>,</span> <span class=nx>SRC_DIR</span><span class=p>,</span> <span class=s1>&#39;sw.js&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>swDest</span><span class=o>:</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;..&#39;</span><span class=p>,</span> <span class=nx>DIST_DIR</span><span class=p>,</span> <span class=s1>&#39;sw.js&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>globDirectory</span><span class=o>:</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;..&#39;</span><span class=p>,</span> <span class=nx>DIST_DIR</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>globPatterns</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;**/*.{js,css}&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//sw.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>precacheList</span> <span class=o>=</span> <span class=nx>self</span><span class=p>.</span><span class=nx>__precacheManifest</span> <span class=o>||</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=nx>workbox</span><span class=p>.</span><span class=nx>precaching</span><span class=p>.</span><span class=nx>precacheAndRoute</span><span class=p>(</span><span class=nx>precacheList</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>只要這樣一寫，就會自動去找符合規則的檔案並且加入快取清單裡面，你只要一註冊 SW 的時候就會把那些檔案給快取起來。</p><p>除此之外呢，Workbox 也可以針對 URL 來監聽：</p><h5 id=swjs>sw.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// sw.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>workbox</span><span class=p>.</span><span class=nx>routing</span><span class=p>.</span><span class=nx>registerRoute</span><span class=p>(</span><span class=sr>/(https?:\/\/)(.*)\/api\/(.*)/</span><span class=p>,</span> <span class=nx>args</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>workbox</span><span class=p>.</span><span class=nx>strategies</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>networkFirst</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>cacheName</span><span class=o>:</span> <span class=s1>&#39;data-cache&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=nx>workbox</span><span class=p>.</span><span class=nx>expiration</span><span class=p>.</span><span class=nx>Plugin</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>maxEntries</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>maxAgeSeconds</span><span class=o>:</span> <span class=mi>2592000</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>handle</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;err:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>像上面的程式碼就是針對路徑中含有 <code>api</code> 的 request 做快取，這樣在離線時也可以利用以前快取住的 API response。</p><p>Workbox 針對這種動態的快取提供幾種策略，分別是：<code>staleWhileRevalidate</code>、<code>cacheFirst</code>、<code>networkFirst</code>、<code>networkOnly</code>與<code>cacheOnly</code>，其實看名字就可以大概理解策略是什麼了，想知道詳細的內容可以參考官方文件：<a class=link href=https://developers.google.com/web/tools/workbox/modules/workbox-strategies target=_blank rel=noopener>Workbox Strategies</a>。</p><p>總之自從有了 Workbox 之後，基本上就不用自己手寫 SW 了，都靠著它提供的 API 以及功能就行了，就可以自動產生出符合需求的 SW。</p><h3 id=add-to-home-screen-banner>Add to home screen banner</h3><p>最後要來談的是「<code>安裝 PWA</code>」這一塊，在 iOS Safari 上面別無他法，就只能自己叫出選單然後選取「Add to home screen」，可是在 Android Chrome 上面，如果你符合一定的條件（有設置 <code>mainfest.json</code> 以及有註冊 Service Worker），就會自動幫你跳出一個可愛的 Install banner。</p><p><img src=https://live.staticflickr.com/65535/52438831646_c2bf748711_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>（圖片來自：<a class=link href=https://developers.google.com/web/updates/2018/06/a2hs-updates target=_blank rel=noopener>Changes to Add to Home Screen Behavior</a>）</p><p>根據 Chrome 版本的不同，行為也有所不同。</p><p>在 Chrome 67（含）以前的版本，如果你在 <code>beforeinstallprompt</code> 事件裡面沒有特別用 <code>preventDefault()</code>，或是顯式的呼叫了 <code>prompt()</code>，就會出現最左邊那個頗大的 A2HS banner。</p><p>然後在 Chrome 68（含）之後的版本，無論你做了什麼，系統都會自動出現那個 Mini-infobar，但如果使用者關掉的話，要隔三個月才會再出現一次，實在是有夠久。</p><p>接著呢，上面這兩個 A2HS banner 跟 Mini-infobar，使用者點擊之後都會出現最右邊的 A2HS Dialog，提示使用者要不要安裝 PWA。</p><p>但是在 Chrome 68 以後，你也可以利用程式去呼叫 <code>beforeinstallprompt</code> 裡面拿到的 <code>event.prompt()</code> 把這個 dialog 顯示出來。</p><p>聽起來有點複雜對吧？</p><p>先來介紹 <code>beforeinstallprompt</code> 這個 event 好了，這個 event 在一切都準備就緒，確認你滿足條件可以顯示 prompt 的時候會被觸發，會傳來一個 event，你可以阻止顯示 prompt，把這個 event 存起來：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 此範例來自上面的官方文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>installPromptEvent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;beforeinstallprompt&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Prevent Chrome &lt;= 67 from automatically showing the prompt
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Stash the event so it can be triggered later.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>installPromptEvent</span> <span class=o>=</span> <span class=nx>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Update the install UI to notify the user app can be installed
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#install-button&#39;</span><span class=p>).</span><span class=nx>disabled</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>為什麼要存起來呢？因為使用者可能不想一打開網站就看到這個彈窗，或者他可能正在結帳結果你跳這個東西來干擾他，所以先把它存起來，等適當的時機再呼叫 <code>installPromptEvent.prompt()</code> 來跳出 Dialog。</p><p>但要注意的事情是你直接呼叫 <code>installPromptEvent.prompt()</code> 是沒用的，你必須要 <code>within a user gesture</code>，意思就是你要放在按鈕的 click 事件（或其他由使用者觸發的事件）裡才有效，直接呼叫是沒有用的，而且會看到 console 跳出錯誤訊息。</p><p>我之前一度很好奇它是怎麼做判斷的，後來發現原來有 <code>event.isTrusted</code> 可以用，可以判斷一個事件是不是被使用者主動觸發的，參考資料：<a class=link href=https://developer.mozilla.org/en-US/docs/Web/API/Event/isTrusted target=_blank rel=noopener>MDN - Event.isTrusted</a>。</p><p>總之呢，因為在不同版本上的 Chrome 有不同行為，所以最後我們決定用下面的程式碼針對不同版本有不同的反應：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 把 event 存起來
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>installPromptEvent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 要顯示 prompt 的延遲
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>showTime</span> <span class=o>=</span> <span class=mi>30</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;beforeinstallprompt&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>installPromptEvent</span> <span class=o>=</span> <span class=nx>e</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>navigator</span><span class=p>.</span><span class=nx>userAgent</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=sr>/Chrom(e|ium)\\/</span><span class=p>([</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=o>+</span><span class=p>)</span><span class=err>\\</span><span class=p>.</span><span class=o>/</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>version</span> <span class=o>=</span> <span class=p>(</span><span class=nx>data</span> <span class=o>&amp;&amp;</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=o>?</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>data</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>10</span><span class=p>)</span> <span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>version</span> <span class=o>&amp;&amp;</span> <span class=nx>installPromptEvent</span><span class=p>.</span><span class=nx>prompt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 延遲一段時間才顯示 prompt
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 如果 Chrome 版本是 67（含）以下，可以直接呼叫
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=nx>version</span> <span class=o>&lt;=</span> <span class=mi>67</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>installPromptEvent</span><span class=p>.</span><span class=nx>prompt</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 否則的話必須透過 user action 主動觸發
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// 這邊幫 #root 加上 event listener，代表點擊螢幕任何一處都會顯示 prompt
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#root&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>addToHomeScreen</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=nx>showTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>addToHomeScreen</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>installPromptEvent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>installPromptEvent</span><span class=p>.</span><span class=nx>prompt</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>installPromptEvent</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#root&#39;</span><span class=p>).</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>addToHomeScreen</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如果是 67 以下，直接呼叫就可以顯示 <code>prompt</code>，否則的話還要再一步，要加個 <code>event listener</code> 才行，而我們也選擇延遲 30 秒才顯示。</p><p>出乎意料地，這樣一個小改動帶來驚人的成長，原本一天大概才 20、30 個人安裝 PWA，經過這樣調整之後瞬間變成八到十倍，看到 GA 的那個統計圖我也嚇了一跳，沒想到效果這麼好。</p><p>與其一直積極地要別人快點安裝 PWA，還不如只要求真的對你產品有興趣（停留超過 30 秒鐘）的人。</p><hr><h2 id=用-firebase-做-web-push>用 Firebase 做 Web Push</h2><h3 id=用到的資源>用到的資源</h3><p>Web Push 推播功能，這陣子很常看到的一個功能，如果一進入網站，看到網站要求顯示通知的權限，就代表這個網站有用這功能：</p><p><img src=https://live.staticflickr.com/65535/52438850656_3ce5330b21_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>那通常，很多網站 UX 設計不良，在使用者根本就還搞不清楚這網站是幹麻的情況下就跳通知，所以大部份都直接按封鎖了吧 XD？</p><p>總之，在踩了幾個坑以後，終於完整的寫出了 Web Push 的功能。</p><p>完整是指會在桌機、安卓手機發出推播通知，並且點了會進到指定的頁面，同時在 Firebase 儲存發送訊息的記錄。</p><p>用到的資源如下：</p><ul><li>資料庫：<a class=link href=https://firebase.google.com/products/realtime-database/ target=_blank rel=noopener>Firebase Realtime Database</a></li><li>推播功能：<a class=link href=https://firebase.google.com/docs/cloud-messaging/ target=_blank rel=noopener>Firebase Cloud Messaging</a></li><li>JS framework：<a class=link href=https://vuejs.org/ target=_blank rel=noopener>Vue.js</a></li></ul><p><code>Web Push</code> 是 PWA 一個很重要的功能！</p><h3 id=取得-fcm-金鑰>取得 FCM 金鑰</h3><p>本篇是用 Firebase 的 Cloud Messaging功能（以下稱 FCM），去實作 Web Push。所以第一步是要先在 Firebase 上開一個專案。</p><p><strong>以下截圖所用到的 Firebase 專案之後會刪掉，各種金鑰最後都不會存在，純示範用。</strong></p><p>開完專案後，要取得推播金鑰，有了金鑰才能始用 FCM 的功能。</p><p>首先進到 Firebase 後台，點選齒輪後，再點選專案設定：</p><p><img src=https://live.staticflickr.com/65535/52439127899_efedc17195_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>點擊 Cloud Messaging：</p><p><img src=https://live.staticflickr.com/65535/52439308150_dcc89eebfd_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>頁面往下拉，會看到一個「網路設定」的區塊，有一個「產生金鑰組」的按金，按下去：</p><p><img src=https://live.staticflickr.com/65535/52439127849_20fb7aee04_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>就會產生一組 Web Push 用的<code>金鑰</code>，先存下來，Firebase Config 裡會用到：</p><p><img src=https://live.staticflickr.com/65535/52439127839_7ae66a876d_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><h3 id=新增-manifestjsonfirebase-config>新增 manifest.json、Firebase Config</h3><p>取得金鑰後，第二步就是新增一個 <code>manifest.json</code> 的檔案，檔案內容大概如下：</p><h5 id=manifestjson-2>manifest.json</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;short_name&#34;</span><span class=p>:</span> <span class=s2>&#34;XXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;XXXXXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;icons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;./logo/logo192.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;192x192&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span> <span class=s2>&#34;./logo/logo512.png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/png&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;src&#34;</span><span class=p>:</span><span class=s2>&#34;./logo/maskable_icon.webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sizes&#34;</span><span class=p>:</span> <span class=s2>&#34;512x512&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;image/webp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;purpose&#34;</span><span class=p>:</span> <span class=s2>&#34;any maskable&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;start_url&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;background_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#ffffff&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;display&#34;</span><span class=p>:</span> <span class=s2>&#34;standalone&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;theme_color&#34;</span><span class=p>:</span> <span class=s2>&#34;#000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gcm_sender_id&#34;</span><span class=p>:</span> <span class=s2>&#34;103953800507&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最重要的是這一行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;gcm_sender_id&#34;</span><span class=err>:</span> <span class=s2>&#34;103953800507&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>這行<code>一定要有</code>，key、value 是固定的，copy 貼上就行。</p><h3 id=firebase-config>Firebase Config</h3><p>建立一個首頁的檔案 <code>index.html</code>，在頁尾的部份引用 Firebase Config。<br>Firebase Config 一樣是後台有提供，點小齒輪，再點專案設定後，接著點代表 Web 的那個按鈕：</p><p><img src=https://live.staticflickr.com/65535/52439127824_fe5bb89da2_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>就會出現 Config 了：</p><p><img src=https://live.staticflickr.com/65535/52439308100_319e8310b7_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>copy 以後貼到 <code>index.html</code>，另外也一併貼上 FCM 的引用，整合後如下：</p><h5 id=fcm-web-push-firebase-confightml>fcm-web-push-firebase-config.html</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://www.gstatic.com/firebasejs/5.9.1/firebase.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiKey</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>authDomain</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX.firebaseapp.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>databaseURL</span><span class=o>:</span> <span class=s2>&#34;https://XXXXXXXXXX.firebaseio.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>projectId</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>storageBucket</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX.appspot.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>messagingSenderId</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>firebase</span><span class=p>.</span><span class=nx>initializeApp</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>database</span> <span class=o>=</span> <span class=nx>firebase</span><span class=p>.</span><span class=nx>database</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>messaging</span> <span class=o>=</span> <span class=nx>firebase</span><span class=p>.</span><span class=nx>messaging</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>messaging</span><span class=p>.</span><span class=nx>usePublicVapidKey</span><span class=p>(</span><span class=s1>&#39;XXXXXXXXXXXXXXXXXXXX&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>最後一行的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>messaging</span><span class=p>.</span><span class=nx>usePublicVapidKey</span><span class=p>(</span><span class=s1>&#39;XXXXXXXXXXXXXXXXXXXX&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>XXX 就是要替換成第一步拿到的 <code>FCM 金鑰</code>。</p><h3 id=取得使用者的-token>取得使用者的 token</h3><p>簡單來說，Web Push 推播功能的流程如下：</p><ul><li>註冊 service-worker → 向使用者要求允許通知權限 →</li><li>FCM 產生這個裝置的 token → token 寫進資料庫 →</li><li>從後台使用 Web Push → Server 發 Web Push 到裝置上 →</li><li>裝置上的 service worker 接收 → service worker 執行 notification</li></ul><p>token 是每一個裝置會有的，之所以會以裝置為單位，而不是以使用者為單位，是因為每一個裝置都可以註冊service worker，而且每次存的 token 都會不同，所以一個使用者在桌機的 Chrome、Fireox，或是安卓手機的Chrome、Firefox，都有不同的 token。</p><p>假設王小明在桌機的 Chrome、Firefox，都按下了允許通知，在安卓手機的 Chrome、Firefox 也按了允許通知，那當我們按下發送推播後，王小明就會在 4 個地方收到相同的通知。因為是用裝置來區分的。</p><blockquote><p><strong>IOS 目前還不支援 Web Push。</strong><br>2020.04.10更新：<br>今天看到 iZooto 的 <a class=link href=https://www.izooto.com/blog/ios-push-notifications-safari target=_blank rel=noopener>一篇文章</a> 上寫，在比對了一下 <a class=link href="https://caniuse.com/#search=service%20workers" target=_blank rel=noopener>Can I Use</a> 中的 service workers 支援情況，可以看到 IOS11.3 開始支援 Service Workers 了，但 <code>Web Push</code> 的功能只支援在 MAC，尚未支援到 iPhone 上。</p></blockquote><h3 id=新增-swjs>新增 sw.js</h3><p>用 <a class=link href=https://developers.google.com/web/tools/workbox/ target=_blank rel=noopener>Workbox</a> 新增一個 sw.js 檔案，把 Firebase 的 Config 放進去，程式碼如下：</p><h5 id=fcm-web-push-sw1js>fcm-web-push-sw1.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>importScripts</span><span class=p>(</span><span class=s2>&#34;https://storage.googleapis.com/workbox-cdn/releases/3.6.3/workbox-sw.js&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importScripts</span><span class=p>(</span><span class=s1>&#39;https://www.gstatic.com/firebasejs/5.7.0/firebase-app.js&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>importScripts</span><span class=p>(</span><span class=s1>&#39;https://www.gstatic.com/firebasejs/5.7.0/firebase-messaging.js&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>workbox</span><span class=p>.</span><span class=nx>clientsClaim</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>workbox</span><span class=p>.</span><span class=nx>skipWaiting</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>workbox</span><span class=p>.</span><span class=nx>precaching</span><span class=p>.</span><span class=nx>precacheAndRoute</span><span class=p>([</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 要快取的檔案
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// firebase config
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiKey</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>authDomain</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX.firebaseapp.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>databaseURL</span><span class=o>:</span> <span class=s2>&#34;https://XXXXXXXXXX.firebaseio.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>projectId</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>storageBucket</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX.appspot.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>messagingSenderId</span><span class=o>:</span> <span class=s2>&#34;XXXXXXXXXX&#34;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>firebase</span><span class=p>.</span><span class=nx>initializeApp</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>messaging</span> <span class=o>=</span> <span class=nx>firebase</span><span class=p>.</span><span class=nx>messaging</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>如果推播裡要放公司的 Logo，那 Logo 的圖檔就要寫進快取檔案的清單裡，到時推播才有圖檔可以顯示。</p></blockquote><h3 id=註冊-swjs存-cookies存-firebase>註冊 sw.js、存 Cookies、存 Firebase</h3><p>如果拿到的 token 不存在 Cookies 裡，用 Cookies 判斷是否拿過 token，那使用者就會存到 2 組以上的 token，在發推播時，就會收到相同的訊息多次。</p><p><strong>當然，如果使用者清除了快取，就會有別種情況發生，最好的方式還是讓使用者登入會員後，再取得 token，把 token 跟會員綁一起，就不會有奇奇怪怪的情形出現。</strong></p><p>以下為 JS code：</p><h5 id=fcm-web-push-get-tokenjs>fcm-web-push-get-token.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=s1>&#39;serviceWorker&#39;</span> <span class=k>in</span> <span class=nx>navigator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>navigator</span><span class=p>.</span><span class=nx>serviceWorker</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;/sw.js&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>reg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// firebase methods，用同一支sw.js
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>messaging</span><span class=p>.</span><span class=nx>useServiceWorker</span><span class=p>(</span><span class=nx>reg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 註冊失敗
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;error: &#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>messaging</span><span class=p>.</span><span class=nx>requestPermission</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 先判斷cookies有沒有token，沒有再取token
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>ckv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/(?:(?:^|.*;\\s*)augustusWsPush\s*\=\s*([^;]*).*$)|^.*$/</span><span class=p>,</span> <span class=s2>&#34;$1&#34;</span><span class=p>)</span> <span class=o>||</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// cookies不存在，跟使用者要求通知權限
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>ckv</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 拿到token，firebase-messaging-sw.js 就會存 Service Workers 裡
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>messaging</span><span class=p>.</span><span class=nx>getToken</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>currentToken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// token存至firebase
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>currentToken</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>firebase</span><span class=p>.</span><span class=nx>database</span><span class=p>().</span><span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;pushUsers/&#39;</span> <span class=o>+</span> <span class=nx>id</span><span class=p>).</span><span class=nx>set</span><span class=p>({</span><span class=s1>&#39;token&#39;</span><span class=o>:</span> <span class=nx>currentToken</span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// token存至cookies
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span> <span class=o>=</span> <span class=s2>&#34;augustusWsPush=&#34;</span> <span class=o>+</span> <span class=nx>currentToken</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// cookies 已存在，從 cookies 取出後傳至 firebase
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>ckv</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=nx>firebase</span><span class=p>.</span><span class=nx>database</span><span class=p>().</span><span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;pushUsers/&#39;</span> <span class=o>+</span> <span class=nx>id</span><span class=p>).</span><span class=nx>set</span><span class=p>({</span><span class=s1>&#39;token&#39;</span><span class=o>:</span> <span class=nx>ckv</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;使用者未允許通知&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>裡面有一行<code>很重要</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>messaging</span><span class=p>.</span><span class=nx>useServiceWorker</span><span class=p>(</span><span class=nx>xxx</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>這是這次踩到的<code>坑</code>。</p><p>如果沒寫這行，就會發現網站存了 2 個 service worker，分別是 Firebase 的，以及我們自己的。這行可以讓 FCM 只存我們註冊的 sw.js，才可以在用 FCM 推播時，順利的執行推播及點擊後開啟指定的頁面。</p><p>成功的話，開啟 <code>index.html</code>，在開發人員工具的 Application → Service Workers，就會看見註冊了 sw.js 檔案：</p><p><img src=https://live.staticflickr.com/65535/52439127809_134d9e2d7f_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p><strong>註冊 sw.js 只能在 https 下，因此網域必須有S SL，不然會註冊失敗。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>messaging</span><span class=p>.</span><span class=nx>requestPermission</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>這行會跟使用者要允許通知，使用者按下允許後</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>messaging</span><span class=p>.</span><span class=nx>requestPermission</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>這行就會產生 FCM 的 token，之後就是存進 Firebase 跟 Cookies。<br>Firebase 上會看到以下：</p><p><img src=https://live.staticflickr.com/65535/52439308070_338f1a11b0_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>之後只要跑個迴圈，就可以一個個去發送 Web Push。</p><h3 id=發送-web-push>發送 Web Push</h3><p>這邊新增一個 admin.html 來當做發送 Web Push 的後台介面，直接用 Vue.js 抓每個 <code>input</code> 的值。</p><p><img src=https://live.staticflickr.com/65535/52438349427_3b8f4d712c_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>Web Push 如果要判斷成效，直接用 Google Analytics 的 utm 參數就可以了，所以後台欄位有給 utm 用的 3 個主要參數。<br>不含樣式的原始碼文末會附上 GitHub 網址。<br>在發送 Web Push 時，還要填入伺服器的金鑰，這也是從 Firebase 後台可以拿到。點小齒輪 → 專案設定 → Cloud Messaging，第一個「伺服器金鑰」的值就是了：</p><p><img src=https://live.staticflickr.com/65535/52439308040_f09728ee96_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>發送 Web Push 的 JS 如下，寫在 <code>admin.html</code> 裡：</p><h5 id=fcm-web-push-triggerjs>fcm-web-push-trigger.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>notification</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;title&#39;</span><span class=o>:</span> <span class=s1>&#39;web push標題&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;body&#39;</span><span class=o>:</span> <span class=s1>&#39;web push內文&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;badge&#39;</span><span class=o>:</span> <span class=s1>&#39;logo圖檔路徑&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;icon&#39;</span><span class=o>:</span> <span class=s1>&#39;logo圖檔路徑&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;click_action&#39;</span><span class=o>:</span> <span class=s1>&#39;https://www.domain.com.tw&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;data&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;url&#39;</span><span class=o>:</span> <span class=s1>&#39;https://www.domain.com.tw&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://fcm.googleapis.com/fcm/send&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;method&#39;</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;headers&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Authorization&#39;</span><span class=o>:</span> <span class=s1>&#39;key=從firebase上取得伺服器金鑰&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;body&#39;</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;data&#39;</span><span class=o>:</span> <span class=nx>notification</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;to&#39;</span><span class=o>:</span> <span class=s1>&#39;使用者的token&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>alert</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=接收-web-push>接收 Web Push</h3><p>接受 Web Push 有 2 種情況：</p><ol><li>使用者正開啟官網頁面</li><li>使用者沒有開啟官網頁面</li></ol><p>第一種情況，是在 index.js 下寫一個 <code>messaging.onMessage</code> 的 function 處理。<br>第二種情況，是在 sw.js 下寫一個 <code>messaging.setBackgroundMessageHandler</code> 的 function 處理。</p><h4 id=使用者正開啟官網頁面>使用者正開啟官網頁面</h4><p>官網正開啟的狀況下，屬於 JS 的 notification 功能，function 範例如下：</p><h5 id=fcm-web-push-notificationjs>fcm-web-push-notification.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>messaging</span><span class=p>.</span><span class=nx>onMessage</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>msgTitle</span> <span class=o>=</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>url</span> <span class=o>=</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>click_action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>notification</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Notification</span><span class=p>(</span><span class=nx>msgTitle</span><span class=p>,</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 點擊推播後要連去哪
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>notification</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><code>payload</code> 就是傳來的值，點擊後要導到的頁面就用 <code>location.href</code> 來處理。</p><h4 id=使用者沒有開啟官網頁面>使用者沒有開啟官網頁面</h4><p>使用者在上網，但沒有開啟官網的頁面，就是由之前註冊的 <code>sw.js</code> 處理，在 <code>sw.js</code> 加入以下：</p><h5 id=fcm-web-push-sw2js>fcm-web-push-sw2.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>click_action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 監聽notifiction點擊事件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;notificationclick&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>url</span> <span class=o>=</span> <span class=nx>click_action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>notification</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>waitUntil</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>clients</span><span class=p>.</span><span class=nx>matchAll</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;window&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=nx>windowClients</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 如果tab是開著的，就 focus 這個tab
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>windowClients</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>client</span> <span class=o>=</span> <span class=nx>windowClients</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>client</span><span class=p>.</span><span class=nx>url</span> <span class=o>===</span> <span class=nx>url</span> <span class=o>&amp;&amp;</span> <span class=s1>&#39;focus&#39;</span> <span class=k>in</span> <span class=nx>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>client</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 如果沒有，就新增tab
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>clients</span><span class=p>.</span><span class=nx>openWindow</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>clients</span><span class=p>.</span><span class=nx>openWindow</span><span class=p>(</span><span class=nx>click_action</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// FCM
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>messaging</span><span class=p>.</span><span class=nx>setBackgroundMessageHandler</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>icon</span><span class=o>:</span> <span class=s1>&#39;/logo/logo192.png&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>badge</span><span class=o>:</span> <span class=s1>&#39;/logo/logo192.png&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>click_action</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>click_action</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>self</span><span class=p>.</span><span class=nx>registration</span><span class=p>.</span><span class=nx>showNotification</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><code>click_action</code> 是點擊後要開啟的頁面網址，但要另外寫一個 <code>notificationclick</code> 來處理。</p><p><strong>這邊踩了一個坑，如果按照一般順序來寫，會先寫了 <code>messaging.setBackgroundMessageHandler</code> 後，再寫 <code>notificationclick</code>。然後就會發現，Chrome 上可以正常運作，但在 Firefox 上怎麼點就是不會開啟頁面。</strong></p><p>Google 了很久，才看到這篇：<a class=link href=https://stackoverflow.com/questions/53595019/service-worker-notificationclick-event-doesnt-focus-or-open-my-website-in-tab target=_blank rel=noopener>service worker notificationclick event doesn’t focus or open my website in tab</a></p><p><code>click_action</code> 是 Chrome 用的，如果 <code>messaging.setBackgroundMessageHandler</code> 先寫了，那 FCM 就會全部接收 Web Push 的功能，就不會讓原生的 <code>notificationclick</code> 事件被運作，因此 <code>notificationclick</code> 得寫在前，讓原生事件運作後，再執行 FCM 的事件。</p><h3 id=補充資源>補充資源</h3><p>有了發送、接收，基本上 Web Push 就可以順利運作了。<br>要注意的是 Web Push 只接受在 https 以下運行。<br>最後附上學習時參考的教學文，以及本篇的 GitHub 原始碼。</p><p>從建 Firebase 就開始教學的（英文）：<a class=link href=https://www.itwonders-web.com/blog/push-notification-using-firebase-demo-tutorial target=_blank rel=noopener>Tutorial: Web Push notification using Firebase</a></p><p><a class=link href=https://medium.com/@Whien/%E5%BB%BA%E7%AB%8B-service-worker-web-push-notification-firebase-push-notification%E5%AF%A6%E4%BD%9C%E7%B4%80%E9%8C%84-da5e0ffbead4 target=_blank rel=noopener>建立 Service Worker Web Push Notification — (Firebase Push Notification實作紀錄)</a></p><p><a class=link href=https://ithelp.ithome.com.tw/articles/10196898 target=_blank rel=noopener>Push Notification之成為訂閱用戶(Firebase實作)</a></p><p>Google 官方教學的原始碼：<a class=link href=https://github.com/GoogleChrome/samples/tree/gh-pages/push-messaging-and-notifications target=_blank rel=noopener>GitHub</a><br>Google 官方教學的功能示範：<a class=link href=https://web-push-book.gauntface.com/demos/notification-examples/ target=_blank rel=noopener>Notification Examples</a></p><hr></section><footer class=article-footer><section class=article-tags><a href=https://wayne-blog.com/tags/pwa/>pwa</a>
<a href=https://wayne-blog.com/tags/seo/>seo</a>
<a href=https://wayne-blog.com/tags/firebase/>firebase</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=https://wayne-blog.com/2022-08-17/seo-backlinks-building-guide/><div class=article-image><img src=https://live.staticflickr.com/65535/52290179402_693c7086dc_o.jpg loading=lazy data-key=seo-backlinks-building-guide data-hash=https://live.staticflickr.com/65535/52290179402_693c7086dc_o.jpg></div><div class=article-details><h2 class=article-title>SEO 反向連結建立：終極指南(2022)</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-blog-wayne.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Wayne's blog | 偉恩的部落格 | 技術博客</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://wayne-blog.com/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&(console.log("Check service worker register?"),navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("service worker registed.")}).catch(function(e){console.log("service worker registed fail. This happened: ",e)}));function toggleBtnScrollTop(){let t=document.documentElement.scrollTop||document.body.scrollTop;const e=document.getElementById("btnScrollTop");if(t){e&&!e.classList.contains("show")&&e.classList.add("show");return}e&&e.classList.contains("show")&&e.classList.remove("show")}window.addEventListener("scroll",toggleBtnScrollTop),document.addEventListener("DOMContentLoaded",toggleBtnScrollTop);function clickToScrollTop(){window.scrollTo({top:0,behavior:"smooth"})}function clickToMessenger(){window.open("//m.me/100278986238046","_blank")}</script><button id=btnScrollTop onclick=clickToScrollTop() title=回到頁頂>
<img src=https://wayne-blog.com/img/top_huf0c1dc16de3f1372c70e7aced5d60e6d_660_30x0_resize_box_3.png alt=scroll-top>
</button>
<button id=btnMessenger onclick=clickToMessenger() title="Facebook Messenger">
<img src=https://wayne-blog.com/img/messenger_hu3f63590c9d474cc4c51a145f9812597b_7669_50x0_resize_box_3.png alt="facebook messenger"></button></body></html>