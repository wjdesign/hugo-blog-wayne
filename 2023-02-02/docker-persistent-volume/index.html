<!doctype html><html lang=zh-tw dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Container 是在 Image 之上去創建的，Container 可以讀寫數據，而 Image 只能夠讀取，但是 Container 裡面所寫入的數據，只會存在 Container 裡面，如果刪除 Container，寫入的數據會全部消失。有一種需求，資料庫的 Container 會有數據的讀寫，在這種情況下，Docker 就需要數據持久化。"><meta name=keywords content="docker,persistent,volume,tmpfsMount,BindMount,tmpfs mount,bind mount,數據持久化,數據共享,share data,persistent data"><title>【Docker】數據持久化與數據共享 - tmpfsMount/BindMount/Volume</title>
<link rel=canonical href=https://wayne-blog.com/2023-02-02/docker-persistent-volume/><link rel=stylesheet href=https://wayne-blog.com/scss/style.min.e3f888c5dd2d8234c7284a9b45d1b5916903fb544644cac31c873b6488e8d7a0.css><script>!function(e,t,n,s,o,i,a){if(e.fbq)return;o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],i=t.createElement(n),i.async=!0,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","843131703668116"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=843131703668116&ev=PageView&noscript=1"></noscript><meta property="og:title" content="【Docker】數據持久化與數據共享 - tmpfsMount/BindMount/Volume"><meta property="og:description" content="Container 是在 Image 之上去創建的，Container 可以讀寫數據，而 Image 只能夠讀取，但是 Container 裡面所寫入的數據，只會存在 Container 裡面，如果刪除 Container，寫入的數據會全部消失。有一種需求，資料庫的 Container 會有數據的讀寫，在這種情況下，Docker 就需要數據持久化。"><meta property="og:url" content="https://wayne-blog.com/2023-02-02/docker-persistent-volume/"><meta property="og:site_name" content="Wayne's blog | 偉恩的部落格 | 技術博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="docker"><meta property="article:tag" content="docker-compose"><meta property="article:published_time" content="2023-02-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-02T00:00:00+00:00"><meta property="og:image" content="https://live.staticflickr.com/65535/52664455010_4e163f06ec_o.jpg"><meta name=twitter:site content="@4006wayne"><meta name=twitter:creator content="@4006wayne"><meta name=twitter:title content="【Docker】數據持久化與數據共享 - tmpfsMount/BindMount/Volume"><meta name=twitter:description content="Container 是在 Image 之上去創建的，Container 可以讀寫數據，而 Image 只能夠讀取，但是 Container 裡面所寫入的數據，只會存在 Container 裡面，如果刪除 Container，寫入的數據會全部消失。有一種需求，資料庫的 Container 會有數據的讀寫，在這種情況下，Docker 就需要數據持久化。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://live.staticflickr.com/65535/52664455010_4e163f06ec_o.jpg"><link rel="shortcut icon" href=https://live.staticflickr.com/65535/52275825736_808b1fd4a8_o.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-FG6KQD7H6C"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FG6KQD7H6C",{anonymize_ip:!1})}</script><link rel=stylesheet type=text/css href=./toastify/style.min.css><script type=text/javascript src=./toastify/index.js></script><script>const hackKey="hack",author="Wayne (偉恩)",link="https://wayne-blog.com/",source="Wayne's blog | 偉恩的部落格 | 技術博客",warningText="請重視著作權，商業轉載請聯繫作者獲得授權，非商業轉載請註明出處。",warningBackgroundColor="linear-gradient(to right, rgb(108 47 87), rgb(191 86 86))",successBackgroundColor="linear-gradient(to right, rgb(47 151 127), rgb(69 195 137))",ignoreTagNames=["INPUT"];window.addEventListener("keyup",function(e){if(document.activeElement&&ignoreTagNames.includes(document.activeElement.tagName))return;if(e.key&&e.key.toLowerCase()==="h"){let e={text:"",duration:1e3,destination:"",newWindow:!0,close:!0,gravity:"top",position:"center",stopOnFocus:!1,style:{borderRadius:"50em"}};const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(n.has(hackKey)){e.text="Hack模式已關閉",e.style.background=warningBackgroundColor,Toastify(e).showToast(),n.delete(hackKey),t.search=n.toString(),window.history.replaceState(null,"",t.toString());return}e.text="Hack模式已開啟",e.style.background=successBackgroundColor,Toastify(e).showToast(),n.set(hackKey,"1"),t.search=n.toString(),window.history.replaceState(null,"",t.toString())}}),window.addEventListener("copy",function(e){const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(!n.has(hackKey)){e.preventDefault();const t=document.getSelection();e.clipboardData.setData("text/plain",`${t.toString()}

作者：${author}
連結：${link}
來源：${source}
${warningText}`)}})</script><style>:root{--zh-font-family:"Microsoft JhengHei", "微軟正黑體";--code-font-family:Menlo, Monaco, Consolas, "Courier New"}</style><meta name=theme-color content="#57BCB9"><link rel=manifest href=./manifest.json><link rel=apple-touch-icon sizes=57x57 href=./apple-touch-icon-57x57.webp><link rel=apple-touch-icon sizes=114x114 href=./apple-touch-icon-114x114.webp><link rel=apple-touch-icon sizes=120x120 href=./apple-touch-icon-120x120.webp><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon-180x180.webp><link rel=apple-touch-icon sizes=192x192 href=./apple-touch-icon-192x192.webp><link rel=apple-touch-icon sizes=512x512 href=./apple-touch-icon-512x512.png><meta name=msvalidate.01 content="D1D0687C3DAA5A891295FC82A5EDD3B0"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=https://wayne-blog.com/><img src=https://wayne-blog.com/img/avatar2d.webp width=256 height=256 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🧧</span></figure><div class=site-meta><h1 class=site-name><a href=https://wayne-blog.com/>Wayne (偉恩)</a></h1><h2 class=site-description>軟體開發 | 網路工程 | 技術博客</h2></div></header><ol class=social-menu><li><a href=https://wayneblog.bobaboba.me target=_blank title=Bobaboba rel=me><svg width="16" height="25" viewBox="0 0 108 156" fill="none" xmlns="http://www.w3.org/2000/svg" class="ant-menu-item-icon"><g id="Frame" clip-path="url(#clip0_1286_9119)"><path id="Vector" d="M103.092 68.82c3.923-10.88 3.425-22.877-1.386-33.3898-4.8113-10.5128-13.5473-18.6939-24.3139-22.7695C66.6255 8.58519 54.6963 8.94396 44.1907 13.6589 33.6852 18.3738 25.4501 27.065 21.2715 37.848L103.092 68.82z" fill="#e3e7f5"/><path id="Vector_2" d="M20.6297 41.1675.0942412 133.077C-.0317631 133.774.0878744 134.493.432471 135.11.777068 135.727 1.325 136.203 1.98169 136.457L52.9429 155.789C53.6062 156.055 54.3425 156.073 55.0179 155.84 55.6933 155.607 56.2629 155.137 56.6233 154.517L101.337 71.7598C101.535 71.3808 101.649 70.9635 101.672 70.5363 101.694 70.109 101.626 69.6817 101.47 69.2836 101.314 68.8855 101.075 68.5258 100.769 68.2289 100.463 67.932 100.096 67.705 99.6951 67.5631L24.4802 39.0787C24.0918 38.9392 23.6786 38.8833 23.2674 38.9148 22.8561 38.9462 22.456 39.0642 22.093 39.2611S21.4122 39.7294 21.1601 40.0578 20.7273 40.7643 20.6297 41.1675z" fill="#f2f2f2"/><path id="Vector_3" d="M82.9934.252578 82.9758.245884C80.9074-.537125 78.5998.515063 77.8216 2.59602L48.9735 79.7314C48.1953 81.8123 49.2411 84.134 51.3094 84.917L51.3271 84.9237C53.3954 85.7067 55.703 84.6545 56.4813 82.5736L85.3293 5.43823C86.1076 3.35727 85.0618 1.03559 82.9934.252578z" fill="#ced8ed"/><path id="Vector_4" d="M104.866 63.6606 24.7538 33.3326C22.2172 32.3723 19.3869 33.6626 18.4324 36.2147L18.4258 36.2325C17.4713 38.7846 18.7541 41.632 21.2907 42.5923L101.403 72.9204C103.94 73.8806 106.77 72.5902 107.724 70.0381L107.731 70.0203C108.685 67.4682 107.403 64.6209 104.866 63.6606z" fill="#cbd3e8"/><path id="Vector_5" d="M89.6538 93.0834 56.7178 154.572C56.3574 155.192 55.7878 155.662 55.1124 155.895 54.437 156.129 53.7006 156.111 53.0374 155.844L2.07618 136.513C1.41948 136.259.87155 135.782.526954 135.165.182357 134.548.0627193 133.829.188724 133.133L15.4204 64.9219 89.6538 93.0834z" fill="#f8e0be"/><path id="Vector_6" d="M74.3088 11.125C77.2135 11.8219 79.9953 12.9619 82.5572 14.5052L69.2128 50.1868 60.2285 46.7876S74.6297 11.2579 74.3088 11.125z" fill="#e3e7f5"/><path id="Vector_7" d="M15.1374 125.272C17.7851 125.272 19.9315 123.112 19.9315 120.448 19.9315 117.784 17.7851 115.625 15.1374 115.625S10.3433 117.784 10.3433 120.448C10.3433 123.112 12.4897 125.272 15.1374 125.272z" fill="#d79b7a"/><path id="Vector_8" d="M15.3261 108.756C17.9738 108.756 20.1202 106.597 20.1202 103.933 20.1202 101.269 17.9738 99.1094 15.3261 99.1094S10.532 101.269 10.532 103.933C10.532 106.597 12.6784 108.756 15.3261 108.756z" fill="#d79b7a"/><path id="Vector_9" d="M23.0837 141.303c2.6477.0 4.7941-2.16 4.7941-4.82300000000001C27.8778 133.816 25.7314 131.656 23.0837 131.656S18.2896 133.816 18.2896 136.48C18.2896 139.143 20.436 141.303 23.0837 141.303z" fill="#d79b7a"/><path id="Vector_10" d="M58.9829 119.678c2.6477.0 4.7941-2.16 4.7941-4.82299999999999.0-2.664-2.1464-4.824-4.7941-4.824-2.6478.0-4.7942 2.16-4.7942 4.824C54.1887 117.518 56.3351 119.678 58.9829 119.678z" fill="#d79b7a"/><path id="Vector_11" d="M59.9643 138.022C62.612 138.022 64.7584 135.862 64.7584 133.198 64.7584 130.534 62.612 128.375 59.9643 128.375S55.1702 130.534 55.1702 133.198C55.1702 135.862 57.3166 138.022 59.9643 138.022z" fill="#d79b7a"/><path id="Vector_12" d="M41.3351 136.631C43.9829 136.631 46.1293 134.472 46.1293 131.808c0-2.66399999999999-2.1464-4.824-4.7942-4.824C38.6874 126.984 36.541 129.144 36.541 131.808 36.541 134.472 38.6874 136.631 41.3351 136.631z" fill="#d79b7a"/><path id="Vector_13" d="M50.5837 150.701C53.2314 150.701 55.3778 148.542 55.3778 145.878 55.3778 143.214 53.2314 141.055 50.5837 141.055S45.7896 143.214 45.7896 145.878C45.7896 148.542 47.936 150.701 50.5837 150.701z" fill="#d79b7a"/><path id="Vector_14" d="M35.7106 121.381C38.3584 121.381 40.5048 119.222 40.5048 116.558 40.5048 113.894 38.3584 111.734 35.7106 111.734 33.0629 111.734 30.9165 113.894 30.9165 116.558 30.9165 119.222 33.0629 121.381 35.7106 121.381z" fill="#d79b7a"/><path id="Vector_15" d="M68.8354 37.6381C67.5686 37.1053 66.5083 36.1721 65.8153 34.9795 65.7527 34.8551 65.7394 34.7115 65.778 34.5775 65.8165 34.4436 65.9042 34.3294 66.0231 34.2579 66.1435 34.1884 66.2861 34.1695 66.4203 34.205 66.5545 34.2405 66.6695 34.3277 66.7404 34.4477 66.7404 34.5996 68.7787 37.9797 72.0251 36.4985 72.0885 36.4533 72.1611 36.4229 72.2375 36.409 72.314 36.3952 72.3924 36.3984 72.4675 36.4185 72.5425 36.4387 72.6122 36.4755 72.6716 36.5259 72.731 36.5762 72.7785 36.6392 72.811 36.7102 72.8435 36.7812 72.86 36.8585 72.8594 36.9366 72.8588 37.0148 72.8409 37.0917 72.8073 37.1622 72.7737 37.2326 72.7251 37.2947 72.6649 37.3442 72.6047 37.3936 72.5345 37.429 72.4592 37.448 71.8991 37.7239 71.2894 37.8829 70.6666 37.9156 70.0439 37.9482 69.421 37.8539 68.8354 37.6381z" fill="#42210b"/><path id="Vector_16" d="M52.3767 34.5824c3.4921.0 6.3229-2.8481 6.3229-6.3615s-2.8308-6.3615-6.3229-6.3615-6.323 2.8481-6.323 6.3615 2.8309 6.3615 6.323 6.3615z" fill="#f2f2f2"/><path id="Vector_17" d="M46.3936 25.979C46.6783 25.1869 47.1165 24.4595 47.6829 23.8392 48.2493 23.2188 48.9326 22.7179 49.6929 22.3653 50.4533 22.0128 51.2757 21.8156 52.1124 21.7854 52.949 21.7551 53.7833 21.8922 54.5668 22.1889 55.3504 22.4857 56.0677 22.9361 56.6768 23.5139 57.286 24.0918 57.7751 24.7855 58.1157 25.555 58.4563 26.3245 58.6416 27.1543 58.6608 27.9964 58.6801 28.8385 58.5329 29.6761 58.2279 30.4605" fill="#51260e"/><path id="Vector_18" d="M53.4147 28.5224C53.2968 29.0523 53.0675 29.5504 52.742 29.9835 52.4164 30.4166 52.0024 30.7745 51.5277 31.0329 51.0531 31.2913 50.5289 31.4443 49.9905 31.4817 49.4521 31.519 48.9121 31.4396 48.4067 31.2492 47.9014 31.0587 47.4424 30.7614 47.0609 30.3773 46.6795 29.9933 46.3841 29.5315 46.1951 29.0229 46.0061 28.5143 45.9277 27.9709 45.9652 27.4292 46.0026 26.8875 46.1552 26.3602 46.4124 25.8828" fill="#47220d"/><path id="Vector_19" d="M87.4079 47.8559C90.9 47.8559 93.7309 45.0077 93.7309 41.4943 93.7309 37.981 90.9 35.1328 87.4079 35.1328c-3.492.0-6.3229 2.8482-6.3229 6.3615.0 3.5134 2.8309 6.3616 6.3229 6.3616z" fill="#f2f2f2"/><path id="Vector_20" d="M81.4246 39.2313C82.0304 37.6734 83.222 36.4183 84.741 35.7378 86.26 35.0572 87.9843 35.0059 89.5405 35.5952 91.0967 36.1845 92.3595 37.3671 93.0555 38.8864S93.8245 42.1397 93.2589 43.7129" fill="#51260e"/><path id="Vector_21" d="M88.446 41.8148C88.0132 42.6263 87.302 43.2519 86.445 43.5752 85.5879 43.8985 84.6434 43.8975 83.787 43.5724 82.9307 43.2473 82.2208 42.62 81.7897 41.8077 81.3586 40.9953 81.2355 40.0531 81.4434 39.1562" fill="#47220d"/></g><defs><clipPath id="clip0_1286_9119"><rect width="108" height="156" fill="#fff"/></clipPath></defs></svg></a></li><li><a href=https://www.facebook.com/wayne.blog.ga/ target=_blank title=Facebook rel=me><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><linearGradient id="CXanuwD9EGkBgTn76_1mxa" x1="9.993" x2="40.615" y1="-299.993" y2="-330.615" gradientTransform="matrix(1 0 0 -1 0 -290)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2aa4f4"/><stop offset="1" stop-color="#007ad9"/></linearGradient><path fill="url(#CXanuwD9EGkBgTn76_1mxa)" d="M24 4C12.954 4 4 12.954 4 24c0 10.028 7.379 18.331 17.004 19.777C21.981 43.924 22.982 41 24 41c.919.0 1.824 2.938 2.711 2.818C36.475 42.495 44 34.127 44 24 44 12.954 35.046 4 24 4z"/><path d="M27.707 21.169c0-1.424.305-3.121 1.757-3.121h4.283l-.001-5.617-.05-.852-.846-.114c-.608-.082-1.873-.253-4.206-.253-5.569.0-8.636 3.315-8.636 9.334v2.498H15.06v7.258h4.948V43.6C21.298 43.861 22.633 44 24 44c1.268.0 2.504-.131 3.707-.357V30.301h5.033l1.122-7.258h-6.155V21.169z" opacity=".05"/><path d="M27.207 21.169c0-1.353.293-3.621 2.257-3.621h3.783V12.46l-.026-.44-.433-.059c-.597-.081-1.838-.249-4.143-.249-5.323.0-8.136 3.055-8.136 8.834v2.998H15.56v6.258h4.948v13.874C21.644 43.876 22.806 44 24 44c1.094.0 2.16-.112 3.207-.281V29.801h5.104l.967-6.258h-6.072V21.169z" opacity=".05"/><path fill="#fff" d="M26.707 29.301h5.176l.813-5.258h-5.989v-2.874c0-2.184.714-4.121 2.757-4.121h3.283V12.46c-.577-.078-1.797-.248-4.102-.248-4.814.0-7.636 2.542-7.636 8.334v3.498H16.06v5.258h4.948v14.475C21.988 43.923 22.981 44 24 44c.921.0 1.82-.062 2.707-.182V29.301z"/></svg></a></li><li><a href=https://github.com/wjdesign target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/4006wayne target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=https://wayne-blog.com/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>關於本站</span></a></li><li><a href=https://wayne-blog.com/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>文章卷宗</span></a></li><li><a href=https://wayne-blog.com/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜尋檢索</span></a></li><li><a href=https://wayne-blog.com/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>相關連結</span></a></li><li><a href=https://wayne-blog.com/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分類檢索</span></a></li><li><a href=https://wayne-blog.com/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>標籤檢索</span></a></li><li><a href=https://wayne-blog.com/index.xml target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg><span>RSS Feed</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://wayne-blog.com/ selected>繁體中文</option><option value=https://wayne-blog.com/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>夜晚模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#tmpfsmount>tmpfsMount</a><ol><li><a href=#如何使用-tmpfsmount>如何使用 tmpfsMount？</a></li></ol></li><li><a href=#bindmount>BindMount</a><ol><li><a href=#如何使用-bindmount>如何使用 BindMount？</a></li></ol></li><li><a href=#volume>Volume</a><ol><li><a href=#volume-的優點>Volume 的優點</a></li><li><a href=#如何使用-volumes>如何使用 Volumes？</a></li><li><a href=#volume-的-2-種參數>Volume 的 2 種參數</a><ol><li><a href=#-v-參數>-v 參數</a></li><li><a href=#--mount-參數>&ndash;mount 參數</a></li></ol></li></ol></li><li><a href=#練習-用-docker-跑-mysql>練習： 用 Docker 跑 MySQL</a><ol><li><a href=#目標>目標</a></li><li><a href=#方法一-網路查找的標準步驟>方法一 (網路查找的標準步驟)</a></li><li><a href=#方法二-自行實驗的步驟過程>方法二 (自行實驗的步驟過程)</a></li></ol></li><li><a href=#docker-network>Docker Network</a><ol><li><a href=#docker-network-原理>Docker Network 原理</a></li><li><a href=#container-互相訪問>Container 互相訪問</a></li><li><a href=#network-映射>Network 映射</a></li></ol></li><li><a href=#docker-compose>Docker Compose</a><ol><li><a href=#docker-compose-是什麼>Docker Compose 是什麼？</a></li><li><a href=#使用-docker-composeyml>使用 docker-compose.yml</a><ol><li></li></ol></li><li><a href=#水平擴展和附載均衡附載平衡>水平擴展和附載均衡(附載平衡)</a><ol><li></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><a class=btnBack href=javascript:void(0) onclick=backEvent()><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-back" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 11l-4 4 4 4m-4-4h11a4 4 0 000-8h-1"/></svg><span class=btnBackText>BACK</span>
</a><script>function backEvent(){if(document.referrer.indexOf(window.location.host)!==-1){history.go(-1);return}window.location.href=window.location.origin}</script><header class=article-header><div class=article-image><a href=https://wayne-blog.com/2023-02-02/docker-persistent-volume/><img src=https://live.staticflickr.com/65535/52664455010_4e163f06ec_o.jpg loading=lazy alt="Featured image of post 【Docker】數據持久化與數據共享 - tmpfsMount/BindMount/Volume"></a></div><div class=article-details><header class=article-category><a href=https://wayne-blog.com/categories/docker/ style=background-color:#2496ed;color:#fff>Docker
</a><a href=https://wayne-blog.com/categories/docker-compose/ style=background-color:#b7c7d7;color:#fff>Docker Compose</a></header><div class=article-title-wrapper><h2 class=article-title><a href=https://wayne-blog.com/2023-02-02/docker-persistent-volume/>【Docker】數據持久化與數據共享 - tmpfsMount/BindMount/Volume</a></h2><h3 class=article-subtitle>Container 是在 Image 之上去創建的，Container 可以讀寫數據，而 Image 只能夠讀取，但是 Container 裡面所寫入的數據，只會存在 Container 裡面，如果刪除 Container，寫入的數據會全部消失。有一種需求，資料庫的 Container 會有數據的讀寫，在這種情況下，Docker 就需要數據持久化。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Feb 02, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 12 分鐘</time></div></footer></div></header><section class=article-content><style>.article-content p code{background-color:#f5f5f5;color:#ff3860}.focus{background:#f1e2e2;color:#d62c2c;padding:0 5px}</style><p><a class=link href=https://myapollo.com.tw/zh-tw/docker-volumes/ target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/articles/10241922 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://lufor129.medium.com/docker-%E4%B8%89-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9Cvolume-net-5f323965486 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://vincent.fishboneapps.com/2020/03/01/Docker-%E5%BF%AB%E9%80%9F%E5%AD%B8%E7%BF%92%E8%87%AA%E6%88%91%E6%8C%91%E6%88%B0-II-Day5/ target=_blank rel=noopener>參考網站</a><br><a class=link href=https://medium.com/@honglong/%E7%94%A8-docker-%E8%B7%91-mysql-d09c95c91da3 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://hub.docker.com/_/mysql target=_blank rel=noopener>參考網站</a></p><hr><h2 id=前言>前言</h2><p>在預設的 Docker daemon 下，我們常會遇到幾種情況：</p><ol><li>當該容器不再存在時，數據將不會持久保存，並且如果另一個 Process 需要它，則可能很難從容器中取出數據。</li><li>容器的可寫層與運行容器的主機緊密耦合。您不能輕易地將數據移動到其他地方。</li><li>寫入容器的可寫層需要 存儲驅動程序來管理文件系統。存儲驅動程序使用 Linux 內核提供聯合文件系統。與使用直接寫入主機文件系統的數據卷相比，這種額外的抽象降低了性能。</li></ol><p>Container 是在 Image 之上去創建的，Container 可以讀寫數據，而 Image 只能夠讀取，但是 Container 裡面所寫入的數據，只會存在 Container 裡面，如果刪除 Container，寫入的數據會全部消失。有一種需求，資料庫的 Container 會有數據的讀寫，在這種情況下，Docker 就需要數據持久化。</p><p><img src=https://live.staticflickr.com/65535/52663511452_6e029288d8_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>為了解決這些問題就誕生了 <strong>Docker Volume</strong>。</p><p>Container 裡面會有一個 Program，把檔案寫入 File System，這些檔案會存在 Container 的 Layer 中，我們把數據的部分，額外 Mount 一個 Volume，這樣一來，數據就會被永久保存；每個 Container 都是獨立且封閉的，但有時候我們會想要不透過進入 Container 就能改變內部的程式碼，或者是想要進行 Database 升級並保留原本資料，這時就需要Docker Volume 了。</p><p><img src=https://live.staticflickr.com/65535/52664454885_356f278c04_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>Docker 持久化數據的方案：</p><ul><li><strong>基於本地文件系統的 Volume</strong>：可以在執行 docker create 或是 docker run 的時，通過 -v 參數將主機目錄作為 Container 的 Volume，這部分功能便是基於本地系統的 Volume 管理。</li><li><strong>基於外掛的 Volume</strong>：支持第三方的儲存方案，例如：<strong>AWS</strong>。</li></ul><p>談到 Docker 容器的資料儲存(storage)問題，基本直覺就是透過掛載 <a class=link href=https://docs.docker.com/storage/volumes/ target=_blank rel=noopener>Volumes</a>，不過 Docker 的 Volumes 其實有 3 種不同類型(types)：</p><ol><li>tmpfsMount：主機的 memory。</li><li>BindMount：可以為主機路徑下任何地方。</li><li>Volume：Container 將 Volume 存放在 Docker area，以 Linux 來說預設為 /var/lib/docker/volume。</li></ol><p><img src=https://live.staticflickr.com/65535/52664454855_3c8e7f6a8c_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>大家常用的 <code>-v &lt;Host 路徑>:&lt;Container 路徑></code> 參數其實就是使用 <strong>BindMount</strong>，例如以下指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it -v /home/user:/data debian /bin/bash
</span></span></code></pre></td></tr></table></div></div><p>簡而言之，使用 <strong>BindMount</strong> 的 volume 其實就是透過 host machine 的檔案系統(filesystem)提供容器儲存的能力。</p><hr><h2 id=tmpfsmount>tmpfsMount</h2><p>不同於 Volume、BindMound，tmpfsMount 不需要實體路徑將資料儲存，他是暫時性地儲存在主機的記憶體當中，當 Container 停止時，就會移除資料，通常用來儲存暫存性資料以及敏感資料。</p><h3 id=如何使用-tmpfsmount>如何使用 tmpfsMount？</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name &lt;ContainerName&gt; -d --mount <span class=nv>type</span><span class=o>=</span>tmpfs,destination<span class=o>=</span>&lt;內部路徑&gt; -p 8100:8100 &lt;ImageName&gt;
</span></span></code></pre></td></tr></table></div></div><p>舉個例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name &lt;ContainerName&gt; -d --tmpfs &lt;內部路徑&gt; -p 8100:8100 &lt;ImageName&gt;
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=bindmount>BindMount</h2><p>BindMount 就是做映射 <code>docker run -v /home/aaa:/root/aaa</code>，可以將本地目錄和 Container 目錄做映射，如果本地目錄修改，Container 的數據內容也會修改，反之亦然。</p><h3 id=如何使用-bindmount>如何使用 BindMount？</h3><p><strong>舊版本 Window 版的坑</strong></p><p>window 版不能直接掛載，要先調一下設定。</p><ol><li>選擇要掛載的目錄</li><li>打開 Docker Desktop</li><li>General > share dirve 掛載相應路徑，該路徑底下的資料夾才能被掛載</li></ol><p><img src=https://live.staticflickr.com/65535/52663511602_07a06821d8_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>新版本 window desktop 可以直接掛載，指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -v &lt;外部絕對路徑&gt;:&lt;內部路徑&gt; &lt;ImageName&gt;
</span></span></code></pre></td></tr></table></div></div><p>舉例來說，我在 windows 電腦 <code>//e/program/Wayne/DockerExample</code> 底下放了 index.html，要映射給 <code>/usr/local/apache2/htdocs</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it -d --name Web_Vol -p 8081:80 -v //e/program/Wayne/DockerExample:/usr/local/apache2/htdocs httpd:2.4
</span></span></code></pre></td></tr></table></div></div><p>現在在外部修改就能直接影響到 Container 內部了。</p><p><img src=https://live.staticflickr.com/65535/52663511497_fd363c776a_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><blockquote><p>當使用 -v 在掛載路徑時，若該路徑不存在於本機，則會建立該路徑，如果將綁定到容器上的目錄不為空，那目錄現有的內容會被綁定的目錄給遮蓋。</p></blockquote><hr><h2 id=volume>Volume</h2><h3 id=volume-的優點>Volume 的優點</h3><p>前文簡單介紹 BindMount 後，接著來認識 Docker 官方更為推薦的 Volume 吧。</p><p>Volume 與 BindMount 最大的不同在於 Volume 是由 Docker 全權進行管理，因此 Volume 比起 BindMount 有幾個優點：</p><ul><li>Volumes 更好轉移(migration)與備份(backup)。</li><li>Volumes 能夠透過 Docker API 與 Docker CLI 進行管理與操作。</li><li>Volumes 可跨平台(Linux, Windows)。</li><li>Volumes 在 macOS 與 Windows 上效能表現較好。</li><li>Volumes 更加適合多個容器(Container)共享使用的情境。</li><li>Volumes 提供整合遠端或雲端儲存服務的能力（詳見 <a class=link href=https://docs.docker.com/engine/extend/ target=_blank rel=noopener>Docker plugin</a>），只要使用不同的 Volume driver 即可，例如可以安裝 <code>vieux/sshfs</code> plugin 掛載遠端 SSH 伺服器的檔案系統。</li></ul><p>基本上，如果你不知道用 Volume 比較好還是 BindMount 比較好，使用 Volume 就對了！</p><blockquote><p><a class=link href=https://github.com/docker-library/mysql/blob/c4d585301408223c27b024ce442b9bcebf0b1855/8.0/Dockerfile target=_blank rel=noopener>MySQL Docker file</a> 裡面有一行，<code>VOLUME /var/lib/mysql</code> 就是將數據存到虛擬主機的目錄，實現數據持久化，讓數據不會因為 Container 消失而消失。</p></blockquote><h3 id=如何使用-volumes>如何使用 Volumes？</h3><blockquote><p><code>-v</code> or <code>--mount</code></p></blockquote><ul><li><strong>創建一個 Volume</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume create &lt;VolumeName&gt;
</span></span></code></pre></td></tr></table></div></div><p>可以用 <code>-d</code> 來指定位置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume create &lt;VolumeName&gt; -d &lt;外部絕對路徑&gt;
</span></span></code></pre></td></tr></table></div></div><p>要是不 <code>-d</code> 指定特定空間，系統會自動幫你生成空間，然而具體會在電腦的哪裡呢？</p><p>Windows 版會在 <code>\\wsl$\docker-desktop-data\version-pack-data\community\docker\volumes</code></p><p><img src=https://live.staticflickr.com/65535/52664685473_2ee7860d66_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>Linux 版會在 <code>/var/lib/docker/volumes/</code></p><ul><li><strong>啟動 Container 並掛載 Volume 到指定路徑</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name &lt;ContainerName&gt; -d -v &lt;外部絕對路徑&gt;:&lt;內部路徑&gt; -p 8100:8100 &lt;ImageName&gt;
</span></span></code></pre></td></tr></table></div></div><p>舉個例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it -v myvolume:/data nginx /bin/bash
</span></span></code></pre></td></tr></table></div></div><p>進到容器內就可以發現路徑 <code>/data</code> 可以使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@1630d3b4ffb8:~# touch /data/hello.txt
</span></span><span class=line><span class=cl>root@1630d3b4ffb8:~# ls -alh /data
</span></span><span class=line><span class=cl>total 8.0K
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> root root 4.0K Mar <span class=m>18</span> 15:53 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>1</span> root root 4.0K Mar <span class=m>18</span> 15:51 ..
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root    <span class=m>0</span> Mar <span class=m>18</span> 15:53 hello.txt
</span></span></code></pre></td></tr></table></div></div><p>如果有在 Volume 內新增任何資料的話，也可以在 Docker Desktop 內看到：</p><p><img src=https://live.staticflickr.com/65535/52664454930_bbe8ff32c3_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>前文提及 Volume 可以共享，因此可以打開一個新的容器並且掛載同一個 Volume 試試：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker run -it -v myvolume:/data debian /bin/bash
</span></span><span class=line><span class=cl>root@12fa2630f490:/# ls /data
</span></span><span class=line><span class=cl>hello.txt
</span></span></code></pre></td></tr></table></div></div><p>上述結果可以看到新啟動的容器內不僅有 <code>/data</code> 資料夾，該資料夾底下也有先前在其他容器建立的檔案。</p><ul><li><strong>若想列出所有 Volumes</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume ls
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>若想查看 Volume 詳細資訊</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume inspect &lt;VolumeName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CreatedAt&#34;</span>: <span class=s2>&#34;2022-03-13T06:48:16Z&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Mountpoint&#34;</span>: <span class=s2>&#34;/var/lib/docker/volumes/myvolume/_data&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;myvolume&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>上述指令結果可以看到 Mountpoint，該資訊就是 Volume 實際儲存資料的路徑位置。</p><p>但如果是 macOS 的使用者就會發現找不到 <code>/var/lib/docker/</code> (no such file or directory: /var/lib/docker)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> /var/lib/docker/volumes/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cd: no such file or directory: /var/lib/docker/volumes/
</span></span></code></pre></td></tr></table></div></div><p>這是由於 macOS 的 Docker 是用 LinuxKit 模擬的，因此路徑又被包裝過一層，其大致在以下的路徑：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> ~/Library/Containers/com.docker.docker/Data/vms/0/
</span></span></code></pre></td></tr></table></div></div><p>可於上述資料夾內發現 1 個名稱為 tty 的檔案，用指令 <code>screen tty</code> 就能夠進入 LinuxKit 內，然後就能發現 <code>/var/lib/docker/volumes</code> 資料夾，然後就能順利找到相對應的 Volume 囉！</p><p>不過 Docker Desktop for Mac version 2.3.0.4 以後就沒有 <code>tty</code> 檔案了，但還是可以使用以下指令進入 Docker 的 host machine 並且找到 <code>/var/lib/docker/volumes</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --privileged --pid<span class=o>=</span>host debian nsenter -t <span class=m>1</span> -m -u -n -i sh
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ls /var/lib/docker/volumes/
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>若想移除 Volume</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume rm &lt;VolumeName&gt;
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=volume-的-2-種參數>Volume 的 2 種參數</h3><p>掛載 Volume 時，除了 <code>-v</code> 參數可以使用之外，還有 <code>--mount</code> 參數可以使用，基本上 2 者功能是相同的，但差別在於參數格式不一樣之外， <code>--mount</code> 可設定的選項也相較多一點。</p><h4 id=-v-參數>-v 參數</h4><p><code>-v</code> 的參數值是以 <code>:</code> 做為分隔的 3 個欄位值，分別是 <code>&lt;Volume名稱>:&lt;容器內的掛載路徑>:&lt;Volume選項></code>。</p><ul><li><code>&lt;Volume名稱></code>： 可以是 Docker 的 Volume 名稱，該名稱可以用指令 docker volume ls 列出，其值對應的是 VOLUME NAME 一欄。如果這邊用的是實際系統路徑的話，Docker 就會自動轉為使用 bind mount，而非 Volume。</li><li><code>&lt;容器內的掛載路徑></code>： 容器(Container)內的路徑。</li><li><code>&lt;Volume選項></code> 例如 <code>ro</code> 代表唯讀(read only)。</li></ul><p>例如掛載唯讀(read only)的 Volume：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it -v myvolume:/data:ro debian /bin/bash
</span></span></code></pre></td></tr></table></div></div><h4 id=--mount-參數>&ndash;mount 參數</h4><p><code>--mount</code> 參數則可以視為 <code>-v</code> 參數的進階版。</p><p><code>--mount</code> 更加口語(verbose)化，在 Volumes 的設定上都會明確以 <code>&lt;key>=&lt;value></code> 的形式進行設定（當 <code>&lt;key></code> 為 <code>readonly</code> 時，可以直接省略 <code>=&lt;value></code> 的部分），多個 key 值之間則以逗號(<code>,</code>)進行分割，而且設定的順序上並不像 <code>-v</code> 參數那般有順序上的要求。</p><p>目前可使用的 <code>&lt;key></code> 值有：</p><ul><li>source</li><li>destination</li><li>type</li><li>readonly</li><li>volume-driver</li><li>volume-opt</li></ul><p><strong>source</strong></p><p><code>source</code> 是欲掛載 Volume 的名稱，該名稱可以用指令 <code>docker volume ls</code> 列出，其值對應的是 <code>VOLUME NAME</code> 一欄。</p><p><strong>destination</strong></p><p><code>destination</code> 是容器(Container)內掛載 Volume 內的路徑。</p><p><strong>type</strong></p><p>其值可以是 <code>bind</code>、<code>volume</code>、<code>tmpfs</code> 其中 1 個，一般使用 volume 即可，是 Docker 推薦的方式；如果使用 bind 則代表使用 bind mounts；最後 1 種 tmpfs 則代表 tmpfs mount，通常 tmpfs 用以儲存非持久性(non-persistent)的資料，例如暫存檔案、快取(cache)等等，也可用以提升容器的效能，也由於 tmpfs 是非持久性(non-persistent)的儲存，所以當容器(container)關閉後，該 volume 內的資料也會跟著消失。</p><blockquote><p>If your container generates non-persistent state data, consider using a <a class=link href=https://docs.docker.com/storage/tmpfs/ target=_blank rel=noopener>tmpfs mount</a> to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer.</p></blockquote><p>建立一個 tmpfs 的 Volume 指令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume create -o <span class=nv>type</span><span class=o>=</span>tmpfs -o <span class=nv>device</span><span class=o>=</span>tmpfs &lt;VolumeName&gt;
</span></span></code></pre></td></tr></table></div></div><p>例如以下指令建立 1 個名為 mytmpfs 的 tmpfs volume：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume create -o <span class=nv>type</span><span class=o>=</span>tmpfs -o <span class=nv>device</span><span class=o>=</span>tmpfs mytmpfs
</span></span></code></pre></td></tr></table></div></div><p>除了新增 Volume 後掛載 tmpfs volume 之外，當然也可以直接以 <code>--mount</code> 參數方式掛載 tmpfs volume：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --mount <span class=nv>type</span><span class=o>=</span>tmpfs,destination<span class=o>=</span>/data debian /bin/bash
</span></span></code></pre></td></tr></table></div></div><p>上述指令其實等同於， Docker 也有提供 <code>--tmpfs</code> 參數可以使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --tmpfs /data debian /bin/bash
</span></span></code></pre></td></tr></table></div></div><p><strong>readonly</strong></p><p>將 Volume 設定為唯讀(read only)。等同於 <code>-v</code> 參數中的 <code>ro</code> 選項。</p><p>以 <code>--mount</code> 參數掛載唯讀 Volume 的範例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --mount <span class=nv>source</span><span class=o>=</span>myvolume,destination<span class=o>=</span>/data,readonly debian /bin/bash
</span></span></code></pre></td></tr></table></div></div><p><strong>volume-driver</strong></p><p>Docker 將儲存(storage)的概念抽象化為 driver (或稱驅動器)，透過使用不同的 driver 可以介接各式各樣的檔案系統，例如 NFS(Network File System)、SSHFS(SSH Filesystem) 甚至是 AWS S3 等等，預設是使用 <code>local</code> driver，也就是 <code>volume-driver=local</code>。</p><p>如果想使用其他 driver 可以查看以下文件：</p><ol><li><a class=link href=https://docs.docker.com/engine/extend/legacy_plugins/#volume-plugins target=_blank rel=noopener>Docker volume plugins</a> 或 <a class=link href="https://hub.docker.com/search?q=&amp;type=plugin&amp;category=volume" target=_blank rel=noopener>Available volume plugins</a></li><li><a class=link href=https://docs.docker.com/engine/extend/ target=_blank rel=noopener>Docker engine managed plugin system</a></li></ol><p>這些文件列出第三方提供的各種 Volume plugin 的安裝與使用方式之外，也紀錄如何使用 Docker 官方提供的指令(<code>docker plugin install &lt;pluginName></code>)安裝 Volume plugin 以及 Volume plugin 的開發方法。</p><p><strong>volume-opt</strong></p><p><code>volume-opt</code> 用以設定 Volume 相關的選項，<code>volume-opt</code> 的數量並沒有限制，端看 volume driver 提供哪些選項可以使用，詳細能夠使用的選項可以參考 <a class=link href=https://man7.org/linux/man-pages/man8/mount.8.html target=_blank rel=noopener>FILESYSTEM-SPECIFIC MOUNT OPTIONS</a> 章節。</p><p>值得注意的是 tmpfs 並不支援 volume-opt 的用法，如果 2 者合用就會出現以下錯誤：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cannot mix <span class=s1>&#39;volume-*&#39;</span> options with mount <span class=nb>type</span> <span class=s1>&#39;tmpfs&#39;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=練習-用-docker-跑-mysql>練習： 用 Docker 跑 MySQL</h2><h3 id=目標>目標</h3><p>希望 Database 在 Container 刪除後，還能留下來被新建立的 Container 重新使用，不會一起消失不見。</p><h3 id=方法一-網路查找的標準步驟>方法一 (網路查找的標準步驟)</h3><ol><li>建立存放 MySQL <code>/var/lib/mysql</code> 資料庫檔案的 <strong>Persistent Volume</strong>，命名為 <code>mysql-data</code>。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker create -v /var/lib/mysql --name mysql-data mysql:5.7.18
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>以剛建立出來的 Volume <code>mysql-data</code> 作為 storage 把 MySQL runner 跑起來。</li></ol><ul><li>指定 MySQL 版本為 5.7.18。</li><li>設定 <code>MYSQL_RANDOM_ROOT_PASSWORD=yes</code> 環境變數，讓 MySQL Docker 自動產生 MySQL root 帳號的亂數密碼。</li><li>命名為 <code>mysql-runner</code>。</li></ul><p>指令如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -p 3306:3306 -v /var/lib/mysql --volumes-from mysql-data --name mysql-runner -d -e <span class=nv>MYSQL_RANDOM_ROOT_PASSWORD</span><span class=o>=</span>yes mysql:5.7.18
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; d746048e41b7
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>以 Container ID 查詢 log 找到 MySQL 自動建立的亂數密碼。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker logs d746048e41b7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; Initializing database
</span></span><span class=line><span class=cl>&gt; ...
</span></span><span class=line><span class=cl>&gt; GENERATED ROOT PASSWORD: Aethov1phae2Ju5B
</span></span><span class=line><span class=cl>&gt; ...
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>再起一個臨時 Container 開 shell 跑 mysql-client，配合亂數密碼連進 mysql-runner 的 MySQL server，用完即丟。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --link mysql-runner:mysql --rm mysql sh -c <span class=s1>&#39;exec mysql -h &#34;$MYSQL_PORT_3306_TCP_ADDR&#34; -P &#34;$MYSQL_PORT_3306_TCP_PORT&#34; -u root -p &#34;Aethov1phae2Ju5B&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以用 <code>docker inspect</code> 找到 <code>mysql-runner</code> Container 的 IP，從 host 連進去。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql -h 172.17.0.20 -u root -P <span class=m>3306</span> -p Aethov1phae2Ju5B
</span></span></code></pre></td></tr></table></div></div><h3 id=方法二-自行實驗的步驟過程>方法二 (自行實驗的步驟過程)</h3><blockquote><p>第 1 ~ 9 步驟皆於自行測試階段，可直接跳到第 10 步驟。</p></blockquote><ol><li>創建一個 MySQL 的 Container，並使用沒有密碼的環境變數。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD mysql
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>這時候用 <code>docker ps</code> 查看 Container 會發現 <strong>mysql1</strong> 沒有啟動成功，使用 <code>docker logs mysql1</code> 查看，就會顯示要指定 <strong>MYSQL_ROOT_PASSWORD</strong>。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker logs mysql1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; 2020-03-01 02:36:05+00:00 <span class=o>[</span>Note<span class=o>]</span> <span class=o>[</span>Entrypoint<span class=o>]</span>: Entrypoint script <span class=k>for</span> MySQL Server 8.0.19-1debian9 started.
</span></span><span class=line><span class=cl>&gt; 2020-03-01 02:36:05+00:00 <span class=o>[</span>Note<span class=o>]</span> <span class=o>[</span>Entrypoint<span class=o>]</span>: Switching to dedicated user <span class=s1>&#39;mysql&#39;</span>
</span></span><span class=line><span class=cl>&gt; 2020-03-01 02:36:05+00:00 <span class=o>[</span>Note<span class=o>]</span> <span class=o>[</span>Entrypoint<span class=o>]</span>: Entrypoint script <span class=k>for</span> MySQL Server 8.0.19-1debian9 started.
</span></span><span class=line><span class=cl>&gt; 2020-03-01 02:36:06+00:00 <span class=o>[</span>ERROR<span class=o>]</span> <span class=o>[</span>Entrypoint<span class=o>]</span>: Database is uninitialized and password option is not specified
</span></span><span class=line><span class=cl>&gt;   You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>在創建 MySQL Container 的同時，也會新增一個 Volume，要將該 Volume 移除。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm mysql1
</span></span><span class=line><span class=cl>docker volume ls
</span></span><span class=line><span class=cl>docker volume rm <span class=o>[</span>Volume id<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>再次創建一個 MySQL 的 Container。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --name mysql1 -e <span class=nv>MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=o>=</span><span class=nb>true</span> mysql
</span></span></code></pre></td></tr></table></div></div><ol start=5><li>這時候我們可以去查看新增的 Volume 的細節，裡面就會看到這個 Volume 連結到本地的 <code>/var/lib/docker/volumes/[Volume id]/_data</code> 這個位置。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume ls
</span></span><span class=line><span class=cl>docker volume inspect <span class=o>[</span>Volume id<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ol start=6><li>我們在創建第二個 MySQL 的 Container。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --name mysql2 -e <span class=nv>MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=o>=</span><span class=nb>true</span> mysql
</span></span></code></pre></td></tr></table></div></div><ol start=7><li><p>這時候再 <code>docker volume ls</code>，就會發現新增了一個新增的 Volume。</p></li><li><p>把 Container 停止並刪除，再查看 Container 狀態就會發現沒有任何退出或在執行的 Container 了。</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker stop mysql1 mysql2
</span></span><span class=line><span class=cl>docker rm mysql1 mysql2
</span></span><span class=line><span class=cl>docker ps -a
</span></span></code></pre></td></tr></table></div></div><ol start=9><li>使用 <code>docker volume ls</code> 查看 Volume，之前新增的都還在，但是會發現命名太複雜，我們可以自定義 Volume 名稱，先把所有的 Volume 移除。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker volume rm <span class=o>[</span>volume1 id<span class=o>]</span> <span class=o>[</span>volume2 id<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><ol start=10><li>創建一個 MySQL 的 Container 並指定 Volume 名稱為 <code>mysql</code>，路徑為 <code>/var/lib/mysql</code>。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -v mysql:/var/lib/mysql --name mysql1 -e <span class=nv>MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=o>=</span><span class=nb>true</span> mysql
</span></span></code></pre></td></tr></table></div></div><ol start=11><li><p>使用 <code>docker volume ls</code> 查看 Volume，就會看到新增的 <code>mysql</code> Volume。</p></li><li><p>為了驗證 MySQL 的數據持久，我們進去 <code>mysql1</code> 的 Container 新增一個新的 database：</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 進入 mysql1 container</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mysql1 /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 登入 MySQL</span>
</span></span><span class=line><span class=cl>mysql -u root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列出 DB</span>
</span></span><span class=line><span class=cl>show databases<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 建立 DB</span>
</span></span><span class=line><span class=cl>create database docker<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exit<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></td></tr></table></div></div><ol start=13><li>停止並刪除 Container：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm -f mysql1
</span></span></code></pre></td></tr></table></div></div><ol start=14><li>創建一個新的 MySQL 的 Container，並連結到之前的 Volume：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -v mysql:/var/lib/mysql --name mysql2 -e <span class=nv>MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=o>=</span><span class=nb>true</span> mysql
</span></span></code></pre></td></tr></table></div></div><ol start=15><li>進去 <code>mysql2</code> 的 Container 查看 databases，會發現之前新增的 Database 還存在：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 進入 mysql2 container</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mysql2 /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 登入 MySQL</span>
</span></span><span class=line><span class=cl>mysql -u root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列出 DB</span>
</span></span><span class=line><span class=cl>show databases<span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=docker-network>Docker Network</h2><h3 id=docker-network-原理>Docker Network 原理</h3><p>每個 Container 會包含一項服務，如前端、後端、資料庫，Container 之間能不能互相溝通藉此串聯起一個更大的服務應用呢？ 可以的，以下講解 Docker Network 的簡單原理。</p><ul><li><code>docker network ls</code>： 查看所有網路。</li><li><code>docker network inspect &lt;NetworkName></code>： 檢視細部網路設定。</li></ul><p><img src=https://live.staticflickr.com/65535/52664513188_671448435a_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>查看所有網路可以發現默認有分成 host 與 bridge ，Bridge 是 Linux 的虛擬網路橋接技術，將 Bridge 打開可以發現裡面包含兩個 Container，也就是我上一個章節建立的 Web_App 與 Web_Vol，IP 位置分別是 <code>172.17.0.2</code>、<code>172.17.0.3</code>，詳細網路架構圖如下：</p><p><img src=https://live.staticflickr.com/65535/52663511587_6458dfbfb3_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>安裝 Docker 後會新增一個 Docker 網卡默認 IP 為 <code>172.17.0.1/16</code> (host)，他會接收來自本網卡(eth0)的轉發封包。新建立的 Container 則是會自動生成 IP <code>172.17.X.X</code> 依序排列下去。</p><h3 id=container-互相訪問>Container 互相訪問</h3><p>那 Container 的互相訪問很簡單，直接訪問 <code>172.17.X.X</code> 的 IP 就好了，我們來實驗看看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 進入container</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it Web_APP bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看docker 網路</span>
</span></span><span class=line><span class=cl>cat /etc/hosts
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安裝相關網路工具</span>
</span></span><span class=line><span class=cl>apt-get update
</span></span><span class=line><span class=cl>apt-get install curl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 測試去抓其他Container</span>
</span></span><span class=line><span class=cl>curl 172.17.0.3
</span></span></code></pre></td></tr></table></div></div><p>如下圖，本 Docker IP 為 <code>172.17.0.2</code>，可以成功抓到其他 Container 的資料。</p><p><img src=https://live.staticflickr.com/65535/52664513133_80dc1c8a93_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><h3 id=network-映射>Network 映射</h3><p>但是 Container 的 IP 為自動生成，我們的程式在部屬的時候不可能部屬上去後才改 IP。有一個好方法，做網路映射 <code>--link</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --link &lt;外部Container&gt;:&lt;內部Network名稱&gt; &lt;ImageName&gt;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 建立新的有連結的 APP 叫做 Web_Network</span>
</span></span><span class=line><span class=cl>docker run -it -d --name Web_Network -p 8082:80 --link Web_APP:Web_APP --link Web_Vol:Web_Vol httpd:2.4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 進入 Container</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it Web_Network bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 Network</span>
</span></span><span class=line><span class=cl>cat /etc/hosts
</span></span></code></pre></td></tr></table></div></div><p>可以看到 Network 自動多了兩個網路 IP，Web_APP 與 Web_Vol。</p><p><img src=https://live.staticflickr.com/65535/52663511547_bcde120e6f_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>直接透過名稱抓抓看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl Web_APP
</span></span><span class=line><span class=cl>curl Web_Vol
</span></span></code></pre></td></tr></table></div></div><p>成功獲得：</p><p><img src=https://live.staticflickr.com/65535/52664305944_6c11f2484f_o.png max-width=100% max-height=100% class=gallery-image loading=lazy></p><p>不過實務上也不會透過 <code>--link</code> 的方式來建立 Network 映射。更常使用的會是 docker-compose。</p><hr><h2 id=docker-compose>Docker Compose</h2><h3 id=docker-compose-是什麼>Docker Compose 是什麼？</h3><ol><li>多 Container 的 App 太麻煩</li></ol><ul><li>要 docker build image 或是從 Docker Hub pull Image</li><li>要創建多個 container</li><li>要管理這些 container (啟動和刪除)</li></ul><ol start=2><li>Docker Compose 是什麼</li></ol><ul><li>Docker Compose 是一個工具(基於 Docker 的命令列工具)</li><li>這個工具可以透過 <strong>YAML</strong> 定義多 Container 的 Docker 應用</li><li>通過一條命令就可以根據 <strong>YAML 文件</strong>的定義去創建或管理多個 Container</li></ul><ol start=3><li>默認文件：<strong>docker-compose.yml</strong>，三大概念：Services、Networks、Volumes</li><li>Services</li></ol><ul><li>一個 Service 代表一個 Container，這個 Container 可以從 Docker Hub Image 來創建，或是從本地的 Dockerfile build 出來的 Image 來創建</li><li>Services 的啟動類似 docker run，我們可以給其指定 Network 和 Volume</li><li>以下用 docker-compose 的 <strong>service</strong> 和 <strong>docker run</strong> 產生同樣的容器</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Docker Compose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:9.4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;db-data:/var/lib/postgresql/data&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>back-tier</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker run -d --network back-tier -v db-data:/var/lib/postgresql/data postgres:9.4</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=5><li>Volumes 和 Networks</li></ol><ul><li>在跟 services 一樣的級別底下會有 volumes 和 networks</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Docker Compose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>db-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>front-tier</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>back-tier</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker volume 與 docker network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker volume create db-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># docker network create -d bridge back-tier</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=6><li>範例：新增一個 WordPress 的 docker-compose.yml</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose 版本</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wordpress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>WORDPRESS_DB_HOST</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>WORDPRESS_DB_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>my-bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mysql:5.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_ROOT_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MYSQL_DATABASE</span><span class=p>:</span><span class=w> </span><span class=l>wordpress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>mysql-data:/var/lib/mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>my-bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mysql-data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>my-bridge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=使用-docker-composeyml>使用 docker-compose.yml</h3><ol><li>在虛擬機上安裝 docker-compose，按照<a class=link href=https://docs.docker.com/compose/install/ target=_blank rel=noopener>官方文件</a>進行安裝。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 下載 Docker Compose</span>
</span></span><span class=line><span class=cl>sudo curl -L <span class=s2>&#34;https://github.com/docker/compose/releases/download/1.25.4/docker-compose-</span><span class=k>$(</span>uname -s<span class=k>)</span><span class=s2>-</span><span class=k>$(</span>uname -m<span class=k>)</span><span class=s2>&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 給予權限</span>
</span></span><span class=line><span class=cl>sudo chmod +x /usr/local/bin/docker-compose
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>在剛剛建立 wordpress.yml 的資料夾啟動 Container，這邊的 -f 預設就是 docker-compose.yml，可以不填。</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f docker-compose.yml up
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># docker-compose up</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li><p>如果執行 <code>docker-compose up</code> 之後再使用 Command + C 退出會直接停止服務，所以可以讓指令在後台執行 <code>docker-compose up -d</code>，如果想要 debug 看 log，才會使用 <code>docker-compose up</code>。</p></li><li><p>docker-composer 相關指令：</p></li></ol><ul><li><code>docker-compose stop</code>： 會停止服務</li><li><code>docker-compose down</code>： 會刪除所有服務(包含 Cotainers、Images、Volumes 和 Networks)</li><li><code>docker-compose start</code>： 可以啟動服務</li><li><code>docker-compose ps</code>： 查看服務狀態</li><li><code>docker-compose images</code>： 查看所有 Images</li><li><code>docker-compose exec</code>： 對 Container 執行指令</li></ul><ol start=5><li><code>docker-compose exec</code> 和 <code>docker exec</code> 基本上是一樣的，執行以下指令可以直接進去 Container 裡：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose <span class=nb>exec</span> mysql bash
</span></span><span class=line><span class=cl>docker-compose <span class=nb>exec</span> wordpress bash
</span></span></code></pre></td></tr></table></div></div><ol start=6><li>將 wordpress 服務停止並刪除：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose down
</span></span></code></pre></td></tr></table></div></div><ol start=7><li>新增 docker-compose.yml。</li></ol><h5 id=docker-composeyml>docker-compose.yml</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_HOST</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=8><li>新增 Dockerfile。</li></ol><h5 id=dockerfile>Dockerfile</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:2.7</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>LABEL</span> <span class=nv>maintaner</span><span class=o>=</span><span class=s2>&#34;xxx@gmail.com&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install flask redis<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;app.py&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ol start=9><li>新增 app.py。</li></ol><h5 id=apppy>app.py</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>redis</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;REDIS_HOST&#39;</span><span class=p>,</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>),</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>redis</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Hello Container World! I have been seen </span><span class=si>%s</span><span class=s1> times and my hostname is </span><span class=si>%s</span><span class=s1>.</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>redis</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;hits&#39;</span><span class=p>),</span><span class=n>socket</span><span class=o>.</span><span class=n>gethostname</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ol start=10><li>使用 <code>docker-compose up</code> 就可以啟動服務了，這時候打開本地的瀏覽器就可以看到 flask 的頁面了。</li></ol><h3 id=水平擴展和附載均衡附載平衡>水平擴展和附載均衡(附載平衡)</h3><ol><li>用 docker-compose 的 <code>--scale</code> 啟動三個 web，但是會出現錯誤，會顯示 8080 已被佔用：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --scale<span class=o>=</span> <span class=nv>web</span><span class=o>=</span><span class=m>3</span> -d
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>修改 docker-compose.yml 把 <code>port</code> 刪除。</li></ol><h5 id=docker-composeyml-1>docker-compose.yml</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_HOST</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=3><li>這時候在分別執行以下命令，Container 就會被啟動：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d
</span></span><span class=line><span class=cl>docker-compose up --scale <span class=nv>web</span><span class=o>=</span><span class=m>3</span> -d
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>關閉所有的 Contaienr：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose down
</span></span></code></pre></td></tr></table></div></div><ol start=5><li>修改 docker-compose.yml，加上 <code>loadbalancer</code>。</li></ol><h5 id=docker-composeyml-2>docker-compose.yml</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>REDIS_HOST</span><span class=p>:</span><span class=w> </span><span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>dockercloud/haproxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>links</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock </span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol start=6><li>啟動 docker-compose：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><ol start=7><li>把網頁內容讀取出來 <code>curl 127.0.0.1:8080</code> 會返回 Container 的 ID：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>1</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span></code></pre></td></tr></table></div></div><ol start=8><li>然後把 web 服務擴展成 3 個：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --scale <span class=nv>web</span><span class=o>=</span><span class=m>3</span> -d
</span></span></code></pre></td></tr></table></div></div><ol start=9><li>再把網頁內容讀出來，會發現有 3 個 Container id 會輪流出現：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>2</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>3</span> <span class=nb>times</span> and my hostname is 923de444e90d.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>4</span> <span class=nb>times</span> and my hostname is 1fde842de3f1.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>5</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>6</span> <span class=nb>times</span> and my hostname is 923de444e90d.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>7</span> <span class=nb>times</span> and my hostname is 1fde842de3f1.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>8</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>9</span> <span class=nb>times</span> and my hostname is 923de444e90d.
</span></span></code></pre></td></tr></table></div></div><ol start=10><li>我們也可以把服務擴展成 5 台：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --scale <span class=nv>web</span><span class=o>=</span><span class=m>5</span> -d
</span></span></code></pre></td></tr></table></div></div><ol start=11><li>這時候直接 curl 10 次：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>for</span> i in <span class=sb>`</span>seq 10<span class=sb>`</span><span class=p>;</span> <span class=k>do</span> curl 127.0.0.1:8080<span class=p>;</span> <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>10</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>11</span> <span class=nb>times</span> and my hostname is 923de444e90d.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>12</span> <span class=nb>times</span> and my hostname is 1fde842de3f1.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>13</span> <span class=nb>times</span> and my hostname is 37c3b132c4bd.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>14</span> <span class=nb>times</span> and my hostname is c2e3df63ddec.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>15</span> <span class=nb>times</span> and my hostname is 5620b14f864a.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>16</span> <span class=nb>times</span> and my hostname is 923de444e90d.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>17</span> <span class=nb>times</span> and my hostname is 1fde842de3f1.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>18</span> <span class=nb>times</span> and my hostname is 37c3b132c4bd.
</span></span><span class=line><span class=cl>&gt; Hello Container World! I have been seen <span class=m>19</span> <span class=nb>times</span> and my hostname is c2e3df63ddec.
</span></span></code></pre></td></tr></table></div></div><ol start=12><li>同樣地，也可以減少擴展：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up --scale <span class=nv>web</span><span class=o>=</span><span class=m>3</span> -d
</span></span></code></pre></td></tr></table></div></div><ol start=13><li>Docker Compose 是用於本地開發的一個工具，並不適合用於 Production，它就是為了方便在本地看部署的結果。</li></ol><hr></section><footer class=article-footer><section class=article-tags><a href=https://wayne-blog.com/tags/docker/>docker</a>
<a href=https://wayne-blog.com/tags/docker-compose/>docker-compose</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=https://wayne-blog.com/2023-01-31/docker-private-registry/><div class=article-image><img src=https://live.staticflickr.com/65535/52660201816_22c917dc9a_o.png loading=lazy data-key=docker-private-registry data-hash=https://live.staticflickr.com/65535/52660201816_22c917dc9a_o.png></div><div class=article-details><h2 class=article-title>【Docker】建立私有 Docker Registry</h2></div></a></article><article class=has-image><a href=https://wayne-blog.com/2022-12-04/docker-compose-link-external-comtainer/><div class=article-image><img src=https://live.staticflickr.com/65535/52565233288_251b1a5202_o.jpg loading=lazy data-key=docker-compose-link-external-comtainer data-hash=https://live.staticflickr.com/65535/52565233288_251b1a5202_o.jpg></div><div class=article-details><h2 class=article-title>Docker Compose 鏈接外部容器的幾種方式</h2></div></a></article><article class=has-image><a href=https://wayne-blog.com/2022-12-09/dotnet-core-docker-note-4/><div class=article-image><img src=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png loading=lazy data-key=dotnet-core-docker-note-4 data-hash=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png></div><div class=article-details><h2 class=article-title>ASP.NET Core Docker 筆記 4 - ASP.NET Core 網站容器化經驗分享</h2></div></a></article><article class=has-image><a href=https://wayne-blog.com/2022-12-08/dotnet-core-docker-note-3/><div class=article-image><img src=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png loading=lazy data-key=dotnet-core-docker-note-3 data-hash=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png></div><div class=article-details><h2 class=article-title>ASP.NET Core Docker 筆記 3 - 共用 Nginx 容器與 Certbot 整合</h2></div></a></article><article class=has-image><a href=https://wayne-blog.com/2022-12-07/dotnet-core-docker-note-2/><div class=article-image><img src=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png loading=lazy data-key=dotnet-core-docker-note-2 data-hash=https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png></div><div class=article-details><h2 class=article-title>ASP.NET Core Docker 筆記 2 - 組合容器建構系統</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-blog-wayne.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Wayne's blog | 偉恩的部落格 | 技術博客</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://wayne-blog.com/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&(console.log("Check service worker register?"),navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("service worker registed.")}).catch(function(e){console.log("service worker registed fail. This happened: ",e)}));function toggleBtnScrollTop(){let t=document.documentElement.scrollTop||document.body.scrollTop;const e=document.getElementById("btnScrollTop");if(t){e&&!e.classList.contains("show")&&e.classList.add("show");return}e&&e.classList.contains("show")&&e.classList.remove("show")}window.addEventListener("scroll",toggleBtnScrollTop),document.addEventListener("DOMContentLoaded",toggleBtnScrollTop);function clickToScrollTop(){window.scrollTo({top:0,behavior:"smooth"})}function clickToMessenger(){window.open("//m.me/100278986238046","_blank")}</script><button id=btnScrollTop onclick=clickToScrollTop() title=回到頁頂>
<img src=https://wayne-blog.com/img/top_huf0c1dc16de3f1372c70e7aced5d60e6d_660_30x0_resize_box_3.png alt=scroll-top>
</button>
<button id=btnMessenger onclick=clickToMessenger() title="Facebook Messenger">
<img src=https://wayne-blog.com/img/messenger_hu3f63590c9d474cc4c51a145f9812597b_7669_50x0_resize_box_3.png alt="facebook messenger"></button></body></html>