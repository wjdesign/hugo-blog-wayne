<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>.NET Core on Wayne's blog | å‰æ©çš„éƒ¨è½æ ¼ | æŠ€è¡“åšå®¢</title><link>https://wayne-blog.com/categories/dotnet-core/</link><description>Recent content in .NET Core on Wayne's blog | å‰æ©çš„éƒ¨è½æ ¼ | æŠ€è¡“åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Fri, 24 Mar 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://wayne-blog.com/categories/dotnet-core/index.xml" rel="self" type="application/rss+xml"/><item><title>é—œæ–¼ ASP.NET Core 7.0 çš„å•Ÿå‹•è¨­å®šæª” (Launch Settings)</title><link>https://wayne-blog.com/2023-03-24/dotnet-core-v7-launch-profile/</link><pubDate>Fri, 24 Mar 2023 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2023-03-24/dotnet-core-v7-launch-profile/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52767686731_8692b4f919_o.jpg" alt="Featured image of post é—œæ–¼ ASP.NET Core 7.0 çš„å•Ÿå‹•è¨­å®šæª” (Launch Settings)" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
.text-center {
text-align: center !important;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://learn.microsoft.com/zh-tw/aspnet/core/fundamentals/environments?view=aspnetcore-7.0" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://learn.microsoft.com/zh-tw/aspnet/core/release-notes/aspnetcore-7.0?view=aspnetcore-7.0" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://stackoverflow.com/a/51801622/910074" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.poychang.net/visual-studio-launch-settings-iis-express-iis-project-executable/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.miniasp.com/post/2023/03/03/Understanding-ASP-NET-Core-7-Launch-Profile" target="_blank" rel="noopener"
>è½‰è¼‰è‡ªç¶²ç«™&lt;/a>&lt;/p>
&lt;p>ç”±æ–¼ ASP.NET Core 7.0 èˆ‡ ASP.NET Core 6.0 çš„å°ˆæ¡ˆç¯„æœ¬ä¸­çš„å•Ÿå‹•è¨­å®šæª”(Launch Settings)æœ‰äº›è¨±ä¸åŒï¼Œæ‰€ä»¥ä¾†æ•´ç†ä¸€ä¸‹ç›¸é—œçŸ¥è­˜ï¼Œæ›´å¥½çš„èªè­˜é€™å€‹ &lt;code>Properties\launchSettings.json&lt;/code> æª”æ¡ˆã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å…ˆçœ‹çœ‹-propertieslaunchsettingsjson-çš„å·®ç•°">å…ˆçœ‹çœ‹ Properties\launchSettings.json çš„å·®ç•°&lt;/h2>
&lt;p>å…ˆç”¨ dotnet new mvc åœ¨ &lt;code>ASP.NET Core 6.0&lt;/code> èˆ‡ &lt;code>ASP.NET Core 7.0&lt;/code> ç”¢ç”Ÿä¸€æ¨£çš„å°ˆæ¡ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 6.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir projectV6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> projectV6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet new globaljson --sdk-version 6.0.100 --roll-forward latestFeature
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet new mvc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 7.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir projectV7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> projectV7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet new globaljson --sdk-version 7.0.100 --roll-forward latestFeature
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet new mvc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”±æ–¼å°ˆæ¡ˆç¯„æœ¬ä¸åŒï¼Œå°ˆæ¡ˆå…§çš„ &lt;code>Properties\launchSettings.json&lt;/code> æª”æ¡ˆå…§å®¹å…¶å¯¦ä¸å¤ªä¸€æ¨£ï¼š&lt;/p>
&lt;h3 id="aspnet-core-60">ASP.NET Core 6.0&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;iisSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;windowsAuthentication&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;anonymousAuthentication&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;iisExpress&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://localhost:22303&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sslPort&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">44378&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;profiles&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;m1&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://localhost:7007;http://localhost:5183&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;IIS Express&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IISExpress&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="aspnet-core-70">ASP.NET Core 7.0&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;iisSettings&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;windowsAuthentication&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;anonymousAuthentication&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;iisExpress&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://localhost:9601&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sslPort&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">44330&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;profiles&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://localhost:5041&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;https&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://localhost:7068;http://localhost:5041&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;IIS Express&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;IISExpress&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¾ä¸Šè¿°å…§å®¹ä½ å¯ä»¥å¾ˆæ¸…æ¥šçš„ç™¼ç¾ &lt;code>ASP.NET Core 6.0&lt;/code> èˆ‡ &lt;code>ASP.NET Core 7.0&lt;/code> æœ‰ä»¥ä¸‹ 2 é»å·®ç•°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>ASP.NET Core 6.0&lt;/code> çš„ &lt;code>profiles&lt;/code> åªæœ‰å…©å€‹ï¼Œä½†æ˜¯ &lt;code>ASP.NET Core 7.0&lt;/code> çš„ &lt;code>profiles&lt;/code> å»æœ‰ä¸‰å€‹ï¼&lt;/li>
&lt;li>&lt;code>ASP.NET Core 6.0&lt;/code> çš„ç¬¬ä¸€å€‹ Profile é è¨­åç¨±ç‚ºã€Œå°ˆæ¡ˆåç¨±ã€(&lt;code>projectV6&lt;/code>)ï¼Œè€Œ ASP.NET Core 7.0 çš„ç¬¬ä¸€å€‹ Profile åç¨±å»æ˜¯ &lt;code>http&lt;/code>ï¼Œè€Œä¸”é‚„å¤šå‡ºä¸€å€‹ &lt;code>https&lt;/code> è¨­å®šæª”ã€‚&lt;/li>
&lt;/ol>
&lt;p>å…¶å¯¦åœ¨ &lt;code>ASP.NET Core 6.0&lt;/code> ä»¥å‰ï¼Œæ‰€æœ‰çš„å°ˆæ¡ˆç¯„æœ¬ä¸­ç¬¬ä¸€å€‹ Profile é è¨­åç¨±éƒ½ç‚ºã€Œ&lt;strong>å°ˆæ¡ˆåç¨±&lt;/strong>ã€ï¼Œæ‰€ä»¥å…¶å¯¦å¤§å®¶å°é€™å€‹åå­—æ²’æœ‰ä»€éº¼æ„Ÿè¦ºï¼Œç›´åˆ° &lt;code>ASP.NET Core 7.0&lt;/code> åšå‡ºäº†æ”¹è®Šï¼Œé€™æ‰æœ‰äººç™¼ç¾åŸä¾†é€™æ±è¥¿çš„ç”¨é€”ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ä¸è¼‰å…¥å•Ÿå‹•è¨­å®šæª”">ä¸è¼‰å…¥å•Ÿå‹•è¨­å®šæª”&lt;/h2>
&lt;p>å¾ ASP.NET Core 6.0 é–‹å§‹ï¼Œé€é &lt;code>dotnet new&lt;/code> å°ˆæ¡ˆç¯„æœ¬æ‰€å»ºç«‹çš„ ASP.NET Core å°ˆæ¡ˆï¼Œé è¨­éƒ½ä¸æœƒç¹¼çºŒä½¿ç”¨æ—©æœŸçš„ Port &lt;code>5000&lt;/code> (http) èˆ‡ Port &lt;code>5001&lt;/code> (https)ï¼Œå¯èƒ½æ˜¯å› ç‚ºå¤šå°ˆæ¡ˆçš„æ¶æ§‹ä¸‹å¤ªå®¹æ˜“è¡çªï¼Œè€Œä¸”å¤ªå¤šäººä¸æ¸…æ¥šå•Ÿå‹•è¨­å®šæª”çš„å­˜åœ¨ï¼Œæ‰€ä»¥å°±æ”¹æˆç”¨äº‚æ•¸çš„ Port åŸ è™Ÿã€‚&lt;/p>
&lt;p>ä½†æ˜¯äº‚æ•¸çš„ Port åŸ è™Ÿå…¶å¯¦å¾ˆé›£å¯«æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ç‚ºäº†è®“å­¸å“¡æª¢æ¸¬è‡ªå·±æ˜¯å¦æœ‰æˆåŠŸè£å¥½ .NET SDK å·¥å…·ï¼Œæˆ‘æœƒé€™æ¨£å¯«ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å»ºç«‹ä¸¦é€²å…¥è³‡æ–™å¤¾&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir projectV7 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> projectV7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å»ºç«‹ ASP.NET Core MVC å°ˆæ¡ˆç¯„æœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet new mvc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å•Ÿå‹•ç¶²ç«™ä¸¦å¿½ç•¥å•Ÿå‹•è¨­å®šæª”&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet run --no-launch-profile
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™è£¡çš„ &lt;code>--no-launch-profile&lt;/code> å°±æ˜¯é¿å… &lt;code>dotnet new&lt;/code> å»è®€å–å°ˆæ¡ˆä¸­çš„ &lt;code>Properties\launchSettings.json&lt;/code> å•Ÿå‹•è¨­å®šæª”ï¼Œè€Œ .NET Runtime çš„ &lt;code>dotnet run&lt;/code> å‘½ä»¤ï¼Œåœ¨æ²’æœ‰è¼‰å…¥å•Ÿå‹•è¨­å®šæª”çš„æƒ…æ³ä¸‹ï¼Œåœ¨ &lt;code>ASP.NET Core 6.0&lt;/code> èˆ‡ &lt;code>ASP.NET Core 7.0&lt;/code> æœ‰ç´°å¾®çš„å·®ç•°ï¼š&lt;/p>
&lt;ul>
&lt;li>é è¨­ ASP.NET Core 6.0 ç¶²ç«™æœƒç›£è½ Port &lt;code>5000&lt;/code> (http) èˆ‡ Port &lt;code>5001&lt;/code> (https)ã€‚&lt;/li>
&lt;li>é è¨­ ASP.NET Core 7.0 ç¶²ç«™æœƒç›£è½ Port &lt;code>5000&lt;/code> (http)ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç”±æ–¼ ASP.NET Core çš„ TLS è‡ªç°½æ†‘è­‰é è¨­åªæœ‰ä¸€å¹´æ•ˆæœŸï¼Œæ¯å¹´éƒ½è¦æ›´æ–°ï¼Œé›–ç„¶æ›´æ–°å¾ˆç°¡å–®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet dev-certs https --clean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet dev-certs https --trust
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‡‰è©²æ˜¯æœ‰å¾ˆå¤šäººæä¸å®š &lt;code>https&lt;/code> å•é¡Œï¼Œæ‰è®“å¾®è»Ÿæ±ºå®šé™ä½é–‹ç™¼é–€æª»ï¼Œç›´æ¥æŠŠé è¨­ https çš„ binding ç§»é™¤ï¼&lt;/p>
&lt;hr>
&lt;h2 id="å•Ÿå‹•è¨­å®šæª”çš„ç”¨æ³•">å•Ÿå‹•è¨­å®šæª”çš„ç”¨æ³•&lt;/h2>
&lt;p>æˆ‘å€‘åœ¨åŸ·è¡Œ &lt;code>dotnet run&lt;/code> çš„æ™‚å€™ï¼Œåªè¦æ²’ç‰¹åˆ¥æŒ‡å®š&lt;strong>å•Ÿå‹•è¨­å®šæª”&lt;/strong>ï¼Œé è¨­å°±æœƒè‡ªå‹•è¼‰å…¥ &lt;code>Properties\launchSettings.json&lt;/code> è¨­å®šæª”ä¸­çš„&lt;code>ç¬¬ä¸€å€‹ profiles&lt;/code> ä¸­çš„è¨­å®šï¼Œç”±æ–¼ ASP.NET Core 7.0 çš„ã€Œç¬¬ä¸€å€‹ã€æ˜¯ &lt;code>http&lt;/code> é€™å€‹åå­—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;profiles&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;http&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://localhost:5041&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰€ä»¥ç•¶ç¶²ç«™å•Ÿå‹•æ™‚ï¼Œæˆ‘å€‘çš„ &lt;code>applicationUrl&lt;/code> é è¨­å°±åªæœ‰ &lt;code>http&lt;/code> çš„ç¶²å€è€Œå·²ï¼Œå› æ­¤ç¶²ç«™å•Ÿå‹•æ™‚ä¸¦ä¸æœƒæœ‰ &lt;code>https&lt;/code> å¯ä»¥æ¸¬è©¦ï¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Building...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Now listening on: http://localhost:5041
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Application started. Press Ctrl+C to shut down.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Hosting environment: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Content root path: G:&lt;span class="se">\P&lt;/span>rojects&lt;span class="se">\p&lt;/span>rojectV7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‚£å¦‚æœæˆ‘å€‘ä¹Ÿæƒ³æ¸¬è©¦ &lt;code>https&lt;/code> ç¶²å€æ€éº¼è¾¦ï¼Œé€™æ™‚ä½ å°±å¯ä»¥é¸æ“‡ &lt;code>Properties\launchSettings.json&lt;/code> è¨­å®šæª”ä¸­çš„&lt;code>ç¬¬äºŒå€‹ profiles&lt;/code> ä¸­çš„è¨­å®šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;profiles&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;https&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://localhost:7068;http://localhost:5041&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶å•Ÿå‹•çš„æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet run --launch-profile &lt;span class="s2">&amp;#34;https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æˆ–è€…å¯ä»¥ç°¡å¯«æˆé€™æ¨£:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dotnet run -lp &amp;#34;https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet run --launch-profile &lt;span class="s2">&amp;#34;https&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Building...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Now listening on: https://localhost:7068
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Now listening on: http://localhost:5041
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Application started. Press Ctrl+C to shut down.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Hosting environment: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Content root path: G:&lt;span class="se">\P&lt;/span>rojects&lt;span class="se">\p&lt;/span>rojectV7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="æ·±å…¥ç­è§£å•Ÿå‹•è¨­å®šæª”">æ·±å…¥ç­è§£å•Ÿå‹•è¨­å®šæª”&lt;/h2>
&lt;p>åœ¨å•Ÿå‹•è¨­å®šæª”ä¸­æœ‰å€‹ &lt;code>launchBrowser&lt;/code> å±¬æ€§ï¼Œé è¨­ç‚º &lt;code>true&lt;/code>ï¼Œå¾å­—é¢ä¸Šä¾†çœ‹ï¼Œå°±æ˜¯ã€Œ&lt;strong>å•Ÿå‹•ç€è¦½å™¨&lt;/strong>ã€çš„æ„æ€ã€‚ä½†å…¶å¯¦æˆ‘å€‘ç”¨ &lt;code>dotnet run&lt;/code> ä¸¦ä¸æœƒå› ç‚º &lt;code>launchBrowser&lt;/code> ç‚º &lt;code>true&lt;/code> å°±é–‹å•Ÿç¶²é ï¼Œè€Œæ˜¯è¦é€é &lt;code>dotnet watch&lt;/code> å‘½ä»¤å•Ÿå‹•ç¶²ç«™æ‰æœƒçœŸçš„å•Ÿå‹•ç€è¦½å™¨ä¸¦é–‹å•Ÿç¶²é ï¼&lt;/p>
&lt;p>å¦ä¸€æ–¹é¢ï¼Œä½ å¯èƒ½æœƒç™¼ç¾æˆ‘å€‘åœ¨ Visual Studio 2022 è£¡é¢æ¯æ¬¡å•Ÿå‹•ç¶²ç«™éƒ½æœƒé–‹å•Ÿç¶²é ï¼Œé€™æ™‚æˆ‘å…¶å¯¦ä¹Ÿæœƒè¦ºå¾—é€™å€‹è¨­è¨ˆå¾ˆç…©ï¼Œæ¯æ¬¡éƒ½ä¸€ç›´ä¸æ–·çš„é–‹å•Ÿæ–°é ç±¤ï¼Œå…¶å¯¦è »æƒ±äººçš„ã€‚è€Œé—œæ‰çš„æ–¹æ³•ï¼Œå°±æ˜¯èª¿æ•´å•Ÿå‹•è¨­å®šæª”ä¸­çš„ &lt;code>launchBrowser&lt;/code> å±¬æ€§ï¼Œèª¿æ•´ç‚º &lt;code>false&lt;/code> å³å¯ï¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;profiles&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;https&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Project&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://localhost:7068;http://localhost:5041&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦å¤–é‚„æœ‰ä¸€å€‹ &lt;code>dotnetRunMessages&lt;/code> ä¹Ÿæ˜¯å€‹è¬ä¸€èˆ¬çš„å­˜åœ¨ï¼Œå®Œå…¨æ²’æœ‰æ–‡ä»¶èªªæ˜ï¼Œè€Œé€™å€‹è¨­å®šä¹Ÿç¢ºå¯¦æ²’å¤ªå¤šå­˜åœ¨æ„Ÿï¼å„ä½å¯ä»¥çœ‹ä¸‹åœ–å·®ç•°ä¹‹è™•ï¼Œåªæœ‰åœ¨ &lt;code>dotnet run&lt;/code> å•Ÿå‹•çš„æ™‚å€™æœ‰éå¸¸ç´°å¾®çš„å·®ç•°è€Œå·²ã€‚æˆ‘å€‘åœ¨é€é &lt;code>dotnet run&lt;/code> å•Ÿå‹•ç¶²ç«™æ™‚ï¼Œç”±æ–¼è¦å…ˆ &lt;code>dotnet build&lt;/code> éæ‰èƒ½çœŸæ­£ Run èµ·ä¾†ï¼Œè€Œé€™æ®µæ™‚é–“å¤§æ¦‚æœƒè·‘å€‹ 2 ~ 3 ç§’å·¦å³ï¼Œå¦‚æœåœ¨ &lt;code>dotnetRunMessages&lt;/code> ç‚º &lt;code>true&lt;/code> æ™‚ï¼Œåœ¨ Console æœƒå„ªå…ˆå‡ºç¾ä¸€å€‹ &lt;strong>Building&amp;hellip;&lt;/strong> å­—æ¨£ï¼Œè®“ä½ çŸ¥é“ &lt;code>dotnet run&lt;/code> æ²’æ›æ‰ï¼Œä»–åªæ˜¯é‚„åœ¨è·‘è€Œå·²ï¼Œå¦å‰‡ä½ æœƒæœ‰ 2 ~ 3 ç§’çš„ç©ºç™½ï¼Œæœ‰äººæœƒè¦ºå¾—å¥½åƒç¨‹å¼æ²’å•Ÿå‹•ï¼Œæ„Ÿè¦ºæ€ªæ€ªçš„ï¼ğŸ˜…&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dotnetRunMessage = true æ™‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Building...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Now listening on: http://localhost:5041
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Application started. Press Ctrl+C to shut down.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Hosting environment: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Content root path: G:&lt;span class="se">\P&lt;/span>rojects&lt;span class="se">\p&lt;/span>rojectV7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dotnetRunMessage = false æ™‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>14&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Now listening on: http://localhost:5041
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Application started. Press Ctrl+C to shut down.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Hosting environment: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; info: Microsoft.Hosting.Lifetime&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Content root path: G:&lt;span class="se">\P&lt;/span>rojects&lt;span class="se">\p&lt;/span>rojectV7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>è©³è¦‹ &lt;a class="link" href="https://stackoverflow.com/a/66186463/910074" target="_blank" rel="noopener"
>Purpose of dotnetRunMessages in launchSettings.json - Stack Overflow&lt;/a> èªªæ˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æœ€å¾Œï¼Œé‚„æœ‰å€‹ &lt;code>commandName&lt;/code> ä¹Ÿæ˜¯è¬ä¸€èˆ¬çš„å­˜åœ¨ï¼Œä¾ç„¶å®Œå…¨æ²’æœ‰æ–‡ä»¶èªªæ˜ï¼Œä½†åœ¨ Stack Overflow &lt;a class="link" href="https://stackoverflow.com/a/51801622/910074" target="_blank" rel="noopener"
>æœ‰ç¯‡æ–‡ç« &lt;/a>æœ‰åšè©³ç´°èªªæ˜ï¼Œå…¶è¨­å®šå€¼æœ‰å¯èƒ½æ˜¯ä»¥ä¸‹å››ç¨®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Project&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>å°‡ç•¶å‰çš„é€™å€‹æ‡‰ç”¨ç¨‹å¼ä½œç‚º&lt;strong>æ§åˆ¶å°æ‡‰ç”¨ç¨‹å¼&lt;/strong>é‹è¡Œï¼Œé€™è£¡çš„è¨­å®šè·Ÿä½ ç”¨ &lt;code>dotnet run&lt;/code> åŸ·è¡Œæ˜¯ç›¸åŒçš„ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;strong>IIS Express&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>é è¨­ä½¿ç”¨ IIS Express é–‹ç™¼ä¼ºæœå™¨ä¾†åŸ·è¡Œ ASP.NET Core æ‡‰ç”¨ç¨‹å¼ã€‚&lt;/p>
&lt;blockquote>
&lt;p>é€™å€‹é¸é …åªèƒ½ç”¨åœ¨ Visual Studio è€Œå·²ï¼Œ&lt;code>.NET CLI&lt;/code> æ˜¯ä¸æ”¯æ´çš„ï¼&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>IIS&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>ç•¶ä½ åœ¨æœ¬æ©Ÿå®‰è£ IIS å¾Œï¼Œæ‚¨å¯ä»¥è®“æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ç›´æ¥åœ¨ IIS åŸ·è¡Œã€‚&lt;/p>
&lt;blockquote>
&lt;p>é€™å€‹é¸é …åªèƒ½ç”¨åœ¨ Visual Studio è€Œå·²ï¼Œ&lt;code>.NET CLI&lt;/code> æ˜¯ä¸æ”¯æ´çš„ï¼&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>Executable&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>é€™è®“ä½ å¯ä»¥åŸ·è¡Œä»»æ„åŸ·è¡Œæª”ã€å‚³å…¥ä»»æ„åƒæ•¸ï¼Œéå¸¸éˆæ´»çš„è¨­å®šï¼&lt;/p>
&lt;blockquote>
&lt;p>é€™å€‹é¸é …åªèƒ½ç”¨åœ¨ Visual Studio è€Œå·²ï¼Œ&lt;code>.NET CLI&lt;/code> æ˜¯ä¸æ”¯æ´çš„ï¼&lt;/p>
&lt;/blockquote>
&lt;p>ä¾‹å¦‚ä½ ä¸æƒ³ç”¨ Visual Studio 2022 å…§å»ºé›£ç”¨çš„ Hot Reload çš„è©±ï¼Œå¯ä»¥é€™æ¨£è¨­å®šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nt">&amp;#34;Watch&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Executable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;dotnetRunMessages&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;executablePath&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dotnet&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;commandLineArgs&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;watch run&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;workingDirectory&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;$(ProjectDir)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;launchBrowser&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;applicationUrl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://localhost:5001;http://localhost:5000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;environmentVariables&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ASPNETCORE_ENVIRONMENT&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Development&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>ã€WebAPIã€‘åˆ†å±¤è¨­è¨ˆæ¨¡å¼ - ä¸‰å±¤å¼æ¶æ§‹</title><link>https://wayne-blog.com/2023-02-24/webapi-3-tier-introduction/</link><pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2023-02-24/webapi-3-tier-introduction/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52708075740_5943652140_o.png" alt="Featured image of post ã€WebAPIã€‘åˆ†å±¤è¨­è¨ˆæ¨¡å¼ - ä¸‰å±¤å¼æ¶æ§‹" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
.text-center {
text-align: center !important;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://kevintsengtw.blogspot.com/2013/07/aspnet-mvc.html" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="http://fanli7.net/a/bianchengyuyan/ASP/20130728/402562.html" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://shunnien.github.io/2017/07/29/3-tier-and-mvc-introduction/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://raychiutw.github.io/2019/%E9%9A%A8%E6%89%8B-Design-Pattern-2-%E8%BB%9F%E9%AB%94%E5%88%86%E5%B1%A4%E8%A8%AD%E8%A8%88%E6%A8%A1%E5%BC%8F-Software-Layered-Architecture-Pattern/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://sunnyday0932.github.io/2020/%E4%B8%89%E5%B1%A4%E5%BC%8F%E6%9E%B6%E6%A7%8B/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>è»Ÿé«”åˆ†å±¤è¨­è¨ˆæ¨¡å¼æ˜¯æˆ‘é€™å¹¾å¹´å°ˆæ¡ˆå¿…æœƒä½¿ç”¨çš„æ¶æ§‹ï¼Œå®ƒçš„æ•ˆç›Šåœ¨å¤šäººåœ˜éšŠåˆ†å·¥ä¸Šæœ‰æ¥µå¤§çš„æ•ˆç›Šï¼Œä¸”èƒ½æœ‰æ•ˆå°ˆæ³¨ä¿®æ”¹å€åŸŸï¼Œæé«˜å…±ç”¨æ€§ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸‰å±¤å¼æ¶æ§‹&lt;/strong> (Three-Tier) æ˜¯å¾ˆå¸¸è¦‹çš„æ¶æ§‹ï¼Œå¯ä»¥æ‡‰ç”¨åœ¨&lt;strong>å¯¦é«”æ©Ÿå™¨æ¶æ§‹&lt;/strong>ä¸Šï¼Œä¹Ÿå¯ä»¥æ‡‰ç”¨åœ¨&lt;strong>é‚è¼¯æ¶æ§‹&lt;/strong>ä¸Šï¼Œå¯ä»¥æŒ‰ç…§&lt;strong>å¯¦é«”&lt;/strong>èˆ‡&lt;strong>é‚è¼¯&lt;/strong>ä¸Šå»é€²è¡Œå€åˆ†ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ç‚ºç”šéº¼è¦åˆ†å±¤">ç‚ºç”šéº¼è¦åˆ†å±¤ï¼Ÿ&lt;/h2>
&lt;p>å¦‚æœç¨‹å¼å…¨éƒ¨ä¸€æ¢é¾å¯«åˆ°åº•ï¼Œå¾ŒçºŒæœƒç”¢ç”Ÿå¾ˆå¤šå•é¡Œï¼Œé›£ä»¥ç¶­è­·ã€é›£ä»¥é–±è®€ã€æ›´ç”šè‡³æ˜¯è¬ä¸€äººå®¶è¦æ¥æ‰‹ä½ çš„ç¨‹å¼ç¢¼ï¼Œé€™æ™‚å€™æ”¹ï¼¡å£ï¼¢ï¼Œè€¦åˆåº¦éé«˜çš„æƒ…æ³ä¸‹ï¼Œä½ åªèƒ½ç¥ˆç¦±æ¥æ‰‹çš„äººä¸çŸ¥é“ä½ ä½å“ª&amp;hellip;&lt;/p>
&lt;p>é€™ç¨®æƒ…æ³ä¸‹åªæœ‰è‡ªå·±å¯«å¯èƒ½é‚„å¥½ï¼Œé‚£å¦‚æœéœ€è¦è·Ÿäººåˆä½œå‘¢ï¼Ÿ&lt;/p>
&lt;p>å¤§å®¶å¯èƒ½å®¹æ˜“å‡ºç¾é‡è¤‡çš„ Codeï¼Œä¹Ÿé›£ä»¥èªªæ˜èª°è©²è² è²¬å¯«å“ªéƒ¨åˆ†ã€‚&lt;/p>
&lt;p>é€™æ™‚å€™æœ‰ä¸€å€‹å¥½çš„æ¶æ§‹ï¼Œå°±å¾ˆé‡è¦äº†ï¼Œåˆ†å±¤è¨­è¨ˆæ™‚ï¼Œéµå¾ªäº†é¢å‘ä»‹é¢è¨­è¨ˆçš„æ€æƒ³ï¼Œé‚£éº¼é€™ç¨®å‘ä¸‹çš„ä¾è³´ä¹Ÿæ‡‰è©²æ˜¯ä¸€ç¨®å¼±ä¾è³´é—œä¿‚ã€‚å› è€Œåœ¨ä¸æ”¹è®Šä»‹é¢å®šç¾©çš„å‰æä¸‹ï¼Œç†æƒ³çš„åˆ†å±¤å¼æ¶æ§‹ï¼Œæ‡‰è©²æ˜¯ä¸€å€‹æ”¯æŒå¯æŠ½å–ã€å¯æ›¿æ›çš„ã€ŒæŠ½å±œã€å¼æ¶æ§‹ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="webapi-çš„ä¸‰å±¤å¼æ¶æ§‹">WebAPI çš„ä¸‰å±¤å¼æ¶æ§‹&lt;/h2>
&lt;p>WebAPI çš„ä¸‰å±¤å¼æ¶æ§‹é¡§åæ€ç¾©ï¼Œä¸»è¦åˆ†ç‚ºäº†ä¸‰å±¤ï¼š&lt;/p>
&lt;ol>
&lt;li>Controllerï¼š æ§åˆ¶å±¤ï¼Œä½œç‚ºæ¥å£ã€‚&lt;/li>
&lt;li>Serviceï¼š å•†æ¥­é‚è¼¯å±¤ï¼Œåªè¦æœ‰é—œå•†æ¥­é‚è¼¯éƒ¨åˆ†çš„è™•ç†å…¨éƒ¨æ”¾åœ¨é€™ä¸€å±¤ã€‚&lt;/li>
&lt;li>Repositoryï¼š å€‰å„²å±¤ï¼Œä½œç‚ºè³‡æ–™å­˜å„²çš„ä¸€å±¤ã€‚&lt;/li>
&lt;li>Commonï¼š å…±ç”¨å±¤ï¼Œä½œç‚ºå­˜æ”¾å„å±¤æœƒç”¨åˆ°çš„ç›¸åŒæ±è¥¿ã€‚&lt;/li>
&lt;/ol>
&lt;p>ä»–å€‘ä¹‹é–“çš„é—œä¿‚å¦‚ä¸‹åœ–ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52708148648_5f464fec5b_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;h3 id="å„ªç¼ºé»">å„ªç¼ºé»&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å„ªé»&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1ã€è¼ƒå¥½å½¢æˆä¸€å€‹è¦ç¯„ï¼Œå¯åšç‚ºæ¨™æº–åŒ–æµç¨‹ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2ã€æé«˜é‡ç”¨æ€§ï¼Œé€éåˆ†å±¤å°‡ç›¸åŒé¡å‹çš„ç¨‹å¼ç¢¼æ”¾åœ¨ä¸€å¡Šã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3ã€åœ˜é«”åˆä½œçš„æ™‚å€™ï¼Œèƒ½å¤ åˆ†å±¤é€²è¡Œï¼›é–‹ç™¼äººå“¡åªéœ€å°ˆæ³¨æ–¼è‡ªå·±é–‹ç™¼çš„é‚£ä¸€å±¤å³å¯ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4ã€å…·æœ‰å¥½çš„é–‹æ”¾æ€§ã€å¯æ“´å……æ€§å„ªé»ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5ã€é™ä½ç¨‹å¼ç¢¼ä¹‹é–“çš„ä¾è³´ï¼Œæ¯å±¤æºé€šæ˜¯é€éä»‹é¢ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6ã€æé«˜ç³»çµ±å®‰å…¨æ€§ï¼Œå› ç‚ºä½¿ç”¨è€…éœ€è¦é€é Service å±¤æ‰æœ‰æ©Ÿæœƒèˆ‡ä¸‹ä¸€å±¤ Repository æ’ˆå–è³‡æ–™ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç¼ºé»&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1ã€å¢åŠ äº†é–‹ç™¼æˆæœ¬ï¼Œå‚³çµ±ä¸€å€‹äººè² è²¬å¯«åˆ°åº•ï¼›åˆ†å±¤ä¸‹éœ€è¦å¤šäººé€²è¡Œåˆä½œã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2ã€èª¿æ•´ç¨‹å¼å¯èƒ½æœƒå‡ºç¾é€£å‹•æ€§ï¼›æœ‰çš„æ™‚å€™ä¿®æ”¹ä¸€å€‹åœ°æ–¹ï¼Œæœƒå°è‡´å…¶ä»–å±¤ä¹Ÿéœ€è¦è·Ÿè‘—èª¿æ•´ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3ã€ç›¸è¼ƒæ–¼ä¸€æ¢é¾é–‹ç™¼ç³»çµ±æ€§èƒ½ä¸‹é™ï¼ŒåŸæœ¬ç¨‹å¼å¯ä»¥ç›´æ¥é€é DB æ’ˆå–è³‡æ–™ï¼Œç¾åœ¨éœ€è¦é€éä¸­é–“å±¤çš„è½‰ä»‹æ‰èƒ½å¤ æ‹¿åˆ°ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="controller">Controller&lt;/h3>
&lt;p>åœ¨æˆ‘å€‘ WebAPI ä¸­ï¼ŒController å°±å±¬æ–¼ã€&lt;strong>æ¥å£&lt;/strong>ã€ï¼Œè² è²¬è™•ç† Routerï¼Œå¦‚å¸¸è¦‹çš„ï¼š&lt;strong>Get&lt;/strong>ã€&lt;strong>Post&lt;/strong>ã€&lt;strong>Patch&lt;/strong>&amp;hellip;ç­‰ï¼Œéƒ½æœƒæ˜¯åœ¨é€™å±¤è² è²¬æ¥æ‡‰ç›¸å°æ‡‰çš„è·¯ç”±ã€‚&lt;/p>
&lt;p>Controller æ¥æ”¶çš„æ˜¯ &lt;code>Parameter&lt;/code>ï¼Œè¼¸å‡ºçš„æ˜¯ &lt;code>ViewModel&lt;/code>ã€‚&lt;/p>
&lt;h3 id="service">Service&lt;/h3>
&lt;p>åœ¨æˆ‘å€‘ç¨‹å¼ä¸­æœ€é‡è¦çš„å°±å±¬æ–¼ã€&lt;strong>å•†æ¥­é‚è¼¯&lt;/strong>ã€äº†ï¼Œé€™ä¸€å±¤æ˜¯æœƒç‰¹åˆ¥é—œæ³¨çš„ä¸€å±¤ï¼›é€™é‚Šå¤§å®¶å¯èƒ½æœƒå•ï¼Œé‚£å•†æ¥­é‚è¼¯æ˜¯æŒ‡å“ªäº›å‘¢ï¼Ÿ&lt;/p>
&lt;p>æˆ‘è‡ªå·±èªç‚ºæœ€ç°¡å–®åˆ†è¾¨çš„æ–¹å¼ï¼Œèˆ‰å‡¡ä»»ä½•éœ€è¦å°è³‡æ–™ç‰¹åˆ¥è™•ç†çš„åœ°æ–¹éƒ½æœƒæ˜¯æ”¾åœ¨é€™ä¸€å±¤ï¼Œå¦‚å¸¸è¦‹çš„ï¼š&lt;strong>ç™»å…¥é©—è­‰&lt;/strong>ã€&lt;strong>åŠ æ¸›æ³•é‹ç®—&lt;/strong>ã€&lt;strong>ç¢ºèªæ˜¯å¦é©—è­‰æˆåŠŸ&lt;/strong>&amp;hellip;ç­‰ã€‚&lt;/p>
&lt;p>Service æ¥æ”¶çš„æ˜¯ &lt;code>InfoModel&lt;/code>ï¼Œè¼¸å‡ºçš„æ˜¯ &lt;code>Dto&lt;/code>ã€‚&lt;/p>
&lt;h3 id="repository">Repository&lt;/h3>
&lt;p>è³‡æ–™å€‰å„²å±¤ï¼Œé€™å±¤ä¸»è¦è™•ç†ã€&lt;strong>æœ‰é—œè³‡æ–™ä¸²æ¥&lt;/strong>ã€çš„éƒ¨åˆ†ï¼Œå¦‚ï¼š&lt;strong>è³‡æ–™åº«é€£æ¥&lt;/strong>ã€&lt;strong>ä¸‹ SQL å– Table è³‡æ–™&lt;/strong>&amp;hellip;ç­‰ï¼Œéƒ½æœƒæ˜¯åœ¨ Repository è™•ç†ã€‚&lt;/p>
&lt;p>é€™é‚Šæœ‰å€‹ç‰¹åˆ¥çš„åœ°æ–¹ï¼Œå¦‚æœæˆ‘å€‘ç¨‹å¼éœ€è¦é€éåˆ¥äººçš„ API å–çš„è³‡æ–™å›ä¾†åšè™•ç†å‘¢ï¼Ÿ&lt;/p>
&lt;p>é‚£èˆ‡å°æ–¹ API ä¸²æ¥çš„åœ°æ–¹å°±æœƒæ˜¯ Repositoryï¼Œæ‰€ä»¥ Repository æ˜¯è™•ç†ã€&lt;strong>æœ‰é—œè³‡æ–™ä¸²æ¥&lt;/strong>ã€çš„åœ°æ–¹ï¼Œè€Œé€™è³‡æ–™ç•¶ç„¶ä¸¦ä¸åªé™æ–¼å¾ DB æ’ˆå–çš„è³‡æ–™ã€‚&lt;/p>
&lt;p>Repository æ¥æ”¶çš„æ˜¯ &lt;code>Condition&lt;/code>ï¼Œè¼¸å‡ºçš„æ˜¯ &lt;code>DataModel&lt;/code>ã€‚&lt;/p>
&lt;h3 id="common">Common&lt;/h3>
&lt;p>å…±ç”¨å±¤ç›¸å°å–®ç´”ï¼Œå­˜æ”¾å„å±¤é–“æœƒç”¨åˆ°çš„ã€&lt;strong>å…±åŒ&lt;/strong>ã€æ±è¥¿ï¼Œæœ€å¸¸è¦‹çš„ä¾‹å¦‚ï¼š&lt;strong>Enum&lt;/strong>&amp;hellip;ç­‰ï¼Œå°±æœƒæ”¾åœ¨é€™ä¸€å±¤ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¸¸è¦‹å•é¡Œ">å¸¸è¦‹å•é¡Œ&lt;/h2>
&lt;ol>
&lt;li>ä¸‰å±¤å¼æ¶æ§‹èˆ‡å‚³çµ± MVC æœ‰ç”šéº¼ä¸åŒå‘¢ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>å‚³çµ± MVC åˆ†æˆï¼Œ&lt;strong>View&lt;/strong>(å±•ç¤ºå±¤)ã€&lt;strong>Model&lt;/strong>(è³‡æ–™å±¤)ã€&lt;strong>Controller&lt;/strong>(æ§åˆ¶å±¤)ï¼Œé€™é‚Šèˆ‡ä¸‰å±¤å¼æ¶æ§‹æœ€å¤§çš„å€åˆ¥åœ¨æ–¼å‚³çµ± MVC ä¸¦æ²’æœ‰ç‰¹åˆ¥æŠŠã€&lt;strong>å•†æ¥­é‚è¼¯&lt;/strong>ã€æŠ½å‡ºä¾†ï¼›å¸¸æœƒçœ‹åˆ°å‚³çµ± MVC å¯èƒ½æœƒæŠŠå•†æ¥­é‚è¼¯é™„åŠ åœ¨ Controllerï¼Œæ‰€ä»¥ MVC èˆ‡ä¸‰å±¤å¼æ¶æ§‹æ˜¯ä¸åŒçš„ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>å„å±¤é–“æºé€šä¸€å®šè¦é€é Model å—ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>é€™å€‹ç­”æ¡ˆå°±æˆ‘å€‹äººä½¿ç”¨çš„ç†è§£æ˜¯ï¼Œã€&lt;strong>ä¸ä¸€å®šè¦é€é Model&lt;/strong>ã€ï¼Œå¦‚æœåªæ˜¯è¦å›å‚³ç°¡å–®çš„ bool ã€æˆ–æ˜¯ä¸€å…©å€‹åƒæ•¸ï¼Œç›´æ¥å‚³å°±å¯ä»¥äº†ï¼›é‚£åšæˆ Model çš„ç”¨æ„å‘¢ï¼Ÿç•¶ç„¶ä¹Ÿæ˜¯ç‚ºäº†æé«˜é‡ç”¨æ€§ï¼Œä¾‹å¦‚ ResultModelã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">ResultModel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// çµæœ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="n">Result&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// æç¤ºè¨Šæ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">Message&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é›–ç„¶åªæœ‰å…©å€‹è®Šæ•¸ï¼Œä½†é‚„æ˜¯æŠŠå®ƒåŒ…æˆäº† Model ï¼Œå› ç‚ºæœ‰å¾ˆå¤šå€‹åœ°æ–¹æœƒéœ€è¦ç”¨åˆ°ï¼Œç•¶ç„¶å°±å¯ä»¥åŒ…èµ·ä¾†çµ¦å¤§å®¶å…±åŒä½¿ç”¨ã€‚&lt;/p>
&lt;ol start="3">
&lt;li>Service å±¤å¯ä»¥å‘¼å«å…¶ä»– Service å±¤çš„ç¨‹å¼å—ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>å¯ä»¥ï¼Œä¸‰å±¤å¼æ¶æ§‹çš„å„ªé»å°±æ˜¯è¦æä¾›é‡ç”¨æ€§ï¼Œç•¶ç„¶å¦‚æœç›¸åŒçš„äº‹æƒ…åœ¨å…¶ä»–åœ°æ–¹å·²ç¶“æœ‰åšéäº†ï¼Œç›´æ¥æ‹¿ä¾†ä½¿ç”¨ï¼Œå°±ä¸ç”¨åšé‡è¤‡çš„äº‹æƒ…ã€‚&lt;/p>
&lt;ol start="4">
&lt;li>Model çš„åç¨±åˆ†äº†é€™éº¼å¤šï¼Ÿä¸èƒ½ç›´æ¥ä¸€å€‹é€šåˆ°åº•å—ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;p>é€™å•é¡Œä¹Ÿæ˜¯æˆ‘ä¸€é–‹å§‹ä¸å¤ªèƒ½å¤ ç†è§£çš„éƒ¨åˆ†ï¼Œå¦‚æœæ˜¯ä¸€å€‹äººå¯«ç¨‹å¼çš„æ™‚å€™éƒ½æœƒç‚ºäº†æ–¹ä¾¿ï¼Œå°±ä¸€å€‹ Model é€šåˆ°åº•å§ï¼›é€™æ™‚å€™è‚¯å®šæœƒæœ‰äººå•å°±ç®—å¤šäººåˆä½œä¹Ÿå¯ä»¥å•Šï¼Ÿ&lt;/p>
&lt;p>çœŸçš„å¯ä»¥å—ï¼Ÿ&lt;/p>
&lt;p>å„å±¤é–“çš„è·è²¬éƒ½ä¸åŒï¼Œå¾ Reoisitory å–å‡ºä¾†çš„è³‡æ–™ä¸Ÿçµ¦ Service åšè™•ç†ï¼Œæœ‰å¯èƒ½ä¸éœ€è¦å…¨éƒ¨å®Œæ•´çš„è³‡æ–™å›å‚³çµ¦ Controllerï¼Œç‚ºäº†é¿å…é€™ç¨®æƒ…æ³ç•¶ç„¶æ˜¯åˆ†é–‹æœƒæ¯”è¼ƒå¦¥ç•¶ï¼Œè‡ªå·±ä½¿ç”¨è‡ªå·±çš„ Modelï¼›å¤šäººåˆä½œçš„æ™‚å€™åªéœ€è¦å®šç¾©èªªå¥½ç›¸äº’è¦å‚³éçš„åƒæ•¸å°±å¯ä»¥åˆ†å±¤é–‹ç™¼äº†ï¼Œä¹Ÿä¸æœƒå› ç‚ºä¸€å€‹ Model è€Œå½±éŸ¿å°æ–¹ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å°çµ">å°çµ&lt;/h2>
&lt;p>ç•¶æˆ‘æ˜¯ä¸€å€‹äººé–‹ç™¼çš„æ™‚å€™ï¼Œåˆ†å±¤è¨­è¨ˆçœŸçš„æ„Ÿå—ä¸æ·±ï¼Œæ›´å¤šçš„æ˜¯ç‚ºä½•è¦å¼„å¾—é€™éº¼è¤‡é›œï¼Œä½†éš¨è‘—å·¥ä½œåœ˜éšŠçš„æ“´å±•ï¼Œå¤šäººåˆä½œé–‹ç™¼çš„æ™‚å€™ï¼Œåˆ†å±¤è¨­è¨ˆå°±ç™¼æ®å‡ºäº†å®ƒçš„åƒ¹å€¼ï¼Œå„å€‹æˆå“¡å°ˆæ³¨å„è‡ªçš„å±¤ç™¼é–‹ï¼Œä¸æœƒè¢«å…¶ä»–æˆå“¡å½±éŸ¿ï¼Œç•¶éœ€è¦ä¿®æ”¹æˆ–æ“´å……æ™‚ï¼Œè‹¥æ˜¯è¦æ”¹ UIï¼Œåªéœ€è¦ç•°å‹•å±•ç¤ºå±¤ï¼Œè‹¥æ˜¯æ–°å¢å•†æ¥­é‚è¼¯å‰‡åªéœ€å°ˆæ³¨æ¥­å‹™å±¤ï¼Œè€Œæ˜¯ç‚ºè¦æ›ç¬¬ä¸‰æ–¹é…åˆå» å•†æˆ–è€…æ›´æ›è³‡æ–™åº«ï¼Œå‰‡åªéœ€å°ˆæ³¨åœ¨è³‡æ–™å±¤å»ä¿®æ”¹ï¼Œè€Œå„å±¤çš„ç‰©ä»¶åˆå¯ä»¥ä¾ä¸åŒæƒ…å¢ƒåšé‡ç”¨ï¼Œä¸éœ€é‡è¤‡é–‹ç™¼ï¼Œå¯è¬‚å¥½è™•å¤šå¤šã€‚&lt;/p>
&lt;p>æ•ˆç›Šï¼š&lt;/p>
&lt;ul>
&lt;li>é©åˆå¤šäººåœ˜éšŠåˆ†å·¥æ™‚ä¸äº’ç›¸å½±éŸ¿ (ä¸€æ¢é¾é–‹ç™¼æ™‚æ„Ÿå—ä¸æ·±)&lt;/li>
&lt;li>åˆ†å±¤å°ˆæ³¨ï¼Œå¯ä»¥å°ˆæ³¨ä¿®æ”¹ï¼Œä¸æœƒç‰½ä¸€é«®å‹•å…¨èº«&lt;/li>
&lt;/ul>
&lt;p>ä½†çœŸçš„èƒ½é”åˆ°é€™æ¨£çš„æ•ˆç›Šï¼Œå…¶å¯¦é‚„æœ‰ä¸€äº›å¿…è¦å‰æï¼š&lt;/p>
&lt;ul>
&lt;li>ç‰©ä»¶è¨­è¨ˆé ˆç¬¦åˆ SOLID åŸå‰‡&lt;/li>
&lt;li>å„å±¤ä¾è³´ä»‹é¢ (Interface)ï¼Œä¸ä¾è³´å¯¦ä½œ&lt;/li>
&lt;li>å°ˆæ¡ˆéœ€å°å…¥ DI Frameworkï¼Œåšåˆ°ä¾è³´æ³¨å…¥ï¼Œé”æˆæ§åˆ¶åè½‰ (IoC)&lt;/li>
&lt;li>æ’°å¯«å–®å…ƒæ¸¬è©¦ (Unit Test) ä¿è­·æ¯æ¬¡ä¿®æ”¹&lt;/li>
&lt;li>åˆç†çš„è¨­è¨ˆå„å±¤è·è²¬ç‰©ä»¶ï¼Œæ¥­å‹™å±¤æ›´ç‚ºé‡è¦&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>ã€C#ã€‘å¯¦ä½œ Debounced Job</title><link>https://wayne-blog.com/2023-02-13/dotnet-core-debounce/</link><pubDate>Mon, 13 Feb 2023 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2023-02-13/dotnet-core-debounce/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52686405784_425f5b6fca_o.png" alt="Featured image of post ã€C#ã€‘å¯¦ä½œ Debounced Job" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://ithelp.ithome.com.tw/articles/10222749" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://www.huanlintalk.com/2020/03/asynctaskcontinuation.html" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.darkthread.net/blog/dotnet-debounce/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>&lt;a class="link" href="https://ithelp.ithome.com.tw/articles/10222749" target="_blank" rel="noopener"
>Debounce (å»æŠ–å‹•)&lt;/a>æ˜¯å‰ç«¯é–‹ç™¼æ™‚å¾ˆå¸¸ç”¨çš„æŠ€å·§ï¼Œç¶“å…¸æ‡‰ç”¨æ˜¯æ•´åˆ AJAX çš„æ¬„ä½è¼¸å…¥è‡ªå‹•å®Œæˆã€‚åŸå§‹è¨­è¨ˆæ˜¯æ¯æ•²ä¸€å€‹å­—å…ƒæŸ¥ä¸€æ¬¡ï¼Œç•¶ä½¿ç”¨è€…é€£çºŒè¼¸å…¥ w a y n e b ä¾¿æœƒç™¼å‡º &amp;ldquo;w&amp;rdquo;ã€&amp;ldquo;wa&amp;rdquo;ã€&amp;ldquo;way&amp;rdquo;ã€&amp;ldquo;wayn&amp;rdquo;ã€&amp;ldquo;wayne&amp;rdquo;ã€&amp;ldquo;wayne-b&amp;rdquo; ç­‰å…­æ¬¡ AJAX æŸ¥è©¢ï¼Œè€Œä½¿ç”¨è€…æœŸæœ›çš„æ˜¯ç”¨ wayne-b å¸¶å‡º wayne-blog æç¤ºï¼Œå› æ­¤å‰é¢äº”æ¬¡ç´”å±¬ç„¡æ•ˆæŸ¥è©¢ï¼Œå¹³ç™½æµªè²»é »å¯¬è·Ÿä¸»æ©Ÿè³‡æºã€‚æœ‰æ•ˆçš„æ”¹å–„æ–¹æ³•æ˜¯æ”¹æˆæ¯æ¬¡æ•²å®Œä¸€å€‹å­—å…ƒå…ˆç¨å¾… 0.5 ç§’æˆ– 1 ç§’ï¼Œç¢ºèªæ²’æœ‰è¦è¼¸å…¥å…¶ä»–å­—å…ƒï¼Œæœ€å¾Œä¸€æ¬¡é€å‡º &amp;ldquo;wayneb&amp;rdquo;ã€‚é€™åœ¨ç¶²é ä¸Šç”¨ JavaScript setTimeout/clearTimeout å³å¯è¼•æ˜“å¯¦ç¾ï¼Œé€™å€‹åšæ³•æœ‰å€‹è¡“èªå« - Debounceã€‚&lt;/p>
&lt;p>ä¼ºæœå™¨ç«¯æœ‰é¡ä¼¼çš„æ‡‰ç”¨æƒ…å¢ƒå—ï¼Ÿæœ‰ã€‚&lt;/p>
&lt;p>æåˆ°ç³»çµ±è‡ªå‹•é€šçŸ¥ï¼Œç¶“å¸¸æ˜¯ä¸€ç­†è¨˜éŒ„ç™¼ä¸€æ¬¡é€šçŸ¥(é‹ä½œæœ€ç°¡å–®ï¼Œç³»çµ±å…§å»ºæä¾›ä¸éœ€å®¢è£½)ï¼Œè€ŒæŸäº›äº‹ä»¶ä¸€æ—¦ç™¼ç”Ÿæœƒå™´å‡ºæ•¸åä¸Šç™¾ç­†é€šçŸ¥ï¼ŒçŸ­çŸ­å¹¾ç§’æ”¶ä»¶åŒ£æˆ– LINE/Slack å°±è¢«æš´åŠ›æ´—ç‰ˆã€‚æ›´ç†æƒ³çš„åšæ³•æ˜¯æŠŠçŸ­æ™‚é–“å…§çš„é€£çºŒè¨Šæ¯å½™æ•´æˆä¸€å°ï¼Œè€Œé€™é¡ä¼¼å‰é¢èªªçš„ã€Œå½™æ•´å¤šå€‹è¼¸å…¥å­—å…ƒå†ä¸€æ¬¡ç™¼å‡º AJAX è«‹æ±‚ã€ï¼Œå¯ä»¥é  Debounce æ©Ÿåˆ¶æ”¹å–„ã€‚è€Œæˆ‘å€‘è¦åšçš„å°±æ˜¯ç”¨ C# å¯¦ç¾é¡ä¼¼é‚è¼¯ï¼Œæ”¶åˆ°ç¬¬ä¸€å‰‡é€šçŸ¥æ™‚å…ˆä¸è¦é¦¬ä¸Šè½‰ç™¼ï¼Œè‹¥ä¸€æ®µæ™‚é–“å…§æ¥é€£é‚„æœ‰å…¶ä»–è¨Šæ¯é€²ä¾†éƒ½å…ˆå­˜èµ·ä¾†ï¼Œç­‰åˆ° 30 ç§’å…§æ²’æœ‰æ–°è¨Šæ¯ï¼Œå†å°‡ç´¯ç©çš„è¨Šæ¯å½™æ•´æˆä¸€ç­†é€å‡ºã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å¯¦ä½œ">å¯¦ä½œ&lt;/h2>
&lt;p>å¯«å€‹ ASP.NET Core Minimal API åš&lt;strong>æ¦‚å¿µæ€§é©—è­‰&lt;/strong>(Proof of Conceptï¼›POC)ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System.Collections.Concurrent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">builder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">WebApplication&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CreateBuilder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">app&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Build&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç”¨é€”ï¼šè¨Šæ¯å­˜æ–¼è¨˜æ†¶é«”ï¼Œä¸è€ƒæ…®ç¨‹åºç•°å¸¸è³‡æ–™éºå¤±å•é¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">msgQueue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ConcurrentQueue&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å»¶é² 5 ç§’åŸ·è¡Œï¼ŒæœŸé–“ç´¯ç©çš„è¨Šæ¯ä¸€æ¬¡è™•ç†&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">debouncePrint&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">DebouncedJob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeSpan&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromSeconds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MapPost&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/alert&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">HttpRequest&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">msg&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Form&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;msg&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsNullOrEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">msgQueue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Enqueue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è‹¥æ€•æ–°è¨Šæ¯æºæºä¸çµ•ä¸€ç›´ Delay ä¸‹å»ï¼Œå¯åŠ å…¥è¨Šæ¯æ•¸ä¸Šé™&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç•¶ msgQueue ç´¯ç©æ•¸é‡é”ä¸Šé™æ™‚ï¼Œä¸é€é DebouncedJob ç›´æ¥åŸ·è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">debouncePrint&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Run&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ForegroundColor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">ConsoleColor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Yellow&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;Debounce Print: {DateTime.Now:mm:ss}&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ResetColor&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">msgQueue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TryDequeue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">out&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">m&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Results&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;OK&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MapGet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="n">Results&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">@&amp;#34;&amp;lt;!DOCTYPE html&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;meta charset=&amp;#34;&amp;#34;utf-8&amp;#34;&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;title&amp;gt;DebouncedJob&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;form action=https://wayne-blog.com/alert method=post target=result id=frm &amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;input type=hidden name=msg id=msg /&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;/form&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;iframe name=result style=display:none&amp;gt;&amp;lt;/iframe&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;button onclick=&amp;#39;test()&amp;#39; &amp;gt;Run Test&amp;lt;/button&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;ul id=log&amp;gt;&amp;lt;/ul&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;script&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> let delays = [1, 1, 2, 3, 1, 4, 6, 1, 1, 7, 1];
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> function test() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> send();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> function send() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> let m = `Sent on ${new Date().toISOString().split(&amp;#39;T&amp;#39;)[1].substr(3, 5)}`;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> document.getElementById(&amp;#39;log&amp;#39;).innerHTML += `&amp;lt;li&amp;gt;${m}&amp;lt;/li&amp;gt;`;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> document.getElementById(&amp;#39;msg&amp;#39;).value = m;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> document.getElementById(&amp;#39;frm&amp;#39;).submit();
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if (delays.length) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> setTimeout(send, delays.shift() * 1000);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;/script&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;lt;/html&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;text/html&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›®çš„æ˜¯ç”± &lt;code>/alert&lt;/code> æ”¶è¨Šæ¯ç”¨ &lt;strong>Console.WriteLine&lt;/strong> é¡¯ç¤ºå‡ºä¾†ï¼Œä½†ä¸­é–“åŠ ä¸Š 5 ç§’çš„ Debounce æ©Ÿåˆ¶ã€‚åšæ³•æ˜¯æ”¶åˆ° &lt;code>/alert&lt;/code> æ™‚å…ˆå°‡ msg å­˜é€² &lt;strong>ConcurrentQueue&lt;/strong> (ä¸è€ƒæ…®ç¨‹åºç•°å¸¸è³‡æ–™éºå¤±)ï¼Œä¸¦æ’å®šä¸€å€‹å°‡ &lt;strong>ConcurrentQueue&lt;/strong> å…§å®¹å…¨éƒ¨å°å‡ºä¾†çš„å‹•ä½œï¼Œè‹¥ 5 ç§’å…§æ²’æœ‰å…¶ä»– &lt;code>/alert&lt;/code> è¢«å‘¼å«ï¼Œæ’å®šçš„ Console.Print æ‰æœƒçœŸçš„åŸ·è¡Œã€‚é¦–é çš„éƒ¨åˆ†æˆ‘å¯«äº†ç°¡å–®çš„ JavaScriptï¼Œæ¨¡æ“¬é–“éš” 1ã€1ã€2ã€3ã€1ã€4ã€6ã€1ã€1ã€7ã€1 ç§’å„å‘¼å«ä¸€æ¬¡ &lt;code>/alert&lt;/code>ã€‚ç”±æ–¼è¶…é 5 ç§’æ‰æœƒ Printï¼Œé æœŸæœƒåœ¨ç­‰ 6 ç§’ã€ç­‰ 7 ç§’åŠæœ€å¾Œåˆ†ä¸‰æ¬¡å°å‡ºã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52686405784_425f5b6fca_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æ¸¬è©¦æˆåŠŸï¼Œçµæœç¬¦åˆé æœŸã€‚&lt;/p>
&lt;p>é‹ä½œçš„é—œéµåœ¨ Debounced Jobï¼Œé‚£ Debounced Job è¦æ€éº¼å¯«ï¼Ÿ&lt;/p>
&lt;p>å…¶å¯¦é‚„è »ç°¡å–®çš„ï¼Œ.NET æ²’æœ‰ setTimeoutã€clearTimeoutï¼Œä½†æˆ‘å€‘å¯ä»¥ç”¨ &lt;strong>Task.Delay().ContinueWith()&lt;/strong> é…ä¸Š &lt;strong>CancellationToken&lt;/strong> å¯¦ç¾å–æ¶ˆè¦å»¶é²åŸ·è¡Œä½œæ¥­çš„ç›¸ä¼¼é‚è¼¯ï¼ŒTask.Delay() åƒ Thread.Sleep() å¯ä»¥ä¸ä½”ç”¨ CPU ç­‰å¾…æŒ‡å®šæ™‚é–“ï¼Œä½†å¤šäº†æ¥æ”¶ CancellationToken éš¨æ™‚ä¸­æ–·ç­‰å¾…çš„åŠŸèƒ½ï¼Œé…åˆ ContinueWith() æ™‚æª¢æŸ¥ CancellationToken.IsCancellationRequested åµæ¸¬è¢«ä¸­æ–·çš„è©±æ”¾æ£„åŸ·è¡Œï¼Œä¾¿èƒ½å¯¦ç¾ clearTimeout æ”¾æ£„åŸ·è¡Œçš„æ•ˆæœã€‚(å»¶ä¼¸é–±è®€ï¼š&lt;a class="link" href="https://www.huanlintalk.com/2020/03/asynctaskcontinuation.html" target="_blank" rel="noopener"
>NET éåŒæ­¥å·¥ä½œçš„å»¶çºŒ by Huanlin å­¸ç¿’ç­†è¨˜&lt;/a>)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">DebouncedJob&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span> &lt;span class="n">_cts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="kt">object&lt;/span> &lt;span class="n">_lock&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">object&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="n">TimeSpan&lt;/span> &lt;span class="n">_delay&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">DebouncedJob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeSpan&lt;/span> &lt;span class="n">delay&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_delay&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">delay&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Action&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">lock&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">_lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å–æ¶ˆä¸Šä¸€æ¬¡çš„åŸ·è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¦‚å¿µä¸Šé¡ä¼¼ JavaScript debounce çš„ clearTimeout() æŠ€å·§&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Cancel&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Dispose&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Token&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Delay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_delay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">ContinueWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŸ·è¡Œåˆ°é€™è£¡æœ‰å…©ç¨®æƒ…æ³ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1. å»¶é²æ™‚é–“åˆ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2. å»¶é²æ™‚é–“æœªåˆ°ï¼ŒCancellationToken è¢«å–æ¶ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¾Œè€…ä¸åŸ·è¡Œ action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsCancellationRequested&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å­¸æœƒé€™å€‹æŠ€å·§ï¼Œæœªä¾†é‡åˆ°éœ€è¦å°‡å‹•ä½œåŒ–é›¶ç‚ºæ•´ï¼Œæé«˜è™•ç†æ•ˆç‡åŠè³‡è¨Šå¯è®€æ€§çš„å ´åˆï¼Œæˆ‘å€‘å°±å¯ä»¥é å®ƒå¯«å‡ºæ›´è²¼å¿ƒæœ‰æ•ˆç‡çš„ç¨‹å¼å›‰ã€‚&lt;/p>
&lt;p>ä½ å¯èƒ½æœƒæƒ³ï¼Œåœ¨æ¥µç«¯ç‹€æ…‹ä¸‹è‹¥è¨Šæ¯æºæºä¸çµ•é€²ä¾†ï¼Œç™¼é€å‹•ä½œå°‡è¢«ç„¡é™å»¶é²å½±éŸ¿é€šçŸ¥æ™‚æ•ˆã€‚&lt;/p>
&lt;p>é€™é‚„å¯é€éè¨­å®šç­‰å¾…ä¸Šé™è§£æ±ºï¼Œè©¦å¯«ä¸€å€‹å¯æŒ‡å®šç­‰å¾…ä¸Šé™çš„ç‰ˆæœ¬(é è¨­ä¸Šé™æ™‚ç‚ºç­‰å¾…æ™‚é–“çš„å…©å€)ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">DebouncedJob&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span> &lt;span class="n">_cts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="kt">object&lt;/span> &lt;span class="n">_lock&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="kt">object&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="n">TimeSpan&lt;/span> &lt;span class="n">_delay&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="n">TimeSpan&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="n">_maxDelay&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">DebouncedJob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeSpan&lt;/span> &lt;span class="n">delay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">TimeSpan&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="n">maxDelay&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_delay&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">delay&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æœªæŒ‡å®š maxDelay æ™‚ï¼Œé è¨­ç‚ºå…©å€ delay é•·åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_maxDelay&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">maxDelay&lt;/span> &lt;span class="p">??&lt;/span> &lt;span class="n">delay&lt;/span> &lt;span class="p">*&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="n">DateTime&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Action&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">lock&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">_lock&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å–æ¶ˆä¸Šä¸€æ¬¡çš„åŸ·è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ¦‚å¿µä¸Šé¡ä¼¼ JavaScript debounce çš„ clearTimeout() æŠ€å·§&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Cancel&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Dispose&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CancellationTokenSource&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">_cts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Token&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">DateTime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Now&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// è¶…é maxDelay ç›´æ¥åŸ·è¡Œ action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">DateTime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Now&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">_maxDelay&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Delay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_delay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">ContinueWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åŸ·è¡Œåˆ°é€™è£¡æœ‰å…©ç¨®æƒ…æ³ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 1. å»¶é²æ™‚é–“åˆ°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 2. å»¶é²æ™‚é–“æœªåˆ°ï¼ŒCancellationToken è¢«å–æ¶ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¾Œè€…ä¸åŸ·è¡Œ action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsCancellationRequested&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">firstRunTime&lt;/span> &lt;span class="p">=&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿®æ”¹ &lt;strong>Program.cs&lt;/strong>ï¼Œ&lt;code>var debouncePrint = new DebouncedJob(TimeSpan.FromSeconds(5), TimeSpan.FromSeconds(8));&lt;/code> è¨­å®šå…«ç§’ä¸Šé™ï¼Œå¯è§€å¯Ÿåˆ°ç¬¬ä¸€æ³¢æ‹†æˆå…©æ‰¹é¡¯ç¤ºï¼Œæœ€ä¹…åªæœƒå»¶é²åˆ° 8 ç§’ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52686405774_199c25cabe_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>ASP.NET Core ç¶²ç«™å¦‚ä½•æ•´åˆ Google çš„ reCAPTCHA Enterprise åŠŸèƒ½</title><link>https://wayne-blog.com/2023-02-07/dotnet-core-google-recaptcha/</link><pubDate>Tue, 07 Feb 2023 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2023-02-07/dotnet-core-google-recaptcha/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52674631510_d9525c3729_o.png" alt="Featured image of post ASP.NET Core ç¶²ç«™å¦‚ä½•æ•´åˆ Google çš„ reCAPTCHA Enterprise åŠŸèƒ½" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://www.google.com/recaptcha/about/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://developers.google.com/recaptcha/intro" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/choose-key-type" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/how-to" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/interpret-assessment" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://zh.wikipedia.org/wiki/ReCAPTCHA" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://ithelp.ithome.com.tw/articles/10262450" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>ç¶²ç«™ä¸Šå¹¾ä¹æ¯é éƒ½æœ‰è¯çµ¡è¡¨å–®ï¼Œä¸¦é€é AJAX å‚³é€åˆ°å¾Œç«¯ API è² è²¬è¨˜éŒ„ä¸¦é€å‡ºéƒµä»¶åˆ°å…¬å¸çš„æœå‹™ä¿¡ç®±ï¼Œä½†ç¶²ç«™ä¸Šç·šå¾Œï¼Œåƒåœ¾è¨Šæ¯å¤ªå¸¸æ”¶åˆ°ã€‚å› æ­¤ï¼Œæˆ‘æ‰“ç®—å°‡è¡¨å–®åŠ å…¥ &lt;a class="link" href="https://cloud.google.com/" target="_blank" rel="noopener"
>Google Cloud Platform&lt;/a> (GCP) çš„ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> æœå‹™ï¼Œæ¸›å°‘æ”¶åˆ°åƒåœ¾è¨Šæ¯çš„æ©Ÿæœƒï¼Œé€™ç¯‡æ–‡ç« æˆ‘ä¾†åˆ†äº«ä¸€ä¸‹å®Œæ•´çš„é–‹ç™¼æµç¨‹ï¼&lt;/p>
&lt;hr>
&lt;h2 id="å…ˆæ•´ç†å¹¾å€‹é‡è¦æ¦‚å¿µ">å…ˆæ•´ç†å¹¾å€‹é‡è¦æ¦‚å¿µ&lt;/h2>
&lt;p>&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/ReCAPTCHA" target="_blank" rel="noopener"
>reCAPTCHA&lt;/a> åŸæœ¬æ˜¯ç”±&lt;a class="link" href="https://zh.m.wikipedia.org/wiki/%E5%8D%A1%E5%86%85%E5%9F%BA%C2%B7%E6%A2%85%E9%9A%86%E5%A4%A7%E5%AD%A6" target="_blank" rel="noopener"
>å¡å…§åŸºæ¢…éš†å¤§å­¸&lt;/a>æ‰€ç™¼å±•çš„ç³»çµ±ï¼Œä¸»è¦ç›®çš„æ˜¯åˆ©ç”¨ &lt;a class="link" href="https://zh.m.wikipedia.org/wiki/CAPTCHA" target="_blank" rel="noopener"
>CAPTCHA&lt;/a> æŠ€è¡“ä¾†å¹«åŠ©å…¸ç±æ•¸ä½åŒ–çš„é€²è¡Œï¼Œé€™å€‹è¨ˆç•«å°‡ç”±æ›¸æœ¬æƒç„ä¸‹ä¾†ç„¡æ³•æº–ç¢ºçš„è¢«å…‰å­¸æ–‡å­—è¾¨è­˜æŠ€è¡“è­˜åˆ¥çš„æ–‡å­—é¡¯ç¤ºåœ¨ CAPTCHA å•é¡Œä¸­ï¼Œè®“äººé¡åœ¨å›ç­” CAPTCHA å•é¡Œæ™‚ç”¨&lt;strong>äººè…¦&lt;/strong>åŠ ä»¥è­˜åˆ¥ã€‚2009 å¹´ 9 æœˆ 17 æ—¥ Google å®£ä½ˆæ”¶è³¼ reCAPTCHA æŠ€è¡“ï¼ŒæŒçºŒç™¼å±•ä¹‹ä¸‹ä¹Ÿæä¾›æ¨™æº–çš„ API ä¾›ç”¨æˆ¶å…è²»ä½¿ç”¨ï¼Œæ™‚è‡³ä»Šæ—¥å·²ç¶“ç™¼å±•å‡ºå¥½å¹¾å€‹ç‰ˆæœ¬ã€‚&lt;/p>
&lt;p>ç›®å‰å¯ä»¥åœ¨ Google ç¶²ç«™æ‰¾åˆ° 3 å€‹ä¸åŒçš„ç‰ˆæœ¬ï¼Œå…¶åŠŸèƒ½èˆ‡ç‰¹æ€§å„æœ‰ä¸åŒï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://developers.google.com/recaptcha/docs/display" target="_blank" rel="noopener"
>reCAPTCHA v2&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>é™¤äº†åŸä¾†çš„æ–‡å­—æƒç„åœ–ç‰‡å¤–ï¼Œä¹Ÿæ¡ç”¨ Google è¡—æ™¯æ‹æ”çš„é–€ç‰Œè™Ÿç¢¼ç›¸ç‰‡ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>&lt;a class="link" href="https://developers.google.com/recaptcha/docs/v3" target="_blank" rel="noopener"
>reCAPTCHA v3&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>æ¡ç”¨&lt;strong>åˆ†æ•¸åˆ¶&lt;/strong>é©—è­‰ç³»çµ±ï¼Œå°ä½¿ç”¨è€…åœ¨ç¶²ç«™ä¸Šçš„å‹•ä½œé€²è¡Œè©•åˆ†ï¼Œè‹¥åˆ†æ•¸éä½å‰‡æœƒè¢«åˆ¤å®šç‚ºæ©Ÿå™¨äººã€‚&lt;/p>
&lt;ol start="3">
&lt;li>&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>èˆ‡ &lt;code>reCAPTCHA v3&lt;/code> ç›¸åŒï¼Œæ¡ç”¨&lt;strong>åˆ†æ•¸åˆ¶&lt;/strong>é©—è­‰ç³»çµ±ï¼Œä½†èƒ½å¤ æä¾›&lt;strong>æ›´ç²¾ç´°çš„åˆ†æ•¸&lt;/strong>ä»¥åŠ&lt;strong>é«˜é¢¨éšªåˆ†æ•¸åŸå› ä»£ç¢¼&lt;/strong>ï¼Œä»¥ä¾›é€²ä¸€æ­¥åˆ†æä¹‹ç”¨ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä»¥ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> ç‚ºä¸»ï¼Œç‰ˆæœ¬æ¯”è¼ƒå¯åƒè€ƒ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/compare-versions" target="_blank" rel="noopener"
>Comparison of features between reCAPTCHA versions&lt;/a> æ–‡ä»¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> æœ‰å€‹é‡è¦çš„æ¦‚å¿µï¼Œå°±æ˜¯ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/keys" target="_blank" rel="noopener"
>reCAPTCHA keys&lt;/a> æˆ– &lt;code>site keys&lt;/code>ï¼Œæˆ‘å°‡å…¶ç¿»è­¯ç‚ºã€Œ&lt;strong>ç¶²ç«™é€šé—œé‡‘é‘°&lt;/strong>ã€æˆ–æ˜¯ã€Œ&lt;strong>é©—è­‰é‡‘é‘°&lt;/strong>ã€ä¹Ÿè¨±æ¯”è¼ƒæ°ç•¶ï¼Œä»–æ˜¯ä¸€å€‹ä½¿ç”¨åœ¨ä½ ç¶²ç«™çš„ä¸€çµ„å…¬é–‹é‡‘é‘°ï¼Œé€éé€™å€‹ &lt;code>site keys&lt;/code> æœƒä¾æ“šä½¿ç”¨è€…ç«¯æä¾›çš„å„ç¨®è³‡è¨Šï¼Œè‡ªå‹•ç”¢ç”Ÿä¸€å€‹å”¯ä¸€çš„ã€Œå›æ‡‰å€¼ã€(Response)ï¼Œä½ è¦æŠŠé€™å€‹ã€Œå›æ‡‰å€¼ã€å‚³åˆ°å¾Œç«¯çš„ reCAPTCHA Server é€²è¡Œé©—è­‰ï¼Œç”± reCAPTCHA Server åˆ¤æ–·å‡ºé€™å€‹ã€Œå›æ‡‰å€¼ã€æ˜¯å¦æ˜¯ã€ŒçœŸäººã€(Human)æˆ–ã€Œå‡äººã€(Bots)ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> çš„ &lt;code>site keys&lt;/code> æœ‰ 3 ç¨®ä½¿ç”¨æ–¹å¼ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Score-based (no challenge) site keys&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>ä»¥ã€Œåˆ†æ•¸ã€ç‚ºåŸºç¤çš„é©—è­‰æ–¹æ³•ï¼Œé€™ç¨®é©—è­‰æ–¹æ³•å®Œå…¨&lt;strong>ä¸éœ€è¦ç”±ä½¿ç”¨è¼¸å…¥è³‡è¨Š&lt;/strong>ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ¤æ–·ä½¿ç”¨è€…é€éç€è¦½å™¨ã€éµç›¤æˆ–æ˜¯è§¸æ§ç­‰ä½¿ç”¨æ–¹å¼ï¼Œè‡ªå‹•æ”¶é›†ä½¿ç”¨è€…è·Ÿæ‰‹æ©Ÿæˆ–ç¶²é ä¹‹é–“çš„äº’å‹•æƒ…æ³ï¼Œåˆ¤æ–·è©²ã€Œä½¿ç”¨è€…ã€æ˜¯å¦ç‚ºã€ŒçœŸäººã€æˆ–ã€Œå‡äººã€ï¼Œé€åˆ° reCAPTCHA Server é©—è­‰æ™‚ï¼Œæœƒæä¾›ä½ ä¸€å€‹ã€Œåˆ†æ•¸ã€(Score)ï¼Œå¾ &lt;code>0.0&lt;/code> ï½ &lt;code>10.0&lt;/code> åˆ†ï¼Œå…¶ä¸­ &lt;code>0.0&lt;/code> å°±æ˜¯çµ•å°çš„ã€Œå‡äººã€ï¼Œè€Œ &lt;code>10.0&lt;/code> å°±æ˜¯çµ•å°çš„ã€ŒçœŸäººã€ã€‚é€™ç¨®é¡å‹çš„ &lt;code>site keys&lt;/code> é©ç”¨æ–¼ã€Œæ‰‹æ©Ÿ APPã€æˆ–ã€Œç¶²é ã€ç’°å¢ƒã€‚&lt;/p>
&lt;blockquote>
&lt;p>é€™æ¨£å°ä½¿ç”¨è€…ä¾†èªªéå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨è®“å®¢æˆ¶é‚„åœ¨é‚£é‚Šé¸ã€Œå“ªå¹¾å¼µåœ–æ˜¯å…¬è»Šã€ä¹‹é¡çš„ï¼Œè¡¨å–®è¼¸å…¥é–€æª»æœƒä½å¾ˆå¤šã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>&lt;strong>Checkbox (checkbox challenge) site keys&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>æ‰€è¬‚ &lt;code>Checkbox&lt;/code> å°±çœŸçš„æ˜¯ã€Œæ ¸å–æ–¹å¡Šã€çš„æ„æ€ï¼ˆå¦‚ä¸‹åœ–ç¤ºï¼‰ï¼Œä»–éœ€è¦ä½¿ç”¨è€…çœŸçš„å»å°é€™å€‹ &lt;code>Checkbox&lt;/code> åšå€‹é»æ“Šçš„å‹•ä½œï¼Œè—‰æ­¤åˆ¤æ–·è·Ÿç¶²é äº’å‹•çš„å°åƒæ˜¯å¦ç‚ºã€ŒçœŸäººã€åœ¨æ“ä½œã€‚æƒ³ç•¶ç„¶çš„ï¼Œé€™ç¨®é©—è­‰æ–¹å¼ä¸€å®šè¦è·Ÿä½¿ç”¨è€…ç™¼ç”Ÿäº’å‹•ï¼Œæ‰€ä»¥åªèƒ½ç”¨åœ¨ã€Œç¶²é ã€çš„ä»‹é¢ä¸Šï¼Œå°¤å…¶ç‰¹åˆ¥é©åˆç”¨åœ¨ã€Œè¡¨å–®å¡«å¯«ã€ã€ã€Œç¶²ç«™ç™»å…¥ã€ã€ã€Œè¨»å†Šæœƒå“¡ã€ç­‰ç¶²é åŠŸèƒ½ï¼Œä½†ä¸é©ç”¨æ–¼é€éã€Œæ‰‹æ©Ÿ APPã€æˆ–å…¶ä»–äº’å‹•æ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696102_3bffe38a83_o.gif"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>é€™ç¨®é©—è­‰æ–¹å¼å¯èƒ½ä¸é©ç”¨æ–¼æ‰€æœ‰æƒ…å¢ƒï¼Œä¾‹å¦‚è¦æä¾›ã€Œ&lt;strong>ç„¡éšœç¤™&lt;/strong>ã€ç¶²ç«™çš„è©±ï¼Œå°ã€Œè¦–è¦ºã€æœ‰å•é¡Œçš„ç”¨æˆ¶å°±æœƒå¾ˆä¸æ–¹ä¾¿ï¼Œå› æ­¤ä½¿ç”¨æ™‚è¦æ³¨æ„ã€‚è©³è¦‹ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/choose-key-type#captcha-challenges" target="_blank" rel="noopener"
>Understanding the caveats with CAPTCHA challenges&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;ol start="3">
&lt;li>&lt;strong>reCAPTCHA WAF site keys&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>é€™å€‹ reCAPTCHA WAF site keys å¯ä»¥è®“ä½ æŠŠ sitekey å®‰è£åœ¨ WAF (æ‡‰ç”¨ç¨‹å¼é˜²ç«ç‰†) é€™ä¸€å±¤ï¼Œä½†é€™ç¨®ä½œæ³•å¿…é ˆè¦åˆæ ¼çš„ WAF service provider æ‰èƒ½ä½¿ç”¨ï¼Œä¾‹å¦‚ GCP è‡ªå®¶çš„ &lt;a class="link" href="https://cloud.google.com/armor" target="_blank" rel="noopener"
>Google Cloud Armor&lt;/a> æœå‹™ã€‚è©³æƒ…è«‹è¦‹ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/integration-overview" target="_blank" rel="noopener"
>reCAPTCHA Enterprise for WAF and Google Cloud Armor integration overview&lt;/a> èªªæ˜ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="æ•´åˆ-recaptcha-enterprise-çš„å¤§è‡´æµç¨‹">æ•´åˆ reCAPTCHA Enterprise çš„å¤§è‡´æµç¨‹&lt;/h2>
&lt;p>æƒ³è¦æ•´åˆ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> åˆ°ä½ çš„ç¶²ç«™ï¼Œå»ºè­°å¤šå°‘ç†è§£ä¸€ä¸‹ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> çš„é‹ä½œæµç¨‹ï¼Œä½ å¯ä»¥å¾ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/overview#how-recaptcha-enterprise-works" target="_blank" rel="noopener"
>How reCAPTCHA Enterprise works&lt;/a> çœ‹åˆ°ä»¥ä¸‹å¾ªåºåœ–(sequence diagram)ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696092_e332ed9cc8_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>å³ä¾¿ä½ å¤§æ¦‚çŸ¥é“é€™å€‹æµç¨‹ï¼Œæˆ‘é‚„æ˜¯è¦ºå¾—æ•´åˆ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> æœ‰ä¸€é»å°é–€æª»ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—ç°¡åŒ–æˆä»¥ä¸‹ 3 å€‹æ­¥é©Ÿä¾†èªªæ˜ï¼š&lt;/p>
&lt;ol>
&lt;li>ç”³è«‹ reCAPTCHA keys éšæ®µ&lt;/li>
&lt;/ol>
&lt;p>ä½ è¦åˆ° &lt;a class="link" href="https://console.cloud.google.com/" target="_blank" rel="noopener"
>Google Cloud console&lt;/a> å»ºç«‹ &lt;a class="link" href="https://console.cloud.google.com/security/recaptcha" target="_blank" rel="noopener"
>reCAPTCHA keys&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>ä¹Ÿå¯ä»¥å¾ &lt;a class="link" href="https://console.cloud.google.com/" target="_blank" rel="noopener"
>Google Cloud console&lt;/a> å·¦ä¸Šè§’çš„&lt;strong>æ¼¢å ¡é¸å–®&lt;/strong>é¸å– &lt;code>Security&lt;/code> &amp;gt; &lt;code>reCAPTCHA Enterprise&lt;/code> é€²å…¥æ­¤é é¢ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>æ”¶é›†å‰ç«¯ä½¿ç”¨è€…å›æ‡‰å€¼éšæ®µ&lt;/li>
&lt;/ol>
&lt;p>å®‰è£ reCAPTCHA keys åˆ°ç¶²é ä¸Š (ä¸»è¦ç”¨ä¾†æ”¶é›† reCAPTCHA å›æ‡‰å€¼)&lt;/p>
&lt;ol start="3">
&lt;li>å¾Œç«¯è©•ä¼°èˆ‡é©—è­‰å›æ‡‰å€¼éšæ®µ&lt;/li>
&lt;/ol>
&lt;p>é€™å€‹æ­¥é©Ÿæœƒå…ˆå¾å¾Œç«¯æ‡‰ç”¨ç¨‹å¼å–å¾—å‰ç«¯å‚³ä¾†çš„å›æ‡‰å€¼ï¼Œä¸¦å°‡å›æ‡‰å€¼é€åˆ° reCAPTCHA Server é€²è¡Œè©•ä¼°(assessment)ï¼Œä¸¦å–å¾—ä¸€å€‹è©•ä¼°å¾Œçš„ Score (åˆ†æ•¸)ï¼Œå¾è©²åˆ†æ•¸åˆ¤æ–·é€™å€‹ HTTP è¦æ±‚æ˜¯å¦è¦å…è¨±é€šéã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ­¤æ­¥é©Ÿæœ€ç‚ºéº»ç…©ï¼Œä¸»å› æ˜¯ç¼ºå°‘ ASP.NET Core ç¯„ä¾‹ï¼Œæ‰€ä»¥ä¸Šæ‰‹ç¢ºå¯¦æœ‰é»é–€æª»ï¼&lt;/p>
&lt;/blockquote>
&lt;p>ä»¥ä¸‹æˆ‘å°±ä¾æ“šé€™ä¸‰å€‹éšæ®µï¼Œåˆ†åˆ¥èªªæ˜ä½œæ³•ï¼&lt;/p>
&lt;hr>
&lt;h2 id="ç”³è«‹-recaptcha-keys-éšæ®µ">ç”³è«‹ reCAPTCHA keys éšæ®µ&lt;/h2>
&lt;blockquote>
&lt;p>å¯ä»¥åƒè€ƒ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/create-key" target="_blank" rel="noopener"
>Creating reCAPTCHA keys&lt;/a> é€™ä»½æ–‡ä»¶é€²è¡Œæ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>
&lt;p>ä½ è¦å…ˆæœ‰ä¸€å€‹ &lt;a class="link" href="https://accounts.google.com/" target="_blank" rel="noopener"
>Google å¸³æˆ¶&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ Google Cloud Console &lt;a class="link" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects#creating_a_project" target="_blank" rel="noopener"
>å»ºç«‹ä¸€å€‹æ–°å°ˆæ¡ˆ&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674484149_6ce66d6192_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;ol start="3">
&lt;li>å•Ÿç”¨ &lt;code>reCAPTCHA Enterprise API&lt;/code> æœå‹™&lt;/li>
&lt;/ol>
&lt;p>é€²å…¥ &lt;a class="link" href="https://console.cloud.google.com/security/recaptcha" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> é é¢ï¼Œå¦‚æœå°šæœªå•Ÿç”¨ &lt;code>reCAPTCHA Enterprise API&lt;/code> æœå‹™çš„è©±ï¼Œæœƒå…ˆå‡ºç¾ä»¥ä¸‹ç•«é¢ï¼Œä½ å¿…é ˆé¸å° GCP ä¸Šé¢çš„å°ˆæ¡ˆ(Project)ï¼Œç„¶å¾ŒæŒ‰ä¸‹ &lt;code>ENABLE&lt;/code> å•Ÿç”¨æœå‹™ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696137_7386c9123f_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;ol start="4">
&lt;li>å»ºç«‹ reCAPTCHA keys&lt;/li>
&lt;/ol>
&lt;p>é€²å…¥ &lt;a class="link" href="https://console.cloud.google.com/security/recaptcha" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> é é¢&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674484179_2eec4888a1_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>è¼¸å…¥ä¸€å€‹é¡¯ç¤ºåç¨±(&lt;code>Display name&lt;/code>)èˆ‡ä½¿ç”¨ reCAPTCHA keys çš„å¹³å°(&lt;code>Platform type&lt;/code>)ï¼Œç”±æ–¼æˆ‘å€‘æ˜¯ä¸€å€‹ç¶²ç«™æœå‹™ï¼Œæ‰€ä»¥è¨˜å¾—é¸æ“‡ &lt;code>Website&lt;/code> é¸é …&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631195_2268de597c_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>å¦‚æœæ˜¯ç¶²ç«™ä½¿ç”¨ï¼Œå°±è¦è¨­å®šç¶²ç«™çš„åŸŸååœ¨æ­¤ï¼Œä½ å¯ä»¥æ–°å¢å¤šå€‹åŸŸåï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631220_9938c87bde_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æœ€å¾ŒæŒ‰ä¸‹ &lt;code>CREATE KEY&lt;/code> å»ºç«‹å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674192016_124de38d87_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr>
&lt;h2 id="æ”¶é›†å‰ç«¯ä½¿ç”¨è€…å›æ‡‰å€¼éšæ®µ">æ”¶é›†å‰ç«¯ä½¿ç”¨è€…å›æ‡‰å€¼éšæ®µ&lt;/h2>
&lt;p>æˆ‘å€‘å¾ä¸Šä¸€å€‹æ­¥é©Ÿå¯ä»¥çœ‹åˆ°ä¸€å€‹ &lt;code>Web integration&lt;/code> å€æ®µï¼Œé€™è£¡æœ‰ä¸€æ®µ JavaScript ç¨‹å¼ç¢¼ç‰‡æ®µï¼Œä½ ç›´æ¥è¤‡è£½èµ·ä¾†ï¼Œè²¼ä¸Šåˆ°ç¶²é çš„ &lt;code>&amp;lt;head&amp;gt;&lt;/code> å€æ®µå…§ï¼Œå³å¯é–‹å§‹æ”¶é›†å‰ç«¯ä½¿ç”¨è€…å›æ‡‰å€¼ã€‚&lt;/p>
&lt;p>ç¯„ä¾‹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://www.google.com/recaptcha/enterprise.js?render=6LdSxPgjAAAAAGTKX703ydrWNF8WbQv2pZbRXGyX&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">grecaptcha&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">enterprise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ready&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">grecaptcha&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">enterprise&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">execute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;6LdSxPgjAAAAAGTKX703ydrWNF8WbQv2pZbRXGyX&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">action&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;login&amp;#39;&lt;/span>&lt;span class="p">}).&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™è£¡ç‰¹åˆ¥éœ€è¦çŸ¥é“çš„åœ°æ–¹æœ‰ä»¥ä¸‹å¹¾é»ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ç¨‹å¼ç¢¼ç‰‡æ®µçš„ &lt;code>6LdSxPgjAAAAAGTKX703ydrWNF8WbQv2pZbRXGyX&lt;/code> å°±æ˜¯ä½ çš„ &lt;code>reCAPTCHA key&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€™è£¡çš„ &lt;code>grecaptcha.enterprise.ready()&lt;/code> å‡½å¼æœƒåœ¨è¼‰å…¥å®Œ reCAPTCHA Enterprise å‡½å¼åº«å¾ŒåŸ·è¡Œï¼ŒåªæœƒåŸ·è¡Œä¸€æ¬¡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€™è£¡çš„ &lt;code>grecaptcha.enterprise.execute()&lt;/code> å‡½å¼å‰‡æœƒåŸ·è¡Œ reCAPTCHA é©—è­‰ï¼ˆé€™å€‹å‡½å¼æœƒå›å‚³ä¸€å€‹ Promise ç‰©ä»¶ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€™è£¡çš„ &lt;code>{ action: 'login'}&lt;/code> ä¹Ÿå¾ˆé‡è¦ï¼Œé€™è£¡æ˜¯è¨­å®šä¸€å€‹ã€Œé©—è­‰å‹•ä½œã€çš„é¡å‹ï¼Œé€™å€‹å€¼è¦è·Ÿå¾Œç«¯é€²è¡Œé©—è­‰æ™‚ä½¿ç”¨ç›¸åŒçš„ &lt;code>action&lt;/code> æ‰è¡Œ&lt;br>
Google reCAPTCHA çš„ &lt;code>action&lt;/code> åƒæ•¸å¯ä»¥æ˜¯ä»»ä½•å­—ä¸²ï¼Œå®ƒå¯ä»¥ç”¨ä¾†æ¨™è¨˜é©—è­‰çš„ç›®çš„æˆ–é¡å‹ã€‚ä¸€äº›å¸¸ç”¨çš„ &lt;code>action&lt;/code> å€¼åŒ…æ‹¬ï¼š&lt;code>login&lt;/code> (ç”¨æ–¼ç™»å…¥é©—è­‰)ã€&lt;code>register&lt;/code> (ç”¨æ–¼è¨»å†Šé©—è­‰)ã€&lt;code>password_reset&lt;/code> (ç”¨æ–¼å¯†ç¢¼é‡ç½®é©—è­‰)ã€&lt;code>contact&lt;/code> (ç”¨æ–¼è¯ç¹«è¡¨å–®é©—è­‰)ï¼Œä½†å…¶å¯¦æ²’æœ‰ä¸€å®šè¦ç”¨å“ªä¸€ç¨®ï¼Œä¸çŸ¥é“è¦æŒ‘å“ªä¸€ç¨®çš„è©±ï¼Œä½ éš¨ä¾¿é¸å€‹ &lt;code>login&lt;/code> å…¶å¯¦éƒ½å¯ä»¥ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¨‹å¼ç¢¼ç‰‡æ®µä¸­çš„ &lt;code>...&lt;/code> ä¸æ˜¯çœŸçš„ç¨‹å¼ç¢¼ï¼Œè€Œæ˜¯ä¸€å€‹è¦ä½ å®¢è£½åŒ–ä¿®æ”¹çš„åœ°æ–¹ï¼&lt;br>
ç”±æ–¼ &lt;code>grecaptcha.enterprise.execute()&lt;/code> å‡½å¼æ˜¯ä¸€å€‹ Promise ç‰©ä»¶ï¼Œä½ å¯ä»¥é€é &lt;code>.then()&lt;/code> å¸¶å…¥çš„ function callback å¾—åˆ°ä¸€å€‹ &lt;code>token&lt;/code> å­—ä¸²ï¼Œé€™å€‹å°±æ˜¯ç”± reCAPTCHA Enterprise å¹«ä½ æ”¶é›†å¥½çš„ã€Œå›æ‡‰å€¼ã€ï¼Œä½ è¦è¨­æ³•å°‡é€™å€‹å€¼å¸¶åˆ°å¾Œç«¯å»é©—è­‰ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>é€™è£¡æœ‰å€‹åœ°é›·æ˜¯ï¼Œé€™å€‹é€é &lt;code>grecaptcha.enterprise.execute()&lt;/code> å‡½å¼å–å›çš„ &lt;code>token&lt;/code> æœ‰æ•ˆæœŸåªæœ‰ &lt;code>2 åˆ†é˜&lt;/code>ï¼&lt;/p>
&lt;p>å„ä½~åªæœ‰ &lt;code>2&lt;/code> åˆ†é˜å°±æœƒ&lt;strong>éæ™‚&lt;/strong>/&lt;strong>éæœŸ&lt;/strong>ï¼åªè¦ &lt;code>2&lt;/code> åˆ†é˜å°±æœƒ &lt;strong>Timeout&lt;/strong>ï¼åªè¦ 2 åˆ†é˜å°±&lt;strong>ä¸èƒ½ç”¨&lt;/strong>äº†ï¼&lt;/p>
&lt;blockquote>
&lt;p>å¾ˆé‡è¦ï¼Œæ‰€ä»¥èªªä¸‰éï¼Œç‚ºäº† SEO è¦æ±‚ï¼Œæˆ‘ç”¨ä¸‰ä»½é—œéµå­—æè¿°ï¼ğŸ”¥&lt;/p>
&lt;/blockquote>
&lt;p>è¶…é &lt;code>2&lt;/code> åˆ†é˜ä¹‹å¾Œé€™å€‹ &lt;code>token&lt;/code> å°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥åƒè¬ä¸èƒ½åœ¨ã€Œ&lt;strong>ç¶²é è¼‰å…¥&lt;/strong>ã€çš„æ™‚å€™å°±å–å¾— &lt;code>token&lt;/code> å›æ‡‰å€¼ï¼Œå¦å‰‡è¡¨å–®å¡«å¯«è¶…é 2 åˆ†é˜ä¹‹å¾Œä¸å°±è‡ªå‹•å¤±æ•ˆäº†å—ï¼Ÿé€™å€‹æ³¨æ„äº‹é …æ˜¯æœ‰å‡ºç¾åœ¨ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/create-assessment#retrieve_token" target="_blank" rel="noopener"
>Create an assessment&lt;/a> å®˜æ–¹æ–‡ä»¶ä¸­ï¼Œæˆ‘æœ‰é»æ‡·ç–‘æœƒæœ‰å¤šå°‘äººçœ‹åˆ°ï¼ŸğŸ˜…&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631260_e53b2911b2_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr>
&lt;h2 id="å¾Œç«¯è©•ä¼°èˆ‡é©—è­‰å›æ‡‰å€¼éšæ®µ">å¾Œç«¯è©•ä¼°èˆ‡é©—è­‰å›æ‡‰å€¼éšæ®µ&lt;/h2>
&lt;p>é€™è£¡çš„æ­¥é©Ÿå°±æœ‰é»å¤šäº†ï¼Œæˆ‘æœƒä»¥ ASP.NET Core 6 ç‚ºä¾‹é€²è¡Œè§£èªªå®Œæ•´æ­¥é©Ÿã€‚&lt;/p>
&lt;ol>
&lt;li>åˆ° Google Cloud Console çš„ &lt;a class="link" href="https://console.cloud.google.com/iam-admin/serviceaccounts" target="_blank" rel="noopener"
>IAM &amp;amp; Admin &amp;gt; Service accounts&lt;/a> å»ºç«‹ä¸€å€‹æœå‹™å¸³æˆ¶(&lt;code>Service Accounts&lt;/code>)&lt;/li>
&lt;/ol>
&lt;p>è¦å¾ç¶²ç«™çš„å¾Œç«¯å‘¼å« GCP ä¸Šé¢çš„ API æœå‹™ï¼Œéƒ½éœ€è¦æœ‰ä¸€å€‹èº«åˆ†(Principal)ä¾†å‘¼å« API æœå‹™ã€‚ä½ å¯ä»¥å¾ &lt;code>APIs &amp;amp; Services &amp;gt; Enabled APIs &amp;amp; Services&lt;/code> æ‰¾åˆ° &lt;code>reCAPTCHA Enterprise API&lt;/code> æœå‹™ï¼Œé»æ“Šé€²å»ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631275_d9921c7606_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æˆ‘å€‘è¦å»ºç«‹ä¸€å€‹ reCAPTCHA Enterprise API æ‰€éœ€çš„ &lt;code>CREDENTIALS&lt;/code> (èº«åˆ†èªè­‰)&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696297_58025d471a_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é€™è£¡æœ‰å…©å€‹é¸é …ï¼Œæˆ‘å€‘é€éç¶²ç«™æ•´åˆ reCAPTCHA Enterprise API ä¸€å®šæ˜¯ä½¿ç”¨ &lt;code>Service Accounts&lt;/code> (æœå‹™å¸³æˆ¶) é€™é …ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696327_de9d0c8ac1_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>è¨­å®šä¸€å€‹æœå‹™å¸³æˆ¶åç¨±ï¼Œå¥½è¨˜å°±å¥½&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674695908_0e1455e917_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ğŸ”¥ &lt;strong>é€™å€‹æ­¥é©Ÿè¶…ç´šé‡è¦&lt;/strong>ï¼Œä½ è¦æ˜¯ä¸åœ¨é€™è£¡é¸å° Role (è§’è‰²)ï¼Œä¹Ÿå°±æ˜¯ &lt;code>reCAPTCHA Enterprise Agent&lt;/code>ï¼Œå°±ç®—ä½ å–å¾— &lt;code>Service Account&lt;/code> ä¹Ÿæ²’æœ‰æ¬Šé™å‘¼å« &lt;code>reCAPTCHA Enterprise API&lt;/code>ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696372_5009fe8da3_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631365_1ebb8a6d4b_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>å¦‚æœæ²’è¨­å®šçš„è©±ï¼Œä½ çš„ ASP.NET Core åŸ·è¡Œæ™‚å°±æœƒå¾—åˆ°ä»¥ä¸‹éŒ¯èª¤è¨Šæ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Status&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StatusCode&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;PermissionDenied&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Detail&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;Permission denied for: recaptchaenterprise.assessments.create. Please ensure you have sufficient permissions: https://cloud.google.com/iam/docs/granting-changing-revoking-access&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™å€‹æ­¥é©Ÿå¯ä»¥ä¸ç”¨è¨­å®šï¼Œç›´æ¥æŒ‰ä¸‹ &lt;code>DONE&lt;/code> å®Œæˆè¨­å®šã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52673696422_6947c5edc3_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é»æ“Šé€²å…¥å‰›å‰›å»ºç«‹çš„æœå‹™å¸³æˆ¶&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674696068_f6abd56af7_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ğŸ”¥ åˆ‡æ›åˆ° &lt;code>KEYS&lt;/code> é ç±¤ï¼Œå»ºç«‹ä¸€æŠŠæ–°çš„&lt;strong>ç§å¯†é‡‘é‘°&lt;/strong>(key)ï¼Œä¸»è¦ç”¨ä¾†çµ¦å¾Œç«¯ç¨‹å¼å‘¼å« API æ™‚é€šéé©—è­‰ç”¨ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674192246_6df4520a36_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>å»ºç«‹é‡‘é‘°å¯ä»¥é¸æ“‡å…©ç¨®æ ¼å¼ï¼Œæˆ‘å€‘é¸æ“‡ &lt;code>JSON&lt;/code> æ ¼å¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674696038_3fa8ea1c95_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ğŸ”¥ æŒ‰ä¸‹ CREATE ä¹‹å¾Œï¼Œç€è¦½å™¨å°±æœƒç›´æ¥ä¸‹è¼‰ä¸€å€‹ *.json æª”æ¡ˆï¼Œé€™å€‹æª”æ¡ˆå°±æ˜¯æˆ‘å€‘çš„é‡‘é‘°æª”ï¼Œä¹‹å¾Œåœ¨ ASP.NET Core ç¶²ç«™ä¸­ç”¨çš„åˆ°ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631420_be947a72f5_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é€™å€‹ JSON æª”æ¡ˆçš„å…§å®¹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;service_account&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;project_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;recaptchademo-374714&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;private_key_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;9462e07151d......181083e38c718503&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;private_key&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;-----BEGIN PRIVATE KEY-----\nM...g=\n-----END PRIVATE KEY-----\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;client_email&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;myrecaptcha@recaptchademo-374714.iam.gserviceaccount.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;client_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;11581452......4955852&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;auth_uri&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://accounts.google.com/o/oauth2/auth&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;token_uri&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://oauth2.googleapis.com/token&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;auth_provider_x509_cert_url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://www.googleapis.com/oauth2/v1/certs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;client_x509_cert_url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://www.googleapis.com/robot/v1/metadata/x509/myrecaptcha%40recaptchademo-374714.iam.gserviceaccount.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>é€™å€‹æ­¥é©Ÿæˆ‘åšäº†å¥½å¹¾æ¬¡ï¼Œæ¼æ‰ä¸€å…©æ­¥å°±åˆ¥æƒ³ç©ä¸‹å»äº†ï¼Œæ‰€ä»¥ GCP å°±æ˜¯ä¸»è¦çš„é–€æª»æ‰€åœ¨ï¼ğŸ˜…&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>åœ¨ ASP.NET Core ç¶²ç«™å®‰è£ &lt;a class="link" href="https://www.nuget.org/packages/Google.Cloud.RecaptchaEnterprise.V1" target="_blank" rel="noopener"
>Google.Cloud.RecaptchaEnterprise.V1&lt;/a> NuGet å¥—ä»¶&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet add package Google.Cloud.RecaptchaEnterprise.V1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>è¨­å®š ASP.NET Core ç¶²ç«™çš„ DI å®¹å™¨ (ServiceCollection)&lt;/li>
&lt;/ol>
&lt;p>ä»¥ä¸‹ç¨‹å¼ç¢¼æœƒå°‡ &lt;code>RecaptchaEnterpriseServiceClient&lt;/code> è¨»å†Šæˆ Singletonï¼Œä¸¦è¨­å®š JsonCredentials ç‚ºæˆ‘å€‘å‰›å‰›ä¸‹è¼‰çš„ç§å¯†é‡‘é‘° JSON æª”ï¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddRecaptchaEnterpriseServiceClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">JsonCredentials&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">File&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ReadAllText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;recaptchademo-374714-9462e07151d4.json&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœæ²’æœ‰æŒ‡å®š &lt;code>Credentials&lt;/code> çš„è©±ï¼ŒåŸ·è¡Œæ™‚å°±æœƒå¾—åˆ°ä»¥ä¸‹éŒ¯èª¤è¨Šæ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">Application&lt;/span> &lt;span class="n">Default&lt;/span> &lt;span class="n">Credentials&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">available&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">They&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">available&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">running&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">Google&lt;/span> &lt;span class="n">Compute&lt;/span> &lt;span class="n">Engine&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Otherwise&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">environment&lt;/span> &lt;span class="n">variable&lt;/span> &lt;span class="n">GOOGLE_APPLICATION_CREDENTIALS&lt;/span> &lt;span class="n">must&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="n">pointing&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">defining&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">credentials&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">See&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">developers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">accounts&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">application&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">credentials&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">information&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>åœ¨ Controller çš„å»ºæ§‹å¼æ³¨å…¥ &lt;code>RecaptchaEnterpriseServiceClient&lt;/code> ç‰©ä»¶&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="n">RecaptchaEnterpriseServiceClient&lt;/span> &lt;span class="n">_recaptchaClient&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="n">ContactController&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RecaptchaEnterpriseServiceClient&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">_recaptchaClient&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>å»ºç«‹ä¸€å€‹ &lt;code>createAssessmentAsync&lt;/code> æ–¹æ³• (Method)&lt;/li>
&lt;/ol>
&lt;p>æˆ‘åƒè€ƒ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/create-assessment#c" target="_blank" rel="noopener"
>Create an assessment using the REST API or Client Libraries&lt;/a> çš„ C# ç¯„ä¾‹ç¨‹å¼é€²è¡Œæ”¹å¯«å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Create an assessment to analyze the risk of an UI action.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// projectID: GCloud Project ID.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// recaptchaSiteKey: Site key obtained by registering a domain/app to use recaptcha.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// token: The token obtained from the client on passing the recaptchaSiteKey.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// recaptchaAction: Action name corresponding to the token.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span> &lt;span class="kd">async&lt;/span> &lt;span class="n">Task&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">createAssessmentAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">projectID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;recaptchademo-374714&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">recaptchaSiteKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;6LdSxPgjAAAAAGTKX703ydrWNF8WbQv2pZbRXGyX&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">recaptchaAction&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;login&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsNullOrWhiteSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ArgumentException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The `token` argument must not empty.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ProjectName&lt;/span> &lt;span class="n">projectName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ProjectName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">projectID&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Build the assessment request.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CreateAssessmentRequest&lt;/span> &lt;span class="n">createAssessmentRequest&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">CreateAssessmentRequest&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Assessment&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Assessment&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Set the properties of the event to be tracked.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Event&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Event&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SiteKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">recaptchaSiteKey&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExpectedAction&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">recaptchaAction&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ParentAsProjectName&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">projectName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Assessment&lt;/span> &lt;span class="n">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="n">_recaptchaClient&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CreateAssessmentAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">createAssessmentRequest&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Check if the token is valid.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TokenProperties&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Valid&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LogInformation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The CreateAssessment call failed because the token was: &amp;#34;&lt;/span> &lt;span class="p">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TokenProperties&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">InvalidReason&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Check if the expected action was executed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TokenProperties&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Action&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="n">recaptchaAction&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LogInformation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The action attribute in reCAPTCHA tag is: &amp;#34;&lt;/span> &lt;span class="p">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TokenProperties&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Action&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LogInformation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The action attribute in the reCAPTCHA tag does not &amp;#34;&lt;/span> &lt;span class="p">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;match the action you are expecting to score&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Get the risk score and the reason(s).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// For more information on interpreting the assessment,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// see: https://cloud.google.com/recaptcha-enterprise/docs/interpret-assessment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">score&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RiskAnalysis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Score&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LogInformation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The reCAPTCHA score is: &amp;#34;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">score&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">foreach&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RiskAnalysis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ClassificationReason&lt;/span> &lt;span class="n">reason&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RiskAnalysis&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Reasons&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">LogInformation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reason&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// https://developers.google.com/recaptcha/docs/analytics&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// This chart shows the average score on your site, which is designed to help you spot trends.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Scores range from 0.0 to 1.0, with 0.0 indicating abusive traffic and 1.0 indicating good traffic.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Sign up for reCAPTCHA v3 to gain more insights about your traffic.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">score&lt;/span> &lt;span class="p">&amp;gt;&lt;/span> &lt;span class="m">0.5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™è£¡ method ç¸½å…±æœ‰ 4 å€‹åƒæ•¸ï¼Œéƒ½å¾ˆé‡è¦ï¼Œé™¤äº† &lt;code>token&lt;/code> ä¹‹å¤–ï¼Œå…¶ä»–éƒ½å¯ä»¥å¯«é€² &lt;code>appsettings.json&lt;/code> çµ„æ…‹ä¹‹ä¸­ï¼&lt;/p>
&lt;p>å› ç‚º GCP ä¸Šçš„æ¯å€‹ã€Œå°ˆæ¡ˆã€éƒ½æœ‰å€‹å”¯ä¸€çš„ &lt;code>projectID&lt;/code>ï¼Œä½ è¦ç‰¹åˆ¥æŸ¥æ‰çŸ¥é“æ˜¯ä»€éº¼ï¼Œé€™è£¡çš„ &lt;code>projectID&lt;/code> è¦è¨˜å¾—åˆ° &lt;a class="link" href="https://console.cloud.google.com/welcome" target="_blank" rel="noopener"
>https://console.cloud.google.com/welcome&lt;/a> æŸ¥é–±ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674484434_7414cca050_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é€™è£¡çš„ &lt;code>recaptchaSiteKey&lt;/code> å°±æ˜¯ä½ å…ˆå‰å»ºç«‹ site key æ™‚æ‹¿åˆ°çš„é‚£çµ„ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52674631405_347fa4a156_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é€™è£¡çš„ &lt;code>recaptchaAction&lt;/code> å¿…é ˆè·Ÿä½ åœ¨ã€Œæ”¶é›†å‰ç«¯ä½¿ç”¨è€…å›æ‡‰å€¼éšæ®µã€è¨­å®šçš„ &lt;code>{action: 'login'}&lt;/code> å®Œå…¨ä¸€æ¨£ï¼Œé€™è£¡æ˜¯è¨­å®šä¸€å€‹ã€Œé©—è­‰å‹•ä½œã€çš„é¡å‹ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ä¸²ï¼&lt;/p>
&lt;p>ç¨‹å¼ç¢¼é‚è¼¯çš„éƒ¨åˆ†æˆ‘å°±ä¸è´…è¿°äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±çœ‹ï¼Œæ‡‰è©²å¾ˆå®¹æ˜“ç†è§£ã€‚æœ€å¾Œçš„ &lt;code>if (score &amp;gt; 0.5) {}&lt;/code> å°±æ˜¯åœ¨åˆ¤æ–·æ€æ¨£çš„åˆ†æ•¸å…è¨±é€šéé©—è­‰ï¼ŒåŸºæœ¬ä¸Šåˆ†æ•¸åªæœƒä»‹æ–¼ &lt;code>0.0&lt;/code> ~ &lt;code>1.0&lt;/code> ä¹‹é–“ï¼Œå…± 11 å€‹ç­‰ç´šã€‚ä½†åœ¨å°šæœªé€šé &lt;a class="link" href="https://go.chronicle.security/recaptchaupgrade" target="_blank" rel="noopener"
>Google Security Review&lt;/a> çš„å‰æä¸‹ï¼Œé è¨­åªæœƒæœ‰ &lt;code>0.1&lt;/code>ã€&lt;code>0.3&lt;/code>ã€&lt;code>0.7&lt;/code> èˆ‡ &lt;code>0.9&lt;/code> é€™å››å€‹ç­‰ç´šï¼Œæ‰€ä»¥å»ºè­° &lt;code>Score&lt;/code> çµæœçš„åˆ¤æ–·å¼ä¸è¦ç”¨ == ä¾†å¯«ï¼Œç”¨ &lt;code>&amp;lt;&lt;/code>ã€&lt;code>&amp;lt;=&lt;/code> æˆ– &lt;code>&amp;gt;&lt;/code>ã€&lt;code>&amp;gt;=&lt;/code> æ‰æ˜¯æ¯”è¼ƒæ­£ç¢ºçš„å¯«æ³•ï¼&lt;/p>
&lt;ol start="6">
&lt;li>æœ€å¾Œè¦ä½¿ç”¨å°±å¾ˆç°¡å–®äº†ï¼Œä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ Action ä½¿ç”¨ç¯„ä¾‹&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="na">[HttpPost]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">[ValidateAntiForgeryToken]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="kd">async&lt;/span> &lt;span class="n">Task&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IActionResult&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">Index&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">FromForm&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">ContactViewModel&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">await&lt;/span> &lt;span class="n">createAssessmentAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RecaptchaToken&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">NoContent&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">BadRequest&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="ç¸½çµ">ç¸½çµ&lt;/h2>
&lt;p>æ•´åˆ Google çš„ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> å¯¦åœ¨å¤ªå¤šé›·äº†ï¼Œé€™å° &lt;a class="link" href="https://cloud.google.com/" target="_blank" rel="noopener"
>Google Cloud Platform&lt;/a> ä¸å¤ªç†Ÿæ‚‰çš„äººä¾†èªªï¼Œæ•´åˆèµ·ä¾†è‘—å¯¦æœ‰ä¸å°çš„é–€æª»ï¼Œæœ¬æ–‡é€™éº¼å¤šæ­¥é©Ÿï¼Œè¦æ˜¯æˆ‘ä¸è¨˜éŒ„ä¸‹ä¾†ï¼Œéä¸€æ®µæ™‚é–“æˆ‘è‚¯å®šåˆå¿˜è¨˜äº†ï¼ğŸ˜…&lt;/p>
&lt;p>æˆ‘ä¾†é‡æ–°ç¸½çµä¸€ä¸‹æ•´å€‹é–‹ç™¼éç¨‹ï¼š&lt;/p>
&lt;ol>
&lt;li>å…ˆåˆ° &lt;a class="link" href="https://console.cloud.google.com/" target="_blank" rel="noopener"
>Google Cloud console&lt;/a> å»ºç«‹ &lt;a class="link" href="https://console.cloud.google.com/security/recaptcha" target="_blank" rel="noopener"
>reCAPTCHA keys&lt;/a>&lt;br>
ä½ å¯èƒ½éœ€è¦&lt;a class="link" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects#creating_a_project" target="_blank" rel="noopener"
>å»ºç«‹ä¸€å€‹æ–°å°ˆæ¡ˆ&lt;/a>ï¼Œä¸¦å•Ÿç”¨ &lt;code>reCAPTCHA Enterprise API&lt;/code> æœå‹™ï¼Œç„¶å¾Œæ‰èƒ½å»ºç«‹ &lt;a class="link" href="https://console.cloud.google.com/security/recaptcha" target="_blank" rel="noopener"
>reCAPTCHA keys&lt;/a>ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>æ¯å€‹ GCP ä¸Šé¢çš„æ–°å°ˆæ¡ˆï¼Œéƒ½éœ€è¦å€‹åˆ¥æ‰‹å‹•å•Ÿç”¨ API æœå‹™ã€‚å¦‚æœä½ é¸ç”¨å…ˆå‰å»ºç«‹éçš„å°ˆæ¡ˆï¼Œä¸” &lt;code>reCAPTCHA Enterprise API&lt;/code> æœå‹™å·²ç¶“å•Ÿç”¨éï¼Œé‚£å°±ä¸éœ€è¦å†æ¬¡å•Ÿç”¨ã€‚&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>
&lt;p>å®‰è£ &lt;a class="link" href="https://cloud.google.com/recaptcha-enterprise/docs/keys" target="_blank" rel="noopener"
>reCAPTCHA keys&lt;/a> åˆ°ç¶²é ä¸Š (å‰ç«¯ JavaScript ç‚ºä¸»)&lt;br>
é€™é‚Šéœ€è¦å¯«ä¸€é»é» JavaScript æ‰èƒ½å°‡ &lt;code>token&lt;/code> å›å¯«åˆ°è¡¨å–®ä¸Šï¼Œå¹«åŠ©å‰ç«¯å°‡ &lt;code>token&lt;/code> é€å›å¾Œç«¯è©•ä¼°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¾å¾Œç«¯è©•ä¼°å‰ç«¯é€ä¾†çš„ &lt;code>token&lt;/code> (å›æ‡‰å€¼) æ˜¯å¦æœ‰æ•ˆ&lt;br>
ä½ å¿…é ˆå»ºç«‹ä¸€å€‹ GCP ä¸Šçš„ &lt;code>Service Account&lt;/code> (æœå‹™å¸³æˆ¶)ï¼Œä¸¦è³¦äºˆ &lt;code>reCAPTCHA Enterprise Agent&lt;/code> è§’è‰²ã€‚ç„¶å¾Œç‚ºé€™å€‹ &lt;code>Service Account&lt;/code> å»ºç«‹ä¸€æŠŠ &lt;code>key&lt;/code> (ç§å¯†é‡‘é‘°) æ‰èƒ½çµ„æˆä¸€å€‹ &lt;code>Credential&lt;/code> (èº«åˆ†èªè­‰è³‡è¨Š) è®“æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ï¼Œç„¶å¾Œç”¨é€™ä»½ &lt;code>Credential&lt;/code> è·Ÿ &lt;code>reCAPTCHA Enterprise API&lt;/code> é€šè¨Šï¼Œå–å¾— &lt;code>Assessment&lt;/code> (è©•ä¼°) çµæœï¼Œç„¶å¾Œä¾æ“š &lt;code>Score&lt;/code> (åˆ†æ•¸) åˆ¤æ–·æ˜¯å¦ç‚ºçœŸäººçš„æµé‡ï¼Œé€šå¸¸é€™å€‹ &lt;code>Score&lt;/code> (åˆ†æ•¸) åªè¦å¤§æ–¼ç­‰æ–¼ &lt;code>0.7&lt;/code> é€šå¸¸å°±æ„å‘³è‘—å¯ä¿¡åº¦å¤ é«˜ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å¦å¤–ï¼Œæˆ‘æƒ³è£œå……èªªæ˜çš„æ˜¯ï¼Œ&lt;a class="link" href="https://www.google.com/recaptcha/about/" target="_blank" rel="noopener"
>reCAPTCHA Enterprise&lt;/a> æœ‰&lt;strong>æ¯æœˆ 100 è¬æ¬¡å…è²»ä½¿ç”¨é¡åº¦&lt;/strong>ï¼Œé€™äº›æ¬¡æ•¸ä¸»è¦æ˜¯ã€Œå¾Œç«¯ã€å° &lt;code>reCAPTCHA Enterprise API&lt;/code> ç™¼é€é©—è­‰ &lt;code>Assessment&lt;/code> (è©•ä¼°) çš„æ¬¡æ•¸ï¼Œå°è¨±å¤šç¶²ç«™ä¾†èªªï¼Œé€™å€‹æ•¸é‡æ‡‰è©²æ˜¯ç¶½ç¶½æœ‰é¤˜äº†ï¼Œæ‰€ä»¥æˆ‘æ‰è€ƒæ…®ç›´æ¥ä½¿ç”¨é€™å€‹æœå‹™ã€‚&lt;/p>
&lt;hr></description></item><item><title>ã€Server-Sent Eventã€‘åœ¨ç¶²é ç­‰å¾…æ‰‹æ©Ÿç«¯å®Œæˆæ“ä½œ</title><link>https://wayne-blog.com/2023-01-31/web-wait-for-qrcode-scan/</link><pubDate>Tue, 31 Jan 2023 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2023-01-31/web-wait-for-qrcode-scan/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52659620952_80251bfcbf_o.jpg" alt="Featured image of post ã€Server-Sent Eventã€‘åœ¨ç¶²é ç­‰å¾…æ‰‹æ©Ÿç«¯å®Œæˆæ“ä½œ" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://www.nuget.org/packages/Lib.AspNetCore.ServerSentEvents" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://tpeczek.github.io/Lib.AspNetCore.ServerSentEvents/articles/getting-started.html" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://learn.microsoft.com/zh-tw/aspnet/core/signalr/introduction?view=aspnetcore-7.0&amp;amp;WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://github.com/wjdesign/web-wait-for-qrcode-scan" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.darkthread.net/blog/sse-notify-example/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>å¤šå› ç´ èªè­‰(Multiple Factor Authenticationï¼ŒMFA)æ˜¯ç¶²é å¸¸æœƒç”¨åˆ°ä¸€ç¨®æŠ€å·§ï¼Œä»‹é¢åœåœ¨ç™»å…¥ç¶²é ï¼Œç­‰å¾…æ‰‹æ©Ÿ App æ“ä½œï¼Œç¶²é èƒ½åµæ¸¬ App å‹•ä½œæ˜¯å¦å®Œæˆï¼Œè‹¥é©—è­‰æˆåŠŸè‡ªå‹•å°å‘å·²ç™»å…¥ç•«é¢ï¼Œæœ¬ç¯‡ä¾†ç°¡æ˜“çš„å¯¦ä½œæ­¤æµç¨‹ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ä»¥-facebook-ç‚ºä¾‹">ä»¥ Facebook ç‚ºä¾‹&lt;/h2>
&lt;p>ä»¥ Facebook ç‚ºä¾‹ï¼Œè‹¥æœ‰å•Ÿå‹•å…©éšæ®µé©—è­‰ï¼Œç¬¬ä¸€æ¬¡ç™»å…¥ç¶²ç«™ï¼Œè¼¸å…¥å¯†ç¢¼å¾Œæœƒå‡ºç¾ä»¥ä¸‹ç•«é¢ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52660562085_5eb3d64294_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é™¤äº†é–‹ä»£ç¢¼ç”¢ç”Ÿå™¨(Authenticator App)æŸ¥é©—è­‰ç¢¼åœ¨ç¶²é è¼¸å…¥ï¼Œæœ‰å®‰è£ Facebook App ä¸”ç‚ºç™»å…¥ç‹€æ…‹çš„æ‰‹æ©Ÿä¹Ÿæœƒå‡ºç¾ã€Œå‰›å‰›æ˜¯ä½ æœ¬äººç™»å…¥çš„å—ï¼Ÿã€ç™»å…¥ï¼Œåªè¦æŒ‰ã€Œæ˜¯ã€å³å¯è·³éè¼¸å…¥é©—è­‰ç¢¼æ­¥é©Ÿï¼Œè‡ªå‹•é€²å…¥ç™»å…¥å¾Œç•«é¢ï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52660606878_50f14290d3_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr>
&lt;h2 id="å¯¦ä½œ">å¯¦ä½œ&lt;/h2>
&lt;p>ã€Œéœ€è¦é›™é‡é©—è­‰ç¢¼ã€ç¶²é å¿…å®šå¯æŒçºŒå¾ç¶²ç«™æ¥æ”¶æœ€æ–°ç‹€æ…‹ï¼Œæ‰èƒ½åšåˆ°æ‰‹æ©Ÿ App ä¸€æŒ‰ã€Œæ˜¯ã€é¦¬ä¸Šæ¥åˆ°é€šçŸ¥ã€‚å°å‰ç«¯ç¶²é ä¾†èªªï¼Œé€™ä¸æ˜¯ä»€éº¼æ–°é®®æŠ€è¡“ï¼Œåšæ³•å¾ˆå¤šï¼Œå¾é›–å¯æ¥ä½†æœ‰ç”¨çš„ &lt;strong>setInterval å®šæœŸæŸ¥è©¢&lt;/strong>ã€&lt;strong>Long Polling&lt;/strong>ã€&lt;a class="link" href="https://developer.mozilla.org/zh-TW/docs/Web/API/Server-sent_events/Using_server-sent_events" target="_blank" rel="noopener"
>&lt;strong>Server-Sent Event&lt;/strong>&lt;/a>ã€WebSocketï¼Œä¹ƒè‡³æ›´é«˜éšçš„ç¨‹å¼åº«å¦‚ &lt;a class="link" href="https://learn.microsoft.com/zh-tw/aspnet/core/signalr/introduction?view=aspnetcore-7.0&amp;amp;WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>SignalR&lt;/a>ï¼Œéƒ½æ˜¯è§£æ³•ã€‚é€™é‚Šæˆ‘ä½¿ç”¨ Servent-Sent Event (SSE)ï¼Œç†ç”±æ˜¯æ¯”è¼ªè©¢å³æ™‚æœ‰æ•ˆç‡ï¼Œä¸åƒ WebSocket æœƒå› é˜²ç«ç‰†ã€Proxy æˆ–ç¶²ç«™ä¼ºæœå™¨ä¸æ”¯æ´è€Œå¤±æ•ˆï¼Œåˆæ¯” SignalR ä¾†å¾—è¼•å·§ã€‚&lt;/p>
&lt;p>æœ¬å°ˆæ¡ˆå·²æ”¹ç”¨ ASP.NET Coreï¼Œåšæ³•ä¸åŒã€‚æŸ¥äº†ä¸€ä¸‹ï¼Œç™¼ç¾ NuGet å¥—ä»¶ &lt;a class="link" href="https://www.nuget.org/packages/Lib.AspNetCore.ServerSentEvents" target="_blank" rel="noopener"
>Lib.AspNetCore.ServerSentEvents&lt;/a>ï¼Œæ–‡ä»¶æ¸…æ¥šä¸”æ“´å……å½ˆæ€§ä¸éŒ¯ï¼Œæ²’å¿…è¦è‡ªå·±é€ è¼ªå­ã€‚&lt;/p>
&lt;p>å…ˆçœ‹è©¦åšæˆæœï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52659620972_19493c4004_o.gif"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æˆ‘å»ºäº†ä¸€å€‹ ASP.NET Core MVC ç«™å°ï¼Œé¦–é æ”¾äº†ä¸€é¡†éˆ•ï¼ŒæŒ‰ä¸‹æœƒå½ˆå‡º QR Code ç¶²é ï¼Œ10 ç§’å…§æƒç„ QR Code å‘¼å«æŒ‡å®šç¶²å€ï¼Œé¦–é æœƒå¾ SSE æ¥ç²é€šçŸ¥ç¢ºèªæƒç„å®Œæˆã€‚ç‚ºæ–¹ä¾¿æœ¬æ©Ÿæ¸¬è©¦ï¼Œæˆ‘åŠ äº†ä¸€é¡†éˆ•ç”¨ JavaScript ç¨‹å¼ç€è¦½æŒ‡å®š URL æ¨¡æ“¬æƒç„ QR Code å‹•ä½œã€‚è€Œç­‰å¾…æƒç„éç¨‹æœƒè¨ˆæ™‚ï¼Œæœªåœ¨æ™‚é™å…§å®Œæˆå°‡åˆ¤å®šé€¾æ™‚ã€‚&lt;/p>
&lt;p>Index.cshtml å¯«æ³•å¦‚ä¸‹ï¼ŒåŸç†æ˜¯é–‹å•Ÿ EventSource() æ¥æ”¶ä¼ºæœå™¨ç«¯ SSE å›æ‡‰ï¼Œæ–°é–‹å•Ÿçš„ QR Code è¦–çª—å¼•å°ä½¿ç”¨è€…å‘¼å«ç‰¹å®šé€£çµè§¸ç™¼å¾ SSE é€£ç·šå›å‚³çµæœï¼Œæ­£å¸¸ç”± onmessage äº‹ä»¶æ¥æ”¶ã€é€¾æ™‚æˆ–å‡ºéŒ¯å‰‡ç”± onerror äº‹ä»¶æ¥æ”¶ï¼š&lt;/p>
&lt;h5 id="viewshomeindexcshtml">Views/Home/Index.cshtml&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="err">@&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ViewData&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;Title&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;Home Page&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span> &lt;span class="n">class&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;text-center&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">h1&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;h&amp;#34;&lt;/span> &lt;span class="n">class&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;display-4&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="n">Welcome&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">button&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;btn&amp;#34;&lt;/span> &lt;span class="n">onclick&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;showQRCode()&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="n">Scan&lt;/span> &lt;span class="n">QR&lt;/span> &lt;span class="n">Code&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">qrCodeWin&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">EventSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">sse&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">@ViewBag&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Token&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">function&lt;/span> &lt;span class="n">showResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">qrCodeWin&lt;/span> &lt;span class="p">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">qrCodeWin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">btn&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">remove&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">let&lt;/span> &lt;span class="n">h&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;h&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">h&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">innerText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">h&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">style&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">red&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onmessage&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">showResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onerror&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">showResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">function&lt;/span> &lt;span class="n">showQRCode&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">qrCodeWin&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">@Url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Content&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">$&amp;#34;~/Home/QRCode/{ViewBag.Token}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">_blank&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">300&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">height&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="m">300&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆæ­¥æ¸¬è©¦æˆåŠŸï¼Œæ¥è‘—æ”¹å¯«æˆæ¨¡ä»¿æ‰‹æ©Ÿæƒ QR Code çš„ç™»å…¥æµç¨‹ã€‚åœ¨æˆ‘ Home åŠ ä¸€å€‹ Test æ–¹æ³•ï¼Œ/Views/Home/Test.cshtml å¦‚ä¸‹ï¼Œç›´æ¥åœ¨é é¢é¡¯ç¤º QR Codeï¼ŒQR Code æŒ‡å®šé€£çµè¢«å‘¼å«å¾Œç”± SSE å‚³ä¾†é€šçŸ¥ï¼Œç¶²é å°å‘æ¸¬è©¦æˆåŠŸç•«é¢ï¼š&lt;/p>
&lt;h5 id="viewshometestcshtml">Views/Home/Test.cshtml&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="err">@&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span> &lt;span class="n">class&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;text-center&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;qrc&amp;#34;&lt;/span> &lt;span class="n">src&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;@ViewBag.QRCodePng&amp;#34;&lt;/span> &lt;span class="n">alt&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;QR Code&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;msg&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Timeout&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">span&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="s">&amp;#34;t&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="n">@ViewBag&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TimeoutSecs&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">EventSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">sse&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">@ViewBag&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Token&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onmessage&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">href&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">@Url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Action&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Succ&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Home&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onerror&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">function&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">qrc&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="k">remove&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">innerText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">@ViewBag&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TimeoutSecs&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">h&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">setInterval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span>&lt;span class="p">--;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;t&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">innerText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">timeout&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">clearInterval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">h&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="m">1000&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥ä¸Šç¯„ä¾‹ä¸­ï¼Œä»¥æ‰‹æ©Ÿæƒç„ä¸¦ç€è¦½ QR Code å…§å«ç¶²å€åˆ¤å®šæˆåŠŸï¼Œæ”¹ç‚º App ä½¿ç”¨æ‰‹æ©Ÿå¯¦é«”ä¿å­˜çš„é‡‘é‘°å°éš¨æ©Ÿç”¢ç”Ÿå…§å®¹åšæ•¸ä½ç°½ç« ï¼Œå°‡å¯é”åˆ°å°ˆæ¥­æ°´æº–çš„å®‰å…¨é˜²è­·ï¼Œæœ‰æ©Ÿæœƒåšå‡ºåœŸç ²ç‰ˆå¤šé‡å› ç´ é©—è­‰æˆ–å…å¯†ç¢¼ç™»å…¥ã€‚&lt;/p>
&lt;p>ç°¡å–®èªªä¸€ä¸‹ä¼ºæœå™¨ç«¯ç¨‹å¼å¯«æ³•ã€‚SSE éƒ¨åˆ†ä¸»è¦é  &lt;a class="link" href="https://www.nuget.org/packages/Lib.AspNetCore.ServerSentEvents" target="_blank" rel="noopener"
>Lib.AspNetCore.ServerSentEvents&lt;/a> ç¨‹å¼åº«è™•ç†ï¼ŒProgram.cs æœ‰ä»¥ä¸‹å¹¾å€‹åœ°æ–¹è¦æ”¹ï¼š(ä¸­æ–‡è¨»è§£è™•)&lt;/p>
&lt;h5 id="programcs">Program.cs&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Lib.AspNetCore.ServerSentEvents&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">sse_notify.Models&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">builder&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">WebApplication&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CreateBuilder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è¨»å†Š SSE æœå‹™&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddServerSentEvents&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ”¹ç”± URL åŒ…å«çš„ Guid å–å¾— ClientId&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddSingleton&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IServerSentEventsClientIdProvider&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">SseClientIdFromPathProvider&lt;/span>&lt;span class="p">&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// è‡ªè¨‚ä¸€å€‹ç¹¼æ‰¿ ServerSentEventsService åŠå¯¦ä½œ IServerSentEventsService çš„é¡åˆ¥è™•ç†é€šçŸ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä½¿ç”¨ç¨‹å¼åº«æä¾›çš„ AddServerSentEvents æ“´å……æ–¹æ³•è¨»å†Š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddServerSentEvents&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SseNotifyService&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">InProcSseNotifyService&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="n">options&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ç¨‹å¼åº«æä¾› KeepAlive åŠŸèƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">KeepaliveMode&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">ServerSentEventsKeepaliveMode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Always&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">KeepaliveInterval&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">15&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Add services to the container.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Services&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddControllersWithViews&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">app&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Build&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseStaticFiles&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseRouting&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseAuthorization&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å®šç¾© SSE å°æ˜ çš„æœå‹™åŠè·¯ç”±åŠå‹åˆ¥ï¼Œæ¯æ¬¡ç­‰å¾…çš„æƒç„æ“ä½œç”¢ç”Ÿéš¨æ©Ÿ GUID è­˜åˆ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MapServerSentEvents&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">InProcSseNotifyService&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;/sse/{regex(^[=0-9a-z].+)$)}&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">MapControllerRoute&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;default&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pattern&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;{controller=Home}/{action=Index}/{id?}&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Run&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‡ªè¨‚é¡åˆ¥è¦ç¹¼æ‰¿ ServerSentEventsServiceï¼Œå¯«æ³•å¯åƒè€ƒ &lt;a class="link" href="https://tpeczek.github.io/Lib.AspNetCore.ServerSentEvents/articles/getting-started.html" target="_blank" rel="noopener"
>API æ–‡ä»¶&lt;/a>ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„åšæ³•ã€‚QR Code æƒç„åŸ·è¡Œçµæœæ‰“ç®—ç”¨è¨‚é–±èˆ‡ç™¼å¸ƒè¨­è¨ˆæ¨¡å¼ï¼Œæ¸¬è©¦é–‹ç™¼éšæ®µé è¨˜æ†¶é«”ä¸­çš„ Dictionaryã€IMemoryCache äº¤æ›è³‡æ–™ï¼›åœ¨è² è¼‰å¹³è¡¡æ¶æ§‹æœƒæœ‰å¤šå°ä¸¦è¡Œï¼Œå‰‡éœ€è¦åˆ†æ•£å¼çš„è¨‚é–±ç™¼å¸ƒæ¶æ§‹ï¼Œå¯ä½¿ç”¨ Redisã€&lt;a class="link" href="https://learn.microsoft.com/zh-tw/dotnet/architecture/microservices/multi-container-microservice-net-applications/rabbitmq-event-bus-development-test-environment?WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>RabbitMQ&lt;/a> ä¹‹é¡çš„è§£æ±ºæ–¹æ¡ˆã€‚ç‚ºæ­¤ï¼Œæˆ‘å®£å‘Šäº† &lt;a class="link" href="https://github.com/wjdesign/web-wait-for-qrcode-scan/blob/main/Models/SseNotifyService.cs" target="_blank" rel="noopener"
>SseNotifyService&lt;/a> æŠ½è±¡å‹åˆ¥ï¼Œå…ˆåšäº† &lt;a class="link" href="https://github.com/wjdesign/web-wait-for-qrcode-scan/blob/main/Models/InProcSseNotifyService.cs" target="_blank" rel="noopener"
>InProcessSseNotifyService&lt;/a> ç”¨ IMemoryCache ç°¡å–®æå®šï¼Œæ­£å¼é‹è½‰å¦‚æœ‰éœ€è¦å†æ”¹ç”¨ Redis æˆ–å…¶ä»– MQ æ©Ÿåˆ¶å¯¦ä½œã€‚&lt;/p>
&lt;h5 id="modelsssenotifyservicecs">Models/SseNotifyService.cs&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Lib.AspNetCore.ServerSentEvents&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Microsoft.Extensions.Options&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">namespace&lt;/span> &lt;span class="nn">sse_notify.Models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// https://tpeczek.github.io/Lib.AspNetCore.ServerSentEvents/articles/getting-started.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">abstract&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">SseNotifyService&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">ServerSentEventsService&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IServerSentEventsService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">SseNotifyService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsServiceOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsService&lt;/span>&lt;span class="p">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">base&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToBaseServerSentEventsServiceOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsService&lt;/span>&lt;span class="p">&amp;gt;())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">abstract&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">timeoutSecs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">300&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">async&lt;/span> &lt;span class="n">Task&lt;/span> &lt;span class="n">SendEventAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">GetClients&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">SingleOrDefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Id&lt;/span> &lt;span class="p">==&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">client&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SendEventAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">ServerSentEvent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Type&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Data&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">message&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">abstract&lt;/span> &lt;span class="n">Task&lt;/span> &lt;span class="n">Notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="modelsinprocssenotifyservicecs">Models/InProcSseNotifyService.cs&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Lib.AspNetCore.ServerSentEvents&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Microsoft.Extensions.Caching.Memory&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Microsoft.Extensions.Options&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">namespace&lt;/span> &lt;span class="nn">sse_notify.Models&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">InProcSseNotifyService&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">SseNotifyService&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IServerSentEventsService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">private&lt;/span> &lt;span class="k">readonly&lt;/span> &lt;span class="n">IMemoryCache&lt;/span> &lt;span class="n">_cache&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">InProcSseNotifyService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsServiceOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsService&lt;/span>&lt;span class="p">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">IMemoryCache&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">base&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToBaseServerSentEventsServiceOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEventsService&lt;/span>&lt;span class="p">&amp;gt;())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cache&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">cache&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">override&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">timeoutSecs&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">300&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">$&amp;#34;S:{token}&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">semaphore&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">SemaphoreSlim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">TimeSpan&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromSeconds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">timeoutSecs&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">semaphore&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">timeout&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">task&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Task&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Factory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">StartNew&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">async&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//wait for semaphore to be released&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="k">await&lt;/span> &lt;span class="n">semaphore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WaitAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeSpan&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FromSeconds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">timeoutSecs&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="n">SendEventAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Timeout&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//try get response&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">_cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TryGetValue&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="s">$&amp;#34;R:{token}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">out&lt;/span> &lt;span class="kt">var&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="n">SendEventAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;No response&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">await&lt;/span> &lt;span class="n">SendEventAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;message&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kd">async&lt;/span> &lt;span class="kd">override&lt;/span> &lt;span class="n">Task&lt;/span> &lt;span class="n">Notify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">$&amp;#34;S:{token}&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(!&lt;/span>&lt;span class="n">_cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">TryGetValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">out&lt;/span> &lt;span class="n">SemaphoreSlim&lt;/span> &lt;span class="n">semaphore&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ApplicationException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Token not found&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;R:&amp;#34;&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ToString&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">semaphore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Release&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>SSE ç¨‹å¼åº«è­˜åˆ¥å®¢æˆ¶ç«¯é€£ç·šçš„é è¨­åšæ³•æ˜¯å¾ HttpContext.User.Identity æŠ“ä½¿ç”¨è€…èº«åˆ†ï¼Œè‹¥ä½¿ç”¨è€…æœ‰å¤šæ¢ SSE é€£ç·šï¼Œæ¯æ¢é€£ç·šéƒ½å‚³è¨Šæ¯ä¹Ÿç„¡å¦¨ã€‚ä½†æˆ‘çš„æ‡‰ç”¨æƒ…å¢ƒï¼Œæ¯æ¬¡é¡¯ç¤º QR Code ç‚ºç¨ç«‹å‚³è¼¸é€šé“ï¼Œæœƒä»¥ GUID è­˜åˆ¥ï¼Œæ•…è¦è‡ªè¨‚è­˜åˆ¥ Client Id é‚è¼¯ã€‚åšæ³•æ˜¯å¯«å€‹è‡ªè¨‚é¡åˆ¥å¯¦ä½œ IServerSentEventsClientIdProviderï¼Œåœ¨ Program.cs DI è¨»å†Šæˆ Singletonï¼š&lt;/p>
&lt;h5 id="modelssseclientidfrompathprovidercs">Models/SseClientIdFromPathProvider.cs&lt;/h5>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">SseClientIdFromPathProvider&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">IServerSentEventsClientIdProvider&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">Guid&lt;/span> &lt;span class="n">AcquireClientId&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HttpContext&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">path&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Path&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Value&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">var&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Regex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">@&amp;#34;(?i)/(?&amp;lt;g&amp;gt;[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})$&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Success&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">Guid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Groups&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;g&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">Value&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">Guid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">NewGuid&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">ReleaseClientId&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Guid&lt;/span> &lt;span class="n">clientId&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">HttpContext&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç‘£ç¢ç´°ç¯€é‚„ä¸å°‘ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç´¹äº†ã€‚ç¯„ä¾‹å°ˆæ¡ˆå·²æ”¾ä¸Š &lt;a class="link" href="https://github.com/wjdesign/web-wait-for-qrcode-scan" target="_blank" rel="noopener"
>Github&lt;/a>ï¼Œå¤§å®¶å¦‚æœ‰èˆˆè¶£å†ä¸‹è¼‰å›å»ç ”ç©¶ã€‚&lt;/p>
&lt;hr></description></item><item><title>ASP.NET Core Docker ç­†è¨˜ 4 - ASP.NET Core ç¶²ç«™å®¹å™¨åŒ–ç¶“é©—åˆ†äº«</title><link>https://wayne-blog.com/2022-12-09/dotnet-core-docker-note-4/</link><pubDate>Fri, 09 Dec 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-12-09/dotnet-core-docker-note-4/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png" alt="Featured image of post ASP.NET Core Docker ç­†è¨˜ 4 - ASP.NET Core ç¶²ç«™å®¹å™¨åŒ–ç¶“é©—åˆ†äº«" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://www.mjollnir.cc/archives/264.html" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.exfast.me/2018/09/iis-netcore-remoteipaddress-is-wrong-after-iis-reverse-proxy/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://stackoverflow.com/a/44390593/288936" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-docker-notes-4/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>ç™¼è¡¨ Docker ç­†è¨˜ä»¥ä¾†ï¼Œä¸€ç›´æœ‰ç¶²å‹æé†’æ‡‰æ”¹ç”¨ Kubernetes (K8S)ï¼Œé—œæ–¼é€™é»åœ¨&lt;a class="link" href="https://wayne-blog.com/2022-12-08/dotnet-core-docker-note-3/" target="_blank" rel="noopener"
>å‰ç¯‡æ–‡ç« &lt;/a>å·²ç¶“æéï¼Œç”¨ Docker / Docker-Compose ç©ç©å°ç¶²ç«™é‚„ OKï¼Œä¸€æ—¦æ¶‰åŠé«˜å¯ç”¨æ€§å¦‚å‚™æ´ã€è² è¼‰å¹³è¡¡ï¼Œè‹¥ä¸ä¾è³´ç¾æˆç®¡ç†æ¶æ§‹ï¼Œç¶­é‹æ“ä½œå°‡è¤‡é›œåˆ°æœƒå’¬äººã€‚è€Œ Kubernetes æ­£æ˜¯ç›®å‰å®¹å™¨ç®¡ç†æ¡†æ¶çš„ä¸»æµæ¥­ç•Œæ¨™æº–ï¼Œå°¤å…¶å¦‚æ‰“ç®—å°‡å®¹å™¨ç›´æ¥éƒ¨ç½²åˆ°é›²ç«¯å» å•†(Azureã€AWSã€Google GCP)ï¼Œä¸æœƒ Kubernetes æ›´æ˜¯å¯¸æ­¥é›£è¡Œã€‚æ•…åœ¨æ¬¡è²æ˜ä»¥æ­£è¦–è½ï¼Œåœ¨ä¼æ¥­ç’°å¢ƒå¦‚éœ€è€ƒé‡é«˜å¯ç”¨æ€§ã€è² è¼‰å¹³è¡¡æˆ–æƒ³ç›´æ¥éƒ¨ç½²åˆ°å» å•†é›²ç«¯ï¼Œä¸€èˆ¬ä¸æœƒç”¨ Docker-Compose è€Œæœƒæ¡ç”¨ Kubernetesï¼Œè«‹å¤§å®¶æ³¨æ„ã€‚&lt;/p>
&lt;p>é€™ç¯‡ç­†è¨˜æ˜¯æˆ‘å°‡éƒ¨è½æ ¼ç¶²ç«™ç§»å…¥ Docker å®¹å™¨çš„ç¶“é©—åˆ†äº«ï¼Œå°‡è¨˜éŒ„ Miniblog.Core ASP.NET Core ç¶²ç«™æ¬é€² Docker éç¨‹é‡åˆ°çš„ä¸€äº›çœ‰è§’ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="reverse-proxy-å•é¡Œ">Reverse Proxy å•é¡Œ&lt;/h2>
&lt;p>ç”±æ–¼æˆ‘æ‰“ç®—åœ¨åŒä¸€æ©Ÿå™¨ä¸Šå…±äº«å°å¤– IP è·‘å¤šå€‹ç¶²ç«™ï¼Œå› æ­¤æ¡è¡Œ&lt;a class="link" href="https://wayne-blog.com/2022-12-08/dotnet-core-docker-note-3/" target="_blank" rel="noopener"
>å‰ä¸€ç¯‡ç­†è¨˜&lt;/a>æ‰€èªªçš„ã€Œä»¥ Compose çµ„åˆç¶²ç«™èˆ‡ DBï¼Œç¶²ç«™å°æ˜  Host IP/Portï¼ŒNginx å¦è·‘å®¹å™¨å°å‘å„ç¶²ç«™ Portã€ç­–ç•¥ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ç›®éŒ„å°æ‡‰">ç›®éŒ„å°æ‡‰&lt;/h2>
&lt;p>éƒ¨è½æ ¼ç¶²ç«™æœ‰ä¸€äº›åŸ·è¡ŒæœŸé–“æ›´æ–°çš„å…§å®¹ï¼ŒåŒ…å« NLog Log æª”ã€æ–‡ç« åœ–æª”ã€SQLitï½… è³‡æ–™åº«ç­‰ï¼Œé€™äº›å…§å®¹ä¸é©åˆæ”¾åœ¨å®¹å™¨è£¡ï¼Œæ•…éƒ½éœ€è¨­ Volume å°æ˜ åˆ° Host OS çš„å¯¦éš›æª”æ¡ˆï¼Œå¦‚æ­¤å®¹å™¨å¯ä»»æ„åˆªé™¤é‡å»ºåŠå‡ç´šï¼Œç®¡ç†é‹ç”¨è¼ƒæ–¹ä¾¿ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="æ™‚å€å•é¡Œ">æ™‚å€å•é¡Œ&lt;/h2>
&lt;p>è¸©äº†é›·æ‰çŸ¥é“ï¼šDocker å®¹å™¨å…§çš„æ™‚å€è·Ÿ Host OS æ˜¯è„«é‰¤çš„ã€‚å³ä¾¿æœ¬æ©Ÿå·²è¨­å¥½å®šç‚ºå°åŒ—æ™‚å€ï¼ŒDocker å®¹å™¨é è¨­ç‚º UTC+0 æ™‚å€ï¼Œæœ‰å…©ç¨®åšæ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨ &lt;strong>docker-compose.yml&lt;/strong> ä¸­åŠ è¨»ç’°å¢ƒåƒæ•¸ TZ&lt;/li>
&lt;li>æ–°å¢ Volume å°æ˜  &lt;strong>/etc/localtime:/etc/localtime:ro&lt;/strong>ï¼Œè¦æ±‚å®¹å™¨ä»¥ Host OS çš„æ™‚å€ç‚ºæº–&lt;/li>
&lt;/ol>
&lt;p>ç¬¬ä¸€ç¨®åšæ³•é‡åˆ°ä»¥ Alpine Linux ç‰ˆ Image å»ºçš„å®¹å™¨éœ€è¦é¡å¤–è£å¥—ä»¶ï¼Œæ•…å°æ˜  /etc/localtime è¼ƒå–®ç´”ã€‚&lt;/p>
&lt;p>åƒè€ƒï¼š&lt;a class="link" href="https://www.arthurtoday.com/2016/07/how-to-setup-docker-container-timezone-host.html" target="_blank" rel="noopener"
>è¨­å®š Docker Container èˆ‡ Host ç›¸åŒæ™‚å€çš„æ–¹æ³•&lt;/a>&lt;/p>
&lt;h2 id="å–å¾—çœŸå¯¦ä¾†æº-ip-å•é¡Œ">å–å¾—çœŸå¯¦ä¾†æº IP å•é¡Œ&lt;/h2>
&lt;p>Reverse Proxy ä¾†æº IP åœ¨ &lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-nginx-install-on-centos/" target="_blank" rel="noopener"
>ASP.NET Core + Nginx on CentOS å®‰è£ç­†è¨˜&lt;/a> æéï¼Œç•¶ ASP.NET Core æ¶è¨­åœ¨ Reverse Proxy å¾Œæ–¹ï¼Œç›´æ¥çœ‹åˆ°çš„æ˜¯ Reverse Proxy çš„ IPï¼Œè¦å¾—åˆ°çœŸå¯¦ä¾†æº IPï¼Œåœ¨ Nginx config éœ€åŠ è¨» proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_forï¼Œé€é HTTP Header å‚³éå…§å®¹ã€‚è€Œ ASP.NET Core ç¨‹å¼ä¹Ÿéœ€ä¿®æ”¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IApplicationBuilder&lt;/span> &lt;span class="n">app&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IHostingEnvironment&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseForwardedHeaders&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">ForwardedHeadersOptions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForwardedHeaders&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedFor&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedProto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸éè‹¥ ASP.NET Core é‹è¡Œæ–¼å®¹å™¨ï¼Œç¶å®šçš„ IP ä¸æ˜¯ 127.0.0.1 è€Œæ˜¯éš”é›¢ç¶²æ®µ 172.1x.0.x IPï¼Œæ­¤è¡Œç‚ºæ‰“ç ´ UseForwardedHeaders å‡è¨­ Request ä¾†è‡ª localhost çš„å‰é¡Œï¼Œå°±ç®—è¨­äº† ForwardedHeadersï¼Œ IHttpContextAccessor.HttpContext.Connection.RemoteIpAddress è®€åˆ°çš„ä»æ˜¯ 172.1x.0.1 (éš”é›¢ç¶²æ®µçš„ Gateway IP)ã€‚&lt;/p>
&lt;p>ç”± ASP.NET Core çš„&lt;a class="link" href="https://github.com/aspnet/BasicMiddleware/blob/master/src/Microsoft.AspNetCore.HttpOverrides/ForwardedHeadersMiddleware.cs" target="_blank" rel="noopener"
>åŸå§‹ç¢¼&lt;/a>ï¼Œæª¢æŸ¥è¦å‰‡ç‚ºè‹¥ ForwardedHeadersOptions.KnownNetworks æˆ– ForwardedHeadersOptions.KnownProxies æœ‰è¨­å®šï¼Œä¾†æº IP å¿…é ˆè¦æ˜¯ KnownNetworks æˆ– KnownProxies æ‰æœƒèªå®šè«‹æ±‚ç‚º Proxy è½‰å‚³ã€‚è€Œ KnownNetworks åŠ KnownProxies é è¨­åªæœ‰æœ¬æ©Ÿ IPã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// Addresses of known proxies to accept forwarded headers from.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">IList&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IPAddress&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">KnownProxies&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IPAddress&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">IPAddress&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IPv6Loopback&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// Address ranges of known proxies to accept forwarded headers from.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cs">/// &amp;lt;/summary&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">IList&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IPNetwork&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">KnownNetworks&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">List&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IPNetwork&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">IPNetwork&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IPAddress&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Loopback&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è§£æ±ºæ–¹æ³•æœ‰å…©ç¨®ï¼Œä¸€ç¨®æ˜¯å°‡ 172.x.0.0 åŠ å…¥ ForwardedHeadersOptions.KnownNetworksï¼Œä½†ç¶²æ®µç‚º Docker è‡ªç”±èª¿é…ï¼Œæœ€å¥½å¯«æˆè‡ªå‹•åµæ¸¬ä¸å®œå¯«æ­»ã€‚&lt;/p>
&lt;p>å¦ä¸€å€‹è§£æ³•æ˜¯å°‡ KnownNetworks èˆ‡ KnownProxies éƒ½æ¸…ç©ºï¼Œä¸€èˆ¬æœ‰ä¾†æº IP è¢«å½é€ çš„é¢¨éšªï¼Œä½†æˆ‘å€‘ ASP.NET Core ç¶²ç«™æ¶æ§‹ Nginx Reverse Proxy æ˜¯å”¯ä¸€çš„å…¥å£ï¼Œæ•…æˆ‘å°‡å…¶è¦–ç‚ºå¯æ¥å—åšæ³•ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">forwardingOptions&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">ForwardedHeadersOptions&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForwardedHeaders&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedFor&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedProto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">forwardingOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">KnownNetworks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Clear&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">//its loopback by default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">forwardingOptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">KnownProxies&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Clear&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseForwardedHeaders&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">forwardingOptions&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åƒè€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.mjollnir.cc/archives/264.html" target="_blank" rel="noopener"
>è®°å½•Dockeréƒ¨ç½²asp.net coreåº”ç”¨æ—¶ä½¿ç”¨åå‘ä»£ç†çš„å‘&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.exfast.me/2018/09/iis-netcore-remoteipaddress-is-wrong-after-iis-reverse-proxy/" target="_blank" rel="noopener"
>IIS Reverse Proxy å¾Œ RemoteIpAddress å–å€¼éŒ¯èª¤&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://stackoverflow.com/a/44390593/288936" target="_blank" rel="noopener"
>Stackoverlow è¨è«–&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="nginx-å…§å®¹å£“ç¸®å•é¡Œ">Nginx å…§å®¹å£“ç¸®å•é¡Œ&lt;/h2>
&lt;p>è·‘äº†ä¸€é™£å­æ‰ç™¼ç¾ï¼Œæˆ‘ç”¨çš„ Nginx + Certbot å®¹å™¨çš„ Nginx è¨­å®šæª” /etc/nginx/nginx.conf é è¨­æœªé–‹å•Ÿ GZIP å£“ç¸®ã€‚&lt;/p>
&lt;p>æˆ‘çš„è§£æ³•æ˜¯æ–°å¢ Volume å°æ˜ å°‡ /etc/nginx/nginx.conf å°æ‡‰åˆ° Host /etc/nginx/nginx.confï¼Œä¸¦ä¿®æ”¹å¢åŠ  gzip é‚£æ®µå…§å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">user&lt;/span> &lt;span class="s">nginx&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">worker_processes&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">error_log&lt;/span> &lt;span class="s">/var/log/nginx/error.log&lt;/span> &lt;span class="s">warn&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pid&lt;/span> &lt;span class="s">/var/run/nginx.pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/mime.types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">default_type&lt;/span> &lt;span class="s">application/octet-stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">log_format&lt;/span> &lt;span class="s">main&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$remote_addr&lt;/span> &lt;span class="s">-&lt;/span> &lt;span class="nv">$remote_user&lt;/span> &lt;span class="s">[&lt;/span>&lt;span class="nv">$time_local]&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$request&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&lt;/span>&lt;span class="nv">$status&lt;/span> &lt;span class="nv">$body_bytes_sent&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_referer&amp;#34;&lt;/span> &lt;span class="s">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;&amp;#34;&lt;/span>&lt;span class="nv">$http_user_agent&amp;#34;&lt;/span> &lt;span class="s">&amp;#34;&lt;/span>&lt;span class="nv">$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">access_log&lt;/span> &lt;span class="s">/var/log/nginx/access.log&lt;/span> &lt;span class="s">main&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">sendfile&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#tcp_nopush on;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">keepalive_timeout&lt;/span> &lt;span class="mi">65&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_min_length&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_buffers&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="mi">16k&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_comp_level&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">gzip_types&lt;/span> &lt;span class="s">text/plain&lt;/span> &lt;span class="s">application/x-javascript&lt;/span> &lt;span class="s">text/css&lt;/span> &lt;span class="s">application/xml&lt;/span> &lt;span class="s">text/javascript&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">include&lt;/span> &lt;span class="s">/etc/nginx/conf.d/*.conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Nginx å£“ç¸®è¨­å®šçš„æ„ç¾©å¯åƒè€ƒ&lt;a class="link" href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡ä»¶&lt;/a>&lt;/p>
&lt;hr></description></item><item><title>ASP.NET Core Docker ç­†è¨˜ 3 - å…±ç”¨ Nginx å®¹å™¨èˆ‡ Certbot æ•´åˆ</title><link>https://wayne-blog.com/2022-12-08/dotnet-core-docker-note-3/</link><pubDate>Thu, 08 Dec 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-12-08/dotnet-core-docker-note-3/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png" alt="Featured image of post ASP.NET Core Docker ç­†è¨˜ 3 - å…±ç”¨ Nginx å®¹å™¨èˆ‡ Certbot æ•´åˆ" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-docker-notes-3/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>&lt;a class="link" href="https://wayne-blog.com/2022-12-07/dotnet-core-docker-note-2/" target="_blank" rel="noopener"
>å‰ç¯‡æ–‡ç« &lt;/a>ä»‹ç´¹éä½¿ç”¨ Docker Compose è¨­å®šé—œè¯å®¹å™¨(Webã€DBã€Reverse Proxy)çµ„æˆç³»çµ±ï¼Œå®¹å™¨è¢«éš”é›¢åœ¨å°ˆç”¨ç¶²æ®µ(Compose è‡ªå‹•å»ºç«‹çš„ Bridge)ï¼Œä¸¦å¯é€éå®¹å™¨åç¨±å½¼æ­¤æºé€šï¼ŒCompose ä¹Ÿç¢ºä¿ç›¸é—œæœå‹™ä¸€èµ·å•Ÿå‹•ä¸€èµ·é—œé–‰ï¼Œæ˜¯ç”¨å¤šå€‹å®¹å™¨å»ºæ§‹ç³»çµ±æœ€ç°¡ä¾¿çš„åšæ³•ã€‚&lt;/p>
&lt;p>è¨»ï¼šé—œæ–¼å®¹å™¨ç®¡ç† &lt;a class="link" href="https://blog.gcp.expert/kubernetes-gke-introduction/" target="_blank" rel="noopener"
>Kubernetes&lt;/a>ï¼ŒK8S æä¾›æ›´å¼·å¤§çš„åŠŸèƒ½ï¼Œæ”¯æ´ Cluster é«˜å¯ç”¨æ¶æ§‹ (å–®ä¸€å®¹å™¨ã€ä¸»æ©Ÿæ›æ‰ç³»çµ±ä¸æœƒæ­»)ï¼Œç‚ºç•¶ä»Šåœ¨é›²ç«¯æ›è¼‰å®¹å™¨ä»¥åŠä¸­å¤§å‹ä¼æ¥­å¯¦åšå®¹å™¨æ¶æ§‹çš„ä¸»æµï¼ŒK8S ç„¡ç–‘å¯å–ä»£ Docker Composeï¼Œä½†å…¶è¤‡é›œæ€§è¼ƒé«˜ã€‚ ç›®å‰æˆ‘åœ¨å–®ä¸€ Linux æ©Ÿè·‘ Docker é‚„ç”¨ä¸åˆ°ç‰›åˆ€(é›–ç„¶æœ‰å–®æ©Ÿç‰ˆ &lt;a class="link" href="https://github.com/kubernetes/minikube" target="_blank" rel="noopener"
>Minikube&lt;/a> å¯ç”¨)ï¼Œæœªä¾†è‹¥è¦å°‡ Docker æ‡‰ç”¨æ–¼å·¥ä½œï¼ŒK8S å·²æˆå¿…è¦æŠ€èƒ½ã€‚&lt;/p>
&lt;p>ç”¨ Docker Compose çµ„åˆå®¹å™¨å»ºç«‹æœå‹™çœ‹ä¼¼å®Œç¾ï¼Œä½†æ‡‰ç”¨åœ¨ Reverse Proxy (Nginx) æ™‚éœ€è¦é¡å¤–è€ƒé‡ã€‚&lt;/p>
&lt;p>æˆ‘æ‰“ç®—åœ¨åŒä¸€å° Linux ä¸Šè·‘å¤šå€‹ç¶²ç«™ï¼Œå°å¤–ç”¨åŒä¸€å€‹ IPï¼Œå†ä¾ HTTP Request çš„ &lt;strong>Host æ¨™é ­&lt;/strong>å°å‘ä¸åŒç¶²ç«™ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="èˆ‰ä¾‹">èˆ‰ä¾‹&lt;/h2>
&lt;p>èˆ‰å€‹ä¾‹å­ï¼šå‡è¨­ Linux çš„å°å¤– IP æ˜¯ 123.123.123.123ï¼Œæˆ‘ç”³è«‹å…©å€‹ DNS åç¨± web1.xxx.com.twã€web2.xxx.com.tw éƒ½æŒ‡å‘ 123.123.123.123ã€‚&lt;/p>
&lt;p>ä½¿ç”¨è€…ç”¨ &lt;a class="link" href="http://web1.xxx.com.tw" target="_blank" rel="noopener"
>http://web1.xxx.com.tw&lt;/a> é€£ä¸Š 123.123.123.123 çš„ 80 Port æ™‚ï¼ŒReverse Proxy å°å‘ &lt;strong>Web1&lt;/strong> ç¶²ç«™ï¼›ç”¨ &lt;a class="link" href="http://web2.xxx.com.tw" target="_blank" rel="noopener"
>http://web2.xxx.com.tw&lt;/a> æ™‚é€£ç·šæ™‚å‰‡å°å‘ &lt;strong>Web2&lt;/strong> ç¶²ç«™ã€‚ç”±æ–¼å°å¤–éœæ…‹ IP ç‚ºçè²´è³‡æºï¼Œå¤šç¶²ç«™é€é Host å…±ç”¨ IP æ˜¯ç¯€çœæˆæœ¬çš„å¸¸è¦‹åšæ³•ã€‚&lt;/p>
&lt;p>ä¸Šè¿°ä»¥ HTTP Host åç¨±å°å‘çš„åšæ³•ï¼Œè‹¥ç”¨ Docker Compose å°‡ç¶²ç«™é€£åŒ Reverse Proxy åŒ…åœ¨ä¸€èµ·ï¼Œå°±å¯èƒ½å‡ºå•é¡Œã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šæŸ Host OS è·‘å…©å€‹ç¶²ç«™ï¼Œè‹¥å„è‡ªç”¨ Docker Compose é€£åŒ Nginx ä¸€èµ·åŒ…é€²å»ï¼Œç¶²ç«™ A ç”± Web-A + MySQL-A + Nginx-A çµ„æˆï¼Œç¶²ç«™ B ç”± Web-B + MySQL-B + Nginx-B çµ„æˆï¼ŒäºŒè€…è·‘åœ¨è‡ªå·±çš„å°ˆå±¬ç¶²æ®µï¼Œåƒ… Nginx-A è·Ÿ Nginx-B å°æ˜ åˆ° Host OS IP çš„ 80 Port&amp;hellip; å“¦å“¦ï¼Œè¡çªå‡ºç¾äº†ï¼ŒNginx-A èˆ‡ Nginx-B éƒ½éœ€å°æ˜  Host IP çš„ 80 Portï¼Œä½† Host OS çš„ 80 Port åªå…è¨±è¢«ä¸€å€‹ç¨‹åºä½¿ç”¨ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="è§£æ±ºæ–¹å¼">è§£æ±ºæ–¹å¼&lt;/h2>
&lt;p>æœ‰å¹¾å€‹è§£æ±ºæ–¹å‘ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Nginx-A èˆ‡ Nginx-B å„è‡ªå°æ‡‰åˆ°ä¸»æ©Ÿä¸åŒ Portï¼Œæ›´å‰ç«¯å†æ›ä¸€å° Nginx è½ 80 Portï¼Œä¾ Host Name å°å‘åˆ° Nginx-A èˆ‡ Nginx- Bï¼Œå¦‚æ­¤ Nginx-A èˆ‡ Nginx-B çš„è§’è‰²é¡¯å¾—å¤šé¤˜ï¼Œå¤šäº†ä¸€æ¬¡è½‰æ¥ä½†æœªçœ‹åˆ°æ˜é¡¯æ•ˆç›Šï¼Œå¾’å¢è¤‡é›œæ€§åˆè€—ææ•ˆèƒ½ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°‡å…©å€‹ç³»çµ±åŒ…æˆä¸€å€‹å¤§ Docker Composeï¼ŒWeb-A + MySQL-A + Web-B + MySQL-B + Nginxï¼Œå…±ç”¨ Nginx å¯é¿å… Port 80 ç¹«çµè¡çªï¼Œä½†å°‡ä¸ç›¸é—œç³»çµ±ç¶æ¶æˆä¸€åœ˜ï¼Œè¢«è¿«ä¸€èµ·å•Ÿå‹•ä¸€èµ·åœæ­¢æŒºé³¥çš„ï¼Œæ›´ä¸ç”¨æä¸€æ—¦åŠ è·‘æ–°æœå‹™å°±è¦æ”¹ Docker Composeï¼Œæˆ‘è¦ºå¾—ä¸è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°‡ Nginx å¾ Docker Compose æŠ½é›¢ï¼Œè®“ Web-A èˆ‡ Web-B å°æ˜ åˆ° Host IP çš„ä¸åŒ Portï¼Œæ•´å€‹ Host OS åªè·‘ä¸€ä»½ Nginx è½ 80 Portï¼Œä¾ Host Name åˆ†æ´¾çµ¦ç¶²ç«™ A æˆ–ç¶²ç«™ Bã€‚ä¹Ÿå°±æ˜¯ç”¨ Docker Compose åŸ·è¡Œä¸‰å€‹å®¹å™¨ï¼š&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Web-A + MySQL-A&lt;/li>
&lt;li>Web-B + MySQL-B&lt;/li>
&lt;li>Ngnix&lt;/li>
&lt;/ul>
&lt;p>3 æ˜¯æˆ‘èªç‚ºè¼ƒå¯è¡Œä¸”æœ‰æ•ˆç‡çš„åšæ³•ã€‚&lt;/p>
&lt;p>Nginx åŒ…å®¹å™¨çš„åšæ³•åœ¨&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/" target="_blank" rel="noopener"
>ç¬¬ä¸€ç¯‡ç­†è¨˜&lt;/a>å·²æéï¼Œé€™æ¬¡æˆ‘å€‘å°‡é‡é»æ”¾åœ¨æ•´åˆ Certbot åŠ docker-compose.yml å®šç¾©ã€‚&lt;/p>
&lt;p>åŸæœ¬æƒ³æŠ“ Nginx çš„ Docker Image è‡ªè¡ŒåŠ è£ certbot å¯¦ç¾è‡ªå‹•å®‰è£èˆ‡æ›´æ–° &lt;a class="link" href="https://zh.wikipedia.org/wiki/Let%27s_Encrypt" target="_blank" rel="noopener"
>Let&amp;rsquo;s Encrypt SSL æ†‘è­‰&lt;/a>ã€‚&lt;/p>
&lt;p>ç”¨ Docker çš„å¥½è™•æ˜¯è³‡æºè±å¯Œï¼Œå¾ˆå¿«åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°ç¾æˆè§£æ±ºæ–¹æ¡ˆï¼Œè¶…ç´šå¥½ç”¨çš„å…¨è‡ªå‹•åŒ– Nginx + Certbot -&amp;gt; &lt;a class="link" href="https://github.com/staticfloat/docker-nginx-certbot" target="_blank" rel="noopener"
>staticfloat/nginx-certbot&lt;/a>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="staticfloatnginx-certbot">staticfloat/nginx-certbot&lt;/h2>
&lt;p>&lt;a class="link" href="https://github.com/staticfloat/docker-nginx-certbot" target="_blank" rel="noopener"
>staticfloat/nginx-certbot&lt;/a>&lt;/p>
&lt;p>ä½¿ç”¨æ–¹æ³•å¾ˆç°¡å–®ï¼Œåœ¨ &lt;code>/etc/nginx/conf.d&lt;/code> æ”¾ä¸€å€‹ &lt;code>certbot.conf&lt;/code> æ¥å— 80 Port æµé‡ï¼Œåªç”¨æ–¼æ¥æ”¶ Let&amp;rsquo;s Encrypt çš„ &lt;code>/.well-known/acme-challenge&lt;/code> è¦æ±‚å°å‘ Certbot å®Œæˆè‡ªå‹•é©—è­‰ï¼Œå…¶é¤˜å‰‡ä¸€å¾‹å°å‘ HTTPSï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Listen on plain old HTTP
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span> &lt;span class="s">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Pass this particular URL off to certbot, to authenticate HTTPS certificates
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">&amp;#39;/.well-known/acme-challenge&amp;#39;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">default_type&lt;/span> &lt;span class="s">&amp;#34;text/plain&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:1337&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Everything else gets shunted over to HTTPS
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">301&lt;/span> &lt;span class="s">https://&lt;/span>&lt;span class="nv">$http_host$request_uri&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥è‘—åœ¨ &lt;code>/etc/nginx/conf.d&lt;/code> ç‚ºæ¯å€‹ç¶²ç«™æ–°å¢ä¸€å€‹ someweb.conf æ‰¿æ¥ HTTPS è«‹æ±‚ã€‚server_name è¨»æ˜è©²ç¶²ç«™ç¶å®šçš„ Host åç¨±(DNS åç¨±)ï¼Œssl_certificateã€ssl_certficate_key å‰‡æŒ‡å‘ &lt;code>/etc/letsencrypt/live/DNSåç¨±&lt;/code> çš„ &lt;code>fullchain.pem&lt;/code> åŠ &lt;code>private.pem&lt;/code>ï¼Œé€™å…©å€‹æª”æ¡ˆä¸éœ€äº‹å…ˆæº–å‚™ï¼ŒCertbot æœƒè‡ªå‹•ç”¢ç”Ÿï¼Œè‡³æ–¼ &lt;code>proxy_*&lt;/code> ç›¸é—œè¨­å®šæ¯”ç…§å…ˆå‰ä»‹ç´¹éçš„åšæ³•ã€‚å®Œæ•´ç¯„ä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">ssl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">blog.darkthread.net&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">/etc/letsencrypt/live/blog.darkthread.net/fullchain.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">/etc/letsencrypt/live/blog.darkthread.net/privkey.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:5000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">keep-alive&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_cache_bypass&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-Proto&lt;/span> &lt;span class="nv">$scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€™å€‹ Docker Image æœ‰ä¸€æ®µç²¾å·§è¨­è¨ˆï¼Œå®ƒåœ¨å•Ÿå‹•æ™‚æœƒä¸»å‹•æƒç„ /etc/nginx/conf.d ä¸‹çš„ configï¼Œä¸€æ—¦åµæ¸¬ç¼ºå°‘ &lt;code>/etc/letsencrypt/live/*/fullchain.pem&lt;/code> å°±é€£ä¸Š &lt;a class="link" href="https://zh.wikipedia.org/wiki/Let%27s_Encrypt" target="_blank" rel="noopener"
>Let&amp;rsquo;s Encrypt ç¶²ç«™&lt;/a>é€²è¡Œé©—è­‰ä¸‹è¼‰ SSL æ†‘è­‰ï¼Œå¦å¤–é‚„è¨­äº†æ¯é€±ä¸€æ¬¡çš„æ’ç¨‹ï¼Œæ†‘è­‰åˆ°æœŸå‰æœƒè‡ªå‹•æ›´æ–°ï¼Œä¸€æ°£å–æˆï¼Œå…¨ä¸æ²¾æ‰‹ï¼Œè²¼å¿ƒåˆ°æˆ‘æƒ³èµ·ç«‹é¼“æŒã€‚&lt;/p>
&lt;p>è‹¥å°å®ƒçš„é‹ä½œåŸç†æœ‰èˆˆè¶£ï¼Œ&lt;a class="link" href="https://github.com/staticfloat/docker-nginx-certbot/tree/master/src/scripts" target="_blank" rel="noopener"
>Github&lt;/a> æœ‰åŸå§‹ç¢¼å¯ä»¥åƒè€ƒã€‚&lt;/p>
&lt;p>ç‚ºäº†ç­è§£åŸç†ï¼Œæˆ‘æ˜¯ä¾è‘— &lt;a class="link" href="https://github.com/staticfloat/docker-nginx-certbot/tree/master/src/scripts" target="_blank" rel="noopener"
>Github åŸå§‹ç¢¼&lt;/a>è‡ªå·±è·‘ Dockerfile è£½ä½œ Nginx + Certbot çš„ Imageï¼Œå¦‚æœå«Œéº»ç…©ï¼Œç›´æ¥å¾ &lt;a class="link" href="https://hub.docker.com/r/staticfloat/nginx-certbot/" target="_blank" rel="noopener"
>Docker Hub&lt;/a> ä¸‹è¼‰ä¹Ÿæˆã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘çš„ Nginx docker-compose.ymlï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nginx&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx-certbot&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">80&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">443&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">443&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/log/nginx:/var/log/nginx&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/etc/nginx/conf.d:/etc/nginx/conf.d&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/etc/letsencrypt:/etc/letsencrypt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">CERTBOT_EMAIL=your-email@mail.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;host&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘è¨­äº†ä¸‰å€‹ Volume å°æ˜ ï¼š&lt;/p>
&lt;ul>
&lt;li>/var/log/nginxï¼šLog æª”&lt;/li>
&lt;li>/etc/nginx/conf.dï¼šè¨­å®šæª”&lt;/li>
&lt;li>/etc/letsencryptï¼šç”¨ä¾†å­˜æ”¾ SSL æ†‘è­‰&lt;/li>
&lt;/ul>
&lt;p>è‹¥ç‚º &lt;strong>SELinux&lt;/strong> è¨˜å¾—è¦ &lt;code>chcon -Rt&lt;/code> &lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-docker-notes-2/" target="_blank" rel="noopener"
>åƒè€ƒ&lt;/a>ï¼Œå¦å¤– network_mode æŒ‡å®š host è¡¨ç¤º Nginx å®¹å™¨å°‡ç›´æ¥ä½¿ç”¨ Host OS ç¶²æ®µï¼Œä¸å¦è¨­ Bridgeã€‚&lt;/p>
&lt;p>åƒè€ƒï¼š&lt;a class="link" href="https://wayne-blog.com/2022-12-04/docker-compose-link-external-comtainer/" target="_blank" rel="noopener"
>Docker Compose éˆæ¥å¤–éƒ¨å®¹å™¨çš„å¹¾ç¨®æ–¹å¼&lt;/a>&lt;/p>
&lt;p>å°±é†¬ï¼ŒNginx Reverse Proxy æº–å‚™å¥½äº†ï¼Œä¸‹ä¸€ç¯‡ä¾†å†ä¾†åˆ†äº«æˆ‘å°‡ ASP.NET Core æ¬é€² Docker çš„ç¶“é©—ã€‚&lt;/p>
&lt;hr></description></item><item><title>ASP.NET Core Docker ç­†è¨˜ 2 - çµ„åˆå®¹å™¨å»ºæ§‹ç³»çµ±</title><link>https://wayne-blog.com/2022-12-07/dotnet-core-docker-note-2/</link><pubDate>Wed, 07 Dec 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-12-07/dotnet-core-docker-note-2/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png" alt="Featured image of post ASP.NET Core Docker ç­†è¨˜ 2 - çµ„åˆå®¹å™¨å»ºæ§‹ç³»çµ±" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://github.com/wekan/wekan/wiki/Install-Wekan-Docker-for-testing" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-docker-notes-2/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;hr>
&lt;p>&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/" target="_blank" rel="noopener"
>ä¸Šç¯‡æ–‡ç« &lt;/a>é«”é©—éåœ¨ CentOS ç”¨ Docker Container åˆ†åˆ¥è·‘ Nginx è·Ÿ ASP.NET Core ç¶²ç«™ï¼Œä¸¦å»ºç«‹ Reverse Proxy é—œä¿‚ï¼Œæ¥è‘—æ¢è¨åœ¨å¯¦å‹™ä¸Šç•¶éœ€è¦å¤šå€‹ Container å”åŒé‹ä½œæ™‚æ‡‰å¦‚ä½•è¦åŠƒæ•´åˆã€‚&lt;/p>
&lt;p>ä¸€å€‹ç³»çµ±å¸¸å¯å†æ‹†è§£æˆå¤šå€‹æœå‹™ã€‚ä»¥ç·šä¸Šè³¼ç‰©ç¶²ç«™ç‚ºä¾‹ï¼Œå°±å¯èƒ½æ˜¯ç”± ASP.NET Core ç¶²ç«™(Kestrel)ã€MySQL è³‡æ–™åº«ã€Reverse Proxyã€é‡‘æµ Gateway&amp;hellip; ç­‰å¤šå€‹æœå‹™çµ„æˆï¼Œè‹¥è¦ä»¥ Docker Container å¯¦ç¾ï¼Œæœ‰å¹¾ç¨®ç­–ç•¥ï¼š&lt;/p>
&lt;h2 id="ç­–ç•¥">ç­–ç•¥&lt;/h2>
&lt;h3 id="1-å…¨éƒ¨è£åœ¨å–®ä¸€-container">1. å…¨éƒ¨è£åœ¨å–®ä¸€ Container&lt;/h3>
&lt;p>æ’°å¯«ä¸€å€‹ Dockerfileï¼Œä»¥ MySQL è³‡æ–™è³‡æ–™åº«ç‚ºåŸºåº•ï¼Œåœ¨ä¸Šé¢å®‰è£ ASP.NET Core Runtimeã€Nginx çµ„è£åˆæˆç¸ã€‚&lt;/p>
&lt;p>å¥½è™•æ˜¯ä¸€å€‹ Container æå®šï¼Œé«˜å…§èšä½è€¦åˆï¼Œä¸æœƒå› ç›¸ä¾æœå‹™æ²’é…ç½®å¥½æˆ–æœªå•Ÿå‹•è€Œæ•…éšœã€‚ä½†ç¼ºé»æŒºæ˜é¡¯ï¼š&lt;/p>
&lt;ul>
&lt;li>æŸäº› Container Image ç‚ºæ±‚è¼•å·§ä½œæ¥­ç³»çµ±å±¤æ¬¡çš„å·¥å…·ã€ç¨‹å¼åº«å¾ˆç²¾ç°¡(ä¾‹å¦‚ï¼šNginx Container é€£ ping éƒ½æ²’æœ‰)ï¼Œåªæ±‚ç›®æ¨™ç¨‹å¼èƒ½åŸ·è¡Œå°±å¥½ï¼Œè¦åŠ è£å…¶ä»–è»Ÿé«”æ™‚è¦é»æŠ€å·§ï¼Œå¾—å¤šèŠ±äº›å¿ƒæ€ã€‚&lt;/li>
&lt;li>å…¨éƒ¨ç¶åœ¨ä¸€èµ·ä¾¿å¤±å»å‹•æ…‹èª¿é…çš„å½ˆæ€§ï¼Œä¾‹å¦‚ï¼šç•¶å‰ç«¯ Web è² è¼‰éé«˜æ™‚ï¼Œæ“´å……ä¸æ˜“ã€‚&lt;/li>
&lt;li>ç•¶éœ€è¦å€‹åˆ¥å‡ç´šè³‡æ–™åº«ã€ASP.NET Core ç‰ˆæœ¬ï¼Œæˆ–æ˜¯æƒ³æŠ½æ›æœå‹™çµ„åˆæ™‚æ‰‹çºŒè¤‡é›œï¼Œæœ‰é•æ¨¡çµ„åŒ–ç²¾ç¥ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="2-ä»¥å€‹åˆ¥-container-åŸ·è¡Œç¨ç«‹æ§åˆ¶">2. ä»¥å€‹åˆ¥ Container åŸ·è¡Œï¼Œç¨ç«‹æ§åˆ¶&lt;/h3>
&lt;p>å¦‚åŒ&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/" target="_blank" rel="noopener"
>å‰ç¯‡æ–‡ç« &lt;/a>çš„åšæ³•ï¼ŒASP.NET Core ç¶²ç«™è·‘ Cotainer ç¹«çµåˆ° Host OS çš„ 5000 Portï¼Œç”¨ Container è·‘ MySQLï¼Œå†ç”¨ Container è·‘ Ngnix ç¹«çµåˆ° Host OS 80 Portï¼Œå†è¨­å®š Reverse Proxy è¦å‰‡ã€‚&lt;/p>
&lt;p>Container é–“ä¸²æ¥é…ç½®å…¨é äººå·¥ï¼Œç³»çµ±ç®¡ç†å“¡éœ€å”åŠ©å“ªå€‹ Container è½å“ªå€‹ Portï¼Œç¢ºä¿å½¼æ­¤ä¸è¡çªã€‚å¦‚æ­¤åšæœ‰å…©å€‹ç¼ºé»ï¼š&lt;/p>
&lt;ul>
&lt;li>ç›¸ä¾æœå‹™çš„å•Ÿå‹•ç‹€æ…‹æœªé€£å‹•ï¼Œéœ€é äººç‚ºæ§åˆ¶ç¢ºä¿å…ˆå•Ÿå‹•è³‡æ–™åº« Container å†å•Ÿå‹•ç¶²ç«™ Container çš„é †åºã€‚&lt;/li>
&lt;li>è‹¥ Host OS è·‘å¤šå€‹ç³»çµ±éƒ½ç”¨åˆ° MySQLï¼Œç³»çµ±ç®¡ç†å“¡éœ€å”èª¿ TCP Port ä¸è¡çªï¼ŒDocker çš„ Bridge (æ©‹æ¥å™¨)éš”é›¢ç¶²æ®µæ©Ÿåˆ¶å…¨ç„¡ç”¨æ­¦ä¹‹åœ°ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="3-ä»¥å€‹åˆ¥-container-åŸ·è¡Œä½†ä½¿ç”¨-docker-compose-é—œè¯">3. ä»¥å€‹åˆ¥ Container åŸ·è¡Œï¼Œä½†ä½¿ç”¨ Docker Compose é—œè¯&lt;/h3>
&lt;p>ç‚ºæ»¿è¶³å¤š Container å”åŒä½œæ¥­éœ€æ±‚ï¼Œ&lt;a class="link" href="https://docs.docker.com/compose/overview/#/common-use-cases" target="_blank" rel="noopener"
>Docker Compose&lt;/a> æ‡‰é‹è€Œç”Ÿã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.docker.com/compose/overview/#/common-use-cases" target="_blank" rel="noopener"
>Docker Compose&lt;/a> å®šç¾©äº†ä¸€å¥—å®£å‘Šèªæ³•(æ¡ç”¨ YAML æ ¼å¼)ï¼Œåœ¨å…¶ä¸­å®šç¾©å„æœå‹™ Container çš„å•Ÿå‹•åƒæ•¸ã€èˆ‡ Host OS Port å°æ˜ ã€éš¸å±¬ Bridge ç¶²æ®µã€Volume è³‡æ–™å¤¾/æª”æ¡ˆå°æ‡‰ç­‰ç­‰ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.docker.com/compose/overview/#/common-use-cases" target="_blank" rel="noopener"
>Docker Compose&lt;/a> æœƒè‡ªå‹•ç‚º Container å»ºç«‹éš”é›¢ç¶²æ®µä¸¦è¨­å¥½åç¨±è§£æï¼Œè®“ Container ä½¿ç”¨å®¹å™¨åç¨±è§£ææˆ IP æ‰¾åˆ°å…¶ä»– Containerï¼Œå› æ­¤è¨­å®šé€£ç·šå­—ä¸²æˆ– URL æ™‚ä¾¿å¯å¯«æˆ httq://myweb:5000ã€mongodb://mydbï¼Œæ¸…æ¥šåˆæ–¹ä¾¿ã€‚&lt;/p>
&lt;p>æœ€é‡è¦æ˜¯é€é docker-compose up/down æŒ‡ä»¤å¯ä»¥ä¸€æ¬¡å•Ÿå‹•æˆ–åœç”¨ç›¸é—œæœå‹™ï¼Œ&lt;a class="link" href="https://docs.docker.com/compose/overview/#/common-use-cases" target="_blank" rel="noopener"
>Docker Compose&lt;/a> é‚„æœƒä¾æ“šç›¸ä¾ depends_on æŒ‡å®šé—œè¯å…ˆå•Ÿå‹• DB å†å•Ÿå‹• Webï¼Œå…ˆé—œé–‰ Web å†é—œé–‰ DBï¼Œä¾¿åˆ©æ€§è®“äººå·¥æ“ä½œæœ›å¡µè«åŠã€‚&lt;/p>
&lt;p>åƒè€ƒï¼š&lt;a class="link" href="http://blog.maxkit.com.tw/2017/03/docker-compose.html" target="_blank" rel="noopener"
>Docker Compose åˆæ­¥é–±è®€èˆ‡å­¸ç¿’è¨˜éŒ„&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="å¯¦ä¾‹">å¯¦ä¾‹&lt;/h2>
&lt;p>é‡å°ä¸Šè¿°ä¸‰ç¨®åšæ³•ï¼Œä»¥ ASP.NET Core + Ngninx ç‚ºé¡Œï¼Œå°æ˜ åˆ°ä»¥ä¸‹å¯¦ä¾‹ï¼š&lt;/p>
&lt;h3 id="1-å®‰è£æˆå–®ä¸€-container">1. å®‰è£æˆå–®ä¸€ Container&lt;/h3>
&lt;p>ä»¥ ASP.NET Core Image ç‚ºåŸºåº•ï¼Œå®‰è£ Nginxï¼Œè¨­å®š nginx.confï¼Œè¤‡è£½ ASP.NET Core ç¶²ç«™æª”æ¡ˆä¸¦è¨­å®š service nginx start åŠ dotnet /app/web.dll åˆ†åˆ¥å•Ÿå‹• Nginx åŠ Kestrelã€‚&lt;/p>
&lt;p>ç´°ç¯€åšæ³•å¯åƒè€ƒé€™ç¯‡æ–‡ç« ï¼š&lt;a class="link" href="https://www.sep.com/sep-blog/2017/02/24/nginx-reverse-proxy-to-asp-net-core-same-container/" target="_blank" rel="noopener"
>Nginx Reverse Proxy to ASP.NET Core â€“ Same Docker Container&lt;/a>&lt;/p>
&lt;p>ä¸éï¼Œè©²æ–‡ç”¨çš„ ASP.NET Core ç‰ˆæœ¬åèˆŠï¼Œè‹¥ç‚º ASP.NET Core 2.1 åŒ…æˆ Docker Container çš„åšæ³•è«‹åƒè€ƒ&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/" target="_blank" rel="noopener"
>å‰æ–‡&lt;/a>&lt;/p>
&lt;h3 id="2-aspnet-corenginx-å„è‡ªè·‘-container">2. ASP.NET Coreã€Nginx å„è‡ªè·‘ Container&lt;/h3>
&lt;p>å°±æ˜¯æˆ‘å€‘åœ¨&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/" target="_blank" rel="noopener"
>å‰ç¯‡æ–‡ç« &lt;/a>æ¡è¡Œçš„æ–¹å¼ï¼Œä½†æœ‰ä¸€é»è¦è£œå……ï¼Œé™¤äº†ç›´æ¥å°æ˜ åˆ° Host OS IP çš„ TCP Portï¼Œä¹Ÿå¯è€ƒæ…®è‡ªè¨‚ Bridgeï¼Œè®“ Container åœ¨éš”é›¢ç¶²æ®µå…§æºé€šï¼Œä¾‹å¦‚ï¼šASP.NET Core çš„ 5000 Port åªæœ‰ Nginx çœ‹å¾—åˆ°ï¼Œå¾ Host OS ç„¡æ³•å­˜å–ï¼Œå¦‚æ­¤å¯é¿å…ç¶²è·¯ä»‹é¢(ç¶²ç«™ã€è³‡æ–™åº«&amp;hellip;)å¤–éœ²åˆ° Host OSï¼Œæ¸›å°‘è¢«æ”»æ“Šçš„é¢¨éšªï¼Œé€™éƒ¨åˆ†å¾Œé¢å†æ‰¾æ™‚é–“ä»‹ç´¹ã€‚&lt;/p>
&lt;h3 id="3-ä½¿ç”¨-docker-compose-ä¸²é€£">3. ä½¿ç”¨ Docker Compose ä¸²é€£&lt;/h3>
&lt;p>ASP.NET Core èˆ‡ Nginx å„æœ‰è‡ªå·±çš„å®¹å™¨ï¼Œä½¿ç”¨ Docker Compose çµ„åˆä¸²é€£ï¼Œä¸€æ¬¡å•Ÿå‹•å…©å€‹æœå‹™ã€‚&lt;/p>
&lt;p>ç´°ç¯€åšæ³•å¯åƒè€ƒé€™ç¯‡æ–‡ç« ï¼š&lt;a class="link" href="https://www.sep.com/sep-blog/2017/02/27/nginx-reverse-proxy-to-asp-net-core-separate-docker-containers/" target="_blank" rel="noopener"
>Nginx Reverse Proxy to ASP.NET Core â€“ Separate Docker Containers&lt;/a>&lt;/p>
&lt;p>ç¶œåˆä»¥ä¸Šåˆ†æï¼ŒDocker Compose ç„¡ç–‘æ˜¯æ•´åˆé—œè¯ Container è¼ƒä½³çš„æ–¹å¼ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ç·´ç¿’">ç·´ç¿’&lt;/h2>
&lt;p>å…‰èªªä¸ç·´æ˜¯å‡æŠŠå¼ï¼Œå¯«æŠ€è¡“æ–‡æ²’å¯¦ä½œæ„Ÿè¦ºæ€ªæ€ªçš„ï¼Œä¾†å€‹ Docker Compose ç·´ç¿’å¥½äº†ã€‚æ‰‹é‚Šæ²’æœ‰ ASP.NET Core + DB Server çš„ç¯„ä¾‹ï¼Œå°±ç”¨ Docker å¯ä»¥æ‰¾åˆ°çš„ Image ç•¶é¡Œæ(ä¹Ÿæ–¹ä¾¿å¤§å®¶å¯¦åœ°é©—è­‰)ï¼Œè©¦è©¦ç”¨ Container è·‘ &lt;a class="link" href="https://wekan.github.io/" target="_blank" rel="noopener"
>Wekan çœ‹æ¿ç³»çµ±&lt;/a>ã€‚&lt;a class="link" href="https://wekan.github.io/" target="_blank" rel="noopener"
>Wekan&lt;/a> åœ¨ Node.js åŸ·è¡Œï¼Œå¦å¤–éœ€è¦ MongoDBï¼Œé€™å€‹ç·´ç¿’æœƒç”¨ Docker Compose çµ„åˆå…©å€‹ Container æ¶è¨­çœ‹æ¿ç¶²ç«™ã€‚&lt;/p>
&lt;p>é–‹å§‹å‰ï¼Œè¨˜å¾—å…ˆ&lt;a class="link" href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener"
>å®‰è£ Docker Compose&lt;/a>ï¼Œå¦‚æœç™¼ç”Ÿ sudo docker-compose æ‰¾ä¸åˆ°æŒ‡ä»¤ï¼Œè¦å†åŠ ä¸Š &lt;code>sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose&lt;/code> &lt;a class="link" href="https://stackoverflow.com/a/50243566/288936" target="_blank" rel="noopener"
>åƒè€ƒ&lt;/a>ã€‚&lt;/p>
&lt;p>è¦ä½¿ç”¨ Docker Compose å¾ˆç°¡å–®ï¼Œèªªç©¿äº†å°±æ˜¯å°‡ Container è¨­å®šå¯«æˆ docker-compose.ymlï¼Œå¯«å¥½å¯«å°å†å‘¼å« docker-compose up -d å³å¤§åŠŸå‘Šæˆã€‚ä»¥ Wekan ç‚ºä¾‹ï¼Œdocker-compose.yml å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;3&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wekan&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wekanteam/wekan:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">depends_on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">wekandb&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">MONGO_URL=mongodb://wekandb/wekan&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ROOT_URL=http://localhost:80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">80&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wekandb&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mongo:3.2.14&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/var/www/wekan/db:/data/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨é€™å€‹ YAML è£¡ï¼Œæˆ‘å®šç¾©äº†å…©å€‹ Service Containerï¼Œåˆ†åˆ¥å« &lt;strong>wekan&lt;/strong> åŠ &lt;strong>wekandb&lt;/strong>ã€‚&lt;/p>
&lt;p>Wekan Container Image ä¾†è‡ª wekanteam/wekan æœ€æ–°ç‰ˆï¼Œdepends_on å®£å‘Š wekan ä¾è³´ wekandbï¼Œæ•… Docker Compose æœƒå…ˆå•Ÿå‹• wekandb å†å•Ÿå‹• wekanã€‚&lt;/p>
&lt;p>MONGO_URLã€ROOTL_URL ç‚ºç’°å¢ƒè®Šæ•¸ï¼Œå…¶ä¸­ MONGO_URL å¯«æˆ mongodb://wekandb/wekanï¼Œdocker-compose.yml æ‰€å®šç¾©çš„å„ Container é è¨­éš¸å±¬åŒä¸€å€‹ Bridge ç¶²æ®µï¼Œå½¼æ­¤å¯ç”¨æ©Ÿå™¨åç¨±è§£æã€‚&lt;/p>
&lt;p>Wekan ç¶²ç«™åœ¨ Container æ›åœ¨ 8080 Portï¼Œé€é ports 80:8080 æœƒå°‡å…¶å°æ˜ åˆ° Host IP 80 Portã€‚&lt;/p>
&lt;p>wekandb Container å‰‡ä»¥ Mongo DB Container Image ç‚ºåŸºåº•ï¼Œè³‡æ–™åº«æª”æ¡ˆä»¥ Volume æ–¹å¼å°æ˜ åˆ° Host OS /var/www/wekan/db è³‡æ–™å¤¾ã€‚&lt;/p>
&lt;p>é€™è£¡è£œå……ä¸€å€‹çœ‰è§’ï¼Œç”±æ–¼ SELinux è³‡å®‰ç®¡æ§è¼ƒåš´ï¼Œåœ¨ CentOS/REHL/Fedora ç‰ˆ Linux ä¸Š Docker Container è®€å– Volume å°æ˜ è³‡æ–™å¤¾å¯èƒ½æœƒå‡ºç¾ permission denied éŒ¯èª¤ï¼Œéœ€å°è©²è³‡æ–™å¤¾åŸ·è¡Œ &lt;code>chcon -Rt svirt\_sandbox\_file\_t /var/www/wekan/db&lt;/code> èª¿æ•´æ¬Šé™ï¼Œæˆ–åœ¨ç›®éŒ„åç¨±å¾Œæ–¹åŠ ä¸Š &lt;code>:Z&lt;/code> ç”± Docker è‡ªå‹•åŸ·è¡Œã€‚&lt;/p>
&lt;p>åƒè€ƒï¼š&lt;a class="link" href="https://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/" target="_blank" rel="noopener"
>Using Volumes with Docker can Cause Problems with SELinux&lt;/a>&lt;/p>
&lt;p>å¯«å¥½ docker-compose.ymlï¼ŒåŸ·è¡Œ &lt;code>sudo docker-compose up -d&lt;/code>ï¼ŒDocker Compose ä¾åºå¸¶èµ· weknadbã€wekan å…©å€‹å®¹å™¨ï¼ŒWekan çœ‹æ¿å·²åœ¨ Host OS 80 Port é‹è¡ŒæˆåŠŸã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564919984_4f7956db54_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æœ€å¾Œè£œå……ä¸€é»ï¼Œå‰é¢æåˆ° Docker Compose æœƒç‚ºæ•´çµ„ Container å»ºç«‹å°ˆå±¬ Bridgeï¼Œä¸Šåœ–ä¸€é–‹å§‹çš„ Create network &amp;ldquo;wekan_default&amp;rdquo; with the default driver è¨Šæ¯å°±æ˜¯è­‰æ˜ã€‚&lt;/p>
&lt;p>åŸ·è¡Œ docker network lsï¼Œå¯çœ‹åˆ° wekan_default æ˜¯å€‹ bridgeï¼ŒåŸ·è¡Œ docker inspect wekan_default å‰‡å¯é€²ä¸€æ­¥çœ‹åˆ°é€™å€‹ç¶²æ®µç‚º 172.18.&lt;em>.&lt;/em>ï¼Œè€Œå…©å€‹ Container çš„ IP åˆ†åˆ¥ç‚º 172.28.0.3 åŠ 172.28.0.2ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564641066_0975c2159e_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>Docker Compose éå¸¸é©åˆç”¨ä¾†çµ„è£ Webã€DB ç­‰å¤šå€‹ Container æ§‹å»ºç³»çµ±ï¼Œä½†æˆ‘ç™¼ç¾é‡å° Nginx æ™‚æœ‰äº›é¡å¤–è€ƒé‡ï¼Œé€™éƒ¨åˆ†ç•™å¾…ä¸‹é›†åˆ†è§£ã€‚&lt;/p>
&lt;hr></description></item><item><title>ASP.NET Core Docker ç­†è¨˜ 1 - åˆæ¢</title><link>https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/</link><pubDate>Tue, 06 Dec 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-12-06/dotnet-core-docker-note-1/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52565101723_e9c2825542_o.png" alt="Featured image of post ASP.NET Core Docker ç­†è¨˜ 1 - åˆæ¢" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://blog.miniasp.com/post/2018/08/25/How-to-deploy-ASPNET-Core-to-Docker-Container.aspx" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;br>
&lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-docker-notes1/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>å‰é¢ç ”ç©¶é&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-nginx-install-on-centos/" target="_blank" rel="noopener"
>åœ¨ CentOS å®‰è£åŠè¨­å®š ASP.NET Core + Nginx&lt;/a>ï¼Œç¿’å¾—å¾’æ‰‹åœ¨ CentOS å®‰è£éƒ¨ç½²ä¼ºæœå™¨çš„æŠ€èƒ½ï¼Œä¾å¾ª Roadmap ä¾†åˆ°ä¸‹ä¸€éšæ®µ - å­¸ç¿’ä½¿ç”¨ Docker ç°¡åŒ–éƒ¨ç½²ã€‚&lt;/p>
&lt;p>å®¹å™¨åŒ–åŠ Docker é€™å¹¾å¹´ç†±åˆ°ç™¼ç‡™ï¼Œæœ‰äº›äººç”šè‡³èªç‚ºå®ƒå·²åœ¨è»Ÿé«”ç”¢æ¥­æ€èµ·ä¸€æ³¢é©å‘½ã€‚(æˆ‘è¦ªèº«é«”é©—çš„æ„Ÿæƒ³ä¹Ÿæ˜¯ï¼šWow! é›£æ€ªæœƒçˆ†ç´…) æ­¤åˆ»æ‰èµ·æ­¥å·²ç®—é²äº†ï¼Œä½†ä¹Ÿä¸æ˜¯æ²’æœ‰å¥½è™•ï¼Œæ™šèµ·é³¥å…’æœ‰æ›´å¤šèŸ²å¯ä»¥åƒï¼ŒDocker ç›¸é—œçš„æ–‡ç« è³‡æºå¤šå¦‚ç‰›æ¯›ï¼Œé€™è£¡ä¾¿ä¸å¤šèŠ±ç¯‡å¹…è´…è¿°è§€å¿µèˆ‡åŸºæœ¬æ“ä½œï¼Œåªç°¡å–®æ•´ç†æˆ‘å° Docker çš„ç†è§£ã€‚&lt;/p>
&lt;h2 id="docker-ç›¸é—œä»‹ç´¹">Docker ç›¸é—œä»‹ç´¹&lt;/h2>
&lt;h3 id="container">Container&lt;/h3>
&lt;p>Container (å®¹å™¨)å¯ä»¥æƒ³æˆæ¥µåº¦è¼•é‡åŒ–çš„è™›æ“¬æ©Ÿå™¨(Virtual Machine)ï¼Œç”¨æ³•åŠå„ªé»èˆ‡ VM ç›¸åŒï¼Œèƒ½åœ¨ä¸€å° Host OS åŒæ™‚é‹è¡Œå¤šå€‹å½¼æ­¤éš”é›¢çš„æ‡‰ç”¨ç¨‹å¼ç’°å¢ƒï¼Œä½†å·®åˆ¥åœ¨ Container æœƒå…±ç”¨åº•å±¤ Host OSï¼Œç›¸è¼ƒ VM éœ€å„è·‘ä¸€ä»½ Guest OS èƒ½çœä¸‹å¯è§€çš„è¨˜æ†¶é«”ã€ç£ç¢Ÿï¼Œå› æ­¤ Container å¤šäº†å•Ÿå‹•é€Ÿåº¦å¿«ï¼Œè€—ç”¨è³‡æºå°‘(èˆ‡ç›´æ¥è·‘æ‡‰ç”¨ç¨‹å¼ç›¸å»ä¸é )çš„å„ªå‹¢ã€‚&lt;/p>
&lt;p>ä¸€å° 4GB RAM çš„æ©Ÿå™¨é ‚å¤šè·‘ 2 - 3 å° VM å°±ç·Šç¹ƒäº†ï¼Œä½†åŸ·è¡Œæ•¸åä¸Šç™¾å€‹ Container ä¸æ˜¯å•é¡Œã€‚&lt;/p>
&lt;p>2 Container è·Ÿ VM ä¸€æ¨£å…·æœ‰å¾ˆå¥½çš„éš”é›¢æ•ˆæœï¼Œæ¯å€‹ Container æœ‰è‡ªå·±çš„ç¨ç«‹ä½œæ¥­ç’°å¢ƒ(è¨˜æ†¶é«”ã€ç£ç¢Ÿç©ºé–“ã€ç¶²è·¯)ï¼Œä¸æœƒå½¼æ­¤å¹²æ“¾ï¼Œä¸å¿…æ“”å¿ƒ Container A æ”¹ç³»çµ±è¨­å®šå®³ Container B è·‘ä¸èµ·ä¾†ï¼Œæˆ–æ˜¯å…©å€‹ Container äº’ç›¸æ¶å¥ª 80 Portï¼Œæ‹¿åˆ° Image å°±ä¸€å®šèƒ½åœ¨è‡ªå·±çš„æ©Ÿå™¨è·‘èµ·ä¾†ã€‚&lt;/p>
&lt;p>Container åœ¨é€™æ–¹é¢çš„ç‰¹æ€§èˆ‡ VM å®Œå…¨ç›¸åŒï¼Œä½†å› ç‚ºä¸ç”¨åŒ…å…¥ä½œæ¥­ç³»çµ±ï¼Œé«”ç©ç¸®å°è¨±å¤šï¼Œè€—ç”¨è¨˜æ†¶é«”ä¹Ÿå°‘ï¼Œä½†ä¾¿åˆ©æ€§å®Œå…¨ä¸æ¸›ï¼Œå–å¾— Container Imageï¼Œé ä¸€è¡ŒæŒ‡ä»¤å¹¾ç§’å…§å°±èƒ½åœ¨æ©Ÿå™¨æŠŠç¨‹å¼è·‘èµ·ä¾†ã€‚&lt;/p>
&lt;h3 id="docker-hub">Docker Hub&lt;/h3>
&lt;p>&lt;a class="link" href="https://hub.docker.com/" target="_blank" rel="noopener"
>Docker Hub&lt;/a> ä¸Šæœ‰è¶…é 10 è¬å€‹ Container Imageï¼Œå¾ PHPã€Node,jsã€Apacheã€MySQLã€Mongo DBã€Nginxã€Redisã€ASP.NET Core&amp;hellip; å¹¾ä¹æƒ³å¾—åˆ°çš„éƒ½æœ‰ï¼Œä¸‹æŒ‡ä»¤è‡ªå‹•ä¸‹è¼‰ Imageï¼Œå¹¾ç§’é˜å°±è£å¥½ä¸€å° DBã€Web ä¼ºæœå™¨ï¼Œå†ä¸‹å€‹æŒ‡ä»¤åˆè£å¥½ç¬¬äºŒå°ï¼Œä¸ç”¨æ“”å¿ƒè·Ÿä½œæ¥­ç³»çµ±ä¸ç›¸å®¹ã€èˆ‡å…¶ä»–è»Ÿé«”ç›¸è¡ã€ç³»çµ±ç’°å¢ƒæœ‰èª¤å°è‡´å®‰è£å¤±æ•—ï¼Œé€™å°±æ˜¯ Docker æœ€è¿·äººçš„æ‰€åœ¨ã€‚&lt;/p>
&lt;p>è€Œæˆ‘å€‘ä¹Ÿå¯å°‡è‡ªå·±çš„å°ˆæ¡ˆç¶²ç«™åšæˆ Imageï¼Œäº¤çµ¦æ¸¬è©¦äººå“¡æ¸¬è©¦ï¼Œäº¤ä»˜ OP å¹¾ç§’éƒ¨ç½²ä¸Šç·šï¼Œä¹Ÿèƒ½å°‡åšå¥½çš„ Image ä¸Šå‚³åˆ° Docker Hub èˆ‡å…¨ä¸–ç•Œåˆ†äº«ã€‚&lt;/p>
&lt;h3 id="docker-container">Docker Container&lt;/h3>
&lt;p>Docker Container èµ·åˆæ˜¯åŸºæ–¼ Linux Container æŠ€è¡“ï¼Œæ•…åœ¨ Container åªèƒ½è·‘ Linux å¹³å°æ‡‰ç”¨ç¨‹å¼ï¼Œé›–ç„¶åœ¨ Windows ä¹Ÿæœ‰ &lt;a class="link" href="https://blog.miniasp.com/post/2016/08/01/Docker-for-Windows-1-12-Released.aspx" target="_blank" rel="noopener"
>Docker for Windows&lt;/a>ï¼Œä½†èƒŒå¾Œæ˜¯ç”¨ Hyper-V è·‘ Linux è™›æ“¬æ©ŸåŸ·è¡Œ Docker Engine å†è·‘ Docker Containerã€‚&lt;/p>
&lt;p>å¾Œä¾†å¾®è»Ÿä¹Ÿä¾å¾ªç›¸åŒæ¦‚å¿µç™¼å±•å‡º Windows Containerï¼Œä¸¦èå…¥ Docker é«”ç³»ï¼Œè‡ªæ­¤ Docker Container é–‹å§‹æœ‰ Linux Containerã€Windows Container ä¹‹åˆ†ï¼ŒWindows Container è£¡è·‘çš„å°±æ˜¯ä¸æŠ˜ä¸æ‰£çš„ Windows ç¨‹å¼ã€‚&lt;/p>
&lt;p>åƒè€ƒï¼š&lt;a class="link" href="http://www.weithenn.org/2017/02/docker-install-ws2016.html" target="_blank" rel="noopener"
>å®‰è£ Docker å®¹å™¨ç’°å¢ƒ - Windows Server 2016&lt;/a>&lt;/p>
&lt;p>å¾æ­¤ï¼Œ&lt;a class="link" href="https://blog.gss.com.tw/index.php/2017/01/16/docker_for_windows_asp_net_webforms/" target="_blank" rel="noopener"
>åœ¨ Container è£¡è·‘ ASP.NET WebForm&lt;/a>ä¸å†æ˜¯å¤¢ã€‚&lt;/p>
&lt;h3 id="windows-container">Windows Container&lt;/h3>
&lt;p>Windows Container å•å¸‚å¾Œï¼ŒASP.NET Core ç¨‹å¼å®¹å™¨åŒ–æœ‰ Linux Container èˆ‡ Windows Container å…©ç¨®é¸æ“‡ã€‚&lt;/p>
&lt;p>åŸºæ–¼ Linux Container è³‡æºæ•¸é‡ä¸Šçš„å„ªå‹¢ï¼ŒåŠ ä¸Šè€—ç”¨è³‡æºè¼ƒå°‘ï¼Œè»Ÿç¡¬é«”æˆæœ¬ä½ï¼Œæˆ‘é¸æ“‡ Linux Containerã€‚&lt;/p>
&lt;p>é›–ç„¶ Container é–“å…±ç”¨åº•å±¤ä½œæ¥­ç³»çµ±ï¼ŒDocker Engine ç‚ºå®¹å™¨ä¸­çš„æ‡‰ç”¨ç¨‹å¼æä¾›éš”é›¢ä¸å—å¹²æ“¾çš„ç©ºé–“ï¼ˆè¨˜æ†¶é«”ã€æª”æ¡ˆç³»çµ±ã€ç¶²è·¯ Portï¼‰ã€‚&lt;/p>
&lt;p>ä¾‹å¦‚ï¼šå®¹å™¨ A å¯«å…¥ /etc/aaa/default.conf ä¸å½±éŸ¿å®¹å™¨ B /etc/aaa/default.conf çš„å…§å®¹ã€å®¹å™¨ A èˆ‡å®¹å™¨ B éƒ½ç¹«çµåˆ° 80 Port ä¹Ÿä¸æœƒè¡çªã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://wayne-blog.com/2014-10-28/docker-10-qa/" target="_blank" rel="noopener"
>å…ˆå‰æ–‡ç« &lt;/a>æéå°‡ Kestrel è½‰ç‚º Linux æœå‹™ã€è¨­å®š www-data åŸ·è¡Œæ¬Šé™&amp;hellip; ç­‰æ­¥é©Ÿï¼Œæ”¹ç”¨ Docker å¾Œç°¡å–®å¾ˆå¤šï¼Œç”Ÿå‘½é€±æœŸç”± Docker æ§åˆ¶ï¼Œåœ¨å®¹å™¨å…§éƒ¨æ¬Šé™ä¸€å¾‹ç‚º root ä¸éœ€é¡å¤–è¦åŠƒæ¬Šé™ï¼Œç›´æ¥è·‘ dotnet WebApp.dll è½ 5000 Port å°±å¥½ã€‚&lt;/p>
&lt;p>åƒè€ƒè³‡æ–™ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.ithome.com.tw/news/91847" target="_blank" rel="noopener"
>10å€‹Q&amp;amp;Aå¿«é€Ÿèªè­˜Docker&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://philipzheng.gitbooks.io/docker_practice/content/introduction/what.html" target="_blank" rel="noopener"
>ã€ŠDocker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸Â­ã€‹æ­£é«”ä¸­æ–‡ç‰ˆ&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener"
>Docker å…¥é—¨æ•™ç¨‹ by é˜®ä¸€å³°&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="ç·´ç¿’">ç·´ç¿’&lt;/h2>
&lt;p>Docker å®‰è£èˆ‡åŸºæœ¬æ“ä½œçš„åƒè€ƒè³‡æ–™å¾ˆå¤šï¼Œé€™è£¡ä¸å¤šä»‹ç´¹ï¼Œç›´æ¥ä¾†å¹¾å€‹ç·´ç¿’æš–èº«ï¼šåœ¨ CentOS ä¸Šç”¨ Docker ä¸‹è¼‰ç¾æˆ Conatiner Image åŸ·è¡Œ Nginx ä¼ºæœå™¨ï¼Œå†ç”¨é è¨­å°ˆæ¡ˆç¯„æœ¬å»ºç«‹ ASP.NET Core ç¶²ç«™ä¸¦åŒ…é€² Container åŸ·è¡Œã€‚æœ€å¾Œå°‡äºŒè€…ä¸²æ¥åœ¨ä¸€èµ·ï¼Œä½¿ç”¨ Nginx åšç‚º ASP.NET Core ç¶²ç«™çš„ Reverse Proxyã€‚&lt;/p>
&lt;h3 id="åŸ·è¡Œ-nginx-container">åŸ·è¡Œ Nginx Container&lt;/h3>
&lt;p>åŸ·è¡Œ Nginx Container&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo docker run --name mynginx -d -p 80:80 --rm nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸èª‡å¼µï¼ŒçœŸçš„åªè¦é€™è¡Œ Nginx å°±å¥½äº†ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>-d&lt;/code>ï¼šæŠŠ Container ä¸Ÿåˆ°èƒŒæ™¯åŸ·è¡Œä¸è¦ä½”ç”¨å‘½ä»¤åˆ—è¦–çª—&lt;/li>
&lt;li>&lt;code>-p 80:80&lt;/code>ï¼šè¡¨ç¤ºå°‡ Container çš„ 80 Port å°æ‡‰åˆ° Host OS çš„ 80 Port&lt;/li>
&lt;li>&lt;code>--rm&lt;/code>ï¼šè¡¨ç¤º Container åœæ­¢æ™‚è‡ªå‹•åˆªé™¤ã€‚&lt;/li>
&lt;/ul>
&lt;p>é–‹å€‹ Chrome é€£ä¸Š Host OS çš„ 80 Portï¼ŒNginx å·²ç¶“æº–å‚™å°±ç·’ï¼&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52565024765_48a069238f_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>è¨»ï¼šdocker æŒ‡ä»¤éœ€ç¹«çµ Unix Socketï¼Œå¿…é ˆä»¥ SuperUser æ¬Šé™åŸ·è¡Œï¼Œå°‡ä½¿ç”¨è€…åŠ å…¥ Docker ç¾¤çµ„å¯çœå»æ¯æ¬¡åŠ  sudo çš„éº»ç…©ã€‚åƒè€ƒï¼š&lt;a class="link" href="https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="noopener"
>Manage Docker as a non-root user&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo groupadd docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG docker &lt;span class="nv">$USER&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½†é€™æ‹›åœ¨ &lt;a class="link" href="https://www.projectatomic.io/blog/2015/08/why-we-dont-let-non-root-users-run-docker-in-centos-fedora-or-rhel/" target="_blank" rel="noopener"
>CentOS/Fedora/RHEL ä¸ç®¡ç”¨!&lt;/a>ï¼Œä½†æœ‰æ›¿ä»£æ–¹æ¡ˆï¼šåœ¨ &lt;code>/etc/sudoers&lt;/code> åŠ å…¥ &lt;code>yourUserAccount ALL=(ALL) NOPASSWD: /usr/bin/docker&lt;/code> é–‹æ”¾ sudo docker æ™‚ä¸ç”¨æ•²å¯†ç¢¼ï¼Œå†ç”¨ &lt;code>alias docker=&amp;quot;sudo /usr/bin/docker&amp;quot;&lt;/code> å»ºç«‹åŒç¾©è©ï¼Œä¹Ÿå¯åšåˆ°ä¸å¿… sudo æ•²å¯†ç¢¼è·‘ docker æŒ‡ä»¤ã€‚&lt;/p>
&lt;h3 id="å°‡-aspnet-core-å°ˆæ¡ˆåŒ…é€²-container">å°‡ ASP.NET Core å°ˆæ¡ˆåŒ…é€² Container&lt;/h3>
&lt;p>å°‡ ASP.NET Core å°ˆæ¡ˆåŒ…é€² Container ä½¿ç”¨ .NET Core CLI å»ºç«‹ MVC å°ˆæ¡ˆï¼Œä¿®æ”¹ Startup.cs å–æ¶ˆ app.UseHttpsRedirection()ï¼Œä»¥ Kestrel åŸ·è¡Œ ASP.NET Core ç¶²ç«™ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dotnet new mvc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i -e &lt;span class="s1">&amp;#39;s/app.UseHttps/\/\/app.UseHttps/&amp;#39;&lt;/span> Startup.cs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet publish
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dotnet bin/Debug/netcoreapp2.1/web.dll
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”±æ–¼ 5000 Port é è¨­ä¸å°å¤–é–‹æ”¾ï¼Œæ‡¶å¾—é–‹é˜²ç«ç‰†ï¼Œåœ¨æœ¬æ©Ÿç”¨ &lt;code>curl httq://localhost:5000&lt;/code> é©—è­‰ç¶²ç«™é‹è¡Œä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52565101738_65791a45d2_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>é©—è­‰ç¨‹å¼å¯åŸ·è¡Œå¾Œï¼Œå¯«å€‹ Dockerfile è…³æœ¬å°‡ç¨‹å¼å°è£æˆ Docker Imageï¼Œé€™éƒ¨åˆ†ç´°ç¯€å¯åƒè€ƒä¿å“¥çš„æ–‡ç« ï¼š&lt;a class="link" href="https://blog.miniasp.com/post/2018/08/25/How-to-deploy-ASPNET-Core-to-Docker-Container.aspx" target="_blank" rel="noopener"
>å¦‚ä½•å°‡ ASP.NET Core 2.1 ç¶²ç«™éƒ¨ç½²åˆ° Docker å®¹å™¨ä¸­&lt;/a>ã€‚&lt;/p>
&lt;p>åœ¨å¯¦å‹™ç’°å¢ƒå¯ä»¥è¨­è¨ˆæˆå…¨è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹ï¼Œåˆ°ç‰ˆæ§æŠ“åŸå§‹ç¢¼æ”¾é€²å…§å« .NET Core SDK çš„ Container ç·¨è­¯ï¼Œå°‡çµæœåŒ…æˆåªæœ‰ .NET Core Runtime çš„ Container Imageï¼Œç”¨å®ƒå»ºç«‹ Container é€²è¡Œ E2E æ¸¬è©¦ï¼Œä¸€åˆ‡è‡ªå‹•åŒ–ã€‚é€™è£¡ç‚ºæ±‚ç°¡ä¾¿ï¼Œæˆ‘é¸æ“‡ç”¨åªæœ‰ Runtime çš„ Container Image ç•¶æˆåŸºåº•ï¼Œå°‡åœ¨ Host OS ç·¨è­¯å¥½çš„æª”æ¡ˆè¤‡è£½åˆ° Container /app ç›®éŒ„ï¼ŒDockerfile å…§å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> microsoft/dotnet:2.1-aspnetcore-runtime&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">WORKDIR&lt;/span>&lt;span class="s"> /app&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> ./bin/Debug/netcoreapp2.1 ./&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ENTRYPOINT&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;dotnet&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;web.dll&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åšå¥½ Dockerfile å¾ŒåŸ·è¡Œ &lt;code>docker build&lt;/code>ï¼ŒDocker æœƒå¾ Docker Hub ä¸‹è¼‰ &lt;strong>microsoft/dotnet:2.1-aspnetcore-runtime&lt;/strong> (microsoft/dotnet æ˜¯ Image åç¨±ï¼ŒåŒä¸€ Image å¸¸æœ‰å¤šç¨®ç‰ˆæœ¬å¯é¸æ“‡ï¼Œ:2.1-aspnetcore-runtime æ˜¯æ¨™ç±¤å¯ç”¨ä¾†æŒ‡å®šç‰ˆæœ¬)ï¼Œ&lt;code>-t&lt;/code> åƒæ•¸æŒ‡å®š Image åç¨±ç‚º testappã€‚&lt;/p>
&lt;p>Container Image åšå¥½å¾Œæ¥è‘—ç”¨ &lt;code>docker run -d --rm --name myapp -p 5000:80 testapp&lt;/code> ç”¨å‰›åšå¥½çš„ Image å»ºç«‹ Containerï¼ŒASP.NET Core å°ˆæ¡ˆåœ¨ Container åŸ·è¡Œæ™‚ï¼Œé è¨­è½ 80 Portï¼Œæ•…æˆ‘å€‘ç”¨ -p 5000:80 å°‡ Container çš„ 80 Port å°å‘ Host OS çš„ 5000 Portã€‚ç”¨ curl é©—è­‰ç¶²ç«™é‹è¡Œä¸­ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564572251_d6b523fb3e_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ä½¿ç”¨ docker images åŠ docker ps æˆ‘å€‘å¯ä»¥çœ‹åˆ°å‰›æ‰å»ºç«‹çš„ Image testapp åŠ Container myappï¼š&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564111477_5a5d7b7acf_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;h3 id="å°‡-nginx-è¨­æˆ-aspnet-core-ç¶²ç«™çš„-reverse-proxy">å°‡ Nginx è¨­æˆ ASP.NET Core ç¶²ç«™çš„ Reverse Proxy&lt;/h3>
&lt;p>è‡³æ­¤ï¼Œæˆ‘å€‘åšäº†å…©å€‹ Containerï¼Œmyginx è½ Host OS 80 Portï¼Œmyapp è½ Host OS çš„ 5000 Portï¼Œä¸‹ä¸€æ­¥è¦å°‡ Nginx è¨­æˆ ASP.NET Core ç¶²ç«™çš„ Reverse Proxyã€‚&lt;/p>
&lt;p>åšæ³•è·Ÿ&lt;a class="link" href="https://wayne-blog.com/2022-12-06/dotnet-nginx-install-on-centos/" target="_blank" rel="noopener"
>å…ˆå‰æ–‡ç« &lt;/a>ä»‹ç´¹éçš„æ¦‚å¿µå·®ä¸å¤šï¼Œç‚ºæ±‚ç°¡ä¾¿æˆ‘å€‘ç›´æ¥ä¿®æ”¹ &lt;strong>conf.d/default.conf&lt;/strong> å°‡é€²å…¥ 80 Port çš„è«‹æ±‚å°å‘ 5000 Portã€‚(æ­£è¦åšæ³•å»ºè­°ä¸€å€‹ç¶²ç«™é–‹ä¸€å€‹ conf æª”) Container çš„æª”æ¡ˆç³»çµ±æ˜¯éš”é›¢çš„ï¼Œå°‡è¨­å®šæª”ä¿å­˜åœ¨ Container è£¡ä¸æ˜¯å¥½ä¸»æ„ - é™¤éæ¯æ¬¡ä¿®æ”¹è¨­å®šå­˜æª”å°±é‡æ–°ç”¢ç”Ÿ Image ä¸¦è¦æ±‚æœªä¾†ä¸€å¾‹æ”¹ç”¨æ–°ç‰ˆ Image å»ºç«‹ Containerï¼Œå¦å‰‡ä¸€æ—¦ Conatiner è¢«åˆªé™¤ï¼Œè¨­å®šå°±æœƒæ¶ˆå¤±ã€‚åŒæ¨£å•é¡Œä¹Ÿæœƒç™¼ç”Ÿåœ¨è³‡æ–™åº«æª”ã€Log æª”ç­‰åŸ·è¡ŒæœŸé–“è¦å‹•æ…‹æ›´æ–°çš„å…§å®¹ï¼Œé€™é¡æª”æ¡ˆä¿å­˜åœ¨ Host OS æª”æ¡ˆç³»çµ±ä¸Šæ¯”è¼ƒåˆç†ï¼Œç¨‹å¼æ›ç‰ˆæ›äº† Container Image è³‡æ–™æ‰ä¸å—å½±éŸ¿ã€‚Docker é  Volume è§£æ±ºè³‡æ–™ä¿å­˜åŠå…±ç”¨éœ€æ±‚ï¼Œdocker run æœ‰å€‹ -v host-path:container-path å¯å°‡ Host OS ç‰¹å®šç›®éŒ„æˆ–æª”æ¡ˆå°æ˜ åˆ° Containerï¼Œè®“ Container èƒ½è®€å¯« Host OS çš„æª”æ¡ˆã€‚&lt;/p>
&lt;p>å° Nginx Container ä¾†èªªï¼ŒReverse Proxy è¨­å®šæ”¾åœ¨ &lt;strong>/etc/nginx/conf.d&lt;/strong>ï¼Œæˆ‘é¸æ“‡åœ¨ Host OS ä¹Ÿå»ºç«‹ç›¸åŒè·¯å¾‘ä¸¦å°‡ Container çš„ default.conf è¤‡è£½å‡ºä¾†(æŒ‡ä»¤å¦‚ä¸‹)ï¼Œä¿®æ”¹å¾Œåœ¨ docker run åŠ ä¸Š &lt;strong>-v /etc/nginx/conf.d:/etc/nginx/conf.d&lt;/strong> å°æ˜ å›å»ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo docker cp mynginx:/etc/nginx/conf.d /etc/nginx/conf.d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564111512_3656ea3919_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ä¿®æ”¹ &lt;strong>/etc/nginx/conf.d/default.conf&lt;/strong>ï¼Œç›®å‰æ˜¯å°‡é€²å…¥ Nginx 80 Port çš„è«‹æ±‚å°å‘ Host OS 5000 Portï¼Œä½†å¾ Docker Container å­˜å– Host OS IP æœ‰äº›çœ‰è§’ï¼ŒMac æˆ– Windows Docker 18.3+ å¯ç”¨ DNS åç¨± host.docker.internal æŒ‡å‘ Host OS IPï¼Œä½† Docker for Linux 18.4+ é€™æ‹›å·±å¤±æ•ˆã€‚&lt;a class="link" href="https://stackoverflow.com/a/24326540/288936" target="_blank" rel="noopener"
>åƒè€ƒ&lt;/a>&lt;/p>
&lt;p>çœäº‹åšæ³•æ˜¯ docker run æ™‚ç”¨ &lt;code>--network host&lt;/code> è®“ Container ç›´æ¥ç¹«çµæœ¬æ©Ÿ IP è€Œé Docker æ‰€å±¬çš„éš”é›¢ç¶²æ®µï¼Œå¦‚æ­¤ default.conf çš„ proxy_pass æŒ‡å‘ localhost:5000 å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">localhost&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#charset koi8-r;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">#access_log /var/log/nginx/host.access.log main;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:5000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">keep-alive&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_cache_bypass&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-Proto&lt;/span> &lt;span class="nv">$scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®Œæ•´å•Ÿå‹•æŒ‡ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo docker run --name mynginx -d -v /etc/nginx/conf.d:/etc/nginx/conf.d --network host nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¾é ç«¯é–‹å•Ÿ Chrome é€£ä¸Š Host OS çš„ 80 Portï¼Œæˆ‘å€‘å·²è¢«é †åˆ©å°å‘ ASP.NET Core ç¶²ç«™ï¼Œé¡¯ç¤ºè¨­å®šæˆåŠŸã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52565024725_966ab6577d_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>ç¶“éä»¥ä¸Šç·´ç¿’ï¼Œæˆ‘å€‘é«”é©—äº†å¾ Docker Hub ä¸‹è¼‰ Image å»ºç«‹ Docker Containter è·‘ Nginxã€ç”¨ Dockerfile å°‡ ASP.NET Core ç¶²ç«™åŒ…æˆ Containerã€ç”¨ Port æ˜ å° Host OS TCP Port åˆ° Containerã€ä½¿ç”¨ -v(&amp;ndash;volume) æ˜ å°è³‡æ–™å¤¾è®“ Container è®€å¯« Host OS æª”æ¡ˆã€‚&lt;/p>
&lt;p>è€Œåœ¨å¯¦å‹™æ‡‰ç”¨ä¸Šï¼Œç›¸é—œçš„ Conatiner éœ€è¦çµ„åˆåœ¨ä¸€èµ·åŸ·è¡Œï¼Œä¾‹å¦‚ä¸€å€‹ Container è·‘ç¶²ç«™ï¼Œä¸€å€‹ Container è·‘è³‡æ–™åº«ï¼Œæ­¤æ™‚å¯ç”¨ docker-compose ç°¡åŒ–ç®¡ç†ï¼›å¦å¤– Docker ä¹Ÿæä¾› Bridge ç‚ºç›¸é—œ Container å»ºç«‹å°ˆå±¬çš„éš”é›¢ç¶²æ®µï¼Œé˜²æ­¢å¤–ç•Œæ¥è§¸åˆ°ä¸æƒ³å°å¤–å…¬é–‹çš„ç¶²è·¯æœå‹™ï¼Œä¹Ÿé¿å…ä¸ç›¸å¹²çš„ Container å½¼æ­¤å¹²æ“¾&amp;hellip; é€™äº›è­°é¡Œå°±ç•™å¾…ä¸‹ä¸€ç¯‡æ–‡ç« è¨è«–ã€‚&lt;/p>
&lt;hr></description></item><item><title>åœ¨ CentOS ä¸Šå®‰è£ ASP.NET Core + Nginx çš„ç­†è¨˜</title><link>https://wayne-blog.com/2022-12-06/dotnet-nginx-install-on-centos/</link><pubDate>Tue, 06 Dec 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-12-06/dotnet-nginx-install-on-centos/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52564798549_d9c11f4419_o.png" alt="Featured image of post åœ¨ CentOS ä¸Šå®‰è£ ASP.NET Core + Nginx çš„ç­†è¨˜" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://blog.darkthread.net/blog/aspnetcore-with-nginx/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>ASP.NET Core å…§å»ºçš„ Kestrel ä¼ºæœå™¨è¼•å·§ä½†åŠŸèƒ½é™½æ˜¥ï¼Œå¯¦å‹™ä¸Šéœ€æ­é… Reverse Proxy å°å¤–æä¾›æœå‹™ï¼ŒLinux æœ‰å…©å¤§ Reverse Proxy é¸æ“‡ï¼šApache åŠ Nginxï¼Œé€™é‚Šç­†è¨˜ä¸€ä¸‹ä½¿ç”¨é€™å¹¾å¹´å¦‚æ—¥ä¸­å¤©çš„ Nginxã€‚&lt;/p>
&lt;p>ç›¸è¼ƒæ–¼ Apacheã€lighttpdï¼ŒNginx æ¨™æ¦œå–®ä¸€åŸ·è¡Œç·’ã€è¨˜æ†¶è€—ç”¨å°‘ã€ç©©å®šæ€§é«˜ï¼Œå¼·èª¿æ•ˆèƒ½å–å‘ï¼Œåœ¨ç†±é–€ç¶²ç«™é–“ç¨éœ¸ä¸€æ–¹(åƒè€ƒï¼š&lt;a class="link" href="https://zh.wikipedia.org/wiki/Nginx" target="_blank" rel="noopener"
>ç¶­åŸºç™¾ç§‘&lt;/a>)ï¼Œèˆ‡å¼·èª¿æ•ˆèƒ½çš„ ASP.NET Core æ­é…ï¼Œç›¸å¾—ç›Šå½°ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘çš„ CentOS Nginx å®‰è£è¨­å®šç­†è¨˜ï¼š&lt;/p>
&lt;ol>
&lt;li>å®‰è£ Nginxã€‚åƒè€ƒï¼š&lt;a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-centos-7" target="_blank" rel="noopener"
>How To Install Nginx on CentOS 7&lt;/a>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo yum install epel-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo yum install nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>ç™¼ç¾ CentOS é è¨­æ²’è£ telnet å®¢æˆ¶ç«¯ï¼Œæª¢æ¸¬æŸ¥ä¿®ä¸ä¾¿ï¼Œå®‰è£ä¸€ä¸‹ telnetï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo yum install telnet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>å•Ÿå‹• Nginx&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo systemctl start nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å•Ÿå‹•å¾Œ telnet localhost 80 å¦‚æœ‰é€£ä¸Šå°±æ˜¯æˆåŠŸäº†ã€‚å¦‚å¾å¤–éƒ¨é€£ä¸ä¸Šå¤šæ˜¯é˜²ç«ç‰†ç·£æ•…ï¼Œéœ€é¡å¤–è¨­å®šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo firewall-cmd --permanent --zone&lt;span class="o">=&lt;/span>public --add-service&lt;span class="o">=&lt;/span>http
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo firewall-cmd --permanent --zone&lt;span class="o">=&lt;/span>public --add-service&lt;span class="o">=&lt;/span>https
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo firewall-cmd --reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¨­å¥½é˜²ç«ç‰†ï¼Œå¾ Windows é–‹ Chrome é€£ä¸Š CentOS ä¸»æ©Ÿ 80 Portï¼Œå¦‚æœçœ‹åˆ° Nginx æ­¡è¿ç¶²é å³ä»£è¡¨å¤§åŠŸå‘Šæˆã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564519771_a210643193_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;ol start="4">
&lt;li>ASP.NET Core æ–‡ä»¶æœ‰è©³ç´°çš„&lt;a class="link" href="https://docs.microsoft.com/zh-tw/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-2.1&amp;amp;tabs=aspnetcore2x&amp;amp;WT.mc_id=DOP-MVP-37580#configure-a-reverse-proxy-server" target="_blank" rel="noopener"
>Nginx è¨­å®šæ•™å­¸&lt;/a>ï¼Œåšæ³•æ˜¯ç›´æ¥ä¿®æ”¹ &lt;code>/etc/nginx/nginx.conf&lt;/code>ï¼Œåœ¨ http å€å¡ŠåŠ å…¥ server è¨­å®šã€‚&lt;/li>
&lt;/ol>
&lt;p>ä½†è¼ƒæ¨¡çµ„åŒ–çš„åšæ³•æ˜¯ç‚ºæ¯å€‹ç«™å°å¯«ç¨ç«‹ conf æª”æ”¾åœ¨ &lt;code>/etc/nginx/conf.d&lt;/code> ä¸‹ã€‚ä¾‹å¦‚ï¼š&lt;code>/etc/nginx/conf.d/default.conf&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">linux.darkblog.net&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">#æ¸¬è©¦ç”¨çš„è‡ªè¨‚ç¶²åŸŸåç¨±
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:5000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">keep-alive&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_cache_bypass&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-Proto&lt;/span> &lt;span class="nv">$scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¨­å®šå®Œç•¢å…ˆç”¨ &lt;code>sudo nginx -t&lt;/code> æ¸¬è©¦è¨­å®šæª”æœ‰æ²’æœ‰è¢«æ”¹å£ï¼Œè‹¥ OK å°±åŸ·è¡Œ &lt;code>sudo nginx -s reload&lt;/code> é‡æ–°è¼‰å…¥ã€‚&lt;/p>
&lt;ol start="5">
&lt;li>è©¦é€£æ™‚æˆ‘é‡åˆ° 502 Bad Gateway éŒ¯èª¤ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">2018/09/24 15:37:53 [crit] 60137#0: *7 connect() to 127.0.0.1:5000 failed (13: Permission denied) while connecting to upstream, client: 192.168.50.159, server: linux.darkblog.net, request: &amp;#34;GET / HTTP/1.1&amp;#34;, upstream: &amp;#34;http://127.0.0.1:5000/&amp;#34;, host: &amp;#34;linux.darkblog.net&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2018/09/24 15:37:53 [error] 60137#0: *7 no live upstreams while connecting to upstream, client: 192.168.50.159, server: linux.darkblog.net, request: &amp;#34;GET /favicon.ico HTTP/1.1&amp;#34;, upstream: &amp;#34;http://localhost/favicon.ico&amp;#34;, host: &amp;#34;linux.darkblog.net&amp;#34;, referrer: &amp;#34;http://linux.darkblog.net/&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çˆ¬æ–‡æ˜¯ Security-Enhanced Linux (SELinux) ä½œç¥Ÿï¼Œå®ƒæ˜¯ RHEL 6.6+/CentOS 6.6+ æ–°åŠ çš„å®‰å…¨é–ï¼Œéœ€ä¸‹æŒ‡ä»¤è§£é™¤å°å°ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo setsebool -P httpd_can_network_connect on
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>æ¥è‘—è¦è¨­å®š SSLï¼š&lt;/li>
&lt;/ol>
&lt;p>æœ‰å€‹å¾ˆå¨çš„å·¥å…·å« Certbotï¼Œå¯ä»¥è‡ªå‹•ç”³è«‹ã€é©—è­‰ã€ä¸‹è¼‰ã€å®‰è£ä¸¦å®šæœŸæ›´æ–° Let&amp;rsquo;s Enrypt æ†‘è­‰ã€‚ä½†é€™éƒ¨åˆ†è¦å°‡ç¶²ç«™æ­£å¼æ›ä¸Š Internet æ‰å¥½æ¸¬è©¦ï¼ŒçœŸå¯¦æ†‘è­‰ç•™å¾…æœªä¾†å†ç©ï¼Œæˆ‘å…ˆåšä¸€å¼µè‡ªç™¼æ†‘è­‰é©—è­‰ SSL åŠŸèƒ½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo mkdir /etc/ssl/private
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod &lt;span class="m">700&lt;/span> /etc/ssl/private
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo openssl req -x509 -nodes -days &lt;span class="m">365&lt;/span> -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem &lt;span class="m">2048&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å»ºç«‹ä¸€å€‹ /var/nginx/conf.d/ssl.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">http2&lt;/span> &lt;span class="s">ssl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:443&lt;/span> &lt;span class="s">http2&lt;/span> &lt;span class="s">ssl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">linux.darkblog.net&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">/etc/ssl/certs/nginx-selfsigned.crt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">/etc/ssl/private/nginx-selfsigned.key&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_dhparam&lt;/span> &lt;span class="s">/etc/ssl/certs/dhparam.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:5000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_http_version&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="s">.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">keep-alive&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_cache_bypass&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-Proto&lt;/span> &lt;span class="nv">$scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åƒè€ƒï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-centos-7" target="_blank" rel="noopener"
>How To Secure Nginx with Let&amp;rsquo;s Encrypt on CentOS 7&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.gtwang.org/linux/secure-nginx-with-lets-encrypt-ssl-certificate-on-ubuntu-and-debian/" target="_blank" rel="noopener"
>NGINX ä½¿ç”¨ Letâ€™s Encrypt å…è²» SSL æ†‘è­‰è¨­å®š HTTPS å®‰å…¨åŠ å¯†ç¶²é æ•™å­¸ - G.T.Wang&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-on-centos-7" target="_blank" rel="noopener"
>How To Create a Self-Signed SSL Certificate for Nginx on CentOS 7&lt;/a>&lt;/li>
&lt;/ul>
&lt;ol start="7">
&lt;li>
&lt;p>NLog.config è·¯å¾‘é…åˆä½œæ¥­ç³»çµ±è¦æ”¹ &lt;code>&amp;quot;/var/log/Darkblog/$/$.log&amp;quot;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ Reverse Proxy æ¨¡å¼ä¸‹ HttpContext.Connection.RemoteIpAddress æœƒæŠ“åˆ° ::1ï¼Œè€Œ HttpContext.Connection.RemotePort å‰‡æ˜¯ 5000ï¼Œä¸¦éçœŸå¯¦å®¢æˆ¶ç«¯ IP åŠå°å¤– Portã€‚åœ¨ Startup.cs åŠ å…¥ app.UseForwardedHeaders() å¯è§£æ±ºå•é¡Œï¼Œä½†å•Ÿç”¨ UseForwardedHeaders() è‹¥æœªæ­é… Reverse Proxy æœƒæœ‰ä¾†æº IP å½é€ é¢¨éšªï¼Œä¸æƒ³å†’éšªä¹Ÿä¸æƒ³é‡å° IIS / Nginx èª¿æ•´è¨­å®šï¼Œæˆ‘æƒ³åˆ°ä¸€æ‹›è®“ç¨‹å¼è‡ªå‹•ä¾ OS æ±ºå®šè¦ä¸è¦å•Ÿç”¨ï¼Œä¸€å‹æ°¸é€¸ï¼š&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cs" data-lang="cs">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IApplicationBuilder&lt;/span> &lt;span class="n">app&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IHostingEnvironment&lt;/span> &lt;span class="n">env&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//é‹è¡Œæ–¼ Linux æ™‚å•Ÿç”¨ Reverse Proxy æ¨¡å¼ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RuntimeInformation&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">IsOSPlatform&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OSPlatform&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Linux&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">UseForwardedHeaders&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span> &lt;span class="n">ForwardedHeadersOptions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ForwardedHeaders&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedFor&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="n">ForwardedHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">XForwardedProto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="9">
&lt;li>ç·šä¸Šä¸»æ©Ÿç•¶ç„¶ä¸å¥½æ¯æ¬¡é æ‰‹å‹•è¼¸å…¥ dotnet Blah.dll å•Ÿå‹•ç¶²ç«™ï¼Œ&lt;a class="link" href="https://docs.microsoft.com/zh-tw/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-2.1&amp;amp;tabs=aspnetcore2x&amp;amp;WT.mc_id=DOP-MVP-37580#monitoring-the-app" target="_blank" rel="noopener"
>ASP.NET Core æ–‡ä»¶&lt;/a>å±•ç¤ºäº†å°‡ç¨‹å¼åŒ…æˆæœå‹™çš„æ–¹æ³•ã€‚å…ˆå»ºç«‹ /etc/systemd/system/kestrel-darkblog.serviceï¼Œå…§å®¹å¦‚ä¸‹ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-service" data-lang="service">&lt;span class="line">&lt;span class="cl">&lt;span class="k">[Unit]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">Description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">Darkblog.Core Server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[Service]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">WorkingDirectory&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">/var/www/Darkblog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">/usr/bin/dotnet /var/www/Darkblog/Darkblog.Core.dll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">Restart&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">always&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c"># Restart service after 10 seconds if the dotnet service crashes:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">RestartSec&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">SyslogIdentifier&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">darkblog-core&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">User&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">www-data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">ASPNETCORE_ENVIRONMENT=Production&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">DOTNET_PRINT_TELEMETRY_MESSAGE=false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">[Install]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">multi-user.target&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="10">
&lt;li>è¨­å¥½ kestrel-darkblog.service å¾Œè¨»å†Šä¸¦å•Ÿå‹•æœå‹™&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> kestrel-darkblog.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start kestrel-darkblog.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status kestrel-darkblog.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é¦¬ä¸Šé‡åˆ°éŒ¯èª¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">exited&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">status&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">217&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">USER&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">Process&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">66571&lt;/span> &lt;span class="n">ExecStart&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dotnet&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">www&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Darkblog&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Darkblog&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Core&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dll&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">exited&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">status&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">FAILURE&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŸå› æ˜¯æœå‹™æ¨¡å¼ä½¿ç”¨ www-data èº«åˆ†åŸ·è¡Œï¼Œæ²’æœ‰æ¬Šé™å­˜å– ASP.NET Core ç¶²ç«™æ‰€åœ¨ç›®éŒ„èˆ‡æª”æ¡ˆã€‚é€™éƒ¨åˆ†æˆ‘ä¸æ˜¯å¾ˆç¢ºå®šåšæ³•ï¼Œæ‰¾åˆ°çš„è§£æ³•æ˜¯ç”¨ chown å°‡ /var/www/Darkblog ç›®éŒ„çš„æ“æœ‰è€…åŠç¾¤çµ„éƒ½è¨­æˆ www-dataï¼Œå»ºç«‹ www-data å¸³è™ŸåŠç¾¤çµ„ï¼Œä¸¦å°‡æˆ‘çš„ç®¡ç†å¸³è™Ÿä¹ŸåŠ å…¥ www-data ç¾¤çµ„ï¼Œå¦‚æ­¤æœå‹™å¯ä»¥å­˜å–è©²ç›®éŒ„ï¼Œè€Œæˆ‘ä¹Ÿæœ‰æ¬Šé™éƒ¨ç½²æª”æ¡ˆã€‚(è¨»ï¼š) ä»¥ä¸‹æŒ‡ä»¤å»ºç«‹ www-data ä½¿ç”¨è€…åŠç¾¤çµ„ï¼Œå°‡ jeffrey åŠ å…¥ç¾¤çµ„ï¼Œä¸¦æˆèˆ‡ www-data ç¾¤çµ„å¯ä»¥å¯«å…¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo groupadd www-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo useradd -g www-data www-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -a -G www-data jeffrey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod g+w -R /var/www/Darkblog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="11">
&lt;li>æœ‰ä¸€å‰‡å°è¨£ç«…ï¼Œä»¥æœå‹™æ–¹å¼åŸ·è¡Œ ASP.NET Core çœ‹ä¸åˆ°ä¸»æ§å°é¡¯ç¤ºçš„éŒ¯èª¤è¨Šæ¯ï¼Œå¯æ”¹ç”¨é€™å€‹æŒ‡ä»¤ä¾†æŸ¥çœ‹ï¼š&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo journalctl -fu kestrel-darkblog.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥ä¸Šï¼ŒASP.NET Core + Nginx on CentOS åŸ·è¡ŒæˆåŠŸã€‚&lt;/p>
&lt;p>é™„ä¸Š CPU / Memory ä½¿ç”¨ç‹€æ³ï¼Œé€™æ˜¯åœ¨é–‹ç€è¦½å™¨ç‹‚æŒ‰ F5 ä¸‹çš„æ•¸å­—ï¼Œç¸½è¨˜æ†¶é«” 1GBï¼Œdotnet CPU åœ¨ 5% ä»¥ä¸‹ï¼ŒRAM è€—ç”¨ä¸åˆ° 10%ï¼Œæœ‰å€‹ kworker CPU åé«˜ï¼Œçˆ¬æ–‡èˆ‡ç¡¬ç¢Ÿæœ‰é—œï¼Œæ¨æ¸¬èˆ‡ Win10 Hyper-V VM ä¸æ€éº¼çš„è™›æ“¬ç£ç¢Ÿæ•ˆèƒ½æœ‰é»é—œä¿‚ã€‚ä½†æ•´é«”æ•¸å­—è®“æˆ‘å¾ˆæ»¿æ„ï¼Œé·éƒ½ CentOS è¨ˆåŠƒç¹¼çºŒæŒºé€²ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52564971845_34b0be19ca_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>.NET SqlClient å®‰å…¨æ¼æ´ CVE-2022-41064 è§£è®€</title><link>https://wayne-blog.com/2022-11-11/dotnet-cve-2022-41064/</link><pubDate>Fri, 11 Nov 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-11-11/dotnet-cve-2022-41064/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52491745274_95b2fa11ec_o.jpg" alt="Featured image of post .NET SqlClient å®‰å…¨æ¼æ´ CVE-2022-41064 è§£è®€" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://blog.darkthread.net/blog/cve-2022-41064/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å¾®è»Ÿåœ¨ 2022-11-08 å…¬ä½ˆäº† &lt;strong>System.Data.SqlClient&lt;/strong>ã€&lt;strong>Microsoft.Data.SqlClient&lt;/strong> çš„å®‰å…¨æ¼æ´ï¼Œç”±æ–¼æ¶µè“‹å¤§é‡ .NET ç‰ˆæœ¬ (.NET Framework åˆ° .NET 6 éƒ½å¯èƒ½ä½¿ç”¨åˆ°)ï¼Œç¯„åœä¸å°ï¼Œèº«ç‚º .NET é–‹ç™¼äººå“¡ï¼Œæ‡‰è©²é—œæ³¨å…¶å½±éŸ¿åŠä¿®è£œæ–¹å¼ã€‚&lt;/p>
&lt;p>åƒè€ƒäº†ä»¥ä¸‹æ–‡ä»¶ï¼Œè©¦è‘—æ•´ç†è³‡è¨Šå¦‚å¾Œã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/dotnet/announcements/issues/239" target="_blank" rel="noopener"
>Microsoft Security Advisory CVE 2022-41064 | .NET Information Disclosure Vulnerability #239&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/advisories/GHSA-8g2p-5pqh-5jmc" target="_blank" rel="noopener"
>.NET Information Disclosure Vulnerability GHSA-8g2p-5pqh by GitHub&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-41064?WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>.NET Framework Information Disclosure Vulnerability CVE-2022-41064&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://devblogs.microsoft.com/dotnet/dotnet-framework-november-2022-security-and-quality-rollup-updates/?WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>.NET Framework November 2022 Security and Quality Rollup Updates&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="æ¼æ´ä¾†æºåŠæ”»æ“Šæ–¹å¼">æ¼æ´ä¾†æºåŠæ”»æ“Šæ–¹å¼&lt;/h2>
&lt;p>æ¼æ´ç™¼ç”ŸåŸå› æ˜¯ç¾æœ‰ SQL Client ç¨‹å¼åº«æœ‰å€‹ Bugï¼Œåœ¨é«˜è² è¼‰ç‹€æ³ä¸‹ã€Œ&lt;strong>éåŒæ­¥æŸ¥è©¢(Asynchronously Executed Query)&lt;/strong>ã€æœ‰å¯èƒ½ç™¼ç”ŸéŒ¯æ¥æŸ¥è©¢çµæœçš„ç‹€æ³ï¼Œäº¦å³æŸ¥è©¢ A æ‹¿åˆ°æŸ¥è©¢ B çš„çµæœã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¨»ï¼šè³‡è¨Šæœ‰é™ï¼Œä½† Asynchronously Executed Query æ‡‰æŒ‡ &lt;strong>ExecuteReaderAsync&lt;/strong>ã€&lt;strong>ExecuteScalarAsync&lt;/strong>ã€&lt;strong>ExecuteXmlReaderAsync&lt;/strong> ç­‰éåŒæ­¥æ–¹æ³•åƒè€ƒï¼ŒåŒæ­¥å¼æŸ¥è©¢(&lt;strong>ExecuteReader()&amp;hellip;&lt;/strong>)åœ¨ä¸€äº›ç‹€æ…‹ä¸‹ä¹Ÿæœ‰å¯èƒ½å—å½±éŸ¿ã€‚(åœ¨ Github æ‰¾åˆ°ç›¸é—œå–®å…ƒæ¸¬è©¦ï¼Œé€é &lt;strong>ExecuteReader()&lt;/strong> ä½†ä¸è®€å–å…§å®¹å°±æ‹‹æ£„ Transaction Scope æ–¹å¼é‡ç¾)&lt;/p>
&lt;/blockquote>
&lt;p>æ”»æ“ŠæˆåŠŸæ¢ä»¶ï¼š&lt;a class="link" href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-41064?WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>åƒè€ƒ&lt;/a>&lt;/p>
&lt;ol>
&lt;li>Exploiting this vulnerability requires an attacker to be within the SQL Connection Pool.&lt;br>
æ”»æ“Šè€…é ˆä½æ–¼åŒä¸€ SQL Connection Pool å…§ (æ›è¨€ä¹‹ï¼Œåœ¨åŒä¸€ Process å…§åŸ·è¡Œ)&lt;/li>
&lt;li>Successful exploitation of this vulnerability requires an attacker to exhaust all the threads in the thread pool.&lt;br>
æ”»æ“Šè€…éœ€è€—ç›¡æ‰€æœ‰ Thread Pool æ‰€æœ‰ Thread&lt;/li>
&lt;li>In this case, a successful attack could cause the attacker access queries from other users in the SQL Connection Pool.&lt;br>
åœ¨æ­¤ç‹€æ³ä¸‹ï¼Œæ”»æ“Šè€…æœ‰æ©Ÿæœƒå­˜å–åˆ°åŒ SQL Connetion Pool å…¶ä»–ä½¿ç”¨è€…çš„æŸ¥è©¢çµæœ(æ’¿åˆ°ä»€éº¼å…§å®¹å±¬éš¨æ©Ÿæ€§è³ª)&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="æ¼æ´ç¯„åœ">æ¼æ´ç¯„åœ&lt;/h2>
&lt;p>æ¼æ´å­˜åœ¨ &lt;strong>Microsoft.Data.SqlClient&lt;/strong> åŠ &lt;strong>System.Data.SqlClient&lt;/strong> çœ¾å¤šç‰ˆæœ¬ï¼š&lt;/p>
&lt;ul>
&lt;li>Microsoft.Data.SqlClient 1.1.3 (å«)ä¹‹å‰åŠ 2.0.0 ~ 2.1.1&lt;/li>
&lt;li>System.Data.SqlClient 4.8.4 (å«)ä¹‹å‰ç‰ˆæœ¬&lt;/li>
&lt;/ul>
&lt;p>è€Œå¾®è»Ÿä¹Ÿå·²é‡‹å‡º 1.1.4ã€2.1.2ã€4.8.5 ä¿®è£œæ¼æ´&lt;/p>
&lt;hr>
&lt;h2 id="ä¿®è£œæ–¹å¼">ä¿®è£œæ–¹å¼&lt;/h2>
&lt;p>.NET Core / .NET 5/6 ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ›´æ–°ç‰ˆæœ¬ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dotnet&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="kn">package&lt;/span> &lt;span class="nx">Microsoft&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SqlClient&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">version&lt;/span> &lt;span class="mf">2.1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="nx">æˆ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dotnet&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="kn">package&lt;/span> &lt;span class="nx">Microsoft&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SqlClient&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">version&lt;/span> &lt;span class="mf">1.1.4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="nx">æˆ–&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dotnet&lt;/span> &lt;span class="nx">add&lt;/span> &lt;span class="kn">package&lt;/span> &lt;span class="nx">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SqlClient&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">version&lt;/span> &lt;span class="mf">4.8.5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ–è€…ç›´æ¥ä¿®æ”¹ &lt;strong>.csproj&lt;/strong>ï¼š(è‹¥å°ˆæ¡ˆå…ˆåƒç…§å…¶ä»–ç¨‹å¼åº«å†é–“æ¥åƒç…§ SqlClientï¼Œä¹Ÿéœ€è¦åŠ å…¥ &lt;strong>PackageReference&lt;/strong> å¼·åˆ¶ä½¿ç”¨æ–°ç‰ˆ)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Project&lt;/span> &lt;span class="na">Sdk&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Microsoft.NET.Sdk.Web&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">PropertyGroup&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TargetFramework&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>net6.0&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">TargetFramework&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Nullable&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>enable&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Nullable&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ImplicitUsings&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>enable&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ImplicitUsings&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">PropertyGroup&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ItemGroup&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">PackageReference&lt;/span> &lt;span class="na">Include&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Microsoft.Data.SqlClient&amp;#34;&lt;/span> &lt;span class="na">Version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;2.1.2&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ItemGroup&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Project&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>.NET Framework è«‹å®‰è£ &lt;a class="link" href="https://devblogs.microsoft.com/dotnet/dotnet-framework-november-2022-security-and-quality-rollup-updates/?WT.mc_id=DOP-MVP-37580" target="_blank" rel="noopener"
>November 2022 Security and Quality Rollup Updates for .NET Framework&lt;/a>ã€‚&lt;/p>
&lt;hr></description></item><item><title>Entity Framework Core 6.0 å­—ä¸²å±¬æ€§å°æ‡‰æ¬„ä½ NOT NULL å•é¡Œ</title><link>https://wayne-blog.com/2022-11-10/efcore-6-string-not-null/</link><pubDate>Thu, 10 Nov 2022 00:00:00 +0000</pubDate><guid>https://wayne-blog.com/2022-11-10/efcore-6-string-not-null/</guid><description>&lt;img src="https://live.staticflickr.com/65535/52489392442_2208a4dc64_o.png" alt="Featured image of post Entity Framework Core 6.0 å­—ä¸²å±¬æ€§å°æ‡‰æ¬„ä½ NOT NULL å•é¡Œ" />&lt;style>
.article-content p code {
background-color: #f5f5f5;
color: #ff3860;
}
.focus {
background: #f1e2e2;
color: #d62c2c;
padding: 0 5px;
}
&lt;/style>
&lt;p>&lt;a class="link" href="https://blog.darkthread.net/blog/efcore-6-nullable/" target="_blank" rel="noopener"
>åƒè€ƒç¶²ç«™&lt;/a>&lt;/p>
&lt;p>å‡ç´š .NET 6 è¸©åˆ°çš„å°å•é¡Œç­†è¨˜ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å‰æƒ…æè¦">å‰æƒ…æè¦&lt;/h2>
&lt;p>ä¾ä¹‹å‰å­¸åˆ°çš„ EF Core Model è¨­è¨ˆï¼Œ&lt;strong>string&lt;/strong> å±¬æ€§é è¨­å°æ‡‰çš„æ¬„ä½é è¨­ç‚º &lt;strong>Nullable&lt;/strong>ï¼Œæ¨™è¨» &lt;strong>[Required]&lt;/strong> æ‰æœƒå®£å‘Šç‚º &lt;strong>NOT NULL&lt;/strong>ã€‚ ä¸éï¼Œé€™æ¢è¦å‰‡åˆ° &lt;strong>.NET 6&lt;/strong> å·²æœ‰æ‰€æ”¹è®Šã€‚æŸæ®µ EF Core å¯«å…¥è³‡æ–™åº«æ™‚å†’å‡ºæ¬„ä½&lt;strong>ä¸å…è¨± NULL&lt;/strong>ï¼Œä½† Model ä¸­è©²å±¬æ€§ä¸¦æœªå®£å‘Šç‚º &lt;strong>[Required]&lt;/strong>ã€‚&lt;/p>
&lt;p>ç ”ç©¶ç™¼ç¾é€™èˆ‡ &lt;strong>.NET 6&lt;/strong> å•Ÿç”¨ &lt;strong>Nullable Context&lt;/strong> æœ‰é—œï¼Œcsproj å¤šäº† &lt;code>&amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;/code> è¨­å®šä»¥æ”¯æ´ &lt;strong>C# 8&lt;/strong> æ¨å‡ºçš„ &lt;strong>Nullable Reference Type&lt;/strong> æ¦‚å¿µã€‚ è¨­ç‚º &lt;code>enable&lt;/code> æ™‚ï¼ŒCompiler å•Ÿç”¨ &lt;strong>Null Reference Analysis&lt;/strong> åŠç›¸é—œèªè¨€ç‰¹æ€§ï¼Œä»¥å­—ä¸²ç‚ºä¾‹ï¼Œè‹¥ string æ²’å®£å‘Šæˆ string? å»å¯èƒ½ç‚º null æ™‚æœƒ&lt;strong>å¾—åˆ°è­¦å‘Š&lt;/strong>ï¼›è‹¥è¦æ˜ç¢ºæ¨™ç¤ºæ­¤è™•å°±æ˜¯è¦è¨­æˆ nullï¼Œå¯åœ¨å¾Œæ–¹åŠ ä¸Š &lt;code>Null-Forgiving Operator&lt;/code>ï¼Œ ä¾‹å¦‚ &lt;code>string x = null!;&lt;/code>ã€‚&lt;/p>
&lt;p>è‹¥ä¸æƒ³å•Ÿç”¨æ­¤ç‰¹æ€§ï¼Œè¨­æˆ &lt;code>disable&lt;/code>ï¼ŒCompiler å³æœƒæ¢å¾© &lt;strong>C# 7.3&lt;/strong> ä»¥å‰çš„è¡Œç‚ºã€‚&lt;/p>
&lt;p>&lt;strong>EF Core&lt;/strong> ç”¢ç”Ÿè³‡æ–™åº«å°æ‡‰ SQL Schema æ™‚ï¼Œä¹Ÿæœƒå— &lt;strong>Nullable Context&lt;/strong> å½±éŸ¿ï¼Œç•¶ &lt;code>&amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;/code>ï¼Œå³ä½¿æœªåŠ  &lt;strong>[Required]&lt;/strong>ï¼ŒModel çš„å­—ä¸²å±¬æ€§ä»æœƒè¢«è¦–ç‚º&lt;strong>ä¸å¯ç‚º null&lt;/strong>ï¼Œåœ¨ &lt;strong>CREATE TABLE&lt;/strong> æ™‚æœƒåŠ ä¸Š &lt;strong>NOT NULL&lt;/strong>ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å•é¡Œé‡ç¾">å•é¡Œé‡ç¾&lt;/h2>
&lt;p>ç”¨ä»¥ä¸‹ç¨‹å¼é‡ç¾å•é¡Œã€‚ç°¡å–®å®£å‘Šäº† Entity å‹åˆ¥ã€DbContextï¼Œå…¶ä¸­ &lt;strong>RequiredText&lt;/strong> æœ‰åŠ è¨» &lt;strong>[Required]&lt;/strong>ï¼Œå¦ä¸€å€‹ OptionalText å‰‡æ²’æœ‰ï¼Œå‘¼å« &lt;strong>DbContext.DataBase.GenerateCreateScript()&lt;/strong> æª¢è¦–å…¶å°æ‡‰çš„ SQL Schemaï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System.ComponentModel.DataAnnotations&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Microsoft.EntityFrameworkCore&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="p">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">new&lt;/span> &lt;span class="n">DbContextOptionsBuilder&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">MyContext&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">UseSqlServer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;data source=(localdb)\\mssqllocaldb&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">Options&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">var&lt;/span> &lt;span class="n">dbCtx&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">MyContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbCtx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Database&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">GenerateCreateScript&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MyContext&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">DbContext&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">DbSet&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">Items&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">!;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="n">MyContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DbContextOptions&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">MyContext&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="k">base&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">Item&lt;/span> &lt;span class="c1">//Entity å‹åˆ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//æ…£ä¾‹ï¼Œå±¬æ€§åç¨±ç‚º Id æˆ– &amp;lt;type name&amp;gt;Id æœƒè‡ªå‹•æˆç‚º Entity çš„ Key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">ItemId&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na"> [Required]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">RequiredText&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">!;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">public&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="n">OptionalText&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">get&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">set&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">!;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œç•¶ &lt;code>&amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;/code> æ™‚ï¼ŒOptionalText ä¹Ÿæœƒè¢«åŠ ä¸Š &lt;strong>NOT NULL&lt;/strong>ï¼Œæ›æˆ &lt;code>disable&lt;/code> æ‰æœƒæ¢å¾©ä¹‹å‰çš„è¦å‰‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52490430998_2830c1d9b4_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œ&lt;strong>.NET 6&lt;/strong> å•Ÿç”¨ &lt;strong>Nullable Context&lt;/strong> æ™‚ï¼ŒModel å­—ä¸²å±¬æ€§è¦&lt;strong>å…è¨±&lt;/strong> nullï¼Œå‹åˆ¥ä¹Ÿéœ€æ”¹æˆ &lt;strong>string?&lt;/strong>ï¼Œé€™æ¨£æ‰æœƒå°æ‡‰æˆ &lt;strong>Nullable&lt;/strong> è³‡æ–™åº«æ¬„ä½ã€‚(è¨»ï¼š&lt;strong>RequiredText&lt;/strong> æ•…æ„æ‹¿æ‰ &lt;strong>= null!&lt;/strong> è§¸ç™¼ CS8618 è­¦å‘Šï¼Œè­‰æ˜æœ‰è¨­ &lt;code>&amp;lt;Nullable&amp;gt;enable&amp;lt;/Nullable&amp;gt;&lt;/code>)&lt;/p>
&lt;p>&lt;img src="https://live.staticflickr.com/65535/52490349030_170f87c2be_o.png"
max-width="100%"
max-height="100%"
class="gallery-image"
loading="lazy"
>&lt;/p>
&lt;hr></description></item></channel></rss>