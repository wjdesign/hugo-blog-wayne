<!doctype html><html lang=zh-tw dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="網站建置不是件簡單的事，我們都知道網站做好之後，有好多細節需要兼顧，所以許多公司花了大量的時間與金錢，耗用人力對維護中的網站進行不斷的、重複的人工測試，想達到的目的不外乎是希望網站不要出錯，可以給客戶/使用者最好的網站使用體驗。本篇章說明使用 Vue3 開發的專案，導入 Vitest 進行極速單元測試的體驗！"><meta name=keywords content="javascript,vue,vite,vitest,unit test,unit,單元,測試,單元測試"><title>闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！</title><link rel=canonical href=https://wayneblog.ga/2022-12-29/vitest-unit-test/><link rel=stylesheet href=https://wayneblog.ga/scss/style.min.576d408ce2abc4c6a243e28ac841a3ec197891287a535f544f21febd01184634.css><script>!function(e,t,n,s,o,i,a){if(e.fbq)return;o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],i=t.createElement(n),i.async=!0,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","843131703668116"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=843131703668116&ev=PageView&noscript=1"></noscript><meta property="og:title" content="闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！"><meta property="og:description" content="網站建置不是件簡單的事，我們都知道網站做好之後，有好多細節需要兼顧，所以許多公司花了大量的時間與金錢，耗用人力對維護中的網站進行不斷的、重複的人工測試，想達到的目的不外乎是希望網站不要出錯，可以給客戶/使用者最好的網站使用體驗。本篇章說明使用 Vue3 開發的專案，導入 Vitest 進行極速單元測試的體驗！"><meta property="og:url" content="https://wayneblog.ga/2022-12-29/vitest-unit-test/"><meta property="og:site_name" content="Wayne's blog | 偉恩的部落格 | 技術博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="vitest"><meta property="article:tag" content="typescript"><meta property="article:tag" content="javascript"><meta property="article:published_time" content="2022-12-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-29T00:00:00+00:00"><meta property="og:image" content="https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg"><meta name=twitter:site content="@4006wayne"><meta name=twitter:creator content="@4006wayne"><meta name=twitter:title content="闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！"><meta name=twitter:description content="網站建置不是件簡單的事，我們都知道網站做好之後，有好多細節需要兼顧，所以許多公司花了大量的時間與金錢，耗用人力對維護中的網站進行不斷的、重複的人工測試，想達到的目的不外乎是希望網站不要出錯，可以給客戶/使用者最好的網站使用體驗。本篇章說明使用 Vue3 開發的專案，導入 Vitest 進行極速單元測試的體驗！"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg"><link rel="shortcut icon" href=https://live.staticflickr.com/65535/52275825736_808b1fd4a8_o.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-FG6KQD7H6C"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FG6KQD7H6C",{anonymize_ip:!1})}</script><script></script><style>:root{--zh-font-family:"Microsoft JhengHei", "微軟正黑體";--code-font-family:Menlo, Monaco, Consolas, "Courier New"}</style><meta name=theme-color content="#57BCB9"><link rel=manifest href=./manifest.json><link rel=apple-touch-icon sizes=57x57 href=./apple-touch-icon-57x57.webp><link rel=apple-touch-icon sizes=114x114 href=./apple-touch-icon-114x114.webp><link rel=apple-touch-icon sizes=120x120 href=./apple-touch-icon-120x120.webp><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon-180x180.webp><link rel=apple-touch-icon sizes=192x192 href=./apple-touch-icon-192x192.webp><link rel=apple-touch-icon sizes=512x512 href=./apple-touch-icon-512x512.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=https://wayneblog.ga/><img src=https://wayneblog.ga/img/avatar2d.webp width=256 height=256 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🧧</span></figure><div class=site-meta><h1 class=site-name><a href=https://wayneblog.ga/>Wayne (偉恩)</a></h1><h2 class=site-description>軟體開發 | 網路工程 | 技術博客</h2></div></header><ol class=social-menu><li><a href=https://www.facebook.com/wayne.blog.ga/ target=_blank title=Facebook><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><linearGradient id="CXanuwD9EGkBgTn76_1mxa" x1="9.993" x2="40.615" y1="-299.993" y2="-330.615" gradientTransform="matrix(1 0 0 -1 0 -290)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2aa4f4"/><stop offset="1" stop-color="#007ad9"/></linearGradient><path fill="url(#CXanuwD9EGkBgTn76_1mxa)" d="M24 4C12.954 4 4 12.954 4 24c0 10.028 7.379 18.331 17.004 19.777C21.981 43.924 22.982 41 24 41c.919.0 1.824 2.938 2.711 2.818C36.475 42.495 44 34.127 44 24 44 12.954 35.046 4 24 4z"/><path d="M27.707 21.169c0-1.424.305-3.121 1.757-3.121h4.283l-.001-5.617-.05-.852-.846-.114c-.608-.082-1.873-.253-4.206-.253-5.569.0-8.636 3.315-8.636 9.334v2.498H15.06v7.258h4.948V43.6C21.298 43.861 22.633 44 24 44c1.268.0 2.504-.131 3.707-.357V30.301h5.033l1.122-7.258h-6.155V21.169z" opacity=".05"/><path d="M27.207 21.169c0-1.353.293-3.621 2.257-3.621h3.783V12.46l-.026-.44-.433-.059c-.597-.081-1.838-.249-4.143-.249-5.323.0-8.136 3.055-8.136 8.834v2.998H15.56v6.258h4.948v13.874C21.644 43.876 22.806 44 24 44c1.094.0 2.16-.112 3.207-.281V29.801h5.104l.967-6.258h-6.072V21.169z" opacity=".05"/><path fill="#fff" d="M26.707 29.301h5.176l.813-5.258h-5.989v-2.874c0-2.184.714-4.121 2.757-4.121h3.283V12.46c-.577-.078-1.797-.248-4.102-.248-4.814.0-7.636 2.542-7.636 8.334v3.498H16.06v5.258h4.948v14.475C21.988 43.923 22.981 44 24 44c.921.0 1.82-.062 2.707-.182V29.301z"/></svg></a></li><li><a href=https://github.com/wjdesign target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.instagram.com/huai_lin/ target=_blank title=Instagram><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><path fill="#304ffe" d="M41.67 13.48c-.4.26-.97.5-1.21.77-.09.09-.14.19-.12.29v1.03l-.3 1.01-.3 1-.33 1.1-.68 2.25-.66 2.22-.5 1.67c0 .26-.01.52-.03.77-.07.96-.27 1.88-.59 2.74-.19.53-.42 1.04-.7 1.52-.1.19-.22.38-.34.56-.4.63-.88 1.21-1.41 1.72-.41.41-.86.79-1.35 1.11h-.01c-.08.07-.17.13-.27.18-.31.21-.64.39-.98.55-.23.12-.46.22-.7.31-.05.03-.11.05-.16.07-.57.27-1.23.45-1.89.54-.04.01-.07.01-.11.02-.4.07-.79.13-1.19.16-.18.02-.37.03-.55.03l-.71-.04-3.42-.18c0-.01-.01.0-.01.0l-1.72-.09c-.13.0-.27.0-.4-.01-.54-.02-1.06-.08-1.58-.19h-.01c-.95-.18-1.86-.5-2.71-.93-.47-.24-.93-.51-1.36-.82-.18-.13-.35-.27-.52-.42-.48-.4-.91-.83-1.31-1.27-.06-.06-.11-.12-.16-.18-.06-.06-.12-.13-.17-.19-.38-.48-.7-.97-.96-1.49-.24-.46-.43-.95-.58-1.49-.06-.19-.11-.37-.15-.57-.01-.01-.02-.03-.02-.05-.1-.41-.19-.84-.24-1.27-.06-.33-.09-.66-.09-1-.02-.13-.02-.27-.02-.4l1.91-2.95 1.87-2.88.85-1.31.77-1.18.26-.41v-1.03c.02-.23.03-.47.02-.69-.01-.7-.15-1.38-.38-2.03-.22-.69-.53-1.34-.85-1.94-.38-.69-.78-1.31-1.11-1.87C14 7.4 13.66 6.73 13.75 6.26 14.47 6.09 15.23 6 16 6h16c4.18.0 7.78 2.6 9.27 6.26C41.43 12.65 41.57 13.06 41.67 13.48z"/><path fill="#4928f4" d="M42 16v.27l-1.38.8-.88.51-.97.56-1.94 1.13-1.9 1.1-1.94 1.12-.77.45c0 .48-.12.92-.34 1.32-.31.58-.83 1.06-1.49 1.47-.67.41-1.49.74-2.41.98.0.0.0-.01-.01.0-3.56.92-8.42.5-10.78-1.26-.66-.49-1.12-1.09-1.32-1.78-.06-.23-.09-.48-.09-.73v-7.19c.01-.15-.09-.3-.27-.45-.54-.43-1.81-.84-3.23-1.25-1.11-.31-2.3-.62-3.3-.92-.79-.24-1.46-.48-1.86-.71.18-.35.39-.7.61-1.03 1.4-2.05 3.54-3.56 6.02-4.13C14.47 6.09 15.23 6 16 6h10.8c5.37.94 10.32 3.13 14.47 6.26.16.39.3.8.4 1.22.18.66.29 1.34.32 2.05C42 15.68 42 15.84 42 16z"/><path fill="#6200ea" d="M42 16v4.41l-.22.68-.75 2.33-.78 2.4-.41 1.28-.38 1.19-.37 1.13-.36 1.12-.19.59-.25.78c0 .76-.02 1.43-.07 2-.01.06-.02.12-.02.18-.06.53-.14.98-.27 1.36-.01.06-.03.12-.05.17-.26.72-.65 1.18-1.23 1.48-.14.08-.3.14-.47.2-.53.18-1.2.27-2.02.32-.6.04-1.29.05-2.07.05H31.4l-1.19-.05L30 37.61l-2.17-.09-2.2-.09-7.25-.3-1.88-.08h-.26c-.78-.01-1.45-.06-2.03-.14-.84-.13-1.49-.35-1.98-.68-.7-.45-1.11-1.11-1.35-2.03-.06-.22-.11-.45-.14-.7-.1-.58-.15-1.25-.18-2 0-.15.0-.3-.01-.46-.01-.01.0-.01.0-.01v-.58c-.01-.29-.01-.59-.01-.9l.05-1.61.03-1.15.04-1.34v-.19l.07-2.46.07-2.46.07-2.31.06-2.27.02-.6c0-.31-1.05-.49-2.22-.64-.93-.12-1.95-.23-2.56-.37.05-.23.1-.46.16-.68.18-.72.45-1.4.79-2.05.18-.35.39-.7.61-1.03 2.16-.95 4.41-1.69 6.76-2.17 2.06-.43 4.21-.66 6.43-.66 7.36.0 14.16 2.49 19.54 6.69.52.4 1.03.83 1.53 1.28C42 15.68 42 15.84 42 16z"/><path fill="#673ab7" d="M42 18.37v4.54l-.55 1.06-1.05 2.05-.56 1.08-.51.99-.22.43c0 .31.0.61-.02.9.0.43-.02.84-.05 1.22-.04.45-.1.86-.16 1.24-.15.79-.36 1.47-.66 2.03-.04.07-.08.14-.12.2-.11.18-.24.35-.38.51-.18.22-.38.41-.61.57-.34.26-.74.47-1.2.63-.57.21-1.23.35-2.01.43-.51.05-1.07.08-1.68.08l-.42.02-2.08.12h-.01L27.5 36.6l-2.25.13-3.1.18-3.77.22-.55.03c-.51.0-.99-.03-1.45-.09-.05-.01-.09-.02-.14-.02-.68-.11-1.3-.29-1.86-.54-.68-.3-1.27-.7-1.77-1.18-.44-.43-.82-.92-1.13-1.47-.07-.13-.14-.25-.2-.39-.3-.59-.54-1.25-.72-1.97-.03-.12-.06-.25-.08-.38-.06-.23-.11-.47-.14-.72-.11-.64-.17-1.32-.2-2.03v-.01c-.01-.29-.02-.57-.02-.87l-.49-1.17-.07-.18L9.5 25.99 8.75 24.2l-.12-.29-.72-1.73-.8-1.93H7.1L6.29 18.3 6 17.59V16c0-.63.06-1.25.17-1.85.05-.23.1-.46.16-.68.85-.49 1.74-.94 2.65-1.34 2.08-.93 4.31-1.62 6.62-2.04 1.72-.31 3.51-.48 5.32-.48 7.31.0 13.94 2.65 19.12 6.97.2.16.39.32.58.49C41.09 17.48 41.55 17.91 42 18.37z"/><path fill="#8e24aa" d="M42 21.35v5.14l-.57 1.19-1.08 2.25-.01.03c0 .43-.02.82-.05 1.17-.1 1.15-.38 1.88-.84 2.33-.33.34-.74.53-1.25.63-.03.01-.07.01-.1.02-.16.03-.33.05-.51.05-.62.06-1.35.02-2.19-.04-.09.0-.19-.01-.29-.02-.61-.04-1.26-.08-1.98-.11-.39-.01-.8-.02-1.22-.02h-.02l-1.01.08h-.01l-2.27.16-2.59.2-.38.03-3.03.22-1.57.12-1.55.11c-.27.0-.53.0-.79-.01.0.0-.01-.01-.01.0-1.13-.02-2.14-.09-3.04-.26-.83-.14-1.56-.36-2.18-.69-.64-.31-1.17-.75-1.6-1.31-.41-.55-.71-1.24-.9-2.07v-.01c-.14-.67-.22-1.45-.22-2.33l-.15-.27L9.7 26.35l-.13-.22L9.5 25.99l-.93-1.65-.46-.83-.58-1.03-1-1.79L6 19.75v-3.68c.88-.58 1.79-1.09 2.73-1.55 1.14-.58 2.32-1.07 3.55-1.47 1.34-.44 2.74-.79 4.17-1.02 1.45-.24 2.94-.36 4.47-.36 6.8.0 13.04 2.43 17.85 6.47.22.17.43.36.64.54.84.75 1.64 1.56 2.37 2.41C41.86 21.18 41.94 21.26 42 21.35z"/><path fill="#c2185b" d="M42 24.71v7.23c-.24-.14-.57-.31-.98-.49-.22-.11-.47-.22-.73-.32-.38-.17-.79-.33-1.25-.49-.1-.04-.2-.07-.31-.1-.18-.07-.37-.13-.56-.19-.59-.18-1.24-.35-1.92-.5-.26-.05-.53-.1-.8-.14-.87-.15-1.8-.24-2.77-.25-.08-.01-.17-.01-.25-.01l-2.57.02-3.5.02h-.01l-7.49.06c-2.38.0-3.84.57-4.72.8.0.0-.01.0-.01.01-.93.24-1.22.09-1.3-1.54-.02-.45-.03-1.03-.03-1.74l-.56-.43-.98-.74-.6-.46-.12-.09L8.88 24.1l-.25-.19-.52-.4-.96-.72L6 21.91v-3.4c.1-.08.19-.15.29-.21 1.45-1 3-1.85 4.64-2.54 1.46-.62 3-1.11 4.58-1.46.43-.09.87-.18 1.32-.24 1.33-.23 2.7-.34 4.09-.34 6.01.0 11.53 2.09 15.91 5.55.66.52 1.3 1.07 1.9 1.66.82.78 1.59 1.61 2.3 2.49.14.18.28.36.42.55C41.64 24.21 41.82 24.46 42 24.71z"/><path fill="#d81b60" d="M42 28.72V32c0 .65-.06 1.29-.18 1.91-.18.92-.49 1.8-.91 2.62-.22.05-.47.05-.75.01-.63-.11-1.37-.44-2.17-.87-.04-.01-.08-.03-.11-.05-.25-.13-.51-.27-.77-.43-.53-.29-1.09-.61-1.65-.91-.12-.06-.24-.12-.35-.18-.64-.33-1.3-.63-1.96-.86h-.01c-.14-.05-.29-.1-.44-.14-.57-.16-1.15-.26-1.71-.26l-1.1-.32-4.87-1.41h-.01l-2.99-.87h-.01l-1.3-.38c-3.76.0-6.07 1.6-7.19.99-.44-.23-.7-.81-.79-1.95-.03-.32-.04-.68-.04-1.1l-1.17-.57-.05-.02h-.01l-.84-.42L9.7 26.35l-.07-.03-.17-.09L7.5 25.28 6 24.55v-3.43c.17-.15.35-.29.53-.43.19-.15.38-.29.57-.44h.01c1.18-.85 2.43-1.6 3.76-2.22 1.55-.74 3.2-1.31 4.91-1.68.25-.06.51-.12.77-.16 1.42-.27 2.88-.41 4.37-.41 5.27.0 10.11 1.71 14.01 4.59 1.13.84 2.18 1.77 3.14 2.78.79.83 1.52 1.73 2.18 2.67.05.07.1.14.15.2.37.54.71 1.09 1.03 1.66C41.64 28.02 41.82 28.37 42 28.72z"/><path fill="#f50057" d="M41.82 33.91c-.18.92-.49 1.8-.91 2.62-.19.37-.4.72-.63 1.06-.14.21-.29.41-.44.6-.36-.14-.89-.34-1.54-.56v-.01c-.49-.17-1.05-.35-1.65-.52-.17-.05-.34-.1-.52-.15-.71-.19-1.45-.36-2.17-.46-.6-.1-1.19-.16-1.74-.16l-.46-.13h-.01l-2.42-.7-1.49-.43-1.66-.48h-.01l-.54-.15-6.53-1.88-1.88-.54-1.4-.33-2.28-.54-.28-.07h-.01l-2.29-.53v-.01l-.41-.09-.21-.05-1.67-.39-.19-.05-1.42-1.17L6 27.9v-4.08c.37-.36.75-.7 1.15-1.03.12-.11.25-.21.38-.31.12-.1.25-.2.38-.3.91-.69 1.87-1.31 2.89-1.84 1.3-.7 2.68-1.26 4.13-1.66.28-.09.56-.17.85-.23 1.64-.41 3.36-.62 5.14-.62 4.47.0 8.63 1.35 12.07 3.66 1.71 1.15 3.25 2.53 4.55 4.1.66.79 1.26 1.62 1.79 2.5.05.07.09.13.13.2.32.53.62 1.08.89 1.64.25.5.47 1 .67 1.52C41.34 32.25 41.6 33.07 41.82 33.91z"/><path fill="#ff1744" d="M40.28 37.59c-.14.21-.29.41-.44.6-.44.55-.92 1.05-1.46 1.49-.47.39-.97.74-1.5 1.04-.2-.05-.4-.11-.61-.19-.66-.23-1.35-.61-1.99-1.01-.96-.61-1.79-1.27-2.16-1.57-.14-.12-.21-.18-.21-.18l-1.7-.15L30 37.6l-2.2-.19-2.28-.2-3.37-.3-5.34-.47-.02-.01-1.88-.91-1.9-.92-1.53-.74-.33-.16-.41-.2-1.42-.69L7.43 31.9l-.59-.29L6 31.35v-4.47c.47-.56.97-1.09 1.5-1.6.34-.32.7-.64 1.07-.94.06-.05.12-.1.18-.14.04-.05.09-.08.13-.1.59-.48 1.21-.91 1.85-1.3.74-.47 1.52-.89 2.33-1.24.87-.39 1.78-.72 2.72-.97 1.63-.46 3.36-.7 5.14-.7 4.08.0 7.85 1.24 10.96 3.37 1.99 1.36 3.71 3.08 5.07 5.07.45.64.85 1.32 1.22 2.02.13.26.26.52.37.78.12.25.23.5.34.75.21.52.4 1.04.57 1.58.32 1 .56 2.02.71 3.08C40.21 36.89 40.25 37.24 40.28 37.59z"/><path fill="#ff5722" d="M38.39 39.42c0 .08.0.17-.01.26-.47.39-.97.74-1.5 1.04-.22.12-.44.24-.67.34-.23.11-.46.21-.7.3-.34-.18-.8-.4-1.29-.61-.69-.31-1.44-.59-2.02-.68-.14-.03-.27-.04-.39-.04l-1.64-.21h-.02l-2.04-.27-2.06-.27-.96-.12-7.56-.98c-.49.0-1.01-.03-1.55-.1-.66-.06-1.35-.16-2.04-.3-.68-.12-1.37-.28-2.03-.45-.69-.16-1.37-.35-2-.53-.73-.22-1.41-.43-1.98-.62-.47-.15-.87-.29-1.18-.4-.18-.43-.33-.88-.44-1.34C6.1 33.66 6 32.84 6 32v-1.67c.32-.53.67-1.05 1.06-1.54.71-.94 1.52-1.8 2.4-2.56.03-.04.07-.07.1-.09l.01-.01c.31-.28.63-.53.97-.77.04-.04.08-.07.12-.1.16-.12.33-.24.51-.35 1.43-.97 3.01-1.73 4.7-2.24 1.6-.48 3.29-.73 5.05-.73 3.49.0 6.75 1.03 9.47 2.79 2.01 1.29 3.74 2.99 5.06 4.98.16.23.31.46.46.7.69 1.17 1.26 2.43 1.68 3.75.05.15.09.3.13.46.08.27.15.55.21.83.02.07.04.14.06.22.14.63.24 1.29.31 1.95v.01C38.36 38.22 38.39 38.82 38.39 39.42z"/><path fill="#ff6f00" d="M36.33 39.42c0 .35-.02.73-.06 1.11-.02.18-.04.36-.06.53-.23.11-.46.21-.7.3-.45.17-.91.31-1.38.41-.32.07-.65.13-.98.16h-.01c-.31-.19-.67-.42-1.04-.68-.67-.47-1.37-1-1.93-1.43-.01-.01-.01-.01-.02-.02-.59-.45-1.01-.79-1.01-.79l-1.06.04-2.04.07-.95.04-3.82.14-3.23.12c-.21.01-.46.01-.77.0h-.01c-.42-.01-.92-.04-1.47-.09-.64-.05-1.34-.11-2.05-.18-.69-.08-1.39-.16-2.06-.24-.74-.08-1.44-.17-2.04-.25-.47-.06-.88-.11-1.21-.15-.28-.32-.53-.65-.77-1.01-.36-.54-.67-1.11-.91-1.72-.18-.43-.33-.88-.44-1.34.29-.89.67-1.73 1.12-2.54.36-.66.78-1.29 1.24-1.89.45-.59.94-1.14 1.47-1.64v-.01c.15-.15.3-.29.45-.42.28-.26.57-.5.87-.73h.01c.01-.02.02-.02.03-.03.24-.19.49-.36.74-.53 1.48-1.01 3.15-1.76 4.95-2.2 1.19-.29 2.44-.45 3.73-.45 2.54.0 4.94.61 7.05 1.71h.01c1.81.93 3.41 2.21 4.7 3.75.71.82 1.32 1.72 1.82 2.67.35.64.65 1.31.9 1.99.02.06.04.11.06.16.17.5.32 1.02.45 1.54.09.37.16.75.22 1.13.02.12.04.23.05.35C36.28 37.99 36.33 38.7 36.33 39.42z"/><path fill="#ff9800" d="M34.28 39.42v.1c0 .34-.03.77-.06 1.23-.03.34-.06.69-.09 1.02-.32.07-.65.13-.98.16h-.01C32.76 41.98 32.39 42 32 42h-1.75l-.38-.11-1.97-.6-2-.6-4.63-1.39-2-.6s-.83.33-2 .72h-.01c-.45.15-.94.31-1.46.47-.65.19-1.34.38-2.02.53-.7.16-1.39.28-2.01.33-.19.02-.38.03-.55.03-.56-.31-1.1-.68-1.59-1.09-.43-.36-.83-.75-1.2-1.18-.28-.32-.53-.65-.77-1.01.07-.45.15-.89.27-1.32.3-1.19.77-2.33 1.39-3.37.34-.59.72-1.16 1.16-1.69.01-.03.04-.06.07-.08-.01-.01.0-.01.0-.01.13-.17.27-.33.41-.48v-.01c.41-.44.83-.86 1.29-1.25.16-.13.31-.26.48-.39.03-.03.06-.05.1-.08 2.25-1.72 5.06-2.76 8.09-2.76 3.44.0 6.57 1.29 8.94 3.41 1.14 1.03 2.11 2.26 2.84 3.63.06.1.12.21.17.32.09.18.18.37.26.57.33.72.59 1.48.77 2.26.02.08.04.16.06.24.08.37.15.75.2 1.13C34.24 38.21 34.28 38.81 34.28 39.42z"/><path fill="#ffc107" d="M32.22 39.42c0 .2-.01.42-.02.65-.02.37-.05.77-.1 1.18-.02.25-.06.5-.1.75h-5.48l-1.06-.17-4.14-.66-.59-.09-1.35-.22c-.59.0-1.87.26-3.22.51-.71.13-1.43.27-2.08.36-.08.01-.16.02-.23.03h-.01c-.7-.15-1.38-.38-2.02-.68-.2-.09-.4-.19-.6-.3-.56-.31-1.1-.68-1.59-1.09-.01-.12-.02-.22-.02-.27.0-.26.01-.51.03-.76.04-.64.13-1.26.27-1.86.22-.91.54-1.79.97-2.6.08-.17.17-.34.27-.5.04-.08.09-.15.13-.23.18-.29.38-.57.58-.85.42-.55.89-1.07 1.39-1.54h.01c.04-.04.08-.08.12-.11.05-.04.09-.09.14-.12.2-.18.4-.34.61-.49.0-.01.01-.01.01-.01 1.89-1.41 4.23-2.24 6.78-2.24 1.98.0 3.82.5 5.43 1.38h.01c1.38.76 2.58 1.79 3.53 3.03.37.48.7.99.98 1.53h.01c.05.1.1.2.15.3.3.59.54 1.21.72 1.85h.01c.01.05.03.1.04.15.12.43.22.87.29 1.32.01.09.02.19.03.28C32.19 38.43 32.22 38.92 32.22 39.42z"/><path fill="#ffd54f" d="M30.17 39.31c0 .16.0.33-.02.49v.01.01c-.02.72-.12 1.43-.28 2.07.0.04-.01.07-.03.11h-4.67l-3.85-.83-.51-.11-.08.02-4.27.88L16.27 42H16c-.64.0-1.27-.06-1.88-.18-.09-.02-.18-.04-.27-.06h-.01c-.7-.15-1.38-.38-2.02-.68-.02-.11-.04-.22-.05-.33-.07-.43-.1-.88-.1-1.33.0-.17.0-.34.01-.51.03-.54.11-1.07.23-1.58.08-.38.19-.75.32-1.1.11-.31.24-.61.38-.9.12-.25.26-.49.4-.73.14-.23.29-.45.45-.67.4-.55.87-1.06 1.39-1.51.3-.26.63-.51.97-.73 1.46-.96 3.21-1.52 5.1-1.52.37.0.73.02 1.08.07h.02c1.07.12 2.07.42 2.99.87h.01c1.45.71 2.68 1.78 3.58 3.1.15.22.3.46.43.7.11.19.21.39.3.59.14.31.27.64.38.97h.01c.11.37.21.74.28 1.13v.01C30.11 38.16 30.17 38.73 30.17 39.31z"/><path fill="#ffe082" d="M28.11 39.52v.03c0 .59-.07 1.17-.21 1.74-.05.24-.12.48-.21.71h-4.48l-2.29-.63L18.63 42H16c-.64.0-1.27-.06-1.88-.18-.02-.03-.03-.06-.04-.09-.14-.43-.25-.86-.3-1.31-.04-.29-.06-.59-.06-.9.0-.12.0-.25.02-.37.01-.47.08-.93.2-1.37.06-.3.15-.59.27-.87.04-.14.1-.27.17-.4.15-.34.33-.67.53-.99.22-.32.46-.62.73-.9.32-.36.68-.69 1.09-.96.7-.51 1.5-.89 2.37-1.1.58-.16 1.19-.24 1.82-.24 2 0 3.79.8 5.09 2.09.05.05.11.11.16.18h.01c.14.15.27.3.4.47.37.47.68.98.92 1.54.12.26.22.53.3.81.01.04.02.07.03.11.14.49.23 1 .25 1.53C28.1 39.2 28.11 39.36 28.11 39.52z"/><path fill="#ffecb3" d="M26.06 39.52c0 .41-.05.8-.16 1.17-.1.4-.25.78-.44 1.14-.03.06-.1.17-.1.17h-8.88c-.01-.01-.02-.03-.02-.04-.12-.19-.22-.38-.3-.59-.2-.46-.32-.96-.36-1.48-.02-.12-.02-.25-.02-.37.0-.06.0-.13.01-.19.01-.44.07-.86.19-1.25.1-.36.23-.69.4-1.01.0.0.01-.01.01-.02.12-.21.25-.42.4-.62.49-.66 1.14-1.2 1.89-1.55h.01c.24-.12.49-.22.75-.29h.01c.46-.14.96-.21 1.47-.21.59.0 1.16.09 1.68.28.19.05.37.13.55.22h.01c.86.41 1.59 1.05 2.09 1.85.1.15.19.31.27.48.04.07.08.15.11.22.23.52.37 1.09.41 1.69.01.05.01.1.01.16C26.06 39.36 26.06 39.44 26.06 39.52z"/><g><path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M30 11H18c-3.9.0-7 3.1-7 7v12c0 3.9 3.1 7 7 7h12c3.9.0 7-3.1 7-7V18c0-3.9-3.1-7-7-7z"/><circle cx="31" cy="16" r="1" fill="#fff"/></g><g><circle cx="24" cy="24" r="6" fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2"/></g></svg></a></li><li><a href=https://twitter.com/4006wayne target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=https://wayneblog.ga/%E9%97%9C%E6%96%BC%E6%9C%AC%E7%AB%99/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>關於本站</span></a></li><li><a href=https://wayneblog.ga/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>文章卷宗</span></a></li><li><a href=https://wayneblog.ga/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜尋檢索</span></a></li><li><a href=https://wayneblog.ga/%E7%9B%B8%E9%97%9C%E9%80%A3%E7%B5%90/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>相關連結</span></a></li><li><a href=https://wayneblog.ga/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分類檢索</span></a></li><li><a href=https://wayneblog.ga/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>標籤檢索</span></a></li><li><a href=https://wayneblog.ga/index.xml target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg><span>RSS Feed</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://wayneblog.ga/ selected>繁體中文</option><option value=https://wayneblog.ga/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>夜晚模式</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><a class=btnBack href=javascript:void(0) onclick=backEvent()><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-back" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 11l-4 4 4 4m-4-4h11a4 4 0 000-8h-1"/></svg><span class=btnBackText>BACK</span></a>
<script>function backEvent(){if(document.referrer.indexOf(window.location.host)!==-1){history.go(-1);return}window.location.href=window.location.origin}</script><header class=article-header><div class=article-image><a href=https://wayneblog.ga/2022-12-29/vitest-unit-test/><img src=https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg loading=lazy alt="Featured image of post 闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！"></a></div><div class=article-details><header class=article-category><a href=https://wayneblog.ga/categories/vitest/ style=background-color:#719d2a;color:#fff>Vitest</a>
<a href=https://wayneblog.ga/categories/typescript/ style=background-color:#2d79c7;color:#fff>Typescript</a>
<a href=https://wayneblog.ga/categories/javascript/ style=background-color:#f7b41b;color:#fff>Javascript</a></header><div class=article-title-wrapper><h2 class=article-title><a href=https://wayneblog.ga/2022-12-29/vitest-unit-test/>闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！</a></h2><h3 class=article-subtitle>網站建置不是件簡單的事，我們都知道網站做好之後，有好多細節需要兼顧，所以許多公司花了大量的時間與金錢，耗用人力對維護中的網站進行不斷的、重複的人工測試，想達到的目的不外乎是希望網站不要出錯，可以給客戶/使用者最好的網站使用體驗。本篇章說明使用 Vue3 開發的專案，導入 Vitest 進行極速單元測試的體驗！</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Dec 29, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 40 分鐘</time></div></footer></div></header><section class=article-content><style>.article-content p code{background-color:#f5f5f5;color:#ff3860}.focus{background:#f1e2e2;color:#d62c2c;padding:0 5px}</style><p><a class=link href=https://blog.miniasp.com/post/2019/02/18/Unit-testing-Integration-testing-e2e-testing target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/articles/10278764 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/articles/10298229 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/articles/10293368 target=_blank rel=noopener>參考網站</a></p><p>網站建置不是件簡單的事，我們都知道網站做好之後，有好多細節需要兼顧，所以許多公司花了大量的時間與金錢，耗用人力對維護中的網站進行不斷的、重複的人工測試，想達到的目的不外乎是希望網站不要出錯，可以給客戶/使用者最好的網站使用體驗。本篇章說明使用 Vue3 開發的專案，導入 Vitest 進行極速單元測試的體驗！</p><hr><h2 id=測試的種類>測試的種類</h2><p>在不同的測試類型中，所需要保護的面向不太相同，以下是不同測試類型的大致介紹：</p><h3 id=單元測試-unit-testing>單元測試 (Unit testing)</h3><p>以程式碼的最小單位進行測試，保護程式邏輯不會在系統維護的過程中遭到破壞，也進一步確保維護中的程式碼品質。</p><p>這種測試類型通常由開發人員自行撰寫，自己寫的 Code 自己寫測試，有經驗的開發人員可以用非常有效率的方式撰寫單元測試，因為測試範圍小，這種類型的測試通常不需要設立測試環境，因此可以得到較高的撰寫效率，也是所有測試類型中最容易撰寫的測試類型。不過，對於一個沒有經驗的開發者來說，撰寫單元測試可能會耗用大量時間，寫測試程式的時間很有可能會遠大於實際撰寫程式碼的時間，有蠻多人會因為這樣而放棄撰寫單元測試。</p><h3 id=整合測試-integration-testing>整合測試 (Integration testing)</h3><p>整合多方資源進行測試，確保模組與模組之間的互動行為正確無誤，也讓不同模組在各自開發維護的過程中不會因為功能調整而遭到破壞。</p><p>這種類型的測試通常介於單元測試與端對端測試之間，有時候會由專職的測試人員進行開發，但大部分還是由開發團隊中負責特定模組的人來撰寫。有時候單一模組即便完全通過單元測試，獨立運作也正常，但是當需要與其他模組互動時，也是有可能發生錯誤，這時就是整合測試的主要負責領域。</p><p>以下是未通過整合測試的案例：(兩個元件在整合時發現問題)</p><p><img src=https://live.staticflickr.com/65535/52593420093_cb58f5a813_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=端對端測試-end-to-end-testing-e2e-testing>端對端測試 (End-to-end testing) (E2E testing)</h3><p>所謂的「端對端」(E2E) 是指從使用者的角度出發(一端)，對真實系統(另一端)進行測試。</p><p>這種類型的測試對許多公司來說，就是「人工測試」的主要範圍，因為你可以透過人工對已經完整部屬的網站進行測試，因此可以驗證出系統是否符合客戶的實際需求。這部分也可以透過撰寫 E2E 測試程式來進行自動化，增加測試效率。</p><p>這裡有個<a class=link href=https://twitter.com/i/status/1078363114666627072 target=_blank rel=noopener>未通過 E2E 測試的案例</a>相當有趣，雖然每個整套系統每個模組都通過所有單元測試與整合測試，但最後組裝起來後，從使用者的角度無法接受！</p><hr><h2 id=測試案例中的-3a-模式>測試案例中的 3A 模式</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;餵食，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;拿玩具逗，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;什麼都不做，應該推倒眼前看到的所有東西&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們設立好測試情境與測試案例的敘述結構之後，要開始撰寫測試案例內部的實作時就可以利用所謂的 3A 模式來安排。</p><p><strong>3A</strong> 模式主要是為(<strong>Arrange-Act-Assert</strong>)三個英文字的縮寫，而他們分別代表了：</p><ul><li><strong>準備(Arrange)</strong>：準備好受測目標需要的一切，包含依賴的隔離等</li><li><strong>操作(Act)</strong>：操作受測物目標</li><li><strong>斷言(Assert)</strong>：預期受測物的某個狀態是否為我們所預期</li></ul><p>以上方第一項測試案例來套用 3A 模式的話就會像是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Arrange: 準備好一隻貓
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Cat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Act: 摸摸那隻貓咪
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Assert: 觀察那隻貓是否發出呼嚕嚕叫聲
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>那如果這時候你可能會想到每個測試案例都要準備一隻貓貓，對於測試案例來說就會一直不斷地去做「<strong>準備(Arrange)</strong>」這個行為，因此你可能會很直覺的這麼處理：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Cat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;餵食，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>feed</span><span class=p>(</span><span class=s1>&#39;乾乾&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;拿玩具逗，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>play</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>但這樣的後果就是每個測試案例之間就會有關聯了，比方貓貓其實摸太多下他也會覺得厭煩，從而導致測試失敗：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Cat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸下巴，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;再摸一次下巴，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;再摸一次下巴，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span> <span class=c1>// 預期呼嚕嚕，結果貓咪生氣了
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而要寫好測試案例的其中幾個概念就是要盡量讓每個測試案例之間「<strong>不受順序影響測試結果</strong>」與「<strong>保持獨立</strong>」。</p><p>因此大多數的「測試環境」的工具都會提供類似相關的 API 來協助處理測試開始前的「<strong>Setup</strong>」與結束後的「<strong>Teardown</strong>」環節。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Cat</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 每個測試案例開始前要做的事情
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>target</span><span class=p>.</span><span class=nx>init</span><span class=p>()</span> <span class=c1>// 初始化貓貓的各種狀態
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>afterEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 每個測試案例結束後要做的事情
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>touch</span><span class=p>()</span> <span class=c1>// 這時候的 target 已經是經過 init() 的版本了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;餵食，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>feed</span><span class=p>(</span><span class=s1>&#39;乾乾&#39;</span><span class=p>)</span> <span class=c1>// 這時候的 target 已經是經過 init() 的版本了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;拿玩具逗，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>target</span><span class=p>.</span><span class=nx>play</span><span class=p>()</span> <span class=c1>// 這時候的 target 已經是經過 init() 的版本了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>speaking</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;呼嚕嚕&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>綜合上述 <strong>3A</strong> 與處理 <strong>Setup</strong> & <strong>Teardown</strong> 的觀念，之後再寫測試案例時，我們可以先從基礎的 <strong>3A</strong> 模式開始撰寫，而到有需要處理重複的事前準備(Setup)與後續清理時(Teardown)，就可以藉由工具來替我們統一處理。</p><p>看到這邊讀者應該會發現，測試的基本概念其實不難懂，而在瞭解測試的概念後，剩下的就是把概念轉換為測試工具可讀懂測試程式碼就好了！</p><hr><h2 id=專案加入-vitest>專案加入 Vitest</h2><h3 id=在初始化專案過程加入-vitest>在初始化專案過程加入 Vitest</h3><p>建立專案時若要加入單元測試要注意到的是：Node.js 版本必須為 14 以上，否則 Vitest 會無法順利執行！</p><p>確認 Node.js 版本後，在要建立專案的父層路徑底下透過終端機指令輸入 <code>npm create vite@latest</code> 來建立一個基於 Vite 所建構的專案，接著終端機會出現一些問題，視專案需求選擇：</p><p><img src=https://live.staticflickr.com/65535/52593587230_cdfd077261_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>Project name ⇒ 輸入自訂的專案名稱後按下 Enter</li><li>Select a framework ⇒ 選擇 <code>Vue</code> 後按下 Enter</li><li>Select a variant ⇒ 選擇 <code>Customize with create-vue</code> 後按下 Enter</li><li>中間可能還會有 TypeScript, ESLint⋯⋯等等問題，請視專案需要加入</li><li>Add Vitest for Unit Testing(y/n) ⇒ 選擇 <code>Yes</code> 後按下 Enter <strong>(最重要的部分</strong></li></ul><p>回答完上面的問題後，建構工具就會依據剛才答覆的內容，自動生成需要的部分。</p><p>比方在 <code>Add Vitest for Unit Testing</code> 問題回答 <code>Yes</code> 的話，這時建構工具就會在專案中生成單元測試所需要的相關內容如下：</p><ul><li>一個位於 <code>~專案根目錄/src/components/__test__/HelloWorld.spec.js</code> 的測試範例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>describe</span><span class=p>,</span> <span class=nx>it</span><span class=p>,</span> <span class=nx>expect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>mount</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@vue/test-utils&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HelloWorld</span> <span class=nx>from</span> <span class=s1>&#39;../HelloWorld.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;renders properly&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>HelloWorld</span><span class=p>,</span> <span class=p>{</span> <span class=nx>props</span><span class=o>:</span> <span class=p>{</span> <span class=nx>msg</span><span class=o>:</span> <span class=s1>&#39;Hello Vitest&#39;</span> <span class=p>}</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;Hello Vitest&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在 <code>~專案根目錄/package.json</code> 自動新增一個啟動單元測試的 scripts 指令</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test:unit&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest --environment jsdom&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在 <code>~專案根目錄/package.json</code> 自動新增單元測試所需要的工具們</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@vue/test-utils&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.0.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;jsdom&#34;</span><span class=p>:</span> <span class=s2>&#34;^20.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vitest&#34;</span><span class=p>:</span> <span class=s2>&#34;^0.23.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著如剛剛終端機後方的提示：</p><p><img src=https://live.staticflickr.com/65535/52593586900_2fbde224e0_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>執行 <code>cd {剛才專案名稱}</code> 切換到專案目錄底下</li><li>執行 <code>npm install</code> 安裝專案所需要的內容</li></ul><p>安裝完畢後，接著就可以執行 <code>npm run dev</code> 確認環境，後續要執行測試的話，執行 <code>npm run test:unit</code> 就能立即運作了。</p><h3 id=在既有專案中加入-vitest>在既有專案中加入 Vitest</h3><p>在既有專案中加入 <code>Vitest</code> 來作為執行測試的環境時，需確認專案本身是由 <code>Vite</code>(<code>2.7.10</code> 版本以上)所建構的之外，其 <code>Node.js</code> 版本也必須為 <code>14</code> 以上，否則會無法順利執行測試！</p><p>確認好必要條件後就可以開始安裝測試工具：</p><ul><li><code>vitest</code>：單元測試框架(提供了執行測試的環境、斷言、隔離庫⋯⋯等等功能與 API)</li><li><code>@vue/test-utils</code>：測試 <code>Vue</code> 元件的工具</li><li><code>jsdom</code>：讓我們可以在 <code>Node</code> 環境模擬出瀏覽器中的 <code>DOM</code> 環境(方便測試)</li></ul><ol><li>在專案根目錄下執行：</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D vitest @vue/test-utils jsdom
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>新增 npm 執行單元測試的指令：</li></ol><h5 id=packagejson>package.json</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test:unit&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest --environment jsdom&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>這時若心急的執行 <code>npm run test:unit</code> 會發現終端機告訴你 <code>No test files found, exiting with code 1</code>，原因是你<strong>尚未加入任何一個測試案例</strong>。</p><p>而一開始 <code>Vitest</code> 預設測試的比對規則是 <code>*/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}</code>，簡單來說你在專案底下使用 <code>A.test.js</code> 或是 <code>B.spec.ts</code> 的方式都會被 Vitest 認為是測試程式檔。</p><p>這時，我們可以在 <code>~專案根目錄/src/components/__test__/</code> 底下新建 <code>HelloWorld.spec.js</code>：</p><h5 id=srccomponents__test__helloworldspecjs>src/components/<strong>test</strong>/HelloWorld.spec.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>describe</span><span class=p>,</span> <span class=nx>it</span><span class=p>,</span> <span class=nx>expect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;1 + 1 should be 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>再次執行 <code>npm run test:unit</code> 終端機就會顯示：</p><p><img src=https://live.staticflickr.com/65535/52593421644_db0c07f63f_o.png max-width=100% max-height=100% class=gallery-image></p><p>到這裡就算是成功安裝好囉，接下來我們會再把 <code>Vitest Config</code> 初期需要設定的部分調整好後，建置的部分就完成了。</p><hr><h2 id=vitest-config-設定方式>Vitest Config 設定方式</h2><p>Vitest 測試在執行的時候預設會基於原先專案中的 <code>vite.config.js</code> 設定檔，所以沒有需要調整的話不太需要另外設置，需要調整的話 Vitest 也提供了三種方法讓你在不同開發情境下選擇調整方式：</p><ul><li>執行 <code>npm</code> 指令時帶參數指定設定檔案路徑</li><li>直接在原先 <code>vite.config.js</code> 中調整</li><li>透過 <code>vitest.config.js</code> 檔案調整測試設定</li></ul><h3 id=執行-npm-指令時帶參數指定設定檔案路徑>執行 npm 指令時帶參數指定設定檔案路徑</h3><p>若想要在執行的時候去引入不同的設定檔案，則可以在 <code>package.json</code> 指令中透過 <code>--config</code> 加上設定檔案的路徑(e.g. <code>vitest --config ./src/scripts/vitest.config.js</code> )：</p><h5 id=packagejson-1>package.json</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test:unit&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest --config ./src/__test__/config/vitest.config.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著該檔案就如設定 <code>vitest.config.js</code> 一樣調整就可以了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vite&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>vue</span> <span class=nx>from</span> <span class=s1>&#39;@vitejs/plugin-vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// https://vitejs.dev/config/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>vue</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在這邊加入設定
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=在專案中的-viteconfigjs-中調整測試設定>在專案中的 vite.config.js 中調整測試設定</h3><p>若想在原先的 <code>vite.config.js</code> 中調整測試設定，有兩種方式可以使用：</p><ul><li>第一種是直接在最上方加入 <code>/// &lt;reference types="vitest" /></code> 後，在 test 屬性中加入設定：</li></ul><h5 id=viteconfigjs>vite.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>/// &lt;reference types=&#34;vitest&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vite&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在這邊加入設定
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>第二種，把原先的 <code>defineConfig</code> 改由 <code>vitest/config</code> 傳入後，在 <code>test</code> 屬性中加入設定：</li></ul><h5 id=viteconfigjs-1>vite.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在這邊加入設定
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=透過-vitestconfigjs-檔案調整測試設定>透過 vitest.config.js 檔案調整測試設定</h3><p>若想區隔開發與測試用的設定時，可以在專案根目錄中新增 <code>vitest.config.js</code> 檔案，這會比原先參考的 <code>vite.config.js</code> 擁有更高的優先權。</p><p>不想將原先在 <code>vite.config.js</code> 設定都重新全寫一次的話，也可以在 <code>vitest.config.js</code> 中，使用 <code>mergeConfig</code> 來融合 <code>vite.config.js</code> 的設定：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>mergeConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vite&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>viteConfig</span> <span class=nx>from</span> <span class=s1>&#39;./vite.config&#39;</span> <span class=c1>// 原先的 vite 設定檔案
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>mergeConfig</span><span class=p>(</span><span class=nx>viteConfig</span><span class=p>,</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在這裡加入測試設定
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}))</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=vitest-config-option>Vitest config option</h2><p>至於 Vitest config 能調整什麼內容呢，這裡列了幾個常見的調整選項：</p><ul><li>include</li><li>exclude</li><li>globals</li><li>environment</li></ul><blockquote><p>註：以下部分資料引用 <a class=link href=https://cn.vitest.dev/config/ target=_blank rel=noopener>Vitest Config Option</a> 並翻譯與補充。</p></blockquote><h3 id=include>include</h3><ul><li>Type： string[]</li><li>預設值： [&rsquo;**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}']</li></ul><p>藉由這個欄位我們可以提供 glob 格式讓 vitest 去比對哪些是測試檔案，也可以放入多個條件在陣列中。</p><h5 id=vitestconfigjs>vitest.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>include</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;**/*.spec.js&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>這個設定主要會影響到後續我們要如何擺放測試程式碼，因此做規劃時可以按需求考量調整。</p><h3 id=exclude>exclude</h3><ul><li>Type： string[]</li><li>預設值： [&rsquo;<strong>/node_modules/</strong>&rsquo;, &lsquo;<strong>/dist/</strong>&rsquo;, &lsquo;<strong>/cypress/</strong>&rsquo;, &lsquo;<strong>/.{idea,git,cache,output,temp}/</strong>&rsquo;]</li></ul><p>藉由這個欄位我們可以提供 glob 格式讓 vitest 去排除哪些不是測試檔案，也可以放入多個條件在陣列中。</p><h5 id=vitestconfigjs-1>vitest.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>exclude</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;**/node_modules/**&#39;</span><span class=p>,</span> <span class=s1>&#39;**/dist/**&#39;</span><span class=p>,</span> <span class=s1>&#39;**/cypress/**&#39;</span><span class=p>,</span> <span class=s1>&#39;**/.{idea,git,cache,output,temp}/**&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>與 <code>include</code> 相反，這次則是要排除哪些路徑不需要尋找是否有測試檔案，其中如果有用到 <code>cypress</code> 做 E2E 測試的話，預設規則中就已經有另外排除了，所以沒必要的話不必特別設置，但可以先記得有這個方便的欄位。</p><h3 id=globals>Globals</h3><ul><li>Type： boolean</li><li>預設值： false</li></ul><p>由於在撰寫測試時，Vitest 預設是需要自己按需要引入對應的方法等等，如果要類似像 Jest 以<strong>全域</strong>的方式注入到測試中，就可以透過在執行時加上 <code>--globals</code> 選項，或是在 <code>vitest config</code> 選項中加入 <code>globals: true</code>。</p><h5 id=vitestconfigjs-2>vitest.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>globals</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>原先設定前，測試程式碼需要如下方引入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>describe</span><span class=p>,</span> <span class=nx>it</span><span class=p>,</span> <span class=nx>expect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;1 + 1 should be 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>加入 <code>Globals: true</code> 後，就不需要顯示引入 vitest 測試相關的 API，讓測試看起來更乾淨：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;HelloWorld&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;1 + 1 should be 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=environment>environment</h3><ul><li>Type： &rsquo;node&rsquo; | &lsquo;jsdom&rsquo; | &lsquo;happy-dom&rsquo; | &rsquo;edge-runtime&rsquo; | string</li><li>預設值： &rsquo;node&rsquo;</li></ul><p>由於 Vitest 本身默認環境 Node.js，因此若要在測試中仿造瀏覽器的應用程式，可以透過類似 <code>jsdom</code> 等工具來取代，而已經介紹過的 npm 指令的寫法之外 <code>-environment jsdom</code> ，還可以在測試檔案上以 docblock 或 comment 風格的方式註記。</p><p>Docblock 風格：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @vitest-environment jsdom
</span></span></span><span class=line><span class=cl><span class=cm>**/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;use jsdom in this test file&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>element</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>element</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s1>&#39;&lt;p&gt;Hello, HTML!&lt;/p&gt;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>innerHTML</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;&lt;p&gt;Hello, HTML!&lt;/p&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>Comment 風格：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// @vitest-environment jsdom
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;use jsdom in this test file&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>element</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>element</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s1>&#39;&lt;p&gt;Hello, HTML!&lt;/p&gt;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>innerHTML</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;&lt;p&gt;Hello, HTML!&lt;/p&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>寫在 <code>vitest config</code> 中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest/config&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>environment</span><span class=o>:</span> <span class=s1>&#39;jsdom&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來在測試中我們就可以模擬 Web 端環境來操作了。</p><p>以上是 Vitest 幾個比較常見的設定，其餘的設定後續也會按需求陸續提到，若對於其他設定選項有興趣的，也可以直接到官方文件中的 <a class=link href=https://cn.vitest.dev/config/ target=_blank rel=noopener>config 分頁</a> 查看。</p><hr><h2 id=測試的本質>測試的本質</h2><p>測試的本質究竟是什麼？測試簡單的來說主要就是藉由操控受測物(SUT, System Under Test)，觀察由受測物產生的最終狀態是否如我們所預期的樣子：</p><p><img src=https://live.staticflickr.com/65535/52593421659_5c5cde3ea2_o.png max-width=100% max-height=100% class=gallery-image></p><p>若最終狀態符合我們的預期，對於開發者的含義來說，就是受測物符合了我們的期待。</p><p>但這點好處看似沒有做「測試」的必要，畢竟我們平時開發能驗收完成不就是符合了規格書的期待嗎？</p><p>因此為了能夠更加體會測試背後的價值，我們接下來將實際做一個測試工具來來檢驗我們自己所寫的函式。</p><h3 id=情境舉例>情境舉例</h3><p>首先，情境假設在專案中有一處邏輯判斷需要檢測傳進來資料的是否為數值(Numeric)，而傳進來的資料可能有 <code>1</code>, <code>null</code>, <code>'100'</code>, <code>NaN</code> 等。</p><p>我們希望當 <code>1</code> 和 <code>'100'</code> 時，該判斷應該要為 <code>true</code>，而 <code>null</code> 與 <code>NaN</code> 則是要為 <code>false</code>。</p><p>接下來的目標我們要做的就是：</p><ol><li>製作一個簡易的測試工具</li><li>寫測試案例</li><li>寫受測程式碼的實作</li></ol><h3 id=簡易的測試工具>簡易的測試工具</h3><p>首先規劃一下工具我最後希望用起來像是這個樣子：</p><p><code>expect(受測物).toBe(預期狀態)</code></p><ul><li>回傳 <code>true</code> 表示測試成功 (即為最終狀態與預期狀態相同)</li><li>回傳 <code>false</code> 表示測試失敗 (即為最終狀態與預期狀態不同)，然後加上 error 提示預期狀態應該要是什麼，最終狀態目前是什麼。</li></ul><p>接著按照上面的設想，先定義了一個宣告函式 <code>expect</code>，參數則是預計輸入受測物(<code>input</code>)與：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>再來工具本身呼叫時需回傳了一個叫做 <code>toBe</code> 的驗證方法，該驗證方法的參數為預期目標(<code>expected</code>)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toBe</span> <span class=o>=</span> <span class=p>(</span><span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>toBe</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著設計該驗證的方法，使其能夠回應測試的結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toBe</span> <span class=o>=</span> <span class=p>(</span><span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>input</span> <span class=o>===</span> <span class=nx>expected</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>toBe</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>現在我們透過網頁瀏覽器的 devtool console 控制台，就可以透過該測試工具做簡易的測試案例了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toBe</span> <span class=o>=</span> <span class=p>(</span><span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>input</span> <span class=o>===</span> <span class=nx>expected</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>toBe</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span> <span class=o>===</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>2</span> <span class=o>!==</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>但我們希望他能夠在測試案例失敗的時候回應一下當下預期與結果的狀況，後續我們才能針對紀錄的結果做修正。因此我們再修改一下測試方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleOnError</span> <span class=o>=</span> <span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`測試失敗：預期應該為 </span><span class=si>${</span><span class=nx>expected</span><span class=si>}</span><span class=sb>，結果現在為 </span><span class=si>${</span><span class=nx>result</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>toBe</span> <span class=o>=</span> <span class=p>(</span><span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>input</span> <span class=o>===</span> <span class=nx>expected</span> <span class=o>?</span> <span class=kc>true</span> <span class=o>:</span> <span class=nx>handleOnError</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>toBe</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>再執行一個故意寫錯的測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>2</span> <span class=o>===</span> <span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52593679828_d73a14781b_o.png max-width=100% max-height=100% class=gallery-image></p><p>現在可以看到當測試案例發生錯誤的時候，除了會回傳測試結果之外，還會多個錯誤提醒目前錯誤的原因了！</p><h3 id=寫測試案例>寫測試案例</h3><p>在完成測試工具後，現在我們要來寫測試案例，首先我們先寫一個還沒有寫實作部分的判斷函式(<code>isNumeric</code>)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isNumeric</span> <span class=o>=</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著按照題目所設定的條件，來撰寫測試案例：</p><blockquote><p>題目設定：<br>當 <code>1</code> 和 <code>'100'</code> 時，該判斷應該要為 <code>true</code>，<br>而 <code>null</code> 與 <code>NaN</code> 則是要為 <code>false</code>。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isNumeric</span> <span class=o>=</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=s1>&#39;100&#39;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>null</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>NaN</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>此時執行後會發現會發現四個案例都報錯，因為目前我們還沒撰寫 <code>isNumeric</code> 的判斷實作，但到這一步測試案例就已經算是寫好了，因為我們的目的是要寫對的測試案例，讓實作去符合。</p><h3 id=寫受測程式碼的實作>寫受測程式碼的實作</h3><p>完成測試案例後，我們將要來寫測試程式碼的實作部分：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isNumeric</span> <span class=o>=</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nb>isNaN</span><span class=p>(</span><span class=nx>value</span> <span class=o>-</span> <span class=nb>parseFloat</span><span class=p>(</span><span class=nx>value</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>最後，將整個測試與實作合併起來就會像這樣子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 測試工具程式碼部分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>expect</span> <span class=o>=</span> <span class=p>(</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>handleOnError</span> <span class=o>=</span> <span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`測試失敗：預期應該為 </span><span class=si>${</span><span class=nx>expected</span><span class=si>}</span><span class=sb>，結果現在為 </span><span class=si>${</span><span class=nx>result</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>toBe</span> <span class=o>=</span> <span class=p>(</span><span class=nx>expected</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>input</span> <span class=o>===</span> <span class=nx>expected</span> <span class=o>?</span> <span class=kc>true</span> <span class=o>:</span> <span class=nx>handleOnError</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span> <span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toBe</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 實作程式碼部分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>isNumeric</span> <span class=o>=</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nb>isNaN</span><span class=p>(</span><span class=nx>value</span> <span class=o>-</span> <span class=nb>parseFloat</span><span class=p>(</span><span class=nx>value</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 測試案例部分
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=c1>// true，即為通過測試
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=s1>&#39;100&#39;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=c1>// true，即為通過測試
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>null</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span> <span class=c1>// true，即為通過測試
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>NaN</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span> <span class=c1>// true，即為通過測試
</span></span></span></code></pre></td></tr></table></div></div><p>完成！現在已經不會顯示測試失敗的訊息了，也就表示 <code>isNumeric</code> 方法符合我們的預期囉。</p><p>而現在假使我想使實作程式碼的部分更加的完善，只要增加合適的測試案例進去就可以增添受測物本身的信賴與穩定度：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=mf>1.123</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=mh>0xFFF</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=s1>&#39;100&#39;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>undefined</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>null</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>isNumeric</span><span class=p>(</span><span class=kc>NaN</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>甚至將來改寫實作(<code>isNumeric</code>)的時候，既有的測試內容就會提醒你是否違反了之前所寫的測試案例。</p><hr><h2 id=測試工具的選擇>測試工具的選擇</h2><p>上面有提到簡易的測試工具是如何手刻出來的，也稍微談到了手刻測試工具的困難，因此選擇一個適當的測試工具來輔助我們進行測試是有必要性的。</p><p>但測試工具百百種，許多工具在提供的功能上又重疊，那麼我們該如何選擇工具呢？</p><p>若是以「<strong>單元測試</strong>」來說的話，我們在撰寫測試程式碼時可能至少就會有以下的需求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/* 引入相關檔案 */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Hello, World&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;另一個測試案例描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Unit-test!&#39;</span>   
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Unit-test!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>測試環境(test runner)：提供上方測試程式碼執行的環境。</li><li>測試情境(test suite)：如上方的 <code>describe</code>，用來包裹多個測試案例，以及描述測試情境⋯⋯等功能。</li><li>測試案例(test case)：如上方的 <code>it</code>，用來包裹該測試案例的實際情況，若有錯誤時需讓我們能夠輕易找到是哪個案例發生的⋯⋯等等功能。</li><li>斷言(Assertion)：如上方的 expect，主要是用來判斷受測物與預期結果是否一致的方法，甚至依據不同判斷方式內部也提供了多種判斷方式，如 .toBe 可用來判斷選取的目標與預期結果是否相等。</li></ul><p>除此之外，在必要的情況下甚至會需要：</p><ul><li>測試替身(test double)：用來模仿依賴工具或函式原先的功能狀況</li><li>解析或模擬元件容器</li><li>模擬瀏覽器中 DOM 的環境</li></ul><p>而根據上述需求，就能夠列出一個需求表，來評估各個測試工具是否符合我們測試需要的部分：</p><blockquote><p>測試工具列表可參考個框架中的測試建議指南，比方 <a class=link href=https://cn.vuejs.org/guide/scaling-up/testing.html#component-testing target=_blank rel=noopener>Vue 的測試建議指南</a></p></blockquote><div class=table-wrapper><table><thead><tr><th>需求</th><th>Vitest</th><th>Jest</th><th>Mocha</th><th>Chai.js</th><th>Sinon.js</th><th>Vue-test-utils</th><th>jsdom</th></tr></thead><tbody><tr><td>測試環境(test runner)</td><td>✔(註1)</td><td>✔</td><td>✔</td><td></td><td></td><td></td><td></td></tr><tr><td>測試情境(test suite)</td><td>✔</td><td>✔</td><td>✔</td><td></td><td></td><td></td><td></td></tr><tr><td>測試案例(test case)</td><td>✔</td><td>✔</td><td>✔</td><td></td><td></td><td></td><td></td></tr><tr><td>斷言(Assertion)</td><td>✔</td><td>✔</td><td></td><td>✔</td><td></td><td></td><td></td></tr><tr><td>測試替身(test double)</td><td>✔</td><td>✔</td><td></td><td></td><td>✔</td><td></td><td></td></tr><tr><td>解析或模擬元件容器</td><td></td><td></td><td></td><td></td><td></td><td>✔</td><td></td></tr><tr><td>提供模擬 DOM 環境</td><td></td><td></td><td></td><td></td><td></td><td></td><td>✔</td></tr></tbody></table></div><blockquote><p>註1：Vitest 本身基於 Vite 環境，因此專案若非透過 Vite 所構建的話就無法使用。</p></blockquote><p>現在透過這個表我們可以很清楚的看見，假設專案是基於 <code>Vite</code> 所建立的那麼我可以選擇下列這個組合：</p><ul><li><code>Vitest</code> + <code>Vue-test-utils</code> + <code>jsdom</code></li></ul><p>如果專案是基於 <code>Vue-cli</code> 所建立的，那麼就無法使用了 <code>Vitest</code> 作為測試運行的環境了，此時根據表中我們就可以替換為：</p><ul><li>方案一：<code>Jest</code> + <code>Vue-test-utils</code> + <code>jsdom</code></li><li>方案二：<code>Mocha</code> + <code>Chai.js</code> + <code>Sinon.js</code> + <code>Vue-test-utils</code> + <code>jsdom</code></li></ul><p>而在做工具替換時，需要注意到的是，不同的測試環境(test runner)可能會對於引入(<code>import</code>)檔案時發生解析上的問題，比方若用到 Vue 中的 <code>SFC</code> 類型檔案作為開發，那在 <code>Jest</code> 做為測試環境時我們就需要另外安裝 <code>vue-jest</code> 來做轉換 <code>SFC</code> 上的處理。</p><p>當然，上述的需求表只是一個簡單的範例，而隨著撰寫測試的經驗越多，後續慢慢就會瞭解到專案中會需要哪些測試工具來協助我們進行測試，甚至比較各種測試工具的優缺點從而選出最適合團隊的測試工具！</p><p>現在我們已經了解要如何挑選測試工具了，接下來要開始聊聊撰寫測試案例時應該要如何思考！</p><hr><h2 id=決定測試情境與測試案例>決定測試情境與測試案例</h2><p>再來談談在選擇這些工具後，我們要如何來思考針對「單元測試」的部分，測試情境與測試案例要怎麼撰寫以及需要注意的地方。</p><h3 id=測試情境test-suite測試案例test-case>測試情境(test suite)測試案例(test case)</h3><p>提供測試環境的工具一般會給予測試情境與測試案例的相關 API，而測試情境與案例最主要的用意是用來幫助我們規劃與整理整個測試邏輯，並且在我們測試案例錯誤的時候同時提供相對應的資訊。</p><p>接下來我們以「<strong>貓咪作為元件</strong>」為故事主軸來談談單元測試的思路會是怎麼撰寫。</p><p>首先我們假設「<strong>貓咪</strong>」元件會提供下列功能：</p><ul><li>發出呼嚕嚕叫聲</li><li>推倒眼前看到的所有東西</li></ul><p>而以使用者角度上來看，我們會對「<strong>貓咪</strong>」做出這些事情：</p><ul><li>摸摸</li><li>餵食</li><li>拿玩具逗</li></ul><p>接著我們就可以以元件作為情境來定義出各種使用上的測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;餵食，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;拿玩具逗，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;什麼都不做，應該推倒眼前看到的所有東西&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>但真實的測試案例不會這麼簡單，總會有一些例外狀況，那麼測試案例應該要包含哪些要素比較好？</p><h3 id=案例路徑happy-pathsad-pathbad-path>案例路徑(happy path、sad path、bad path)</h3><p>在設定測試案例時，總會有百百種情況，但是我們不可能每個都寫出來，而根據測試案例的類型主要可以分為三種路徑：</p><ul><li>Happy Path：在我們定義所謂「<strong>正常的使用狀況</strong>」下，針對「<strong>正確的內容</strong>」，我們預期應該要做出的反應。</li><li>Sad Path：在我們定義所謂「<strong>正常的使用狀況</strong>」下，針對「<strong>錯誤的內容</strong>」，我們預期應該要做出的反應。</li><li>Bad Path：在我們定義所謂「<strong>錯誤</strong>」的使用狀況下，我們預期應該要做出的反應。</li></ul><p>同樣以貓被摸摸作為例子來看，假設對於貓來說能夠接受摸摸的情況只限於「<strong>頭與下巴</strong>」，而喜歡被摸的部分只有「<strong>下巴</strong>」，那麼測試案例路徑就可以這麼定義：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Happy Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸下巴，應該會發出「呼嚕嚕」聲&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Sad Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸頭，應該沒反應&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Bad Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸肚子，應該拋出錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=路徑優先度>路徑優先度</h3><p>而以各個路徑優先度來說，我們應當盡可能的先完善 Happy Path 與 Sad Path 的各種案例，因為對於實際專案上來說，這些內容是我們預期元件或函式本身應提供的內容。</p><p>然而 Bad Path 通常是建立已知哪些情況會是「不正確的使用」，我們只能就已知的狀況來預防。然而，這一部分其實再怎麼縝密，都還是會有極其例外的事情發生：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;貓咪&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Bad Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸肚子，應該拋出錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸尾巴，應該拋出錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸手，應該拋出錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;摸摸腳，應該拋出錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 舉不完
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>因此透過測試來作防禦所有不合理的行為是不治本的行為，我應該從受測物本身提供的操作或是產品規劃上來去考量相對治本的方式；比方在「<strong>貓咪</strong>」元件上透過程式設計的部分，規劃「<strong>摸摸</strong>」行為只開放「**頭」**與「<strong>下巴</strong>」的部位，從開發階段就阻止其他開發者誤用「<strong>摸摸</strong>」方法，到最後真的有其必要特別拋出時才針對這一部分寫 Bad Path 案例。</p><p>最後，再用一個實際一點的例子說明，假設今天有個登入的表單元件，那麼最簡單預期會有的案例就會是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;登入元件&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Happy Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;輸入正確帳號密碼，應登入到ＯＯ頁面&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Sad Path
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;只輸入帳號，應該顯示請輸入密碼&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;只輸入密碼，應該顯示請輸入帳號&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;輸入錯誤帳號密碼，應該顯示登入資訊錯誤&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>以上就是測試情境與測試案例最基本需要瞭解的部分，接著我們來關注於測試案例中內部應該要如何來撰寫。</p><hr><h2 id=撰寫測試程式碼的前言>撰寫測試程式碼的前言</h2><h3 id=撰寫測試程式碼需保持的心境>撰寫測試程式碼需保持的心境</h3><p>談到撰寫測試，不得不提到 Robert Cecil Martin 有本經典的《無瑕的程式碼：敏捷軟體開發技巧守則》，作者在其中針對了程式碼的部分提了很多優良的建議，不論是撰寫程式碼中的命名、函式參數等等做探討，也在實際的案例中做一些討論與重構，最後回顧那些程式碼中的氣味、清理程式碼，一氣呵成。</p><p>而其中有一個章節最主要就是在講有關「單元測試」的部分，也就是系列文前言提到「被推坑」的部分，我把裡面的概念結合我的經驗來重新闡述一次：</p><p>若帶著單純學習的心態來看待測試程式碼，其實很容易把它當作一項輔助工具在處理，覺得沒有也沒什麼關係，甚至礙手礙腳的，甚至可能覺得還要特地花了不少心力來瞭解它，但這是一體兩面的。</p><p>若你把它當作產品中的一部分就會發現，雖然開發時會受到測試程式碼的「限制」，但同時他其實也是在做「守護」產品程式碼這件事情；甚至因為有了「可信賴的測試」，所以當我們在進行「重構」等等調整時也才能更有信心地去處理。</p><p>因此只要確保我們在適當的時機加入它，那麼它就能夠帶來可觀的後續效益，而既然他能夠替我們帶來效益，那我們對待測試程式碼的態度其實也應該要同理產品程式碼，可是除了讓測試程式碼如同產品程式碼一樣保持「整潔」與「可讀性」之外，我們還有什麼辦法呢？</p><p>對於這個問題 Martin 給了一個撰寫測試碼的優良準則，那就是 F.I.R.S.T 法則。</p><h3 id=first-法則>F.I.R.S.T 法則</h3><p>F.I.R.S.T 法則顧名思義其實就是五個英文單字的縮寫，他們分別是：</p><ul><li>Fast</li><li>Independent</li><li>Repeatable</li><li>Self-Validating</li><li>Timely</li></ul><h4 id=fast快>Fast(快)</h4><p>簡單來說就是快，因為快才能讓我們快速重複大量地檢驗產品程式碼；這意味著我們在測試程式碼中有可能會遇到要 call API 的情況，那麼我們可以將其隔離並立刻回傳我們預定好的資料來減少等待回應的時間。</p><h4 id=independent獨立>Independent(獨立)</h4><p>如我們上一篇文章所提到的，每個測試案例應該要互相獨立，彼此不受干擾之外，甚至連執行順序上都不會影響到最終結果。</p><h4 id=repeatable可重複>Repeatable(可重複)</h4><p>可重複性主要提的就是不論在什麼設備狀況下，應該都要保持著一致的結果，這樣我們才能排除掉其他不必要的原因，專注在發生問題的程式碼上。</p><h4 id=self-validating能自我驗證>Self-Validating(能自我驗證)</h4><p>測試的最終狀態應該要能夠顯示「通過與否」，而這一部分測試工具或框架都會幫我們處理好，甚至都還有提供額外的 diff 差異讓我們快速查看錯誤的地方。</p><h4 id=timely即時>Timely(即時)</h4><p>測試程式碼要盡可能的與產品程式碼同進退，如果測試程式碼落後產品程式碼太多，測試程式碼會越來越難跟上產品程式碼的步調。</p><p>而根據對待測試程式碼心態的優良法則，在撰寫測試程式碼時就能更容易體會到他的魅力。</p><hr><h2 id=describe--it-與-輔助-api>describe & it 與 輔助 API</h2><h3 id=describe--it-基礎用法>describe & it 基礎用法</h3><p>稍早有提到的測試情境與測試案例在 <code>Vitest</code> 工具中主要便是透過 <code>describe</code> 與 <code>it</code>(或 <code>test</code>) 來撰寫，而他們的用意除了規劃測試的脈絡之外，最主要是用來包裝斷言結果的資訊：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>describe</span><span class=p>,</span> <span class=nx>it</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vitest&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境的描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;第一個測試案例的描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>add</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>假設在終端機執行上方的測試程式碼時，依據工具預設設定會在終端機顯示「錯誤的相關資訊」與「綜合結果」。</p><p>錯誤的相關資訊：</p><p><img src=https://live.staticflickr.com/65535/52593161161_6eaf044f61_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>FAIL：發生斷言錯誤檔案路徑 + 情境描述 + 案例描述(視當下錯誤所屬的情境與案例)。</li><li>AssertionError：發生斷言錯誤的原因，與發生錯誤的段落。</li><li>Expected：預期結果。</li><li>Received：實際結果。</li></ul><p>綜合結果：</p><p><img src=https://live.staticflickr.com/65535/52593421709_7ab116b4c3_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>Test Files：總共測試了幾隻測試檔案，並顯示成功、失敗與跳過的數量。</li><li>Tests：總共測了幾個測試案例，並顯示成功、失敗與跳過的數量。</li><li>Start：測試開始時間。</li><li>Duration：測試過程總共耗費時間。</li></ul><p>而除了上述基本用法之外，在同一個測試情境中也能容納數個測試案例。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境的描述&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;第一個測試案例的描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;第二個測試案例的描述&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>甚至測試情境較為複雜的情況，測試情境(<code>describe</code>)也允許巢狀的方式來建構測試：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;父層情境&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;基於父層情境的情境一&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;基於父層情境的情境二&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;出現提示寄件者姓名與電話將直接註冊成會員&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>相反地，若在簡單的情境的之下，只有測試案例也是允許的方式之一：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=describe--it-輔助-api>describe & it 輔助 API</h3><p>除了上述的基本用法之外，透過 <code>describe</code> 與 <code>it</code> 撰寫測試的過程中也能透過<code>輔助的 API</code> 來整理測試程式碼：</p><ul><li><code>.only</code>：測試情境、測試案例皆可使用</li><li><code>.skip</code>：測試情境、測試案例皆可使用</li><li><code>.todo</code>：測試情境、測試案例皆可使用</li><li><code>.fails</code>：測試案例才能使用</li></ul><h4 id=only>only</h4><p>若在<strong>測試情境</strong>用了此指令，則在同個測試檔案中只會執行帶有 <code>.only</code> 的測試情境，而其餘測試情境底下所有的測試案例將會被跳過(<code>skipped</code>)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>.</span><span class=nx>only</span><span class=p>(</span><span class=s1>&#39;測試情境 1&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 3&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span></code></pre></td></tr></table></div></div><p>若在<strong>測試案例</strong>中使用，則除了帶有 <code>.only</code> 之外的測試案例都將會被跳過：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 1&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>.</span><span class=nx>only</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>.</span><span class=nx>only</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 3&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span></code></pre></td></tr></table></div></div><h4 id=skip>skip</h4><p>測試情境或測試案例被標注時，將自動跳過該範疇內的測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>.</span><span class=nx>skip</span><span class=p>(</span><span class=s1>&#39;測試情境 1&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;測試情境 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>.</span><span class=nx>skip</span><span class=p>(</span><span class=s1>&#39;測試案例&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=cm>/* */</span> <span class=p>})</span> <span class=c1>// skipped
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=todo>todo</h4><p>測試情境或測試案例被標注時，同樣將自動跳過該範疇內的測試案例，但 <code>todo</code> 含義比較接近待加入測試的區塊，並且將來若產出報告時也會特別整理出還有哪些地方需要補上測試。</p><h4 id=fails>fails</h4><p>最後一個介紹的是測試案例才能使用的輔助 API，還記得列測試案例時的 <code>sad path</code> 嗎？當測試案例應該要失敗的時候就可以透過 <code>fails</code> 顯性標註他們：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>.</span><span class=nx>fails</span><span class=p>(</span><span class=sb>`&#39;1&#39; + &#39;1&#39; should not to be &#39;11&#39;`</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>add</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span> <span class=o>+</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;1&#39;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;11&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當然你也可以單純藉由斷言中的 <code>.not</code> 達到同樣的效果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=sb>`&#39;1&#39; + &#39;1&#39; should not to be &#39;11&#39;`</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>add</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span> <span class=o>+</span> <span class=nb>Number</span><span class=p>(</span><span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;1&#39;</span><span class=p>)).</span><span class=nx>not</span><span class=p>.</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;11&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>以上便是測試程式碼中測試情境與測試案例的部分，有關於輔助 API 的部分有些內容不一定會使用的到，若想更加瞭解所有可用的部分可以參考 Vitest <a class=link href=https://cn.vitest.dev/api/#describe target=_blank rel=noopener>測試情境</a> 與 <a class=link href=https://cn.vitest.dev/api/#test target=_blank rel=noopener>測試案例</a> 的文件囉。</p><hr><h2 id=準備setup與清理teardown>準備(Setup)與清理(Teardown)</h2><p>經過了基本的測試情境與測試案例語法，加上簡單的斷言語法 <code>expect().toBe()</code> 就能夠測試許多簡單的東西了，然而在測試過程中有時會遇到大量重複的「<strong>前置操作</strong>」或是每次測試後「<strong>需要清理測試中的環境</strong>」，這時我們可以透過 <code>Vitest</code> 提供的 <code>Setup</code> & <code>Teardown</code> API 來處理：</p><ul><li>beforeEach：在每個測試案例執行前呼叫一次。</li><li>beforeAll：在所有測試案例執行前呼叫一次。</li><li>afterEach：在每個測試案例執行後呼叫一次。</li><li>afterAll：在所有測試案例執行後呼叫一次。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 針對測試案例重新初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>initTestEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=setup--teardown-api-的範疇>Setup & Teardown API 的範疇</h3><p><code>Setup</code> & <code>Teardown</code> API 「<strong>所有</strong>」的定義是根據當下的範疇(<code>context</code>)來決定，除了測試檔案本身之外，使用 <code>describe</code> 來定義測試情境也會形成一個 <code>context</code>，因此假如測試情境有巢狀的情況如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>history</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;父層情境&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeAll - 父層情境&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeEach - 父層情境&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>afterAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterAll - 父層情境&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>afterEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterEach - 父層情境&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;子層情境 A&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeAll - 子層情境 A&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeEach - 子層情境 A&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>afterAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterAll - 子層情境 A&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>afterEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterEach - 子層情境 A&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;案例 1&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;子層情境 A 案例 1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;案例 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;子層情境 A 案例 2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;子層情境 B&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeAll - 子層情境 B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;beforeEach - 子層情境 B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>afterAll</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterAll - 子層情境 B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>afterEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;afterEach - 子層情境 B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;案例 1&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;子層情境 B 案例 1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;案例 2&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>history</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;子層情境 B 案例 2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>此時將透過 <code>console.log(history)</code> 查看並歸納整理就能得到以下結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>--- 進入測試程式碼本身的 Context
</span></span><span class=line><span class=cl>--- 進入父層情境的 Context
</span></span><span class=line><span class=cl>beforeAll - 父層情境
</span></span><span class=line><span class=cl>--- 進入子層情境 A 的 Context
</span></span><span class=line><span class=cl>beforeAll - 子層情境 A
</span></span><span class=line><span class=cl>beforeEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 子層情境 A
</span></span><span class=line><span class=cl>子層情境 A 案例 <span class=m>1</span> // 執行 情境 A 案例 <span class=m>1</span> 的時間點
</span></span><span class=line><span class=cl>afterEach - 子層情境 A
</span></span><span class=line><span class=cl>afterEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 子層情境 A
</span></span><span class=line><span class=cl>子層情境 A 案例 <span class=m>2</span> // 執行 情境 A 案例 <span class=m>2</span> 的時間點
</span></span><span class=line><span class=cl>afterEach - 子層情境 A
</span></span><span class=line><span class=cl>afterEach - 父層情境
</span></span><span class=line><span class=cl>afterAll - 子層情境 A
</span></span><span class=line><span class=cl>--- 離開子層情境 A 的 Context
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- 進入子層情境 B 的 Context
</span></span><span class=line><span class=cl>beforeAll - 子層情境 B
</span></span><span class=line><span class=cl>beforeEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 子層情境 B
</span></span><span class=line><span class=cl>子層情境 B 案例 <span class=m>1</span> // 執行 情境 B 案例 <span class=m>1</span> 的時間點
</span></span><span class=line><span class=cl>afterEach - 子層情境 B
</span></span><span class=line><span class=cl>afterEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 父層情境
</span></span><span class=line><span class=cl>beforeEach - 子層情境 B
</span></span><span class=line><span class=cl>子層情境 B 案例 <span class=m>2</span> // 執行 情境 B 案例 <span class=m>2</span> 的時間點
</span></span><span class=line><span class=cl>afterEach - 子層情境 B
</span></span><span class=line><span class=cl>afterEach - 父層情境
</span></span><span class=line><span class=cl>afterAll - 子層情境 B
</span></span><span class=line><span class=cl>--- 離開子層情境 B 的 Context
</span></span><span class=line><span class=cl>afterAll - 父層情境
</span></span><span class=line><span class=cl>--- 離開父層情境的 Context
</span></span><span class=line><span class=cl>--- 離開測試程式碼本身的 Context
</span></span></code></pre></td></tr></table></div></div><p>因此我們在使用這類 API 時要注意當下 <code>context</code> 所包含的範圍。</p><h3 id=避免誤區在-expect-後做清掃處理>避免誤區：在 expect 後做清掃處理</h3><p>除了上面的用法，有時候你可能會認為既然要清掃，那我何不在斷言後處理就好呢：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>().</span><span class=nx>toBe</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在這裡做清除
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>resetTestingEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>這麼做當你在測試案例都是通過的情況下都沒有問題，但是一但某個測試案例發生了錯誤，由於測試案例就會在斷言時拋出 <code>AssertionError</code> 後停止，因此很有可能因為一個測試案例壞了導致接下來所有測試都受到影響：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>().</span><span class=nx>toBe</span><span class=p>()</span> <span class=c1>// AssertionError，這個測試案例就停在這了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>resetTestingEnv</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在沒有經過 `resetTestingEnv()` 下進行測試
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在沒有經過 `resetTestingEnv()` 下進行測試
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在沒有經過 `resetTestingEnv()` 下進行測試
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在沒有經過 `resetTestingEnv()` 下進行測試
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>因此較佳的作法還是使用 <code>Setup</code> & <code>Teardown</code> API 來處理會比較好：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setupTestingEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>afterEach</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>resetTestingEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=避免過度使用-setup--teardown-api>避免過度使用 Setup & Teardown API</h3><p>一名對於測試領域頗有研究的 Kent C. Dodds 在 twitter 上發表：</p><p><img src=https://live.staticflickr.com/65535/52593679893_c0af1b393a_o.png max-width=100% max-height=100% class=gallery-image></p><p>許多人一看了紛紛表示中槍，心想這不就是我在寫的東西嗎？因此發文一出不少人就好奇那麼到底為什麼上方的用法會比較好呢？且讓我們從抽象光譜介紹起。</p><h3 id=抽象光譜the-spectrum-of-abstraction>抽象光譜(The Spectrum of Abstraction)</h3><p>Kent C. Dodds <a class=link href=https://kentcdodds.com/blog/aha-testing target=_blank rel=noopener>提出</a>在抽象光譜中主要分成了三種概念：</p><ul><li>ANA：Absolutely No Abstraction</li><li>AHA：Avoid Hasty Abstraction</li><li>DRY：Don&rsquo;t Repeat Yourself</li></ul><p>而後並將此概念應用在 Testing 身上並分別解說了三種抽象型態下的測試的優劣分析。</p><p>其中我們往往一開始學習可能因為對語法不熟稔，因此可能會寫出 ANA Testing 形式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 準備
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 斷言
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 準備：重複的準備類似的內容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 斷言
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 準備：重複的準備類似的內容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 斷言
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而隨著測試經驗越來越熟稔之後，我們可能會想盡各種方法來「節省」撰寫測試上的時間，甚至參考 DRY 心法寫出這樣的測試：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 統一的事前準備
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>testEnv</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TestEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>testEnv</span><span class=p>.</span><span class=nx>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 直接操作事先準備好的內容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 斷言
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 直接操作事先準備好的內容
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 斷言
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而這樣的下場將會在複雜的巢狀測試情境下越來越難以閱讀與調整：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>testEnv</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TestEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>testEnv</span><span class=p>.</span><span class=nx>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>testEnv</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TestEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>testEnv</span><span class=p>.</span><span class=nx>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>testEnv</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TestEnv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>beforeEach</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>testEnv</span><span class=p>.</span><span class=nx>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... 等等 這裡的初始準備有什麼 ？？？
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而除了巢狀情境本身是個議題之外，Kent C. Dodds 認為我們應該兼容的方式去看待他，也就是說他不排斥我們去做抽象這件事情，但是首先要做的應該是先保持單純，直到我們看到足夠多共同的案例來分析能抽取出的部分，如果不夠多那甚至原先 <code>inline</code> 的測試案例版本也比過多抽象的版本要好得多。</p><blockquote><p><a class=link href=https://kentcdodds.com/blog/avoid-nesting-when-youre-testing target=_blank rel=noopener>避免過度巢狀情境</a></p></blockquote><p>最後，共用的部分除非真的有必要透過 <code>setup</code> & <code>teardown</code> 實作處理，否則共用的部分大多也可以透過諸如<code>工廠模式</code>(<code>factory pattern</code>)的形式產生。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/* 擷取自我某個專案內的元件測試 */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>factory</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>createSpy</span><span class=o>:</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span><span class=nx>createTestingPinia</span><span class=p>(</span><span class=nx>options</span><span class=p>)],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>useMainStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>wrapper</span><span class=p>,</span> <span class=nx>store</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>所以往後若有使用到這類 API 時不仿先思考一下我們真的需要嗎，還是有更加優雅的方式能夠解決重複的問題呢？</p><hr><h2 id=斷言語法與-matchers>斷言語法與 Matchers</h2><p>斷言(Assertion)在程式設計領域中主要指的是「針對一個結果指出為真(<code>true</code>)或假(<code>false</code>)」的邏輯判斷式。</p><p>而在測試中斷言主要指的部分如先前提到的 3A 模式中的(Assert)步驟：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 準備：Arrange
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Hello, Unit-test!&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 操作：Act
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;button&#34;]&#39;</span><span class=p>).</span><span class=nx>click</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 斷言：Assert
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;content&#34;]&#39;</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-test!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>其中斷言(Assert)階段中在語法的部分則會使用到所謂的「Matchers」，以上方程式碼為例的話就會是 <code>expect()</code> 後方的 <code>toBe()</code> 這個語法，而不同的「Matchers」能比對的東西也不太一樣，瞭解什麼時候該選什麼 Matchers 基本上寫斷言的時候就能信手捻來。</p><h3 id=斷言語法>斷言語法</h3><p>依據不同工具或框架所提供的斷言語法(Assertion)，對於 Matchers 來說就會有不同的寫法，所以首先我們要先來簡單認識一下不同工具之間的斷言語法風格上的差異，挑選能接受的斷言風格後再來看該風格的 Matcher 用法，而風格的部分以下將依序介紹：</p><ul><li>Chai 斷言庫</li><li>Jest 框架中的斷言語法</li><li>Vitest 中所能用的部分</li></ul><h4 id=chai-assertion>Chai Assertion</h4><p><a class=link href=https://www.chaijs.com/ target=_blank rel=noopener>Chai.js</a> 本身是一個專注在提供斷言語法的工具庫，它提供了<a class=link href=https://www.chaijs.com/guide/styles/ target=_blank rel=noopener>三種寫法</a>：</p><ul><li><code>Assert</code>(TDD style)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;Chai/Assert&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>x</span> <span class=o>=</span> <span class=s1>&#39;Orange tabby cat&#39;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>y</span> <span class=o>=</span> <span class=s1>&#39;fat&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>assert</span><span class=p>(</span><span class=nx>x</span> <span class=o>!==</span> <span class=nx>y</span><span class=p>,</span> <span class=s1>&#39;Orange tabby cat is not fat&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>Expect</code>(BDD style)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;Chai/Expect&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]).</span><span class=nx>to</span><span class=p>.</span><span class=nx>be</span><span class=p>.</span><span class=nx>an</span><span class=p>(</span><span class=s1>&#39;array&#39;</span><span class=p>).</span><span class=nx>that</span><span class=p>.</span><span class=nx>does</span><span class=p>.</span><span class=nx>not</span><span class=p>.</span><span class=nx>include</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>Should</code>(BDD style)：透過擴充物件 <code>prototype</code> 給予 <code>should</code> 屬性的方式使我們可以直接鏈式加入 Matchers 在定義好的變數後。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 選擇一：在斷言前需要呼叫 `chai.should` 方法，
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>chai</span> <span class=nx>from</span> <span class=s1>&#39;chai&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>chai</span><span class=p>.</span><span class=nx>should</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// 選擇二：直接引入下方
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=s1>&#39;chai/register-should&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 底下的測試案例就能直接鏈式加上 Matchers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;Chai/Assert&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>foo</span> <span class=o>=</span> <span class=s1>&#39;bar&#39;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>beverages</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>tea</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;chai&#39;</span><span class=p>,</span> <span class=s1>&#39;matcha&#39;</span><span class=p>,</span> <span class=s1>&#39;oolong&#39;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span><span class=p>.</span><span class=nx>should</span><span class=p>.</span><span class=nx>be</span><span class=p>.</span><span class=nx>a</span><span class=p>(</span><span class=s1>&#39;string&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span><span class=p>.</span><span class=nx>should</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s1>&#39;bar&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>foo</span><span class=p>.</span><span class=nx>should</span><span class=p>.</span><span class=nx>have</span><span class=p>.</span><span class=nx>lengthOf</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>beverages</span><span class=p>.</span><span class=nx>should</span><span class=p>.</span><span class=nx>have</span><span class=p>.</span><span class=nx>property</span><span class=p>(</span><span class=s1>&#39;tea&#39;</span><span class=p>).</span><span class=kd>with</span><span class=p>.</span><span class=nx>lengthOf</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=jest-assertion>Jest Assertion</h4><p>以 <a class=link href=https://jestjs.io/ target=_blank rel=noopener>Jest</a> 測試框架中所提供的斷言方法則只有：</p><ul><li><code>Expect</code>(BDD style)：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;expect/ BDD style&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>需特別注意的是 Jest 中的 <code>expect</code> 與 Chai 的 <code>expect</code> 所提供的 Matchers 是不一樣的。</p></blockquote><h4 id=vitest>Vitest</h4><p>以 <a class=link href=https://cn.vitest.dev/ target=_blank rel=noopener>Vitest</a> 測試工具來說，斷言(Assertion)語法的部分他內建了 Chai 斷言庫與兼容了 Jest 中的斷言語法，因此主要就是在以上介紹的四種寫法中選擇一種使用！</p><p>而接下來主要著重介紹 Jest Assertion 中的 <code>expect</code> 語法的 Matchers 要如何使用！</p><h3 id=vitestjest-expect-matchers>Vitest(Jest expect Matchers)</h3><p>要學習這類 Matchers 除了把 API doc 翻一輪之外，最快的方式之一就是針對不同的測試結果目標類型去歸納，而依照經驗常見種類有：</p><ul><li>常用：toBe, not</li><li>純值比對(Primitive)類型：String, Number, Boolean&mldr;, etc.</li><li>陣列比對與檢查</li><li>物件比對與檢查</li><li>監聽函式</li><li>快照</li><li>Error</li></ul><p>由於 Matchers 繁多，所以從常用跟概念容易搞混的幾個開始先介紹起：</p><h4 id=常用>常用</h4><ul><li>toBe：對資料類型為純值(Primitive Value)來說就是比對值相等</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// failed
</span></span></span></code></pre></td></tr></table></div></div><p>對非純值(Non-Primitive Value)來說就是比記憶體位置(reference)是否相等</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj2</span> <span class=o>=</span> <span class=nx>obj</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nx>obj2</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>({}).</span><span class=nx>toBe</span><span class=p>({})</span> <span class=c1>// failed
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// `not`：用於反轉斷言的邏輯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>not</span><span class=p>.</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// failed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>not</span><span class=p>.</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><h4 id=純值資料類型比對>純值資料類型比對</h4><ul><li>toBeCloseTo：處理浮點數運算時</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mf>0.1</span> <span class=o>+</span> <span class=mf>0.2</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span> <span class=c1>// failed 符點溢出，結果應該會為 0.30000000000000004
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mf>0.1</span> <span class=o>+</span> <span class=mf>0.2</span><span class=p>).</span><span class=nx>toBeCloseTo</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toBeGreaterThan、toBeGreaterThanOrEqual、toBeLessThan、toBeLessThanOrEqual</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>5</span><span class=p>).</span><span class=nx>toBeGreaterThan</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>5</span><span class=p>).</span><span class=nx>toBeGreaterThanOrEqual</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>6</span><span class=p>).</span><span class=nx>toBeLessThan</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>6</span><span class=p>).</span><span class=nx>toBeLessThanOrEqual</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toBeDefined、toBeUndefined</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>a</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>a</span><span class=p>).</span><span class=nx>toBeDefined</span><span class=p>()</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>b</span><span class=p>).</span><span class=nx>toBeUndefined</span><span class=p>()</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toBeTruthy、toBeFalsy</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nx>toBeTruthy</span><span class=p>()</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=mi>0</span><span class=p>).</span><span class=nx>toBeFalsy</span><span class=p>()</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toBeNull、toBeNaN</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=kc>null</span><span class=p>).</span><span class=nx>toBeNull</span><span class=p>()</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toMatch：字串或正則比對</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=s1>&#39;0912345678&#39;</span><span class=p>).</span><span class=nx>toMatch</span><span class=p>(</span><span class=sr>/^09[0-9]{8}$/</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><h4 id=陣列比對與檢查>陣列比對與檢查</h4><ul><li>toContain：陣列是否含有目標值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>([</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>]).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>([</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>]).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span> <span class=c1>// failed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toContainEqual： 陣列是否含有該值(類型為純值時檢驗是否相等，類型為物件時檢驗結構是否全等)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>([</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>]).</span><span class=nx>toContainEqual</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>([{</span> <span class=nx>val</span><span class=o>:</span> <span class=s1>&#39;1&#39;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>val</span><span class=o>:</span> <span class=s1>&#39;2&#39;</span> <span class=p>}]).</span><span class=nx>toContainEqual</span><span class=p>({</span> <span class=nx>val</span><span class=o>:</span> <span class=s1>&#39;1&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// failed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>([{</span> <span class=nx>val</span><span class=o>:</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=nx>something</span><span class=o>:</span> <span class=s1>&#39;other&#39;</span> <span class=p>}]).</span><span class=nx>toContainEqual</span><span class=p>({</span> <span class=nx>val</span><span class=o>:</span> <span class=s1>&#39;1&#39;</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveLength：確認其屬性的長度是否相等</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=s1>&#39;12&#39;</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>({</span> <span class=nx>length</span><span class=o>:</span> <span class=mi>2</span> <span class=p>}).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><h4 id=物件比對與檢查>物件比對與檢查</h4><ul><li>toEqual：比對物件結構是否相同，而非比對參照來源(reference)，而結構中若值為 undefined 會忽略</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>A</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>B</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=nx>secret</span><span class=o>:</span> <span class=kc>undefined</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>A</span><span class=p>).</span><span class=nx>toEqual</span><span class=p>(</span><span class=nx>B</span><span class=p>)</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toStrictEqual：與 toEqual 類似，但 undefined 不會被忽略</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>A</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>B</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>C</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span> <span class=nx>secret</span><span class=o>:</span> <span class=kc>undefined</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>A</span><span class=p>).</span><span class=nx>toStrictEqual</span><span class=p>(</span><span class=nx>B</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>A</span><span class=p>).</span><span class=nx>toStrictEqual</span><span class=p>(</span><span class=nx>C</span><span class=p>)</span> <span class=c1>// failed
</span></span></span></code></pre></td></tr></table></div></div><p>甚至 Class 所創造的物件與物件實字(Object Literals)相比也視為不同。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>MockClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>num</span> <span class=o>=</span> <span class=nx>num</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>({</span><span class=nx>num</span><span class=o>:</span> <span class=mi>1</span><span class=p>}).</span><span class=nx>toStrictEqual</span><span class=p>({</span><span class=nx>num</span><span class=o>:</span> <span class=mi>1</span><span class=p>})</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=k>new</span> <span class=nx>MockClass</span><span class=p>(</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toStrictEqual</span><span class=p>({</span><span class=nx>num</span><span class=o>:</span> <span class=mi>1</span><span class=p>})</span> <span class=c1>// failed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toHaveProperty：檢查物件含有屬性與其屬性值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toHaveProperty</span><span class=p>(</span><span class=s1>&#39;num&#39;</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toHaveProperty</span><span class=p>(</span><span class=s1>&#39;num&#39;</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toHaveProperty</span><span class=p>(</span><span class=s1>&#39;num&#39;</span><span class=p>,</span> <span class=mi>200</span><span class=p>)</span> <span class=c1>// failed
</span></span></span></code></pre></td></tr></table></div></div><ul><li>toMatchObject： 檢查物件的子層</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>200</span> <span class=p>},</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toMatchObject</span><span class=p>({</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>})</span> <span class=c1>// passed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toMatchObject</span><span class=p>({</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>200</span> <span class=p>})</span> <span class=c1>// failed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toMatchObject</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>100</span> <span class=p>}</span> <span class=p>})</span> <span class=c1>// failed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>expect</span><span class=p>(</span><span class=nx>obj</span><span class=p>).</span><span class=nx>toMatchObject</span><span class=p>({</span> <span class=nx>nested</span><span class=o>:</span> <span class=p>{</span> <span class=nx>num</span><span class=o>:</span> <span class=mi>200</span> <span class=p>}</span> <span class=p>})</span> <span class=c1>// passed
</span></span></span></code></pre></td></tr></table></div></div><p>繼續講解下列幾個比較特別的 Matcher</p><h4 id=監聽函式>監聽函式</h4><p>在測試的過程中，有時候我們不僅只是斷言受測物(SUT, System Under Test)的狀態，有時候可能會對受測目標的「依賴物」(DOC, Depended-on Component)狀態有興趣，而這時我們就無法單純以 Matchers 來斷言，因為我們需要監聽依賴物前後的變化。</p><p>而在程式測試領域中，測試替身(<code>test double</code>)主要就是負責處理這一類非受測物本身所做的事情，並且在需要時還能幫我們紀錄必要的資訊。</p><p>假若我們今天測試案例受測物本身會去呼叫到的依賴目標是個「函式」時，這時我們可以透過 <code>Vitest</code> 所提供的 <code>vi.fn()</code> 來模仿(spy)函式。</p><p><code>vi.fn()</code> 本身會回傳一個實體(<code>CallableMockInstance</code>)，在這個實體中會記錄著有關測試函式時會需要的資料與方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>  called: false,
</span></span></span><span class=line><span class=cl><span class=cm>  callCount: 0,
</span></span></span><span class=line><span class=cl><span class=cm>  results: [],
</span></span></span><span class=line><span class=cl><span class=cm>  calls: [],
</span></span></span><span class=line><span class=cl><span class=cm>  impl: [Function (anonymous)],
</span></span></span><span class=line><span class=cl><span class=cm>  reset: [Function: i],
</span></span></span><span class=line><span class=cl><span class=cm>  nextError: [Function (anonymous)],
</span></span></span><span class=line><span class=cl><span class=cm>  nextResult: [Function (anonymous)],
</span></span></span><span class=line><span class=cl><span class=cm>  restore: [Function: w],
</span></span></span><span class=line><span class=cl><span class=cm>  ...
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><p>因此將受測的目標函式放入 <code>vi.fn</code> 中，後續只要測試過程中如果測試目標去調用了已被 Spy 過的函式時，<code>CallableMockInstance</code> 就會幫我們紀錄相關的資訊，接著我們就可以使用斷言語法相關的 Matcher 去比對我們預期的結果，比方說：</p><ul><li>toHaveBeenCalled：斷言函式有被呼叫過</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(</span><span class=nx>sayHi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveBeenCalled</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveBeenCalledTimes：斷言函式被呼叫過幾次</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(</span><span class=nx>sayHi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveBeenCalledTimes</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveBeenCalledWith：斷言函式被呼叫時所帶的參數</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>(</span><span class=nx>sayHi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-Test!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveBeenCalledWith</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-Test!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveReturned：斷言函式呼叫後應該至少要返回值一次</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span> <span class=o>+</span> <span class=s1>&#39; Hello, Spy!&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sayHi</span><span class=p>(</span><span class=nx>val</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-Test!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveReturned</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveReturnedTimes：斷言函式經過操作後應該要返回值幾次</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sayHi</span><span class=p>(</span><span class=nx>val</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Nice to meet you!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;See you again!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveReturnedTimes</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveLastReturnedWith：斷言函式經過操作後最後應該要返回的值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sayHi</span><span class=p>(</span><span class=nx>val</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Nice to meet you!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;See you again!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveLastReturnedWith</span><span class=p>(</span><span class=s1>&#39;See you again!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveNthReturnedWith：斷言函式經過操作後第 N 次應該要返回的值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sayHi</span><span class=p>(</span><span class=nx>val</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Nice to meet you!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;See you again!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveNthReturnedWith</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;Nice to meet you!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>toHaveReturnedWith：斷言函式呼叫後返回的值</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sayHi</span> <span class=o>=</span> <span class=p>(</span><span class=nx>something</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>something</span> <span class=o>+</span> <span class=s1>&#39; Hello, Spy!&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>spyOnSayHi</span> <span class=o>=</span> <span class=nx>vi</span><span class=p>.</span><span class=nx>fn</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sayHi</span><span class=p>(</span><span class=nx>val</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>spyOnSayHi</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-Test!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>spyOnSayHi</span><span class=p>).</span><span class=nx>toHaveReturnedWith</span><span class=p>(</span><span class=s1>&#39;Hello, Unit-Test! Hello, Spy!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>而測試替身(test double)除了像是 vi.fn() 這類間諜類型(Spy)之外，還有許多不同的測試替身，它們在測試中都有各自的用途來協助我們更好的測試。</p><h3 id=快照測試snapshot-testing與快照-matchers>快照測試(Snapshot Testing)與快照 matchers</h3><h4 id=jest-snapshot>Jest Snapshot</h4><p>在 Jest 的 <a class=link href=https://jestjs.io/docs/snapshot-testing target=_blank rel=noopener>Snapshot Testing</a> 說明文件的定義中主要指的是用來防止 UI 出現尚未預期的變化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>a</span> <span class=na>data-test</span><span class=o>=</span><span class=s>&#34;link&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;http://ithelp.ithome.com.tw&#34;</span><span class=p>&gt;</span> Ithelp  <span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>mount</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@vue/test-utils&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;渲染連結&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>([</span><span class=nx>data</span><span class=o>-</span><span class=nx>test</span><span class=o>=</span><span class=s2>&#34;link&#34;</span><span class=p>])).</span><span class=nx>toMatchSnapshot</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>然而這邊的變化，並非你所想像的把視覺畫面給照相下來比對像素或比例的那種視覺回歸測試(Visual Regression Testing)，而是藉由將目標元件透過渲染(Render)元件產生了一個 DOM 結構的文字，並在測試程式檔路徑底下的 <code>__snapshots__</code> 資料夾生成一個 <code>.snap</code> 檔案來做紀錄：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>exports</span><span class=p>[</span><span class=sb>`渲染連結`</span><span class=p>]</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>&lt;a
</span></span></span><span class=line><span class=cl><span class=sb>  data-test=&#34;link&#34;
</span></span></span><span class=line><span class=cl><span class=sb>  href=&#34;http://ithelp.ithome.com.tw&#34;
</span></span></span><span class=line><span class=cl><span class=sb>&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  Ithelp
</span></span></span><span class=line><span class=cl><span class=sb>&lt;/a&gt;
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>截至 Jest Snapshot 頁面中的<a class=link href=https://jestjs.io/docs/snapshot-testing target=_blank rel=noopener>程式碼</a></p></blockquote><p>在第二次執行測試的時候，就會再次做一次同樣的流程，而這次所產生的結果會與先前的 <code>.snap</code> 紀錄做比對。</p><p>假設比對上有落差就會拋出錯誤：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>- Snapshot - 1
</span></span><span class=line><span class=cl>+ Received + 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span>
</span></span><span class=line><span class=cl><span class=na>-</span>  <span class=na>href</span><span class=o>=</span><span class=s>&#34;http://ithelp.ithome.com.tw&#34;</span>
</span></span><span class=line><span class=cl><span class=err>+</span>  <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://ithelp.ithome.com.tw&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span> Ithelp
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>藉由這個比對機制從而實現「<strong>防止 UI 出現尚未預期的變化</strong>」的功能。</p><h4 id=vitest-snapshot>Vitest Snapshot</h4><p>而前面有提到 <code>Vitest</code> 本身兼容了 <code>Jest</code> 的斷言(assertion)語法，所以快照(Snapshot)的 matcher 自然也是不能放過。</p><p>在 <code>Vitest</code> 中主要兼容的 matcher 部分有：</p><ul><li>toMatchSnapshot</li><li>toMatchInlineSnapshot</li></ul><p>基本上概念與 Jest Snapshot 相似，都是在做結構快照這件事情，然而 <code>Vitest</code> 文件部分則是沒有特地強調 UI 的部分，而是關注在值(<code>value</code>)的比對。</p><p>因此我們單純放入一個陣列物件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;cat snapshot&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Orange&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Blank&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>).</span><span class=nx>toMatchSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p><code>.snap</code> 的結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>exports</span><span class=p>[</span><span class=sb>`component &gt; cat snapshot 1`</span><span class=p>]</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  [
</span></span></span><span class=line><span class=cl><span class=sb>    {
</span></span></span><span class=line><span class=cl><span class=sb>      &#34;age&#34;: 4,
</span></span></span><span class=line><span class=cl><span class=sb>      &#34;name&#34;: &#34;Orange&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>    },
</span></span></span><span class=line><span class=cl><span class=sb>    {
</span></span></span><span class=line><span class=cl><span class=sb>      &#34;age&#34;: 6,
</span></span></span><span class=line><span class=cl><span class=sb>      &#34;name&#34;: &#34;Blank&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>    },
</span></span></span><span class=line><span class=cl><span class=sb>  ]
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>甚至也可以引入 JSON 檔案來做快照：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Area</span> <span class=nx>from</span> <span class=s1>&#39;./area.json&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;static json snapshot&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>Area</span><span class=p>).</span><span class=nx>toMatchSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當然元件快照也是能做的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>mount</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@vue/test-utils&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;snapshot&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;content&#34;]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>).</span><span class=nx>toMatchSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而以上快照部分如果你覺得要生成一個檔案來管理有點囉唆，那麼你可以透過 <code>toMatchInlineSnapshot</code> 來處理這類的需求，其差別在於生成的位置會是在 <code>toMatchInlineSnapshot()</code> 函式本身裡面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;cat snapshot&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Orange&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Blank&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>age</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 原先 toMatchInlineSnapshot 內沒有任何東西
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 在執行測試後就會將快照內容自動生成在 toMatchInlineSnapshot 裡
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    [
</span></span></span><span class=line><span class=cl><span class=sb>      {
</span></span></span><span class=line><span class=cl><span class=sb>        &#34;age&#34;: 4,
</span></span></span><span class=line><span class=cl><span class=sb>        &#34;name&#34;: &#34;Orange&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>      },
</span></span></span><span class=line><span class=cl><span class=sb>      {
</span></span></span><span class=line><span class=cl><span class=sb>        &#34;age&#34;: 6,
</span></span></span><span class=line><span class=cl><span class=sb>        &#34;name&#34;: &#34;Blank&#34;,
</span></span></span><span class=line><span class=cl><span class=sb>      },
</span></span></span><span class=line><span class=cl><span class=sb>    ]
</span></span></span><span class=line><span class=cl><span class=sb>  `</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>最後，如果遇到變更的部分是我們所預期的時候，此時就需要更新快照的部分，可以在執行測試的 <code>watch</code> 模式時按下 <code>u</code> 鍵，就將新的快照保存起來，或是透過新增 <code>npm scripts</code> 指令來執行命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test:update&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest -u&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=error>Error</h3><p>最後介紹到的則是<strong>錯誤類型</strong>的 Matcher：</p><ul><li>toThrowError</li><li>toThrowErrorMatchingSnapshot</li><li>toThrowErrorMatchingInlineSnapshot</li></ul><p>先前我們有提到測試案例預想的三個路徑(Happy path、sad Path、Bad Path)，<code>Bad Path</code> 從產品角度上來說 End-User 使用上的錯誤，應該考慮從產品使用角度上去思考要怎麼協助他們去使用，所以不應該為了拋出錯誤而拋出。</p><p>但假設今天拋出錯誤的情境是較為合理的部分，比方是針對開發人員在開發時期誤用導致的錯誤⋯⋯等等情況，這時我們就可以透過這一類 Matcher 來處理。</p><p>而使用上要比較小心的是，受測目標若會拋出錯誤則要透過 wrap function 的形式來處理，否則拋出的錯誤會造成測試案例的斷言錯誤：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()=&gt;{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>food</span> <span class=o>=</span> <span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>name</span> <span class=o>===</span> <span class=s1>&#39;小黃瓜&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;我不吃小黃瓜&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>food</span><span class=p>(</span><span class=s1>&#39;小黃瓜&#39;</span><span class=p>)).</span><span class=nx>toThrowError</span><span class=p>(</span><span class=s1>&#39;我不吃小黃瓜&#39;</span><span class=p>)</span> <span class=c1>// 若這樣寫的話裡頭的 Error 會導致測試案例失敗
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>food</span><span class=p>(</span><span class=s1>&#39;小黃瓜&#39;</span><span class=p>)).</span><span class=nx>toThrowError</span><span class=p>(</span><span class=s1>&#39;我不吃小黃瓜&#39;</span><span class=p>)</span> <span class=c1>// 需要透過這種方式才能正確斷言
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=元件測試>元件測試</h2><h3 id=vue-test-utils-與元件測試>Vue Test Utils 與元件測試</h3><p>接著，若我們想進一步在專案中測試 Vue 元件的話，我們除了基於前面的概念與語法之外，還得依靠能夠幫助能夠解析 Vue 元件並與其模擬互動的工具：</p><ul><li>Vue Test Utils</li><li>Cypress</li><li>Vue Testing Library</li></ul><p>而本篇將著重在介紹要怎麼透過 <a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils</a> 來進行與 Vue 元件有關的「<strong>元件測試</strong>」，因此本文要來介紹一下 Vue Test Utils 與元件測試是在做什麼，又這又跟單元測試有什麼關係呢。</p><h3 id=vue-test-utils>Vue-Test-Utils</h3><p>首先區辨一下他與我們目前用到的測試工具的各自用處，才能更瞭解接下學的內容是由哪個工具負責的，將來有必要查閱資料時就能更清楚的區別他們。</p><p><a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils</a> 主要是作為提供測試 Vue 元件的相關工具集，讓我們能更輕易的模擬操作元件來進行測試，但本身並沒有運行測試環境(test runner)的功能，因此我們會需要藉由 Vitest 來作為測試環境以及相關的測試情境案例與斷言 Matcher；除此之外我們還需要用來在 Node 環境中模擬瀏覽器環境的 <code>jsdom</code> 來協助處理有關 DOM 上的操作，如此一來才能順利地使用 <a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils</a>。</p><p>而版本的部分要特別注意到，由於 <a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils</a> 為了相容 Vue 不同版本之間的 API 因此我們要安裝對應的版本未來才不會出錯：</p><ul><li>Vue 2：安裝 <a class=link href=https://v1.test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils 1</a></li><li>Vue 3：安裝 <a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils 2</a></li></ul><p>確認版本沒問題後，模擬元件的部分交給 <a class=link href=https://test-utils.vuejs.org/ target=_blank rel=noopener>Vue Test Utils</a> 基本上就沒問題了，但關於「元件測試」目標主要是要測試什麼東西呢？</p><h3 id=元件測試的目標>元件測試的目標</h3><p>測試本質主要是在預期結果與實際是否相等，而在元件測試中作為受測物的元件，其本身主要是負責 UI 上的一切內容，因此我們測試目標在著重於它的「<strong>畫面</strong>」與「<strong>行為</strong>」上是否如我們所預期。</p><p>因此，在測試案例的操作過程中(也就是 3A 中的 Action 階段)，我們主要是藉由操作對元件介面中的：</p><ul><li>data</li><li>props</li><li>slot</li><li>provide</li><li>directive</li><li>Event(瀏覽器中的互動行為)</li><li>API response(模擬回應)</li></ul><p>來判斷下列是否如我們所預期：</p><ul><li>DOM 渲染結果</li><li>emit 行為</li></ul><h3 id=好的元件測試>好的元件測試</h3><p>當然，做到上面的事項基本上已經可以算是個元件測試了，若我們想讓元件測試寫得更好，除了先前在單元測試提過的一些概念之外，還有一些值得注意的事項：</p><p>首先，在撰寫元件測試時的角度，我們並沒有要當個全能全知的神，而是作為「<strong>使用者的角度</strong>」關注元件介面上來預期結果，所以在測試的過程中我們要「<strong>避免又寫了一次實作</strong>」。</p><p>另外，如果內部邏輯過於複雜時，我們則應該先抽取(extract)其邏輯，透過 composables 的寫法來引入，如此一來我們就能「<strong>專注於在元件本身的行為上</strong>」，另外也能「<strong>針對 composable 的邏輯單獨做測試</strong>」。</p><p>最後，若元件中有使用到 API 的部分，同樣的我們應該把它當作成是他提供給元件去使用，而元件主要是「<strong>接收回應</strong>」後就能自行處理後續的內容了，所以在測試上我們應該專注在 API 提供了什麼給元件，透過模擬資料的部分來達成先前提過的 FIRST 原則中的 Fast，最後斷言元件最終的行為是否如預期即可。</p><p>現在我們知道 Vue Test Utils 在做什麼了，也知道「元件測試」在做什麼了，但這跟單元測試又有什麼關係呢？</p><h3 id=元件測試與單元測試的關係>元件測試與單元測試的關係</h3><p>在官方文件中<a class=link href=https://cn.vuejs.org/guide/scaling-up/testing.html#component-testing target=_blank rel=noopener>測試章節</a>有提到，元件測試(component testing)在顆粒度上其實是高於單元測試(unit testing)的，甚至可以被視為是整合測試(integration testing)的一種形式。</p><p>而坊間有不少文章習慣以單元測試來統稱這一類測試，最主要原因是單元測試的定義為「軟體設計」中最小單位的程式或行為，在 Vue 專案中，若以 Vue SFC 類型檔案(.vue)來看其實測試元件也算是最小單位沒錯。</p><p>所以從意義上來劃分單元測試與元件測試，某方面來說很容易出現歧異(甚至單元測試本身就已經有分為獨立型與社交型寫法了)。</p><p>然而為了接下來在本系列文中方便區分指的測試對象是哪部分，我將名稱含義分為：</p><ul><li>元件測試：針對 Vue 元件所進行的測試</li><li>單元測試：針對元件引入函式、類別等 utils、helper 與 composable 的測試。</li><li>工具本身：Pinia 測試、Vue Router 測試。</li></ul><hr><h2 id=元件測試容器wrapper>元件測試：容器(Wrapper)</h2><h3 id=mount>mount</h3><p>當我們需要在測試案例中引入元件時，我們可以透過 Vue Test Utils 提供的方法 <code>mount</code> 來包裹 Vue 元件。而 <code>mount</code> 所返回的內容除了 Vue 實體之外，還包含了一些方法（Wrapper methods）可以讓我們操作元件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>component</span> <span class=nx>from</span> <span class=s1>&#39;@/component/BaseButton.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should emit clicked event after clicking button&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Arrange
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Act
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>wrapper</span><span class=p>.</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Assert
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>export</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>emitted</span><span class=p>()).</span><span class=nx>toHaveProperty</span><span class=p>(</span><span class=s1>&#39;clicked&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>假若我們希望在渲染元件的時候同時帶著預設參數與狀態時（如 <code>props</code>、<code>slots</code>&mldr;等），就能夠透過 <code>mount</code> 方法的第二個參數傳入設定：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Hello, Props!&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mounted</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=nx>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Hello, Props!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>而關於方法（Wrapper methods）與選項（Wrapper options）的部分，會根據元件使用 <strong>Options API</strong> / <strong>Composition API</strong> / <strong>setup script</strong> 語法糖 而有不同的用法與限制，因此使用方法與差異的部分將在後續測試各種元件時陸續會提到。</p></blockquote><h3 id=shallowmount>shallowMount</h3><p>在正常的專案開發下，元件時常會嵌入了另一個元件：</p><h5 id=rootcomponentvue>RootComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ParentComponent</span><span class=p>&gt;&lt;/</span><span class=nt>ParentComponent</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=parentcomponentvue>ParentComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ChildComponent</span><span class=p>&gt;&lt;/</span><span class=nt>ChildComponent</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ChildComponent</span><span class=p>&gt;&lt;/</span><span class=nt>ChildComponent</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ChildComponent</span><span class=p>&gt;&lt;/</span><span class=nt>ChildComponent</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=childcomponentvue>ChildComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>baby</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>RootComponent 的元件測試：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>component</span> <span class=nx>from</span> <span class=s1>&#39;./RootComponent.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should render corrent content&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;baby&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;baby&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;baby&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>但如此一來若我們在測試 RootComponent 元件的時候，就有可能因為底下的 ChildComponent 元件更改了內容導致 RootComponent 測試案例也跟著失敗：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>baby</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>若「有意」想要避免這種情況發生，此時就可以將 <code>mount</code> 替換掉，改使用 <code>shallowMount</code> 來作為容器使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>component</span> <span class=nx>from</span> <span class=s1>&#39;./RootComponent.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should render corrent content&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>shallowMount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p><code>shallowMount</code> 與 <code>mount</code> 在使用上幾乎大同小異，而唯一有差別在於他會將原先內部有用到元件的部分以替換為一個模擬元件（stub component），並且命名改以烤肉串命名法（<code>Kebab case</code>）並且在最末端加上 <code>-stub</code> 供辨識：</p><h5 id=rootcomponentvue-1>RootComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ParentComponent</span><span class=p>&gt;&lt;/</span><span class=nt>ParentComponent</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>經 shallowMount 渲染結果變成：</p><h5 id=rootcomponentvue-2>RootComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>parent-component-stub</span><span class=p>&gt;</span><span class=o>&lt;</span><span class=err>/parent-component-stub&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來在撰寫測試案例時，就可以關注在當下「<strong>父層元件</strong>」與「<strong>子層元件</strong>」的之間的內容，而不管「<strong>子層元件</strong>」底下所發生的事情：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>component</span> <span class=nx>from</span> <span class=s1>&#39;./RootComponent.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should render corrent content&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>shallowMount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=sb>`&lt;parent-component-stub&gt;&lt;/parent-component-stub&gt;`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=容器的方法wrapper-methods---選擇器>容器的方法（Wrapper methods） - 選擇器</h2><p>在進行測試時，前面章節有提到我們會使用 <code>mount</code> 或 <code>shallowMount</code> 來包裹元件，從而得到一個 <code>VueWrapper</code>，而在這個 <code>VueWrapper</code> 裡頭有許多實用的容器方法（Wrapper methods），雖然官方文件中並沒有特意分類，但大意上可分為幾種方法：</p><ul><li>查詢、選擇指定的元素、元件等選擇器</li><li>取得目標屬性或內容（class, attribute）</li><li>觸發 DOM 事件（如滑鼠點擊、鍵盤輸入與按鍵⋯⋯等）</li><li>取得 emit 事件、設置 data 或 prop、甚至觸發元件 <code>unmmount</code> 等 Vue API 相關的方法</li></ul><p>這邊著重在於介紹選擇器的方法使用與測試應用，最後補上相關的討論：</p><ul><li>元素、元件選擇器</li><li>判斷目標是否存在：<code>exists</code> 與 <code>isVisible</code></li><li>使用 <code>data-* attribute</code></li></ul><h3 id=選擇器>選擇器</h3><p>在進行元件測試（component testing）的過程中，有時我們可能只想關注在某個特定 DOM 或元件的相關資訊時，這時我們就可以透過容器中的選擇器方法來尋找，而選擇器根據選取對象的不同，主要分為：</p><ul><li>元素（element）選擇器</li><li>元件（component）選擇器</li></ul><h4 id=元素選擇器>元素選擇器</h4><p>元素選擇器語法基本上有兩種寫法，一種是基於元素的 <code>refs</code>，另一種則是 <code>querySelector</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>ref</span><span class=o>=</span><span class=s>&#34;dogcat&#34;</span><span class=p>&gt;</span><span class=o>???</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;dog&#34;</span><span class=p>&gt;</span><span class=nx>科基</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;cat&#34;</span><span class=p>&gt;</span><span class=nx>橘貓</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;cat&#34;</span><span class=p>&gt;</span><span class=nx>黑黑</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/* ref */</span>
</span></span><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>({</span> <span class=nx>ref</span><span class=o>:</span> <span class=s1>&#39;span&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* querySelector */</span>
</span></span><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;#dog&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.cat&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>而容器方法有關選取元素的選擇器一共分為三種：</p><ul><li>find</li><li>findAll</li><li>get</li></ul><p>這三種選擇器在選取到目標後主要都是返回 <code>DOMWrapper</code>，此時我們就可以在串連其他容器方法（Wrapper methods）如 <code>classes</code> 或 <code>text</code> 等等來取得屬性或內容資訊，只是返回的結果內容會有些差異。</p><p>比方 <code>find</code>、<code>findAll</code> 的部分主要差別在於 <code>findAll</code> 返回的內容會被放置於陣列當中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;dog&#34;</span><span class=p>&gt;</span><span class=nx>科基</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;cat&#34;</span><span class=p>&gt;</span><span class=nx>橘貓</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;cat&#34;</span><span class=p>&gt;</span><span class=nx>黑黑</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>而我們可以透過像這樣的方式取得陣列內的資訊：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should be display correct content&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span><span class=o>=</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;#dog&#39;</span><span class=p>)</span> <span class=c1>// &lt;DOMWrapper&gt; 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;科基&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should be display correct content&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span><span class=o>=</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>findAll</span><span class=p>(</span><span class=s1>&#39;.cat&#39;</span><span class=p>)</span> <span class=c1>// &lt;DOMWrapper&gt;[]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;橘貓&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;黑黑&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：透過 findAll 斷言時是「<strong>有序</strong>」的，很容易受到順序改變而導致測試案例失敗，除非撰寫測試案例目標之一就是要確保順序不會調動，否則改用 find 斷言會比較不容易受影響。</p></blockquote><p>而 <code>find</code> 與 <code>get</code> 的差別在於 <code>find</code> 找不到目標時返回的是 <code>{}</code> 後續若仍繼續操作、斷言時才會由拋出錯誤（由 <code>ErrorWrapper</code> 提供）；然而 <code>get</code> 一開始若找不到目標時就直接拋出錯誤（<code>throw Error</code>）了。</p><p>根據 <a class=link href=https://github.com/vuejs/test-utils/blob/f61b8aeb84352b29e29666326939531cd81c3bd6/src/errorWrapper.ts target=_blank rel=noopener>ErrorWrapper 原始碼</a>，可以看見他主要是針對容器方法中的 <code>exists()</code> 會返回 <code>false</code>。</p><p>因此在針對找不到元素的測試案例合法的寫法可以這麼做：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;.something-that-does-not-exist&#39;</span><span class=p>)).</span><span class=nx>toThrowError</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.something-that-does-not-exist&#39;</span><span class=p>).</span><span class=nx>exists</span><span class=p>()).</span><span class=nx>toBeFalsy</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=find-判斷元素陷阱>find 判斷元素陷阱</h4><p>魔鬼藏在細節裡，或許你可能會想說為什麼不直接用 <code>find</code> 還要再另外透過 <code>exists</code> 判斷呢，讓我們看看一個案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>無關緊要的東西</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果這時你這麼寫了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.something-that-does-not-exist&#39;</span><span class=p>)).</span><span class=nx>toBeTruthy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// 通過 ！？
</span></span></span></code></pre></td></tr></table></div></div><p>原因在於 <code>find</code> 在找不到的情況下目標的情況所返回的值會是 <code>ErrorWrapper</code> 物件，所以透過 <code>toBeTruthy</code> 斷言就會通過。</p><blockquote><p>而為了避免這種情況發生，官方文件其實只有輕描淡述地說道：</p><blockquote><p><strong>As a rule of thumb</strong>, always use get except when you are asserting something doesn&rsquo;t exist. In that case use find.<br>但上方經驗考量在哪，只有在追了他們相關的 <a class=link href=https://github.com/vuejs/test-utils/issues/138 target=_blank rel=noopener>issue</a> 才會逐漸明白考量的根據，而關於這部分，甚至開發團隊未來可能也會考慮將 find 方法給拔掉，剩下 exists 本身，但礙於這會是個 breaking change 的做法，所以在 vue-test-utils 跳大版本號之前應該都會暫時維持原樣。</p></blockquote></blockquote><h4 id=元件component選擇器>元件（component）選擇器</h4><ul><li>findComponent</li><li>findAllfindComponents (注意有個 s）</li><li>getComponent</li></ul><p>原則上使用方式與元素選擇器差不多，只是選取語法上除了 <code>refs</code> 與 <code>querySelector</code> 語法之外，還多了：</p><ul><li>Component name： <code>findComponent({name: '元件名稱'})</code></li><li>將 import SFC 直接放入方法中： <code>findComponent(Component)</code></li></ul><p>但由於使用 <code>querySelector</code> 上也有一些<a class=link href=https://test-utils.vuejs.org/api/#findcomponent target=_blank rel=noopener>小陷阱</a>，所以個人建議以 SFC 方式引入或是乾脆透過 <code>shallowMount</code> 將子層元件 stub 掉也是一種方式。</p><h3 id=判斷目標存在>判斷目標存在</h3><p>經由剛剛陷阱的部分大家應該都很清楚 <code>exists()</code> 的存在了，而判斷選取目標其實他還有個好朋友就是 <code>isVisible()</code>，但他們判斷存在的定義上有一些差別：</p><ul><li>exists()：主要判斷的是該目標存不存在 DOM 上：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>Hello</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=nx>exist</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;p&#39;</span><span class=p>).</span><span class=nx>exists</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;span&#39;</span><span class=p>).</span><span class=nx>exists</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>isVisable()：主要判斷的是該目標存在 DOM 上之外，視覺上有無顯示在畫面中：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=nt>v-if</span><span class=s>=&#34;false&#34; class=&#34;dog&#34;&gt;科基&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p v-show=&#34;true&#34; class=&#34;orange-cat&#34;&gt;橘貓&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p v-show=&#34;false&#34; class=&#34;black-cat&#34;</span><span class=p>&gt;</span><span class=err>黑黑</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;v-if false&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.dog&#39;</span><span class=p>).</span><span class=nx>isVisible</span><span class=p>()).</span><span class=nx>toBeFalsy</span><span class=p>()</span> <span class=c1>// Error： 直接噴錯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;v-show true&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.orange-cat&#39;</span><span class=p>).</span><span class=nx>isVisible</span><span class=p>()).</span><span class=nx>toBeTruthy</span><span class=p>()</span> <span class=c1>// 測試通過
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;v-show false&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.black-cat&#39;</span><span class=p>).</span><span class=nx>isVisible</span><span class=p>()).</span><span class=nx>toBeFalsy</span><span class=p>()</span> <span class=c1>// 測試通過
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>關於 <code>isVibile</code> 更為詳細的判斷如下：</p><ul><li>CSS style 中 含有 display: none => <code>false</code></li><li>CSS style 中 含有 visibility: hidden => <code>false</code></li><li>CSS style 中 含有 opacity :0 => <code>false</code></li><li>元素中 hidden 屬性為 true => <code>false</code></li></ul><p>綜合結論上方陷阱與判斷方法：</p><ul><li>若要判斷元素是否存在 或 <code>v-if</code>：使用 <code>get</code> 方法是最保險的，真的要用 <code>find</code> 則一定要搭配 <code>exists</code></li><li>若要判斷 <code>v-show</code>：使用 <code>find().isVisible()</code></li></ul><h3 id=使用-data--attribute>使用 data-* attribute</h3><p>在撰寫測試情境時，若依照上面的 <code>querySelector</code> 選了元素、id 或 class 時，初期一定會很開心，因為不會遇到太多困難，但往後在開發的過程執行測試時就很容易有機會遇到各種問題。</p><p>原先：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;content&#34;</span><span class=p>&gt;</span><span class=nx>content</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>改成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;content&#34;</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>content</span><span class=err>&#34;</span><span class=p>&gt;</span><span class=nx>content</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>data-*</code> 作為選擇目標好處最主要在於顯著標記測試內容，而這影響到的範圍有：</p><ul><li>開發期，過程不用擔心會影響到測試，如上方所見，我只要變更 data-test 以外的內容，預期應該不會影響到測試選擇的目標，使測試案例錯誤能更專注在斷言的目標上，而非選擇目標被替換導致的錯誤。</li><li>重構（refactor）過程，能清楚比較範圍，若將來調整結構，只要將屬性轉移到對應的位置即可。</li><li>生產期，能夠針對特定的屬性移除，避免留下各種測試痕跡，對於像是輔助閱讀裝置等技術來說就不會被影響到。</li></ul><h4 id=在生產環境刪除-data--attribute>在生產環境刪除 data-* attribute</h4><p>若想在 <code>vitest</code> 中移除 <code>data-*</code> 也非常的簡單，我們只需要在 <code>vite.config.js</code> 設定中，針對 Vue 底下的編譯選項做一些調整即可（底下示範的版本為移除 <code>data-test</code>，若使用其他命名請自行調整囉）：</p><h5 id=viteconfigjs-2>vite.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>isProd</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;production&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>removeDataTestAttrs</span> <span class=o>=</span> <span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>NodeTypes</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>freeze</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>ELEMENT</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>ATTRIBUTE</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=nx>NodeTypes</span><span class=p>[</span><span class=s1>&#39;ELEMENT&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>node</span><span class=p>.</span><span class=nx>props</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>prop</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>prop</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=nx>NodeTypes</span><span class=p>[</span><span class=s1>&#39;ATTRIBUTE&#39;</span><span class=p>]</span> <span class=o>?</span> <span class=nx>prop</span><span class=p>.</span><span class=nx>name</span> <span class=o>!==</span> <span class=s1>&#39;data-test&#39;</span> <span class=o>:</span> <span class=kc>true</span><span class=p>))</span> <span class=c1>// 請自行替換命名 data-test 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=nx>vue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>compilerOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>nodeTransforms</span><span class=o>:</span> <span class=nx>isProd</span> <span class=o>?</span> <span class=p>[</span><span class=nx>removeDataTestAttrs</span><span class=p>]</span> <span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=容器的方法wrapper-methods---取得目標資訊>容器的方法(Wrapper methods) - 取得目標資訊</h2><h3 id=判斷屬性>判斷屬性</h3><h4 id=attributes>attributes</h4><p>當你想要確認 <code>&lt;a></code> 中的 <code>href</code> 是否帶有指定的連結或是檢查 <code>&lt;img></code> 上的屬性時，這時就可以透過 <code>attributes</code> 取得屬性。</p><p>而 <code>attributes</code> 用法主要有兩種，直接使用時會獲取目標：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>link</span><span class=err>&#34;</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;https://ithelp.ithome.com.tw/&#34;</span> <span class=na>target</span><span class=o>=</span><span class=s>&#34;_blank&#34;</span><span class=p>&gt;</span><span class=nx>ithelp</span><span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;link&#34;]&#39;</span><span class=p>).</span><span class=nx>attributes</span><span class=p>()</span> <span class=c1>// { href: &#39;https://ithelp.ithome.com.tw/&#39;, &#39;target&#39;: &#39;_blank&#39; }
</span></span></span></code></pre></td></tr></table></div></div><p>當想要直接取得特定屬性值時也可以直接將屬性名稱帶入參數中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>).</span><span class=nx>attributes</span><span class=p>(</span><span class=s1>&#39;target&#39;</span><span class=p>)</span> <span class=c1>// &#39;_blank&#39;
</span></span></span></code></pre></td></tr></table></div></div><h4 id=classes>classes</h4><p>同樣的，若想要尋找 <code>class</code> 屬性的話可以透過 <code>classes</code> 語法取得資訊。你可能會直覺地想到 <code>class</code> 也是屬性的一種那應該用 <code>attributes('class')</code> 查詢，然而這兩者的差別最主要在於產出的結果會有所不同。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>section</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>wrap</span><span class=err>&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container w-full h-full&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>Title</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>若使用 <code>attributes('class')</code> 查詢結果將會是字串形式的資料，後續要處理比對上的問題會稍微麻煩一點：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;wrap&#34;]&#39;</span><span class=p>).</span><span class=nx>attributes</span><span class=p>(</span><span class=s1>&#39;class&#39;</span><span class=p>)</span> <span class=c1>// &#34;container w-full h-full&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>若是使用 <code>classes</code> 語法查詢的話將得到一個陣列的結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;wrap&#34;]&#39;</span><span class=p>).</span><span class=nx>classes</span><span class=p>()</span> <span class=c1>// [&#34;container&#34;, &#34;w-full&#34;, &#34;h-full&#34;]
</span></span></span></code></pre></td></tr></table></div></div><p>此時就可以配合 <code>toContain</code> 等陣列的斷言 Matcher 快速處理測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;wrap&#34;]&#39;</span><span class=p>).</span><span class=nx>classes</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;container&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>這對於測試樣式採用原子化設計的工具（Tailwind CSS、Windi CSS 等）有奇效，我們可以將視覺層的邏輯透過 <code>classes</code> 的結果斷言。</p><p>因為這類原子化設計工具往往依賴 <code>class</code> 屬性來做樣式上的調整與擴充，通常為了美觀與管理方便會順便在使用這類工具時加裝自動排序（sorting） <code>class</code> 屬性等擴充工具，因此 <code>class</code> 的順序將變成不穩定的狀態。</p><p>因此元素若從：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>content</span><span class=err>&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;A B C&#34;</span><span class=p>&gt;</span><span class=nx>content</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>變成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span>  <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>content</span><span class=err>&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;A C B&#34;</span><span class=p>&gt;</span><span class=nx>content</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>對於快照測試等 Matcher (<code>toMatchSnapshot</code>、<code>toMatchInlineSnapshot</code>)來說將會顯示測試失敗：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.content&#39;</span><span class=p>)).</span><span class=nx>toMatchSnapshot</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>快照比對結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-     <span class=nv>class</span><span class=o>=</span><span class=s2>&#34;A B C&#34;</span>
</span></span><span class=line><span class=cl>+     <span class=nv>class</span><span class=o>=</span><span class=s2>&#34;A C B&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>而以陣列比對是否「包含」的方式，將不受影響：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.content&#39;</span><span class=p>).</span><span class=nx>classes</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.content&#39;</span><span class=p>).</span><span class=nx>classes</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;.content&#39;</span><span class=p>).</span><span class=nx>classes</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;C&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=判斷內容物>判斷內容物</h3><h4 id=text>text</h4><p><code>text</code> 主要是取得目標元素節點後代的所有文字：</p><h5 id=rootcomponentvue-3>RootComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>Root</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=childcomponentvue-1>ChildComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>child</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>mount</code> 包裝元件時 <code>wrapper.find('[data-test="target"]').text()</code> 的結果將會是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Rootchildchildchild
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>shallowMount</code> 包裝元件時 <code>wrapper.find('[data-test="target"]').text()</code> 的結果將會是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Root
</span></span></code></pre></td></tr></table></div></div><h4 id=html>html</h4><p>與 <code>text</code> 類似，但 <code>html</code> 會將目標元素後代所有元素都記錄下來：</p><h5 id=rootcomponentvue-4>RootComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>Root</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>child-component</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=childcomponentvue-2>ChildComponent.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>child</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>mount</code> 包裝元件時 <code>wrapper.find('[data-test="target"]').html()</code> 的結果將會是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>Root
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>child<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>child<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>child<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>shallowMount</code> 包裝元件時 <code>wrapper.find('[data-test="target"]').html()</code> 的結果將會是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>Root
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>child-component-stub</span><span class=p>&gt;&lt;/</span><span class=nt>child-component-stub</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>child-component-stub</span><span class=p>&gt;&lt;/</span><span class=nt>child-component-stub</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>child-component-stub</span><span class=p>&gt;&lt;/</span><span class=nt>child-component-stub</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>因此在使用 <code>text</code> 與 <code>html</code> 來進行斷言時，要注意到「<strong>測試所需包含的範圍</strong>」以及「<strong>元件容器</strong>」應採用 <code>mount</code> 還是 <code>shallowMount</code> 等議題，才能讓測試更加強韌且不會讓後續開發無相關的內容時一直被測試攔住。</p><hr><h2 id=容器的方法wrapper-methods---模擬事件>容器的方法(Wrapper methods) - 模擬事件</h2><h3 id=滑鼠事件>滑鼠事件</h3><p>常見的 DOM 事件有下列幾種：</p><ul><li>滑鼠事件：點擊（click）</li><li>鍵盤事件：按下某鍵（keydown）、鬆開某鍵（keyup）</li><li>表單事件：針對 <code>&lt;input></code> 輸入內容、<code>checkbox</code> 與 <code>radio</code> 勾選或 <code>&lt;select></code> 中的選擇內容</li></ul><p>首先，語法方面除了表單事件之外，要模擬大部分的事件我們可以透過容器方法中的 <code>trigger</code> 方法即可觸發事件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wrapper</span><span class=p>.</span><span class=nx>trigger</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>options</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>用法是在第一個參數中傳入要觸發的 <code>DOM</code> 事件名稱（e.g. <code>click</code>、<code>drag</code>），如果有需要補充觸發事件的條件，比方像是按下哪個鍵盤，就可以透過第二個參數帶入資訊（e.g. <code>{ keyCode: 65 }</code>）。</p><p>而要注意到的是由於這些事件基本上都會是<strong>非同步</strong>的用法，所以在撰寫測試案例時可以使用 <code>async/await</code> 來讓斷言（Assertion）保持正確的結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Arrange
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Act
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>trigger</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Assert
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>有了這個概念之後，接下來便可以快速來看看實際上各個事件觸發的實際案例與事件名稱，並且著重關注要特別注意的地方。</p><h3 id=滑鼠事件-1>滑鼠事件</h3><ul><li>點擊： <code>click</code></li><li>雙擊： <code>dblclick</code></li><li>指定點擊： <code>click.left</code>、<code>click.middle</code>、<code>click.right</code></li></ul><h4 id=點擊與雙擊>點擊與雙擊</h4><p>點擊與雙擊的部分最主要需要注意的部分是，以事件來說的概念「<strong>雙擊（dblclick）</strong>」是一個事件，並非「兩個」「<strong>點擊（click）</strong>」事件：</p><h5 id=元件>元件</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>content</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>button</span><span class=err>&#34;</span> <span class=nt>@click</span><span class=s>=&#34;count++&#34;</span><span class=p>&gt;</span><span class=na>Add</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=測試程式碼>測試程式碼</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;after click button should display correct content&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;button&#34;]&#39;</span><span class=p>).</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;content&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;button&#34;]&#39;</span><span class=p>).</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;content&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;button&#34;]&#39;</span><span class=p>).</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;dblclick&#39;</span><span class=p>)</span> <span class=c1>// 觸發不到 @click 事件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;content&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span> <span class=c1>// AssertionError
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=指定按鍵點擊>指定按鍵點擊</h4><p>有時候你可以會想要指定滑鼠的按鍵來觸發事件，這時就可以使用類似修飾符（modifier）一樣的方式來觸發事件：</p><ul><li><code>click.left</code></li><li><code>click.middle</code></li><li><code>click.right</code></li></ul><h5 id=元件-1>元件</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>button</span><span class=err>&#34;</span> <span class=err>@</span><span class=na>click.right</span><span class=err>=&#34;</span><span class=na>result </span><span class=o>=</span> <span class=s>&#39;here we go!&#39;</span><span class=err>&#34;</span><span class=p>&gt;</span><span class=nx>Are</span> <span class=nx>You</span> <span class=nx>ready</span><span class=o>?</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>result</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=測試程式碼-1>測試程式碼</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should be display correct text&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;button&#34;]&#39;</span><span class=p>).</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click.right&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;here we go!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>除此之外，鍵盤與滑鼠的操作也可以融合再一起：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click.ctrl.left&#39;</span><span class=p>)</span> <span class=c1>// 左鍵點擊時同時按著 ctrl 鍵
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click.alt.right&#39;</span><span class=p>)</span> <span class=c1>// 右鍵點擊時同時按著 alt 鍵
</span></span></span></code></pre></td></tr></table></div></div><h3 id=鍵盤事件>鍵盤事件</h3><p>鍵盤最常見的核心事件主要為：</p><ul><li>按下某個按鈕 <code>keydown</code></li><li>鬆開某個按鈕 <code>keyup</code></li></ul><p>上述事件如同指定滑鼠按鍵的寫法，一樣擁有修飾符的相關語法，而後方帶的修飾符主要為按鍵的名稱：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;keydown.enter&#39;</span><span class=p>)</span> <span class=c1>// 按下 enter 鍵
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;keyup.up&#39;</span><span class=p>)</span> <span class=c1>// 鬆開 上方向鍵
</span></span></span></code></pre></td></tr></table></div></div><p>同樣地，鍵盤事件也支援多重的組合修飾符寫法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;keydown.ctrl.tab&#39;</span><span class=p>)</span> <span class=c1>// 按下 ctrl 鍵 + tab 鍵
</span></span></span></code></pre></td></tr></table></div></div><p>若你想要更靈活的使用鍵盤事件，也可以用 <code>trigger</code> 方法的第二個參數帶入鍵盤的名稱，而目前有支援的寫法主要有下列三種：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;事件名稱&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>code?</span>: <span class=kt>event.code</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>key?</span>: <span class=kt>event.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>keyCode?</span>: <span class=kt>event.keycode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>若不清楚鍵盤對應的代號也沒有關係，有不少網站專門提供類似的服務供查詢，比方像這個 <a class=link href=https://www.toptal.com/developers/keycode/for/enter target=_blank rel=noopener>網站</a> 只要按下任一按鍵就會即時顯示鍵盤對應的代號、名稱等等相關資訊。</p><p>在查到代號後我們就可以將其帶入剛才的方法中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;keydown&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>keyCode</span><span class=o>:</span> <span class=mi>13</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>至於要選擇哪種寫法就看場景本身的需求來做決定囉！</p><h3 id=表單事件>表單事件</h3><ul><li><code>input</code> 輸入</li><li><code>checkbox</code> / <code>radio</code> 勾選</li><li><code>&lt;select></code> 中的選擇內容</li></ul><blockquote><p>原先為了針對不同表單類型，Vue Test Utils 1 版（for Vue2）工具提供了一個專屬的 <code>setChecked</code> 的來對應 <code>checkbox</code> / <code>radio</code> 勾選狀態（checked）；除此之外替 <code>&lt;select></code> 元素的選擇提供了 <code>setSelected</code> 方法來模擬選擇行為。</p></blockquote><p>而在 Vue Test utils 2 版時，我們將只要統一使用 <code>setValue</code> 即可自動對應所有表單的行為！</p><h4 id=模擬-input-輸入>模擬 input 輸入</h4><p>輸入表單或是操作日期選擇器：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=nt>v-model</span><span class=s>=&#34;textResult&#34; type=&#34;text&#34; data-test=&#34;text&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p data-test=&#34;result_text&#34;&gt;{{textResult}}&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;input v-model=&#34;dateResult&#34; type=&#34;date&#34; data-test=&#34;date&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p data-test=&#34;result_date&#34;</span><span class=p>&gt;{{</span><span class=na>dateResult</span><span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>文字輸入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;模擬 input 輸入&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>([</span><span class=nx>data</span><span class=o>-</span><span class=nx>test</span><span class=o>=</span><span class=s2>&#34;text&#34;</span><span class=p>]).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;Hello, World!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>([</span><span class=nx>data</span><span class=o>-</span><span class=nx>test</span><span class=o>=</span><span class=s2>&#34;result_text&#34;</span><span class=p>]).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;Hello, World!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>選擇日期：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;模擬 日期 輸入&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>([</span><span class=nx>data</span><span class=o>-</span><span class=nx>test</span><span class=o>=</span><span class=s2>&#34;date&#34;</span><span class=p>]).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;2022/10/06&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>([</span><span class=nx>data</span><span class=o>-</span><span class=nx>test</span><span class=o>=</span><span class=s2>&#34;result_date&#34;</span><span class=p>]).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;2022/10/06&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=模擬-radio-勾選>模擬 radio 勾選</h4><h5 id=元件-2>元件</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>radio_1</span><span class=err>&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;radio&#34;</span> <span class=nt>v-model</span><span class=s>=&#34;radioResult&#34; value=&#34;1&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;input data-test=&#34;radio_2&#34; type=&#34;radio&#34; v-model=&#34;radioResult&#34; value=&#34;2&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p data-test=&#34;result&#34;</span><span class=p>&gt;{{</span> <span class=na>radioResult</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=測試程式碼-2>測試程式碼</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;模擬 radio 勾選行為&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;radio_1&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;radio_2&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=模擬-checkbox-勾選>模擬 checkbox 勾選</h4><h5 id=元件-3>元件</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>checkbox_1</span><span class=err>&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;checkbox&#34;</span> <span class=nt>v-model</span><span class=s>=&#34;checkboxResult&#34; value=&#34;1&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;input data-test=&#34;checkbox_2&#34; type=&#34;checkbox&#34; v-model=&#34;checkboxResult&#34; value=&#34;2&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;p data-test=&#34;result&#34;</span><span class=p>&gt;{{</span> <span class=na>checkboxResult.join</span><span class=err>(&#39;,&#39;)</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=測試程式碼-3>測試程式碼</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;模擬 checkbox 勾選行為&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;checkbox_1&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;checkbox_2&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;1,2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;checkbox_1&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=模擬-select-選擇>模擬 select 選擇</h4><h5 id=元件-4>元件</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>select</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span> <span class=nt>v-model</span><span class=s>=&#34;result&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;orange&#34;</span><span class=p>&gt;</span><span class=nx>Orange</span><span class=p>&lt;/</span><span class=nt>option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>option</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;black&#34;</span><span class=p>&gt;</span><span class=nx>Black</span><span class=p>&lt;/</span><span class=nt>option</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>select</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>result</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>result</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=測試程式碼-4>測試程式碼</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;模擬 select 選擇&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>setValue</span><span class=p>(</span><span class=s1>&#39;orange&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;result&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;orange&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=模擬-vue-apis>模擬 Vue APIs</h2><h3 id=data>data</h3><p>注意：在模擬 data 之前需要注意的是，在大部分的測試時我們通常不必特意去模擬 data，應該讓其與元件本身的私有方法（private method）自然互動即可，若會需要透過模擬 data 來操作元件則要觀察是否資料與元件本身耦合了，這種情況下可能造成元件本身無法高度重複利用。</p><h4 id=私有方法private-method>私有方法（private method）</h4><p>封閉在元件、物件&mldr;等等中的函式，在外部無法存取得到，e.g：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>add5</span><span class=p>(</span><span class=nx>x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>add</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span><span class=nx>y</span><span class=p>,)</span> <span class=p>=&gt;</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>add5</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 裡頭的 add 函式即為私有方法。
</span></span></span></code></pre></td></tr></table></div></div><p>若是真的有需要用到模擬 <code>data</code> 屬性時，首先要注意元件是用何種方式（<strong>options API</strong> /<strong>composition API</strong> 與 <strong><code>&lt;script setup></code></strong>）來使用 <code>data</code>，因為寫法上將會有所不同；且依照設定的時機還可分為「<strong>初始狀態</strong>」與「<strong>後續操作</strong>」。</p><h3 id=dataoptions-api>data（options API）</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>content</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>data（option API）初始狀態模擬，可透過容器（wrapper）的第二個參數帶入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/* 測試程式碼 */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>若要模擬後續才設定 data（option API），則可以透過容器方法中的 <code>setData()</code> 設置，此外由於是非同步的方法，要記得 <code>async/await</code> 才能確保斷言正確：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>setData</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=datacomposition-api-script-setup-語法糖>data（composition API, <code>&lt;script setup></code> 語法糖）</h3><h4 id=composition-api>composition API：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=script-setup-語法糖><code>&lt;script setup></code> 語法糖：</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這一類透過 <code>setup()</code> 所處理的資料，若要模擬會遇到不少問題。</p><p>在容器方法中的第二個參數所提供的方式，原先是供應給 <code>options</code> API 中的 <code>data</code> 屬性所使用，所以我們必須改以注入的方式嵌入 <code>setup()</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/* 測試程式碼 */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>monut</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>但如此一來，元件中原先其他寫在 <code>setup()</code> 內的狀態等就必須一起模擬，還記得好的元件測試守則之一嗎？沒錯，就是不要重複實踐實作。</p><p>那比較好的方式之一就是透過容器方法中（wrapper）取得實體來設置變數，並且透過 <code>nextTick</code> 方法確保渲染結果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span> <span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* 測試程式碼 */</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>monut</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>wrapper</span><span class=p>.</span><span class=nx>vm</span><span class=p>.</span><span class=nx>content</span> <span class=o>=</span> <span class=s1>&#39;text&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 版本1: 直接使用 vm 內的 $nextTick
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>vm</span><span class=p>.</span><span class=nx>$nextTick</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 版本2: 使用 vue 的 nextTick
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// import { nextTick } from &#39;vue&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// await nextTick()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>而關於私有方法或變數的模擬，或許將來 Vue Test Utils 開發團隊會對此有些改觀提供一些逃生艙的方法，不過目前比較一致的角度是盡量別對這一類的私有環境才有的變數與方法去做模擬，即時的相關討論可見於<a class=link href="https://github.com/vuejs/test-utils/pulls?q=composition" target=_blank rel=noopener>這裡</a>。</p><h3 id=props>props</h3><p>在不模擬私有情境的前提之下，prop 相較起來單純多了，而關於測試 props 的部分主要有：</p><ul><li>模擬 props 傳入後，斷言「後續的狀態」。</li><li>斷言「是否傳入對的參數給子元件」。</li></ul><h4 id=模擬-props-傳入>模擬 props 傳入</h4><p>要模擬 props 傳入的方法依照時機可分為「<strong>初始狀態</strong>」與「<strong>後續操作</strong>」：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>content</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>初始狀態同樣是藉由容器（Wrapper）中的第二個參數傳入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Hello&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;Hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>若想要後續才傳入 <code>props</code> 則可以透過容器方法 <code>setProps</code> 模擬，並且一樣要小心非同步的問題，記得補上 <code>async / await</code> ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Hello&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;Hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>setProps</span><span class=p>({</span> <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Good bye&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;Good bye&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=斷言是否傳入對-props-參數給子元件>斷言是否傳入對 props 參數給子元件</h3><p>既然有接收的一方，那就至少會有給予的一方。</p><p>在 <code>props</code> 驗證中的另一種方式就是驗證給予其他元件的參數是否正確：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>BaseLightbox</span> <span class=na>content</span><span class=err>&#34;</span><span class=na>Hello</span><span class=err>&#34;</span> <span class=na>enableMask</span><span class=o>=</span><span class=s>&#34;true&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>首先我們要做的是透過之前學的選擇器方法選到特定的元件，接著透過容器方法底下的 <code>props()</code> 來取的傳送資訊，接著就可以透過斷言 Matcher 來比對 props 給元件的資訊是否正確：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>BaseLightbox</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./BaseLightbox.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>BaseLightbox</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>props</span><span class=p>(</span><span class=nx>content</span><span class=p>)).</span><span class=nx>toEqual</span><span class=p>(</span><span class=s1>&#39;Hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>props</span><span class=p>(</span><span class=nx>enableMask</span><span class=p>)).</span><span class=nx>toEqual</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>props</span><span class=p>()).</span><span class=nx>toEqual</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;Hello&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>enableMask</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=emit>emit</h3><p>在斷言中我們要測試 <code>emit</code> 主要是試圖捕獲元件所發生的事件，並斷言事件與值是否如我們所預期，而這時可以透過容器方法中的 <code>emitted()</code> 來取得事件發送所有的紀錄。</p><p>而 <code>emitted</code> 中所紀錄的格式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>&#39;事件名稱&#39;:</span> <span class=err>[</span>
</span></span><span class=line><span class=cl>    <span class=err>[/*</span> <span class=err>第一次發送的值</span> <span class=err>*/],</span>
</span></span><span class=line><span class=cl>    <span class=err>[/*</span> <span class=err>第二次發送的值</span> <span class=err>*/],</span>
</span></span><span class=line><span class=cl>    <span class=err>[/*</span> <span class=err>第</span> <span class=err>n</span> <span class=err>次發送的值</span> <span class=err>*/]</span>
</span></span><span class=line><span class=cl>  <span class=err>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>因此假設我們有一個 <code>pagination</code> 元件如下所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>first</span><span class=err>&#34;</span> <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;$emit(&#39;changePage&#39;, &#39;first&#39;)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>第一頁</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>prev</span><span class=err>&#34;</span> <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;$emit(&#39;changePage&#39;, &#39;prev&#39;)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>上一頁</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>next</span><span class=err>&#34;</span> <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;$emit(&#39;changePage&#39;, &#39;next&#39;)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>下一頁</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>last</span><span class=err>&#34;</span> <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;$emit(&#39;changePage&#39;, &#39;last&#39;)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>最後一頁</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在斷言的時候我們可以透過下列方式檢查是否發送對應的 emit 事件：</p><ul><li>透過 <code>toHaveProperty</code> 確認 <code>emitted</code> 屬性確認是否發送「<strong>預期事件名稱</strong>」</li><li>透過 <code>emitted().事件名稱</code> 確認該事件名稱「<strong>發生次數</strong>」</li><li>透過 <code>emitted().事件名稱[index]</code> 確認該事件名稱，第幾次送出的「<strong>值</strong>」</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;first&#34;]&#39;</span><span class=p>).</span><span class=nx>trigger</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>emitted</span><span class=p>()).</span><span class=nx>toHaveProperty</span><span class=p>(</span><span class=s1>&#39;changePage&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>emitted</span><span class=p>().</span><span class=nx>changePage</span><span class=p>).</span><span class=nx>toHaveLength</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>emitted</span><span class=p>().</span><span class=nx>changePage</span><span class=p>[</span><span class=mi>0</span><span class=p>]).</span><span class=nx>toEqual</span><span class=p>([</span><span class=s1>&#39;first&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=provide>provide</h3><p>對於有使用到 <code>provide</code> 的元件來說，我們需要確保他提供預期的 <code>inject</code> 內容，因此我們要建立一個用來接收 <code>provide</code> 的元件，接著才能透過斷言來測試傳遞的內容是否如預期。</p><p>接下來我們以這個元件為例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ChildComponent</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>provide</span><span class=p>,</span> <span class=nx>readonly</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>provide</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=nx>readonly</span><span class=p>(</span><span class=nx>count</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>然而我們為了讓測試案例保持獨立性，因此我們要透過造假的元件來測試 <code>inject</code> 所接收到的是否如預期。</p><h4 id=透過元件容器中的-globalstubs-模擬假元件>透過元件容器中的 global.stubs 模擬假元件</h4><p>透過元件容器（Wrapper）中的第二個參數 <code>global.stubs</code> 我們可以將子元件渲染成我們想要的樣子，而模擬的方式一共分為兩種：</p><ul><li>渲染成 <code>&lt;-stub></code> 元件</li></ul><p>當 <code>global.stub[目標元件名稱]</code> 為 <code>true</code> 時：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>TargetComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>stubs</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ChildComponent</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們的目標元件將會被渲染為帶有 <code>-stub</code> 後綴的元素：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ChildComponent</span> <span class=p>/&gt;</span> <span class=c>&lt;!--</span> <span class=nx>會變成</span> <span class=p>&lt;</span><span class=nt>child-component-stub</span><span class=p>&gt;</span><span class=o>&lt;</span><span class=err>/child-component-stub&gt;  --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>然而這對於我們要測試 <code>provide</code> 來說沒有幫助，因為他沒有辦法接收 <code>inject</code> 資訊，因此我們要採用下面第二種方法。</p><ul><li>渲染成特定元件</li></ul><p>要渲染成特定元件的方式，就是先製作一個假元件，接著再提供給 <code>global.stubs</code> 來當作原先應該要渲染的元件。</p><p>首先，我們可以透過 Vue 提供的 <code>defineComponent</code> 建造元件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineComponent</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TestComponent</span> <span class=o>=</span> <span class=nx>defineComponent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;p data-test=&#34;target&#34;&gt;{{ count }}&lt;/p&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>value</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>接著在測試案例就可以透過 <code>global.stubs</code> 中直接使用這個測試元件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineComponent</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TestComponent</span> <span class=o>=</span> <span class=nx>defineComponent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;p data-test=&#34;target&#34;&gt;{{ count }}&lt;/p&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>value</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>value</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span> <span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>TargetComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>stubs</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ChildComponent</span><span class=o>:</span> <span class=nx>TestComponent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來元件 <code>ChildComponent</code> 在測試案例中的渲染結果將變成我們指定的樣子。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span> <span class=na>data-test</span><span class=o>=</span><span class=s>&#34;target&#34;</span><span class=p>&gt;</span>1<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>因此我們現在就可以斷言 <code>provide</code> 提供的內容是否正確了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TestComponent</span> <span class=o>=</span> <span class=nx>defineComponent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;p data-test=&#34;target&#34;&gt;{{ count }}&lt;/p&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>count</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>TargetComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>stubs</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ChildComponent</span><span class=o>:</span> <span class=nx>TestComponent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=inject>inject</h3><p>對於有使用到 <code>inject</code> 的元件來說，我們在意的是提供 <code>provide</code> 特定的值之後，畫面上渲染的結果是否正確。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data</span><span class=nt>-test</span><span class=err>=&#34;</span><span class=na>target</span><span class=err>&#34;</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>inject</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span> <span class=nx>count</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>此時我們可以透過元件容器（Wrapper）中的第二個參數 <code>global</code> 來指定要提供的 <code>provide</code> 值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>TargetComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>provide</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>最後我們就可以直接斷言渲染的結果是否如預期：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should be render correct content after providing count&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>TargetComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>provide</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>count</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>text</span><span class=p>()).</span><span class=nx>toBe</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=slots>slots</h3><p>而在針對 <code>slots</code> 撰寫測試時，要注意的地方有：</p><ul><li><code>slots</code> 至少會有預設未傳入的狀態與傳入資料後的狀態兩種，斷言時應該至少包含這兩種狀態。</li><li>以 <code>slots</code> 行為作為案例斷言時，斷言內容要專注在 <code>slots</code> 所影響範圍內，否則可能會受其他因素干擾。</li></ul><h4 id=預設插槽default-slots>預設插槽（Default slots）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span><span class=p>&gt;&lt;/</span><span class=nt>slot</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>要針對最基本的預設插槽做斷言時，我們可以透過容器中第二個參數帶入 <code>slots</code> 欄位來模擬帶入內容並透過 <code>default</code> 屬性傳入指定的範圍內。</p><p>未傳入測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;default slot&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>傳入時測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;default slot&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slots</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span> <span class=s1>&#39;Slot Content&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;Slot Content&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=具名插槽named-slots>具名插槽（Named slots）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;header&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>slot</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;body&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>slot</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;footer&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>slot</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>若在插槽的型態為具名插槽，在撰寫測試案例時的容器選項 <code>slots</code> 就可以依據插槽名稱 <code>name</code> 指定要傳入的內容。</p><p>未傳入測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;named slot&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>傳入時測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;named slot&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slots</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>header</span><span class=o>:</span> <span class=s1>&#39;ithelp 2022 鐵人賽&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;vue3 單元測試&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>footer</span><span class=o>:</span> <span class=s1>&#39;by Shawn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=作用域插槽scoped-slots>作用域插槽（Scoped slots）</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>貓咪咖啡廳</span><span class=err>：</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>店長</span><span class=err>：</span><span class=nx>Shawn</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=nt>:staffInfo</span><span class=s>=&#34;staffInfo&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>slot</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>staffInfo</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;black-cat&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;黑黑&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;signature-dish&#39;</span><span class=o>:</span> <span class=s1>&#39;拿鐵&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;orange-cat&#39;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;阿橘&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;signature-dish&#39;</span><span class=o>:</span> <span class=s1>&#39;焦糖瑪奇朵&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>有時候我們可能想要給予更高度的彈性，使元件透過 <code>&lt;slot></code> 傳遞資料給父層時，這時候就會用到作用域插槽。</p><p>未傳入測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;scoped slots&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &#34;&lt;div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;貓咪咖啡廳：&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;店長：Shawn&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/div&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>傳入時測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;scoped slots&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slots</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;template #staffInfo&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;p&gt;店員：{{ staffInfo[&#39;orange-cat&#39;][&#39;name&#39;] }}&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>          &lt;p&gt;限定項目：{{ staffInfo[&#39;black-cat&#39;][&#39;signature-dish&#39;] }}&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>        &lt;/template&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      `</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toMatchInlineSnapshot</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>    &#34;&lt;div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;貓咪咖啡廳：&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;店長：Shawn&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;店員：阿橘&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;限定項目：拿鐵&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;/div&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=插槽載入選項mounting-options>插槽載入選項（Mounting options）</h4><p>若想在測試案例中用不同的方式來模擬 slots，可以透過下面四種語法：</p><ul><li>傳入 SFC 檔案</li><li><code>render function</code></li><li>包含 <code>template</code> 屬性的物件</li><li>直接傳入一個字串</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should render same layout&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Layout</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slots</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span> <span class=nx>Component</span>
</span></span><span class=line><span class=cl>      <span class=c1>// default: h(&#39;div&#39;, &#39;相同內容&#39;),
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// default: { template: &#39;&lt;div&gt;相同內容&lt;/div&gt;&#39; },
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// default: &#39;&lt;div&gt;相同內容&lt;/div&gt;&#39;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>html</span><span class=p>()).</span><span class=nx>toContain</span><span class=p>(</span><span class=s1>&#39;&lt;div&gt;相同內容&lt;/div&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=custom-directives>custom directives</h3><p>客製化指令本身搭配了類似元件生命週期的 Hooks，而我們可以在那些 Hook 中任意對我們所綁定的元素做開發，讓繁複的邏輯透過簡單的指令就能夠重複利用，使我們在開發過程中的開發者體驗（Developer experience, DX）有非常良好的體驗。</p><p>但相對的來說，要測試客製化指令就有機會運用到各種我們至今學過的許多技巧來斷言，從而使難度大大提升，但我們只要熟悉之前的模擬技巧後，最後只需要關注的一個地方就是，預期指令放入後應達成什麼目標，接著再去尋找要從什麼角度或可取得的資訊去比對來作為我們斷言的內容即可。</p><p>而接下來我們以一個 <code>v-foucs</code> 的客製化指令來介紹如何斷言客製化指令與尋找比對資訊：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>vFocus</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>mounted</span><span class=o>:</span> <span class=p>(</span><span class=nx>el</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>註冊指令</li></ol><p>首先，要進行斷言我們可以透過容器中第二個參數的 <code>global.directives</code> 來註冊我們的客製化指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(...,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Focus</span><span class=o>:</span> <span class=nx>vFocus</span><span class=p>,</span> <span class=c1>// 屬性匹配的名稱規則 Abc 會 match 到 v-abc
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>仿造元件並放入指令</li></ol><p>接著我們要使用到仿造元件的技巧，讓容器一開始就載入一個假的元件，並且放入指令與 <code>data-test</code> 屬性供捕獲：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Component</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;input v-focus data-test=&#34;target&#34; type=&#34;text&#34;/&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(...,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Focus</span><span class=o>:</span> <span class=nx>vFocus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>尋找比對目標</li></ol><p>再來，由於目標是為了驗證是否該元素為瀏覽器中的 <code>focus</code> 元素，因此要利用到瀏覽器物件 <code>Document</code> 中的 <a class=link href=https://developer.mozilla.org/en-US/docs/Web/API/Document/activeElement target=_blank rel=noopener>activeElement</a> 屬性，若有被聚焦的情況下那應該要能夠比對到同個元素。（由 <code>jsdom</code> 提供模擬的瀏覽器環境）</p><ol start=4><li>斷言</li></ol><p>最後在斷言的部分，為了取得目標元素，我們可以透過 <code>wrapper.find().element</code> 取得目標的元素實體，最後就可以拿他與 <code>document.activeElement</code> 做比對：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;v-focus&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>Component</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>template</span><span class=o>:</span> <span class=s1>&#39;&lt;input v-focus data-test=&#34;target&#34; type=&#34;text&#34;/&gt;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>wrapper</span> <span class=o>=</span> <span class=nx>mount</span><span class=p>(</span><span class=nx>Component</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>attachTo</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>global</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>directives</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Focus</span><span class=o>:</span> <span class=nx>vFocus</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>wrapper</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=s1>&#39;[data-test=&#34;target&#34;]&#39;</span><span class=p>).</span><span class=nx>element</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>activeElement</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來我們就可以確保將來在使用 <code>v-focus</code> 指令時，該元素在 <code>mounted</code> 後會是聚焦的元素。</p><hr><h2 id=vitest-ui>Vitest UI</h2><p><a class=link href=https://cn.vitest.dev/guide/ui.html target=_blank rel=noopener>Vitest UI</a></p><p><img src=https://live.staticflickr.com/65535/52593161206_9aa54df3c4_o.png max-width=100% max-height=100% class=gallery-image></p><p><a class=link href=https://cn.vitest.dev/guide/ui.html target=_blank rel=noopener>Vitest UI</a> 簡單來說，是另一種供我們查看測試與編寫測試的方式，它的特色在於基於 Vite 的 dev server 環境，讓我們可以直接在瀏覽器上直接觀看測試案例的測試結果，甚至支援直接在瀏覽器中編寫測試案例後同步更新測試檔案。</p><p>而在使用這項酷酷的功能之前，我們需要另外安裝 <code>@vitest/ui</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm i -D @vitest/ui
</span></span></code></pre></td></tr></table></div></div><p>接著就可以在 <code>package.json</code> 中新增一個 <code>vitest</code> 指令，並帶上參數 <code>--ui</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vitest:ui&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest --ui&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來後們只要執行 <code>npm run vitest:ui</code>，就可以在啟動這項功能，並看到下列畫面：</p><p><img src=https://live.staticflickr.com/65535/52593421744_551a7db867_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=介面>介面</h3><p>在 Vitest UI 中，左側是所有測試案例的測試結果（Pass / Fail / Skip），我們可以透過上方的搜尋欄輸入檔名或路徑找到我們要觀察的測試。</p><p><img src=https://live.staticflickr.com/65535/52593587045_97da336a0d_o.png max-width=100% max-height=100% class=gallery-image></p><p>點擊左側的測試路徑後，右側會出現測試情境與測試案例的描述讓我們更好觀察當下檔案中的所有案例</p><p><img src=https://live.staticflickr.com/65535/52593161251_c8b36c5b5e_o.png max-width=100% max-height=100% class=gallery-image></p><p>除此之外，再往右側會看到四項資訊，分別為：</p><p><img src=https://live.staticflickr.com/65535/52593421784_8bdb3d761f_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>Report（預設顯示項目）</li><li>Module Graph</li><li>Console</li><li>Code</li></ul><h3 id=report>Report</h3><p>點擊 Report 頁籤時，會在右側顯示該測試檔案中的所有測試案例結果。</p><p>若為全通過的情況會顯示 <code>All tests passed in this file</code>：</p><p><img src=https://live.staticflickr.com/65535/52593161276_9256c5cd61_o.png max-width=100% max-height=100% class=gallery-image></p><p>若有錯誤會顯示是哪一條測試案例發生錯誤：</p><p><img src=https://live.staticflickr.com/65535/52592678942_4d1f1140cd_o.png max-width=100% max-height=100% class=gallery-image></p><p>我們甚至能點擊錯誤訊息右方的開啟視窗 Icon，Vitest UI 將會直接啟動系統預設的程式碼編輯器，開啟測試檔案後將輸入游標聚焦在錯誤的行數與位置。（e.g. 圖中的 <code>toEqual</code> Assertion Matcher）</p><p><img src=https://live.staticflickr.com/65535/52593161331_e16935173c_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=module-graph>Module Graph</h3><p>接著是第二個頁籤的 <code>Module Graph</code>，這頁的內容主要是透過檢測行內引入模組，呈現檔案之間依賴關係。</p><p><img src=https://live.staticflickr.com/65535/52593421854_0fbbe57891_o.png max-width=100% max-height=100% class=gallery-image></p><p>點擊圖中的節點可以看到該模組的 Source 檔與經由 Transformed 後的程式碼。</p><p><img src=https://live.staticflickr.com/65535/52593587155_3ee1de6d49_o.png max-width=100% max-height=100% class=gallery-image></p><p>而這個圖表最大的用處在於，透過可視化的方式呈現出測試程式碼中受測物（SUT）與依賴物（DOC）的依賴狀況。</p><h3 id=console>Console</h3><p>Console 頁籤主要是顯示在測試程式碼中的 <code>console.log</code> 資訊，由於與測試結果分離的情況下，相較於在終端機中觀察 Console，這裡會顯示得更加清楚。</p><p><img src=https://live.staticflickr.com/65535/52593421919_3ea6a5b14f_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=code>Code</h3><p>最後壓軸介紹的部分，則是 Code 頁籤，你可能會覺得這有什麼特別的，不就是顯示測試檔案程式碼嗎？</p><p><img src=https://live.staticflickr.com/65535/52593161396_0a9ca152a2_o.png max-width=100% max-height=100% class=gallery-image></p><p>然而，這裡的測試程式碼除了預覽之外，還能夠直接在瀏覽器中直接編寫並執行測試查看結果，更重要的是寫完的當下按下儲存它還能夠同步調整到實際的程式碼中！</p><p>比方在瀏覽器中的測試程式碼中加個註解，並儲存：</p><p><img src=https://live.staticflickr.com/65535/52593421979_128985ea34_o.png max-width=100% max-height=100% class=gallery-image></p><p>實際測試程式碼檔案也加上了註解！</p><p><img src=https://live.staticflickr.com/65535/52593680043_347cf27fd6_o.png max-width=100% max-height=100% class=gallery-image></p><p>如此一來，我們就可以直接在這個視窗內撰寫我們的測試案例，並且在瀏覽器中即時看到測試結果。</p><p>不過這裡有個小小缺點是，若在專案中有設定 eslint + prettier 的話，在程式編輯器撰寫測試時可以設定儲存當下的自動做格式化，但是瀏覽器中的編輯器環境不同，所以寫測試時會收到格式錯誤的警告，但在不考慮這點的情況下，這個工具是個用來檢視測試結果與依賴關係的好工具。</p><p><img src=https://live.staticflickr.com/65535/52592679007_e8b05c17bd_o.png max-width=100% max-height=100% class=gallery-image></p><hr><h2 id=程式碼覆蓋率code-coverage>程式碼覆蓋率（Code Coverage）</h2><p>在測試領域中，覆蓋率（Coverage）一詞泛指的是以百分比表示測試程式碼能夠涵蓋多少產品程式碼的範圍，而依據不同的覆蓋率種類，其細微的定義也會有所不同。</p><p>接下來我們以覆蓋率工具庫 <a class=link href=https://cn.vitest.dev/guide/coverage.html target=_blank rel=noopener>c8</a> 來說明覆蓋率的概念與如何透過 <a class=link href=https://cn.vitest.dev/guide/coverage.html target=_blank rel=noopener>c8</a> 在 Vitest 測試環境中檢視當下的測試覆蓋率，最後再來談談有關於覆蓋率的相關議題。</p><h3 id=c8>c8</h3><p>要在 Vitest 測試環境中使用 c8 產生覆蓋率報告，我們首先需要安裝 <code>@vitest/coverage-c8</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm i -D @vitest/coverage-c8
</span></span></code></pre></td></tr></table></div></div><p>接著就可以在 <code>package.json</code> 中新增指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test:coverage&#34;</span><span class=p>:</span> <span class=s2>&#34;vitest --environment jsdom --coverage&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>執行 <code>npm run test:coverage</code> 後，預設會在終端機產生出覆蓋率報告：</p><p><img src=https://live.staticflickr.com/65535/52593680098_635ca46745_o.png max-width=100% max-height=100% class=gallery-image></p><p>而 c8 覆蓋率報告總共有四種類型：</p><ul><li>行數覆蓋率（line coverage）：以行數為單位來計算。</li><li>函式覆蓋率（function coverage）：以內部的函式為單位來計算。</li><li>分枝覆蓋率（branch coverage）：以每個判斷式為單位來計算。</li><li>語句覆蓋率（statement coverage）：以每個語句（statement）為單位計算。</li></ul><p>測試程式碼涵蓋多少範圍的產品程式碼，甚至於每行程式碼個被執行了幾次</p><p>並且若有未覆蓋行數的情況， c8 則會在 Uncovered Line 中顯示未涵蓋的行數範圍，如下圖中的 <code>13-17</code>、<code>19-28</code></p><p><img src=https://live.staticflickr.com/65535/52593587235_4ceba72a25_o.png max-width=100% max-height=100% class=gallery-image></p><p>倘若你覺得這種報告形式不方便觀看，或是希望將它製作成文件，則可以在 config.js 檔中設定 <code>coverage.reporter</code> 的形式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// vite.config.js or vitest.config.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>test</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>coverage</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>reporter</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;text&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span> <span class=s1>&#39;html&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>其中 c8 提供的報告（reporter）選項有以下三種：</p><ul><li>text： 在終端機中呈現覆蓋率報告。</li></ul><p><img src=https://live.staticflickr.com/65535/52593587245_730913e23b_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>json： 以 JSON 格式產生覆蓋率報告。</li></ul><p><img src=https://live.staticflickr.com/65535/52593161446_55167b6751_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>html： 產生一個可互動的 HTML 覆蓋率報告。</li></ul><p><img src=https://live.staticflickr.com/65535/52593161441_82a1a13832_o.png max-width=100% max-height=100% class=gallery-image></p><p>其中 HTML 的版本中，我們還可以點擊測試檔案來查看未覆蓋的行數有哪些，相較終端機的版本，我們就不必再拿著行數去對程式碼了：</p><p><img src=https://live.staticflickr.com/65535/52593422039_9e7c2cf245_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=覆蓋率目標>覆蓋率目標</h3><p>而在瞭解怎麼查看覆蓋率報告後，那麼究竟覆蓋率目標要達到多少才是合理呢？</p><p>以 《可測試的 JavaScript》一書作者 Mark Ethan Trostler 提供的答案是單元測試大約要介於 80 % 左右。</p><p>以 Martin Fowler 於 <a class=link href=https://martinfowler.com/bliki/TestCoverage.html target=_blank rel=noopener>Test Coverage</a> 一文中，則是指出大約會在於 80 至 90 % 附近。</p><p>至於為什麼不是達到百分之百呢？接下來我們來探討有關於覆蓋率相關的議題。</p><h3 id=覆蓋率議題>覆蓋率議題</h3><h4 id=覆蓋率與付出的心力>覆蓋率與付出的心力</h4><p>雖然以理論上來說盡可能得達到高覆蓋率，測試程式碼將涵蓋的越完全，然而為了追求 100 % 的覆蓋率所要付出的心理將會截然不同。</p><p>Jeroen Mols 在 <a class=link href=https://jeroenmols.com/blog/2017/11/28/coveragproblem/ target=_blank rel=noopener>The 100% code coverage problem</a> 一文中的提到了心力付出與覆蓋率的關係表。</p><p><img src=https://live.staticflickr.com/65535/52593422044_6d565f4119_o.png max-width=100% max-height=100% class=gallery-image></p><blockquote><p>引用自 Jeroen Mols 《The 100% code coverage problem》一文中的圖</p></blockquote><p>從上圖中可以看見，在覆蓋率從 0 提升至 80% 我們僅需要付出一些心力就可以輕易達成，然而要將 90% 提升至接近 100% 我們則幾乎要投入兩到三倍以上的心力才能完成。</p><p>因此，有些人雖然會認為 100% 的覆蓋率是一個不錯的目標，但是在實際上，我們可能會因為追求 100% 的覆蓋率而付出過多的心力，而導致測試程式碼的品質反而變差。</p><h4 id=覆蓋率-100-的誤區>覆蓋率 100% 的誤區</h4><p>在費盡千辛萬苦後，我們終於達到了 100% 覆蓋率的情況了。</p><p>然而，100 % 的覆蓋率僅能代表測試程式碼完整（Complete）的覆蓋了產品程式碼，並非代表測試程式碼的品質達到完美（Perfect），接下來我們用個簡單的例子來說明：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>max</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>return</span> <span class=nx>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>test</span><span class=p>(</span><span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>max</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>在上方案例中，我們可以看見 max 測試案例基本上已經完全覆蓋了 max 函式的實作情況，而我們可以從這個案例中看出兩個問題：</p><ul><li>產品程式碼本身有問題，即便測試程式碼覆蓋了 100% 的情況下，產品程式碼本身仍然是有問題的。</li><li>測試程式碼案例與路徑不足，導致覆蓋率為 100% 的情況下，並沒有測出產品程式碼中的問題與邊際案例（edge case）。</li></ul><p>因此覆蓋率 100% 充其量只是一個指標，用來告訴我們測試程式碼是否完整的覆蓋了產品程式碼，而非「完全沒有問題」。</p><p>倘若我們想要盡可能避免這種情況的發生，這時我們就可以透過突變測試（Mutation Testing）來協助我們。</p><h4 id=突變測試mutation-testing>突變測試（mutation testing）</h4><p>突變測試（Mutation Testing）是一種驗證與改善測試程式碼的測試方法，概念上來說，他會盡可能的抽換產品程式碼中的每個角落，接著依照抽換規則來預期測試程式碼的檢測結果。</p><p>假設我們有個比較函式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>greaterThan</span> <span class=o>=</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>x</span> <span class=o>&gt;</span> <span class=nx>y</span>
</span></span></code></pre></td></tr></table></div></div><p>而這時我們測試程式碼可能會這麼處理：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should return true if x is greater than y&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>0</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should return false if x is less than y&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>接著突變測試可能會將 <code>greaterThan</code> 函式中的 <code>></code> 符號替換成 <code>>=</code> 符號，此時理論上來說應該會有測試案例失敗，但是實際上測試程式碼卻沒有檢測到這個問題，那就表示我們的測試程式碼並沒有覆蓋到這個案例。</p><p>此時我們就可以針對這種情況，再補上對應的測試案例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should return true if x is greater than y&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>0</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should return false if x is less than y&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=c1>// 新增案例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>it</span><span class=p>(</span><span class=s1>&#39;should return false if x is equal y&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>expect</span><span class=p>(</span><span class=nx>greaterThan</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)).</span><span class=nx>toBe</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>接著突變測試再度將 <code>></code> 符號替換成各種符號（e.g. <code>&lt;=</code>），甚至是將 <code>{}</code> 語句（statement）清空，而諸如此類的手法，就是突變測試的核心概念。</p><blockquote><p>若想手動置換產品程式碼中的符號，可以從這些方法下手</p><ul><li>operator: +, -, *, /</li><li>condition: &lt;, >, &lt;=, >=, ==, ===, !=, !==</li><li>statement: {}, if, else, for, return, throw, try, catch</li><li>expression: &&, ||, !</li></ul></blockquote><h4 id=突變測試的工具>突變測試的工具</h4><p>雖然說我們可以手動置換產品程式碼中的各種符號，但是這樣的作法會讓我們的工作量變得非常龐大，因此我們可以透過工具來協助我們完成這些工作。</p><p>以前端領域來說，我們可以透過 <a class=link href=https://stryker-mutator.io/ target=_blank rel=noopener>Stryker Mutator</a> 底下的 <code>stryker-js</code> 工具來完成這些工作。</p><p><img src=https://live.staticflickr.com/65535/52593422049_ccee2eefd4_o.png max-width=100% max-height=100% class=gallery-image></p><p>Stryker Mutator 的概念就是透過替換不同的符號產生出突變的內容，而我們的測試程式碼應該要捕捉到那些不合理的情況，藉此來保證我們的測試案例有一定的穩固性。</p><p>然而，可惜的是 <code>stryker-js</code> 目前僅支援到 Jest 環境，尚未支援 Vitest 的環境，因此我這邊就暫不做介紹了，有興趣者可以追蹤該 <a class=link href=https://github.com/stryker-mutator/stryker-js/issues/3465 target=_blank rel=noopener>issue</a> 目前的最新進度。</p><hr></section><footer class=article-footer><section class=article-tags><a href=https://wayneblog.ga/tags/vitest/>vitest</a>
<a href=https://wayneblog.ga/tags/typescript/>typescript</a>
<a href=https://wayneblog.ga/tags/javascript/>javascript</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=https://wayneblog.ga/2023-01-16/nuxt-nuxt3-practice-project/><div class=article-image><img src=https://live.staticflickr.com/65535/52630283696_c93e29e870_o.png loading=lazy data-key=nuxt-nuxt3-practice-project data-hash=https://live.staticflickr.com/65535/52630283696_c93e29e870_o.png></div><div class=article-details><h2 class=article-title>【Nuxt3】實戰練習 - 實作部落格</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/><div class=article-image><img src=https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg loading=lazy data-key=nuxt-try-nuxt3 data-hash=https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg></div><div class=article-details><h2 class=article-title>【Nuxt3】開箱即用的 Nuxt3 玩轉筆記</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-11-22/create-own-vscode-extension/><div class=article-image><img src=https://live.staticflickr.com/65535/52516420035_bc4b9df19c_o.png loading=lazy data-key=create-own-vscode-extension data-hash=https://live.staticflickr.com/65535/52516420035_bc4b9df19c_o.png></div><div class=article-details><h2 class=article-title>今天來搞一個屬於自己的 VScode Extension 吧！</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-11-28/ts-string-type-vs-class/><div class=article-image><img src=https://live.staticflickr.com/65535/52549840532_0ea4bef6e7_o.png loading=lazy data-key=ts-string-type-vs-class data-hash=https://live.staticflickr.com/65535/52549840532_0ea4bef6e7_o.png></div><div class=article-details><h2 class=article-title>TypeScript 裡 string 和 String，還真不僅僅是大小寫的區別！</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2023-01-17/why-encrypt-in-client/><div class=article-image><img src=https://live.staticflickr.com/65535/52634831533_259566b84f_o.jpg loading=lazy data-key=why-encrypt-in-client data-hash=https://live.staticflickr.com/65535/52634831533_259566b84f_o.jpg></div><div class=article-details><h2 class=article-title>網站前端打 API 時把密碼加密，有意義嗎？</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-blog-wayne.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Wayne's blog | 偉恩的部落格 | 技術博客</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#測試的種類>測試的種類</a><ol><li><a href=#單元測試-unit-testing>單元測試 (Unit testing)</a></li><li><a href=#整合測試-integration-testing>整合測試 (Integration testing)</a></li><li><a href=#端對端測試-end-to-end-testing-e2e-testing>端對端測試 (End-to-end testing) (E2E testing)</a></li></ol></li><li><a href=#測試案例中的-3a-模式>測試案例中的 3A 模式</a></li><li><a href=#專案加入-vitest>專案加入 Vitest</a><ol><li><a href=#在初始化專案過程加入-vitest>在初始化專案過程加入 Vitest</a></li><li><a href=#在既有專案中加入-vitest>在既有專案中加入 Vitest</a><ol><li></li></ol></li></ol></li><li><a href=#vitest-config-設定方式>Vitest Config 設定方式</a><ol><li><a href=#執行-npm-指令時帶參數指定設定檔案路徑>執行 npm 指令時帶參數指定設定檔案路徑</a><ol><li></li></ol></li><li><a href=#在專案中的-viteconfigjs-中調整測試設定>在專案中的 vite.config.js 中調整測試設定</a><ol><li></li></ol></li><li><a href=#透過-vitestconfigjs-檔案調整測試設定>透過 vitest.config.js 檔案調整測試設定</a></li></ol></li><li><a href=#vitest-config-option>Vitest config option</a><ol><li><a href=#include>include</a><ol><li></li></ol></li><li><a href=#exclude>exclude</a><ol><li></li></ol></li><li><a href=#globals>Globals</a><ol><li></li></ol></li><li><a href=#environment>environment</a></li></ol></li><li><a href=#測試的本質>測試的本質</a><ol><li><a href=#情境舉例>情境舉例</a></li><li><a href=#簡易的測試工具>簡易的測試工具</a></li><li><a href=#寫測試案例>寫測試案例</a></li><li><a href=#寫受測程式碼的實作>寫受測程式碼的實作</a></li></ol></li><li><a href=#測試工具的選擇>測試工具的選擇</a></li><li><a href=#決定測試情境與測試案例>決定測試情境與測試案例</a><ol><li><a href=#測試情境test-suite測試案例test-case>測試情境(test suite)測試案例(test case)</a></li><li><a href=#案例路徑happy-pathsad-pathbad-path>案例路徑(happy path、sad path、bad path)</a></li><li><a href=#路徑優先度>路徑優先度</a></li></ol></li><li><a href=#撰寫測試程式碼的前言>撰寫測試程式碼的前言</a><ol><li><a href=#撰寫測試程式碼需保持的心境>撰寫測試程式碼需保持的心境</a></li><li><a href=#first-法則>F.I.R.S.T 法則</a><ol><li><a href=#fast快>Fast(快)</a></li><li><a href=#independent獨立>Independent(獨立)</a></li><li><a href=#repeatable可重複>Repeatable(可重複)</a></li><li><a href=#self-validating能自我驗證>Self-Validating(能自我驗證)</a></li><li><a href=#timely即時>Timely(即時)</a></li></ol></li></ol></li><li><a href=#describe--it-與-輔助-api>describe & it 與 輔助 API</a><ol><li><a href=#describe--it-基礎用法>describe & it 基礎用法</a></li><li><a href=#describe--it-輔助-api>describe & it 輔助 API</a><ol><li><a href=#only>only</a></li><li><a href=#skip>skip</a></li><li><a href=#todo>todo</a></li><li><a href=#fails>fails</a></li></ol></li></ol></li><li><a href=#準備setup與清理teardown>準備(Setup)與清理(Teardown)</a><ol><li><a href=#setup--teardown-api-的範疇>Setup & Teardown API 的範疇</a></li><li><a href=#避免誤區在-expect-後做清掃處理>避免誤區：在 expect 後做清掃處理</a></li><li><a href=#避免過度使用-setup--teardown-api>避免過度使用 Setup & Teardown API</a></li><li><a href=#抽象光譜the-spectrum-of-abstraction>抽象光譜(The Spectrum of Abstraction)</a></li></ol></li><li><a href=#斷言語法與-matchers>斷言語法與 Matchers</a><ol><li><a href=#斷言語法>斷言語法</a><ol><li><a href=#chai-assertion>Chai Assertion</a></li><li><a href=#jest-assertion>Jest Assertion</a></li><li><a href=#vitest>Vitest</a></li></ol></li><li><a href=#vitestjest-expect-matchers>Vitest(Jest expect Matchers)</a><ol><li><a href=#常用>常用</a></li><li><a href=#純值資料類型比對>純值資料類型比對</a></li><li><a href=#陣列比對與檢查>陣列比對與檢查</a></li><li><a href=#物件比對與檢查>物件比對與檢查</a></li><li><a href=#監聽函式>監聽函式</a></li></ol></li><li><a href=#快照測試snapshot-testing與快照-matchers>快照測試(Snapshot Testing)與快照 matchers</a><ol><li><a href=#jest-snapshot>Jest Snapshot</a></li><li><a href=#vitest-snapshot>Vitest Snapshot</a></li></ol></li><li><a href=#error>Error</a></li></ol></li><li><a href=#元件測試>元件測試</a><ol><li><a href=#vue-test-utils-與元件測試>Vue Test Utils 與元件測試</a></li><li><a href=#vue-test-utils>Vue-Test-Utils</a></li><li><a href=#元件測試的目標>元件測試的目標</a></li><li><a href=#好的元件測試>好的元件測試</a></li><li><a href=#元件測試與單元測試的關係>元件測試與單元測試的關係</a></li></ol></li><li><a href=#元件測試容器wrapper>元件測試：容器(Wrapper)</a><ol><li><a href=#mount>mount</a></li><li><a href=#shallowmount>shallowMount</a><ol><li></li></ol></li></ol></li><li><a href=#容器的方法wrapper-methods---選擇器>容器的方法（Wrapper methods） - 選擇器</a><ol><li><a href=#選擇器>選擇器</a><ol><li><a href=#元素選擇器>元素選擇器</a></li><li><a href=#find-判斷元素陷阱>find 判斷元素陷阱</a></li><li><a href=#元件component選擇器>元件（component）選擇器</a></li></ol></li><li><a href=#判斷目標存在>判斷目標存在</a></li><li><a href=#使用-data--attribute>使用 data-* attribute</a><ol><li><a href=#在生產環境刪除-data--attribute>在生產環境刪除 data-* attribute</a></li></ol></li></ol></li><li><a href=#容器的方法wrapper-methods---取得目標資訊>容器的方法(Wrapper methods) - 取得目標資訊</a><ol><li><a href=#判斷屬性>判斷屬性</a><ol><li><a href=#attributes>attributes</a></li><li><a href=#classes>classes</a></li></ol></li><li><a href=#判斷內容物>判斷內容物</a><ol><li><a href=#text>text</a></li><li><a href=#html>html</a></li></ol></li></ol></li><li><a href=#容器的方法wrapper-methods---模擬事件>容器的方法(Wrapper methods) - 模擬事件</a><ol><li><a href=#滑鼠事件>滑鼠事件</a></li><li><a href=#滑鼠事件-1>滑鼠事件</a><ol><li><a href=#點擊與雙擊>點擊與雙擊</a></li><li><a href=#指定按鍵點擊>指定按鍵點擊</a></li></ol></li><li><a href=#鍵盤事件>鍵盤事件</a></li><li><a href=#表單事件>表單事件</a><ol><li><a href=#模擬-input-輸入>模擬 input 輸入</a></li><li><a href=#模擬-radio-勾選>模擬 radio 勾選</a></li><li><a href=#模擬-checkbox-勾選>模擬 checkbox 勾選</a></li><li><a href=#模擬-select-選擇>模擬 select 選擇</a></li></ol></li></ol></li><li><a href=#模擬-vue-apis>模擬 Vue APIs</a><ol><li><a href=#data>data</a><ol><li><a href=#私有方法private-method>私有方法（private method）</a></li></ol></li><li><a href=#dataoptions-api>data（options API）</a></li><li><a href=#datacomposition-api-script-setup-語法糖>data（composition API, <code>&lt;script setup></code> 語法糖）</a><ol><li><a href=#composition-api>composition API：</a></li><li><a href=#script-setup-語法糖><code>&lt;script setup></code> 語法糖：</a></li></ol></li><li><a href=#props>props</a><ol><li><a href=#模擬-props-傳入>模擬 props 傳入</a></li></ol></li><li><a href=#斷言是否傳入對-props-參數給子元件>斷言是否傳入對 props 參數給子元件</a></li><li><a href=#emit>emit</a></li><li><a href=#provide>provide</a><ol><li><a href=#透過元件容器中的-globalstubs-模擬假元件>透過元件容器中的 global.stubs 模擬假元件</a></li></ol></li><li><a href=#inject>inject</a></li><li><a href=#slots>slots</a><ol><li><a href=#預設插槽default-slots>預設插槽（Default slots）</a></li><li><a href=#具名插槽named-slots>具名插槽（Named slots）</a></li><li><a href=#作用域插槽scoped-slots>作用域插槽（Scoped slots）</a></li><li><a href=#插槽載入選項mounting-options>插槽載入選項（Mounting options）</a></li></ol></li><li><a href=#custom-directives>custom directives</a></li></ol></li><li><a href=#vitest-ui>Vitest UI</a><ol><li><a href=#介面>介面</a></li><li><a href=#report>Report</a></li><li><a href=#module-graph>Module Graph</a></li><li><a href=#console>Console</a></li><li><a href=#code>Code</a></li></ol></li><li><a href=#程式碼覆蓋率code-coverage>程式碼覆蓋率（Code Coverage）</a><ol><li><a href=#c8>c8</a></li><li><a href=#覆蓋率目標>覆蓋率目標</a></li><li><a href=#覆蓋率議題>覆蓋率議題</a><ol><li><a href=#覆蓋率與付出的心力>覆蓋率與付出的心力</a></li><li><a href=#覆蓋率-100-的誤區>覆蓋率 100% 的誤區</a></li><li><a href=#突變測試mutation-testing>突變測試（mutation testing）</a></li><li><a href=#突變測試的工具>突變測試的工具</a></li></ol></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://wayneblog.ga/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&(console.log("Check service worker register?"),navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("service worker registed.")}).catch(function(e){console.log("service worker registed fail. This happened: ",e)}))</script><div id=fb-root></div><div id=fb-customer-chat class=fb-customerchat></div><script>var chatbox=document.getElementById("fb-customer-chat");chatbox.setAttribute("page_id","100278986238046"),chatbox.setAttribute("attribution","biz_inbox")</script><script>window.fbAsyncInit=function(){FB.init({xfbml:!0,version:"v15.0"})},function(e,t,n){var s,o=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;s=e.createElement(t),s.id=n,s.src="https://connect.facebook.net/zh_TW/sdk/xfbml.customerchat.js",o.parentNode.insertBefore(s,o)}(document,"script","facebook-jssdk")</script></body></html>