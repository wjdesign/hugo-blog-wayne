<!doctype html><html lang=zh-tw dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在使用 Vue 3 開發網站可能會面臨需要做 SEO 的情境，為了解決該情境問題，你可能會找到使用 Vite 做預渲染或其他方式，Nuxt 3 也是其中一個解決方案，且有更多強大的功能，目前 Nuxt 3 已經正式發布穩定版，就讓我們開始嘗鮮上手吧！本篇會著重在 Nuxt 3 的特色與功能學習，所以你可能需具備些 Vue 3 基礎，我將從搭建 Nuxt 3 開發環境、頁面路由與佈局一直到使用 Nuxt 3 建立 SEO 所需的資訊做些筆記及介紹，讓你有個概念並嘗試用 Nuxt 3 來做 SSR 或 SSG，進而解決 Vue 3 SPA 不好做 SEO 的問題。"><meta name=keywords content="javascript,typescript,vue,nuxt3,nuxt,ssr,spa,ssr+spa,ssg,nodejs"><title>【Nuxt3】開箱即用的 Nuxt3 玩轉筆記</title><link rel=canonical href=https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/><link rel=stylesheet href=https://wayneblog.ga/scss/style.min.576d408ce2abc4c6a243e28ac841a3ec197891287a535f544f21febd01184634.css><script>!function(e,t,n,s,o,i,a){if(e.fbq)return;o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],i=t.createElement(n),i.async=!0,i.src=s,a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(i,a)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","843131703668116"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=843131703668116&ev=PageView&noscript=1"></noscript><meta property="og:title" content="【Nuxt3】開箱即用的 Nuxt3 玩轉筆記"><meta property="og:description" content="在使用 Vue 3 開發網站可能會面臨需要做 SEO 的情境，為了解決該情境問題，你可能會找到使用 Vite 做預渲染或其他方式，Nuxt 3 也是其中一個解決方案，且有更多強大的功能，目前 Nuxt 3 已經正式發布穩定版，就讓我們開始嘗鮮上手吧！本篇會著重在 Nuxt 3 的特色與功能學習，所以你可能需具備些 Vue 3 基礎，我將從搭建 Nuxt 3 開發環境、頁面路由與佈局一直到使用 Nuxt 3 建立 SEO 所需的資訊做些筆記及介紹，讓你有個概念並嘗試用 Nuxt 3 來做 SSR 或 SSG，進而解決 Vue 3 SPA 不好做 SEO 的問題。"><meta property="og:url" content="https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/"><meta property="og:site_name" content="Wayne's blog | 偉恩的部落格 | 技術博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="javascript"><meta property="article:tag" content="typescript"><meta property="article:tag" content="vue"><meta property="article:tag" content="nuxt"><meta property="article:published_time" content="2023-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-14T00:00:00+00:00"><meta property="og:image" content="https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg"><meta name=twitter:site content="@4006wayne"><meta name=twitter:creator content="@4006wayne"><meta name=twitter:title content="【Nuxt3】開箱即用的 Nuxt3 玩轉筆記"><meta name=twitter:description content="在使用 Vue 3 開發網站可能會面臨需要做 SEO 的情境，為了解決該情境問題，你可能會找到使用 Vite 做預渲染或其他方式，Nuxt 3 也是其中一個解決方案，且有更多強大的功能，目前 Nuxt 3 已經正式發布穩定版，就讓我們開始嘗鮮上手吧！本篇會著重在 Nuxt 3 的特色與功能學習，所以你可能需具備些 Vue 3 基礎，我將從搭建 Nuxt 3 開發環境、頁面路由與佈局一直到使用 Nuxt 3 建立 SEO 所需的資訊做些筆記及介紹，讓你有個概念並嘗試用 Nuxt 3 來做 SSR 或 SSG，進而解決 Vue 3 SPA 不好做 SEO 的問題。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg"><link rel="shortcut icon" href=https://live.staticflickr.com/65535/52275825736_808b1fd4a8_o.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-FG6KQD7H6C"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FG6KQD7H6C",{anonymize_ip:!1})}</script><link rel=stylesheet type=text/css href=./toastify/style.min.css><script type=text/javascript src=./toastify/index.js></script><script>const hackKey="hack",author="Wayne (偉恩)",link="https://wayneblog.ga/",source="Wayne\u0027s blog | 偉恩的部落格 | 技術博客",warningText="請重視著作權，商業轉載請聯繫作者獲得授權，非商業轉載請註明出處。",warningBackgroundColor="linear-gradient(to right, rgb(108 47 87), rgb(191 86 86))",successBackgroundColor="linear-gradient(to right, rgb(47 151 127), rgb(69 195 137))";window.addEventListener("keyup",function(e){if(e.key&&e.key.toLowerCase()==="h"){let e={text:"",duration:1e3,destination:"",newWindow:!0,close:!0,gravity:"top",position:"center",stopOnFocus:!1,style:{borderRadius:"50em"}};const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(n.has(hackKey)){e.text="Hack模式已關閉",e.style.background=warningBackgroundColor,Toastify(e).showToast(),n.delete(hackKey),t.search=n.toString(),window.history.replaceState(null,"",t.toString());return}e.text="Hack模式已開啟",e.style.background=successBackgroundColor,Toastify(e).showToast(),n.set(hackKey,"1"),t.search=n.toString(),window.history.replaceState(null,"",t.toString())}}),window.addEventListener("copy",function(e){const t=new URL(window.location.href),n=new URLSearchParams(t.search);if(!n.has(hackKey)){e.preventDefault();const t=document.getSelection();e.clipboardData.setData("text/plain",`${t.toString()}

作者：${author}
連結：${link}
來源：${source}
${warningText}`)}})</script><style>:root{--zh-font-family:"Microsoft JhengHei", "微軟正黑體";--code-font-family:Menlo, Monaco, Consolas, "Courier New"}</style><meta name=theme-color content="#57BCB9"><link rel=manifest href=./manifest.json><link rel=apple-touch-icon sizes=57x57 href=./apple-touch-icon-57x57.webp><link rel=apple-touch-icon sizes=114x114 href=./apple-touch-icon-114x114.webp><link rel=apple-touch-icon sizes=120x120 href=./apple-touch-icon-120x120.webp><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon-180x180.webp><link rel=apple-touch-icon sizes=192x192 href=./apple-touch-icon-192x192.webp><link rel=apple-touch-icon sizes=512x512 href=./apple-touch-icon-512x512.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=https://wayneblog.ga/><img src=https://wayneblog.ga/img/avatar2d.webp width=256 height=256 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🧧</span></figure><div class=site-meta><h1 class=site-name><a href=https://wayneblog.ga/>Wayne (偉恩)</a></h1><h2 class=site-description>軟體開發 | 網路工程 | 技術博客</h2></div></header><ol class=social-menu><li><a href=https://www.facebook.com/wayne.blog.ga/ target=_blank title=Facebook><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><linearGradient id="CXanuwD9EGkBgTn76_1mxa" x1="9.993" x2="40.615" y1="-299.993" y2="-330.615" gradientTransform="matrix(1 0 0 -1 0 -290)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2aa4f4"/><stop offset="1" stop-color="#007ad9"/></linearGradient><path fill="url(#CXanuwD9EGkBgTn76_1mxa)" d="M24 4C12.954 4 4 12.954 4 24c0 10.028 7.379 18.331 17.004 19.777C21.981 43.924 22.982 41 24 41c.919.0 1.824 2.938 2.711 2.818C36.475 42.495 44 34.127 44 24 44 12.954 35.046 4 24 4z"/><path d="M27.707 21.169c0-1.424.305-3.121 1.757-3.121h4.283l-.001-5.617-.05-.852-.846-.114c-.608-.082-1.873-.253-4.206-.253-5.569.0-8.636 3.315-8.636 9.334v2.498H15.06v7.258h4.948V43.6C21.298 43.861 22.633 44 24 44c1.268.0 2.504-.131 3.707-.357V30.301h5.033l1.122-7.258h-6.155V21.169z" opacity=".05"/><path d="M27.207 21.169c0-1.353.293-3.621 2.257-3.621h3.783V12.46l-.026-.44-.433-.059c-.597-.081-1.838-.249-4.143-.249-5.323.0-8.136 3.055-8.136 8.834v2.998H15.56v6.258h4.948v13.874C21.644 43.876 22.806 44 24 44c1.094.0 2.16-.112 3.207-.281V29.801h5.104l.967-6.258h-6.072V21.169z" opacity=".05"/><path fill="#fff" d="M26.707 29.301h5.176l.813-5.258h-5.989v-2.874c0-2.184.714-4.121 2.757-4.121h3.283V12.46c-.577-.078-1.797-.248-4.102-.248-4.814.0-7.636 2.542-7.636 8.334v3.498H16.06v5.258h4.948v14.475C21.988 43.923 22.981 44 24 44c.921.0 1.82-.062 2.707-.182V29.301z"/></svg></a></li><li><a href=https://github.com/wjdesign target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.instagram.com/huai_lin/ target=_blank title=Instagram><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><path fill="#304ffe" d="M41.67 13.48c-.4.26-.97.5-1.21.77-.09.09-.14.19-.12.29v1.03l-.3 1.01-.3 1-.33 1.1-.68 2.25-.66 2.22-.5 1.67c0 .26-.01.52-.03.77-.07.96-.27 1.88-.59 2.74-.19.53-.42 1.04-.7 1.52-.1.19-.22.38-.34.56-.4.63-.88 1.21-1.41 1.72-.41.41-.86.79-1.35 1.11h-.01c-.08.07-.17.13-.27.18-.31.21-.64.39-.98.55-.23.12-.46.22-.7.31-.05.03-.11.05-.16.07-.57.27-1.23.45-1.89.54-.04.01-.07.01-.11.02-.4.07-.79.13-1.19.16-.18.02-.37.03-.55.03l-.71-.04-3.42-.18c0-.01-.01.0-.01.0l-1.72-.09c-.13.0-.27.0-.4-.01-.54-.02-1.06-.08-1.58-.19h-.01c-.95-.18-1.86-.5-2.71-.93-.47-.24-.93-.51-1.36-.82-.18-.13-.35-.27-.52-.42-.48-.4-.91-.83-1.31-1.27-.06-.06-.11-.12-.16-.18-.06-.06-.12-.13-.17-.19-.38-.48-.7-.97-.96-1.49-.24-.46-.43-.95-.58-1.49-.06-.19-.11-.37-.15-.57-.01-.01-.02-.03-.02-.05-.1-.41-.19-.84-.24-1.27-.06-.33-.09-.66-.09-1-.02-.13-.02-.27-.02-.4l1.91-2.95 1.87-2.88.85-1.31.77-1.18.26-.41v-1.03c.02-.23.03-.47.02-.69-.01-.7-.15-1.38-.38-2.03-.22-.69-.53-1.34-.85-1.94-.38-.69-.78-1.31-1.11-1.87C14 7.4 13.66 6.73 13.75 6.26 14.47 6.09 15.23 6 16 6h16c4.18.0 7.78 2.6 9.27 6.26C41.43 12.65 41.57 13.06 41.67 13.48z"/><path fill="#4928f4" d="M42 16v.27l-1.38.8-.88.51-.97.56-1.94 1.13-1.9 1.1-1.94 1.12-.77.45c0 .48-.12.92-.34 1.32-.31.58-.83 1.06-1.49 1.47-.67.41-1.49.74-2.41.98.0.0.0-.01-.01.0-3.56.92-8.42.5-10.78-1.26-.66-.49-1.12-1.09-1.32-1.78-.06-.23-.09-.48-.09-.73v-7.19c.01-.15-.09-.3-.27-.45-.54-.43-1.81-.84-3.23-1.25-1.11-.31-2.3-.62-3.3-.92-.79-.24-1.46-.48-1.86-.71.18-.35.39-.7.61-1.03 1.4-2.05 3.54-3.56 6.02-4.13C14.47 6.09 15.23 6 16 6h10.8c5.37.94 10.32 3.13 14.47 6.26.16.39.3.8.4 1.22.18.66.29 1.34.32 2.05C42 15.68 42 15.84 42 16z"/><path fill="#6200ea" d="M42 16v4.41l-.22.68-.75 2.33-.78 2.4-.41 1.28-.38 1.19-.37 1.13-.36 1.12-.19.59-.25.78c0 .76-.02 1.43-.07 2-.01.06-.02.12-.02.18-.06.53-.14.98-.27 1.36-.01.06-.03.12-.05.17-.26.72-.65 1.18-1.23 1.48-.14.08-.3.14-.47.2-.53.18-1.2.27-2.02.32-.6.04-1.29.05-2.07.05H31.4l-1.19-.05L30 37.61l-2.17-.09-2.2-.09-7.25-.3-1.88-.08h-.26c-.78-.01-1.45-.06-2.03-.14-.84-.13-1.49-.35-1.98-.68-.7-.45-1.11-1.11-1.35-2.03-.06-.22-.11-.45-.14-.7-.1-.58-.15-1.25-.18-2 0-.15.0-.3-.01-.46-.01-.01.0-.01.0-.01v-.58c-.01-.29-.01-.59-.01-.9l.05-1.61.03-1.15.04-1.34v-.19l.07-2.46.07-2.46.07-2.31.06-2.27.02-.6c0-.31-1.05-.49-2.22-.64-.93-.12-1.95-.23-2.56-.37.05-.23.1-.46.16-.68.18-.72.45-1.4.79-2.05.18-.35.39-.7.61-1.03 2.16-.95 4.41-1.69 6.76-2.17 2.06-.43 4.21-.66 6.43-.66 7.36.0 14.16 2.49 19.54 6.69.52.4 1.03.83 1.53 1.28C42 15.68 42 15.84 42 16z"/><path fill="#673ab7" d="M42 18.37v4.54l-.55 1.06-1.05 2.05-.56 1.08-.51.99-.22.43c0 .31.0.61-.02.9.0.43-.02.84-.05 1.22-.04.45-.1.86-.16 1.24-.15.79-.36 1.47-.66 2.03-.04.07-.08.14-.12.2-.11.18-.24.35-.38.51-.18.22-.38.41-.61.57-.34.26-.74.47-1.2.63-.57.21-1.23.35-2.01.43-.51.05-1.07.08-1.68.08l-.42.02-2.08.12h-.01L27.5 36.6l-2.25.13-3.1.18-3.77.22-.55.03c-.51.0-.99-.03-1.45-.09-.05-.01-.09-.02-.14-.02-.68-.11-1.3-.29-1.86-.54-.68-.3-1.27-.7-1.77-1.18-.44-.43-.82-.92-1.13-1.47-.07-.13-.14-.25-.2-.39-.3-.59-.54-1.25-.72-1.97-.03-.12-.06-.25-.08-.38-.06-.23-.11-.47-.14-.72-.11-.64-.17-1.32-.2-2.03v-.01c-.01-.29-.02-.57-.02-.87l-.49-1.17-.07-.18L9.5 25.99 8.75 24.2l-.12-.29-.72-1.73-.8-1.93H7.1L6.29 18.3 6 17.59V16c0-.63.06-1.25.17-1.85.05-.23.1-.46.16-.68.85-.49 1.74-.94 2.65-1.34 2.08-.93 4.31-1.62 6.62-2.04 1.72-.31 3.51-.48 5.32-.48 7.31.0 13.94 2.65 19.12 6.97.2.16.39.32.58.49C41.09 17.48 41.55 17.91 42 18.37z"/><path fill="#8e24aa" d="M42 21.35v5.14l-.57 1.19-1.08 2.25-.01.03c0 .43-.02.82-.05 1.17-.1 1.15-.38 1.88-.84 2.33-.33.34-.74.53-1.25.63-.03.01-.07.01-.1.02-.16.03-.33.05-.51.05-.62.06-1.35.02-2.19-.04-.09.0-.19-.01-.29-.02-.61-.04-1.26-.08-1.98-.11-.39-.01-.8-.02-1.22-.02h-.02l-1.01.08h-.01l-2.27.16-2.59.2-.38.03-3.03.22-1.57.12-1.55.11c-.27.0-.53.0-.79-.01.0.0-.01-.01-.01.0-1.13-.02-2.14-.09-3.04-.26-.83-.14-1.56-.36-2.18-.69-.64-.31-1.17-.75-1.6-1.31-.41-.55-.71-1.24-.9-2.07v-.01c-.14-.67-.22-1.45-.22-2.33l-.15-.27L9.7 26.35l-.13-.22L9.5 25.99l-.93-1.65-.46-.83-.58-1.03-1-1.79L6 19.75v-3.68c.88-.58 1.79-1.09 2.73-1.55 1.14-.58 2.32-1.07 3.55-1.47 1.34-.44 2.74-.79 4.17-1.02 1.45-.24 2.94-.36 4.47-.36 6.8.0 13.04 2.43 17.85 6.47.22.17.43.36.64.54.84.75 1.64 1.56 2.37 2.41C41.86 21.18 41.94 21.26 42 21.35z"/><path fill="#c2185b" d="M42 24.71v7.23c-.24-.14-.57-.31-.98-.49-.22-.11-.47-.22-.73-.32-.38-.17-.79-.33-1.25-.49-.1-.04-.2-.07-.31-.1-.18-.07-.37-.13-.56-.19-.59-.18-1.24-.35-1.92-.5-.26-.05-.53-.1-.8-.14-.87-.15-1.8-.24-2.77-.25-.08-.01-.17-.01-.25-.01l-2.57.02-3.5.02h-.01l-7.49.06c-2.38.0-3.84.57-4.72.8.0.0-.01.0-.01.01-.93.24-1.22.09-1.3-1.54-.02-.45-.03-1.03-.03-1.74l-.56-.43-.98-.74-.6-.46-.12-.09L8.88 24.1l-.25-.19-.52-.4-.96-.72L6 21.91v-3.4c.1-.08.19-.15.29-.21 1.45-1 3-1.85 4.64-2.54 1.46-.62 3-1.11 4.58-1.46.43-.09.87-.18 1.32-.24 1.33-.23 2.7-.34 4.09-.34 6.01.0 11.53 2.09 15.91 5.55.66.52 1.3 1.07 1.9 1.66.82.78 1.59 1.61 2.3 2.49.14.18.28.36.42.55C41.64 24.21 41.82 24.46 42 24.71z"/><path fill="#d81b60" d="M42 28.72V32c0 .65-.06 1.29-.18 1.91-.18.92-.49 1.8-.91 2.62-.22.05-.47.05-.75.01-.63-.11-1.37-.44-2.17-.87-.04-.01-.08-.03-.11-.05-.25-.13-.51-.27-.77-.43-.53-.29-1.09-.61-1.65-.91-.12-.06-.24-.12-.35-.18-.64-.33-1.3-.63-1.96-.86h-.01c-.14-.05-.29-.1-.44-.14-.57-.16-1.15-.26-1.71-.26l-1.1-.32-4.87-1.41h-.01l-2.99-.87h-.01l-1.3-.38c-3.76.0-6.07 1.6-7.19.99-.44-.23-.7-.81-.79-1.95-.03-.32-.04-.68-.04-1.1l-1.17-.57-.05-.02h-.01l-.84-.42L9.7 26.35l-.07-.03-.17-.09L7.5 25.28 6 24.55v-3.43c.17-.15.35-.29.53-.43.19-.15.38-.29.57-.44h.01c1.18-.85 2.43-1.6 3.76-2.22 1.55-.74 3.2-1.31 4.91-1.68.25-.06.51-.12.77-.16 1.42-.27 2.88-.41 4.37-.41 5.27.0 10.11 1.71 14.01 4.59 1.13.84 2.18 1.77 3.14 2.78.79.83 1.52 1.73 2.18 2.67.05.07.1.14.15.2.37.54.71 1.09 1.03 1.66C41.64 28.02 41.82 28.37 42 28.72z"/><path fill="#f50057" d="M41.82 33.91c-.18.92-.49 1.8-.91 2.62-.19.37-.4.72-.63 1.06-.14.21-.29.41-.44.6-.36-.14-.89-.34-1.54-.56v-.01c-.49-.17-1.05-.35-1.65-.52-.17-.05-.34-.1-.52-.15-.71-.19-1.45-.36-2.17-.46-.6-.1-1.19-.16-1.74-.16l-.46-.13h-.01l-2.42-.7-1.49-.43-1.66-.48h-.01l-.54-.15-6.53-1.88-1.88-.54-1.4-.33-2.28-.54-.28-.07h-.01l-2.29-.53v-.01l-.41-.09-.21-.05-1.67-.39-.19-.05-1.42-1.17L6 27.9v-4.08c.37-.36.75-.7 1.15-1.03.12-.11.25-.21.38-.31.12-.1.25-.2.38-.3.91-.69 1.87-1.31 2.89-1.84 1.3-.7 2.68-1.26 4.13-1.66.28-.09.56-.17.85-.23 1.64-.41 3.36-.62 5.14-.62 4.47.0 8.63 1.35 12.07 3.66 1.71 1.15 3.25 2.53 4.55 4.1.66.79 1.26 1.62 1.79 2.5.05.07.09.13.13.2.32.53.62 1.08.89 1.64.25.5.47 1 .67 1.52C41.34 32.25 41.6 33.07 41.82 33.91z"/><path fill="#ff1744" d="M40.28 37.59c-.14.21-.29.41-.44.6-.44.55-.92 1.05-1.46 1.49-.47.39-.97.74-1.5 1.04-.2-.05-.4-.11-.61-.19-.66-.23-1.35-.61-1.99-1.01-.96-.61-1.79-1.27-2.16-1.57-.14-.12-.21-.18-.21-.18l-1.7-.15L30 37.6l-2.2-.19-2.28-.2-3.37-.3-5.34-.47-.02-.01-1.88-.91-1.9-.92-1.53-.74-.33-.16-.41-.2-1.42-.69L7.43 31.9l-.59-.29L6 31.35v-4.47c.47-.56.97-1.09 1.5-1.6.34-.32.7-.64 1.07-.94.06-.05.12-.1.18-.14.04-.05.09-.08.13-.1.59-.48 1.21-.91 1.85-1.3.74-.47 1.52-.89 2.33-1.24.87-.39 1.78-.72 2.72-.97 1.63-.46 3.36-.7 5.14-.7 4.08.0 7.85 1.24 10.96 3.37 1.99 1.36 3.71 3.08 5.07 5.07.45.64.85 1.32 1.22 2.02.13.26.26.52.37.78.12.25.23.5.34.75.21.52.4 1.04.57 1.58.32 1 .56 2.02.71 3.08C40.21 36.89 40.25 37.24 40.28 37.59z"/><path fill="#ff5722" d="M38.39 39.42c0 .08.0.17-.01.26-.47.39-.97.74-1.5 1.04-.22.12-.44.24-.67.34-.23.11-.46.21-.7.3-.34-.18-.8-.4-1.29-.61-.69-.31-1.44-.59-2.02-.68-.14-.03-.27-.04-.39-.04l-1.64-.21h-.02l-2.04-.27-2.06-.27-.96-.12-7.56-.98c-.49.0-1.01-.03-1.55-.1-.66-.06-1.35-.16-2.04-.3-.68-.12-1.37-.28-2.03-.45-.69-.16-1.37-.35-2-.53-.73-.22-1.41-.43-1.98-.62-.47-.15-.87-.29-1.18-.4-.18-.43-.33-.88-.44-1.34C6.1 33.66 6 32.84 6 32v-1.67c.32-.53.67-1.05 1.06-1.54.71-.94 1.52-1.8 2.4-2.56.03-.04.07-.07.1-.09l.01-.01c.31-.28.63-.53.97-.77.04-.04.08-.07.12-.1.16-.12.33-.24.51-.35 1.43-.97 3.01-1.73 4.7-2.24 1.6-.48 3.29-.73 5.05-.73 3.49.0 6.75 1.03 9.47 2.79 2.01 1.29 3.74 2.99 5.06 4.98.16.23.31.46.46.7.69 1.17 1.26 2.43 1.68 3.75.05.15.09.3.13.46.08.27.15.55.21.83.02.07.04.14.06.22.14.63.24 1.29.31 1.95v.01C38.36 38.22 38.39 38.82 38.39 39.42z"/><path fill="#ff6f00" d="M36.33 39.42c0 .35-.02.73-.06 1.11-.02.18-.04.36-.06.53-.23.11-.46.21-.7.3-.45.17-.91.31-1.38.41-.32.07-.65.13-.98.16h-.01c-.31-.19-.67-.42-1.04-.68-.67-.47-1.37-1-1.93-1.43-.01-.01-.01-.01-.02-.02-.59-.45-1.01-.79-1.01-.79l-1.06.04-2.04.07-.95.04-3.82.14-3.23.12c-.21.01-.46.01-.77.0h-.01c-.42-.01-.92-.04-1.47-.09-.64-.05-1.34-.11-2.05-.18-.69-.08-1.39-.16-2.06-.24-.74-.08-1.44-.17-2.04-.25-.47-.06-.88-.11-1.21-.15-.28-.32-.53-.65-.77-1.01-.36-.54-.67-1.11-.91-1.72-.18-.43-.33-.88-.44-1.34.29-.89.67-1.73 1.12-2.54.36-.66.78-1.29 1.24-1.89.45-.59.94-1.14 1.47-1.64v-.01c.15-.15.3-.29.45-.42.28-.26.57-.5.87-.73h.01c.01-.02.02-.02.03-.03.24-.19.49-.36.74-.53 1.48-1.01 3.15-1.76 4.95-2.2 1.19-.29 2.44-.45 3.73-.45 2.54.0 4.94.61 7.05 1.71h.01c1.81.93 3.41 2.21 4.7 3.75.71.82 1.32 1.72 1.82 2.67.35.64.65 1.31.9 1.99.02.06.04.11.06.16.17.5.32 1.02.45 1.54.09.37.16.75.22 1.13.02.12.04.23.05.35C36.28 37.99 36.33 38.7 36.33 39.42z"/><path fill="#ff9800" d="M34.28 39.42v.1c0 .34-.03.77-.06 1.23-.03.34-.06.69-.09 1.02-.32.07-.65.13-.98.16h-.01C32.76 41.98 32.39 42 32 42h-1.75l-.38-.11-1.97-.6-2-.6-4.63-1.39-2-.6s-.83.33-2 .72h-.01c-.45.15-.94.31-1.46.47-.65.19-1.34.38-2.02.53-.7.16-1.39.28-2.01.33-.19.02-.38.03-.55.03-.56-.31-1.1-.68-1.59-1.09-.43-.36-.83-.75-1.2-1.18-.28-.32-.53-.65-.77-1.01.07-.45.15-.89.27-1.32.3-1.19.77-2.33 1.39-3.37.34-.59.72-1.16 1.16-1.69.01-.03.04-.06.07-.08-.01-.01.0-.01.0-.01.13-.17.27-.33.41-.48v-.01c.41-.44.83-.86 1.29-1.25.16-.13.31-.26.48-.39.03-.03.06-.05.1-.08 2.25-1.72 5.06-2.76 8.09-2.76 3.44.0 6.57 1.29 8.94 3.41 1.14 1.03 2.11 2.26 2.84 3.63.06.1.12.21.17.32.09.18.18.37.26.57.33.72.59 1.48.77 2.26.02.08.04.16.06.24.08.37.15.75.2 1.13C34.24 38.21 34.28 38.81 34.28 39.42z"/><path fill="#ffc107" d="M32.22 39.42c0 .2-.01.42-.02.65-.02.37-.05.77-.1 1.18-.02.25-.06.5-.1.75h-5.48l-1.06-.17-4.14-.66-.59-.09-1.35-.22c-.59.0-1.87.26-3.22.51-.71.13-1.43.27-2.08.36-.08.01-.16.02-.23.03h-.01c-.7-.15-1.38-.38-2.02-.68-.2-.09-.4-.19-.6-.3-.56-.31-1.1-.68-1.59-1.09-.01-.12-.02-.22-.02-.27.0-.26.01-.51.03-.76.04-.64.13-1.26.27-1.86.22-.91.54-1.79.97-2.6.08-.17.17-.34.27-.5.04-.08.09-.15.13-.23.18-.29.38-.57.58-.85.42-.55.89-1.07 1.39-1.54h.01c.04-.04.08-.08.12-.11.05-.04.09-.09.14-.12.2-.18.4-.34.61-.49.0-.01.01-.01.01-.01 1.89-1.41 4.23-2.24 6.78-2.24 1.98.0 3.82.5 5.43 1.38h.01c1.38.76 2.58 1.79 3.53 3.03.37.48.7.99.98 1.53h.01c.05.1.1.2.15.3.3.59.54 1.21.72 1.85h.01c.01.05.03.1.04.15.12.43.22.87.29 1.32.01.09.02.19.03.28C32.19 38.43 32.22 38.92 32.22 39.42z"/><path fill="#ffd54f" d="M30.17 39.31c0 .16.0.33-.02.49v.01.01c-.02.72-.12 1.43-.28 2.07.0.04-.01.07-.03.11h-4.67l-3.85-.83-.51-.11-.08.02-4.27.88L16.27 42H16c-.64.0-1.27-.06-1.88-.18-.09-.02-.18-.04-.27-.06h-.01c-.7-.15-1.38-.38-2.02-.68-.02-.11-.04-.22-.05-.33-.07-.43-.1-.88-.1-1.33.0-.17.0-.34.01-.51.03-.54.11-1.07.23-1.58.08-.38.19-.75.32-1.1.11-.31.24-.61.38-.9.12-.25.26-.49.4-.73.14-.23.29-.45.45-.67.4-.55.87-1.06 1.39-1.51.3-.26.63-.51.97-.73 1.46-.96 3.21-1.52 5.1-1.52.37.0.73.02 1.08.07h.02c1.07.12 2.07.42 2.99.87h.01c1.45.71 2.68 1.78 3.58 3.1.15.22.3.46.43.7.11.19.21.39.3.59.14.31.27.64.38.97h.01c.11.37.21.74.28 1.13v.01C30.11 38.16 30.17 38.73 30.17 39.31z"/><path fill="#ffe082" d="M28.11 39.52v.03c0 .59-.07 1.17-.21 1.74-.05.24-.12.48-.21.71h-4.48l-2.29-.63L18.63 42H16c-.64.0-1.27-.06-1.88-.18-.02-.03-.03-.06-.04-.09-.14-.43-.25-.86-.3-1.31-.04-.29-.06-.59-.06-.9.0-.12.0-.25.02-.37.01-.47.08-.93.2-1.37.06-.3.15-.59.27-.87.04-.14.1-.27.17-.4.15-.34.33-.67.53-.99.22-.32.46-.62.73-.9.32-.36.68-.69 1.09-.96.7-.51 1.5-.89 2.37-1.1.58-.16 1.19-.24 1.82-.24 2 0 3.79.8 5.09 2.09.05.05.11.11.16.18h.01c.14.15.27.3.4.47.37.47.68.98.92 1.54.12.26.22.53.3.81.01.04.02.07.03.11.14.49.23 1 .25 1.53C28.1 39.2 28.11 39.36 28.11 39.52z"/><path fill="#ffecb3" d="M26.06 39.52c0 .41-.05.8-.16 1.17-.1.4-.25.78-.44 1.14-.03.06-.1.17-.1.17h-8.88c-.01-.01-.02-.03-.02-.04-.12-.19-.22-.38-.3-.59-.2-.46-.32-.96-.36-1.48-.02-.12-.02-.25-.02-.37.0-.06.0-.13.01-.19.01-.44.07-.86.19-1.25.1-.36.23-.69.4-1.01.0.0.01-.01.01-.02.12-.21.25-.42.4-.62.49-.66 1.14-1.2 1.89-1.55h.01c.24-.12.49-.22.75-.29h.01c.46-.14.96-.21 1.47-.21.59.0 1.16.09 1.68.28.19.05.37.13.55.22h.01c.86.41 1.59 1.05 2.09 1.85.1.15.19.31.27.48.04.07.08.15.11.22.23.52.37 1.09.41 1.69.01.05.01.1.01.16C26.06 39.36 26.06 39.44 26.06 39.52z"/><g><path fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2" d="M30 11H18c-3.9.0-7 3.1-7 7v12c0 3.9 3.1 7 7 7h12c3.9.0 7-3.1 7-7V18c0-3.9-3.1-7-7-7z"/><circle cx="31" cy="16" r="1" fill="#fff"/></g><g><circle cx="24" cy="24" r="6" fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="2"/></g></svg></a></li><li><a href=https://twitter.com/4006wayne target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=https://wayneblog.ga/%E9%97%9C%E6%96%BC%E6%9C%AC%E7%AB%99/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>關於本站</span></a></li><li><a href=https://wayneblog.ga/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>文章卷宗</span></a></li><li><a href=https://wayneblog.ga/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜尋檢索</span></a></li><li><a href=https://wayneblog.ga/%E7%9B%B8%E9%97%9C%E9%80%A3%E7%B5%90/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>相關連結</span></a></li><li><a href=https://wayneblog.ga/categories/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg><span>分類檢索</span></a></li><li><a href=https://wayneblog.ga/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>標籤檢索</span></a></li><li><a href=https://wayneblog.ga/index.xml target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg><span>RSS Feed</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://wayneblog.ga/ selected>繁體中文</option><option value=https://wayneblog.ga/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>夜晚模式</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><a class=btnBack href=javascript:void(0) onclick=backEvent()><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-back" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9 11l-4 4 4 4m-4-4h11a4 4 0 000-8h-1"/></svg><span class=btnBackText>BACK</span></a>
<script>function backEvent(){if(document.referrer.indexOf(window.location.host)!==-1){history.go(-1);return}window.location.href=window.location.origin}</script><header class=article-header><div class=article-image><a href=https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/><img src=https://live.staticflickr.com/65535/52616698791_b7b8bbce05_o.jpg loading=lazy alt="Featured image of post 【Nuxt3】開箱即用的 Nuxt3 玩轉筆記"></a></div><div class=article-details><header class=article-category><a href=https://wayneblog.ga/categories/javascript/ style=background-color:#f7b41b;color:#fff>Javascript</a>
<a href=https://wayneblog.ga/categories/typescript/ style=background-color:#2d79c7;color:#fff>Typescript</a>
<a href=https://wayneblog.ga/categories/vue/ style=background-color:#4cbc8c;color:#fff>Vue</a>
<a href=https://wayneblog.ga/categories/nuxt/ style=background-color:#14817b;color:#fff>Nuxt</a></header><div class=article-title-wrapper><h2 class=article-title><a href=https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/>【Nuxt3】開箱即用的 Nuxt3 玩轉筆記</a></h2><h3 class=article-subtitle>在使用 Vue 3 開發網站可能會面臨需要做 SEO 的情境，為了解決該情境問題，你可能會找到使用 Vite 做預渲染或其他方式，Nuxt 3 也是其中一個解決方案，且有更多強大的功能，目前 Nuxt 3 已經正式發布穩定版，就讓我們開始嘗鮮上手吧！本篇會著重在 Nuxt 3 的特色與功能學習，所以你可能需具備些 Vue 3 基礎，我將從搭建 Nuxt 3 開發環境、頁面路由與佈局一直到使用 Nuxt 3 建立 SEO 所需的資訊做些筆記及介紹，讓你有個概念並嘗試用 Nuxt 3 來做 SSR 或 SSG，進而解決 Vue 3 SPA 不好做 SEO 的問題。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 14, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 76 分鐘</time></div></footer></div></header><section class=article-content><style>.article-content p code{background-color:#f5f5f5;color:#ff3860}.focus{background:#f1e2e2;color:#d62c2c;padding:0 5px}</style><p><a class=link href=https://medium.com/@mjackson/universal-javascript-4761051b7ae9 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/articles/10292483 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://github.com/wjdesign/ithome-2022-ironman-nuxt3 target=_blank rel=noopener>參考網站</a><br><a class=link href=https://ithelp.ithome.com.tw/users/20152617/ironman/5934 target=_blank rel=noopener>參考網站</a></p><p>在使用 Vue 3 開發網站可能會面臨需要做 SEO 的情境，為了解決該情境問題，你可能會找到使用 Vite 做預渲染或其他方式，<a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 也是其中一個解決方案，且有更多強大的功能，目前 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 已經正式發布穩定版，就讓我們開始嘗鮮上手吧！</p><p>本篇會著重在 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 的特色與功能學習，所以你可能需具備些 Vue 3 基礎，我將從搭建 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 開發環境、頁面路由與佈局一直到使用 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 建立 SEO 所需的資訊做些筆記及介紹，讓你有個概念並嘗試用 Nuxt 3 來做 SSR 或 SSG，進而解決 Vue 3 SPA 不好做 SEO 的問題。</p><hr><h2 id=nuxt-3-介紹>Nuxt 3 介紹</h2><h3 id=前言>前言</h3><p>採用 SSR + SPA，將第一個畫面透過 SSR 產生，其他就交給 CSR 來做處理，既能兼具 SEO 還能擁有 SPA 的使用者體驗，不是很完美嗎？沒有錯，但在沒有任何框架輔助之下，同一個頁面你可能就需要實作兩次程式碼，也就是前後端各一次的渲染邏輯，這也就是相應的代價。在介紹 Nuxt 3 之前就稍微提一下 <strong>Isomorphic JavaScript</strong> 與 <strong>Universal JavaScript</strong>。</p><h3 id=isomorphic-javascript-與-universal-javascript>Isomorphic JavaScript 與 Universal JavaScript</h3><h4 id=isomorphic-javascript>Isomorphic JavaScript</h4><p>隨著 Node.js 的出現，讓客戶端瀏覽器之外的伺服器也能執行 JavaScript 程式碼，使得 JavaScript 成為一種同構語言 (Isomorphic Language)。Isomorphic JavaScript 即稱之為<strong>同樣的 JavaScript 程式碼可以在客戶端及伺服器端運行</strong>；也就是說同一份 Code 除了能在前端瀏覽器也能在後端執行。</p><p>然而 <code>Isomorphic JavaScript</code> 與 <code>Universal JavaScript</code> 的名詞存有一些爭議與差異，如今，<code>Isomorphic JavaScript</code> 多以稱<strong>相同的程式碼元件，可以在客戶端與伺服器端用來組裝或渲染出頁面的技術</strong>。</p><h4 id=universal-javascript>Universal JavaScript</h4><p>Michael Jackson 的<a class=link href=https://medium.com/@mjackson/universal-javascript-4761051b7ae9 target=_blank rel=noopener>文章</a>提到，Isomorphic 這個詞的含義「corresponding or similar in form and relations」為兩個實體不相同，但具有相似的操作或對應的關係，換句話說就是，兩個看起來不一樣的使用方法或語法，但最終的執行結果是一樣的，例如 jQuery 或 Zepto 操作 DOM 的語法長的不大一樣，但是最終也都是對應 JavaScript 的 <code>document.querySelector</code> 等方法。</p><p>所以說，為了描述相同的程式碼但能在不同環境中運行的名詞，就有了 <code>Universal JavaScript</code> 一詞，這個名字告訴人們 JavaScript 它<strong>不僅可以在服務器和瀏覽器上運行，還可以在本機設備和嵌入式架構上運行</strong>。</p><p>那麼 Isomorphic JavaScript 和 Universal JavaScript 與我們又有什麼關係呢？</p><p>有的，因為 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 正是一個 <code>Isomorphic JavaScript</code> 框架，<a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 是目前你使用 Vue 3 在開發網站時，會需要採用 SSR 技術或優化 SEO 問題所可以使用的解決方案。</p><h3 id=nuxt-3>Nuxt 3</h3><p><a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 官方在 2022/11/16 正式發布穩定版本 <a class=link href=https://github.com/nuxt/framework/releases/tag/v3.0.0 target=_blank rel=noopener>Nuxt 3.0 stable</a>。</p><p><img src=https://live.staticflickr.com/65535/52617186163_0145c6b0f2_o.jpg max-width=100% max-height=100% class=gallery-image></p><p><a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 官網的標語 <code>The Intuitive Web Framework</code>，<a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 將讓你更直覺的體驗混合渲染等新功能，讓在使用 Vue 3 開發時變得更加簡單！</p><h4 id=nuxt-3-的新特性>Nuxt 3 的新特性</h4><p>從 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 官網的提供訊息所列，簡單說明一下 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 的新特性，共有下列 12 個：</p><p><img src=https://live.staticflickr.com/65535/52616188037_f6476e512d_o.png max-width=100% max-height=100% class=gallery-image></p><ul><li>Lighter：更輕量，針對現在瀏覽器，伺服器部署與客戶端打包能減少最高 75 倍之多。</li><li>Faster：更快速，通過 Nitro 提供支持的動態伺服器端程式碼拆分來優化冷啟動問題。</li><li>Hybird：動態的靜態頁面生成和其他高級模式，現在這些都將成為可能。</li><li>Suspense：在導航觸發的前後，皆可以在任何元件中取得數據資料。</li><li>Composition API：使用 Composition API 和 Nuxt 3 的 Composables 實現真正的程式碼可重用性。</li><li>Nuxt CLI：全新的零依賴體驗，幫助你輕鬆建立專案與模組整合。</li><li>Nuxt Dev Tools：專屬開發除錯工具，提供更多的資訊與快速修復，讓工作更高效。</li><li>Nuxt Kit：具備基於 TypeScript 和跨版本兼容性的全新模組開發。</li><li>webpack 5：更快速的打包時間與打包出更小的體積，並且無需任何配置。</li><li>Vite：使用 Vite 作為打包工具，體驗閃電般快速的 HMR。</li><li>Vue 3：完全支持 Vue 3。</li><li>TypeScript：使用 TypeScript 與 ESM 構建而成，無需額外的配置步驟。</li></ul><h4 id=nitro>Nitro</h4><p>Nuxt 3 由一個全新的伺服器引擎 <a class=link href=https://nuxt.com/docs/guide/concepts/server-engine/ target=_blank rel=noopener>Nitro</a> 提供支持，它具有以下幾個特點：</p><ul><li>跨平台支持，支持 Node.js 與瀏覽器等。</li><li>Serverless 支持。</li><li>API 路由，使用 <a class=link href=https://github.com/unjs/h3 target=_blank rel=noopener>unjs/h3</a>。</li><li>自動程式碼拆分 (code-splitting) 與異步加載 chunk (async-loaded chunks)。</li><li>混合渲染模式，供靜態 (static)與無伺服器 (serverless) 網站。</li><li>開發伺服器上的 HMR (hot module reloading)。</li></ul><p>簡單來說，<a class=link href=https://nuxt.com/docs/guide/concepts/server-engine/ target=_blank rel=noopener>Nitro</a> 已經是 <a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 包含的全新伺服器引擎，無需再進行配置。<a class=link href=https://nuxt.com/docs/guide/concepts/server-engine/ target=_blank rel=noopener>Nitro</a> 除了支援 SPA、建立靜態的網站，甚至能在後端打 API 時直接調用相關函數，從而降低 API Request，整體來說是非常強大的伺服器引擎。</p><h4 id=nuxt-3-渲染模式>Nuxt 3 渲染模式</h4><p><a class=link href=https://nuxt.com/ target=_blank rel=noopener>Nuxt 3</a> 目前支援兩種渲染模式，<code>Client-side Only Rendering</code> 與 <code>Universal Rendering</code>。之後將會推出更先近的渲染模式，<code>混合渲染 (Hybrid Rendering)</code> 與<code>邊緣渲染 (Edge-Side Rendering)</code>。</p><ul><li>Client-side Only Rendering</li></ul><p>Nuxt 3 設定為該模式，如同單純使用 Vue 3 建置出的 SPA，瀏覽器下載並載入完 Vue 程式碼後，<code>渲染 HTML 的所有動作皆在客戶端執行</code>，也就是客戶端渲染 CSR。</p><ul><li>Universal Rendering</li></ul><p>Universal Rendering 是 <code>Nuxt 3 預設的渲染模式</code>，在這個模式之下，無論頁面是預先產生並緩存還是動態渲染，Nuxt 都會在伺服器環境中執行 Vue 程式碼，並渲染 HTML，也就是如同 SSR，伺服器會向瀏覽器返回一個完整呈現的 HTML 頁面。當瀏覽器完整呈現的頁面出現後，也會開始載入 Vue 程式碼，以因應後續的動態頁面與路由跳轉等，即轉換為 SPA 開始由客戶端進行渲染。也就是說 Nuxt 3 的 <code>Universal Rendering</code> 即是指 <code>SSR + SPA</code>。</p><ul><li>混合渲染 (Hybrid Rendering)</li></ul><p>我們在使用 Vue 開發 SPA 網站時，通常是會設置路由 (Route) 讓網頁能夠到達不同的頁面再來請求資料，此為 CSR。在使用 Nuxt 開發時能讓能網站擁有 SSR + SPA 的 Universal Rendering 渲染方式，除此之外，Nuxt 3 還提供了一種更先進的渲染模式——<code>混合渲染 (Hybrid Rendering)</code>，可以<code>為每個路由設置不同的渲染與緩存的規則</code>，讓部分頁面使用 CSR 在客戶端進行渲染，另一部分使用 SSR 在伺服器端進行渲染。</p><ul><li>邊緣渲染 (Edge-Side Rendering)</li></ul><p>Nitro 為 Nuxt 3 提供支持的全新伺服器端渲染引擎，它為 Node.js、Deno、Worker 等提供跨平台的支持，讓 Nuxt <code>可以在 CDN Edge Workers 進行渲染</code>，故稱為<code>邊緣渲染 (Edge-Side Rendering)</code>，能有效分擔在伺服器端渲染時的資源負荷，將其提升到另一個層次，從而減少網路延遲及成本。</p><h4 id=nuxt-3-的建構工具>Nuxt 3 的建構工具</h4><p>Nuxt 3 預設的建構工具如下：</p><ul><li>預設使用 <a class=link href=https://vitejs.dev/ target=_blank rel=noopener>Vite</a> 也可以切換成 <a class=link href=https://webpack.js.org/ target=_blank rel=noopener>webpack</a></li><li><a class=link href=https://rollupjs.org/ target=_blank rel=noopener>Rollup</a></li><li><a class=link href=https://postcss.org/ target=_blank rel=noopener>PostCSS</a></li><li><a class=link href=https://esbuild.github.io/ target=_blank rel=noopener>esbuild</a></li></ul><p>Nuxt 3 已經幫我們配置好一堆設定啦，真的是開箱即用，而且 Nuxt 也支援 TypeScript。如果說真的要調整配置，也可以再 <code>nuxt.config</code> 中進行調整，非常方便貼心。</p><hr><h2 id=使用-nuxi-建立第一個專案>使用 nuxi 建立第一個專案</h2><h3 id=線上玩玩看>線上玩玩看</h3><p>如果你還在觀望或是從隔壁棚過來的，還不想安裝相關工具與環境，那麼可以點擊下面其一連結，在 StackBlitza 或 CodeSandbox 的線上編輯器環境稍微玩玩，直接線上體驗 Nuxt 3。</p><ul><li><a class=link href=https://stackblitz.com/github/nuxt/starter/tree/v3-stackblitz target=_blank rel=noopener>Play on StackBlitz</a></li><li><a class=link href=https://codesandbox.io/p/github/nuxt/starter/v3-codesandbox target=_blank rel=noopener>Play on CodeSandbox</a></li></ul><h3 id=開始建立第一個專案>開始建立第一個專案</h3><h4 id=先決條件>先決條件</h4><p>開始之前，依照 Nuxt 3 官網的<a class=link href=https://nuxt.com/docs/getting-started/installation target=_blank rel=noopener>起手式</a>我們有幾個項目需要做一下檢查，我們這裡僅先注意一下 Node.js 的版本，建議使用目前<a class=link href=https://nodejs.org/zh-tw/download/ target=_blank rel=noopener>最新 LTS 版本</a> <code>v16.17.0</code> (包含 NPM v8.15.0)。</p><h4 id=使用-nuxi-建立-nuxt-3-專案>使用 nuxi 建立 Nuxt 3 專案</h4><p><a class=link href=https://www.npmjs.com/package/nuxi target=_blank rel=noopener>nuxi</a> 全名為 <strong>Nuxt Command Line Interface</strong>，是由 Nuxt 提供開發的標準工具，Nuxt CLI 就像是 Vue CLI 可以建立 Vue 專案，我們當然也就可以使用 Nuxt CLI 來建立 Nuxt 的專案。</p><p>首先，打開終端機 (Terminal)，將目錄切換至自己習慣的工作區，接著輸入如下的 nuxi 提供指令並執行，來初始化建立一個 Nuxt 3 專案。在此，我們的專案名為 <code>nuxt-app</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi init nuxt-app
</span></span></code></pre></td></tr></table></div></div><p>如下圖，npx 會詢問你是否安裝最新版本的套件 <code>nuxi@3.0.0-rc.10</code> 輸入 <code>y</code> 即可。</p><p><img src=https://live.staticflickr.com/65535/52616697991_767a632430_o.gif max-width=100% max-height=100% class=gallery-image></p><p>執行完指令後直到出現如下提示，代表專案已經初始建立成功，完成後可以發現目前目錄下多了一個名為 <code>nuxt-app</code> 的資料夾，這個資料夾也就是 Nuxt 3 專案的根目錄。</p><p><img src=https://live.staticflickr.com/65535/52616964239_b438581d8d_o.png max-width=100% max-height=100% class=gallery-image></p><p>接下來，我們可以進入專案目錄 <code>nuxt-app</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> nuxt-app
</span></span></code></pre></td></tr></table></div></div><p>在 <code>nuxt-app</code> 專案目錄下可以看到熟悉的 <code>package.json</code>，我們就可以開始安裝 Nuxt 3 專案的相關依賴套件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn</span>
</span></span></code></pre></td></tr></table></div></div><p>Nuxt CLI 如同 Vue CLI 已經在建立專案時幫我們初始完成許多事情，再安裝完相關依賴套件後輸入下列指令，我們就可以在開發環境下啟動 Nuxt 了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run dev -- -o
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run dev -- -o</span>
</span></span></code></pre></td></tr></table></div></div><p>如果沒有意外，可以看到 Nitro 幫我們啟動了 Nuxt 3 的服務。</p><p><img src=https://live.staticflickr.com/65535/52617186213_f7a11b0b5a_o.png max-width=100% max-height=100% class=gallery-image></p><p>根據提示，我們可以在瀏覽器輸入網址 <a class=link href=http://localhost:3000/ target=_blank rel=noopener>http://localhost:3000/</a> 看看服務是否正常運作。</p><p>如果看到如下圖的歡迎畫面，恭喜你！我們已經成功建立第一個 Nuxt 3 專案囉！</p><p><img src=https://live.staticflickr.com/65535/52616964264_faa521ed78_o.png max-width=100% max-height=100% class=gallery-image></p><p>現在你可以嘗試打開在專案目錄下的 <code>app.vue</code> 檔案之中，<code>app.vue</code> 是我們 Nuxt 專案的進入點，它的內容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現它與 Vue 3 的單一元件檔 (Single File Component, SFC) 相比，好像少了點什麼，怎麼有用了 <code>&lt;NuxtWelcome /></code> 卻沒看見在哪邊 import 的呢？</p><p>其實呢，<code>&lt;NuxtWelcome /></code> 這個元件就是我們前面瀏覽器看到的歡迎畫面，是 Nuxt 框架自帶的一個元件，而且 Nuxt 自動導入元件的更是其特色之一，後面的系列我們會再提到<strong>自動導入 (Auto Imports)</strong>。</p><p>在這裡直接移除 <code>&lt;NuxtWelcome /></code> 就可以了，我們將 app.vue 調整如下，並保存檔案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span> <span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看見因為 Nuxt 預設 Vite 建構並支援 <a class=link href=https://vitejs.dev/guide/features.html#hot-module-replacement target=_blank rel=noopener>HMR</a> (Hot Module Replacement)，我們可以在瀏覽器快速的看見修改後的結果。</p><p><img src=https://live.staticflickr.com/65535/52616698026_1bf03d908a_o.png max-width=100% max-height=100% class=gallery-image></p><p>至此，大家就可以先簡單的玩玩 Nuxt 3，接下來我將補充一些 nuxi 的指令與參數簡介。</p><h3 id=nuxt-cli-常用指令>Nuxt CLI 常用指令</h3><p>以下將簡單介紹一些常用的指令，若您在專案目錄下記得使用 <code>npx</code> 來執行 <code>nuxi</code>。</p><p>另外在此提醒，下面所列的指令<code>部分參數會進行省略</code>，若有興趣翻翻完整的指令與參數說明，可以參考 <a class=link href=https://v3.nuxtjs.org/api/commands/add target=_blank rel=noopener>Nuxt 3 官方文件</a>。</p><h4 id=nuxi-init>nuxi init</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi init<span class=p>|</span>create <span class=o>[</span>dir<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>這個 <code>nuxi init</code> 指令是用來初始化一個 Nuxt 專案，等同 <code>nuxi create</code> 指令，<code>dir</code> 你可以填字串作為專案與資料夾名稱，也可以填寫完整路徑來建立專案目錄。</p><h4 id=nuxi-dev>nuxi dev</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi dev <span class=o>[</span>--open, -o<span class=o>]</span> <span class=o>[</span>--port, -p<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們在本地端進行開發時，需要運行開發環境，當我們執行 <code>npm run dev -- -o</code> 時，依據 <code>package.json</code> 中的 scripts 所列，其實就是在執行 <code>nuxi dev -o</code>，其中的 <code>-o</code> 表示<strong>服務啟動後開啟瀏覽器</strong>。</p><p>如果啟動服務發現 Port 衝突，你也可以透過 <code>-p</code> 來將預設的監聽的 Port: 3000 調整為其他數值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxi dev -p <span class=m>3001</span>
</span></span><span class=line><span class=cl><span class=c1># 或</span>
</span></span><span class=line><span class=cl><span class=c1># npm run dev -- -o -p 3001</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=nuxi-cleanup>nuxi cleanup</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi clean<span class=p>|</span>cleanup
</span></span></code></pre></td></tr></table></div></div><p><code>nuxi cleanup</code> 等同 <code>nuxi clean</code> 指令，用來刪除 Nuxt 自動產生的檔案和緩存包括：</p><ul><li>.nuxt</li><li>.output</li><li>node_modules/.vite</li><li>node_modules/.cache</li></ul><h4 id=nuxi-upgrade>nuxi upgrade</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi upgrade <span class=o>[</span>--force<span class=p>|</span>-f<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>這個指令可以用來將目前專案的 Nuxt 3 升級至最新的版本，如果有一些可能行為調整或不相容的情況，可以再依據實際情境搭配 <code>-f</code> 參數來強制更新。</p><p>如下圖，只要一行指令 <code>npx nuxi upgrade</code> 就可以將專案版本由 <code>3.0.0-rc.9</code> 升級至 <code>3.0.0-rc.10</code>，在 RC 階段或之後想定期升級版本來說非常好用，但也請記得<code>升級前可以先看一下官方的 Changelog</code>。</p><p><img src=https://live.staticflickr.com/65535/52617186283_00309ed597_o.png max-width=100% max-height=100% class=gallery-image></p><hr><h2 id=nuxt-3--typescript--eslint--prettier-環境建置>Nuxt 3 + TypeScript + ESLint + Prettier 環境建置</h2><p>在我們使用完 Nuxt CLI 建立完專案後，其實就可以開始進行專案的開發，但是呢，相信不少人對於程式碼的排版都有自己的風格，不同人的 Coding Style 肯定也都不一樣，然而在團隊協作需要標準或為了整體一致且美觀下，Linter 就是你的好幫手，此外，TypeScript 在 Nuxt 3 已經有內建支援，我也建議及推薦使用 TypeScript，接下來分享我自己在使用 Nuxt 3 開發時的 Linter 環境配置，包含了 <code>TypeScript</code>、<code>ESLint</code> 與 <code>Prettier</code>。</p><h3 id=typescript-類型檢查>TypeScript 類型檢查</h3><p><img src=https://live.staticflickr.com/65535/52616964289_0dbc29572e_o.png max-width=100% max-height=100% class=gallery-image></p><p>Nuxt 3 已經有內建支援 TypeScript，一些 TypeScript 設定都可以在專案根目錄下配置 <code>tsconfig.json</code>，例如，在開發過程中針對 TypeScript 我會在開發環境下啟動類型檢查，可以參考以下進行配置。</p><h4 id=step-1-安裝-vs-code-插件>Step 1. 安裝 VS Code 插件</h4><p>首先，推薦大家安裝下列兩個 VS Code 插件：</p><ul><li><a class=link href="https://marketplace.visualstudio.com/items?itemName=Vue.volar" target=_blank rel=noopener>Vue Language Features (Volar)</a>：寫 Vue 3 強力推薦必裝的插件，包含了上色、語法提示、編輯器快速分割等強大功能，而且也是 Nuxt 3 推薦的編輯器插件。</li><li><a class=link href="https://marketplace.visualstudio.com/items?itemName=Vue.vscode-typescript-vue-plugin" target=_blank rel=noopener>TypeScript Vue Plugin (Volar)</a>：Vue 的 TypeScript 插件。</li></ul><h4 id=step-2-安裝-vue-類型檢查套件>Step 2. 安裝 Vue 類型檢查套件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D vue-tsc typescript
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D vue-tsc typescript</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-調整-nuxtconfigts-設定>Step 3. 調整 nuxt.config.ts 設定</h4><p>根據 nuxt3 官方文件<a class=link href=https://nuxt.com/docs/guide/concepts/typescript target=_blank rel=noopener>說明</a>，我們可以在 <code>nuxt.config.ts</code> 中，設置 <code>typescript.typeCheck: true</code> 來讓開發時期能執行類型檢查。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>typescript</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>typeCheck</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-4-重新啟動開發環境服務>Step 4. 重新啟動開發環境服務</h4><p>我們重新執行 <code>npm run dev -- -o</code> 來重啟開發環境的服務，這樣就配置完成囉！</p><h4 id=看看效果>看看效果</h4><p>如果我們在 <code>app.vue</code> 寫了以下程式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;ts&#34;</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>year</span><span class=o>:</span> <span class=nx>number</span> <span class=o>=</span> <span class=s1>&#39;2022&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>year</span><span class=si>}</span><span class=sb> iThome 鐵人賽`</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現終端機 (Terminal) 就<code>指出了一個錯誤的類型指派</code>，並告知你有錯誤程式碼的位置。</p><p><img src=https://live.staticflickr.com/65535/52616964299_7ee542dbc3_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=eslint-設置-linter>ESLint 設置 Linter</h3><p><img src=https://live.staticflickr.com/65535/52616698096_7b89a76f54_o.png max-width=100% max-height=100% class=gallery-image></p><p>ESLint 是一個 <code>JavaScript Linter</code>，它用來檢查 JavaScript Coding Style 的工具，主要能幫你<code>分析並找到語法錯誤</code>，也能用來<code>統一風格</code>，例如：縮排空白數、字串要用單引號或雙引號等，提醒你刪掉多餘程式碼或遵照最佳的實踐方式，確保程式碼能具有一定的水準。在團隊協作下 ESLint 更能讓大家撰寫程式碼時遵照規則，確保程式碼品質。ESLint 除了提供你可以使用大公司如 Google、Airbnb 等的規則配置來作為檢查基準，也可以客製自訂出自己喜好或團隊共識的規則來分析與提醒你校正語法。</p><h4 id=step-1-安裝-eslint-套件>Step 1. 安裝 ESLint 套件</h4><p>現在我們至 Nuxt 專根目錄下，開始安裝 ESLint 相關套件，當然，你也可以挑自己喜歡的進行配置，不過在這裡選擇以 Nuxt 3 官方提供的 ESLint 設定來做標準配置，並添加支援 Vue 3 的 ESLint 設定。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D eslint @nuxtjs/eslint-config-typescript eslint-plugin-vue
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D eslint @nuxtjs/eslint-config-typescript eslint-plugin-vue</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-配置-eslint-設定檔>Step 2. 配置 ESLint 設定檔</h4><p>安裝完所需套件後，接下來我們就可以來設定 ESLint，我們在專案根目錄下建立 <code>.eslintrc.js</code> 檔案，內容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>env</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>browser</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>es2021</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=kr>extends</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;@nuxtjs/eslint-config-typescript&#39;</span><span class=p>,</span> <span class=s1>&#39;plugin:vue/vue3-recommended&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>parserOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ecmaVersion</span><span class=o>:</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>sourceType</span><span class=o>:</span> <span class=s1>&#39;module&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nx>rules</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=nx>overrides</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>files</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/pages/**/*.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/layouts/**/*.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/app.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/error.{js,ts,vue}&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>rules</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;vue/multi-word-component-names&#39;</span><span class=o>:</span> <span class=s1>&#39;off&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在我們建立的 <code>.eslintrc.js</code> 檔案中 <code>extends</code> 可以是一個陣列，主要是來放置<code>擴展</code> ESLint 的規則的配置，這裡稍微注意一下順序如下：</p><ol><li><p><strong>@nuxtjs/eslint-config-typescript</strong>：對應 <a class=link href=https://www.npmjs.com/package/@nuxtjs/eslint-config-typescript target=_blank rel=noopener>@nuxtjs/eslint-config-typescript</a> 套件，由 Nuxt 官方提供用於 Nuxt 的 ESLint 規則配置。如果你不是使用 TypeScript 可以使用 <a class=link href=https://www.npmjs.com/package/@nuxtjs/eslint-config target=_blank rel=noopener>@nuxtjs/eslint-config</a>。</p></li><li><p><strong>plugin:vue/vue3-recommended</strong>：對應 <a class=link href=https://www.npmjs.com/package/eslint-plugin-vue target=_blank rel=noopener>eslint-plugin-vue</a> 套件，由 Vue.js 官方提供的 ESLint <a class=link href=https://github.com/vuejs/eslint-plugin-vue target=_blank rel=noopener>插件</a>，包含了能配合 Vue SFC 語法及特性的規則，也可以參考<a class=link href=https://eslint.vuejs.org/user-guide/#bundle-configurations target=_blank rel=noopener>官方文件</a>，依據需求稍作調整。</p></li></ol><p>將特定目錄下的檔案關閉 <code>vue/multi-word-component-names</code> 規則，以此來因應 nuxt 的開發避免提示錯誤。</p><blockquote><p>因為目前 <a class=link href=https://www.npmjs.com/package/@nuxtjs/eslint-config-typescript target=_blank rel=noopener>@nuxtjs/eslint-config-typescript</a> 是基於 <a class=link href=https://www.npmjs.com/package/@nuxtjs/eslint-config target=_blank rel=noopener>@nuxtjs/eslint-config</a> 來擴展 TypeScript 的設定，而且 <a class=link href=https://www.npmjs.com/package/@nuxtjs/eslint-config target=_blank rel=noopener>@nuxtjs/eslint-config</a> 包含的是 Vue 2 的 ESLint 設定，所以我們需要再額外安裝 <a class=link href=https://www.npmjs.com/package/eslint-plugin-vue target=_blank rel=noopener>eslint-plugin-vue</a> 來擴展 Vue 3 規則配置，並覆寫 <strong>vue/multi-word-component-names</strong> 規則。</p></blockquote><h4 id=用-eslint-來嘗試檢查>用 ESLint 來嘗試檢查</h4><p>首先，我們編輯 <code>app.vue</code> 檔案內容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;ts&#34;</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>year</span><span class=o>:</span> <span class=nx>number</span> <span class=o>=</span> <span class=mi>2022</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>year</span><span class=si>}</span><span class=sb> iThome 鐵人賽`</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們執行下列指令來使用 eslint 檢查 <code>app.vue</code> 這個檔案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx eslint -- app.vue
</span></span></code></pre></td></tr></table></div></div><p>可以看到下圖，ESLint 指出 <code>app.vue</code> 的問題，在第 9 行中的 <code>title</code> 這個變數已經宣告了卻沒有被使用。</p><p>這個錯誤訊息正是依據上面我們的 ESLint 配置所被檢視出來的，在 ESLint 規則定義好後，也有分成錯誤 (Error) 與警告 (Warning)，我們可以再依據 ESLint 給予的提示進行調整與修正。</p><p><img src=https://live.staticflickr.com/65535/52616188177_46465e3ffe_o.png max-width=100% max-height=100% class=gallery-image></p><p>我們嘗試修正一下 <code>app.vue</code> 這個檔案，在 template 中使用 title 這個變數。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>title</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;ts&#34;</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>year</span><span class=o>:</span> <span class=nx>number</span> <span class=o>=</span> <span class=mi>2022</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>year</span><span class=si>}</span><span class=sb> iThome 鐵人賽`</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>再一次執行 <code>npx eslint -- app.vue</code>，就會發現沒有錯誤訊息產生囉！</p><h3 id=在-packagejson-設置腳本>在 package.json 設置腳本</h3><p>我們除了逐個檔案做檢查，也可以設置腳本來檢查整個專案目錄下的程式碼。</p><p>在 <code>package.json</code> 的 scripts 腳本中，我們可以新增一個指令 <code>"lint": "eslint --ext .ts,.js,.vue ."</code>，這樣一來我們就可以使用如下指令來檢查專案目錄下的所有包含 <strong>.ts</strong>、<strong>.js</strong>、<strong>.vue</strong> 副檔名的檔案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run lint
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run lint</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=在-vs-code-中顯示-eslint-錯誤或警告>在 VS Code 中顯示 ESLint 錯誤或警告</h3><p>推薦大家安裝 VS Code 的 ESLint 插件：</p><ul><li><a class=link href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint" target=_blank rel=noopener>ESLint</a>：讓你在編輯器開發時就能有指令檢查，更可以做到全域或特定工作區開啟儲存或快捷鍵自動修正程式碼等設置。</li></ul><blockquote><p>安裝完畢後，建議重啟 VS Code 來重新載入相關設定。</p></blockquote><p>現在，你會發現在 VS Code 中編輯程式的過程中，如果有 ESLint 檢查到的錯誤或建議，就會出現<code>紅色或黃色的波浪底線</code>，當滑鼠指標移動至波浪底線處，就會發現有個小視窗提示你錯誤或警告的原因是什麼。</p><p><img src=https://live.staticflickr.com/65535/52617186373_67101210bd_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=在-vs-code-中自動修正-eslint-錯誤或警告>在 VS Code 中自動修正 ESLint 錯誤或警告</h3><p>在某些情況，ESLint 可以幫助你做自動修正程式碼，甚至在存擋時將錯誤部分直接進行修正。</p><h4 id=手動快速修正>手動快速修正</h4><p>我們可以在編輯器將滑鼠指標移動至波浪底線點擊「<strong>快速修正 (Quick Fix)&mldr;</strong>」，你也可以使用編輯器建議的快捷鍵 <strong>Command + . (macOS)</strong>，此時就能選擇要修復或關閉略過錯誤原因；這裡我們選擇「<strong>Fix all auto-fixable problems</strong>」，來修復所有可能可以被自動修復的問題。</p><p><img src=https://live.staticflickr.com/65535/52617134545_8b88fdc93b_o.gif max-width=100% max-height=100% class=gallery-image></p><h4 id=存擋自動修正>存擋自動修正</h4><p>除了手動快速修正外，你也可以透過添加 VS Code 的設定檔，如專案目錄下新增 <code>.vscode/settings.json</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;editor.formatOnSave&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;prettier.semi&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;files.trimTrailingWhitespace&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;editor.defaultFormatter&#34;</span><span class=p>:</span> <span class=s2>&#34;esbenp.prettier-vscode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;editor.codeActionsOnSave&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;source.fixAll.eslint&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;eslint.format.enable&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;eslint.validate&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;javascript&#34;</span><span class=p>,</span> <span class=s2>&#34;javascriptreact&#34;</span><span class=p>,</span> <span class=s2>&#34;html&#34;</span><span class=p>,</span> <span class=s2>&#34;vue&#34;</span><span class=p>,</span> <span class=s2>&#34;typescript&#34;</span><span class=p>,</span> <span class=s2>&#34;typescriptreact&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;eslint.enable&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們編輯完程式碼，並保存檔案或快捷鍵存擋 <strong>Command + S (macOS)</strong>，就會觸發 ESLint 自動修復囉。</p><p><img src=https://live.staticflickr.com/65535/52616698136_f967028caa_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=prettier-設置>Prettier 設置</h3><p><img src=https://live.staticflickr.com/65535/52617186383_1c8d988fe4_o.png max-width=100% max-height=100% class=gallery-image></p><p>Prettier 是程式碼格式化的工具，也可以與 ESLint 進行搭配，ESLint 與 Prettier 就能各司其職將 JaveScript 與 Vue 等檔案依照配置進行檢查與排版。</p><h4 id=step-1-安裝-prettier-套件>Step 1. 安裝 Prettier 套件</h4><p>我們直接安裝 prettier、eslint-config-prettier 與 eslint-plugin-prettier 三個套件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D prettier eslint-config-prettier eslint-plugin-prettier
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D prettier eslint-config-prettier eslint-plugin-prettier</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-配置-prettier-設定檔案>Step 2. 配置 Prettier 設定檔案</h4><p>我們在專案根目錄下建立 <code>.prettierrc.js</code> 檔案，內容如下，這些配置都可以自己設定來配合 ESLint，更多選項或說明可以參考 <a class=link href=https://prettier.io/docs/en/options.html target=_blank rel=noopener>Prettier 官方說明文件</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>printWidth</span><span class=o>:</span> <span class=mi>120</span><span class=p>,</span> <span class=c1>// 每行文字數量達 100 字元就換到新的一行
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>semi</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=c1>// 每個語句的結尾不需要分號
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>singleQuote</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=c1>// 字串使用單引號，而不是雙引號
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>trailingComma</span><span class=o>:</span> <span class=s2>&#34;none&#34;</span><span class=p>,</span> <span class=c1>// 如 Object、Array 內的元素不需要尾隨逗號
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>endOfLine</span><span class=o>:</span> <span class=s2>&#34;auto&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>vueIndentScriptAndStyle</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-配置-eslint-設定檔案>Step 3. 配置 ESLint 設定檔案</h4><p>我們在安裝時多裝了兩個 ESLint 相關套件，分別為 <a class=link href=https://github.com/prettier/eslint-config-prettier target=_blank rel=noopener>eslint-config-prettier</a> 及 <a class=link href=https://www.npmjs.com/package/eslint-plugin-prettier target=_blank rel=noopener>eslint-plugin-prettier</a>。</p><p>對此我們需要將其添加至 ESLint 的 <code>.eslintrc.js</code> 設定檔內，在 <code>extends</code> 添加字串 <code>prettier</code> 表示使用 <a class=link href=https://github.com/prettier/eslint-config-prettier target=_blank rel=noopener>eslint-config-prettier</a> 擴充配置，主要用來防止 Prettier 排版與 ESLint 發生衝突，讓其可以用來禁用 ESLint 的格式化；接著在 <code>plugins</code> 中添加 <code>prettier</code> 字串表示使用 <a class=link href=https://www.npmjs.com/package/eslint-plugin-prettier target=_blank rel=noopener>eslint-plugin-prettier</a> 套件擴充，讓 ESLint 可以提示我們格式有錯誤的地方。</p><p>為了讓 Prettier 與 ESLint 有更好的搭配，在 <code>rules</code> 的參數中記得添加 <code>'prettier/prettier': 'error'</code> 讓 ESLint 可以提示 Prettier 的排版異常提示供我們做修正，至此 <code>.eslintrc.js</code> 設定檔應該會如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>env</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>browser</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>es2021</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=kr>extends</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;@nuxtjs/eslint-config-typescript&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;plugin:vue/vue3-recommended&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;prettier&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>parserOptions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ecmaVersion</span><span class=o>:</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>sourceType</span><span class=o>:</span> <span class=s1>&#39;module&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;prettier&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>rules</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;prettier/prettier&#39;</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>overrides</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>files</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/pages/**/*.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/layouts/**/*.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/app.{js,ts,vue}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;**/error.{js,ts,vue}&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>rules</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;vue/multi-word-component-names&#39;</span><span class=o>:</span> <span class=s1>&#39;off&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-4-安裝-vs-code-的-prettier-插件>Step 4. 安裝 VS Code 的 Prettier 插件</h4><ul><li><a class=link href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target=_blank rel=noopener>Prettier - Code formatter</a>：提供我們做程式碼的格式化，最重要的是來協助我們自動載入 <code>.prettierrc.js</code> 配置。</li></ul><blockquote><p>安裝完畢後，建議重啟 VS Code 來重新載入相關設定。</p></blockquote><p>我們完成了 TypeScript 與 Linter 的配置，雖然配置有些繁瑣，但寫程式的風格有個標準及規則依循，肯定能協助你寫出令人讚嘆的完美的程式碼。</p><hr><h2 id=使用-tailwind-css>使用 Tailwind CSS</h2><p><img src=https://live.staticflickr.com/65535/52617186403_1fa6ef95d7_o.png max-width=100% max-height=100% class=gallery-image></p><p>為了後續範例程式在頁面呈現上能有比較好看的樣式，原先有想過使用 UI 框架或純寫 CSS，但是總覺得好像不夠潮，所以呢，我決定帶入近年滿熱門的 CSS 框架 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a>，在本篇文章我就不再多花篇幅介紹 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind</a> 的語法及指令等，主要針對 Nuxt 3 如何導入 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a> 至專案內使用。</p><p>其實有稍微糾結一下要不要使用 <a class=link href=https://css.master.co/tw target=_blank rel=noopener>Master CSS</a>，雖然最後決定先緩緩，但我認為它非常有淺力成為這類框架的霸主，大家有空也可以支持一下或玩玩這個由臺灣團隊開發的 CSS 框架哦！</p><p><a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a> 是近年滿熱門的 <code>Utility-First CSS</code> 框架，曾掀起一番論戰說 Class 不是讓你這樣用的之類的批評及缺點，但如果你深入暸解它後，確實不可否認它能為你帶來更好的生產效率等諸多優點。</p><p>接下來，我會分別介紹兩種導入 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a> 方式，分別為 <strong>Nuxt Community 釋出的 Tailwind CSS 整合模組</strong> 及 <strong>Tailwind CSS 官方指引步驟</strong>，以下的 <strong>A</strong> 或 <strong>B</strong> 兩種導入方式，大家只要<code>擇一</code>就可以了。</p><h3 id=使用-nuxt-tailwind-模組>使用 Nuxt Tailwind 模組</h3><h4 id=step-1-安裝相關套件>Step 1. 安裝相關套件</h4><p>首先安裝 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D @nuxtjs/tailwindcss
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D @nuxtjs/tailwindcss</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-添加模組至-nuxtconfigts>Step 2. 添加模組至 nuxt.config.ts</h4><p>打開 <code>./nuxt.config.ts</code> 將 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 模組添加至 <code>modules</code> 設定參數中，完成後看起來會像下面這樣。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// https://v3.nuxtjs.org/api/configuration/nuxt.config
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=kr>module</span><span class=nx>s</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;@nuxtjs/tailwindcss&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>typescript</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>typeCheck</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-重啟-nuxt-服務>Step 3. 重啟 Nuxt 服務</h4><p>重新啟動我們的 Nuxt 服務。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run dev -- -o
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run dev -- -o</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 只需要兩個步驟就完成了 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a> 的配置，這個模組已經包含手動安裝時需要建立的 <a class=link href=https://tailwindcss.com/ target=_blank rel=noopener>Tailwind CSS</a> 指令 <code>tailwindcss.css</code> 需要的全域設定與 PostCSS 參數選項，同時也預設了 <code>tailwind.config.js</code> 的相關 <strong>content</strong> 目錄路徑，詳細可以參考 <a class=link href=https://github.com/nuxt-modules/tailwindcss target=_blank rel=noopener>Nuxt Tailwind</a>。</p><h4 id=擴充或覆寫-nuxtjstailwindcss-配置>擴充或覆寫 @nuxtjs/tailwindcss 配置</h4><blockquote><p>如果你沒有特別需要擴充或覆寫設定可以跳過這一段。</p></blockquote><p>專案內若使用 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 模組，這兩個 <code>tailwind.css</code> 與 <code>tailwind.config.js</code> 檔案其實模組已經有預設，不需要手動建立，<code>tailwind.css</code> 對應模組內的 <strong>tailwind.css</strong> 可以參考專案檔案內容 <a class=link href=https://github.com/nuxt-modules/tailwindcss/blob/main/src/runtime/tailwind.css target=_blank rel=noopener>tailwind.css</a>，<code>tailwind.config.js</code> 則是透過模組動態新增配置。</p><p>倘若想要修改也可以透過建立設定檔案來新增或覆寫預設定，例如在專案下分別建立 <code>tailwind.css</code> 與 <code>tailwind.config.js</code> 兩個檔案：</p><ul><li>tailwind.css</li></ul><p>專案目錄下若存在路徑檔名一致的 <code>./assets/css/tailwind.css</code> 檔案，<a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 就會以這個檔案取代模組內預設的 <code>tailwind.css</code> 檔案。</p><p><code>tailwind.css</code> 預設內容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>components</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>utilities</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果有成功覆蓋配置，在重啟 Nuxt 3 服務時，Terminal 會提示下列字串，表示使用了自訂的 <code>tailwind.css</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Using Tailwind CSS from ~/assets/css/tailwind.css
</span></span></code></pre></td></tr></table></div></div><ul><li>tailwind.config.js</li></ul><p>專案目錄下若存在 <code>tailwind.config.js</code> 檔案就會以新的配置拓展或覆寫 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 預設的 <code>tailwind.config</code>。</p><p>例如，我們想拓展或覆寫 content 的配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/** @type {import(&#39;tailwindcss&#39;).Config} */</span>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>content</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./components/**/*.{vue,js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./layouts/**/*.vue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./pages/**/*.vue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./composables/**/*.{js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./plugins/**/*.{js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./app.{js,ts,vue}&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>extend</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=tailwind-css-官方指引步驟>Tailwind CSS 官方指引步驟</h3><blockquote><p>如果你已經使用了 <a class=link href=https://www.npmjs.com/package/@nuxtjs/tailwindcss target=_blank rel=noopener>@nuxtjs/tailwindcss</a> 進行配置，則可以跳過這一段。</p></blockquote><h4 id=step-1-安裝相關套件-1>Step 1. 安裝相關套件</h4><p>首先進入我們的 Nuxt 專案目錄，並安裝 Tailwind CSS 會使用到的一些相關套件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D tailwindcss postcss@latest postcss-custom-properties@latest autoprefixer@latest
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D tailwindcss postcss@latest postcss-custom-properties@latest autoprefixer@latest</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-建立-tailwindconfigjs>Step 2. 建立 tailwind.config.js</h4><p>安裝完套件後，可以執行下列指令進行初始化，完成後會在專案根目錄下產生一個名為 <code>tailwind.config.js</code> 的 Tailwind CSS 設定檔。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx tailwindcss init
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-調整-tailwindconfigjs>Step 3. 調整 tailwind.config.js</h4><p>打開剛剛產生的設定檔 <code>tailwind.config.js</code>，在配置中的 <code>content</code> 陣列添加一些路徑，這些路徑皆是跟 Nuxt 有關的資料夾目錄與檔案，完成後檔案內容如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/** @type {import(&#39;tailwindcss&#39;).Config} */</span>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>content</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./components/**/*.{vue,js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./layouts/**/*.vue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./pages/**/*.vue&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./composables/**/*.{js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./plugins/**/*.{js,ts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;./app.{js,ts,vue}&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>extend</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-4-建立-tailwindcss>Step 4. 建立 tailwind.css</h4><p>接著我們在專案建立目錄 <strong>assets</strong> 與子目錄 <strong>css</strong> 用來放置 Tailwind CSS 的自定義指令，我們將其放置在 <strong>tailwind.css</strong> 供後續做使用，<strong>tailwind.css</strong> 的路徑應會是 <code>./assets/css/tailwind.css</code> 檔案內容如下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>components</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>tailwind</span> <span class=nt>utilities</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-5-配置全域共用-css>Step 5. 配置全域共用 CSS</h4><p>上面我們建立好 <strong>tailwind.css</strong> 後，為了讓每個頁面都可以吃得到 Tailwind CSS，我們修改專案根目錄的 <code>nuxt.config.ts</code> 檔案，在 <code>css</code> 參數陣列內新增 <code>tailwind.css</code> 路徑，讓 Nuxt 可以配置全域共用的 CSS，並添加 <code>postcss</code> 選項及我們剛才安裝的套件作為插件，最後 <code>nuxt.config.ts</code> 檔案看起來如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// https://v3.nuxtjs.org/api/configuration/nuxt.config
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>postcss</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>plugins</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;postcss-import&#39;</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;tailwindcss/nesting&#39;</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>      <span class=nx>tailwindcss</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>      <span class=nx>autoprefixer</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>css</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;@/assets/css/tailwind.css&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>typescript</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>typeCheck</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>至此，我們專案目錄檔案如下結構。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxt-app
</span></span><span class=line><span class=cl>├── .nuxt/
</span></span><span class=line><span class=cl>├── assets/
</span></span><span class=line><span class=cl>│   └── css/
</span></span><span class=line><span class=cl>│       └── tailwind.css      // 手動新增的檔案，用於設置 Tailwind CSS 指令並讓全部頁面引用
</span></span><span class=line><span class=cl>├── node_modules/
</span></span><span class=line><span class=cl>├── .eslintrc.js
</span></span><span class=line><span class=cl>├── .gitignore
</span></span><span class=line><span class=cl>├── .prettierrc.js
</span></span><span class=line><span class=cl>├── app.vue
</span></span><span class=line><span class=cl>├── nuxt.config.ts
</span></span><span class=line><span class=cl>├── package-lock.json
</span></span><span class=line><span class=cl>├── package.json
</span></span><span class=line><span class=cl>├── README.md
</span></span><span class=line><span class=cl>├── tailwind.config.js       // Tailwind 初始化指令產生的設定檔
</span></span><span class=line><span class=cl>└── tsconfig.json
</span></span></code></pre></td></tr></table></div></div><h4 id=step-6-重啟-nuxt-服務>Step 6. 重啟 Nuxt 服務</h4><p>重新啟動我們的 Nuxt 服務。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run dev -- -o
</span></span></code></pre></td></tr></table></div></div><h3 id=開始感受-tailwind-css-的魅力>開始感受 Tailwind CSS 的魅力</h3><p>當我們配置完 Tailwind CSS 並重啟 Nuxt 服務後，我們編輯 <code>app.vue</code> 檔案內容，撰寫以下程式碼：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-blue-600&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-900&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>重新瀏覽一次網頁，可以發現排版、顏色、字型都有出現我們設定的效果了。</p><p><img src=https://live.staticflickr.com/65535/52616188202_d650c12b2b_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=自動排序-tailwind-css-的-class>自動排序 Tailwind CSS 的 Class</h3><p><img src=https://live.staticflickr.com/65535/52616964384_7ac2dd7e78_o.jpg max-width=100% max-height=100% class=gallery-image></p><p>當我們在寫 Tailwind CSS 時終究會碰到類型過多，第一眼不確定是否包含某個 class，或者對於順序上有強烈統一的要求，那麼這個 Prettier 的<a class=link href=https://github.com/tailwindlabs/prettier-plugin-tailwindcss target=_blank rel=noopener>插件</a>，<code>prettier-plugin-tailwindcss</code> 插件是 Tailwind 推出的，目的在於可以使用官方推薦的 class 順序，來實現<code>自動排序 class</code> 來做到統一程式碼風格。</p><h3 id=tailwind-x-prettier>Tailwind x Prettier</h3><h4 id=step-1-安裝插件>Step 1. 安裝插件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D prettier-plugin-tailwindcss
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D prettier-plugin-tailwindcss</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>如果你不是照著前面的步驟建置專案，請記得確認已經有安裝 prettier 套件。</p></blockquote><h4 id=step-2-配置設定檔>Step 2. 配置設定檔</h4><p>開啟 <code>.prettierrc.js</code> 檔案，添加 <code>'prettier-plugin-tailwindcss'</code> 至 <code>plugins</code> 陣列中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>plugins</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;prettier-plugin-tailwindcss&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>printWidth</span><span class=o>:</span> <span class=mi>100</span><span class=p>,</span>          <span class=c1>// 每行文字數量達 100 字元就換到新的一行
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>semi</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>              <span class=c1>// 每個語句的結尾不需要分號
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>singleQuote</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>        <span class=c1>// 字串使用單引號，而不是雙引號
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>trailingComma</span><span class=o>:</span> <span class=s1>&#39;none&#39;</span>     <span class=c1>// 如 Object、Array 內的元素不需要尾隨逗號
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-自動修正效果>Step 3. 自動修正效果</h4><p>你可以在編輯器內移至錯誤波浪底線使用「<strong>快速修復 (Quick Fix)&mldr;</strong>」功能，或設置 <code>"editor.codeActionsOnSave"</code> 中 <code>"source.fixAll.eslint": true</code> 來達到保存後自動修正 prettier 引發的 ESLint 錯誤。</p><p><img src=https://live.staticflickr.com/65535/52616698186_25eebdd0f7_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=小結>小結</h3><p>相較於 Tailwind CSS 官方指引的安裝方式，使用 Nuxt Community 幫我們整理好的 <code>@nuxtjs/tailwindcss</code> 模組，可以省去繁瑣的設定步驟，也解決了一些目前 Nuxt 3 專案中，導入 Tailwind CSS 使用 HMR 可能無法自動編譯並重新套用等問題。</p><hr><h2 id=使用-pug>使用 Pug</h2><p><img src=https://live.staticflickr.com/65535/52616698191_9faacb41c6_o.png max-width=100% max-height=100% class=gallery-image></p><p><a class=link href=https://pugjs.org/ target=_blank rel=noopener>pug</a> 為 html 模板語言，可支援撰寫 JS 邏輯。寫法上，省略了 HTML 的開、閉合標籤，能夠大大的提升工程師開發速度，看上去也更為簡潔。</p><p>在本篇文章我依舊不再多花篇幅介紹 <a class=link href=https://pugjs.org/ target=_blank rel=noopener>pug</a> 的語法，主要針對 Nuxt 3 如何導入 <a class=link href=https://pugjs.org/ target=_blank rel=noopener>pug</a> 至專案內使用。</p><p>為了之後開發能少打一點 Code，這邊加入 <a class=link href=https://pugjs.org/ target=_blank rel=noopener>pug</a> 到專案。</p><h3 id=安裝-vite-plugin-pug>安裝 @vite-plugin-pug</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D vite-plugin-pug
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D vite-plugin-pug</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=直接開始體驗-pug>直接開始體驗 Pug</h3><p>直接將原先的 <code>app.vue</code> 改用 pug 語法來撰寫：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;pug&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>div</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>bg</span><span class=o>-</span><span class=nx>white</span><span class=p>.</span><span class=nx>py</span><span class=o>-</span><span class=mi>24</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>flex</span><span class=o>-</span><span class=nx>col</span><span class=p>.</span><span class=nx>items</span><span class=o>-</span><span class=nx>center</span><span class=p>.</span><span class=nx>flex</span>
</span></span><span class=line><span class=cl>    <span class=nx>h1</span><span class=p>.</span><span class=nx>text</span><span class=o>-</span><span class=mi>6</span><span class=nx>xl</span><span class=p>.</span><span class=nx>font</span><span class=o>-</span><span class=nx>semibold</span><span class=p>.</span><span class=nx>text</span><span class=o>-</span><span class=nx>blue</span><span class=o>-</span><span class=mi>600</span> <span class=mi>2022</span> <span class=nx>iThome</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>mt</span><span class=o>-</span><span class=mf>4.</span><span class=nx>text</span><span class=o>-</span><span class=mi>9</span><span class=nx>xl</span><span class=p>.</span><span class=nx>font</span><span class=o>-</span><span class=nx>bold</span><span class=p>.</span><span class=nx>text</span><span class=o>-</span><span class=nx>gray</span><span class=o>-</span><span class=mi>900</span> <span class=nx>鐵人賽</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;ts&#34;</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>year</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=s2>&#34;2022&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這邊推薦一款 VS Code 的套件 - <a class=link href="https://marketplace.visualstudio.com/items?itemName=dbalas.vscode-html2pug" target=_blank rel=noopener>html2pug</a>，將 HTML 反白後點選 VS Code 上方的 <strong>View</strong> > <strong>Command Palette&mldr;</strong>，尋找並執行 <strong>"> html2pug: Transform"</strong>，即可將反白的 HTML 自動轉換成 pug 語法。</p><p>不用管 HTML 的結尾符號，寫起來整個就是舒服阿~~~</p><hr><h2 id=目錄結構與自動載入-auto-imports>目錄結構與自動載入 (Auto Imports)</h2><p>隨著整個專案的開發，目錄與元件勢必也會越來越多，如同 Vue 3 的專案可能會有專門放置元件目錄 components 等，在 Vue 3 我們可能不太需要去在意目錄的名稱，但在 Nuxt 3 的專案下，有一些目錄與名稱其實有一些基本的規定與名稱，只要照著 Nuxt 3 約定好的方式進行開發，就能更好利用 Nuxt 3 幫你完成許多貼心的功能。</p><h3 id=nuxt-3-的目錄結構>Nuxt 3 的目錄結構</h3><p>當我們 Nuxt CLI 建立第一個 Nuxt 3 專案並第一次啟動開發伺服器後，專案目錄結構會長得像這樣：</p><p><img src=https://live.staticflickr.com/65535/52616964404_21aac96f76_o.png max-width=100% max-height=100% class=gallery-image></p><p>如果你是跟著這個系列安裝了 TypeScript、Linter、Tailwind CSS 及 Pug 等套件，那麼專案目錄結構會長得像這樣：</p><p><img src=https://live.staticflickr.com/65535/52616698211_e29e8f9352_o.png max-width=100% max-height=100% class=gallery-image></p><p>雖然我們能依照需求建立檔案及目錄，但 Nuxt 3 在<code>目錄的結構與命名其實有一定的規則與模式</code>，以下針對 Nuxt 3 來講述一下目錄的結構與遵循的方式。</p><h3 id=nuxt-3-預設的目錄結構>Nuxt 3 預設的目錄結構</h3><p>Nuxt 3 框架希望我們可以專注在開發而不是在配置，所以在預設的情況專案的目錄架構已經有一個不錯的結構可以遵循。</p><p>依據<a class=link href=https://nuxt.com/docs/guide/concepts/auto-imports target=_blank rel=noopener>官方文件</a>，一個完整的 Nuxt 3 專案，它的目錄結構如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxt-app/
</span></span><span class=line><span class=cl>├── .nuxt/
</span></span><span class=line><span class=cl>├── .output/
</span></span><span class=line><span class=cl>├── assets/
</span></span><span class=line><span class=cl>├── components/
</span></span><span class=line><span class=cl>├── composables/
</span></span><span class=line><span class=cl>├── content/
</span></span><span class=line><span class=cl>├── layouts/
</span></span><span class=line><span class=cl>├── middleware/
</span></span><span class=line><span class=cl>├── node_modules/
</span></span><span class=line><span class=cl>├── pages/
</span></span><span class=line><span class=cl>├── plugins/
</span></span><span class=line><span class=cl>├── public/
</span></span><span class=line><span class=cl>└── server/
</span></span><span class=line><span class=cl>    ├── api/
</span></span><span class=line><span class=cl>    ├── routes/
</span></span><span class=line><span class=cl>    └── middleware/
</span></span><span class=line><span class=cl>├── .gitignore
</span></span><span class=line><span class=cl>├── .nuxtignore
</span></span><span class=line><span class=cl>├── app.config.ts
</span></span><span class=line><span class=cl>├── app.vue
</span></span><span class=line><span class=cl>├── nuxt.config.ts
</span></span><span class=line><span class=cl>├── package.json
</span></span><span class=line><span class=cl>└── tsconfig.json
</span></span></code></pre></td></tr></table></div></div><h4 id=nuxt-目錄>.nuxt 目錄</h4><p>開發環境下由 Nuxt 產生出 Vue 的網站，.nuxt 目錄是<code>自動產生</code>的，<strong>你不應該任意的調整裡面檔案</strong>。</p><h4 id=output-目錄>.output 目錄</h4><p>當你的網站準備部署至正式環境時，每次編譯建構專案時，皆會<code>自動重新產生</code>這個目錄，<strong>你不應該任意的調整裡面檔案</strong>。</p><h4 id=assets-目錄>assets 目錄</h4><p>顧名思義，這是靜態資源檔案所放置的位置，目錄內通常包含以下類型的檔案：</p><ul><li>CSS 樣式檔案 (CSS、SASS 等&mldr;)</li><li>字型</li><li>圖片</li></ul><p>這些靜態資源，最終在專案編譯建構時，由 Vite 或 webpack 進行編譯打包。</p><h4 id=components-目錄>components 目錄</h4><p>放置 Vue 元件的地方，Nuxt 會自動載入這個目錄中的任何元件。</p><h4 id=composables-目錄>composables 目錄</h4><p>組合式函數放置的目錄，簡單來說可以把常用或通用的功能寫成一個共用的函數或 JS 檔案，放置在這個目錄視為組合式函數，Nuxt 也會自動載入這些組合式函數，讓需要使用的頁面或元件可以直接做使用。</p><h4 id=content-目錄>content 目錄</h4><p>透過使用 <a class=link href=https://content.nuxtjs.org/ target=_blank rel=noopener>Nuxt Content</a>，我們可以在這個目錄下建立 <strong>.md</strong>、<strong>.yml</strong>、<strong>.csv</strong> 和 <strong>.json</strong> 檔案，Nuxt Content 會讀取並解析這些文件並進行渲染，用來建立基於文件的<strong>內容管理系統</strong>(Content Management System，簡稱：CMS)。</p><h4 id=layouts-目錄>layouts 目錄</h4><p>用於放置通用或可能重複使用到的佈局模板，提供程式碼的可重複使用性。</p><h4 id=middleware-目錄>middleware 目錄</h4><p>Nuxt 3 提供了路由中間件的概念，用於導航到下一個頁面之前執行一些程式碼如<strong>權限驗證</strong>&mldr;等。</p><h4 id=node_modules-目錄>node_modules 目錄</h4><p>通常有使用 Node.js 的套件管理，例如 NPM，對此目錄應該有一些印象，使用 Nuxt 3 及專案所需要的相依套件都會存放在這個目錄。</p><h4 id=pages-目錄>pages 目錄</h4><p>這個目錄主要是用來配置我們的頁面，你也可以只使用 <strong>app.vue</strong> 來完成你的網站，但如果建立了 <strong>pages</strong> 這個目錄，Nuxt 3 會自動整合 <code>vue-router</code>，並會依據目錄及檔案結構規則來<code>自動產生出對應路由</code>，也是 Nuxt3 產生路由的方式。</p><h4 id=plugins-目錄>plugins 目錄</h4><p>Nuxt 會自動載入這個目錄檔案，作為插件使用，在檔案名稱可以使用後綴 <code>.server</code> 或 <code>.client</code>，例如，<code>plugin.server.ts</code> 或 <code>plugin.client.ts</code> 來決定只讓伺服器端或客戶端載入這個插件。</p><h4 id=server-目錄>server 目錄</h4><p>用於建立任何後端的邏輯如後端 API，這個目錄下還包含了 <code>api</code>、<code>server</code> 和 <code>middleware</code> 來區分功能，不具有自動載入，但支援 HMR。</p><h4 id=gitignore-檔案>.gitignore 檔案</h4><p>在使用 Git 版本控制時，可以設置一些不需要或忽略關注變動的檔案及目錄。</p><h4 id=nuxtignore-檔案>.nuxtignore 檔案</h4><p>可以設置讓 Nuxt 編譯建構時，忽略一些不需要或欲忽略的檔案。</p><h4 id=appconfigts-檔案>app.config.ts 檔案</h4><p>提供服務運行時暴露給客戶端使用的設定，因此，請不要在 <strong>app.config.ts</strong> 檔案中添加任何機密資訊。</p><h4 id=appvue-檔案>app.vue 檔案</h4><p>Nuxt 3 網站的入口點元件。</p><h4 id=nuxtconfigts-檔案>nuxt.config.ts 檔案</h4><p>用於配置 Nuxt 專案的設定檔。</p><h4 id=packagejson-檔案>package.json 檔案</h4><p>這個檔案裡面定義了專案資訊、腳本、相依套件及版本號，通常有使用 Node.js 套件管理工具建置的專案都會包含此檔案。</p><h4 id=tsconfigjson-檔案>tsconfig.json 檔案</h4><p>Nuxt 3 會在 <strong>.nuxt</strong> 目錄下<code>自動產生</code>一個 <code>tsconfig.json</code> 檔案，其中已經包含了一些解析別名等預設配置；你可以透過<code>專案目錄</code>下的 <code>tsconfig.json</code> 來配置擴展或覆蓋 Nuxt 3 預設的 TypeScript 設定檔。</p><h3 id=自訂目錄名稱>自訂目錄名稱</h3><p>前面簡介了 Nuxt 3 的預設目錄結構與用途，在目錄名稱上 Nuxt 3 也提供了可以調整目錄名稱的方式，只要在 <code>nuxt.config.ts</code> 修改對應的參數，就可以自訂目錄的名稱。不過呢，也並不是所有的目錄都能修改，目前<a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config#dir target=_blank rel=noopener>官方提供</a>的 dir 參數共有以下四個目錄參數選項供修改：</p><ul><li>layouts</li><li>middleware</li><li>pages</li><li>public</li></ul><p>例如我想將 <strong>pages</strong> 目錄名稱調整為 <strong>views</strong> 就可以新增下列 <code>dir</code> 設定添加至 <code>nuxt.config.ts</code>，就可以將 <strong>pages</strong> 目錄功能及規則調整為 <strong>views</strong> 目錄來實現。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>dir</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pages</span><span class=o>:</span> <span class=s1>&#39;views&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=自動載入-auto-imports>自動載入 (Auto Imports)</h3><p>在介紹目錄結構時有提到，某些目錄下的檔案是具有<code>自動載入 (Auto Imports)</code>的功能，意思就是說，當我們在這些特定的目錄 <code>components</code>、<code>composables</code>、<code>layouts</code>、<code>plugins</code> 添加檔案時，Nuxt 3 會自動載入這些元件或函數。</p><p>Nuxt 3 的自動載入具體有以下三種：</p><ul><li>Nuxt 常用元件與函數</li><li>Vue 3 的 API</li><li>基於目錄的自動載入</li></ul><h4 id=nuxt-常用元件與函數的自動載入>Nuxt 常用元件與函數的自動載入</h4><p>Nuxt 會自動載入一些元件或組合式函數，用以讓開發時可以在全部頁面或定義組件和插件可以使用。</p><p>Nuxt 自動載入的元件就好比 <strong>app.vue</strong> 程式碼內，一開始在 <strong>template</strong> 就有的 <code>&lt;NuxtWelcome /></code> 歡迎頁面元件，其他還包含了 <code>&lt;NuxtPage></code>、<code>&lt;NuxtLayout></code> 和 <code>&lt;NuxtLink></code> 等，詳細可以參考<a class=link href=https://nuxt.com/docs/api/components/client-only target=_blank rel=noopener>官方文件</a>。</p><p>例如，下面程式碼中的 <code>useAsyncData</code> 與 <code>$fetch</code> 就是 Nuxt 自動載入的組合式函數，在各個頁面或元件都能做使用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>refresh</span><span class=p>,</span> <span class=nx>pending</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useAsyncData</span><span class=p>(</span><span class=s1>&#39;/api/hello&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/hello&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=vue-3-api-的自動載入>Vue 3 API 的自動載入</h4><p>例如，Vue 3 中會使用到的 <code>ref</code>、<code>computed</code> 等這類的 helpers 或 lifecycle hooks，在 Nuxt 3 也都將會自動的載入，不需要在 import。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// 不需要在 import ref 或 computed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=kr>double</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=基於目錄的自動載入>基於目錄的自動載入</h4><p>如前面所提及的，Nuxt 會自動載入定義在特定目錄的檔案，例如：</p><ul><li>components: 相對於 Vue 的組件。</li><li>composables: 相對於 Vue 的組合式函數。</li></ul><h3 id=建立一個自動導入的元件>建立一個自動導入的元件</h3><p>我們建立一個 <strong>./components/IronManWelcome.vue</strong> 檔案：</p><h5 id=componentsironmanwelcomevue>components/IronManWelcome.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在 <strong>app.vue</strong> 檔案中，新增 <code>&lt;IronManWelcome /></code> 元件。</p><h5 id=appvue>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>IronManWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>現在，瀏覽器可以看見我們添加的元件效果。</p><p><img src=https://live.staticflickr.com/65535/52616188282_4d52db7fc1_o.png max-width=100% max-height=100% class=gallery-image></p><p>可以發現，我們不需要添加 <code>import IronManWelcome from './components/IronManWelcome'</code> 就可以直接在 template 直接使用 <code>&lt;IronManWelcome /></code> 元件，這就是 Nuxt 3 基於目錄的自動載入功能。</p><h3 id=關閉自動載入>關閉自動載入</h3><p>如果想<code>關閉</code> Nuxt 的自動載入元件或函數的功能，可以修改專案目錄下的 <code>nuxt.config.ts</code> 檔案，將 <code>imports.autoImport</code> 設定為 <code>false</code>。</p><h5 id=nuxtconfigts>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>autoImport</span>: <span class=kt>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=顯式載入-explicit-imports>顯式載入 (Explicit Imports)</h3><p>Explicit (顯式、明確的)，當我們需要手動載入，就可以用 <code>#import</code> 這個 Nuxt 釋出的別名，來個別載入那些具有自動載入的元件或函數。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>computed</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;#imports&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=kr>double</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Nuxt 3 的專案目錄與結構已經有一個規定可以遵守，Nuxt 3 規劃的目錄及檔案架構，讓我們可以不用再煩惱該如何配置，只需要專注開發，當你熟悉這些目錄檔案規則與自動載入的特性，肯定能更快上手 Nuxt 3。</p></blockquote><hr><h2 id=頁面-pages-與路由-routing>頁面 (Pages) 與路由 (Routing)</h2><p>在 Vue 中，我們會使用到 <a class=link href=https://router.vuejs.org/ target=_blank rel=noopener>Vue Router</a> 來實現切換頁面或路由的需求，而在 Nuxt 3 中，預設是沒有使用路由相關套件，直至建立了 <strong>pages</strong> 目錄，Nuxt 將會自動載入 Vue Router 來管理路由，並且具有一定的規則需要遵循，以下將介紹頁面目錄與路由之間的關係。</p><h3 id=基於檔案的路由-file-based-routing>基於檔案的路由 (File-based Routing)</h3><p>在 Nuxt 3 專案的 <strong>pages</strong> 目錄下，當我們建立了一個頁面檔案，就會以該檔案建立出相對應的路由，Nuxt 3 基於檔案的路由，也使用了程式碼拆分將每個頁面需要的程式碼梳理出來，並以動態載入的方式載入最小所需要的程式碼。因為是以<strong>目錄結構</strong>與<strong>檔案命名</strong>方式來約定，也稱之為約定式路由。</p><h4 id=建立第一個頁面>建立第一個頁面</h4><p>Nuxt 3 的 <strong>pages</strong> 目錄，是用來建立頁面並放置的目錄，當專案下有存在 <strong>pages</strong> 目錄，Nuxt 將會自動載入 Vue Router 來實現路由效果，目錄下的檔案通常是 Vue 的元件，也允許具有 <strong>.vue</strong>、<strong>.js</strong>、<strong>.jsx</strong>、<strong>.ts</strong> 或 <strong>.tsx</strong> 副檔名的檔案。</p><p>當我們建立 <strong>./pages/index.vue</strong>，檔案內容如下，則表示路由 <code>/</code> 對應到這個頁面檔案，我們只需要建立檔案，路由的配置將會由 Nuxt 3 自動產生。</p><h5 id=pagesindexvue>pages/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這裡是首頁</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>若你還記得 Vue Router 中的 <code>&lt;router-view /></code>，這是路由需要的進入點，同樣的在 Nuxt 3 我們需要使用 <code>&lt;NuxtPage /></code> 來顯示我們建立的路由頁面，<code>這裡非常重要，否則路由及頁面將無法正確運作</code>。</p><p>修改 <strong>./app.vue</strong>，檔案內容如下：</p><h5 id=appvue-1>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtPage</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們在瀏覽器瀏覽 <code>/</code> 路由，如 <code>http://localhost:3000/</code>，就可以看到我們在 <strong>./pages/index.vue</strong> 頁面內寫的標題文字「這是首頁」囉！</p><p><img src=https://live.staticflickr.com/65535/52617186498_fb79e37a84_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=多個路由頁面>多個路由頁面</h3><p>在實務上，通常一個網站會有多個頁面，並分別對應到不同的路由，接下來我們嘗試建立 About 與 Contact 兩個頁面。</p><h4 id=建立多個路由頁面>建立多個路由頁面</h4><p>建立 <strong>./pages/about.vue</strong>，內容如下：</p><h5 id=pagesaboutvue>pages/about.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-yellow-400&#34;</span><span class=p>&gt;</span><span class=nx>大家好</span><span class=err>！</span><span class=nx>我是</span> <span class=nx>Ryan</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=o>/</span><span class=nx>about</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 <strong>./pages/contact.vue</strong>，內容如下：</p><h5 id=pagescontactvue>pages/contact.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-rose-400&#34;</span><span class=p>&gt;</span><span class=nx>如果沒事不要找我</span> <span class=nx>xDDD</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=o>/</span><span class=nx>contact</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們在瀏覽器分別瀏覽 <strong>/about</strong> 或 <strong>/contact</strong>，就可以看到我們路由效果囉！</p><p><img src=https://live.staticflickr.com/65535/52617186538_a097e76893_o.png max-width=100% max-height=100% class=gallery-image></p><p><img src=https://live.staticflickr.com/65535/52616188307_6a7217ce85_o.png max-width=100% max-height=100% class=gallery-image></p><p>可以發現所建立的<code>檔案名稱</code>，最終就會<code>自動對應產生</code>出 <strong>/about</strong> 及 <strong>/contact</strong> 路由。</p><h4 id=自動產生的路由>自動產生的路由</h4><p>如果你有興趣想看看 Nuxt 自動產生出來的路由配置長什麼樣子，可以使用 <code>npm run build</code> 或 <code>npx nuxt build</code> 來建構出 <code>.output</code> 目錄，並打開 <strong>.output/server/chunks/app/server.mjs</strong>，搜尋 <code>const _routes =</code> 或剛剛建立的檔案名稱 <code>about.vue</code>，就可以找到下面這一段程式碼：</p><p><img src=https://live.staticflickr.com/65535/52616964449_0da965dc38_o.png max-width=100% max-height=100% class=gallery-image></p><p>這段程式碼與 Vue 中的路由配置非常相像，其實這就是 Nuxt 3 檢測到 <strong>pages</strong> 目錄，自動幫我們載入 Vue Router 與依據 <strong>pages</strong> 目錄下的檔案結構，自動產生出所需的路由配置。</p><h3 id=建立路由連結>建立路由連結</h3><p>在 Vue Router 我們可以使用 <code>&lt;router-link></code> 來建立路由連結，以此來導航至其他頁面，而在 Nuxt 3 的路由中，則是使用 <code>&lt;NuxtLink></code> 來建立路由連結來進行頁面的跳轉，我們嘗試在首頁新增幾個路由連結來進行頁面導航。</p><p>調整 <strong>./pages/index.vue</strong>，內容如下：</p><h5 id=pagesindexvue-1>pages/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這裡是首頁</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 flex space-x-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/about&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>About</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/contact&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Contact</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們在瀏覽器瀏覽首頁，點擊「前往 About」或「前往 Contact」就可以看見路由導航效果囉！</p><p><img src=https://live.staticflickr.com/65535/52617134125_7f1f7071b0_o.gif max-width=100% max-height=100% class=gallery-image></p><p>使用 <code>&lt;NuxtLink></code> 時，可以就把它想像為 <code>&lt;router-link></code> 的替代品，像 <code>to</code> 這個 Pros 控制路由位置的用法基本上一樣，其他更多的 Pros 用法及說明可以參考官網的<a class=link href=https://nuxt.com/docs/api/components/nuxt-link#props target=_blank rel=noopener>文件</a>。</p><p>如果想要使用像 Vue Router 提供的 <code>router.push</code> 方法於 Vue 中直接呼叫來導航至其他頁面，在 Nuxt 中你可以使用 <code>navigateTo</code>，參數可以參考<a class=link href=https://nuxt.com/docs/api/utils/navigate-to#navigateto target=_blank rel=noopener>官方文件</a>。</p><h3 id=約定式路由中的-indexvue>約定式路由中的 index.vue</h3><p>在開頭有提到，Nuxt 3 提供了一個基於檔案的路由，從上述例子你或許能發現，基本上檔案名稱就是對應著路由名稱，但 <strong>index.vue</strong> 比較特別，它所對應的是路由 <code>/</code>。</p><blockquote><p><strong>index.[ext]</strong> 這個效果和特性，其實是與 Node.js 底層核心有關，在此就不贅述。</p></blockquote><p>舉例來說，我可以在 <strong>pages</strong> 下建立一個 <strong>docs.vue</strong> 表示對應路由 <strong>/docs</strong>，也可以將檔案放置在 <strong>docs</strong> 目錄下並重新命名為 <strong>index.vue</strong> 即 <strong>./pages/docs/index.vue</strong>，這樣也可以透過 <strong>/docs</strong> 瀏覽到相同的頁面。</p><p>所以當 <strong>index.vue</strong> 存在於 <strong>pages</strong> 目錄下，已經位於網站頁面的第一層，所以我們瀏覽 <a class=link href=http://localhost:3000/ target=_blank rel=noopener>http://localhost:3000/</a> 就可以做出首頁的效果。</p><h3 id=帶參數的動態路由匹配>帶參數的動態路由匹配</h3><p>在實務上，我們可能需要將路徑作為參數傳遞給同一個元件，例如，我們有一個 <strong>users</strong> 頁面元件，在 <strong>/users/ryan</strong> 或 <strong>/users/jennifer</strong> 路徑，都能匹配到同一個 <strong>users</strong> 元件，並將 <strong>ryan</strong> 或 <strong>jennifer</strong> 當作參數傳遞給 <strong>users</strong> 頁面元件使用，那麼我們就需要動態路由來做到這件事。</p><p>在 Vue 3 使用 Vue Router 我們可能會寫出如下路由配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name:</span> <span class=nt>&#34;users&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>path:</span> <span class=nt>&#34;/users/:id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>component:</span> <span class=nt>&#34;./pages/users.vue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>這樣我們就能達到進入 <strong>/users/ryan</strong> 路由將 ryan 當作 <strong>id</strong> 參數傳入 <strong>users</strong> 元件中，路徑參數用冒號 <code>:</code> 表示，這個被匹配的參數 (params)，會在元件中可以使用 <strong>useRoute()</strong> 與 <strong>route.params.id</strong> 取得。</p><p>在 Nuxt 3 中，我們要實現這個效果，需要將檔案名稱添加中括號 <code>[]</code>，其中放入欲設定的參數名稱，譬如下面的目錄結構與檔案名稱。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./pages/
</span></span><span class=line><span class=cl>└── users/
</span></span><span class=line><span class=cl>    └── <span class=o>[</span>id<span class=o>]</span>.vue
</span></span></code></pre></td></tr></table></div></div><p>建立 <code>./pages/users/[id].vue</code> 檔案，內容如下：</p><h5 id=pagesusersidvue>pages/users/[id].vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=nx>Users</span> <span class=nx>動態路由頁面</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>匹配到的</span> <span class=nx>Id</span><span class=o>:</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-5xl font-semibold text-blue-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>id</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>route</span> <span class=o>=</span> <span class=nx>useRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們在 <strong>script</strong> 就可以從 <strong>route.params</strong> 拿到我們所設定的參數名稱 <strong>id</strong>，並將其在 <strong>template</strong> 中渲染出來。瀏覽 <a class=link href=http://localhost:3000/users/ryan target=_blank rel=noopener>http://localhost:3000/users/ryan</a> ，看看效果，Nuxt 3 就能匹配到使用者的 <strong>id</strong> 參數 <strong>ryan</strong>，並傳入 <strong>users</strong> 頁面元件。</p><p><img src=https://live.staticflickr.com/65535/52617186583_c117eb473b_o.gif max-width=100% max-height=100% class=gallery-image></p><p>你也可以在 <strong>template</strong> 直接使用 <code>{{ $route.params.id }}</code> 來渲染出 <strong>id</strong> 參數。</p><h3 id=匹配所有層級的路由>匹配所有層級的路由</h3><p>如果你需要匹配某個頁面下的所有層級的路由，你可以在參數前面加上 <code>...</code> ，例如，<code>[...slug].vue</code>，這將匹配該路徑下的所有路由。</p><p>建立 <strong>./catch-all/[&mldr;slug].vue</strong> 檔案：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./pages/
</span></span><span class=line><span class=cl>└── catch-all/
</span></span><span class=line><span class=cl>    └── <span class=o>[</span>...slug<span class=o>]</span>.vue
</span></span></code></pre></td></tr></table></div></div><p><strong>./catch-all/[&mldr;slug].vue</strong> 檔案內容如下：</p><h5 id=catch-allslugvue>catch-all/[&mldr;slug].vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-4xl text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這是</span> <span class=k>catch</span><span class=o>-</span><span class=nx>all</span><span class=o>/</span><span class=p>...</span> <span class=nx>下的頁面</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>匹配到的</span> <span class=nx>Params</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 text-5xl font-semibold text-violet-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>$route</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>slug</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-xl text-gray-400&#34;</span><span class=p>&gt;</span><span class=nx>每個陣列元素對應一個層級</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們可以輸入 <strong>/catch-all/hello</strong> 及 <strong>/catch-all/hello/world</strong>，路由的參數 <strong>slug</strong> 就會是一個陣列，陣列的每個元素對應每一個層級。</p><p><img src=https://live.staticflickr.com/65535/52616964479_ab69ffff26_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=建立-404-not-found-頁面>建立 404 Not Found 頁面</h3><p>Nuxt 3 提供一個配置來處理 <strong>404 Not Found</strong> 的頁面，當我們建立 <strong>./pages/[&mldr;slug].vue</strong> 頁面， Nuxt 3 所有未匹配的路由，將會交由這個頁面元件做處理，並同時使用 <code>setResponseStatus(404)</code> 函數設定 <strong>404 HTTP Status Code</strong>。</p><h5 id=pagesslugvue>pages/[&mldr;slug].vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-8xl font-semibold text-red-500&#34;</span><span class=p>&gt;</span><span class=mi>404</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>Not</span> <span class=nx>Found</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-xl text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>真的是找不到這個頁面啦</span> <span class=o>&gt;</span><span class=c1>///&lt;&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>setResponseStatus</span><span class=p>(</span><span class=mi>404</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>/omg</strong> 這個是不存在的頁面，未匹配的路由就會交由 <strong>./pages/[&mldr;slug].vue</strong> 頁面來處理。</p><p><img src=https://live.staticflickr.com/65535/52616188362_24b6c38fab_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=建立多層的目錄結構>建立多層的目錄結構</h3><p>如果理解了動態路由的中括號 <code>[]</code> 用法，那我們就可以建立更複雜的頁面目錄結構：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./pages/
</span></span><span class=line><span class=cl>└── posts/
</span></span><span class=line><span class=cl>    ├── <span class=o>[</span>postId<span class=o>]</span>/
</span></span><span class=line><span class=cl>    │   ├── comments/
</span></span><span class=line><span class=cl>    │   │   └── <span class=o>[</span>commentId<span class=o>]</span>.vue
</span></span><span class=line><span class=cl>    │   └── index.vue
</span></span><span class=line><span class=cl>    ├── index.vue
</span></span><span class=line><span class=cl>    └── top-<span class=o>[</span>number<span class=o>]</span>.vue
</span></span></code></pre></td></tr></table></div></div><p>這四個 Vue 頁面的參考程式碼如下：</p><h5 id=pagespostsindexvue>pages/posts/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-4xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這是</span> <span class=nx>Posts</span> <span class=nx>首頁</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 flex space-x-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/posts/8&#34;</span><span class=p>&gt;</span> <span class=nx>前往指定的文章</span> <span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/posts/8/comments/1&#34;</span><span class=p>&gt;</span><span class=nx>前往指定的文章留言</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/posts/top-3&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Top</span> <span class=mi>3</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/posts/top-10&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Top</span> <span class=mi>10</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagespoststop-numbervue>pages/posts/top-[number].vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這是</span> <span class=nx>posts</span><span class=o>/</span><span class=nx>top</span><span class=o>-</span><span class=p>[</span><span class=nx>number</span><span class=p>]</span> <span class=nx>的頁面</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>匹配到的</span> <span class=nx>Top</span> <span class=nb>Number</span><span class=o>:</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-5xl font-semibold text-rose-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>number</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>route</span> <span class=o>=</span> <span class=nx>useRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>number</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagespostspostidindexvue>pages/posts/[postId]/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這是</span> <span class=nx>posts</span><span class=o>/</span><span class=p>[</span><span class=nx>postId</span><span class=p>]</span> <span class=nx>的頁面</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>匹配到的</span> <span class=nx>Post</span> <span class=nx>Id</span><span class=o>:</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-5xl font-semibold text-blue-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>postId</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>route</span> <span class=o>=</span> <span class=nx>useRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>postId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagespostspostidcommentscommentidvue>pages/posts/[postId]/comments/[commentId].vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這是</span> <span class=nx>posts</span><span class=o>/</span><span class=p>[</span><span class=nx>postId</span><span class=p>]</span><span class=o>/</span><span class=nx>comments</span><span class=o>/</span><span class=p>[</span><span class=nx>commentId</span><span class=p>]</span> <span class=nx>的頁面</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>匹配到的</span> <span class=nx>Post</span> <span class=nx>Id</span><span class=o>:</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-5xl font-semibold text-blue-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>postId</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>匹配到的</span> <span class=nx>Comment</span> <span class=nx>Id</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-5xl font-semibold text-purple-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>commentId</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>route</span> <span class=o>=</span> <span class=nx>useRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>postId</span><span class=p>,</span> <span class=nx>commentId</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>route</span><span class=p>.</span><span class=nx>params</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>來看看實際路由及匹配效果。</p><p><img src=https://live.staticflickr.com/65535/52617186598_0c9c996bdc_o.gif max-width=100% max-height=100% class=gallery-image></p><p>為了方便理解，整理了以下表格，來表示頁面結構及期望匹配的模式與參數：</p><p><strong>./pages/posts/index.vue</strong>：</p><div class=table-wrapper><table><thead><tr><th>匹配模式</th><th>匹配路徑</th><th>匹配參數 (Params)</th></tr></thead><tbody><tr><td>/posts</td><td>/posts</td><td>無</td></tr></tbody></table></div><p><strong>./pages/posts/top-[number].vue</strong>：</p><div class=table-wrapper><table><thead><tr><th>匹配模式</th><th>匹配路徑</th><th>匹配參數 (Params)</th></tr></thead><tbody><tr><td>/posts/top-:number</td><td>/posts/top-3</td><td>{ number: 3 }</td></tr><tr><td>/posts/top-:number</td><td>/posts/top-5</td><td>{ number: 5 }</td></tr></tbody></table></div><p><strong>./pages/posts/[postId]/index.vue</strong>：</p><div class=table-wrapper><table><thead><tr><th>匹配模式</th><th>匹配路徑</th><th>匹配參數 (Params)</th></tr></thead><tbody><tr><td>/posts/:postId</td><td>/posts/8</td><td>{ postId:8 }</td></tr></tbody></table></div><p><strong>./pages/posts/[postId]/comment/[commentId].vue</strong>：</p><div class=table-wrapper><table><thead><tr><th>匹配模式</th><th>匹配路徑</th><th>匹配參數 (Params)</th></tr></thead><tbody><tr><td>/posts/:postId/comments/:commentId</td><td>/posts/8/comments/1</td><td>{ postId: 8, commentId: 1 }</td></tr></tbody></table></div><p>到這裡應該對於如何使用檔案名稱與目錄結構，來製作動態路由與匹配參數有一些概念了。</p><h3 id=巢狀路由-nested-routes>巢狀路由 (Nested Routes)</h3><p>巢狀路由 (Nested Routes) 或稱嵌套路由，顧名思義，當我們想要在一個頁面鑲嵌另一個頁面時，就需要巢狀路由來幫助我們。</p><p>例如，我們想要在 <strong>docs</strong> 頁面元件中顯示 <strong>doc-1</strong> 或 <strong>doc-2</strong> 頁面元件，並在切換 <strong>doc-1</strong> 或 <strong>doc-2</strong> 頁面時，只是在 <strong>docs</strong> 下的嵌套頁面進行切換。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/docs/doc-1                           /docs/doc-2
</span></span><span class=line><span class=cl>+------------------+                  +-----------------+
</span></span><span class=line><span class=cl><span class=p>|</span> docs             <span class=p>|</span>                  <span class=p>|</span> docs            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> +--------------+ <span class=p>|</span>                  <span class=p>|</span> +-------------+ <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> doc-1        <span class=p>|</span> <span class=p>|</span>  +------------&gt;  <span class=p>|</span> <span class=p>|</span> doc-2       <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span>              <span class=p>|</span> <span class=p>|</span>                  <span class=p>|</span> <span class=p>|</span>             <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> +--------------+ <span class=p>|</span>                  <span class=p>|</span> +-------------+ <span class=p>|</span>
</span></span><span class=line><span class=cl>+------------------+                  +-----------------+
</span></span></code></pre></td></tr></table></div></div><p>在 Vue 3 使用 Vue Router 實作上述巢狀路由時，即 <strong>docs</strong> 頁面要能顯示 <strong>doc-1</strong>，我們在路由配置可能就會寫 <code>path: '/docs'</code> 與 <code>children</code>，並在 <code>children</code> 加入 <code>path: '/doc-1'</code>，其中 <strong>docs</strong> 頁面包含 <code>&lt;router-view /></code>，最終瀏覽路由路徑 <code>/docs/doc-1</code> 就可以看到嵌套頁面的效果。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>path:</span> <span class=nt>&#34;/docs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>component:</span> <span class=err>()</span> <span class=err>=&gt;</span> <span class=err>import(</span><span class=nt>&#34;./pages/docs.vue&#34;</span><span class=err>)</span>
</span></span><span class=line><span class=cl>  <span class=err>children</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>path:</span> <span class=nt>&#34;doc-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=err>component:</span> <span class=err>()</span> <span class=err>=&gt;</span> <span class=err>import(</span><span class=nt>&#34;./pages/docs/doc-1.vue&#34;</span><span class=err>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>而在 Nuxt 3 頁面的約定式路由機制下，我們即是透過目錄結構與頁面元件實做出嵌套路由的效果。</p><p>舉例來說，當我們建立了下面的目錄頁面結構：</p><blockquote><p>這裡需要注意，一定要有 <strong>docs.vue</strong> 與 <strong>docs</strong> 同名的目錄</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./pages/
</span></span><span class=line><span class=cl>├── docs/
</span></span><span class=line><span class=cl>│   ├── doc-1.vue
</span></span><span class=line><span class=cl>│   └── doc-2.vue
</span></span><span class=line><span class=cl>└── docs.vue
</span></span></code></pre></td></tr></table></div></div><p>頁面元件的參考程式碼如下：</p><h5 id=pagesdocsvue>pages/docs.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-6 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-3xl font-semibold text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=nx>Docs</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 flex space-x-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/docs/doc-1&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Doc</span> <span class=mi>1</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/docs/doc-2&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Doc</span> <span class=mi>2</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;border-b-2 border-gray-100&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>NuxtPage</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagesdoc-1vue>pages/doc-1.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-blue-500&#34;</span><span class=p>&gt;</span><span class=nx>這是我的第一份文件</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagesdoc-2vue>pages/doc-2.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-green-500&#34;</span><span class=p>&gt;</span><span class=nx>這是我的第二份文件</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Nuxt 3 在自動生成路由時，實際上幫我們做出了類似這樣子的路由結構：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>name:</span> <span class=nt>&#34;docs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>path:</span> <span class=nt>&#34;/docs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>component:</span> <span class=nt>&#34;./pages/docs.vue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=err>children:</span> <span class=err>[</span>
</span></span><span class=line><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=cl>      <span class=err>name:</span> <span class=nt>&#34;docs-first-doc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=err>path:</span> <span class=nt>&#34;doc-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=err>component:</span> <span class=nt>&#34;./pages/docs/doc-1.vue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=err>]</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></td></tr></table></div></div><p>一定要記得在 <strong>docs</strong> 頁面加上 <code>&lt;NuxtPage /></code>，來作為顯示巢狀頁面的容器，接著分別瀏覽 <code>/docs</code>、<code>/docs/doc-1</code> 與 <code>/docs/doc-2</code>，可以發現在兩個頁面中上方的皆有顯示標題「這裡是 Docs」，該文字是由 <code>docs.vue</code> 元件提供的標題文字，而頁面下方則是 <strong>doc-1</strong> 與 <strong>doc-2</strong> 子頁面顯示的地方，以此就可以實現巢狀路由效果囉！</p><p><img src=https://live.staticflickr.com/65535/52616964494_bc91598456_o.gif max-width=100% max-height=100% class=gallery-image></p><p>透過目錄檔案的結構與名稱及中括號 <code>[]</code> 我們就可以完成多數路由的情境，確實方便很多，也足以應付大部分實務上的需求，如果真的需要手動建立路由規則可以在參考<a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config/#router target=_blank rel=noopener>官方文檔</a>或等待釋出更好解決方案。</p><hr><h2 id=布局模板-layouts>布局模板 (Layouts)</h2><p>Nuxt 3 提供了一個布局模板 (Layouts) 的功能，可以讓你定義好布局模板後，在整個 Nuxt 中使用，舉例來說就很適合如上方有導覽列，下方是網頁主體內容的這種排版方式，將其構建成一個布局模板後，我們就可以重複使用這種布局方式。</p><p>布局模板通常放置在 <strong>./layouts</strong> 目錄之下，也具有異步自動導入的效果，當新增好布局檔案後，我們就可以在 <strong>app.vue</strong> 中，添加 <code>&lt;NuxtLayout /></code> 元件來表示使用布局模板，也可以通過 <strong>name</strong> 設定不同的模板名稱。</p><h3 id=建立一個預設的布局模板>建立一個預設的布局模板</h3><p>布局模板在 Nuxt 3 中有約定一個名稱為 <code>default.vue</code> 作為預設的模板，如果在頁面元件中未特別指定要使用哪個模板或 <code>&lt;NuxtLayout /></code> 沒有設定 <strong>name</strong> 屬性，那麼都將會使用 <strong>default</strong> 作為預設的布局。</p><h4 id=step-1-建立預設布局模板>Step 1. 建立預設布局模板</h4><p>新增 <strong>./layouts/default.vue</strong> 檔案內容如下：</p><h5 id=layoutsdefaultvue>layouts/default.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-sky-100 py-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 py-4 text-2xl text-gray-700&#34;</span><span class=p>&gt;</span><span class=nx>這是預設的布局</span><span class=err>，</span><span class=nx>全部頁面都會使用到</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在布局模板中，通常會包含一個 <code>&lt;slot /></code> 插槽，這個未命名的插槽 (slot) 即為預設插槽，這將會是採用這個布局模板的頁面元件，顯示的內容容器位置。</p><h4 id=step-2-添加-元件>Step 2. 添加 元件</h4><p>調整 <strong>app.vue</strong> 檔案，內容如下，我們添加 <code>&lt;NuxtLayout></code> 作為布局模板顯示的位置，<strong>name</strong> 屬性預設是 <strong>default</strong>，不過我們還是寫上 <code>name="default"</code> 避免誤會，這個 <strong>name</strong> 屬性值對應的即是布局模板的名稱。</p><p>下圖可以看見，我們在 <strong>app.vue</strong> 所寫的文字「這裡是最外層 app.vue」，會是在最外層，而緊接著的 <code>&lt;NuxtLayout name="default">&lt;/NuxtLayout></code>，就是布局頁面 <code>default.vue</code>。</p><p><img src=https://live.staticflickr.com/65535/52617134195_02b2a3944c_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=布局模板中的插槽>布局模板中的插槽</h3><p>如果你有注意到，<strong>default.vue</strong> 檔案內程式碼內，有一個插槽 <code>&lt;slot /></code>，這裡就會是 <code>&lt;NuxtLayout></code> 內的元素所顯示的位置。</p><p>例如，我們在 <strong>app.vue</strong> 稍作調整：</p><h5 id=appvue-2>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-4 bg-white&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;pb-4 text-2xl text-slate-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是最外層</span> <span class=nx>app</span><span class=p>.</span><span class=nx>vue</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtLayout</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;default&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 pt-4 text-xl text-slate-800&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>被</span> <span class=nx>NuxtLayout</span> <span class=nx>包裹的元件將會放置到</span> <span class=nx>Layout</span> <span class=nx>的</span> <span class=nx>slot</span> <span class=nx>中</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>被 <code>&lt;NuxtLayout name="default"></code> 包裹的元素，就會在布局模板中的插槽 <code>&lt;slot /></code> 顯示。</p><p><img src=https://live.staticflickr.com/65535/52616188382_5a181ede48_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=在布局模板中建立多個插槽>在布局模板中建立多個插槽</h3><p>當然，你也可以在布局模板中添加多個插槽，並給予名稱，這樣就可以將內容安排到特定的位置。</p><h4 id=step-1-建立兩個具名的插槽-slot分別為-header-與-footer>Step 1. 建立兩個具名的插槽 (Slot)，分別為 <strong>header</strong> 與 <strong>footer</strong></h4><blockquote><p>如果插槽沒有給予 <strong>name</strong> 屬性，預設為 <code>default</code>。</p></blockquote><h5 id=layoutsdefaultvue-1>layouts/default.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-sky-100 py-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 py-4 text-2xl text-gray-700&#34;</span><span class=p>&gt;</span><span class=nx>這是預設的布局</span><span class=err>，</span><span class=nx>全部頁面都會使用到</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;header&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;footer&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-將不同內容顯示於指定的插槽位置>Step 2. 將不同內容，顯示於指定的插槽位置。</h4><h5 id=appvue-3>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-4 bg-white&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;pb-4 text-2xl text-slate-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是最外層</span> <span class=nx>app</span><span class=p>.</span><span class=nx>vue</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtLayout</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;default&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 pt-4 text-xl text-green-500&#34;</span><span class=p>&gt;</span><span class=nx>這段會放置在</span> <span class=nx>header</span> <span class=nx>插槽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>default</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 pt-4 text-xl text-cyan-500&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>被</span> <span class=nx>NuxtLayout</span> <span class=nx>包裹的元件將會放置到</span> <span class=nx>Layout</span> <span class=nx>的預設</span> <span class=nx>slot</span> <span class=nx>中</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>footer</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 pt-4 text-xl text-blue-500&#34;</span><span class=p>&gt;</span><span class=nx>這段會放置在</span> <span class=nx>footer</span> <span class=nx>插槽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>下圖可以看見，我們就可以依此來安排各個元件，於布局模板插槽的所在位置。</p><p><img src=https://live.staticflickr.com/65535/52617186618_5d72657e32_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=布局模板與路由頁面>布局模板與路由頁面</h3><p>當你熟悉了插槽配置，你也可以在其中添加 <code>&lt;NuxtPage /></code> 與建立 <strong>pages</strong> 下的頁面元件，以達到不同的路由頁面，使用相同的布局方式。</p><p>如果布局模板結合了路由頁面，整體網站就會如下的巢狀顯示方式，網站的入口點 <strong>app.vue</strong> 放置布局模板，模板內的內容則使用路由的 <code>&lt;NuxtPage /></code>，最後各個路由的頁面就會在 <code>&lt;NuxtPage /></code> 容器中顯示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>+---------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> app.vue                   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> +-----------------------+ <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> layout                <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> +-------------------+ <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> <span class=p>|</span> page              <span class=p>|</span> <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> <span class=p>|</span>                   <span class=p>|</span> <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> <span class=p>|</span>                   <span class=p>|</span> <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>|</span> +-------------------+ <span class=p>|</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> +-----------------------+ <span class=p>|</span>
</span></span><span class=line><span class=cl>+---------------------------+
</span></span></code></pre></td></tr></table></div></div><h3 id=建立布局模板與路由頁面>建立布局模板與路由頁面</h3><h4 id=step-1-調整-appvue-入口點>Step 1. 調整 app.vue 入口點</h4><p>將 <strong>app.vue</strong> 調整為以下內容：</p><h5 id=appvue-4>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-4 bg-white&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;pb-4 text-2xl text-slate-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是最外層</span> <span class=nx>app</span><span class=p>.</span><span class=nx>vue</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>NuxtPage</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-建立路由頁面>Step 2. 建立路由頁面</h4><p>建立 <strong>./pages/index.vue</strong>，內容如下：</p><h5 id=pagesindexvue-2>pages/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-6 bg-slate-50 py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這樣我們就可以來讓路由頁面共用相同的布局模板。</p><p><img src=https://live.staticflickr.com/65535/52617186638_b40c944d07_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=多個路由頁面共用預設布局模板>多個路由頁面共用預設布局模板</h3><p>承上，我們建立好預設的布局模板，讓它負責顯示路由的頁面。</p><h4 id=step-1-新增路由頁面>Step 1. 新增路由頁面</h4><p>新增 <strong>./pages/about.vue</strong>，內容如下：</p><h5 id=pagesaboutvue-1>pages/about.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-6 mb-4 bg-slate-50 py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-yellow-400&#34;</span><span class=p>&gt;</span><span class=nx>大家好</span><span class=err>！</span><span class=nx>我是</span> <span class=nx>Ryan</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=o>/</span><span class=nx>about</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>新增 <strong>./pages/contact.vue</strong>，內容如下：</p><h5 id=pagescontactvue-1>pages/contact.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-6 mb-4 bg-slate-50 py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-rose-400&#34;</span><span class=p>&gt;</span><span class=nx>如果沒事不要找我</span> <span class=nx>xDDD</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-8 text-3xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>這裡是</span> <span class=o>/</span><span class=nx>contact</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-新增路由連結>Step 2. 新增路由連結</h4><p>調整 <strong>./pages/index.vue</strong>，內容如下：</p><h5 id=pagesindexvue-3>pages/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-6 mb-4 bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這裡是首頁</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 flex space-x-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/about&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>About</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/contact&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=nx>Contact</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現，現在首頁 <code>/</code>、<code>/about</code> 與 <code>/contact</code> 都套用上了預設布局。</p><p><img src=https://live.staticflickr.com/65535/52616964569_b4e67e211a_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=建立多個布局模板>建立多個布局模板</h3><p>你也可以建立多個布局模板，再依據不同的情境，使用不同的布局模板。</p><h4 id=step-1-建立新的布局模板>Step 1. 建立新的布局模板</h4><p>新增 <strong>./layouts/custom.vue</strong>，內容如下：</p><h5 id=layoutscustomvue>layouts/custom.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-rose-100 py-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 py-4 text-2xl text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>使用</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-bold text-rose-500&#34;</span><span class=p>&gt;</span><span class=nx>Custom</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> <span class=nx>布局</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-新增一個路由頁面>Step 2. 新增一個路由頁面</h4><p>新增 <strong>./pages/custom.vue</strong>，內容如下：</p><h5 id=pagescustomvue>pages/custom.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-6 bg-slate-50 py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-使用指定布局模板>Step 3. 使用指定布局模板</h4><p>在 <strong>./pages/custom.vue</strong> 中的 <strong>script</strong> 使用 <code>definePageMeta</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>layout</span><span class=o>:</span> <span class=s1>&#39;custom&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>definePageMeta</code> 方法，提供我們可以設定特定的布局模板，<code>layout</code> 參數值所對應的名稱，即為 <strong>./layouts</strong> 目錄下的布局模板。</p><blockquote><p>注意，布局模板的命名被規範使用 <strong>Kebab Case</strong> 命名法，若檔案名稱為 <strong>customLayout.vue</strong>，它將會以 <code>custom-layout</code> 作為 <strong>name</strong> 屬性傳遞給</p></blockquote><p><img src=https://live.staticflickr.com/65535/52616188442_127e72da50_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=更進階的指定布局模板>更進階的指定布局模板</h3><p>我們能使用 <strong>layout: false</strong> 來禁止使用預設的布局模板，並在 <strong>template</strong> 添加 <code>&lt;NuxtLayout name="custom"></code> 來使用 <strong>custom</strong> 布局模板。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>NuxtLayout</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;custom&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-6 mb-4 bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>layout</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當布局模板可以在 <strong>template</strong> 中設定使用，我們就能結合插槽甚至動態的調整 <strong>name</strong> 屬性，做出更多樣靈活的布局效果。</p><p><img src=https://live.staticflickr.com/65535/52616964574_0e7759f29b_o.png max-width=100% max-height=100% class=gallery-image></p><p>上圖的參考程式碼：</p><h5 id=layoutscustomvue-1>layouts/custom.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-rose-100 py-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;px-6 py-4 text-2xl text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>使用</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-bold text-rose-500&#34;</span><span class=p>&gt;</span><span class=nx>Custom</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> <span class=nx>布局</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>slot</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;footer&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=pagescustomvue-1>pages/custom.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>NuxtLayout</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;custom&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>default</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-6 mb-4 bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>footer</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-xl text-slate-600&#34;</span><span class=p>&gt;</span><span class=nx>感謝您閱讀</span> <span class=nx>Nuxe</span> <span class=mi>3</span> <span class=nx>學習筆記</span><span class=err>～</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>NuxtLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>layout</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當你使用 <strong>definePageMeta</strong> 方法，禁止使用預設的布局模板後，你也能使用 <code>setPageLayout</code> 方法來動態改變布局。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=o>=</span> <span class=nx>enableCustomLayout</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setPageLayout</span><span class=p>(</span><span class=s1>&#39;custom&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當你看過了這篇內容後，你會發現 Nuxt 3 所提供的布局模板非常的好用，布局模板規劃好後，爾後頁面所使用到的相同布局，只需要更改同一個布局模板，如果再結合元件化技巧，更是讓你的程式碼兼具重複使用性與維護性。</p><hr><h2 id=元件-components>元件 (Components)</h2><p>在建立 Vue 的網站開發過程中，我們可能會自己封裝元件 (Component) 讓程式碼可以被重複使用，也方便開發者維護，這些一個個的元件，可以透過<code>全域註冊 (Global Registration)</code> 讓整個 Vue 應用程式中都可以使用這個元件，也可以透過<code>區域註冊 (Local Registration)</code> 於特定的元件再載入使用。接下來我們將介紹 Nuxt 3 使用元件時應該遵循的規範及特色。</p><h3 id=元件自動載入>元件自動載入</h3><p>在 Vue 中，雖然區域註冊使得元件間的依賴關係更加明確也對於 <a class=link href=https://developer.mozilla.org/zh-CN/docs/Glossary/Tree_shaking target=_blank rel=noopener>Tree shaking</a> 更加友好，但我們在使用元件時，就得在需要的地方個別載入及註冊。而 Nuxt 3 提供在 <strong>components</strong> 目錄下專門放至這些元件，並具有自動載入及延遲載入等功能特色。</p><h4 id=建立與使用元件>建立與使用元件</h4><p>新增 <strong>./components/IronManWelcome.vue</strong>，內容如下：</p><h5 id=componentsironmanwelcomevue-1>components/IronManWelcome.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>調整 <strong>./app.vue</strong>，內容如下：</p><h5 id=appvue-5>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>IronManWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們建立了 <strong>./components/IronManWelcome.vue</strong> 檔案後，Nuxt 會自動載入 <strong>./components</strong> 目錄中的<code>任何元件</code>，在使用時的元件名稱也對應著檔案名稱，所以我們只需直接添加 <code>&lt;IronManWelcome /></code> 就可以直些使用這個元件。</p><h3 id=元件名稱>元件名稱</h3><p>Nuxt 所自動載入 <strong>./components</strong> 目錄下的元件，在使用時的元件名稱也對應著檔案名稱，而當你在巢狀的目錄結構下的元件，<code>元件的名稱將會基於目錄的路徑與檔案名稱，並刪除重複的字段</code>。</p><p>舉例來說，如果 <strong>./components</strong> 目錄結構如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>components/
</span></span><span class=line><span class=cl>└── base/
</span></span><span class=line><span class=cl>    └── apply/
</span></span><span class=line><span class=cl>        └── Button.vue
</span></span></code></pre></td></tr></table></div></div><p><strong>./components/base/apply/Button.vue</strong> 元件的名稱就會是由目錄與檔案名稱組合出的 <code>&lt;BaseApplyButton></code>。</p><p>為了開發上能更清楚辨別，建議將檔案名稱設置與使用元件時的名稱相同，所以我們重新命名 <strong>./components/base/apply/</strong> 下的 <strong>Button.vue</strong> 為 <code>BaseApplyButton.vue</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>components/
</span></span><span class=line><span class=cl>└── base/
</span></span><span class=line><span class=cl>    └── apply/
</span></span><span class=line><span class=cl>        └── BaseApplyButton.vue
</span></span></code></pre></td></tr></table></div></div><p>你也不用擔心元件名稱會不會變成 <code>&lt;BaseApplyBaseApplyButton></code> 看起來有點醜醜的，因為 Nuxt 會幫我們<code>刪除重複的字段</code>，所以在使用時元件名稱為 <code>&lt;BaseApplyButton></code>。</p><h4 id=元件名稱的命名規則>元件名稱的命名規則</h4><p>Vue 在註冊元件時，可以使用大駝峰式命名法 (Pascal Case) 或烤肉串命名法 (Kebab Case) 來為元件命名，並在 <strong>template</strong> 也可以自由使用兩種命名方式作為使用元件的標籤。</p><p>例如，以 <code>&lt;base-apply-button></code> 來表示使用 <strong>./components/base/apply/BaseApplyButton.vue</strong> 元件。</p><p>抑或建立 <strong>./components/base/apply/base-apply-button.vue</strong> 元件，使用時以 <code>&lt;BaseApplyButton></code> 表示。</p><p>兩種方式 Nuxt 都支援，可以根據自己的習慣做選擇，而我個人是以大駝峰式命名法 (Pascal Case) 為主，以此區別為自己建立的元件。</p><h3 id=動態元件-dynamic-components>動態元件 (Dynamic Components)</h3><p>如果想要使用像 Vue 中的 <code>&lt;component :is="someComputedComponent"></code> 來<a class=link href=https://cn.vuejs.org/guide/essentials/component-basics.html#dynamic-components target=_blank rel=noopener>動態</a>的切換不同的元件，則需要使用 Vue 提供的 <code>resolveComponentVue</code> 方法來進行輔助。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>component</span> <span class=o>:</span><span class=na>is</span><span class=o>=</span><span class=s>&#34;show ? DynamicComponent : &#39;div&#39;&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>show</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>DynamicComponent</span> <span class=o>=</span> <span class=nx>resolveComponent</span><span class=p>(</span><span class=s1>&#39;BaseApplyButton&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=建立動態元件>建立動態元件</h3><h4 id=step-1-建立元件>Step 1. 建立元件</h4><p>新增 <strong>./components/base/apply/BaseApplyButton.vue</strong>，內容如下：</p><h5 id=componentsbaseapplybaseapplybuttonvue>components/base/apply/BaseApplyButton.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>立即報名</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>新增 <strong>./components/round/apply/RoundApplyButton.vue</strong>，內容如下：</p><h5 id=componentsroundapplyroundapplybuttonvue>components/round/apply/RoundApplyButton.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 rounded-full bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>立即報名</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-使用-resolvecomponent>Step 2. 使用 resolveComponent()</h4><p>調整 <strong>./app.vue</strong>，內容如下：</p><h5 id=appvue-6>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 flex items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>input</span>
</span></span><span class=line><span class=cl>        <span class=na>id</span><span class=o>=</span><span class=s>&#34;show-button&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nt>v-model</span><span class=s>=&#34;useRound&#34;
</span></span></span><span class=line><span class=cl><span class=s>        name=&#34;show-button&#34;
</span></span></span><span class=line><span class=cl><span class=s>        type=&#34;checkbox&#34;
</span></span></span><span class=line><span class=cl><span class=s>        class=&#34;h-5 w-5&#34;
</span></span></span><span class=line><span class=cl><span class=s>      /&gt;
</span></span></span><span class=line><span class=cl><span class=s>      &lt;label for=&#34;show-button&#34; class=&#34;ml-2 block text-base text-slate-800&#34;</span><span class=p>&gt;</span><span class=err>使用圓角按鈕</span><span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>component</span> <span class=o>:</span><span class=na>is</span><span class=o>=</span><span class=s>&#34;useRound ? RoundButton : BaseButton&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>useRound</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>BaseButton</span> <span class=o>=</span> <span class=nx>resolveComponent</span><span class=p>(</span><span class=s1>&#39;BaseApplyButton&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RoundButton</span> <span class=o>=</span> <span class=nx>resolveComponent</span><span class=p>(</span><span class=s1>&#39;RoundApplyButton&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>呈現效果：</p><p><img src=https://live.staticflickr.com/65535/52617134245_0c359ab608_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=動態載入-dynamic-imports>動態載入 (Dynamic Imports)</h3><p>動態載入 (Dynamic Imports) 元件也稱之為<code>延遲載入 (lazy-loading)</code>，如果頁面中不需要立刻使用或顯示某個元件，透過動態載入的方式可以<code>延遲元件載入的時間點</code>，有助於優化 JavaScript 首次載入時的檔案大小。</p><p>使用的方式也非常簡單，只需要在使用元件時，加上前綴 <code>Lazy</code> 就可以有延遲載入的效果。</p><h4 id=建立一個動態載入的按鈕>建立一個動態載入的按鈕</h4><h4 id=step-1-建立按鈕元件>Step 1. 建立按鈕元件</h4><p>新增 <strong>./components/base/apply/BaseApplyButton.vue</strong>，內容如下：</p><h5 id=componentsbaseapplybaseapplybuttonvue-1>components/base/apply/BaseApplyButton.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 rounded-sm bg-blue-600 py-3 px-8 text-xl font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>立即報名</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-添加-lazy-前綴>Step 2. 添加 Lazy 前綴</h4><p>調整 <strong>./app.vue</strong>，內容如下：</p><h5 id=appvue-7>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 flex items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;show-button&#34;</span> <span class=nt>v-model</span><span class=s>=&#34;show&#34; name=&#34;show-button&#34; type=&#34;checkbox&#34; class=&#34;h-5 w-5&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=s>      &lt;label for=&#34;show-button&#34; class=&#34;ml-2 block text-base text-slate-800&#34;</span><span class=p>&gt;</span><span class=err>顯示報名按鈕</span><span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>LazyBaseApplyButton</span> <span class=na>v</span><span class=nt>-if</span><span class=err>=&#34;</span><span class=na>show</span><span class=err>&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>show</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>看看延遲載入的效果：</p><p>在頁面上有一個核取方塊，使用者勾選時才顯示按鈕，我們透過瀏覽器的開發者工具觀察網路 (Network) 的使用情況，可以發現只有首次勾選後才請求了 <strong>BaseApplyButton.vue</strong> 按鈕元件 JS。當這個按鈕元件被設置為 <code>Lazy</code> 動態載入時，頁面首次載入其實不會包含這個按鈕的程式碼，而是等待需要這個元件時才去請求下載，以此達到<code>延遲載入</code>的效果，同時也降低首次進入網頁時需要下載的 JavaScript 程式碼大小。</p><p><img src=https://live.staticflickr.com/65535/52616698371_6fc18a0e8b_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=控制伺服器端或客戶端渲染元件>控制伺服器端或客戶端渲染元件</h3><h4 id=clientonly-元件><code>&lt;ClientOnly></code> 元件</h4><p>Nuxt 3 提供了一個 <code>&lt;ClientOnly></code> 元件，可以控制被包裹的元件僅在客戶端進行渲染。</p><p>例如，我們建立 <strong>./components/IronManWelcome.vue</strong> 檔案，內容如下：</p><h5 id=componentsironmanwelcomevue-2>components/IronManWelcome.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>&lt;ClientOnly></code> 元件包裹 <code>&lt;IronManWelcome></code>。</p><p>調整 <strong>./app.vue</strong> 中，內容如下：</p><h5 id=appvue-8>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>IronManWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這樣就可以將 <code>&lt;IronManWelcome></code> 元件設定為僅在客戶端進行渲染，首次請求頁面時將不會包含這個元件的 HTML。</p><p><code>&lt;ClientOnly></code> 元件中提供了一個名為 <code>fallback</code> 的插槽 (Slot)，可以用作於在伺服器渲染的預設內容，等到客戶端載入完成才接手渲染被包裹的 <code>&lt;IronManWelcome></code> 元件。</p><p>調整 <strong>./app.vue</strong> 中，內容如下：</p><h5 id=appvue-9>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>IronManWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>fallback</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-6 flex justify-center&#34;</span><span class=p>&gt;[</span><span class=nx>IronManWelcome</span><span class=p>]</span> <span class=nx>載入中</span><span class=p>...&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當進入首次網頁，會先渲染 <code>fallback</code> 插槽內的元素，所以瀏覽器先顯示 <strong>[IronManWelcome] 載入中&mldr;</strong> 文字，接著客戶端載入完 JS 後接手渲染 <code>&lt;IronManWelcome></code> 元件。</p><p><img src=https://live.staticflickr.com/65535/52616188487_a1bc229272_o.gif max-width=100% max-height=100% class=gallery-image></p><p>你也可以透過瀏覽器頁面中點擊右鍵後展開選單的「檢視網頁原始碼」功能，所看到的網頁原始碼，發現伺服器端僅先回應了 <code>&lt;p class="my-6 flex justify-center">[IronManWelcome] 載入中...&lt;/p></code>，表示這是由伺服器端渲染 <code>&lt;ClientOnly></code> 元件 <code>fallback</code> 插槽的內容。</p><p><img src=https://live.staticflickr.com/65535/52616964604_68d7e7bf6a_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=client-與-server>.client 與 .server</h4><p>Nuxt 3 的元件，也可以透過元件的檔案名稱來控制僅顯示在客戶端或伺服器端。</p><p>如果元件僅在客戶端呈現，則可以將 <code>.client</code> 加入元件檔名的後綴中。</p><p>建立一個 <strong>./components/JustClient.client.vue</strong> 元件檔案，表示 <code>&lt;JustClient></code> 元件，僅會在客戶端進行渲染。</p><p>而添加 <code>.server</code> 後綴的元件檔案，則會是這個元件在伺服器端渲染的內容。</p><h4 id=控制伺服器端或客戶端渲染元件範例>控制伺服器端或客戶端渲染元件範例</h4><p>我們使用 <code>&lt;ClientOnly></code> 元件、<code>.client</code> 與 <code>.server</code> 做一個範例來看呈現的效果。</p><h5 id=componentsironmanwelcomevue-3>components/IronManWelcome.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;</span><span class=mi>2022</span> <span class=nx>iThome</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-bold text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>鐵人賽</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=componentsjustclientclientvue>components/JustClient.client.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-16 my-4 rounded-lg bg-green-100 p-4 text-sm text-green-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-semibold&#34;</span><span class=p>&gt;[</span><span class=nx>JustClient</span><span class=p>]&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ml-2&#34;</span><span class=p>&gt;</span><span class=nx>這是只有在</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-bold&#34;</span><span class=p>&gt;</span><span class=nx>Client</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> <span class=nx>才會渲染的元件</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=componentsclientandserverclientvue>components/ClientAndServer.client.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-16 my-4 rounded-lg bg-sky-100 p-4 text-sm text-sky-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-semibold&#34;</span><span class=p>&gt;[</span><span class=nx>ClientAndServer</span><span class=p>]&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ml-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>這是從</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-bold text-red-500&#34;</span><span class=p>&gt;</span><span class=nx>Client</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> <span class=nx>渲染出來的元件</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=componentsclientandserverservervue>components/ClientAndServer.server.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mx-16 my-4 rounded-lg bg-sky-100 p-4 text-sm text-sky-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-semibold&#34;</span><span class=p>&gt;[</span><span class=nx>ClientAndServer</span><span class=p>]&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ml-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>這是從</span> <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-bold text-red-500&#34;</span><span class=p>&gt;</span><span class=nx>Server</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span> <span class=nx>渲染出來的元件</span><span class=err>，</span><span class=nx>請等待</span> <span class=nx>Client</span>
</span></span><span class=line><span class=cl>      <span class=nx>接手渲染</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=appvue-10>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>IronManWelcome</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>fallback</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-6 flex justify-center&#34;</span><span class=p>&gt;[</span><span class=nx>IronManWelcome</span><span class=p>]</span> <span class=nx>載入中</span><span class=p>...&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>JustClient</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ClientAndServer</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們重新瀏覽網頁，可以發現到由伺服器渲染的插槽元素 <strong>[IronManWelcome] 載入中&mldr;</strong> 文字與 <strong>ClientAndServer.server.vue</strong> 元件，率先被顯示了出來。接著當 JS 載入完畢後，被 包裹的元件 <code>&lt;IronManWelcome></code> 也接手並覆蓋了「<strong>[IronManWelcome] 載入中&mldr;</strong>」文字，<strong>ClientAndServer.client.vue</strong> 與 <strong>JustClient.client.vue</strong> 僅在客戶端渲染的元件，也分別的覆蓋與顯示出來。</p><p><img src=https://live.staticflickr.com/65535/52617186703_ecb68732a9_o.gif max-width=100% max-height=100% class=gallery-image></p><p>透過元件我們能更好的整理可重複使用的程式碼，也提升了可維護性，而 Nuxt 中的動態載入更是能將非必要使用的元件延遲載入，大大提升了首次進入網頁所需要下載的檔案大小，最後我們也介紹了如何控制伺服器端或客戶端渲染元件，熟悉了之後就能針對網站需求設定元件的載入及渲染方式囉！</p><hr><h2 id=組合式函數-composables>組合式函數 (Composables)</h2><p>組合式函數 (Composables) 是一種利用 Vue 3 的 <strong>Composition API</strong> 來封裝和複用<code>有狀態邏輯</code>的函數，在 Nuxt 我們可以將一些通用的商業邏輯放置在 <code>composables</code> 來建立組合式函數，這樣一來就可以在各個頁面共用這個組合式函數。</p><h3 id=options-api-與-composition-api>Options API 與 Composition API</h3><ul><li>選項式 API (Options API)：</li></ul><p>下列這段是 Vue 依據 Options API 撰寫出來的程式碼，也是 Vue 2 處理邏輯的寫法，所謂 Options (選項、可選的) 指的就是以程式碼的性質來分割程式碼，所有設定資料初始值的都會在 <strong>data</strong> 這邊處理，這個元件所需要的方法則會在 <strong>methods</strong> 這裡建立，<strong>data</strong> 及 <strong>methods</strong> 也就是使用者需要的<strong>選項</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>doubleCount</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>incrementByTwo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>doubleCount</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>組合式 API (Composition API)：</li></ul><p>目前在 Vue 3 你仍可以繼續使用 Vue 2 的 Options API，但隨著程式碼邏輯的增加，看似有條理的分類，其實對於理解及維護上沒有想像中便利。</p><p>Vue 3 提出的<strong>組合式 API (Composition API)</strong> 則是以邏輯功能來進行分類，你可以將所有與某個功能的 <strong>data</strong>、<strong>computed</strong>、<strong>methods</strong> 與 <strong>watch</strong> &mldr;等，寫在同一個段落行程一個區塊。</p><p>詳細說明可閱讀先前撰寫的<a class=link href=https://wayneblog.ga/2022-08-11/option-api-vs-composition-api/>圖解 Option API vs Composition API</a>文章。</p><h3 id=mixins-與-composables>Mixins 與 Composables</h3><p>在 Options API 可以使用 <code>mixin</code> 來引入可以重複使用的程式碼，讓不同的元件可以共用函數方法，但隨著專案變大，同一個元件可能使用 mixin 同時來引用許多的共用函數，這將導致容易產生命名衝突、元件間的耦合與來源不夠清晰等問題（詳細原因請參考<a class=link href=https://wayneblog.ga/2022-12-30/why-use-hooks/>淺談為什麼 Vue 和 React 都選擇了 Hooks？</a>）。</p><p>Vue 3 為我們帶來了組合式 API，實現了更乾淨的程式碼編排與高效的邏輯重用，**組合式函數 (Composables)**也基於組合式 API 來進行封裝這些可複用的邏輯，更解決了使用 mixin 實現共用函數的缺點。</p><h3 id=組合式函數-composables-1>組合式函數 (Composables)</h3><p>在 Nuxt 3 中要建立一個<code>組合式函數 (Composables)</code> 我們可以在 <code>composables</code> 目錄下編寫，這些常用的函數，將會被 Nuxt 3 自動載入做使用，實現在各個元件使用這些函數方法。</p><h4 id=建立組合式函數>建立組合式函數</h4><p>首先，我們新增 <strong>./composables/useCounter.js</strong>，內容如下：</p><h5 id=composablesusecounterjs>composables/useCounter.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Nuxt 自動導入的特性，現在我們就能在其他元件中使用 <strong>useCounter</strong> 組合式函數。</p><p>新增 <strong>./pages/count.vue</strong>，內容如下：</p><h5 id=pagescountvue>pages/count.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 text-4xl text-gray-700&#34;</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>      <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-6 rounded-sm bg-sky-600 py-2 px-4 text-base font-medium text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nt>@click</span><span class=s>=&#34;increment&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>增加</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>count</span><span class=p>,</span> <span class=nx>increment</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useCounter</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=composables-組合式函數的名稱>Composables 組合式函數的名稱</h3><p>前面範例使用的 <code>useCounter()</code> 是 Nuxt 3 從 <strong>./composables/useCounter.js</strong> 自動載入的，而且 Nuxt 3 的組合式函數的名稱，有兩種方式會影響使用時的函數名稱，不過也建議在建立組合式函數可以使用 <code>use</code> 作為開頭來加以識別。</p><h4 id=1-使用預設匯出-default-export>1. 使用預設匯出 (Default export)</h4><p>如果在檔案內使用的是預設匯出，那麼這個組合式函數在使用時，即<code>對應檔案名稱</code>，檔案名稱可以是小寫駝峰式 (Camel case) 或烤肉串 (Kebab case)，例如建立 <strong>./composables/useCounter.js</strong> 或 <strong>./composables/use-counter.js</strong> 檔案內容如下，使用時組合式函數為小寫駝峰式(Camel case) 名為 <code>useCounter</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2-使用具名匯出-named-export>2. 使用具名匯出 (Named export)</h4><p>如果建立組合式函數時，使用的是有具名的匯出，那麼<code>組合式函數對應的名稱，就不是檔案名稱，而是檔案內 export 出來的名稱</code>。</p><p>例如，建立 <strong>./composables/count.js</strong>，檔案內容如下，組合式函數名稱就不會是檔案名稱 count，而是具名導出的名稱 <code>useCounter</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCounter</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=composables-自動載入的規則>Composables 自動載入的規則</h3><p><strong>composables</strong> 目錄下，Nuxt 3 會自動掃描 <strong>.js</strong>、<strong>.ts</strong> 與 <strong>.vue</strong> 副檔名的檔案，但只有<code>最上層的檔案</code>，才會自動的被載入為組合式函數，以下面這個目錄結構為例，只有 <strong>./composables/useCounter.js</strong> 才會被正確的自動載入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>composables/
</span></span><span class=line><span class=cl>├── time/
</span></span><span class=line><span class=cl>│   └── useDateFormat.js
</span></span><span class=line><span class=cl>└── useCounter.js
</span></span></code></pre></td></tr></table></div></div><p>下列這種形式，<strong>./composables/time/index.js</strong> 也能正確的自動載入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>composables/
</span></span><span class=line><span class=cl>├── time/
</span></span><span class=line><span class=cl>│   └── index.js
</span></span><span class=line><span class=cl>└── useCounter.js
</span></span></code></pre></td></tr></table></div></div><p>如果你想讓巢狀的目錄結構下也能被 Nuxt 自動掃描載入，那麼你可以使用下面兩種方法：</p><h4 id=一重新匯出-span-classfocus推薦span>一、重新匯出 <span class=focus>[推薦]</span></h4><p>配置 <strong>./composables/index.js</strong> 將目錄下的函數於這裡整理並匯出你需要的作為組合式函數。</p><h4 id=二配置掃描巢狀目錄>二、配置掃描巢狀目錄</h4><p>修改 <code>nuxt.config.ts</code> 檔案，配置自動載入額外掃描 <code>composables</code> 下的巢狀目錄。</p><h5 id=nuxtconfigts-1>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>imports</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>dirs</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 掃描 composables 目錄頂層
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=s1>&#39;composables&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 掃描深度一層的特定檔案
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=s1>&#39;composables/*/index.{ts,js,mjs,mts}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 掃描整個 composables 目錄下的檔案
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=s1>&#39;composables/**&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>不論在 Nuxt 3 或是 Vue 3，組合式函數 (Composables) 都是能幫助你在整個網站可以共用函數的方法，目前也有專案 <a class=link href=https://vueuse.org/ target=_blank rel=noopener>VueUse</a> 提供了常用與實用的組合式函數集合，能幫我們省去不少開發時間與提升重複使用性，<a class=link href=https://wayneblog.ga/2022-12-30/npm-vueuse/>VueUse的介紹請點我前往</a>。</p><hr><h2 id=插件-plugins>插件 (Plugins)</h2><p>在開發時，為了不重複造輪子，我們可能會在網路上找看看有沒有現成的套件可以做使用，如果這個套件在 Nuxt 3 沒有專用的模組或插件，那麼我們就只能依照套件的支援與安裝方式嘗試添加至 Nuxt 中使用。這邊將會介紹在 Nuxt 插件的規則與特性，如何建立自己的插件及安裝 Vue 的插件。</p><p>說到插件 (Plugins)，Chrome 或 Firefox 等瀏覽器的使用者，一定都聽過也安裝過插件；如果瀏覽器中的功能不夠滿足你的需求，那麼你可以透過安裝插件來嘗試解決你的問題，而插件做的就是幫助你的瀏覽器或是網站，添加一些功能或是配置，做一個擴充的動作。在 Nuxt 3 指的插件，道理也是一樣的，我們可以透過插件來協助我們擴充功能。</p><h3 id=nuxt-3-插件目錄>Nuxt 3 插件目錄</h3><p>Nuxt 將自動讀取 <strong>plugins</strong> 目錄中的檔案並自動載入它們，也因為目錄中的所有插件都是自動載入的，因此不必於 <code>nuxt.config.ts</code> 中再個別配置。</p><p>Nuxt 會自動掃描 <strong>plugins</strong> 目錄下的 <strong>.js</strong>、<strong>.ts</strong> 與 <strong>.vue</strong> 副檔名的檔案，但只有最上層的檔案或最上層目錄下的 <strong>index.js</strong> 檔案才會被自動載入。</p><p>例如，只有 <strong>./plugins/myPlugin.js</strong> 及 <strong>./plugins/myPlugin/index.js</strong> 會自動的被 Nuxt 載入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>plugins/
</span></span><span class=line><span class=cl>├── myPlugin/
</span></span><span class=line><span class=cl>│   └── index.js
</span></span><span class=line><span class=cl>└── myPlugin.js
</span></span></code></pre></td></tr></table></div></div><h3 id=如何建立插件>如何建立插件</h3><p>當您建立好插件的檔案後，只需要使用預設導出 Nuxt 3 中的 <code>defineNuxtPlugin</code> 方法，傳遞給插件的唯一參數是 <code>nuxtApp</code>，接著就可以在裡頭實作功能。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>(</span><span class=nx>nuxtApp</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 可以使用 nuxtApp 來做一些事情
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>初次建立插件時，可以嘗試印出 <code>nuxtApp</code> 參數看看，如下圖，<code>nuxtApp</code> 包含了各種的實例 (Instance)，例如我們要使用 Vue 的 <code>app.use</code>，就可以在 <code>nuxtApp</code> 找到 Vue 的實例 <code>vueApp</code>，並透過 <code>nuxtApp.vueApp.use</code> 來安裝 Vue 的插件。</p><p><img src=https://live.staticflickr.com/65535/52616188532_bb5139c839_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=在插件中使用組合式函數-composables>在插件中使用組合式函數 (Composables)</h3><p>你也可以在自定義的插件中使用組合式函數，但在插件中存在著一些限制和差異。</p><h4 id=插件的載入順序>插件的載入順序</h4><p>插件是依照順序來呼叫的，如果你使用的組合式函數，依賴著尚未載入的插件，它將無法正常的執行；除非你很確定插件的載入順序，不然儘量在插件內使用其他會依賴插件或由其他插件所提供的組合式函數。</p><h4 id=依賴-vue-的生命週期>依賴 Vue 的生命週期</h4><p>如果插件內所使用的組合式函數，依賴於 Vue 的生命週期，那麼也會無法正常的執行，因為插件只會綁定到 nuxtApp 的實例上，與 Vue 元件內使用組合式函數綁定的元件實例，有所不同。</p><h3 id=automatically-providing-helpers>Automatically Providing Helpers</h3><p>如果想在 NuxtApp 的實例上提供 <code>helper</code>，我們可以在插件回傳的物件中添加 <code>provide</code>。</p><p>例如，我們建立一個插件 <strong>./plugins/myPlugin.js</strong>，內容如下：</p><h5 id=pluginsmypluginjs>plugins/myPlugin.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>provide</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>hello</span><span class=o>:</span> <span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=sb>`Hello </span><span class=si>${</span><span class=nx>msg</span><span class=si>}</span><span class=sb>!`</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>調整 <strong>./app.vue</strong> 內容：</p><h5 id=appvue-11>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-2 text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>title</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-2 text-6xl font-semibold text-emerald-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>$hello</span><span class=p>(</span><span class=s1>&#39;Jennifer&#39;</span><span class=p>)</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>$hello</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useNuxtApp</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>$hello</span><span class=p>(</span><span class=s1>&#39;Ryan&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們就可以直接在 <strong>template</strong> 中使用 <code>$hello</code>，這個由插件提供的 <strong>Helper</strong>，注意這邊要加上錢字符號 <code>$</code>。也可以透過 <code>useNuxtApp</code> 方法取得 NuxtApp 的實例後再使用 <code>$hello</code>。</p><p><img src=https://live.staticflickr.com/65535/52616964639_61f022bcfe_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=僅限伺服器端或客戶端中使用>僅限伺服器端或客戶端中使用</h4><p>有些插件可能只能在瀏覽器中使用，原因可能是這個插件不需要或無法在伺服器端中執行。</p><p>我們可以透過插件的檔案名稱來添加後綴 <code>.client</code> 或 <code>.server</code>，控制伺服器端或客戶端中使用。</p><h3 id=vue-插件與指令>Vue 插件與指令</h3><p>這裡我們嘗試在 Nuxt 3 中使用 Vue 的 <a class=link href=https://github.com/MatteoGabriele/vue-gtag target=_blank rel=noopener>vue-gtag</a> 插件，來添加 Google 分析標籤。</p><h3 id=nuxt-3-中使用-vue-gtag-插件>Nuxt 3 中使用 vue-gtag 插件</h3><h4 id=step-1-安裝套件>Step 1. 安裝套件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D vue-gtag-next
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D vue-gtag-next</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-建立-nuxt-插件>Step 2. 建立 Nuxt 插件</h4><p>新增 <strong>vue-gtag.client.js</strong> 檔案，內容如下：</p><h5 id=pluginsvue-gtagclientjs>plugins/vue-gtag.client.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>VueGtag</span> <span class=nx>from</span> <span class=s1>&#39;vue-gtag-next&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>((</span><span class=nx>nuxtApp</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>nuxtApp</span><span class=p>.</span><span class=nx>vueApp</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>VueGtag</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>property</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span><span class=o>:</span> <span class=s1>&#39;GA_MEASUREMENT_ID&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=完成效果>完成效果</h4><p>可以看見瀏覽器就出現使用 vue-gtag 插件，幫我們自動插入與配置 script 的效果囉！</p><p><img src=https://live.staticflickr.com/65535/52617186723_d4fd2eee98_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=nuxt-3-中建立-vue-指令>Nuxt 3 中建立 Vue 指令</h3><p>在插件中可以取得 Vue 的實例，所以我們也能在插件註冊自定義的指令。</p><p>例如，新增 <strong>./plugins/directive.js</strong> 檔案，內容如下：</p><h5 id=pluginsdirectivejs>plugins/directive.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>((</span><span class=nx>nuxtApp</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>nuxtApp</span><span class=p>.</span><span class=nx>vueApp</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;focus&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mounted</span><span class=p>(</span><span class=nx>el</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=p>.</span><span class=nx>focus</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSSRProps</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// you can provide SSR-specific props here
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們就可以直接使用 <code>v-focus</code> 這個指令來控制元素聚焦的效果。</p><p><img src=https://live.staticflickr.com/65535/52616964679_7e9f1e5d2c_o.gif max-width=100% max-height=100% class=gallery-image></p><p>Nuxt 讓我們可以很輕鬆的建立插件並選擇配置於伺服器端或客戶端，對於使用 UI 框架或元件，更能在插件中直接取得實例來安裝 Vue 的插件與指令，不過呢，目前也有個 <a class=link href=https://github.com/nuxt/framework/discussions/1175 target=_blank rel=noopener>RFC</a> 正在徵求意見期待讓 Nuxt 使用 Vue 插件可以更方便容易。</p><hr><h2 id=模組-modules>模組 (Modules)</h2><p>Nuxt 提供了一個模組系統來擴展自身框架的核心，也簡化了整合過程中需要的繁瑣配置。當你想擴展 Nuxt 或 Vue 的功能，雖然 Nuxt 可以通過安裝與配置插件進行功能擴展，但是在多個專案或使用上可能繁瑣耗時或重複性很高的，但如果套件已經有針對 Nuxt 模組做整合，我們就不必從頭開始開發或像安裝插件一樣需要建立與維護這些配置。</p><h3 id=nuxt-3-中插件與模組的差異>Nuxt 3 中插件與模組的差異</h3><p>Nuxt 模組與 Nuxt 插件的差異在於，<code>模組載入執行的時間點更早</code>，意思是 Nuxt 在啟動伺服器後，首先會<code>依序的載入模組並執行</code>，接續建立 Nuxt 的環境 (Context) 與 Vue 的實例 (Instance)，最後才開始執行 Nuxt 的插件。</p><p>因此，Nuxt 模組可以做更多的事情，包含在使用 <code>nuxi dev</code>、<code>nuxi build</code> 啟動或建構 Nuxt 時，可以透過模組來覆蓋模板、配置 webpack 及配置插件等許多任務。</p><h3 id=nuxt-3-安裝使用模組>Nuxt 3 安裝使用模組</h3><p>Nuxt 模組是一個導出異步函數的 JavaScript 檔案，當安裝使用模組時，通常會配置在 <code>nuxt.config.ts</code> 檔案的 <code>modules</code> 中，例如<a class=link href=https://wayneblog.ga/2023-01-14/nuxt-try-nuxt3/#%e4%bd%bf%e7%94%a8-nuxt-tailwind-%e6%a8%a1%e7%b5%84>使用 Nuxt Tailwind 模組</a> 會添加上 <strong>&rsquo;@nuxtjs/tailwindcss&rsquo;</strong>。</p><p>通常模組的開發人員會提供這些模組應該如何在 <strong>modules</strong> 屬性來做配置，甚至一些可選用的參數來配置這些模組。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=kr>module</span><span class=nx>s</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用套件名稱 (推薦使用)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;@nuxtjs/example&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 載入本地目錄的模組
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;./modules/example&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加模組的選項參數
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>[</span><span class=s1>&#39;./modules/example&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>token</span><span class=o>:</span> <span class=s1>&#39;123&#39;</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 在行內定義模組
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=p>(</span><span class=nx>inlineOptions</span><span class=p>,</span> <span class=nx>nuxt</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=nuxt-3-模組列表>Nuxt 3 模組列表</h3><p>你可以在 <a class=link href=https://nuxt.com/modules target=_blank rel=noopener>Explore Nuxt Modules</a> 上尋找由 Nuxt 官方或社群生態所發展建置的模組，Nuxt 的模組通常遵循著官方指南所製，使用時只需要安裝與添加至 <strong>nuxt.config</strong> 中，基本上就能完成配置。</p><h3 id=使用-nuxt-icon-模組>使用 Nuxt Icon 模組</h3><p>Nuxt Icon 模組整合了 Iconify 提供多達 100,000 個以上的 Icon 圖示，只要在 Nuxt 中安裝後，我們就可以直接做使用。</p><h4 id=step-1-安裝套件-1>Step 1. 安裝套件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D nuxt-icon
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D nuxt-icon</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-2-配置使用模組>Step 2. 配置使用模組</h4><p>在 <strong>nuxt.config.ts</strong> 中的 <strong>modules</strong> 屬性，添加 Nuxt Icon 模組的名稱 <code>nuxt-icon</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=kr>module</span><span class=nx>s</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;nuxt-icon&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-開始使用>Step 3. 開始使用</h4><p>依照說明，我們就可以使用 Nuxt Icon 模組，為我們所添加的元件 <code>&lt;Icon></code>，這個 Icon 元件可以傳入 <strong>name</strong> 屬性，以此來顯示不同的 Icon 圖示，<strong>size</strong> 則可以控制圖示的大小。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex justify-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Icon</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;logos:nuxt&#34;</span> <span class=na>size</span><span class=o>=</span><span class=s>&#34;360&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52617186748_8c9b770823_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=如何建立-nuxt-模組>如何建立 Nuxt 模組</h3><p><a class=link href=https://nuxt.com/docs/api/advanced/kit target=_blank rel=noopener>Nuxt Kit</a> 是 Nuxt 官方提供的一個標準和方便的 API 來定義 Nuxt 模組。</p><p>通常使用如下程式碼使用 <code>defineNuxtModule</code> 方法來建立一個模組：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineNuxtModule</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@nuxt/kit&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtModule</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>meta</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 模組的名稱，通常也會對應 NPM 發布的套件名稱
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;@nuxtjs/example&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果有配置這個模組的一些選項，會將其保存在這個設定鍵值下
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>configKey</span><span class=o>:</span> <span class=s1>&#39;sample&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 相容性限制 `nuxt.config`
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>compatibility</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 為了控制模組的版本相容性，通常會在這裡配置 Nuxt 版本的需求
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>nuxt</span><span class=o>:</span> <span class=s1>&#39;^3.0.0&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 模組預設的選項
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>defaults</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=nx>hooks</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>setup</span><span class=p>(</span><span class=nx>moduleOptions</span><span class=p>,</span> <span class=nx>nuxt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Nuxt 啟動載入模組後，模組所執行的邏輯會在這裡實作
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>更多 Nuxt 模組的建立指南可以參考 <a class=link href=https://nuxt.com/docs/guide/going-further/modules target=_blank rel=noopener>Nuxt 3 - Module Author Guide</a>，這邊就不再贅述，畢竟我們比較常為模組的使用者。</p><h3 id=模組的載入>模組的載入</h3><p>前面我們使用了 Nuxt Icon 模組，我們也可以閱讀一下 <a class=link href=https://github.com/nuxt-modules/icon/tree/v0.1.6 target=_blank rel=noopener>Nuxt Icon v0.1.6</a> 模組套件的原始碼。</p><p>以下是 Nuxt Icon 模組的 <a class=link href=https://github.com/nuxt-modules/icon/blob/v0.1.6/src/module.ts target=_blank rel=noopener>module.ts</a> 檔案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtModule</span><span class=p>&lt;</span><span class=nt>ModuleOptions</span><span class=p>&gt;({</span>
</span></span><span class=line><span class=cl>  <span class=nx>meta</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;nuxt-icon&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>configKey</span><span class=o>:</span> <span class=s1>&#39;icon&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>compatibility</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>nuxt</span><span class=o>:</span> <span class=s1>&#39;^3.0.0-rc.9&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>defaults</span><span class=o>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span> <span class=p>(</span><span class=nx>_options</span><span class=p>,</span> <span class=nx>nuxt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>resolve</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>createResolver</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>addComponent</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Icon&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=kr>global</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>filePath</span>: <span class=kt>resolve</span><span class=p>(</span><span class=s1>&#39;./runtime/Icon.vue&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>Nuxt 的模組使用了一個 <code>defineNuxtModule</code> 方法來定義模組，也可以視為模組的入口點，<code>meta.name</code> 對應的就是模組的名稱，也是我們添加至 <code>modules</code> 屬性所需要的模組名稱。</p><p><code>setup</code> 就是模組載入後執行的函數，可以看到模組使用 <code>addComponent</code> 為我們 Nuxt 添加了一個元件名稱為 <strong>Icon</strong>，使用的元件檔案來自 <strong>./runtime/Icon.vue</strong>。</p><p>模組中的 <a class=link href=https://github.com/nuxt-modules/icon/blob/v0.1.6/src/runtime/Icon.vue target=_blank rel=noopener>runtime/Icon.vue</a> 為我們封裝了 Iconify 圖示的使用邏輯以及取得 Nuxt 配置的參數等。</p><p>透過模組我們可以省去這些繁瑣的封裝與配置，只需要專注在配置模組與開發上面。</p><p>模組與插件其實還是存在著載入執行順序與使用情境上的差異性，以 Nuxt 來說，通常 Nuxt 的插件會是用來封裝及使用 Vue 中會使用到的插件與或套件；而 Nuxt 的模組，會將需要繁瑣配置的套件或插件來與 Nuxt 進行整合與封裝，不論是透過第三方插件或模組，這都將使 Nuxt 在開發與擴充上擁有更多的可能性。</p><hr><h2 id=中間件目錄-middleware-directory>中間件目錄 (Middleware Directory)</h2><p>在 Vue 的專案內我們的頁面通常由 Vue Router 來控制路由及導航，Vue Router 提供了導航守衛 (Navigation Guards) 的 Hook API，讓我們可以在全域、路由甚至是元件中，來控制路由跳轉或取消的方式來守護我們的路由，不讓其隨意導航至特定頁面。Nuxt 3 提供了一個中間件的目錄，讓我們可以製作路由的中間件，來實作出類似導航守衛的效果。</p><h3 id=vue-router-的導航守衛-navigation-guards>Vue Router 的導航守衛 (Navigation Guards)</h3><p>導航守衛就是在訪問頁面之前，會攔截你的路由請求並執行自訂的驗證邏輯，依據驗證的成功與否，准予放行跳轉至路由頁面，抑或是取消訪問該路由，再依照不同處理方式進行中斷或重導向至特定路由頁面。</p><p>導航守衛在實務上常見的使用情境，就是拿來做頁面訪問的權限驗證，例如，只有管理員才能訪問 <code>/admin</code> 路由下的頁面，我們可能就會添加攔截的 hook 來驗證使用者是否登入及夾帶的 Token 或 Role 是否有權限可以瀏覽，如果驗證成功就准予瀏覽管理員相關頁面，否則，將路由頁面導回至首頁、登入頁或錯誤頁面，如同一個守衛在路由之間進行把關驗證權限。</p><p>我們以 Vue Route v4 來舉例，Vue Route 提供了以下三種情況下可以使用的 hook，分別是在全域、路由或是元件中：</p><h3 id=全域>全域</h3><h4 id=全域前置守衛-global-before-guards>全域前置守衛 (Global Before Guards)</h4><p>當全域守衛 hook 添加好之後，每次導航至不同路由時，都會攔截以異步的方式執行相對應的處理邏輯。</p><p>全域守衛提供了 <code>router.beforeEach()</code> hook 可以在進入任何一個路由前進行攔截處理，當導航觸發時就會依照建立的順序做呼叫，因為是異步函數解析執行，所以在所有的守衛 <strong>resolve</strong> 之前，會一直處於 <strong>pending</strong> 的狀態。</p><h4 id=全域解析守衛-global-resolve-guards>全域解析守衛 (Global Resolve Guards)</h4><p>而同樣屬於全域守衛的 <code>router.beforeResolve()</code> hook 會在所有元件內的導航守衛、路由都被解析及執行完畢後才執行，也就是說這個 <code>router.beforeResolve()</code> 呼叫的時間點晚於 <code>router.beforeEach()</code>。</p><h4 id=全域後置-hooks-global-after-hooks>全域後置 Hooks (Global After Hooks)</h4><p>與 <code>router.beforeEach()</code> hook 相反，全域後置 hooks 提供的 <code>router.afterEach()</code> Hook 會是在路由跳轉結束後才觸發，在這裡路由已經完成跳轉，路由本身也不會再被更動，這個 hook 通常用於分析類或設置頁面相關的資訊等輔助型的功能很有幫助。</p><h3 id=路由獨有守衛-per-route-guard>路由獨有守衛 (Per-Route Guard)</h3><p>與 <strong>router.beforeEach()</strong> 不同，我們可以為每一個路由添加 <code>beforeEnter()</code> hook，來達到每一個路由頁面有不同的執行方法，同時也只會在不同的路由導航中切換才會觸發。</p><h3 id=元件內的守衛>元件內的守衛</h3><p>在元件的內部中，也提供三種 hooks 分別為：</p><ul><li>beforeRouteEnter(): 在路由進入並渲染這個元件之前呼叫，所以還沒有元件的實體可以操作使用。</li><li>beforeRouteUpdate(): 目前的路由改變，而且還處於同一個元件中時呼叫。</li><li>beforeRouteLeave(): 當導航準備離開時且沒有使用到這個元件時呼叫。</li></ul><p>導航守衛 (Navigation Guards) 在導航出發後的 hook 觸發順序如下圖：</p><p><img src=https://live.staticflickr.com/65535/52616698461_6a2572bcab_o.png max-width=100% max-height=100% class=gallery-image></p><hr><h2 id=nuxt-3-路由中間件>Nuxt 3 路由中間件</h2><p>Nuxt 3 中提供了一個路由中間件的框架，我們可以在專案下建立名為 <code>middleware</code> 目錄，在這個目錄下我們可以建立中間件，並讓整個 Nuxt 頁面或特定的路由做使用，也可以在頁面中添加，這個中間件可以理解為 Vue Router 中的導航守衛 (Navigation Guards)，同樣有 <code>to</code> 與 <code>from</code> 參數用以在導航至特定路由之前驗證權限或執行商業邏輯等。</p><h3 id=路由中間件格式>路由中間件格式</h3><p>當我們想要建立路由中間件時，可以在 Nuxt 專案的 <code>middleware</code> 目錄下建立檔案，並預設匯出一個由 <code>defineNuxtRouteMiddleware()</code> 定義的函數，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtRouteMiddleware</span><span class=p>((</span><span class=nx>to</span><span class=p>,</span> <span class=nx>from</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>to</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>id</span> <span class=o>===</span> <span class=s1>&#39;1&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>abortNavigation</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>navigateTo</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>路由中間件能接收目前的路由 <code>to</code> 與下一個路由 <code>from</code> 做為參數，如同 Vue Router 的導航守衛，以此我們就可以來做一些判斷與驗證操作。</p><h3 id=路由中間件的回傳>路由中間件的回傳</h3><p>Nuxt 提供了兩個全域的 helpers，可以直接從中間件回傳：</p><h4 id=navigatetoto-options>navigateTo(to, options)</h4><p>在插件或中間件中重新定向到給定的路由。也可以直接呼叫它進行頁面導航。</p><p>navigateTo 參數依序為：</p><ul><li><strong>to</strong>： RouteLocationRaw | undefined | null</li><li><strong>options</strong>： { replace: boolean, redirectCode: number, external: boolean }</li></ul><h4 id=abortnavigationerr>abortNavigation(err)</h4><p>可以在中間件中回傳 <code>abortNavigation()</code> 來中止導航，並可以選擇是否傳入錯誤訊息。</p><p>abortNavigation 參數為：</p><blockquote><p>err?: string | Error</p></blockquote><p>與 Vue Router 中的導航守衛稍有不同，在 Nuxt 的中間件中可以使用 <code>navigateTo</code> 與 <code>abortNavigation</code> 來決定導航至新的路由或終止導航，如果中間件沒有回傳任何東西，則表示不阻塞導航，如果有下一個中間件，則而移往下一個功能做執行，或者完成路由導航。</p><ul><li>nothing - 不阻塞導航並且會移動到下一個中間件功能。</li><li>如果有的話，或者完成路由導航 return navigateTo(&rsquo;/&rsquo;) 或 return navigateTo({ path: &lsquo;/&rsquo; }) - 重定向到給定路徑。</li></ul><p>如果使用 <code>navigateTo()</code> 重定向是發生在伺服器端 ，則將 HTTP Status Code 設置為<code>暫時</code>重定向狀態碼 <strong>302 Found</strong>。</p><p>如果使用 <code>navigateTo()</code> 並夾入 <code>options.redirectCode</code> 屬性，例如 <code>return navigateTo('/', { redirectCode: 301 })</code>，發生的重定向在伺服器端，將 HTTP Status Code 設置為<code>永久</code>重定向狀態碼 <strong>301 Moved Permanently</strong>。</p><h3 id=路由中間件的種類>路由中間件的種類</h3><p>在 Nuxt 中路由中間件分為以下三種：</p><h4 id=匿名或者是行內的路由中間件>匿名或者是行內的路由中間件</h4><p>不需要建立檔案，通常在路由頁面中使用 <code>definePageMeta()</code> 來定義的中間件，就屬於這種類型。</p><p>例如，直接定義一個匿名的中間件在頁面元件中使用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>middleware</span><span class=o>:</span> <span class=nx>defineNuxtRouteMiddleware</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[匿名中間件] 我是直接定義在頁面內的匿名中間件`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=具名的路由中間件>具名的路由中間件</h4><p>在 <code>middleware</code> 目錄下所建立的中間件，當在頁面使用 <code>definePageMeta()</code> 來指定使用具名的中間件時，將透過異步來自動載入。具名的路由的名稱被規範為是烤肉串式 (Kebab case) 命名。</p><p>例如，建立一個 <strong>./middleware/random-redirect.js</strong> 中間件檔案：</p><h5 id=middlewarerandom-redirectjs>middleware/random-redirect.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtRouteMiddleware</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[來自 random-redirect 中間件] 重新導向至 /haha`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>navigateTo</span><span class=p>(</span><span class=s1>&#39;/haha&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[來自 random-redirect 中間件] 沒發生什麼特別的事情～`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們要使用這個中間件時，可以在頁面中使用 <code>definePageMeta()</code> 並傳入 <code>middleware</code> 屬性，來添加路由中間件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>middleware</span><span class=o>:</span> <span class=s1>&#39;random-redirect&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果中間件有多個，你也可以使用陣列來傳入多個中間件，並且會依序執行這些路由中間件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>middleware</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;random-redirect&#39;</span><span class=p>,</span> <span class=s1>&#39;other&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們在頁面中添加這個中間件後，在切換到這個路由頁面時，約有一半的機會，會被導航至 <strong>/haha</strong> 頁面。</p><p><img src=https://live.staticflickr.com/65535/52617186763_d4ff53ce17_o.gif max-width=100% max-height=100% class=gallery-image></p><h4 id=全域的路由中間件>全域的路由中間件</h4><p>在具名的中間件的檔名添加後綴 <code>.global</code>，如 <strong>auth.global.js</strong>，這個路由中間件將會被自動載入，並在每次導航變更時自動執行。</p><p>例如，我們建立一個 <strong>./middleware/always-run.global.js</strong> 中間件檔案，內容如下：</p><h5 id=middlewarealways-runglobaljs>middleware/always-run.global.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtRouteMiddleware</span><span class=p>((</span><span class=nx>to</span><span class=p>,</span> <span class=nx>from</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`[全域中間件] to: </span><span class=si>${</span><span class=nx>to</span><span class=p>.</span><span class=nx>path</span><span class=si>}</span><span class=sb>, from: </span><span class=si>${</span><span class=nx>from</span><span class=p>.</span><span class=nx>path</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>這個全域的路由中間件，將會在每一次導航切換頁面時執行。</p><p><img src=https://live.staticflickr.com/65535/52617134335_bac452e9f6_o.gif max-width=100% max-height=100% class=gallery-image></p><h4 id=動態添加路由中間件>動態添加路由中間件</h4><p>你可以使用 <code>addRouteMiddleware()</code> 輔助函數來手動添加全域或命名路由中間件，例如在插件中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>addRouteMiddleware</span><span class=p>(</span><span class=s1>&#39;global-test&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;這個是由插件添加的全域中間件，並將在每次路由變更時執行&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{</span> <span class=nx>global</span><span class=o>:</span> <span class=kc>true</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addRouteMiddleware</span><span class=p>(</span><span class=s1>&#39;named-test&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;這個是由插件添加的具名中間件，並將會覆蓋任何現有的同名中間件&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>在 Nuxt 中我們可以使用所提供的中間件框架，來建立路由頁面中的中間件，而路由中間件會在到特定路由之前執行想要運行的邏輯，對於驗證權限等非常方便，也正是實現導航守衛 (Navigation Guards) 的方式。這裡我們主要講述的路由中間件，也將會與我們後面會提到的伺服器端的中間件有所不同，雖然名稱相似但與 Nitro 啟動時執行的伺服器中間件<code>完全不同</code>。</p><hr><h2 id=server-api-與-nitro-engine>Server API 與 Nitro Engine</h2><p>這裡會先介紹一下 Nitro Engine 是什麼東西，<a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 可能不多人聽過但與 Nuxt 3 息息相關，<a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 伺服器引擎除了有跨平台支援與多種強大的功能外，更包含了 API 路由的支援，意思就是我們可以直接在基於 <a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 的 Nuxt 3 上直接開發由後端處理的邏輯或與資料庫互動，再將結果回傳至前端，實作出 Server API。</p><h3 id=nitro-engine>Nitro Engine</h3><p>在開始建置 Sever API 之前，先來介紹一下 Nitro 伺服器引擎，Nuxt 3 的一大特點就是採用了一個名為 <a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 的伺服器引擎 (Server Engine)，<a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 基於 rollup 與 <a class=link href=https://github.com/unjs/h3 target=_blank rel=noopener>h3</a>，為達高效能與可移植性目標而建構的最小 <code>HTTP</code> 框架。</p><p><a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 提供了以下多種功能特色，使得 Nuxt 更佳完善與強大，如同官網所說 <strong><a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 讓 Nuxt 直接解鎖了新的全端能力</strong>。</p><ul><li><strong>快速的開發體驗</strong>：開箱即用的特性，無需任何配置，就可以啟動具有 <strong>hot module reloading</strong> 的開發伺服器，寫完程式碼存檔後，就能讓伺服器載入新的程式邏輯。</li><li><strong>基於檔案系統的路由</strong>：我們只需要專注在建立伺服器的目錄與頁面，就能擁有自動載入與路由的效果。</li><li><strong>可移植且便攜</strong>：基本上 Nuxt 3 使用的依賴套件都在 <strong>package.json</strong> 檔案的 <strong>devDependencies</strong> 中，建構正式環境的網站時，<a class=link href=https://github.com/unjs/nitro target=_blank rel=noopener>Nitro</a> 自動拆分的程式碼與打包出來的 <code>.output</code> 目錄不再需要安裝依賴套件，意味著不再有 <strong>node_modules</strong>，因此部署時更輕便好攜。</li><li><strong>混合模式</strong>：透過**混合模式 (Hybrid mode)**可以將一部分頁面預渲染產生出靜態頁面，部分頁面是動態的在伺服器或客戶端渲染，讓每個路由頁面有不同的靜態或動態甚至擁有快取規則，這將讓 Nuxt 3 的<a class=link href=https://nuxt.com/docs/guide/concepts/rendering#universal-rendering target=_blank rel=noopener>通用渲染 (Universal Rendering)</a> 方式更進一步成<a class=link href=https://nuxt.com/docs/guide/concepts/rendering#hybrid-rendering target=_blank rel=noopener>混合渲染 (Hybrid Rendering)</a> 也能結合無伺服器 (Serverless) 來配置混合模式。</li></ul><p>看到這裡，可以發現 Nuxt 3 與 Nitro 都下了非常大的功夫，雖然還有些功能尚未穩定與需要改進的地方，但是已經為開發上提供了強大支援與良好的體驗，更多特性與細節可以參考 <a class=link href=https://nuxt.com/docs/guide/concepts/server-engine target=_blank rel=noopener>Nuxt 3 - Server Engine</a> 或 <a class=link href=https://nitro.unjs.io/ target=_blank rel=noopener>Nitro 官方</a>。</p><h3 id=nuxt-3-的-server-目錄>Nuxt 3 的 Server 目錄</h3><p>我們可以透過 Nuxt 3 專案下的 <code>server</code> 目錄來建立具有 <strong>hot module reloading</strong> 支援的 Server API 與後端處理邏輯。</p><p><strong>server</strong> 目錄常用的有下面三個子目錄：</p><ul><li>api</li></ul><p>在這個目錄的檔案，將會由 Nuxt 自動載入並產生 <code>/api</code> 開頭的路由並對應檔案名稱，例如建立 <strong>./server/api/hello.js</strong>，就會擁有 <strong>/api/hello</strong> 的路由對應這個 API，可以使用 <a class=link href=http://localhost:3000/api/hello target=_blank rel=noopener>http://localhost:3000/api/hello</a> 訪問該路由。</p><ul><li>routes</li></ul><p>在這個目錄的檔案，將會由 Nuxt 自動載入並產生對應檔案名稱的路由，例如建立 <strong>./server/routes/world.js</strong>，就會擁有 <code>/world</code> 的路由對應這個 API，可以使用 <a class=link href=http://localhost:3000/world target=_blank rel=noopener>http://localhost:3000/world</a> 訪問該路由。</p><ul><li>middleware</li></ul><p>在這個目錄的檔案，會被 Nuxt 自動載入，並添加至<code>伺服器中間件</code>，並在每個 Request 進入伺服器 API 的路由前執行。</p><h3 id=建立第一個伺服器-api>建立第一個伺服器 API</h3><p>Nuxt 會自動掃描 <code>server</code> 目錄中的檔案結構，建立 Server API 時通常以 <strong>.js</strong> 或 <strong>.ts</strong> 作為副檔名，並依照官方建議，每個檔案都應該預設匯出 <code>defineEventHandler()</code> 函數，並在其 handler 內實作處理邏輯。</p><p>handler 接收了一個 <code>event</code> 參數，用來解析請求的資料，並可以直接回傳一個<strong>字串</strong>、<strong>JSON</strong>、<strong>Promise</strong> 或者使用 <strong>event.res.end()</strong> 送出請求回應。</p><p>舉例來說，我們建立一個檔案 <strong>./server/api/hello.js</strong>，內容如下：</p><h5 id=serverapihellojs>server/api/hello.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=s1>&#39;Hello World!&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如同 <code>pages</code> 頁面路由一樣，在 <strong>./server/api</strong> 目錄下會基於檔案系統結構來產生出相對應的路由，並且會添加一個路由前綴 <code>/api</code>，現在，可以使用 <a class=link href=http://localhost:3000/api/hello target=_blank rel=noopener>http://localhost:3000/api/hello</a> 訪問該路由，看見回傳的 JSON 資料。</p><p><img src=https://live.staticflickr.com/65535/52616964704_e3841ca57a_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=伺服器路由>伺服器路由</h3><h4 id=基於檔案的路由>基於檔案的路由</h4><p>前面的例子有提到，Server API 的路由是<code>基於檔案結構來自動產生</code>，如果你不想要有 <code>/api</code> 的前綴，可以將 API 處理邏輯檔案，放置在 <strong>./server/routes</strong> 目錄中。</p><p>舉例來說，以下的檔案結構會產生兩個可以訪問的伺服器 API 路由，分別為 <strong>/api/hello</strong> 及 <strong>/api/world</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxt-app/
</span></span><span class=line><span class=cl>└── server/
</span></span><span class=line><span class=cl>    ├── api/
</span></span><span class=line><span class=cl>    │   └── hello.js
</span></span><span class=line><span class=cl>    └── routes/
</span></span><span class=line><span class=cl>        └── world.js
</span></span></code></pre></td></tr></table></div></div><h4 id=匹配路由參數>匹配路由參數</h4><p>將檔案名稱添加中括號 <code>[]</code>，其中放入欲設定的參數名稱，以此來處理動態路由匹配。
舉例來說，建立 <strong>./server/api/hello/[name].js</strong> 檔案，內容如下：</p><h5 id=serverapihellonamejs>server/api/hello/[name].js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>name</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>params</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=sb>`Hello, </span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>!`</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>在 handler 內就能使用 <code>event.context.params</code> 來訪問 <strong>name</strong> 路由參數。</p><p><img src=https://live.staticflickr.com/65535/52616698486_37c5da2beb_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=匹配-http-請求方法-http-request-method>匹配 HTTP 請求方法 (HTTP Request Method)</h4><p>我們可以添加 <strong>.get</strong>、<strong>.post</strong>、<strong>.put</strong> 或 <strong>.delete</strong> 等檔案名稱後綴，來匹配對應的 HTTP request methods。</p><p>新增 <strong>server/api/test.get.js</strong>，內容如下：</p><h5 id=serverapitestgetjs>server/api/test.get.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;測試 [GET] /api/test&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>新增 <strong>server/api/test.post.js</strong>，內容如下：</p><h5 id=serverapitestpostjs>server/api/test.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;測試 [POST] /api/test&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們使用 <a class=link href=https://www.postman.com/ target=_blank rel=noopener>Postman</a> 來打這兩隻 API，可以看到使用不同的 HTTP Request Method，就會匹配至對應後綴檔案中的 handler 進行處理。</p><h5 id=get-apitest>[GET] /api/test</h5><p><img src=https://live.staticflickr.com/65535/52616188612_a1886c609d_o.png max-width=100% max-height=100% class=gallery-image></p><h5 id=post-apitest>[POST] /api/test</h5><p><img src=https://live.staticflickr.com/65535/52616964714_af11679e95_o.png max-width=100% max-height=100% class=gallery-image></p><p>從上面的例子，我們建立了 <code>test.get.js</code> 與 <code>test.post.js</code> 檔案，分別對應了 <strong>GET</strong> 與 <strong>POST</strong> 方法，如果同一個路由使用了其他方法而無法匹配處理的檔案時，則會回傳 HTTP 狀態碼 <strong>405 Method Not Allowed</strong> 表示錯誤。</p><h4 id=匹配包羅萬象的路由-catch-all-route>匹配包羅萬象的路由 (Catch-all Route)</h4><p>你可以建立 <code>[…].js</code> 的檔案，來將所有不匹配的路由交由這個 handler 作處理。</p><p>例如，建立 <strong>./server/api/catch-all/[…].js</strong>，將可以匹配 <strong>/api/catch-all/x</strong>、<strong>/api/catch-all/x/y</strong>&mldr;等 <strong>/catch-all</strong> 下所有層級的路由。</p><h5 id=serverapicatch-alljs>server/api/catch-all/[…].js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;/api/catch-all 下不匹配的路由都會進入這裡&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 <strong>./server/api/[…].js</strong> 檔案如下，將可以接手所有 <strong>/api</strong> 下無法匹配的路由。</p><h5 id=serverapijs>server/api/[…].js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;/api 下不匹配的路由都會進入這裡&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>下圖示範中，當我們輸入的路由如果沒有辦法處理，將會被 <code>[...].js</code> 所匹配，以此我們可以來實作返回、重新導向或錯誤頁面。</p><p><img src=https://live.staticflickr.com/65535/52617186823_7aa4ffbd74_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=伺服器中間件>伺服器中間件</h3><p>Nuxt 會自動載入 <code>./server/middleware</code> 中的檔案，並添加至<code>伺服器中間件</code>，伺服器的中間件與路由中間件不同的是，<code>pages</code> 路由頁面的請求是不會執行伺服器中間件。</p><p>伺服器的中間件會在每個 Request 進入伺服器 API 的路由前執行，通常用來添加或檢查請求的標頭 (headers)、記錄請求或擴展調整請求的物件。</p><blockquote><p>伺服器中間件的處理邏輯，不應該回傳任何內容，也不應中斷或直接回應請求，伺服器中間件應該僅檢查、擴展請求上下文或直接拋出錯誤。</p></blockquote><p>舉理來說，你可以新增 <strong>./server/middleware/log.js</strong> 用來記錄每個請求的 URL。</p><h5 id=servermiddlewarelogjs>server/middleware/log.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;New request: &#39;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>或者，新增 <strong>./server/middleware/auth.js</strong> 用來解析請求或擴展請由物件。</p><h5 id=servermiddlewareauthjs>server/middleware/auth.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>event</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>auth</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;ryan&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=伺服器插件>伺服器插件</h3><p>Nuxt 會自動掃描並載入 <code>./server/plugins</code> 目錄下的檔案，並將他們註冊為 Nitro 的插件，在 Nitro 啟動時，這些插件將會在伺服器載入並執行，插件允許擴展 Nitro 執行時的行為及連接到生命週期的事件。</p><p>更多細節可以參考 <a class=link href=https://nitro.unjs.io/guide/advanced/plugins target=_blank rel=noopener>Nitro Plugins</a>。</p><h3 id=伺服器通用功能>伺服器通用功能</h3><p>Nuxt 中伺服器的路由，是由 <a class=link href=https://github.com/unjs/h3 target=_blank rel=noopener>unjs/h3</a> 所提供，h3 內建一些方便實用的 helpers，可以參考 <a class=link href=https://www.jsdocs.io/package/h3#package-index-functions target=_blank rel=noopener>Available H3 Request Helpers</a>。</p><h3 id=伺服器路由常用的-http-請求處理>伺服器路由常用的 HTTP 請求處理</h3><h4 id=處理-http-請求中的-body>處理 HTTP 請求中的 Body</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>readBody</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=nx>body</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>可以使用 <code>readBody(event)</code> 來解析請求中的 Body，注意 <code>readBody()</code> 是一個異步函數，記得 <code>await</code> 等待解析完成。</p><p><img src=https://live.staticflickr.com/65535/52617186843_8c75e8307f_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=處理-url-中的查詢參數-query-parameters>處理 URL 中的查詢參數 (Query Parameters)</h4><p>可以使用 <code>getQuery(evnet)</code> 來解析查詢參數。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>query</span> <span class=o>=</span> <span class=nx>getQuery</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=nx>query</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當請求 URL 為 <strong>/api/query?name=ryan</strong>，可以解析出查詢參數 <strong>query.name</strong>。</p><p><img src=https://live.staticflickr.com/65535/52616964724_f604a17188_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=解析-http-請求所夾帶的-cookie>解析 HTTP 請求所夾帶的 Cookie</h4><p>可以使用 <code>parseCookies(event)</code> 來解析請求所夾帶的 Cookie。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>cookies</span> <span class=o>=</span> <span class=nx>parseCookies</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ok</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>cookies</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我透過瀏覽器的開發工具，手動添加了一組 <strong>cookie</strong> 名為 <code>token</code>，Server API 可以透過 <code>parseCookies()</code> 來解析出瀏覽器自動夾帶的 <strong>cookie</strong>。</p><p><img src=https://live.staticflickr.com/65535/52616698541_f2d257d4c0_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=進階使用範例>進階使用範例</h3><h4 id=nitro-配置>Nitro 配置</h4><p>你可以在 <code>nuxt.config.ts</code> 中使用 <code>nitro</code> 屬性來配置 <a class=link href=https://nitro.unjs.io/config target=_blank rel=noopener>Nitro 設定</a>。</p><h5 id=nuxtconfigts-2>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// https://nitro.unjs.io/config
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>nitro</span><span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=使用巢狀路由>使用巢狀路由</h4><p>你可以直接使用 <a class=link href=https://www.jsdocs.io/package/h3 target=_blank rel=noopener>h3</a> 的 <code>createRouter()</code> 方法來建立巢狀路由。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createRouter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;h3&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>createRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;Hello World&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=伺服器儲存>伺服器儲存</h4><p>Nitro 提供了一個跨平台的<a class=link href=https://nitro.unjs.io/guide/introduction/storage target=_blank rel=noopener>儲存層</a>，你可以 Nitro 的配置中設定 <code>storage</code> 屬性，來配置額外的儲存掛載位置，官網提供了一個<a class=link href=https://nuxt.com/docs/guide/directory-structure/server/#example-using-redis target=_blank rel=noopener>使用 Redis 的範例</a>。</p><p>更多 Nitro 伺服器的設定與使用可以參考<a class=link href=https://nuxt.com/docs/guide/directory-structure/server/ target=_blank rel=noopener>官網</a>。</p><p>Nitro 伺服器引擎將 Nuxt 3 提升至另一個境界，不僅功能強大且讓開發中擁有不錯的體驗，伺服器路由更是能在後端直接處理邏輯實作 Server API，而接下來將介紹如何在 Nuxt 打 API 取得資料。</p><hr><h2 id=資料獲取-data-fetching>資料獲取 (Data Fetching)</h2><p>Nuxt 提供了 <code>$fetch</code> 及四種組合式函數 (Composables)，來進行資料獲取，也就是說，我們不需要再額外安裝任何 HTTP Client ，如 <a class=link href=https://github.com/axios/axios target=_blank rel=noopener>axios</a> 來發送 HTTP 請求，因為 Nuxt 本身就自帶了打 API 的方法，而且在頁面、元件或插件中都能直接呼叫做使用，非常方便。</p><p>首先，我們先介紹一下 <code>$fetch</code> 這個由 Nuxt 提供使用 <a class=link href=https://github.com/unjs/ofetch target=_blank rel=noopener>ohmyfetch</a> 套件所封裝的 helper，<code>$fetch</code> 可以在 Nuxt 中用於發送 HTTP 請求。</p><p>如果在伺服器端渲染的期間，呼叫 <code>$fetch</code> 打內部 API 路由，也就是打我們自己在 <code>./server</code> 下實作的後端 API，那麼因為使用 <code>$fetch</code> 的關係，Nuxt 會模擬請求，改由直接呼叫內部 API 的處理函數，這樣就能節省額外的 API 呼叫。</p><p>使用的方法，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>$fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>options</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>我們可以使用 <strong>$fetch(&rsquo;/api/count&rsquo;)</strong> 建立一個 GET 請求，發送至 <strong>/api/count</strong> 後會返回一個 Promise，完成後我們就可以接收回傳的資料。</p><p><code>$fetch</code> 的 <strong>options</strong> 的參數及建立攔截器等功能可以參考 <a class=link href=https://github.com/unjs/ohmyfetch target=_blank rel=noopener>ohmyfetch</a>，不過呢，我們還會使用 Nuxt 提供的組合函數結合 <strong>$fetch</strong> 來打 API。</p><p>接下來我們就來依序介紹，如何使用 Nuxt 提供的四種組合函數來從 API 獲取資料。</p><h3 id=useasyncdata>useAsyncData</h3><p>這個 <code>useAsyncData()</code> 組合函數，其實不是傳入 URL 直接呼叫就會發出 API 請求，而是 Nuxt 可以透過這個函數來添加異步請求資料的邏輯。</p><p><code>useAsyncData</code> 組合函數能接收 <code>key</code>、<code>handler</code> 與 <code>options</code>，其中 <strong>handler</strong> 會來添加請求異步資料的邏輯。當我們在頁面、元件和插件中呼叫 <strong>useAsyncData</strong>，並等待回傳的 <strong>Promise</strong>，我們的頁面或元件的渲染將會<code>阻塞路由載入</code>至 <strong>handler</strong> 異步邏輯處理完畢後才會繼續執行，也就是說，整個頁面元件將會等待所有使用 <strong>useAsyncData</strong> 呼叫的 API 回傳完成後才會開始進行渲染。</p><p>舉個例子，我們新增一個 Server API，並稍微添加一下延遲，模擬 API 約需要處理 2 秒才回傳資料，<strong>./server/api/count.js</strong> 內容如下：</p><h5 id=serverapicountjs>server/api/count.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span> <span class=c1>// 等待 2 秒
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>counter</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>新增一個路由頁面，<strong>./pages/count/useAsyncData.vue</strong> 內容如下：</p><h5 id=pagescountuseasyncdatavue>pages/count/useAsyncData.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-4xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>瀏覽次數</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-6xl font-semibold text-sky-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>data</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useAsyncData</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/count&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們瀏覽 <strong>/count/useAsyncData</strong> 時，會打 <strong>/api/count</strong> 這隻 API，並等待返回後才開始渲染元件。</p><p><img src=https://live.staticflickr.com/65535/52617186873_0f1db5744d_o.png max-width=100% max-height=100% class=gallery-image></p><p>因為瀏覽 <a class=link href=http://localho:3000/count/useAsyncData target=_blank rel=noopener>http://localho:3000/count/useAsyncData</a> 時，第一次都是由後端渲染處理，看不太出導航有被阻塞的效果，建議可以添加一下路由連結來進行導航，就可以發現差異。</p><p>當我們從首頁，由客戶端導航至 <code>/count/useAsyncData</code> 頁面時，會發現網址的路由已經變化，但是頁面約等了一會兒才渲染出現，這就是因為頁面中使用了 <code>useAsyncData()</code> 來獲取資料，<code>await</code> 將阻塞整個頁面元件的載入與渲染，直至 API 處理完畢回傳後才開始載入路由渲染元件。</p><p><img src=https://live.staticflickr.com/65535/52617186898_35b72a8173_o.gif max-width=100% max-height=100% class=gallery-image></p><p><strong>useAsyncData() 共有兩種呼叫時使用參數差異，可以選擇是否傳入第一個參數 <code>key</code>，所傳入參數的類型如下</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>useAsyncData</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>handler</span><span class=o>:</span> <span class=p>(</span><span class=nx>nuxtApp?</span>: <span class=kt>NuxtApp</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl>  <span class=nx>options?</span>: <span class=kt>AsyncDataOptions</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>AsyncData</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>useAsyncData</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>handler</span><span class=o>:</span> <span class=p>(</span><span class=nx>nuxtApp?</span>: <span class=kt>NuxtApp</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl>  <span class=nx>options?</span>: <span class=kt>AsyncDataOptions</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>AsyncData</span><span class=err>&lt;</span><span class=na>DataT</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>AsyncDataOptions</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>server?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=nx>lazy?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>?:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>DataT</span> <span class=o>|</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span> <span class=o>|</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=o>?:</span> <span class=p>(</span><span class=nx>input</span>: <span class=kt>DataT</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>DataT</span>
</span></span><span class=line><span class=cl>  <span class=nx>pick?</span>: <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>watch?</span>: <span class=kt>WatchSource</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>initialCache?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=nx>immediate?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>RefreshOptions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>_initial?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>AsyncData</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=err>,</span> <span class=na>ErrorT</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>DataT</span> <span class=err>|</span> <span class=na>null</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>pending</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>boolean</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>execute</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>refresh</span><span class=o>:</span> <span class=p>(</span><span class=nx>opts?</span>: <span class=kt>RefreshOptions</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>ErrorT</span> <span class=err>|</span> <span class=na>null</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=useasyncdata-傳入的參數>useAsyncData() 傳入的參數</h4><ul><li><strong>key</strong>：唯一鍵，可以確保資料不會重複的獲取，也就是如果 Key 相同便不會再發送相同的請求，除非重新整理頁面由後端再次渲染獲取，或呼叫 <code>useAsyncData</code> 回傳的 <code>refresh()</code> 函數重新取得資料。</li><li><strong>handler</strong>：回傳異步請求資料的處理函數，打 API 或加工的異步邏輯都可以在這裡處理。</li><li><strong>options</strong>：<ul><li><strong>server</strong>：是否在伺服器端獲取資料，預設為 <code>true</code>。</li><li><strong>lazy</strong>：是否於載入路由後才開始執行異步請求函數，預設為 <code>false</code>，所以會阻止路由載入直到請求完成後才開始渲染頁面元件。</li><li><strong>default</strong>：當傳入這個 factory function，可以將異步請求發送與回傳解析前，設定資料的預設值，對於設定 <code>lazy: true</code> 選項特別有用處，至少有個預設值可以使用及渲染顯示。</li><li><strong>transform</strong>：修改加工 <code>handler</code> 回傳結果的函數。</li><li><strong>pick</strong>：<code>handler</code> 若回傳一個物件，只從中依照需要的 key 取出資料，例如只從 JSON 物件中取的某幾個 key 組成新的物件。</li><li><strong>watch</strong>：監聽 <code>ref</code> 或 <code>reactive</code> 響應式資料發生變化時，觸發重新請求資料，適用於資料分頁、過濾結果或搜尋等情境。</li><li><strong>initialCache</strong>：預設為 <code>true</code>，當第一次請求資料時，將會把有效的 payload 快取，之後的請求只要是相同的 key，都會直接回傳快取的結果。</li><li><strong>immediate</strong>：預設為 <code>true</code>，請求將會立即觸發。</li></ul></li></ul><h4 id=useasyncdata-的回傳值>useAsyncData() 的回傳值</h4><ul><li><strong>data</strong>：傳入異步函數的回傳結果。</li><li><strong>pending</strong>：以 <code>true</code> 或 <code>false</code> 表示是否正在獲取資料。</li><li><strong>refresh / execute</strong>：一個函數，可以用來重新執行 <code>handler</code> 函數，回傳新的資料，類似重新整理、重打一次 API 的概念。預設情況下 <code>refresh()</code> 執行完並回傳後才能再次執行。</li><li><strong>error</strong>：資料獲取失敗時回傳的物件。</li></ul><p>看到這裡，我們再重新閱讀與解釋 <code>useAsyncData()</code> 的範例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>pending</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>refresh</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useAsyncData</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;count&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>呼叫 <code>useAsyncData()</code> 並不是直接幫我們送出 HTTP 請求，而是在 <code>handler</code> 內使用 <code>$fetch</code> 來打 API，只是 <code>useAsyncData()</code> 組合式函數，封裝了更多打 API 時可以使用的方法與參數，來因應不同的使用情境。當然如果想要，你也可以使用其他套件來替換 <code>$fetch</code> 但可能就沒辦法享受它所帶來的好處。</p><h3 id=usefetch>useFetch</h3><p>這個組合式函數將 <code>useAsyncData</code> 和 <code>$fetch</code> 進行包裝，當使用這個函數時它會根據 URL 和 fetch 的選項來自動產生 <code>useAsyncData</code> 需要的參數 <code>key</code>，如果呼叫的 API 是伺服器端所提供的，也會自動根據伺服器 API 路由來為請求提供類型提示，並推斷 API 的回傳類型。</p><p><strong>useFetch() 所傳入參數的類型如下</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>useFetch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>url</span>: <span class=kt>string</span> <span class=o>|</span> <span class=nx>Request</span> <span class=o>|</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>string</span> <span class=err>|</span> <span class=na>Request</span><span class=p>&gt;</span> <span class=o>|</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=kt>string</span> <span class=o>|</span> <span class=nx>Request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>options?</span>: <span class=kt>UseFetchOptions</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>AsyncData</span><span class=err>&lt;</span><span class=na>DataT</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>UseFetchOptions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>key?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>method?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>params?</span>: <span class=kt>SearchParams</span>
</span></span><span class=line><span class=cl>  <span class=nx>body?</span>: <span class=kt>RequestInit</span><span class=p>[</span><span class=s1>&#39;body&#39;</span><span class=p>]</span> <span class=o>|</span> <span class=nx>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>?:</span> <span class=p>{</span> <span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>value</span>: <span class=kt>string</span> <span class=p>}[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>baseURL?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>server?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=nx>lazy?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=nx>immediate?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>?:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>DataT</span>
</span></span><span class=line><span class=cl>  <span class=nx>transform</span><span class=o>?:</span> <span class=p>(</span><span class=nx>input</span>: <span class=kt>DataT</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>DataT</span>
</span></span><span class=line><span class=cl>  <span class=nx>pick?</span>: <span class=kt>string</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>watch?</span>: <span class=kt>WatchSource</span><span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>initialCache?</span>: <span class=kt>boolean</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>type</span> <span class=nx>AsyncData</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>DataT</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>pending</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>boolean</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>refresh</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>execute</span><span class=o>:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>void</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>error</span>: <span class=kt>Ref</span><span class=p>&lt;</span><span class=nt>Error</span> <span class=err>|</span> <span class=na>boolean</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=usefetch-傳入的參數>useFetch() 傳入的參數</h4><ul><li><strong>url</strong>：要獲取資料的 URL 或 API Endpoint。</li><li><strong>options</strong>：(繼承自 <a class=link href=https://github.com/unjs/ohmyfetch target=_blank rel=noopener>unjs/ohmyfetch</a> 選項與 <a class=link href=https://nuxt.com/docs/api/composables/use-async-data#params target=_blank rel=noopener>AsyncDataOptions</a>)<ul><li><strong>method</strong>：發送 HTTP 請求的方法，例如 GET、POST 或 DELETE 等。</li><li><strong>params</strong>：查詢參數 (Query params)。</li><li><strong>body</strong>：請求的 body，可以傳入一個物件，它將自動被轉化為字串。</li><li><strong>headers</strong>：請求的標頭 (headers)。</li><li><strong>baseURL</strong>：請求的 API 路徑，基於的 URL。</li></ul></li><li><strong>options</strong>：(繼承自 <code>useAsyncData</code> 的選項)<ul><li><strong>key</strong>：唯一鍵，可以確保資料不會重複的獲取，也就是如果 Key 相同便不會再發送相同的請求，除非重新整理頁面由後端再次渲染獲取，或呼叫 <code>useAsyncData</code> 回傳的 <code>refresh()</code> 函數重新取得資料。</li><li><strong>server</strong>：是否在伺服器端獲取資料，預設為 <code>true</code>。</li><li><strong>lazy</strong>：是否於載入路由後才開始執行異步請求函數，預設為 <code>false</code>，所以會阻止路由載入直到請求完成後才開始渲染頁面元件。</li><li><strong>immediate</strong>：預設為 <code>true</code>，請求將會立即觸發。</li><li><strong>default</strong>：當傳入這個 factory function，可以將異步請求發送與回傳解析前，設定資料的預設值，對於設定 <code>lazy: true</code> 選項特別有用處，至少有個預設值可以使用及渲染顯示。</li><li><strong>transform</strong>：修改加工 <code>handler</code> 回傳結果的函數。</li><li><strong>pick</strong>：<code>handler</code> 若回傳一個物件，只從中依照需要的 key 取出資料，例如只從 JSON 物件中取的某幾個 key 組成新的物件。</li><li><strong>watch</strong>：監聽 <code>ref</code> 或 <code>reactive</code> 響應式資料發生變化時，觸發重新請求資料，適用於資料分頁、過濾結果或搜尋等情境。</li><li><strong>initialCache</strong>：預設為 <code>true</code>，當第一次請求資料時，將會把有效的 payload 快取，之後的請求只要是相同的 key，都會直接回傳快取的結果。</li></ul></li></ul><h4 id=usefetch-的回傳值>useFetch() 的回傳值</h4><ul><li><strong>data</strong>：傳入異步函數的回傳結果。</li><li><strong>pending</strong>：以 <code>true</code> 或 <code>false</code> 表示是否正在獲取資料。</li><li><strong>refresh / execute</strong>：一個函數，可以用來重新執行 <code>handler</code> 函數，回傳新的資料，類似重新整理、重打一次 API 的概念。預設情況下 <code>refresh()</code> 執行完並回傳後才能再次執行。</li><li><strong>error</strong>：資料獲取失敗時回傳的物件。</li></ul><p>舉個例子，我們新增一個 Server API，<strong>./server/api/about.js</strong> 內容如下：</p><h5 id=serverapiaboutjs>server/api/about.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Ryan&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;男&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;ryanchien8125@gmail.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>counter</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>新增一個路由頁面，<strong>./pages/about/useFetch.vue</strong> 內容如下：</p><h5 id=pagesaboutusefetchvue>pages/about/useFetch.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-2xl text-gray-600&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>請求狀態</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span> <span class=nx>pending</span> <span class=o>?</span> <span class=s1>&#39;請求中&#39;</span> <span class=o>:</span> <span class=s1>&#39;完成&#39;</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=nt>v-if</span><span class=s>=&#34;error&#34; class=&#34;mt-4 text-6xl text-gray-600&#34;&gt;是否錯誤: {{ error }}&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;span class=&#34;mt-4 text-2xl text-gray-600&#34;&gt;回傳資料:&lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=s>    &lt;p class=&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=na>data</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>      <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 rounded-sm bg-blue-500 py-3 px-8 text-xl font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nt>@click</span><span class=s>=&#34;refresh&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>重新獲取資料</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>pending</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>refresh</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/about&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>pick</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;counter&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>透過 <code>useFetch()</code> 我們能更簡單的發送 API 請求，並能得到狀態與重新獲取資料的函數，甚至在第一次進入頁面時，利用 <code>$fetch</code> 可以直接呼叫伺服器 API 函數的特性來降低 API 的請求次數。</p><p><img src=https://live.staticflickr.com/65535/52616964759_a9278ba6d0_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=攔截器>攔截器</h3><p>我們也可以透過 <code>$fetch</code> 提供的選項來設置攔截器。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>pending</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>refresh</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/auth/login&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>onRequest</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>options</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 設定請求時夾帶的標頭
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>options</span><span class=p>.</span><span class=nx>headers</span> <span class=o>=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>headers</span> <span class=o>||</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>options</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>authorization</span> <span class=o>=</span> <span class=s1>&#39;...&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>onRequestError</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>options</span><span class=p>,</span> <span class=nx>error</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 處理請求時發生的錯誤
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>onResponse</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>,</span> <span class=nx>options</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 處理請求回應的資料
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>_data</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>onResponseError</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>,</span> <span class=nx>options</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 處理請求回應發生的錯誤
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=uselazyasyncdata>useLazyAsyncData</h3><p>預設的情況下，<code>useAsyncData()</code> 的 <code>options.lazy</code> 為 <code>false</code>，意思是，預設得情況下，當進入路由後，會開始執行異步請求函數，並會會阻止路由載入元件等，直到請求完成後才開始渲染頁面元件。</p><p><code>useLazyAsyncData()</code> 則是 <code>options.lazy</code> 預設為 <code>true</code> 的封裝，也就是請求資料時它將不會阻塞，並讓頁面繼續渲染元件。</p><p>舉個例子，我們新增一個 Server API，並稍微添加一下延遲，模擬 API 約需要處理 2 秒才回傳資料，<strong>./server/api/count.js</strong> 內容如下：</p><h5 id=serverapicountjs-1>server/api/count.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>setTimeout</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=mi>2000</span><span class=p>))</span> <span class=c1>// 等待 2 秒
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>counter</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>新增一個路由頁面，<strong>./pages/count/useLazyAsyncData.vue</strong> 內容如下：</p><h5 id=pagescountuselazyasyncdatavue>pages/count/useLazyAsyncData.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>瀏覽次數</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-semibold text-sky-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>data</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/count&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useLazyAsyncData</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/count&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現，我們使用 <code>useLazyAsyncData()</code> 後，會與前面使用 <code>useAsyncData()</code> 的效果不一樣，會先渲染出元件，即看到的文字「瀏覽次數」，並再 API 回傳後才響應資料重新渲染數值。</p><p><img src=https://live.staticflickr.com/65535/52617186908_7d896f5934_o.gif max-width=100% max-height=100% class=gallery-image></p><p>透過 <code>default</code> 選項可以來建立 API 回傳前的預設值，在 <code>options.lazy</code> 為 <code>true</code> 的情況下，都建議設定一下預設值，可以讓使用者體驗更好一些。</p><p>添加 <strong>default</strong> 選項，<strong>./pages/count/useLazyAsyncData.vue</strong> 內容如下：</p><h5 id=pagescountuselazyasyncdatavue-1>pages/count/useLazyAsyncData.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>瀏覽次數</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-9xl font-semibold text-sky-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>data</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useLazyAsyncData</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/count&#39;</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=s1>&#39;-&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在 API 請求回來前，預設值會是 <code>-</code>。</p><p><img src=https://live.staticflickr.com/65535/52616964784_390b71eeb8_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=uselazyfetch>useLazyFetch</h3><p>如同 <code>useLazyAsyncData</code> 所描述，<code>useLazyFetch</code> 則是 <strong>useFetch</strong> 的 <code>options.lazy</code> 選項預設為 <code>true</code> 的封裝。</p><h4 id=重新獲取資料>重新獲取資料</h4><p>前面有提到我們可以使用 <code>refresh()</code> 來重新獲取具有不同查詢參數的資料。</p><h4 id=refreshnuxtdata>refreshNuxtData</h4><p>你也可以透過 <code>refreshNuxtData</code> 來使 <strong>useAsyncData</strong>、<strong>useLazyAsyncData</strong>、<strong>useFetch</strong> 與 <strong>useLazyFetch</strong> 的快取失效，再觸發刷新資料。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{{</span> <span class=nx>pending</span> <span class=o>?</span> <span class=s1>&#39;Loading&#39;</span> <span class=o>:</span> <span class=nx>count</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=nt>@click</span><span class=s>=&#34;refresh&#34;</span><span class=p>&gt;</span><span class=na>Refresh</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>pending</span><span class=p>,</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>count</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useLazyAsyncData</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>$fetch</span><span class=p>(</span><span class=s1>&#39;/api/count&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>refresh</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>refreshNuxtData</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Nuxt 已經為我們封裝好可以打 API 的組合函數，用起來也相當簡單方便，照著<a class=link href=https://nuxt.com/docs/api/composables/use-async-data#example target=_blank rel=noopener>官網範例</a>及 <a class=link href=https://github.com/unjs/ofetch target=_blank rel=noopener>ohmyfetch</a> 套件的說明，相信很快就能上手。</p><hr><h2 id=狀態管理-state-management>狀態管理 (State Management)</h2><p>Vue 3 父子元件間資料傳遞與讀寫或是跨元件間的狀態共享，可以選擇使用 <strong>Props / Emit</strong>、<strong>Provide / Inject</strong> 或 <strong>Vuex store</strong> 來處理，這三種資料流都不大一樣，我們也會依據情境來決定狀態管理的方式。這邊會針對 Nuxt 3 所提供的組合式函數 <code>useState</code> 來講述元件間的共享狀態，應該如何做定義，以及使用 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a> 替代 <a class=link href=https://vuex.vuejs.org/ target=_blank rel=noopener>Vuex</a> 來做狀態管理。</p><h3 id=hydration>Hydration</h3><p>首先，我們先來看一個例子，建立 <strong>./pages/random.vue</strong> 內容如下：</p><h5 id=pagesrandomvue>pages/random.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-sky-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>頁面呈現出，每次重新整理頁面，頁面會顯示新的亂數：</p><p><img src=https://live.staticflickr.com/65535/52617186923_40cff8bd77_o.gif max-width=100% max-height=100% class=gallery-image></p><p>細心你的可能會發現，每次重整頁面，數字好像<code>變化了兩次</code>，圖中數字停留在 <strong>517</strong>，重新整理網頁後竟然先變成了 <strong>163</strong> 後再變成 <strong>101</strong>。</p><p>這個現象其實是伺服器端渲染後與客戶端再次渲染所導致的。講的白話一點就是，因為 Nuxt 預設的渲染模式 <a class=link href=https://nuxt.com/docs/guide/concepts/rendering/#universal-rendering target=_blank rel=noopener>Universal Rendering</a> 在 SSR 時期，將 <code>random.vue</code> 內容於伺服器端渲染完成後亂出產生出 <strong>163</strong> 作為初始值，意即 <strong>const count = ref(<code>163</code>)</strong>，所以網頁先顯示了 <strong>163</strong> 這個數字，同時，瀏覽器的背景也正在下載客戶端所需要的 JS 準備接手做 CSR，當 JS 載入完成後又再一次的執行 Vue 元件的 <strong>const count = ref(Math.round(Math.random() * 1000))</strong> 這段程式碼，此時亂數產生了 <strong>101</strong> 這個數字，客戶端也就重新渲染出了 <strong>101</strong> 於頁面上，這也就是為什麼每次重新整理數字會變化兩次的原因。</p><p>Nuxt 預設的<strong>通用渲染 (Universal Rendering)</strong> 模式，是結合了 SSR 與 CSR 的技術，在 Nuxt 收到網頁請求後，會在伺服器渲染出 HTML 回傳至瀏覽器渲染顯示出靜態頁面，同時開始載入需要的 Vue 程式碼，讓客戶端接手為 SPA 使得網頁具有互動性，接手後的渲染行為都是在客戶端進行的 CSR，這也就讓通用渲染同時兼具 SSR 對 SEO 的友善以及 CSR 良好互通性的使用者體驗。</p><p>這種在瀏覽器中使後端渲染出的靜態頁面具有交互性，稱之為「<strong>Hydration</strong>」。</p><p>依據官網所提供的<a class=link href=https://nuxt.com/docs/guide/concepts/rendering/ target=_blank rel=noopener>圖片</a>，我添加了一些文字來幫助理解。前述提到了在伺服器渲染網頁 HTML 給瀏覽器時，使用可以正常的看見網頁，但是在 JS 下載完成之前，網頁是<code>不具有互動性</code>的，也就是還不具有路由跳轉等 Vue 互動邏輯，直至 JS 下載完後會 Hydrate Vue 程式碼，這時客戶端就完全接手後續的互動與 CSR，到這邊 Hydration 完成，我們也就能與網站完整的互動了。</p><p><img src=https://live.staticflickr.com/65535/52616964794_a7eaeeb3ef_o.png max-width=100% max-height=100% class=gallery-image></p><p>回到一開始的例子，我們在瀏覽器打開開發者工具的主控台 (Console)，可以發現到其實開發的過程，也出現了錯誤提示「<code>Hydration completed but contains mismatches.</code>」，告訴我們 <strong>Hydration</strong> 完成了但是包含了不匹配，正是前端與後端初始值不同的錯誤。</p><p><img src=https://live.staticflickr.com/65535/52616964799_2110719e1c_o.png max-width=100% max-height=100% class=gallery-image></p><p>接下來我們將介紹 Nuxt 提供的組合式函數 <code>useState</code>，來可以解決這個問題。</p><h3 id=nuxt-3-的狀態管理-state-management>Nuxt 3 的狀態管理 (State Management)</h3><p>Nuxt 提供了一個組合式函數 <code>useState</code> 用來建立具有響應式及對於 SSR 友善的共享狀態。</p><p>在前面的例子我們提到因為 <strong>Hydration</strong> 而導致前後端的初始值可能不一致，而 <code>useState</code> 是一個對 SSR 友善的 <code>ref</code> 替代品，使用 <code>useState</code> 建立的響應式變數，它的值會在伺服器端渲染後與客戶端 <strong>Hydration</strong> 期間的得以被保留。</p><p><code>useState</code> 有兩種接收不同數量參數的呼叫方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>useState</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>init</span><span class=o>?:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>T</span> <span class=o>|</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>useState</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>,</span> <span class=nx>init</span><span class=o>?:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>T</span> <span class=o>|</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span><span class=o>:</span> <span class=nx>Ref</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>key</strong>：唯一鍵，用於確保資料能被正確請求且不重複。</li><li><strong>init</strong>：用於提供的初始值給 State 的函數，這個函數也可以回傳一個 <code>ref</code>。</li></ul><p>舉個例子，新增 <strong>./pages/count.vue</strong>，內容如下：</p><h5 id=pagescountvue-1>pages/count.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-emerald-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現，使用 <code>useState</code> 初始化 count 的值後，瀏覽器重整頁面，就不像前面的例子會發生兩次的數值變動。</p><p><img src=https://live.staticflickr.com/65535/52616698646_9098f6524f_o.gif max-width=100% max-height=100% class=gallery-image></p><p>當我們使用 <code>useState</code> 並以 <strong>count</strong> 當作 key，在網頁請求進入伺服器端執行時，還沒有這個 <strong>count</strong> 狀態，所以執行了初始化函數產生出一個亂數，例如 <strong>888</strong> 就會回傳給 <strong>count</strong> 當作響應式變數的初始值，此時這個網頁請求，已經有一個 <strong>count</strong> 的響應式狀態，當前端於 <strong>Hydration</strong> 步驟再次的執行了下面這段程式碼，<code>useState</code> 一樣是以 <strong>count</strong> 當作 <strong>key</strong>，但是存在了一個由伺服器端建立好的 <strong>count</strong>，就會直接使用該狀態，也就不會在執行初始化函數，而導致前後端的初始狀態不一致的問題。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=usestate-的基本用法>useState 的基本用法</h3><p>新增 <strong>./pages/counter/increment.vue</strong>，內容如下：</p><h5 id=pagescounterincrementvue>pages/counter/increment.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-sky-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>counter</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 flex flex-row&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counter++&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>增加</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counter--&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>減少</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-slate-500&#34;</span><span class=p>&gt;</span><span class=nx>如果是第一次進入這個頁面</span><span class=err>，</span><span class=nx>數值初始設定為</span> <span class=mi>0</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們使用 <code>useState</code> 並以 <strong>counter</strong> 當作 key，首次於後端渲染時會初始化為 0，當前端Hydration 步驟載入 Vue 或跳轉頁面，因為使用相同的 key 所以這個狀態也會繼續被保留，直至我們下一次重新整理網頁。</p><p><img src=https://live.staticflickr.com/65535/52616698666_a945fe9cc8_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=usestate-的共享狀態>useState 的共享狀態</h3><p>前面 <code>useState</code> 的基本用法以 <code>counter</code> 當作 <strong>key</strong>，我們可以再建立不同的頁面元件並使用 <code>useState('counter')</code> 就可以把這個狀態拿做出來用，也就達到了在任何元件中可以共享相同的響應式狀態。</p><p>新增 <strong>./pages/counter/surprise.vue</strong>，內容如下：</p><h5 id=pagescountersurprisevue>pages/counter/surprise.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-sky-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>counter</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 flex flex-row&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counter++&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>增加</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counter--&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>減少</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-slate-500&#34;</span><span class=p>&gt;</span><span class=nx>如果是第一次進入這個頁面</span><span class=err>，</span><span class=nx>數值初始設定為亂數</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們可以任意導航至 <strong>/counter/increment</strong> 與 <strong>/counter/surprise</strong> 頁面，可以發現兩個頁面可以共享相同的 <code>counter</code> 狀態，當首次進入或重新整理 <strong>increment.vue</strong> 頁面，會將 <code>counter</code> 初始化為 <strong>0</strong>；而首次進入或重新整理 <code>surprise.vue</code> 頁面則是產生一個亂數給予 <strong>counter</strong>。</p><p><img src=https://live.staticflickr.com/65535/52616964824_e6466ee572_o.gif max-width=100% max-height=100% class=gallery-image></p><p>當然你也可以直接在其他元件中使用 <code>useState('counter')</code>，就可以取得共享的響應式裝態，但如果這個元件是初次進入而沒有預設值的建立函數，可能會引發一些錯誤，要特別的注意。</p><h3 id=使用組合式函數建立共享狀態>使用組合式函數建立共享狀態</h3><p>如下例子，我們可以建立組合式函數 (Composables) 來搭配 <code>useState</code>。</p><p>新增 <strong>./composables/states.ts</strong>，內容如下：</p><h5 id=composablesstatests>composables/states.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useColor</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;(</span><span class=s1>&#39;color&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=s1>&#39;green&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>新增 <strong>./pages/color.vue</strong>，內容如下：</p><h5 id=pagescolorvue>pages/color.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-emerald-400&#34;</span><span class=p>&gt;{{</span> <span class=nx>color</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>color</span> <span class=o>=</span> <span class=nx>useColor</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如此一來我們定義好的組合式函數就可以被自動的導入及建立具有類型安全的狀態，在各個元件之間就可以呼叫這個組合函數來取得共享狀態。</p><p><img src=https://live.staticflickr.com/65535/52617134505_9cb332e17c_o.png max-width=100% max-height=100% class=gallery-image></p><p>在通用渲染的模式之下，瀏覽器於 Hydration 完成前，網頁雖然能瀏覽但是尚不具有互動性，直至 Hydration 完成後，Vue 的頁面元件會重新載入與綁定，因此我們對於響應式的變數，儘量使用 <code>useState</code> 來替代 <code>ref</code> 以確保 Hydration 前後的初始值得以被保留，而且 <code>useState</code> 因為可以使用 <code>key</code> 來使狀態於元件間共享。</p><hr><h2 id=狀態管理---store--pinia>狀態管理 - Store & Pinia</h2><p>上述我們介紹了如何在 Nuxt 3 使用 useState 來建立一個元件間的共享狀態，隨著專案的健壯增大，我們就需要一個更好的方式來管理與儲存這些狀態，例如在 Vue 中使用 <a class=link href=https://vuex.vuejs.org/ target=_blank rel=noopener>Vuex</a> 或 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a> 來建立一個 Store 管理這些狀態就是一個解決方案。如果你還不了解 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a>，可以理解為是 Vuex v5。因為目前 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a> 已經成為 Vue 官方推薦的狀態管理解決方案，本篇將針對 Nuxt 使用 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a> 做一個簡單的介紹。</p><p><img src=https://live.staticflickr.com/65535/52616698686_1ffe5c9e82_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=pinia>Pinia</h3><p>如果你使用過 Vuex 大概會知道 Vue 如何建立 Store 來做狀態管理，隨著時間 Vuex 很積極的蒐集社群及使用者的<a class=link href=https://github.com/vuejs/rfcs/discussions/270 target=_blank rel=noopener>意見</a>來規劃 Vuex v5。Pinia 的作者 <a class=link href=https://github.com/posva target=_blank rel=noopener>Eduardo</a> 是 Vue.js 核心團隊的成員之一，也參與著 Vuex 的開發，當時他正測試著 Vuex v5 的<a class=link href=https://github.com/kiaking/rfcs/blob/vuex-5/active-rfcs/0000-vuex-5.md target=_blank rel=noopener>提案</a>，而 <a class=link href=https://pinia.vuejs.org/ target=_blank rel=noopener>Pinia</a> 成為探索這些意見及可能性的先驅，實現了 Vuex v5 可能的樣子，現在 Pinia 的 API 已經進入穩定狀態，也成為 Vue 官方推薦使用的狀態管理解決方案，並遵循著 Vue 生態的 RFC 流程。</p><p>Pinia 相較於 Vuex 有以下差異：</p><ul><li>沒有 <code>mutation</code>，只需要使用 <code>action</code> 就可以改狀態。</li><li>不再有 <code>modules</code> 巢狀的結構，也不再需要為模組定義命名空間，因為在 Pinia 中，可以定義多個 Store 而且每個都是獨立的也都具有自己的命名空間。</li><li>更完整的支援 TypeSctipt，也不再需要使用多餘的 types 來封裝，所有的內容都是類型化的，Pinia API 的設計方式盡可能使用 TypeSctipt 類型推斷。</li><li>非常輕巧，約僅有 1 KB，而且可以自定義插件。</li><li>支援伺服器端渲染 (SSR) 與程式碼自動拆分。</li></ul><h3 id=nuxt-3-安裝-pinia>Nuxt 3 安裝 Pinia</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D pinia @pinia/nuxt --force
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D pinia @pinia/nuxt --force</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>目前照著官方安裝 Pinia，會發生一些問題，所以我們在安裝時加上 <strong>&ndash;force</strong> 參數</p></blockquote><p>添加 <code>@pinia/nuxt</code> 至 <code>nuxt.config.ts</code> 的 <strong>modules</strong> 屬性中。</p><h5 id=nuxtconfigts-3>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=kr>module</span><span class=nx>s</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;@pinia/nuxt&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=建立第一個-pinia-的-store>建立第一個 Pinia 的 Store</h3><p>Pinia 提供了一個函數 <code>defineStore</code> 用來定義 store，呼叫時需要一個唯一的名稱來當作第一個參數傳遞，也稱之為 <code>id</code>，Pinia 會使用它來將 store 連接到 devtools。</p><p>建議將回傳的函數命名為 <code>use...</code>，例如 <code>useCounterStore</code>，<code>use</code> 作為開頭是組合式函數命名的約定，來符合使用上的習慣。</p><p>而 <code>defineStore</code> 的第二個參數，可以傳入 <code>Options 物件</code>或是 <code>Setup 函數</code>，例如我們使用 Options 來定義一個 Store，新增 <strong>./stores/counter.js</strong>，內容如下：</p><h5 id=storescounterjs>stores/counter.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCounterStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>actions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>getters</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleCount</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>可以發現到與 Vue 的 Options API 非常類似，我們可以傳遞帶有 <strong>state</strong>、<strong>actions</strong> 和 <strong>getters</strong> 屬性的物件。這些屬性正好讓 Store 與 Options API 呼應彼此的關係，如 <strong>state</strong> 對應 <strong>data</strong>、<strong>actions</strong> 對應 <strong>methods</strong> 而 <strong>getters</strong> 對應 <strong>computed</strong>。</p><p>還有另一種方式可以來定義 Store，與 Vue Composition API 的 setup 函數類似，我們可以傳入一個函數，這個函數裡面定義響應式屬性、方法等函數，最後回傳我們想公開的屬性和方法所組成的物件。</p><p>以 setup 函數定義 counter store，內容如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCounterStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>doubleCount</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleCount</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=開始使用-store>開始使用 Store</h3><p>我們只需要在元件中，如下程式碼匯入並呼叫 <code>useCounterStore()</code> 就可以操作 store 裡面的方法或屬性囉！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useCounterStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/counter&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterStore</span> <span class=o>=</span> <span class=nx>useCounterStore</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>我們新增一個頁面元件 <strong>./pages/counter.vue</strong>，內容如下：</p><h5 id=pagescountervue>pages/counter.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-9xl font-semibold text-sky-600&#34;</span><span class=p>&gt;{{</span> <span class=nx>counterStore</span><span class=p>.</span><span class=nx>count</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8 flex flex-row&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counterStore.increment&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>增加</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;font-base mx-2 rounded-full bg-sky-500 px-4 py-2 text-xl text-white hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;counterStore.decrement&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>減少</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useCounterStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/counter&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterStore</span> <span class=o>=</span> <span class=nx>useCounterStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>這樣我們就完成了一個 store 的顯示狀態值，透過呼叫 <code>counterStore</code> 內定義的 <strong>increment</strong> 與 <strong>decrement</strong> 來改變狀態。</p><p><img src=https://live.staticflickr.com/65535/52616188807_576821f99a_o.gif max-width=100% max-height=100% class=gallery-image></p><p>在不同的元件間，你也可以使用 <code>useCounterStore</code> 取得已經建立好的 store 來共享這些狀態或進行操作。</p><p><img src=https://live.staticflickr.com/65535/52617187013_1e1f4c217e_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=pinia-store-的-state>Pinia Store 的 State</h3><p>預設情況下，可以直接對 store 的實例來取得狀態，而使用 Pinia 定義的 store 比較特別的是，我們可以不用透過呼叫函數來修改狀態，也可以直接對 store 的狀態進行修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterStore</span> <span class=o>=</span> <span class=nx>useCounterStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>counterStore</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>10</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=改變狀態>改變狀態</h4><p>除了直接使用 <code>counterStore.count += 10</code> 修改 store，你也可以使用 store 提供的 helper <code>$patch</code> 來修改部分的狀態。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>userStore</span><span class=p>.</span><span class=nx>$patch</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Ryan&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nx>money</span><span class=o>:</span> <span class=s1>&#39;88888888&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>對於集合類型的修改，例如陣列的新增、刪除或指定修改某一個元素等操作，你可以使用 <code>$patch</code> 傳入一個函數，這個函數會接收一個 <code>state</code> 讓你可以修改，對於比較複雜的操作會很方便。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>cartStore</span><span class=p>.</span><span class=nx>$patch</span><span class=p>((</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;shoes&#39;</span><span class=p>,</span> <span class=nx>quantity</span><span class=o>:</span> <span class=mi>1</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=p>.</span><span class=nx>hasChanged</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如果你需要，也可以將 store 的整個 state 重新設置成一個新的物件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>cartStore</span><span class=p>.</span><span class=nx>$state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>items</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nx>hasChanged</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=重置狀態>重置狀態</h4><p>store 的實例提供了一個 <code>$reset()</code> 的 helper，呼叫它就可以將 store 的狀態重置至初始值，不過目前只在使用 Option 物件定義的 store 才有實作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterStore</span> <span class=o>=</span> <span class=nx>useCounterStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>counterStore</span><span class=p>.</span><span class=nx>$reset</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=pinia-store-的-getters>Pinia Store 的 Getters</h3><h4 id=使用同一個-store-中的其他-getter>使用同一個 store 中的其他 getter</h4><p>在 store 內你可以組合多個 getter，在 Option 物件下，可以透過使用 <code>this</code> 來呼叫使用其他的 getter。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;main&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>counter</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>getters</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleCount</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>counter</span> <span class=o>*</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleCountPlusOne</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>doubleCount</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=使用其他-store-的-getter>使用其他 store 的 getter</h4><p>在 store 內你也可以組合其他 store 的 getter，只要建立出其他 store 實例就可以呼叫使用了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useOtherStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./other-store&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;main&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>getters</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>otherGetter</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>otherStore</span> <span class=o>=</span> <span class=nx>useOtherStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>state</span><span class=p>.</span><span class=nx>localData</span> <span class=o>+</span> <span class=nx>otherStore</span><span class=p>.</span><span class=nx>data</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=pinia-store-的-actions>Pinia Store 的 Actions</h4><p>Actions 相當於元件中的方法，也是修改狀態的商業邏輯定義的位置，action 可以是同步也可以是異步的，因此，我們也能在 action 中打後端 API 來取得資料後更新狀態。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUserStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>profile</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>gender</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>actions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>async</span> <span class=nx>getUserProfile</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/profile&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>profile</span> <span class=o>=</span> <span class=nx>data</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>error</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=store-的解構>Store 的解構</h3><p>有些情況，你可能需要將 Store 中的屬性或方法獨立的提取出來，但為了保持屬性的響應性，你需要使用 <code>storeToRefs</code> 來建立屬性的參考，就像使用 <code>toRefs</code> 來建立 <code>props</code> 的參考一樣。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>storeToRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useCounterStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/counter&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counterStore</span> <span class=o>=</span> <span class=nx>useCounterStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>count</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>storeToRefs</span><span class=p>(</span><span class=nx>counterStore</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>increment</span><span class=p>,</span> <span class=nx>decrement</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>counterStore</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=pinia-持久化插件---pinia-plugin-persistedstate>Pinia 持久化插件 - Pinia Plugin Persistedstate</h2><p>Pinia 是個非常輕量的狀態管理解決方案，而且也提供底層 API 使得 Pinia 能夠自定義插件來擴展功能，舉例來說，我們有些狀態需要儲存在使用者瀏覽器中，下次再瀏覽時可以取的當時儲存的狀態資料，我們就需要將 store 的狀態持久化。</p><p>我們可以使用 <a class=link href=https://github.com/prazdevs/pinia-plugin-persistedstate target=_blank rel=noopener>Pinia Plugin Persistedstate</a> 這個插件，來做到持久化這件事，這對於儲存使用者資訊或登入狀態非常的方便。</p><h3 id=在-nuxt-3-中配置使用-pinia-plugin-persistedstate>在 Nuxt 3 中配置使用 Pinia Plugin Persistedstate</h3><h4 id=step-1-安裝套件-2>Step 1. 安裝套件</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D pinia-plugin-persistedstate --force
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D pinia-plugin-persistedstate --force</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>目前照著官方安裝 Pinia，會發生一些問題，所以我們在安裝時加上 <strong>&ndash;force</strong> 參數</p></blockquote><h4 id=step-2-在-nuxt-3-為-pinia-添加-persist-插件>Step 2. 在 Nuxt 3 為 Pinia 添加 Persist 插件</h4><p>建立 <strong>./plugins/pinia-plugin-persistedstate.client.js</strong>，內容如下：</p><h5 id=pluginspinia-plugin-persistedstateclientjs>plugins/pinia-plugin-persistedstate.client.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>piniaPersistedstate</span> <span class=nx>from</span> <span class=s1>&#39;pinia-plugin-persistedstate&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>((</span><span class=nx>nuxtApp</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>nuxtApp</span><span class=p>.</span><span class=nx>$pinia</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>piniaPersistedstate</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-3-為你的-store-添加持久化配置>Step 3. 為你的 Store 添加持久化配置</h4><p>在現有的 store 定義中添加，<code>persist</code> 屬性，來配置 store 持久化，將狀態儲存在瀏覽器的 <code>localStorage</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCounterStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>state</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>actions</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>count</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>getters</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleCount</span><span class=o>:</span> <span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>state</span><span class=p>.</span><span class=nx>count</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>persist</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>strategies</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;counter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>storage</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>client</span> <span class=o>?</span> <span class=nx>localStorage</span> <span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>如果是使用 setup 函數定義 store，你可以在 defineStore 傳入第三個參數並添加 <code>persist</code> 屬性。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useCounterStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;counter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>count</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>doubleCount</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>count</span><span class=p>.</span><span class=nx>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>increment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>decrement</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>doubleCount</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>persist</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>enabled</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>strategies</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;counter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>storage</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>client</span> <span class=o>?</span> <span class=nx>localStorage</span> <span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=step-4-持久化效果>Step 4. 持久化效果</h4><p>當我們設置好 counterStore 的持久化後，我們的狀態就會被儲存在瀏覽器的 <code>localStorage</code> 之中，就算關閉瀏覽器或重新整理網頁，store 的狀態都會再從 <code>localStorage</code> 讀取出來。</p><p><img src=https://live.staticflickr.com/65535/52617187033_e0fd11b0a5_o.gif max-width=100% max-height=100% class=gallery-image></p><p>在小型的專案中，你可以使用 useState 來管理，但大專案你就需要一個更好的方式來管理這些狀態，如 Pinia 來為我們管理這些狀態，甚至定義多個 store，Pinia 支援的插件能協助我們擴展 Pinia 的功能，Pinia Plugin Persistedstate 就是一個很常用的插件，能協助我們將 Pinia 的狀態持久化至瀏覽器的 <code>localStorage</code> 或 <code>sessionStorage</code> 中。</p><hr><h2 id=runtime-config--app-config>Runtime Config & App Config</h2><p>在 Nuxt 3 中提供了兩種可以方式設定環境變數或前端需要使用的共用設定，分別是在 Nuxt 啟動時會在後端載入使用的 Runtime Config 及可以在前端被使用的 App Config 這兩者間的區別這邊做一些講解。</p><h3 id=runtime-config>Runtime Config</h3><p>在開發網站或部署時，我們總是有一些環境變數需要做設置，<a class=link href=https://github.com/motdotla/dotenv target=_blank rel=noopener>dotenv</a> 就是一個很好用的套件，能幫助我們將專案下的 <code>.env</code> 檔案載入到 Node.js 的 <code>process.env</code> 之中，尤其在後端伺服器的 API 開發，這些不能公開或敏感的 Key 或設定值，通常不會與整個專案一起進行版本控制，而是針對不同環境與機器，配置於 <code>.env</code> 或環境變數之中。</p><p>這個 <code>.env</code> 設定檔內的環境變數，例如：資料庫的帳號密碼、第三方服務的 Token 或 API Key &mldr;等，通常只會在伺服器被讀取做使用，也不會洩漏這些設定給使用者知道，我們也稱之為<code>執行時的設定 (Runtime Config)</code>。</p><p>Nuxt 3 提供了可以設定 <strong>Runtime Config</strong> 的方式，我們可以很方便的來設定這些環境變數給予伺服器執行時使用。</p><h4 id=配置-runtimeconfig>配置 runtimeConfig</h4><p>我們可以在 <code>nuxt.config.ts</code> 中添加 <code>runtimeConfig</code> 屬性，就可以來設定只有伺服器端可以使用的環境變數。</p><p>例如，在 <strong>nuxt.config.ts</strong> 檔案中，添加一個 <code>apiSecret</code> 至 <code>runtimeConfig</code> 屬性內：</p><h5 id=nuxtconfigts-4>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>runtimeConfig</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiSecret</span><span class=o>:</span> <span class=s1>&#39;怎麼可以讓你知道呢 :P&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們就可以在 Server API 使用 <code>useRuntimeConfig()</code> 獲得執行時的設定，再從中取得 <code>apiSecret</code> 環境變數。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>apiSecret</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`接收到了一個 Server API 請求: </span><span class=si>${</span><span class=nx>event</span><span class=p>.</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`執行時的環境變數 [apiSecret]: </span><span class=si>${</span><span class=nx>apiSecret</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=s1>&#39;ok&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>因為我們是定義在 Server API，所以可以在測試伺服器啟動的 Terminal 看見 console.log 的結果。</p><p><img src=https://live.staticflickr.com/65535/52617187068_2610474e64_o.png max-width=100% max-height=100% class=gallery-image></p><p>此外你也可以在插件或 Vue 中使用 <code>useRuntimeConfig()</code> 來取得執行時的設置，但也僅在 <strong>setup</strong> 或 <strong>Nuxt Lifecycle Hooks</strong> 中有效。</p><h4 id=客戶端使用-runtimeconfig>客戶端使用 runtimeConfig</h4><p>通常一些密鑰或敏感資訊，我們都會定義在 <code>runtimeConfig</code> 僅供伺服器端做使用，而 <code>runtimeConfig</code> 也可以配置一個 <code>public</code> 的屬性，來把一些環境變數於伺服器端或客戶端做使用，例如，API 的 Base URL 這類在伺服器端打 API 時會需要使用，而客戶端的操作流程也會打同樣的 API 位置，我們就可以使用 <code>public</code> 的屬性。</p><p>例如，在 <strong>nuxt.config.ts</strong> 檔案中，添加一個 <code>apiBase</code> 至 <code>runtimeConfig.public</code> 屬性內：</p><h5 id=nuxtconfigts-5>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>runtimeConfig</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiSecret</span><span class=o>:</span> <span class=s1>&#39;怎麼可以讓你知道呢 :P&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>apiBase</span><span class=o>:</span> <span class=s1>&#39;/api&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>新增 <strong>./pages/profile.vue</strong> 頁面：</p><h5 id=pagesprofilevue>pages/profile.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-2xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>回傳資料</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>data</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>apiBase</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=kr>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>toRaw</span><span class=p>(</span><span class=nx>runtimeConfig</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>apiBase</span><span class=si>}</span><span class=sb>/hello`</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>添加在 <code>runtimeConfig.public</code> 屬性的環境變數，在伺服器端與客戶端都可以讀取得到。</p><p>下圖中可以發現，在瀏覽器中的 Console 所印出的 <code>runtimeConfig</code> 是不會包含僅有在伺服器端能使用的 <code>apiSecret</code>。</p><p><img src=https://live.staticflickr.com/65535/52617134565_8558d435e9_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=使用-env-建立環境變數>使用 .env 建立環境變數</h4><p>Nuxt 在開發模式或執行時，已經有內建 <a class=link href=https://github.com/motdotla/dotenv target=_blank rel=noopener>dotenv</a>，如果在專案目錄下添加了 <code>.env</code>，Nuxt 會在開發期間、建構時或產生靜態網站時，自動載入 <code>.env</code> 內的環境變數。</p><p>例如建立 <strong>.env</strong> 檔案，內容如下：</p><h5 id=env>.env</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>NUXT_API_SECRET</span><span class=o>=</span>api_secret_token
</span></span><span class=line><span class=cl><span class=nv>NUXT_PUBLIC_API_BASE</span><span class=o>=</span>https://nuxtjs.org
</span></span></code></pre></td></tr></table></div></div><p>這兩個值，將被 <a class=link href=https://github.com/motdotla/dotenv target=_blank rel=noopener>dotenv</a> 自動載入至 <code>process.env</code> 中，作為環境變數。</p><h4 id=環境變數的覆蓋>環境變數的覆蓋</h4><p>不論是透過 <a class=link href=https://github.com/motdotla/dotenv target=_blank rel=noopener>dotenv</a> 自動載入 <strong>.env</strong> 或其他方式配置的環境變數，只要環境變數命名是 <code>NUXT_</code> 開頭，這個環境變數將會覆蓋 <code>runtimeConfig</code> 的設置。</p><p>舉例來說，當我們 <code>runtimeConfig</code> 設置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>runtimeConfig</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiSecret</span><span class=o>:</span> <span class=s1>&#39;怎麼可以讓你知道呢 :P&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>apiBase</span><span class=o>:</span> <span class=s1>&#39;/api&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 <strong>.env</strong> 檔案或其他方式設置下列環境變數：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>NUXT_API_SECRET</span><span class=o>=</span>api_secret_token
</span></span><span class=line><span class=cl><span class=nv>NUXT_PUBLIC_API_BASE</span><span class=o>=</span>https://nuxtjs.org
</span></span></code></pre></td></tr></table></div></div><p>那麼 <code>NUXT_API_SECRET</code> 環境變數，將會覆蓋 <code>runtimeConfig.apiSecret</code>，而 <code>NUXT_PUBLIC_API_BASE</code> 將會覆蓋 <code>runtimeConfig.public.apiBase</code>，最終 runtimeConfig 的設定會變成如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>apiSecret:</span> <span class=nt>&#34;api_secret_token&#34;</span><span class=p>,</span>     <span class=c1>// 被 NUXT_API_SECRET 環境變數覆蓋
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=err>public:</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>apiBase:</span> <span class=nt>&#34;https://nuxtjs.org&#34;</span>    <span class=c1>// 被 NUXT_PUBLIC_API_BASE 環境變數覆蓋 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></td></tr></table></div></div><p>會有這樣子的特性是因為 Nuxt 會在啟動時，先載入 <code>nuxt.conf.ts</code> 內的 <code>runtimeConfig</code>，建立出呼叫 <code>useRuntimeConfig()</code> 所得到的執行時設定，例如，先建構出了 <code>_runtimeConfig</code> 物件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>_runtimeConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>apiSecret</span><span class=o>:</span> <span class=s1>&#39;怎麼可以讓你知道呢 :P&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>public</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>apiBase</span><span class=o>:</span> <span class=s1>&#39;/api&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著會走訪這個 <strong>_runtimeConfig</strong> 物件裡面的 <code>key</code>，逐一將 <strong>key</strong> 的名稱轉換<strong>蛇形命名法 (Snake case)</strong>，並轉成全大寫再加上 <code>NUXT_</code> 前綴後取得對應的環境變數，如果存在就會以新值來覆蓋 <strong>_runtimeConfig</strong> 內的屬性。</p><p>例如 <strong>apiSecret</strong> 經過轉換變成 <strong>api_secret</strong>，接著轉大寫 <strong>API_SECRET</strong> 最後加上前綴變成 <strong>NUXT_API_SECRET</strong>，如此環境變數 <strong>NUXT_API_SECRET</strong> 的值就覆蓋 <strong>runtimeConfig.apiSecret</strong>。</p><p>而在 <strong>public</strong> 下的設置，也會先轉為 <strong>public_apiBase</strong> 再經過蛇行命名成 <strong>public_api_base</strong> 等步驟，最後變成 <strong>NUXT_PUBLIC_API_BASE</strong> 來載入環境變數並覆蓋。</p><blockquote><p>最後小提醒，當建構出生產環境的網站，如 .output 目錄後，dotenv 並不會包含在建構的網站內， 你需要再自己載入或配置環境變數才能正常運作哦，例如在 PM2 配置 env。</p></blockquote><h3 id=app-config>App Config</h3><h4 id=配置-appconfig>配置 appConfig</h4><p>在 <code>nuxt.config.ts</code> 檔案中，可以在 <code>appConfig</code> 屬性內添加設置，例如，通常我們會添加像網站主題的主色等這類<code>可以公開</code>的配置，讓網站可以使用這個設置。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>appConfig</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>primaryColor</span><span class=o>:</span> <span class=s1>&#39;#0ea5e9&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當建立好 appConfig 後，就可以使用組合式函數 <code>useAppConfig()</code> 來取得設置。</p><p>例如，建立 <strong>./pages/config.vue</strong>，內容如下：</p><h5 id=pagesconfigvue>pages/config.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-2xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>theme</span><span class=p>.</span><span class=nx>primaryColor</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>primaryColor</span> <span class=p>}}&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>appConfig</span> <span class=o>=</span> <span class=nx>useAppConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>theme</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>appConfig</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=appconfig-檔案>app.config 檔案</h4><p>你也可以在專案目錄下建立 <code>app.config.ts</code> 來配置 App Config，這個檔案的副檔名可以是 <strong>.ts</strong>、<strong>.js</strong> 或 <strong>.mjs</strong>。</p><h5 id=appconfigts>app.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineAppConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>primaryColor</span><span class=o>:</span> <span class=s1>&#39;#3b82f6&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當建立了 <code>app.config.ts</code> 檔案，該設定會與 <strong>nuxt.config.ts</strong> 檔案中的 <strong>appConfig</strong> 屬性結合，如果具有相同的命名，則以 <code>app.config.ts</code> 檔案內的設置為主。</p><h4 id=具有響應式的設定>具有響應式的設定</h4><p>當設定好的 App Config 在使用時，解構出的變數是具有響應性的，也就是說在其他頁面修改主題顏色的設定，可以響應至所有使用這個設定的元件。</p><p>舉個例子，新增一個 <strong>darkMode</strong> 的屬性至 <strong>app.config.ts</strong> 檔案內的 theme：</p><h5 id=appconfigts-1>app.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineAppConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>primaryColor</span><span class=o>:</span> <span class=s1>&#39;#3b82f6&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>darkMode</span>: <span class=kt>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 <strong>./pages/index.vue</strong>，內容如下：</p><h5 id=pagesindexvue-4>pages/index.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;bg-white py-24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-6xl font-semibold text-gray-800&#34;</span><span class=p>&gt;</span><span class=nx>這裡是首頁</span><span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-4 flex flex-col space-y-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/config&#34;</span><span class=p>&gt;</span><span class=nx>前往</span> <span class=o>/</span><span class=nx>config</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-2xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>theme</span><span class=p>.</span><span class=nx>darkMode</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>darkMode</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>appConfig</span> <span class=o>=</span> <span class=nx>useAppConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>theme</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>appConfig</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 <strong>./pages/config.vue</strong>，內容如下：</p><h5 id=pagesconfigvue-1>pages/config.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;my-24 flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-2xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>theme</span><span class=p>.</span><span class=nx>primaryColor</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>primaryColor</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-2xl text-gray-600&#34;</span><span class=p>&gt;</span><span class=nx>theme</span><span class=p>.</span><span class=nx>darkMode</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-4 text-3xl font-semibold text-blue-500&#34;</span><span class=p>&gt;{{</span> <span class=nx>theme</span><span class=p>.</span><span class=nx>darkMode</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>      <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 rounded-sm bg-blue-500 py-2 px-4 text-base font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;theme.darkMode = !theme.darkMode&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{{</span> <span class=sb>`</span><span class=si>${</span><span class=nx>theme</span><span class=p>.</span><span class=nx>darkMode</span> <span class=o>?</span> <span class=s1>&#39;取消&#39;</span> <span class=o>:</span> <span class=s1>&#39;啟用&#39;</span><span class=si>}</span><span class=sb>深色模式`</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>NuxtLink</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span><span class=nx>回首頁</span><span class=p>&lt;/</span><span class=nt>NuxtLink</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>appConfig</span> <span class=o>=</span> <span class=nx>useAppConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>theme</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>appConfig</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如下圖，我們的首頁取得了 <strong>App Config</strong> 中的 <strong>theme.darkMode</strong> 預設為 <code>false</code>，接著我們切換至 <strong>/config</strong> 頁面，可以將從 <code>useAppConfig()</code> 解構出的 theme 進行變更，我們使用按鈕來設置 <strong>theme.darkMode</strong> 為 <code>true</code> 或 <code>false</code> 表示啟用或取消深色模式。當變更完成後，回至首頁，可以發現 <strong>theme.darkMode</strong> 發生了響應。</p><p><img src=https://live.staticflickr.com/65535/52616188867_a568b0a7c2_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=小結-1>小結</h3><p>Nuxt 3 提供了 <strong>Runtime Config</strong> 及 <strong>App Config</strong> 來讓我們將常用或預設設定應用在不同的情境，使用時，我們僅需記得，<code>不能公開的金鑰</code>或<code>敏感訊息</code>，僅放置在 <code>runtimeConfig</code> 中而且<code>不在 public 屬性內</code>，<code>runtimeConfig.public</code> 通常放的是<code>前後端會使用到且不常修改的常數</code>。而 <code>App Config</code> 則是當伺服器端與客戶端<code>需要使用的設置</code>，如主題顏色、是否啟用深色模式等這類可以被使用者調整變動的且需要具有響應性，就可以放置在 <code>appConfig</code> 之中。</p><hr><h2 id=實作練習>實作練習</h2><p>這裡介紹網站的會員系統常會使用到第三方登入，將以 Google OAuth 為例來實際於 Nuxt 3 中做串接。</p><h3 id=串接-google-oauth-登入>串接 Google OAuth 登入</h3><p>首先，我們需要有一組 Google OAuth 使用的 <code>Client ID</code>，你可以到 <a class=link href=https://console.cloud.google.com/apis/credentials target=_blank rel=noopener>Google Console</a> 新增一個「<strong>OAuth 2.0 用戶端 ID</strong>」，這裡我就不再贅述網頁應用程式用的申請過程。</p><p>這邊小提醒一下，在建立 OAuth Client ID 時，<strong>已授權的 JavaScript 來源</strong>，記得填寫上您的正式環境或開發環境的 Domain，且建議使用 HTTPS。</p><p><img src=https://live.staticflickr.com/65535/52618245251_3509e645c4_o.png max-width=100% max-height=100% class=gallery-image></p><p>完成後，記得保管好<code>用戶端密碼</code>、<code>用戶端 ID (Client ID)</code> 是我們稍後會需要的，用戶端編號格式大概如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>168152363730-b37gnijdpa2rdvvbq0qc29cjh4082t3b.apps.googleusercontent.com
</span></span></code></pre></td></tr></table></div></div><p>我們將這組 Client ID，放置在 Nuxt 的 Runtime Config 之中。調整 <strong>nuxt.config.ts</strong> 內容，在 runtimeConfig.public 添加 <code>googleClientId</code>。</p><h5 id=nuxtconfigts-6>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>runtimeConfig</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>public</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>googleClientId</span><span class=o>:</span> <span class=s1>&#39;這邊放上你的 Google Client ID&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>接下來，安裝 Vue 的 Google OAuth 插件，這邊使用的是 <a class=link href=https://github.com/yobaji/vue3-google-login target=_blank rel=noopener>vue3-google-login</a>，也有詳細的<a class=link href=https://yobaji.github.io/vue3-google-login/ target=_blank rel=noopener>說明文件</a>可以參考。</p><p>安裝 <a class=link href=https://yobaji.github.io/vue3-google-login/ target=_blank rel=noopener>vue3-google-login</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D vue3-google-login
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D vue3-google-login</span>
</span></span></code></pre></td></tr></table></div></div><p>建立 Nuxt 3 插件來使用 <a class=link href=https://yobaji.github.io/vue3-google-login/ target=_blank rel=noopener>vue3-google-login</a>，新增 <strong>./plugins/vue3-google-login.client.js</strong>，內容如下：</p><h5 id=pluginsvue3-google-loginclientjs>plugins/vue3-google-login.client.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>vue3GoogleLogin</span> <span class=nx>from</span> <span class=s1>&#39;vue3-google-login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtPlugin</span><span class=p>((</span><span class=nx>nuxtApp</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>googleClientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=kr>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>nuxtApp</span><span class=p>.</span><span class=nx>vueApp</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>vue3GoogleLogin</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們在元件中可以直接使用 <code>&lt;GoogleLogin></code> 元件，並添加一個 <code>callback</code> 屬性；此外，我使用了 Nuxt 3 提供的 <code>&lt;ClientOnly></code> 元件，將 <code>&lt;GoogleLogin></code> 包裹起來，以確保該元件僅在客戶端做渲染，以免登入按鈕在初始化發生問題。</p><h5 id=pagesloginvue>pages/login.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>GoogleLogin</span> <span class=nt>:callback</span><span class=s>=&#34;callback&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ClientOnly</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>callback</span> <span class=o>=</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們啟動 Nuxt 伺服器，這邊我會習慣使用 <code>yarn run dev -- --https</code> 來啟用 <strong>HTTPS</strong> 做測試，就能發現使用 Google 帳號登入成功後，所返回的 Credential。</p><p><img src=https://live.staticflickr.com/65535/52618682810_b13a4d8304_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=one-tap-prompt>One Tap prompt</h3><p>你可以在 <code>&lt;GoogleLogin></code> 元件添加 <code>prompt</code> 屬性並設為 <code>true</code>，這樣就能同時啟用 <strong>Google 一鍵登入 (One Tap prompt)</strong> 的功能囉！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>GoogleLogin</span> <span class=nt>:callback</span><span class=s>=&#34;callback&#34;</span> <span class=na>prompt</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>或者也可以在 <code>onMounted</code> 中呼叫 <strong>vue3-google-login</strong> 的 <code>googleOneTap()</code> 方法，來單獨使用 <strong>One Tap prompt</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>googleOneTap</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue3-google-login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>onMounted</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>googleOneTap</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=自訂按鈕>自訂按鈕</h3><p>如果你想自訂登入按鈕的樣式，可以在 <code>&lt;GoogleLogin></code> 的預設插槽 (Slot) 做建立。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>GoogleLogin</span> <span class=nt>:callback</span><span class=s>=&#34;callback&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span><span class=nx>使用</span> <span class=nx>Google</span> <span class=nx>進行登入</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>GoogleLogin</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用自訂按鈕會讓 OAuth 流程稍微有點不一樣，當你登入成功後預設會回傳 <a class=link href=https://developers.google.com/identity/oauth2/web/guides/use-code-model#auth_code_handling target=_blank rel=noopener>Auth Code</a>。</p><p>如果設定屬性 <code>popup-type="TOKEN"</code>，則回傳 <a class=link href=https://developers.google.com/identity/oauth2/web/guides/use-token-model target=_blank rel=noopener>Access Token</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>GoogleLogin</span> <span class=nt>:callback</span><span class=s>=&#34;callback&#34;</span> <span class=na>popup</span><span class=nt>-type</span><span class=err>=&#34;</span><span class=na>TOKEN</span><span class=err>&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span><span class=nx>使用</span> <span class=nx>Google</span> <span class=nx>進行登入</span><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>GoogleLogin</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=使用-googletokenlogin>使用 googleTokenLogin()</h3><p>在元件中我們也可以自己建立 <code>handleGoogleLogin</code> 點擊事件，呼叫 <code>googleTokenLogin()</code> 方法並傳入設定在 <strong>Runtime Config</strong> 中的 <strong>Google Client ID</strong>，這樣點擊登入按鈕就能處理 Google 登入取得 <strong>Access Token</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>googleTokenLogin</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue3-google-login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>googleClientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=kr>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleGoogleLogin</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>googleTokenLogin</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>建立一個登入按鈕來呼叫 <code>handleGoogleLogin</code> 點擊事件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>      <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>      <span class=nt>@click</span><span class=s>=&#34;handleGoogleLogin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>使用</span> <span class=nx>Google</span> <span class=nx>繼續</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <strong>vue3-google-login</strong> 提供的 <code>googleTokenLogin()</code> 方法，我們就能取得 Google 使用者的 <strong>Access Token</strong> 囉！</p><p><img src=https://live.staticflickr.com/65535/52617734947_56a5365817_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=使用-googleauthcodelogin>使用 googleAuthCodeLogin()</h3><p>我們也可以使用 <code>googleAuthCodeLogin()</code> 來取得 <strong>Auth Code</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>googleAuthCodeLogin</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue3-google-login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>googleClientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=kr>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleGoogleLogin</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>googleAuthCodeLogin</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52618245191_6103912bce_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=伺服器端驗證>伺服器端驗證</h3><p>當使用者於前端成功登入後，通常會傳至後端進行登入或記錄使用者，再產生使用於網站的 Token、Cookie 或 Session 等，以供後續的網站驗證做使用。</p><p>我們可使用 <a class=link href=https://github.com/googleapis/google-auth-library-nodejs target=_blank rel=noopener>google-auth-library</a> 於後端進行一系列的驗證或取得使用者資訊。</p><p>安裝 <a class=link href=https://github.com/googleapis/google-auth-library-nodejs target=_blank rel=noopener>google-auth-library</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -D google-auth-library
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add -D google-auth-library</span>
</span></span></code></pre></td></tr></table></div></div><p>接下來，我們就能依照不同的登入方式取得的 <code>Credential</code>、<code>Access Token</code> 或 <code>Auth Code</code> 送至後端做驗證。</p><h4 id=驗證-access-token>驗證 Access Token</h4><p>新增一個 Server API，只接受 POST 方法，在 Body 中夾帶 <code>accessToken</code> 發送至後端。</p><p>建立 <strong>./server/api/auth/google.post.js</strong>，內容如下：</p><h5 id=serverapiauthgooglepostjs>server/api/auth/google.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>OAuth2Client</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;google-auth-library&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>readBody</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>oauth2Client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OAuth2Client</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>setCredentials</span><span class=p>({</span> <span class=nx>access_token</span><span class=o>:</span> <span class=nx>body</span><span class=p>.</span><span class=nx>accessToken</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>userInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>oauth2Client</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>request</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;https://www.googleapis.com/oauth2/v3/userinfo&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>revokeCredentials</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>createError</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusMessage</span><span class=o>:</span> <span class=s1>&#39;Invalid token&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>avatar</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>picture</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>emailVerified</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email_verified</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>調整元件內的登入流程。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>googleTokenLogin</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue3-google-login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>googleClientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=kr>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>userInfo</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleGoogleLogin</span> <span class=o>=</span> <span class=nx>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>accessToken</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>googleTokenLogin</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=nx>GOOGLE_CLIENT_ID</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=o>?</span><span class=p>.</span><span class=nx>access_token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>accessToken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;登入失敗&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/auth/google&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>accessToken</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>initialCache</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>userInfo</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們使用 Google OAuth 登入成功後，會取得 <strong>Access Token</strong>，並將其傳至 Server API，<code>/api/auth/google</code> 接收 <strong>Access Token</strong> 並使用 Google API 取得使用者的資訊，最後回傳給前端。</p><p><img src=https://live.staticflickr.com/65535/52618245256_903381f8c0_o.gif max-width=100% max-height=100% class=gallery-image></p><h4 id=驗證-credential>驗證 Credential</h4><p>在元件中，我們使用的登入方式如果是 <code>Google 渲染的預設按鈕</code>或 <code>One Tap prompt</code>，回傳值就會包含 <code>Credential</code>，我們將就可使用下面修改後的 Server API 進行驗證。</p><p><strong>server/api/auth/google.post.js</strong> 內容修改為如下：</p><h5 id=serverapiauthgooglepostjs-1>server/api/auth/google.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>OAuth2Client</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;google-auth-library&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>readBody</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>oauth2Client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OAuth2Client</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ticket</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>verifyIdToken</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>idToken</span><span class=o>:</span> <span class=nx>body</span><span class=p>.</span><span class=nx>credential</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>payload</span> <span class=o>=</span> <span class=nx>ticket</span><span class=p>.</span><span class=nx>getPayload</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>payload</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>createError</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusMessage</span><span class=o>:</span> <span class=s1>&#39;Invalid token&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>avatar</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>picture</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>emailVerified</span><span class=o>:</span> <span class=nx>payload</span><span class=p>.</span><span class=nx>email_verified</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=驗證-auth-code>驗證 Auth Code</h4><p>我們使用的登入方式如果是呼叫 <strong>vue3-google-login</strong> 的 <code>googleAuthCodeLogin()</code>，回傳值就會包含 <code>Auth Code</code>，我們就可使用下面修改後的 Server API 進行驗證。</p><p><strong>server/api/auth/google.post.js</strong> 內容修改為如下：</p><h5 id=serverapiauthgooglepostjs-2>server/api/auth/google.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>OAuth2Client</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;google-auth-library&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>readBody</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>oauth2Client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OAuth2Client</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientId</span><span class=o>:</span> <span class=s1>&#39;你的 Google Client ID&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>clientSecret</span><span class=o>:</span> <span class=s1>&#39;你的 Google Client Secret&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>redirectUri</span><span class=o>:</span> <span class=s1>&#39;你的 Google Redirect Uri&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=p>{</span> <span class=nx>tokens</span> <span class=p>}</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>getToken</span><span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>authCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>client</span><span class=p>.</span><span class=nx>setCredentials</span><span class=p>({</span> <span class=nx>access_token</span><span class=o>:</span> <span class=nx>tokens</span><span class=p>.</span><span class=nx>access_token</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>userInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>oauth2Client</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>request</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;https://www.googleapis.com/oauth2/v3/userinfo&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>revokeCredentials</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>createError</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusMessage</span><span class=o>:</span> <span class=s1>&#39;Invalid token&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>avatar</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>picture</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>emailVerified</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email_verified</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>以上實現了串接 Google OAuth 登入，並將 <code>Access Token</code> 資訊發送至後端進行驗證，大家可以在依照使用情境自己挑選登入方式及驗證方式，後續也能將使用者資訊儲存到資料庫中，有了資料庫我們就能依照使用者資訊，來比對資料庫進行註冊、驗證登入及產生後續的 Session 或 Cookie 等。</p><hr><h2 id=cookie-的設置與-jwt-的搭配>Cookie 的設置與 JWT 的搭配</h2><p>Cookie 在瀏覽網站時多會使用到，不論是用來儲存臨時的資訊或是辨識使用者等，這一個儲存在瀏覽器的一小段文字資料，會在每次發送 HTTP 請求時自動夾帶，所以 Cookie 最常見的用途就包含了登入狀態、驗證身份等。</p><p>以下將講述在 Nuxt 3 如何設置 Cookie，並結合 JWT (JSON Web Token) 來做一個實際使用者驗證。</p><h3 id=nuxt-3-cookie-的設置方式>Nuxt 3 Cookie 的設置方式</h3><h4 id=usecookie>useCookie</h4><p>Nuxt 3 提供了一個組合式函數 <code>useCookie()</code> 來讓我們可以讀寫 Cookie，並且對於 SSR 也有支援，在頁面、元件或插件中，都可以使用 <code>useCookie()</code> 來建立一個 cookie 具有響應性的參考。</p><p>使用方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cookie</span> <span class=o>=</span> <span class=nx>useCookie</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>options</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>name</strong>：對應的就是 cookie 的 key。</li><li><strong>options</strong>：傳入一個物件來設置多個 cookie 屬性：<ul><li><strong>maxAge</strong>：指定 <code>Max-Age</code> 屬性的值，單位是秒。如果沒有設置，則這個 cookie 將會是 Session Only，意即網頁關閉後就會消失。</li><li><strong>expires</strong>：指定一個 Date 物件來作為過期的時間，通常是要相容比較舊的瀏覽器做使用，如果 <strong>maxAge</strong> 與 <strong>expires</strong> 屬性都有設定，則過期時間應該要設定為一樣。</li><li><strong>httpOnly</strong>：是一個布林值，預設為 <code>false</code>，當設置為 <code>true</code> 時，表示客戶端的 JavaScript 將無法使用 <code>document.cookie</code> 來查看這個 cookie。通常是比較敏感或機密的訊息，如 Token 或 Session Id 會設定為 <code>true</code>，只讓瀏覽器發出請求時自動夾帶。</li><li><strong>secure</strong>：是一個布林值，預設為 <code>false</code>，當設置為 <code>true</code> 時瀏覽器得是 HTTPS 的加密傳輸協定的情境下，才會自動夾帶這個 cookie。</li><li><strong>domain</strong>：指定 cookie 可以適用的 Domain，通常會保持預設，表示適用於自己的 Domain 之下。</li><li><strong>path</strong>：指定 cookie 適用的路徑。</li><li><strong>sameSite</strong>：為一個布林值或是字串，用於設定<a class=link href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite target=_blank rel=noopener>安全策略</a>。</li><li><strong>encode</strong>：由於 cookie 的值只能使用有限的字元集，所以這個設置可以將 cookie 編碼成合法的字串值，預設的編碼是使用 <code>JSON.stringify</code> + <code>encodeURIComponent()</code>。</li><li><strong>decode</strong>：cookie 會經過一個解碼的過程，預設的解碼是使用 <code>decodeURIComponent</code> + <code>destr</code>。</li><li><strong>default</strong>：為一個函數，可以用於回傳 cookie 的預設值，也可以是回傳一個 <code>Ref</code>。</li></ul></li></ul><p>舉個例子，新增 <strong>pages/cookie.vue</strong>，內容如下：</p><h5 id=pagescookievue>pages/cookie.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;w-full max-w-md&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 text-center text-3xl font-bold tracking-tight text-gray-700&#34;</span><span class=p>&gt;</span><span class=nx>Cookie</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 flex w-full max-w-md flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;setNameCookie&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>設置</span> <span class=nx>name</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 flex&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>label</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-lg font-semibold text-emerald-500&#34;</span><span class=p>&gt;</span><span class=nx>name</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ml-2 flex text-lg text-slate-700&#34;</span><span class=p>&gt;{{</span> <span class=nx>name</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 flex w-full max-w-md flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>          <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;setCounterCookie&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nx>設置</span> <span class=nx>counter</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 flex&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>label</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-lg font-semibold text-emerald-500&#34;</span><span class=p>&gt;</span><span class=nx>counter</span><span class=o>:</span><span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;ml-2 flex text-lg text-slate-700&#34;</span><span class=p>&gt;{{</span> <span class=nx>counter</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>useCookie</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>useCookie</span><span class=p>(</span><span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>maxAge</span><span class=o>:</span> <span class=mi>60</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>setNameCookie</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s1>&#39;Ryan&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>setCounterCookie</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們就可以設置一個只有目前網頁有效的 cookie 名為 <code>name</code> 及一個過期時間為 60 秒後的 <code>counter</code>。</p><p><img src=https://live.staticflickr.com/65535/52618245241_9307ee8408_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=伺服器端使用-getcookie-與-setcookie>伺服器端使用 getCookie 與 setCookie</h3><p>你可以在伺服器端使用 <code>getCookie()</code> 來取得前端夾帶過來的 cookie，也可以使用 <code>setCookie</code> 來設置 cookie 回應給前端。</p><p>舉個例子，新增 <strong>server/api/coookie.js</strong>，內容如下：</p><h5 id=serverapicoookiejs>server/api/coookie.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>counter</span> <span class=o>=</span> <span class=nx>getCookie</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=s1>&#39;counter&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>counter</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>||</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nx>counter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setCookie</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=s1>&#39;counter&#39;</span><span class=p>,</span> <span class=nx>counter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>counter</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當前端打 <code>/api/cookie</code> 這隻 Server API 時，就會自動夾帶瀏覽器中的 cookie，伺服器端收到請求解析 cookie 後得到 <code>counter</code>，將其轉為數值或預設為 0 後增加 1，再重新設定回去給前端。</p><p><img src=https://live.staticflickr.com/65535/52618682865_832fc7b792_o.gif max-width=100% max-height=100% class=gallery-image></p><h3 id=使用-cookie-做使用者驗證>使用 Cookie 做使用者驗證</h3><p>我們可以將 Cookie 的運作機制應用在會員系統當中，使用者登入成功後，後端產生的 Token 或 Session 回傳並儲存在使用者的瀏覽器中，之後的請求將會自動夾帶可以辨識出使用者的 cookie，我們就可以在後端解析或比對 cookie 來驗證使用者的資訊，並依照策略給予不同的處理邏輯。</p><p>我們延續上述的<a class=link href=#%e4%b8%b2%e6%8e%a5-google-oauth-%e7%99%bb%e5%85%a5>使用 Google OAuth 登入</a>，我們可以在後端實作產生我們自己系統使用的 Token，並設置在 <code>access_token</code> 這個 cookie 之中，後端可以寫如下程式碼，來設置 <code>httpOnly</code> 及 <code>maxAge</code> 過期時間等參數。</p><h5 id=serverapiauthgooglepostjs-3>server/api/auth/google.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nx>setCookie</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=s1>&#39;access_token&#39;</span><span class=p>,</span> <span class=nx>accessToken</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxAge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>expires</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>expires</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>secure</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;production&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們使用 <a class=link href=https://github.com/auth0/node-jsonwebtoken target=_blank rel=noopener>jsonwebtoken</a> 產生 JWT，裡面的 Payload 放置了使用者資訊，其中 <code>jwtSignSecret</code> 作為核發 JWT 的簽署金鑰，我們定義在 <code>nuxt.config.ts</code> 中的 <code>runtimeConfig.jwtSignSecret</code>。</p><p>安裝 <a class=link href=https://github.com/auth0/node-jsonwebtoken target=_blank rel=noopener>jsonwebtoken</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install jsonwebtoken
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn add jsonwebtoken</span>
</span></span></code></pre></td></tr></table></div></div><p>完整的 <strong>./server/api/auth/google.post.js</strong> 程式碼如下：</p><h5 id=serverapiauthgooglepostjs-4>server/api/auth/google.post.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>OAuth2Client</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;google-auth-library&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>jwt</span> <span class=nx>from</span> <span class=s1>&#39;jsonwebtoken&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>readBody</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>oauth2Client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>OAuth2Client</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>setCredentials</span><span class=p>({</span> <span class=nx>access_token</span><span class=o>:</span> <span class=nx>body</span><span class=p>.</span><span class=nx>accessToken</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>userInfo</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>oauth2Client</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>request</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=s1>&#39;https://www.googleapis.com/oauth2/v3/userinfo&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>oauth2Client</span><span class=p>.</span><span class=nx>revokeCredentials</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>userInfo</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>createError</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusMessage</span><span class=o>:</span> <span class=s1>&#39;Invalid token&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>jwtTokenPayload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>sub</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>nickname</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>maxAge</span> <span class=o>=</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>24</span> <span class=o>*</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>expires</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>+</span> <span class=nx>maxAge</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>jwtToken</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>exp</span><span class=o>:</span> <span class=nx>expires</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=nx>jwtTokenPayload</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>runtimeConfig</span><span class=p>.</span><span class=nx>jwtSignSecret</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setCookie</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=s1>&#39;access_token&#39;</span><span class=p>,</span> <span class=nx>jwtToken</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxAge</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>expires</span><span class=o>:</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>expires</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=nx>secure</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;production&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>nickname</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>avatar</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>picture</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>JWT 在核發時使用的加密金鑰，建議使用非對稱式的金鑰進行加密，這邊僅是為了範例展示方便而使用相同的 Secret 進行加解密。</p></blockquote><p>接著，我們可以實作一個 Server API，<strong>./server/api/whoami.js</strong> 來從 cookie 得到 <code>access_token</code>，再用 <code>jwt.verify()</code> 方法，來驗證 JTW 後的到使用者資訊。</p><h5 id=serverapiwhoamijs>server/api/whoami.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=nx>jwt</span> <span class=nx>from</span> <span class=s1>&#39;jsonwebtoken&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>runtimeConfig</span> <span class=o>=</span> <span class=nx>useRuntimeConfig</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineEventHandler</span><span class=p>((</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>jwtToken</span> <span class=o>=</span> <span class=nx>getCookie</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=s1>&#39;access_token&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>userInfo</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>jwtToken</span><span class=p>,</span> <span class=nx>runtimeConfig</span><span class=p>.</span><span class=nx>jwtSignSecret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>nickname</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>nickname</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=o>:</span> <span class=nx>userInfo</span><span class=p>.</span><span class=nx>email</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>createError</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusCode</span><span class=o>:</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>statusMessage</span><span class=o>:</span> <span class=s1>&#39;Unauthorized&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>我們在前端，就可以使用 <code>/api/whoami</code> 這隻 API 來得到使用者的資訊囉！</p><p><img src=https://live.staticflickr.com/65535/52618515934_2af8149c8f_o.gif max-width=100% max-height=100% class=gallery-image></p><p>上圖的流程如下：</p><ol><li>前往登入頁面，並使用 Google 進行登入</li><li>登入成功後，打 <strong>/api/auth/google</strong> API，Body 夾帶 Google OAuth 回傳的 <code>access_token</code>。</li><li><strong>/api/auth/google</strong> API 回傳後端產生的時效七天的 JWT，並設置於 cookie 的 <code>access_token</code>，並將前端頁面導航至 <strong>/whoami</strong> 頁面。</li><li>在 <strong>/whoami</strong> 頁面，點擊「<strong>打 /api/whoami API</strong>」按鈕，送出 <strong>/api/whoami</strong> API 請求，瀏覽器會自動夾帶 cookie 至後端。</li><li>後端 API <strong>/api/whoami</strong> 收到請求後，從 cookie 中解析出 <code>access_token</code> 的值，並驗證解析出 JWT 內含的使用者資訊，並將其回傳至前端渲染。</li></ol><p><strong>pages/whoami.vue</strong> 完整程式碼：</p><h5 id=pageswhoamivue>pages/whoami.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;w-full max-w-md&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 text-center text-3xl font-bold tracking-tight text-gray-700&#34;</span><span class=p>&gt;</span><span class=nx>我是誰</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-6 flex w-full max-w-md flex-col items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>        <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>class</span><span class=o>=</span><span class=s>&#34;mt-2 w-fit rounded-sm bg-emerald-500 py-2 px-4 text-sm text-white hover:bg-emerald-600 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nt>@click</span><span class=s>=&#34;whoami&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>打</span> <span class=o>/</span><span class=nx>api</span><span class=o>/</span><span class=nx>whoami</span> <span class=nx>API</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=nt>v-if</span><span class=s>=&#34;userInfo&#34; class=&#34;mt-8 flex w-full max-w-md flex-col&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>      &lt;div v-for=&#34;key in Object.keys(userInfo)&#34; :key=&#34;key&#34; class=&#34;mt-1 flex flex-wrap break-all&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;label class=&#34;text-lg font-semibold text-emerald-500&#34;&gt; {{ key }}:&lt;/label&gt;
</span></span></span><span class=line><span class=cl><span class=s>        &lt;span class=&#34;ml-2 flex flex-1 text-lg text-slate-700&#34;</span><span class=p>&gt;{{</span> <span class=na>userInfo</span><span class=err>[</span><span class=na>key</span><span class=err>]</span> <span class=p>}}&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>userInfo</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>whoami</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/whoami&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>userInfo</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>至此，我們就實作出一個 Google OAuth 的登入及驗證機制，後續可以再將這些資訊儲存至資料庫之中做後續的使用。</p><p>這個範例的完整程式碼可以參考 <a class=link href=https://github.com/wjdesign/ithome-2022-ironman-nuxt3/tree/day20/nuxt-app-whoami target=_blank rel=noopener>Nuxt 3 - 使用 Cookie 與 JWT 做使用者驗證</a></p><p>小提醒，如果是在伺服器端打 API，可以使用 <a class=link href=https://nuxt.com/docs/api/composables/use-request-headers target=_blank rel=noopener>useRequestHeaders</a> 就可以從伺服器端訪問和代理 cookie 到 API。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>data</span><span class=o>:</span> <span class=nx>userInfo</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>await</span> <span class=nx>useFetch</span><span class=p>(</span><span class=s1>&#39;/api/whoami&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>:</span> <span class=nx>useRequestHeaders</span><span class=p>([</span><span class=s1>&#39;cookie&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cookielocalstoragetoken-與-jwt>Cookie、LocalStorage、Token 與 JWT</h3><p>在做使用者驗證的時候，Cookie、LocalStorage、Token 與 JWT 是個重要的概念，這邊稍微簡述一下之間的差異與使用情境。</p><h4 id=cookie>Cookie</h4><p>通常採用 Cookie 來驗證使用者時，當使用者登入成功，會由伺服器端產生一組 cookie 來當作後續驗證使用的依據，這個依據會是一個字串形式，瀏覽器每次發送請求時會<code>自動夾帶</code>符合 Domain、路徑設定等的 cookie，伺服器端就可以依據 cookie 來解析驗證這個字串所代表的涵意，例如是不是匹配代表某位使用者字串。</p><p>如同前面的例子，我們將一組能夠代表 <strong>Ryan</strong> 的 JWT 由登入後產生，並在後續請求中夾帶，以達到驗證使用者的效果。</p><p>這串字串，不一定是要 JWT，只要伺服器端能回推或從資料庫比對出所代表的使用者或特定資訊，那麼也可以是隨意產生的字串。</p><h4 id=localstorage>LocalStorage</h4><p>LocalStorage 是現今瀏覽器基本上都支援的一個儲存空間，同樣具有 Domain 的寫入與讀取的概念，在 cookie 我們最多只能儲存 <strong>4KB</strong> 左右的字串資料，但是在 LocalStorage 通常有 <code>5MB</code> 所以能夠儲存更多的資訊。</p><p>也有網站會把驗證使用者的 Token 或憑證依據儲存在 LocalStorage，之後發送請求或需要時再從中拿取出來並手動夾帶出去，同樣也可以實作出驗證使用者的流程。</p><p>在瀏覽器的儲存空間，還有一個 SessionStorage，儲存在這裡面的資料，當網頁關閉時，就會自動清除。與 LocalStorage 不同，除非手動或使用 JS 清除，不然資料永遠存在，也不會有過期時間。</p><h4 id=token>Token</h4><p>用於提供給使用者後續夾帶給後端的憑據，相當於一個身分證，Token 通常由字串組成，且需要夠長不容易被暴力嘗試破解，Token 字串通常不具有任何意義，直至後端與資料庫或其他方式比對後，會對應出 Token 所代表的意義，例如使用者資訊。</p><p>通常請求夾帶的 Token，需要每次往快取或資料庫做比對，才能知道 Token 所代表的使用者。</p><h4 id=jwtjson-web-token>JWT(JSON Web Token)</h4><p>JWT 是一種開放的標準 <a class=link href=https://www.rfc-editor.org/rfc/rfc7519 target=_blank rel=noopener>RFC 7519</a>，如同名字 JWT 是基於 JSON Object 所編碼出來的，JWT 是由三個部分 <code>Header</code>、<code>Payload</code> 及 <code>Signature</code> 組合而成。</p><p>其中最大的特色就是 <code>Payload</code> 這個部分，當後端伺服器收到 JWT 時，可以從 <code>Payload</code> 解析出當初簽發 JWT 所包含的資訊，通常會在 <code>Payload</code> 放置使用者的相關資料，如 Id、姓名或信箱等，因為這個特色我們不需要再比對快取或資料庫，就可以直接解析出使用者資料。</p><p>而 <code>Payload</code> 這個欄位，因為可以被解碼出來，再任意的修改後重新編碼，所以我們就會借助 <code>Header</code> 及 <code>Signature</code> 這兩個部分，來確認當初加密的演算法及驗證簽章是否符合，以防止 <code>Payload</code> 被任意的竄改。</p><h4 id=token-或-jwt-選哪一個>Token 或 JWT 選哪一個？</h4><p>這兩者之間各有優缺點，雖然自產 Token 需要每次比對資料庫，但是能有效的記錄使用者 Token 核發使用的位置及註銷特定的 Token，因為 JWT 在簽發後，一定得等到過期才會失效無法使用，也就導致 JWT 在核發之後是無法註銷的，除非自己在實作一個黑名單或白名單的機制。</p><p>可以依據使用的情境來決定 Token 或 JWT，只要記得使用 Token 作為解決方案，要保證 Token 足夠複雜或隨機，不容易被推測或暴力嘗試，如果真的要使用比較短的 Token 也確保過期的時間不要設定太長，要頻繁的更換這組 Token 或添加其他驗證機制。</p><p>而 JWT 的利於可以包含 Payload，也切記在後端核發時不要將敏感資料或密鑰夾帶在 Payload 之中，因為 JWT 的 Payload 就算不知道加密的私鑰還是可以被解碼的。而簽發 JWT 選擇加密的方式也盡量採用非對稱式的家姐密，例如使用 ES256 (ECDSA-SHA256) 演算法產生的非對稱金鑰來進行加密。</p><h4 id=token-要放在-cookie-還是-localstorage>Token 要放在 Cookie 還是 LocalStorage？</h4><p>後端產生的 Token 或 JWT，不管存放在 Cookie 或 LocalStorage 只要注意其特性及安全，那麼想存在哪裡，都是可以被接受的。</p><ul><li>放在 Cookie</li></ul><p>將 Token 存放在 Cookie 的好處，可以用來控制網站的 Domain 或 SubDomain 進行存取，也可以設定過期時間來控制前端是否要重新問後端產生新的 Token，最大的特點就是自動夾帶在每個請求當中，也因為這項特性，有一些資安風險就需要稍微注意一下。</p><p><a class=link href=https://owasp.org/www-community/attacks/csrf target=_blank rel=noopener>跨站請求偽造 (Cross Site Request Forgery, CSRF)</a> 就是一個 cookie 使用時所需要注意的資安問題，所以當使用 cookie 作為驗證機制時，建議在敏感的操作上多添加驗證的機制，或使用 CSRF Token 來保護你的 cookie 不被隨意偽造請求的夾帶出去。</p><p>將 Token 或敏感資料儲存在 cooike 時，還是可以透過 JavaScript 的 <code>document.cookie</code> 做存取，所以如果網站有存在<a class=link href=https://owasp.org/www-community/attacks/xss/ target=_blank rel=noopener>跨網站指令碼 (Cross-site scripting, XSS)</a> 的弱點，你的 cookie 很可能就會直接被偷走，為了防止 XSS 弱點導致 cookie 外洩，你可以將 cookie 設值時的屬性 <code>httpOnly</code> 設置為 <code>true</code>，讓客戶端瀏覽器無法直接存取，僅有在發送請求時，由瀏覽器自動夾帶至後端，此外，也可以設置 <code>secure</code> 讓 cookie 只在 HTTPS 下傳輸。</p><ul><li>放在 LocalStorage</li></ul><p>關於 Token 是否儲存在 LocalStorage 其實有不同的看法，因為 cookie 存在著 CSRF 或 XSS 等問題需要解決，而存放在 LocalStorage 不僅有更大的空間，還不自帶免疫 CSRF，難道不香嗎？</p><p>但是別忘了 LocalStorage 也是透過 JS 來做儲存與讀取，所以就算使用 LocalStorage 了，但 XSS 弱點如果存在，你的 Token 一樣有外洩的可能性。</p><p>而且 LocalStorage 不具有過期自動刪除的特性，除非自己實作或刪除否則將永遠的存在瀏覽器之中。</p><p>所以？</p><p>網路上有許多使用 Cookie 或 LocalStorage 儲存 Token 說法，有興趣也可以看看兩派各自論述的優缺點，所以，不管是 Cookie 還是 LocalStorage 沒有說一定不能使用誰，而是要依據特性及情境來做使用，並做好定期重新產生及相關的安全配置。</p><p>我自己大概會依照這個網站或服務，是相對簡單也比較不會有會造成悲劇的操作或內容管理為主的服務，我可能就會採用 cookie 的方案處理驗證，因為相對來說自動夾帶與有效期限及 <code>httpOnly</code> 來控制客戶端是否能直接存取，對我來說還是挺方便與安全的，可能在適當的時機再添加 CSRF Token 或多道驗證機制，就能安全的使用 cookie。</p><p>而在多為內部系統使用或是 API 在 Mobile App 甚至是不支援 Cookie 環境之下需要使用 Token 來驗證，我就會採納將 Token 儲存在 LocalStorage。</p><hr><h2 id=搜尋引擎最佳化-seo-與-html-meta-tag>搜尋引擎最佳化 (SEO) 與 HTML Meta Tag</h2><p>選擇使用 Nuxt 3 作為網站開發框架的開發者，多數都是為了要使用 SSR 或 SSG 來加強對 SEO 的優化設置，這篇將會講述 Nuxt 提供的幾個組合式函數，來協助我們設置網頁的標題、內文、Meta 等，以此來設置 SEO 或外部連結可能會解析到的標籤與數值內容。</p><h3 id=搜尋引擎最佳化-seo---網站的標題-title-與描述-description>搜尋引擎最佳化 (SEO) - 網站的標題 (Title) 與描述 (Description)</h3><p>當網站需要做搜尋引擎最佳化 (SEO) 的時候，<strong>Meta Tag</strong> 這個名詞你一定不能忽略，<strong>Meta Tag</strong> 稱之為<strong>元標籤</strong>或<strong>描述標籤</strong>，顧名思義，是來額外描述網頁的資料使用；<strong>Meta Tag</strong> 通常放置在 HTML 的 中，雖然 <strong>Meta Tag</strong> 不會直接顯示在網頁上，但對於搜尋引擎的爬蟲來說，是相當重要的一項識別資訊，也是 Facebook 提出的 <strong>Open Graph</strong> 放置的位置，讓網頁的標題、描述或縮圖等，能正確的被解析顯示出來。</p><p>那麼網頁標題與描述，如果正確設定會有什麼樣子的效果呢？舉例來說，前面的【串接 Google OAuth 登入】我們可以透過網頁原始碼來查看，可以發現 <code>&lt;title></code> 與 <code>&lt;meta name="description" … /></code> 都有設定。</p><p><img src=https://live.staticflickr.com/65535/52618814898_c2eb521b53_o.png max-width=100% max-height=100% class=gallery-image></p><p>搜尋引擎爬蟲在收錄網頁時，就會解析這些標籤來建立索引，我們在使用搜尋資料時，網頁的資訊也就對應著顯示出來，如下圖。</p><p><img src=https://live.staticflickr.com/65535/52618326416_00c8081182_o.png max-width=100% max-height=100% class=gallery-image></p><p>各家的搜尋引擎爬蟲，雖然都有自己解析的規則，不過根據 SEO 的經驗都有大方向能夠依循做建立，此外就是在針對特定的搜尋引擎加強識別標記，遵照官方指引就能讓網站的內容能見度有顯著提升。</p><h3 id=網站的-open-graph-og>網站的 Open Graph (OG)</h3><p><strong>OG</strong> 是由 Facebook 所提出的設定，全名為 <strong>Open Graph Protocol</strong>，官方翻譯為「<strong>開放社交關係圖</strong>」，在設定網站的 <strong>Meta</strong> 時通常也稱 <strong>OG Tag</strong>，Facebook 提供了<a class=link href=https://developers.facebook.com/docs/sharing/webmasters target=_blank rel=noopener>網站管理員分享指南</a>，當初設計的目的是，當網頁中設定了 <strong>OG Tag</strong>，能讓網頁被分享至社群媒體時，能有呈現更為豐富的內容，例如標題、描述及縮圖等。</p><p>舉例來說，當<a class=link href=https://wayneblog.ga/2022-12-12/nodejs-create-openai-line-bot/ target=_blank rel=noopener>網頁</a>設定了 <strong>OG Tag</strong>，以連結形式被分享至 Facebook，會呈現如下的資訊，Facebook 會解析網頁內的 <strong>OG Tag</strong> 將對應的如標題及縮圖等資訊顯示出來。</p><p><img src=https://live.staticflickr.com/65535/52618326446_7205784c15_o.png max-width=100% max-height=100% class=gallery-image></p><p>其中縮圖依照 Facebook 的指引，即是對應網頁中的 <code>&lt;meta property="og:image" ... /></code>。</p><p><img src=https://live.staticflickr.com/65535/52617815467_ca6f72b1e6_o.png max-width=100% max-height=100% class=gallery-image></p><p>不只是在 Facebook 上分享連結會有<code>連結預覽</code>的效果，也因為大家都遵循著 <strong>OG Tag</strong> 進行設定，所以在其他主流的社群媒體或通訊軟體等也都有跟進解析。例如，我們使用 LINE 傳送一條連結，也會因為設置了 <strong>OG Tag</strong> 也有成功解析出<code>連結預覽</code>的效果。</p><p><img src=https://live.staticflickr.com/65535/52618814953_27c41dfc45_o.png max-width=100% max-height=100% class=gallery-image></p><p>LINE 開發者也有提供一些問答指引可以做參考，<code>連結預覽</code>與 <code>og:title</code>、<code>og:description</code> 和 <code>og:image</code> 有著相應的設定關係。</p><p><img src=https://live.staticflickr.com/65535/52618595494_9fd4af0f1e_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=usehead>useHead</h3><p>我們可以使用 Nuxt 3 提供的 <code>useHead()</code> 組合式函數，來設定網站的一些標籤或標記，使用方式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Nuxt 3 Blog&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>viewport</span><span class=o>:</span> <span class=s1>&#39;width=device-width, initial-scale=1, maximum-scale=1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>charset</span><span class=o>:</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>meta</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;description&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=o>:</span> <span class=s1>&#39;這裡是 Nuxt 3 學習筆記 實戰部落格&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>bodyAttrs</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>class</span><span class=o>:</span> <span class=s1>&#39;test&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>useHead()</code> 函數接受參數的類型如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>useHead</span><span class=p>(</span><span class=nx>meta</span>: <span class=kt>Computable</span><span class=p>&lt;</span><span class=nt>MetaObject</span><span class=p>&gt;)</span><span class=o>:</span> <span class=k>void</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>MetaObject</span> <span class=kr>extends</span> <span class=nx>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>charset?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>viewport?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>meta?</span>: <span class=kt>Array</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>link?</span>: <span class=kt>Array</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>style?</span>: <span class=kt>Array</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>script?</span>: <span class=kt>Array</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>noscript?</span>: <span class=kt>Array</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>titleTemplate?</span>: <span class=kt>string</span> <span class=o>|</span> <span class=p>((</span><span class=nx>title</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>title?</span>: <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>bodyAttrs?</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>htmlAttrs?</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>any</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>charset</strong>：指定 HTML 的字元編碼，預設為 <code>utf-8</code>。</li><li><strong>viewport</strong>：設定網頁的可見區域，預設為 <code>width=device-width, initial-scale=1</code>。</li><li><strong>meta</strong>：接受一個陣列，陣列中的每個元素，都將會建立一個 <code>&lt;meta></code> 標記，元素中物件的屬性將對應至 的屬性。</li><li><strong>link</strong>：接受一個陣列，陣列中的每個元素，都將會建立一個 <code>&lt;link></code> 標記，元素中物件的屬性將對應至 的屬性。</li><li><strong>style</strong>：接受一個陣列，陣列中的每個元素，都將會建立一個 <code>&lt;style></code> 標記，元素中物件的屬性將對應至 的屬性。</li><li><strong>script</strong>：接受一個陣列，陣列中的每個元素，都將會建立一個 <code>&lt;script></code> 標記，元素中物件的屬性將對應至 的屬性。</li><li><strong>noscript</strong>：接受一個陣列，陣列中的每個元素，都將會建立一個 <code>&lt;noscript></code> 標記，元素中物件的屬性將對應至 的屬性。</li><li><strong>titleTemplage</strong>：接受一個字串或函數，用來動態的設定該頁面元件的<code>網頁標題</code>。</li><li><strong>title</strong>：在頁面元件設置靜態的<code>網頁標題</code>。</li><li><strong>bodyAttrs</strong>：接受一個物件，設置網頁中 標籤的屬性，物件中的屬性將對應至 的屬性。</li><li><strong>htmlAttrs</strong>：接受一個物件，設置網頁中 標籤的屬性，物件中的屬性將對應至 的屬性。</li></ul><h4 id=自訂-metadata>自訂 Metadata</h4><p>使用 <code>useHead()</code> 函數設定屬性所傳入的字串或物件可以是具有響應性的變數，當數值變動時，相對應的數值也會一同響應，例如下面的程式碼，可以動態的變更標題或描述。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Nuxt 3 Blog&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>description</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;這裡是 Nuxt 3 學習筆記 實戰部落格&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>meta</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;description&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=nx>description</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=添加動態網頁的標題>添加動態網頁的標題</h4><p>我們可以在 <strong>app.vue</strong> 添加如下程式碼，<strong>titleTemplage</strong> 中的 <code>%s</code> 將會帶入目前頁面 <code>title</code> 或更上層頁面的 <code>title</code> 屬性：</p><h5 id=appvue-12>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Nuxt 3 Blog&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>titleTemplate</span><span class=o>:</span> <span class=s1>&#39;%s - 首頁&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>可以看到網頁的標題變為「Nuxt 3 Blog - 首頁」。</p><p><img src=https://live.staticflickr.com/65535/52618326576_756d879b60_o.png max-width=100% max-height=100% class=gallery-image></p><p>你也可以傳入一個函數來動態的添加網頁的標題。</p><h5 id=appvue-13>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Nuxt 3 Blog&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>titleTemplate</span><span class=o>:</span> <span class=p>(</span><span class=nx>title</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>title</span> <span class=o>?</span> <span class=sb>`</span><span class=si>${</span><span class=nx>title</span><span class=si>}</span><span class=sb> - 首頁`</span> <span class=o>:</span> <span class=s1>&#39;首頁&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=添加外部-css>添加外部 CSS</h4><p>我可以使用 <code>useHead()</code> 來添加 Google 字體至 <code>link</code> 屬性之中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>  
</span></span><span class=line><span class=cl>  <span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>link</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nx>rel</span><span class=o>:</span> <span class=s1>&#39;preconnect&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nx>href</span><span class=o>:</span> <span class=s1>&#39;https://fonts.googleapis.com&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nx>rel</span><span class=o>:</span> <span class=s1>&#39;stylesheet&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nx>href</span><span class=o>:</span> <span class=s1>&#39;https://fonts.googleapis.com/css2?family=Roboto&amp;display=swap&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=nx>crossorigin</span><span class=o>:</span> <span class=s1>&#39;&#39;</span> 
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=添加第三方的-javascript>添加第三方的 JavaScript</h4><p>你也可以使用 <code>useHead()</code> 來插入第三方的 JS。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>script</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>src</span><span class=o>:</span> <span class=s1>&#39;https://third-party-script.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=在模板中使用相對應的元件設置屬性及標籤>在模板中使用相對應的元件設置屬性及標籤</h4><p>Nuxt 提供 <code>&lt;Title></code>、<code>&lt;Base></code>、<code>&lt;Script></code>、<code>&lt;NoScript></code>、<code>&lt;Style></code>、<code>&lt;Meta></code>、<code>&lt;Link></code>、<code>&lt;Body></code>、<code>&lt;Html></code> 和 <code>&lt;Head></code>，我們可以直接在元件中模板 (Template) 使用這些元件進行設定網頁的屬性及標籤。</p><p>因為這些元件名稱與原生 HTML 標記相似，所以記得在模板中使用要開頭為<code>大寫</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Title</span><span class=p>&gt;{{</span> <span class=nx>title</span> <span class=p>}}&lt;/</span><span class=nt>Title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;description&#34;</span> <span class=nt>:content</span><span class=s>=&#34;description&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Style</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/css&#34;</span> <span class=na>children</span><span class=o>=</span><span class=s>&#34;body { background-color: green; }&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>Style</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>Head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;{{</span> <span class=nx>title</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;Nuxt 3 Blog&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>description</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=s1>&#39;這裡是 Nuxt 3 學習筆記 實戰部落格&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=definepagemeta>definePageMeta()</h3><p>我們其實在前面就有使用過 <code>definePageMeta()</code> 來設置頁面的布局或中間件，在各個頁面之中，我們也可以使用 <code>definePageMeta()</code> 來設置一些屬性與 <code>useHead()</code> 進行搭配。</p><p>例如，我們的 <strong>app.vue</strong> 使用 <code>useHead</code> 設定的一個 <strong>meta</strong>，並且是根據 <strong>route.meta.title</strong> 所動態的設定。</p><h5 id=appvue-14>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>route</span> <span class=o>=</span> <span class=nx>useRoute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useHead</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>meta</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;og:title&#39;</span><span class=p>,</span> <span class=nx>content</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>route</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>title</span><span class=si>}</span><span class=sb> | Nuxt 3 Blog`</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們在 <strong>pages/articles.vue</strong> 添加如下程式碼：</p><h5 id=pagesarticlesvue>pages/articles.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>definePageMeta</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;所有文章&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>當我們瀏覽 <strong>/articles</strong> 頁面時，Nuxt 在伺服器端就幫我們渲染好 <code>og:title</code> 的 <code>meta</code> 了。我們可以透過檢視原始碼的方式來看看效果。</p><p><img src=https://live.staticflickr.com/65535/52618815023_04fb4a9b6a_o.png max-width=100% max-height=100% class=gallery-image></p><p>在 Nuxt 3 提供了一些可以設置網頁屬性與 <strong>Meta</strong> 的組合式函數，更能動態的調整與響應，結合 SSR 讓這些標記在伺服器端就能渲染出來，對網站做搜尋引擎最佳化 (SEO) 非常得友善，也是多數人選擇 Nuxt 3 來處理 SSR 與 SEO 的原因。除了 SEO 可能會使用到的標記外，也有 <strong>OG Tag</strong> 可以加強網頁的連結預覽效果，雖然 <strong>OG Tag</strong> 與 SEO 沒有絕對的關係，但是透過伺服器端渲染調整這些 <strong>Meta</strong> 對搜尋引擎或網站都非常的方便，我們只要根據需求及指引做設定，就能對網站的能見度有所提升。</p><hr><h2 id=public-與-assets-資源目錄nuxt-3-的靜態資源>Public 與 Assets 資源目錄(Nuxt 3 的靜態資源)</h2><p>在網站的開發過程中，多少會使用到圖片、樣式或設定字體，而當這些檔案若沒有外部連結或某些需求下需要包含在專案內做使用，最後連帶這些檔案一起部署。在使用 <a class=link href=https://github.com/vuejs/create-vue target=_blank rel=noopener>create-vue</a> 建立的 Vue 的專案下包含了 <code>public</code> 與 src 內的 <code>assets</code> 目錄，這兩個目錄都是可以放置這類不常變動的靜態資源，但這兩個目錄各自因為一些特性，建議放置的檔案類型依據使用目的有所區別。</p><p>Nuxt 3 使用專案下的兩個目錄來提供使用者處理圖片、樣式或字體，這兩個目錄分別為 <code>public</code> 與 <code>assets</code>。</p><h3 id=public-目錄>public 目錄</h3><p>在 Nuxt 3 的專案根目錄下，存在一個名為 <code>public</code> 的目錄，這個目錄如同 Vue 中的 <code>public</code> 目錄或 Nuxt 2 中的 <code>static</code> 目錄。這個目錄下的檔案，將會由 Nuxt 直接於網站的根路徑，例如 <code>/</code> 提供存取。</p><p>例如建立 <strong>public/robots.txt</strong> 將可以使用 <a class=link href=http://localhost:3000/robots.txt target=_blank rel=noopener>http://localhost:3000/robots.txt</a> 存取。</p><p>通常我們會在 <code>public</code> 目錄放置不常更動的檔案，或是需要保留檔案的名稱，例如 <strong>robots.txt</strong> 就需要一個固定的名稱，才能正確的被搜尋引擎的爬蟲所解析再決定檢索的規則，抑或 <strong>sitemap.xml</strong> 與 <strong>favicon.ico</strong> 檔案等，都很適合放置在 <code>public</code> 目錄。</p><p>你可能也會想，那圖片或 CSS 樣式，我也不常變動，難道就不能放置在 public 目錄嗎？</p><p><strong>行，當然行，哪次不行！</strong></p><p><img src=https://live.staticflickr.com/65535/52630176588_1a720e08f8_o.png max-width=100% max-height=100% class=gallery-image></p><p>舉個例子，我們將這張圖片放置於 <code>public</code> 目錄下並命名為 <strong>bg.png</strong>，專案目錄下其他檔案就先不列，整個結構大概長的像下面這樣。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxt-app/
</span></span><span class=line><span class=cl>├── public/
</span></span><span class=line><span class=cl>│   └── bg.png
</span></span><span class=line><span class=cl>└── app.vue
</span></span></code></pre></td></tr></table></div></div><p>根據規則，我可以使用 <a class=link href=http://localhost:3000/bg.png target=_blank rel=noopener>http://localhost:3000/bg.png</a> 存取，如下圖我們確實成功的能存取到圖片。</p><p><img src=https://live.staticflickr.com/65535/52630176003_baa9c8737a_o.png max-width=100% max-height=100% class=gallery-image></p><p>所以，我們在 <strong>app.vue</strong> 新增如下程式碼，使用 <code>/bg.png</code> 來等同訪問 <strong>public/bg.png</strong> 檔案：</p><h5 id=appvue-15>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/bg.png&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>也確實能在網頁中使用 <code>&lt;img src="/bg.png" /></code> 來顯示圖片。</p><p><img src=https://live.staticflickr.com/65535/52629175752_c8f3b2c406_o.png max-width=100% max-height=100% class=gallery-image></p><p>既然 <code>public</code> 目錄已經能提供靜態資源的連結，那麼為什麼還有一個名為 <code>assets</code> 的目錄呢？接下來我們先介紹 <code>assets</code> 目錄，最後再來總結一下差異。</p><h3 id=assets-目錄-1>assets 目錄</h3><p>Nuxt 3 使用 <a class=link href=https://vitejs.dev/guide/assets.html target=_blank rel=noopener>Vite</a> 或 <a class=link href=https://webpack.js.org/guides/asset-management/ target=_blank rel=noopener>Webpack</a> 來建構專案進行打包，這些建構工具主要功能是用來處理 JavaScript 檔案將其編譯、轉換或壓縮等，但它們可以透過各自的<strong>插件</strong>或 <strong>Loader</strong> 來處理其他檔案類型的資源，例如樣式、字體或 SVG 等。</p><p>舉例來說，我們在 <code>assets</code> 下建立一個 Sass 的樣式，當這個 Sass 檔案被載入使用，就會經過<strong>插件</strong>或 <strong>Loader</strong> 來進行 CSS 的預處理及編譯，最終產生一個 CSS 檔案，也可以針對單純的 CSS 檔案進行壓縮。又或者說，當使用 <code>&lt;img></code> 的 <strong>src</strong> 屬性設定載入我們放置在 <code>assets</code> 的圖片或圖示，最終需要轉換為 Base64 編碼而不是產生一個連結，我們也需要依賴建構工具插件的擴展來幫助。</p><p>其主要的目的，不外乎就是為了效能與解決瀏覽器的快取。放置在 <code>assets</code> 目錄下的檔案，可能會被<strong>插件</strong>或 <strong>Loader</strong> 進行轉換或壓縮，最終產生出來的檔案也具備連結可以進行存取。</p><p>如果使用 <code>public</code> 目錄下導出的 <strong>/bg.png</strong>，就算我們替換了 <strong>bg.png</strong> 圖片，可能就會因為檔案根據檔案名稱被瀏覽器快取住，導致前端還是看到舊的檔案。我們在使用 <code>assets</code> 目錄下的檔案時雖然檔名都是 <strong>bg.png</strong>，但在建構時產生的檔案通常會夾帶 <code>Hash</code>，例如：<strong>bg.16a2f98c.png</strong>，如此一來我們每次更新圖片，都都會隨機的產生一組 Hash 就能防止瀏覽器快取，導致好像網站更新失效的錯覺。</p><p>舉例來說，我們以相同的圖片，改放置於 <strong>assets/bg.png</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nuxt-app/
</span></span><span class=line><span class=cl>├── assets/
</span></span><span class=line><span class=cl>│   └── bg.png
</span></span><span class=line><span class=cl>└── app.vue
</span></span></code></pre></td></tr></table></div></div><h5 id=appvue-16>app.vue</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;~/assets/bg.png&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>在開發環境 <code>~/assets/bg.png</code> 會轉換為 <code>/_nuxt/assets/bg.png</code>，實際上也能使用 <a class=link href=http://localhost:3000/_nuxt/assets/bg.png target=_blank rel=noopener>http://localhost:3000/_nuxt/assets/bg.png</a> 進行訪問。</p><p><img src=https://live.staticflickr.com/65535/52630134105_59cf185408_o.png max-width=100% max-height=100% class=gallery-image></p><blockquote><p>除了 ~/assets 可以對應 assets 目錄外，也可以參考官方的 <a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config#alias target=_blank rel=noopener>alias</a> 更多或自訂別名來使用相對路徑。</p></blockquote><p>但當你的網站部署完成或啟動建構出來的專案，會發現圖片檔名包含了 <code>Hash</code>，例如 <code>/_nuxt/bg.0a299ea1.png</code>。</p><p><img src=https://live.staticflickr.com/65535/52630176173_dd37d79c67_o.png max-width=100% max-height=100% class=gallery-image></p><p>最後我們以最終建構出來的專案結構對比如下圖，在 <code>public</code> 目錄下的檔案，會原封不動的照搬至 <code>.output/public</code> 下，也就可以使用 <strong>/bg.png</strong> 存取；而放置在 <code>assets</code> 下的檔案，可能會被處理加工，最後檔案名稱會加上一個 <code>Hash</code> 並放置在 <code>.output/public/_nuxt</code> 下，也就需要使用 <strong>/_nuxt/bg.0a299ea1.png</strong> 存取。</p><p><img src=https://live.staticflickr.com/65535/52629175877_933064e5f8_o.png max-width=100% max-height=100% class=gallery-image></p><p>總結來說多數情況建議把靜態資源放置在 <code>assets</code>，也因為靜態資源多為 SFC 所使用，通常也會放置最多檔案，最後建構時也會因為建構工具的設定來進行轉換或壓縮，最後添加 <code>Hash</code> 來提供存取，也因為每次建構產生的檔案都不一樣，所以不適合直接以完整的 URL 供外部連結使用。而當有些例外情況不適合，例如 <code>robots.txt</code> 或 <code>sitemap.xml</code> 這類的檔案不需要經過額外處理且需要絕對路徑保持檔案名稱，那就得放置在 <code>public</code> 目錄下提供存取。</p><hr><h2 id=發布網站前的建構打包-build-與靜態網站生成-static-site-generation>發布網站前的建構打包 (Build) 與靜態網站生成 (Static Site Generation)</h2><p>當網站開發完成或有導入 CI/CD，在準備發布網站前，我們會將 Nuxt 網站的開發專案透過 Nuxt 提供的指令，我們可以來建構出<strong>正式環境</strong>所需要的版本，這個建構的過程你可以理解為專案將會打包需要的依賴套件、編譯與轉換相關的 Vue SFC 與樣式等，甚至幫你壓縮這些檔案等許多步驟，這些繁瑣的過程都透過 Nuxt 的建構指令來幫你完成，你可以結合一些設定參數與指令，來幫助你建構出<strong>正式環境</strong>所需要的網站專案，最後再進行部署的動作。</p><h3 id=nuxt-3-專案如何建構正式環境版本>Nuxt 3 專案如何建構正式環境版本？</h3><p>當我們建立一個乾淨的 Nuxt 3 專案，可以使用 <strong>package.json</strong> 中 <strong>scripts</strong> 內的指令來進行建構或預渲染產生靜態頁面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run build
</span></span><span class=line><span class=cl>npm run generate
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run build</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run generate</span>
</span></span></code></pre></td></tr></table></div></div><p>或者你也可以使用 Nuxt CLI 來達到一樣的效果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi build
</span></span><span class=line><span class=cl>npx nuxi generate
</span></span></code></pre></td></tr></table></div></div><p><code>generate</code> 指令會觸發 <code>build</code> 的指令並帶有 <strong>prerender</strong> 為 <code>true</code> 的參數，最終產生出來的目錄可以直接進行部署，不需要再執行一次 <code>build</code> 的指令。</p><h3 id=使用預設配置進行建構---建構通用渲染-universal-rendering-的網站>使用預設配置進行建構 - 建構通用渲染 (Universal Rendering) 的網站</h3><p>這邊我們以 <a class=link href=https://wayneblog.ga/2023-01-16/nuxt-nuxt3-practice-project/>【Nuxt3】實戰練習 - 實作部落格</a> 所建立的<a class=link href=https://github.com/wjdesign/ithome-2022-ironman-nuxt3/tree/nuxt-app-blog target=_blank rel=noopener>部落格</a>作為範例，來嘗試以預設的配置進行建構，目前 Nuxt 3 預設 <code>nuxt.config.ts</code> 中 <code>ssr</code> 屬性為 <code>true</code>，也就使用<strong>通用渲染 (Universal Rendering)</strong>。</p><p>我們進入專案目錄，執行下列指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run build
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run build</span>
</span></span></code></pre></td></tr></table></div></div><p>不需要在額外的配置或步驟，Nuxt 就會自動幫我們打包並建構出可以部署的網站。</p><p><img src=https://live.staticflickr.com/65535/52630176278_33ffb31297_o.gif max-width=100% max-height=100% class=gallery-image></p><p>建構完成後會在專案目錄下多出一個 <code>.output</code> 目錄，<code>public</code> 就是在網站根目錄直接公開打包後的 JS、CSS 圖片等相關檔案。由於通用渲染使用 Nitro 作為服務引擎，所以會需要使用 Node.js 來啟動我們的服務，所以 <code>server</code> 則是會放置伺服器端的 Nitro、Server API 處理邏輯等。</p><p><img src=https://live.staticflickr.com/65535/52630134450_bf00a38cea_o.png max-width=100% max-height=100% class=gallery-image></p><p>我們可以先在本地執行下列指令來預覽建構出來的網站與 Nitro 是否能運作正常。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>node .output/server/index.mjs
</span></span></code></pre></td></tr></table></div></div><p>當確認沒問題後，就能以 <code>.output</code> 目錄進行網站部署。</p><h3 id=使用預渲染建置全靜態頁面網站>使用預渲染建置全靜態頁面網站</h3><p>我們可以在 Nuxt 3 建構時期來進行<strong>預渲染 (pre-rendering)</strong>，將專案內需要打 API 請求及動態渲染元件的地方，先渲染生成出 HTML 網頁，這個過程也稱之為<strong>靜態網站生成 (Static Site Generation)</strong>，進而建構出全靜態頁面的網站。</p><p>執行下列指令進行靜態頁面生成：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run generate
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run generate</span>
</span></span></code></pre></td></tr></table></div></div><p><code>generate</code> 指令會觸發 <code>build</code> 的指令並帶有 <strong>prerender</strong> 為 <code>true</code> 的參數，最終會提示產生的目錄 <code>.output/public</code> 可以用來部署至靜態託管伺服器。</p><p><img src=https://live.staticflickr.com/65535/52629943864_15a3b70736_o.gif max-width=100% max-height=100% class=gallery-image></p><p>當建構完成後，會在專案目錄下多出一個 <code>.output</code> 目錄同時也會有 <code>dist</code> 目錄，可以發現 <code>.output/public</code> 目錄內容與 <code>dist</code> 目錄相同。</p><p><img src=https://live.staticflickr.com/65535/52629176072_058cbabe22_o.png max-width=100% max-height=100% class=gallery-image></p><p>靜態頁面的生成因為 Nuxt 使用基於爬蟲的技術為每個頁面產生 HTML 與 Payload 檔案，可以發現產生的靜態頁面目錄結構，也對應著我們專案的路由頁面，而頁面元件資料夾內會由一個 <code>index.html</code> 與 <code>_payload.js</code> 組成。</p><p>下圖所產生的結構，是因為我們的部落格資料庫內已經有三筆文章資料，<code>/articles</code> 頁面會取得所有的文章，並列出對應著 <code>/articles/1</code>、<code>/articles/2</code> 與 <code>/articles/3</code> 目錄，每個頁面內也都包含預先從 Server API 請求好的文章資料並存於 <code>_payload.js</code> 之中。</p><p><img src=https://live.staticflickr.com/65535/52630134335_4a264f46cd_o.png max-width=100% max-height=100% class=gallery-image></p><p>至此我們就可以將 <code>.output</code> 目錄部署至伺服器或靜態託管服務，而且也不需要在使用 Node.js 伺服器來服務這些靜態檔案。</p><h3 id=手動設定預渲染的路由規則>手動設定預渲染的路由規則</h3><p>我們使用 <code>generate</code> 指令所產生的全靜態頁面網站，是基於 Nuxt 的爬蟲技術來分析頁面，如同前個例子文章頁面的產生所描述，如果我們的資料庫存在著 <strong>200</strong> 筆資料，但 <code>/articles</code> 頁面所打的 API 總是只回傳最新的 <strong>10</strong> 筆，那麼那些沒有路由連結可以連結過去的文章頁面，就無法被 Nuxt 的爬蟲所分析到，也就無法產生對應的靜態頁面。</p><p>為了解決這個問題，我們可以藉由配置 Nitro 的預渲染路由，來手動的設定哪些頁面要進行預渲染產生靜態頁面，或者忽略產生靜態頁面。</p><h5 id=nuxtconfigts-7>nuxt.config.ts</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>nitro</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>prerender</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ignore</span><span class=o>:</span> <span class=p>[],</span>       <span class=c1>// 忽略特定路由不進行預渲染
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>routes</span><span class=o>:</span> <span class=p>[],</span>       <span class=c1>// 指定路由進行預渲染
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>crawlLinks</span>: <span class=kt>true</span>  <span class=c1>// 啟用 Nuxt 爬蟲蒐集頁面連結來進行預渲染
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>當然，也可以搭配 <code>build</code> 或 <code>generate</code> 指令做使用，但會稍微有些不一樣。</p><h4 id=build>build</h4><p>例如：設置如下，並使用 <code>npm run build</code> 指令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>nitro</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>prerender</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>routes</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;/articles&#39;</span><span class=p>,</span> <span class=s1>&#39;/articles/2&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>那麼建構出來的通用渲染網站，就會包含部分頁面是已經預渲染好的靜態頁面。</p><p><img src=https://live.staticflickr.com/65535/52629696171_a693e5422d_o.png max-width=100% max-height=100% class=gallery-image></p><h4 id=generate>generate</h4><p>當我們使用 <code>generate</code> 時，因為是進行全站的靜態頁面生成，所以基本上涵蓋了所有路由頁面，並且 <code>nitro.prerender.crawlLinks</code> 屬性預設為 <code>true</code> 會啟用 Nuxt 爬蟲來蒐集整的網站的路由頁面，進而開始預渲染產生靜態頁面。</p><p>例如：設置如下，並使用 <code>npm run generate</code> 指令。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>defineNuxtConfig</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>nitro</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>prerender</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>ignore</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=s1>&#39;/register&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>routes</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;/articles/2&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>crawlLinks</span>: <span class=kt>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>那麼建構出來的 <code>.output</code> 目錄，就會因為設置了 <code>nitro.prerender.ignore</code> 而忽略 <strong>/login</strong> 與 <strong>/register</strong> 頁面的靜態生成 ，而 <strong>/articles/2</strong> 在網站中因為沒有任何頁面能連結到此，所以 Nuxy 爬蟲無法蒐集到，所以可以手動添加進 <code>nitro.prerender.routes</code> 之中。</p><p><img src=https://live.staticflickr.com/65535/52629696156_f6e435c338_o.png max-width=100% max-height=100% class=gallery-image></p><p>如果我們將 <code>nitro.prerender.crawlLinks</code> 屬性設為 <code>false</code>，那麼在產生靜態頁面的時候，就算 <code>/articles</code> 包含了所有文章的連結，Nuxt 爬蟲也就不會蒐集連結來產生靜態頁面，而是僅依照專案目錄下的 <code>pages</code> 所產生出的路由但不包含 <code>[id].vue</code> 這類動態匹配的路由來產生靜態頁面。</p><h3 id=建構僅在客戶端渲染的網站>建構僅在客戶端渲染的網站</h3><p>同樣的使用<a class=link href=https://github.com/wjdesign/ithome-2022-ironman-nuxt3/tree/nuxt-app-blog target=_blank rel=noopener>部落格</a>作為範例，來嘗試將 <code>nuxt.config.ts</code> 中 <code>ssr</code> 屬性設為 <code>false</code>，也就讓網站<strong>僅在客戶端渲染 (Client-side Only Rendering)</strong>。</p><p>執行下列指令進行建構：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run build
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run build</span>
</span></span></code></pre></td></tr></table></div></div><p>建構完成後，會在專案目錄下多出一個 <code>.output</code> 目錄，可以發現 <code>public</code> 目錄結構與通用渲染建構出的不大一樣，多出了像 Vue 專案建構完成後的 <code>index.html</code> 檔案，來作為顯示的容器。</p><p><img src=https://live.staticflickr.com/65535/52629176037_b1ec094f74_o.png max-width=100% max-height=100% class=gallery-image></p><p>這邊比較需要留意的地方是，當我們將 <code>ssr</code> 屬性設為 <code>false</code>，也還是會在 <code>.output</code> 建構出 <code>server</code> 目錄，也擁有著 <code>.output/server/index.mjs</code>。</p><p>那這不就意謂著我還是得有 Node.js 服務才能部署嗎？其實你可以這麼理解，當我們設定 Nuxt 僅在客戶端進行渲染，但 Nuxt 專案中仍然可能有 Server API，這個屬於伺服器端的 API，總不可能一同打包至前端去做架設吧！所以使用 <code>npm run build</code> 建構出來的專案，都會使用 Nitro 引擎來啟動服務，若有 Server API 的處理邏輯，則會連帶打包進 <code>.output/server</code> 目錄之下。</p><p>如果你確定 Nuxt 的專案內沒有自己實作的 Server API，全部是依賴非專案內的 Server API，那麼你可以直接將 <code>public</code> 目錄，視為 Vue 建構出的 <code>dist</code> 目錄來進行部署，因為選擇不再需要 Nitro 引擎來為我們提供 Web Server 的服務，且專案內的前端也都打包完在 <code>public</code> 下可以視為 SPA 網站。</p><h3 id=整理這些排列建構參數的組合>整理這些排列建構參數的組合</h3><p>相信看到這裡，可能對建構與產生靜態頁面有一點混亂了，這邊稍微整理了一下，大家可以再依據需求來啟用相對應的配置：</p><h4 id=npm-run-build--ssr-true>npm run build + ssr: true</h4><ul><li>build + ssr: true</li></ul><p>Nuxt 3 預設的建構參數，使用<strong>通用渲染 (Universal Rendering) 模式</strong>。</p><ul><li>build + ssr: true + nitro.prerender.crawlLinks: true</li></ul><p>使用通用渲染模式，頁面中需要打 API 動態產生的連結而被 Nuxt 爬蟲所蒐集到的頁面將被預渲染成靜態頁面。</p><ul><li>build + ssr: true + nitro.prerender.routes + nitro.prerender.crawlLinks: false</li></ul><p>使用通用渲染模式，但指定頁面預渲染成靜態頁面。</p><h4 id=npm-run-build--ssr-false>npm run build + ssr: false</h4><ul><li>build + ssr: false</li></ul><p><strong>僅在客戶端渲染 (Client-side Only Rendering)</strong> 的模式，部署時同樣需要使用 <code>server</code> 中的 <code>index.mjs</code> 來啟動 Nitro 伺服器，這樣才能正確的運作 Server API；除非確認專案內完全無依賴專案內的 Server API，則可以直接將 <code>.output/public</code> 視為 Vue 的 <code>dist</code> 目錄進行部署。</p><h4 id=npm-run-generate--ssr-true>npm run generate + ssr: true</h4><ul><li>generate + ssr: true</li></ul><p>使用預渲染產生靜態頁面，預設產生全站靜態頁面，<code>generate</code> 下 <code>nitro.prerender.crawlLinks</code> 屬性預設變為 <code>true</code>，整個網站包含 Nuxt 爬蟲所蒐集到的頁面將被預渲染成靜態頁面。</p><ul><li>generate + ssr: true + nitro.prerender.ignore</li></ul><p>使用 <code>generate</code> 已經包含整個網站，如果想要忽略某些頁面進行預渲染，可以添加路由至 <code>nitro.prerender.ignore</code> 中。但是需要注意，這些被忽略的頁面如果有使用專案內的 Server API 需求，可能就無法正確的在靜態託管平台運作，而外部的倒是不受影響。</p><ul><li>generate + ssr: true + nitro.prerender.routes</li></ul><p>雖然使用 <code>generate</code> 已經包含整個網站，但 Nuxt 爬蟲所蒐集到的頁面僅為頁面中產生的，如果連結不存在這些頁面內，只能直接從瀏覽器網址列輸入進入，那麼我們可以將路由添加至 <code>nitro.prerender.routes</code> 來額外補充需要預渲染的頁面。</p><ul><li>generate + ssr: true + nitro.prerender.routes + nitro.prerender.crawlLinks: false</li></ul><p>同樣會產生全站靜態頁面，但不使用 Nuxt 爬蟲所蒐集到的連結頁面，所以這些動態匹配或需要打 API 獲取資料再渲染的頁面，將不會是靜態頁面，因此也需要注意，如果這些頁面有使用專案內的 Server API 需求，可能就無法正確的在靜態託管平台運作，而外部的倒是不受影響。</p><blockquote><p>其它跟建構有關的參數屬性可以再參考<a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config/#build target=_blank rel=noopener>官方文件</a>、<a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config/#vite target=_blank rel=noopener>Vite</a> 與 <a class=link href=https://nuxt.com/docs/api/configuration/nuxt-config/#webpack-1 target=_blank rel=noopener>webpack</a> 建構工具也都能額外設定參數屬性。</p></blockquote><p>Nuxt 的建構指令 <code>build</code> 與產生靜態頁面的 <code>generate</code> 指令，讓我們可以依據不同的情境來決定渲染模式與預渲染的頁面，最終產生的 <code>.output</code> 目錄也會有不一樣的結構。預渲染的頁面與單純的 SPA 也要注意使否有使用到 Nuxt 專案建立的 Server API，再決定是否需要 Nitro 伺服器來啟動正式環境的網站服務。當一切就緒之後最後就能將輸出的目錄打包進行部署。</p><hr><h2 id=就剩最後一步了---部署-deployment>就剩最後一步了 - 部署 (Deployment)</h2><p>Nuxt 3 的專案應用程式，可以部署在 Node.js 的伺服器上面，也可以將預渲染的靜態網站由靜態託管平台來服務，或這部署至無伺服器 (serverless) 或 CDN 環境上。</p><h3 id=使用-nodejs-伺服器>使用 Node.js 伺服器</h3><p>Nuxt 3 的專案預設使用 <a class=link href=https://nuxt.com/docs/guide/concepts/server-engine/ target=_blank rel=noopener>Nitro</a> 來作為服務引擎，所以我們在任何 Node.js 伺服器環境之下，基本上都可以啟動 Nuxt 建置出來的 Nitro Server。</p><p>當我們使用 <code>npm run build</code> 建構專案後，輸出的 <code>.output/server/index.mjs</code> 檔案，即是一個準備啟動 Node 伺服器的入口點。</p><p>我們可以透過下列指令來啟動我們建構好的專案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>node .output/server/index.mjs
</span></span></code></pre></td></tr></table></div></div><p>執行後如下面圖示顯示，網站將於 <strong>Prot: 3000</strong> 進行服務監聽。</p><p><img src=https://live.staticflickr.com/65535/52629762661_a3a806890c_o.png max-width=100% max-height=100% class=gallery-image></p><p>你可以設定下列環境變數來調整預設監聽的 <strong>Port</strong> 或 <strong>Host</strong>。</p><ul><li><strong>NITRO_PORT</strong> 或 <strong>PORT</strong>：監聽的 Port (預設為 <strong>3000</strong>)</li><li><strong>NITRO_HOST</strong> 或 <strong>HOST</strong>：服務的 Host (沒有預設值，但預設監聽所有的網路介面包含 IPv4 與 IPv6 的位址 )</li><li><strong>NITRO_SSL_CERT</strong> 與 <strong>NITRO_SSL_KEY</strong>：如果兩者皆設定，將以 HTTPS 模式下啟動伺服器，通常僅作為測試用途，因為建議將 SSL 憑證等設定於提供反向代理的服務，例如 NGINX 或 CloudFlare，Nitro 伺服器則執行在反向代理後面。</li></ul><p>部署時，你可以將整個 <code>.output</code> 上傳至正式環境的機器上，並使用 Node.js 做執行，但為了防止我們的服務因為異常，導致 Node.js 服務意外崩潰，我們需要一個 <strong>Process</strong> 的 <strong>Daemon</strong>，來將服務常駐，意外崩潰時能自動重啟，來維持整個網站的正常服務。</p><p>通常我們會在正式環境使用 <a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a> 來管理 Node.js 的服務，<a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a> 是維持一個 Process 執行的管理器，我們可以藉由 <a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a> 來啟動我們的 Nitro Server，當服務崩潰時能自動的重新啟動，以維持服務的正常運作，除此之外 <a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a> 可以啟用叢集 (Cluster) 的功能結合請求的附載平衡，來讓多核心的機器提升資源的利用率與效能，更還有監測多項數據等功能可供正式環境做使用。</p><h3 id=使用-pm2>使用 PM2</h3><p>使用的方式也很簡單，首先使用 NPM 安裝 <a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a>，可以執行下列指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -g pm2
</span></span></code></pre></td></tr></table></div></div><p>在 Nuxt 專案目錄下建立 <code>ecosystem.config.js</code> 檔案，內容如下：</p><h5 id=ecosystemconfigjs>ecosystem.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>apps</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;NuxtAppName&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>exec_mode</span><span class=o>:</span> <span class=s1>&#39;cluster&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>instances</span><span class=o>:</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>script</span><span class=o>:</span> <span class=s1>&#39;./.output/server/index.mjs&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接著我們就能使用 <a class=link href=https://pm2.keymetrics.io/ target=_blank rel=noopener>PM2</a> 來執行我們的服務：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pm2 start ecosystem.config.js
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52630242508_e873a0929c_o.gif max-width=100% max-height=100% class=gallery-image></p><p>你也可以在 <code>ecosystem.config.js</code> 中添加環境變數。</p><h5 id=ecosystemconfigjs-1>ecosystem.config.js</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>apps</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;NuxtAppName&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>exec_mode</span><span class=o>:</span> <span class=s1>&#39;cluster&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>instances</span><span class=o>:</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>script</span><span class=o>:</span> <span class=s1>&#39;./.output/server/index.mjs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>env</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NITRO_PORT</span><span class=o>:</span> <span class=mi>3001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>NITRO_HOST</span><span class=o>:</span> <span class=s1>&#39;127.0.0.1&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=製作-docker-image>製作 Docker Image</h3><p>目前使用 Docker 來部署服務的也不在少數，個人也是採用容器化來啟動網站服務並整合 CI/CD 自動化的流程來建構與部署 Nuxt 3 專案，以下將列出自己使用的 Dockerfile，有興趣的可以再參考看看。</p><p>專案目錄下建立 <code>Dockerfile</code> 檔案，內容如下：</p><h5 id=dockerfile>Dockerfile</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> node:16-alpine AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /nuxt-app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /nuxt-app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci <span class=o>&amp;&amp;</span> npm cache clean --force<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> keymetrics/pm2:16-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /nuxt-app/.output<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /nuxt-app/.output</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /nuxt-app/.output .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./ecosystem.config.js /nuxt-app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>NUXT_HOST</span><span class=o>=</span><span class=m>0</span>.0.0.0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>NUXT_PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>EXPOSE</span><span class=s> 3000 </span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;pm2-runtime&#34;</span><span class=p>,</span> <span class=s2>&#34;start&#34;</span><span class=p>,</span> <span class=s2>&#34;/nuxt-app/ecosystem.config.js&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>打開終端機 (Terminal)，並於專案目錄下執行下列指令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t nuxt-app .
</span></span></code></pre></td></tr></table></div></div><p>當開始製作 Docker Image 時，會依照 Dockerfile 來建置，主要分成兩個部分，首先我會先在 <code>node:16-alpine</code> 容器環境中執行建構 (build) 的指令，並將需要部署的目錄 <code>.output</code> 複製至 <code>keymetrics/pm2:16-alpine</code> 容器環境中，這樣最終使用 PM2 執行服務的 Image 大小就會稍微小一些。</p><p>當 Docker Image 製作完畢後，可以再藉由 docker run 或 docker compose 甚至 k8s 來啟動服務後，再由如 NGINX 提供反向代理服務連接到內部的 Nitro Server。</p><h3 id=部署至-cloudflare-workers>部署至 CloudFlare Workers</h3><p>我們也可以將 Nuxt 部署到無伺服器 (Serverless) 的環境，官方提供了多種的預設部署可以做使用，我們就簡單以一個乾淨的 Nuxt 3 專案來做範例，嘗試部署到 <a class=link href=https://workers.cloudflare.com/ target=_blank rel=noopener>CloudFlare Workers</a>。</p><p>首先，我們先準備一個 Nuxt 3 專案，在此我使用下列指令建立一個乾淨的 Nuxt 3 專案，並進入專案目錄安裝套件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx nuxi init nuxt-app
</span></span><span class=line><span class=cl><span class=nb>cd</span> nuxt-app
</span></span><span class=line><span class=cl>npm install
</span></span></code></pre></td></tr></table></div></div><p>使用 NPM 安裝 <a class=link href=https://www.npmjs.com/package/wrangler target=_blank rel=noopener>wrangler</a>，它是用於建構 Cloudflare Workers 的命令列工具 (command line tool)。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -g wrangler
</span></span></code></pre></td></tr></table></div></div><p>你可能需要註冊一個 CloudFlare 的帳號，並使用下列指令來登入 CloudFlare 帳號並授權 Wrangler 來建立 CloudFlare Workers，我們選擇允許 (Allow) 即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wrangler login
</span></span></code></pre></td></tr></table></div></div><p>於專案目錄下建立 <code>wrangler.toml</code> 內容如下：</p><h5 id=wranglertoml>wrangler.toml</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;nuxt-app-hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>main</span> <span class=p>=</span> <span class=s2>&#34;./.output/server/index.mjs&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>workers_dev</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nx>compatibility_date</span> <span class=p>=</span> <span class=s2>&#34;2022-10-15&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>site</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>bucket</span> <span class=p>=</span> <span class=s2>&#34;.output/public&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>我們將 <code>NITRO_PRESET</code> 環境變數，設置為 <code>cloudflare</code> 並開始建構我們的專案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>NITRO_PRESET</span><span class=o>=</span>cloudflare npm run build
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52630011164_8598f2fb8a_o.png max-width=100% max-height=100% class=gallery-image></p><p>接下來，可以選擇執行終端機提示的指令來啟動伺服器進行相關測試。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx wrangler dev .output/server/index.mjs --site .output/public --local
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52630011119_2100d3cd32_o.png max-width=100% max-height=100% class=gallery-image></p><p>當確認專案服務運作上沒問題後，可以執行下列指令進行發布。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npx wrangler publish
</span></span></code></pre></td></tr></table></div></div><p>完成發布後，就會提示我們發布完成及服務的網址，例如 <a class=link href=https://nuxt-app-hello.ryanchien8125.workers.dev target=_blank rel=noopener>https://nuxt-app-hello.ryanchien8125.workers.dev</a>，我們就可以瀏覽我們部署好的網站囉。</p><p><img src=https://live.staticflickr.com/65535/52630011089_34c0659438_o.png max-width=100% max-height=100% class=gallery-image></p><h3 id=靜態的網站部署至-cloudflare-pages>靜態的網站部署至 CloudFlare Pages</h3><p>我們使用 Nuxt 3 可以預渲染全靜態的網站，因此也可以將專案部署至靜態託管平台，以 CloudFlare Pages 為例，部署的步驟如下：</p><p>首先，先執行下列指令進行全站的預渲染：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm run generate
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl><span class=c1># yarn run generate</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 NPM 安裝 <a class=link href=https://www.npmjs.com/package/wrangler target=_blank rel=noopener>wrangler</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm install -g wrangler
</span></span></code></pre></td></tr></table></div></div><p>你可能需要註冊一個 CloudFlare 的帳號，並使用下列指令來登入 CloudFlare 帳號並授權 Wrangler，我們選擇允許 (Allow) 即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wrangler login
</span></span></code></pre></td></tr></table></div></div><p>建立一個 CloudFlare Pages 名為 <code>nuxt-app-blog</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wrangler pages project create nuxt-app-blog
</span></span></code></pre></td></tr></table></div></div><p><img src=https://live.staticflickr.com/65535/52630242568_959e7a5907_o.png max-width=100% max-height=100% class=gallery-image></p><p>使用下列指令，將預渲染的網站目錄進行部署，並指定專案名稱為 <code>nuxt-app-blog</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wrangler pages publish ./.output/public --project-name nuxt-app-blog
</span></span></code></pre></td></tr></table></div></div><p>當部署完成後，就會得到一個連結來查看部署的靜態網頁，你也可以從 CloudFlare Pages 後台，看見網站網址的別名 Aliases 來使用自訂的網址。</p><p><img src=https://live.staticflickr.com/65535/52629762746_a0dc3bb113_o.png max-width=100% max-height=100% class=gallery-image></p><p>以上是介紹 Nuxt 3 的幾個部署方式的例子，更多雲端平台上面的部署，也可以參考 <a class=link href=https://nuxt.com/docs/getting-started/deployment#deployment target=_blank rel=noopener>Nuxt</a> 與 <a class=link href=https://nitro.unjs.io/deploy/node target=_blank rel=noopener>Nitro</a> 官方文件。</p><hr><h2 id=上線前的測試項目>上線前的測試項目</h2><p>最後與大家分享一下網站專案上線前的幾個我會特別注意的幾個小細節，也歡迎大家一起來交流。</p><h3 id=前端細節>前端細節</h3><ul><li>網頁的標題 (Title)</li><li>使用之資源授權 (使用權、智財權)</li><li>圖片替代文字</li><li>Favicon</li><li>HTML Meta data</li><li>Google Analytics</li></ul><h3 id=瀏覽器相容性測試>瀏覽器相容性測試</h3><ul><li>RWD</li><li>跨瀏覽器<ul><li>BrowserStack</li><li>Comparium</li><li>TestingBot</li></ul></li></ul><h3 id=api-測試>API 測試</h3><ul><li>單元測試</li><li>不同場景測試 (測試環境、正式環境)</li><li>效能測試<ul><li>JMeter</li><li>k6</li></ul></li><li>安全性測試</li></ul><h3 id=壓力測試>壓力測試</h3><ul><li>模擬使用者或連線數</li><li>觀察機器資源使用量</li><li>資料庫連線數觀察</li><li>持續提高模擬數量觀察分析</li><li>分析每個請求於併發的平均響應時間</li><li>是否請求中夾雜非預期之狀態碼 (HTTP Status Code)</li></ul><h3 id=api-或網站安全性>API 或網站安全性</h3><ul><li>參考 OWASP Top 10</li><li>SQL 參數化查詢</li><li>資安公司滲透測試、紅隊演練</li></ul><h3 id=開發或除錯用的訊息>開發或除錯用的訊息</h3><ul><li>警告訊息或異常訊息移除（console.log 或警告訊息等）</li><li>JavaScript Source Maps 記得移除</li><li>敏感資訊記得移除 (開發用 Key、帳號密碼等)</li></ul><h3 id=網站相依性檢查>網站相依性檢查</h3><ul><li>使用到第三方網站資源及穩定性</li><li>檢查所有網址皆能正常運作</li><li>當第三方網站異常時應對措施</li></ul><h3 id=部署相關>部署相關</h3><ul><li>是否有高可用性 (HA)</li><li>Docker 或 Kubernetes 整合</li><li>網域時效</li><li>SSL 證書日期</li><li>防火牆或 WAF 設定</li><li>內網或外網區隔</li></ul><h3 id=備份機制>備份機制</h3><ul><li>靜態有狀態資料 (使用者上傳的)</li><li>資料庫資料</li></ul><p>這邊主要與大家分享幾種 Nuxt 的部署方式，不管是部署在自己的機房主機或雲端，大家可以在挑選合適的解決方案，Nitro 也支援無伺服器 (Serverless) 等部署方式非常的方便，只是要特別注意到 Serverless 執行一些 binary 的問題，再挑選自己適合的部署與服務方式。</p><p>經過本篇文章，大家應該都對於 Nuxt 3 有初步的理解，接下來下一篇文章我們將會進入實戰練習，將會以 Nuxt 3 來實作一個部落格網站！</p><hr></section><footer class=article-footer><section class=article-tags><a href=https://wayneblog.ga/tags/javascript/>javascript</a>
<a href=https://wayneblog.ga/tags/typescript/>typescript</a>
<a href=https://wayneblog.ga/tags/vue/>vue</a>
<a href=https://wayneblog.ga/tags/nuxt/>nuxt</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=https://wayneblog.ga/2023-01-16/nuxt-nuxt3-practice-project/><div class=article-image><img src=https://live.staticflickr.com/65535/52630283696_c93e29e870_o.png loading=lazy data-key=nuxt-nuxt3-practice-project data-hash=https://live.staticflickr.com/65535/52630283696_c93e29e870_o.png></div><div class=article-details><h2 class=article-title>【Nuxt3】實戰練習 - 實作部落格</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-12-30/npm-vueuse/><div class=article-image><img src=https://live.staticflickr.com/65535/52595409644_aa1fd7bf45_o.png loading=lazy data-key=npm-vueuse data-hash=https://live.staticflickr.com/65535/52595409644_aa1fd7bf45_o.png></div><div class=article-details><h2 class=article-title>【VueUse】一款基於 Vue Composition API 的函式工具集</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-12-30/why-use-hooks/><div class=article-image><img src=https://live.staticflickr.com/65535/52595598278_3dc955c418_o.png loading=lazy data-key=why-use-hooks data-hash=https://live.staticflickr.com/65535/52595598278_3dc955c418_o.png></div><div class=article-details><h2 class=article-title>淺談為什麼 Vue 和 React 都選擇了 Hooks？</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-12-29/vitest-unit-test/><div class=article-image><img src=https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg loading=lazy data-key=vitest-unit-test data-hash=https://madewithnetworkfra.fra1.digitaloceanspaces.com/spatie-space-production/29079/vitest.jpg></div><div class=article-details><h2 class=article-title>闡述單元測試、元件測試，並學習在自己的 Vue3 專案中加入 Vitest！</h2></div></a></article><article class=has-image><a href=https://wayneblog.ga/2022-11-22/create-own-vscode-extension/><div class=article-image><img src=https://live.staticflickr.com/65535/52516420035_bc4b9df19c_o.png loading=lazy data-key=create-own-vscode-extension data-hash=https://live.staticflickr.com/65535/52516420035_bc4b9df19c_o.png></div><div class=article-details><h2 class=article-title>今天來搞一個屬於自己的 VScode Extension 吧！</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-blog-wayne.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Wayne's blog | 偉恩的部落格 | 技術博客</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#nuxt-3-介紹>Nuxt 3 介紹</a><ol><li><a href=#前言>前言</a></li><li><a href=#isomorphic-javascript-與-universal-javascript>Isomorphic JavaScript 與 Universal JavaScript</a><ol><li><a href=#isomorphic-javascript>Isomorphic JavaScript</a></li><li><a href=#universal-javascript>Universal JavaScript</a></li></ol></li><li><a href=#nuxt-3>Nuxt 3</a><ol><li><a href=#nuxt-3-的新特性>Nuxt 3 的新特性</a></li><li><a href=#nitro>Nitro</a></li><li><a href=#nuxt-3-渲染模式>Nuxt 3 渲染模式</a></li><li><a href=#nuxt-3-的建構工具>Nuxt 3 的建構工具</a></li></ol></li></ol></li><li><a href=#使用-nuxi-建立第一個專案>使用 nuxi 建立第一個專案</a><ol><li><a href=#線上玩玩看>線上玩玩看</a></li><li><a href=#開始建立第一個專案>開始建立第一個專案</a><ol><li><a href=#先決條件>先決條件</a></li><li><a href=#使用-nuxi-建立-nuxt-3-專案>使用 nuxi 建立 Nuxt 3 專案</a></li></ol></li><li><a href=#nuxt-cli-常用指令>Nuxt CLI 常用指令</a><ol><li><a href=#nuxi-init>nuxi init</a></li><li><a href=#nuxi-dev>nuxi dev</a></li><li><a href=#nuxi-cleanup>nuxi cleanup</a></li><li><a href=#nuxi-upgrade>nuxi upgrade</a></li></ol></li></ol></li><li><a href=#nuxt-3--typescript--eslint--prettier-環境建置>Nuxt 3 + TypeScript + ESLint + Prettier 環境建置</a><ol><li><a href=#typescript-類型檢查>TypeScript 類型檢查</a><ol><li><a href=#step-1-安裝-vs-code-插件>Step 1. 安裝 VS Code 插件</a></li><li><a href=#step-2-安裝-vue-類型檢查套件>Step 2. 安裝 Vue 類型檢查套件</a></li><li><a href=#step-3-調整-nuxtconfigts-設定>Step 3. 調整 nuxt.config.ts 設定</a></li><li><a href=#step-4-重新啟動開發環境服務>Step 4. 重新啟動開發環境服務</a></li><li><a href=#看看效果>看看效果</a></li></ol></li><li><a href=#eslint-設置-linter>ESLint 設置 Linter</a><ol><li><a href=#step-1-安裝-eslint-套件>Step 1. 安裝 ESLint 套件</a></li><li><a href=#step-2-配置-eslint-設定檔>Step 2. 配置 ESLint 設定檔</a></li><li><a href=#用-eslint-來嘗試檢查>用 ESLint 來嘗試檢查</a></li></ol></li><li><a href=#在-packagejson-設置腳本>在 package.json 設置腳本</a></li><li><a href=#在-vs-code-中顯示-eslint-錯誤或警告>在 VS Code 中顯示 ESLint 錯誤或警告</a></li><li><a href=#在-vs-code-中自動修正-eslint-錯誤或警告>在 VS Code 中自動修正 ESLint 錯誤或警告</a><ol><li><a href=#手動快速修正>手動快速修正</a></li><li><a href=#存擋自動修正>存擋自動修正</a></li></ol></li><li><a href=#prettier-設置>Prettier 設置</a><ol><li><a href=#step-1-安裝-prettier-套件>Step 1. 安裝 Prettier 套件</a></li><li><a href=#step-2-配置-prettier-設定檔案>Step 2. 配置 Prettier 設定檔案</a></li><li><a href=#step-3-配置-eslint-設定檔案>Step 3. 配置 ESLint 設定檔案</a></li><li><a href=#step-4-安裝-vs-code-的-prettier-插件>Step 4. 安裝 VS Code 的 Prettier 插件</a></li></ol></li></ol></li><li><a href=#使用-tailwind-css>使用 Tailwind CSS</a><ol><li><a href=#使用-nuxt-tailwind-模組>使用 Nuxt Tailwind 模組</a><ol><li><a href=#step-1-安裝相關套件>Step 1. 安裝相關套件</a></li><li><a href=#step-2-添加模組至-nuxtconfigts>Step 2. 添加模組至 nuxt.config.ts</a></li><li><a href=#step-3-重啟-nuxt-服務>Step 3. 重啟 Nuxt 服務</a></li><li><a href=#擴充或覆寫-nuxtjstailwindcss-配置>擴充或覆寫 @nuxtjs/tailwindcss 配置</a></li></ol></li><li><a href=#tailwind-css-官方指引步驟>Tailwind CSS 官方指引步驟</a><ol><li><a href=#step-1-安裝相關套件-1>Step 1. 安裝相關套件</a></li><li><a href=#step-2-建立-tailwindconfigjs>Step 2. 建立 tailwind.config.js</a></li><li><a href=#step-3-調整-tailwindconfigjs>Step 3. 調整 tailwind.config.js</a></li><li><a href=#step-4-建立-tailwindcss>Step 4. 建立 tailwind.css</a></li><li><a href=#step-5-配置全域共用-css>Step 5. 配置全域共用 CSS</a></li><li><a href=#step-6-重啟-nuxt-服務>Step 6. 重啟 Nuxt 服務</a></li></ol></li><li><a href=#開始感受-tailwind-css-的魅力>開始感受 Tailwind CSS 的魅力</a></li><li><a href=#自動排序-tailwind-css-的-class>自動排序 Tailwind CSS 的 Class</a></li><li><a href=#tailwind-x-prettier>Tailwind x Prettier</a><ol><li><a href=#step-1-安裝插件>Step 1. 安裝插件</a></li><li><a href=#step-2-配置設定檔>Step 2. 配置設定檔</a></li><li><a href=#step-3-自動修正效果>Step 3. 自動修正效果</a></li></ol></li><li><a href=#小結>小結</a></li></ol></li><li><a href=#使用-pug>使用 Pug</a><ol><li><a href=#安裝-vite-plugin-pug>安裝 @vite-plugin-pug</a></li><li><a href=#直接開始體驗-pug>直接開始體驗 Pug</a></li></ol></li><li><a href=#目錄結構與自動載入-auto-imports>目錄結構與自動載入 (Auto Imports)</a><ol><li><a href=#nuxt-3-的目錄結構>Nuxt 3 的目錄結構</a></li><li><a href=#nuxt-3-預設的目錄結構>Nuxt 3 預設的目錄結構</a><ol><li><a href=#nuxt-目錄>.nuxt 目錄</a></li><li><a href=#output-目錄>.output 目錄</a></li><li><a href=#assets-目錄>assets 目錄</a></li><li><a href=#components-目錄>components 目錄</a></li><li><a href=#composables-目錄>composables 目錄</a></li><li><a href=#content-目錄>content 目錄</a></li><li><a href=#layouts-目錄>layouts 目錄</a></li><li><a href=#middleware-目錄>middleware 目錄</a></li><li><a href=#node_modules-目錄>node_modules 目錄</a></li><li><a href=#pages-目錄>pages 目錄</a></li><li><a href=#plugins-目錄>plugins 目錄</a></li><li><a href=#server-目錄>server 目錄</a></li><li><a href=#gitignore-檔案>.gitignore 檔案</a></li><li><a href=#nuxtignore-檔案>.nuxtignore 檔案</a></li><li><a href=#appconfigts-檔案>app.config.ts 檔案</a></li><li><a href=#appvue-檔案>app.vue 檔案</a></li><li><a href=#nuxtconfigts-檔案>nuxt.config.ts 檔案</a></li><li><a href=#packagejson-檔案>package.json 檔案</a></li><li><a href=#tsconfigjson-檔案>tsconfig.json 檔案</a></li></ol></li><li><a href=#自訂目錄名稱>自訂目錄名稱</a></li><li><a href=#自動載入-auto-imports>自動載入 (Auto Imports)</a><ol><li><a href=#nuxt-常用元件與函數的自動載入>Nuxt 常用元件與函數的自動載入</a></li><li><a href=#vue-3-api-的自動載入>Vue 3 API 的自動載入</a></li><li><a href=#基於目錄的自動載入>基於目錄的自動載入</a></li></ol></li><li><a href=#建立一個自動導入的元件>建立一個自動導入的元件</a><ol><li></li></ol></li><li><a href=#關閉自動載入>關閉自動載入</a><ol><li></li></ol></li><li><a href=#顯式載入-explicit-imports>顯式載入 (Explicit Imports)</a></li></ol></li><li><a href=#頁面-pages-與路由-routing>頁面 (Pages) 與路由 (Routing)</a><ol><li><a href=#基於檔案的路由-file-based-routing>基於檔案的路由 (File-based Routing)</a><ol><li><a href=#建立第一個頁面>建立第一個頁面</a></li></ol></li><li><a href=#多個路由頁面>多個路由頁面</a><ol><li><a href=#建立多個路由頁面>建立多個路由頁面</a></li><li><a href=#自動產生的路由>自動產生的路由</a></li></ol></li><li><a href=#建立路由連結>建立路由連結</a><ol><li></li></ol></li><li><a href=#約定式路由中的-indexvue>約定式路由中的 index.vue</a></li><li><a href=#帶參數的動態路由匹配>帶參數的動態路由匹配</a><ol><li></li></ol></li><li><a href=#匹配所有層級的路由>匹配所有層級的路由</a><ol><li></li></ol></li><li><a href=#建立-404-not-found-頁面>建立 404 Not Found 頁面</a><ol><li></li></ol></li><li><a href=#建立多層的目錄結構>建立多層的目錄結構</a><ol><li></li></ol></li><li><a href=#巢狀路由-nested-routes>巢狀路由 (Nested Routes)</a><ol><li></li></ol></li></ol></li><li><a href=#布局模板-layouts>布局模板 (Layouts)</a><ol><li><a href=#建立一個預設的布局模板>建立一個預設的布局模板</a><ol><li><a href=#step-1-建立預設布局模板>Step 1. 建立預設布局模板</a></li><li><a href=#step-2-添加-元件>Step 2. 添加 元件</a></li></ol></li><li><a href=#布局模板中的插槽>布局模板中的插槽</a><ol><li></li></ol></li><li><a href=#在布局模板中建立多個插槽>在布局模板中建立多個插槽</a><ol><li><a href=#step-1-建立兩個具名的插槽-slot分別為-header-與-footer>Step 1. 建立兩個具名的插槽 (Slot)，分別為 <strong>header</strong> 與 <strong>footer</strong></a></li><li><a href=#step-2-將不同內容顯示於指定的插槽位置>Step 2. 將不同內容，顯示於指定的插槽位置。</a></li></ol></li><li><a href=#布局模板與路由頁面>布局模板與路由頁面</a></li><li><a href=#建立布局模板與路由頁面>建立布局模板與路由頁面</a><ol><li><a href=#step-1-調整-appvue-入口點>Step 1. 調整 app.vue 入口點</a></li><li><a href=#step-2-建立路由頁面>Step 2. 建立路由頁面</a></li></ol></li><li><a href=#多個路由頁面共用預設布局模板>多個路由頁面共用預設布局模板</a><ol><li><a href=#step-1-新增路由頁面>Step 1. 新增路由頁面</a></li><li><a href=#step-2-新增路由連結>Step 2. 新增路由連結</a></li></ol></li><li><a href=#建立多個布局模板>建立多個布局模板</a><ol><li><a href=#step-1-建立新的布局模板>Step 1. 建立新的布局模板</a></li><li><a href=#step-2-新增一個路由頁面>Step 2. 新增一個路由頁面</a></li><li><a href=#step-3-使用指定布局模板>Step 3. 使用指定布局模板</a></li></ol></li><li><a href=#更進階的指定布局模板>更進階的指定布局模板</a><ol><li></li></ol></li></ol></li><li><a href=#元件-components>元件 (Components)</a><ol><li><a href=#元件自動載入>元件自動載入</a><ol><li><a href=#建立與使用元件>建立與使用元件</a></li></ol></li><li><a href=#元件名稱>元件名稱</a><ol><li><a href=#元件名稱的命名規則>元件名稱的命名規則</a></li></ol></li><li><a href=#動態元件-dynamic-components>動態元件 (Dynamic Components)</a></li><li><a href=#建立動態元件>建立動態元件</a><ol><li><a href=#step-1-建立元件>Step 1. 建立元件</a></li><li><a href=#step-2-使用-resolvecomponent>Step 2. 使用 resolveComponent()</a></li></ol></li><li><a href=#動態載入-dynamic-imports>動態載入 (Dynamic Imports)</a><ol><li><a href=#建立一個動態載入的按鈕>建立一個動態載入的按鈕</a></li><li><a href=#step-1-建立按鈕元件>Step 1. 建立按鈕元件</a></li><li><a href=#step-2-添加-lazy-前綴>Step 2. 添加 Lazy 前綴</a></li></ol></li><li><a href=#控制伺服器端或客戶端渲染元件>控制伺服器端或客戶端渲染元件</a><ol><li><a href=#clientonly-元件><code>&lt;ClientOnly></code> 元件</a></li><li><a href=#client-與-server>.client 與 .server</a></li><li><a href=#控制伺服器端或客戶端渲染元件範例>控制伺服器端或客戶端渲染元件範例</a></li></ol></li></ol></li><li><a href=#組合式函數-composables>組合式函數 (Composables)</a><ol><li><a href=#options-api-與-composition-api>Options API 與 Composition API</a></li><li><a href=#mixins-與-composables>Mixins 與 Composables</a></li><li><a href=#組合式函數-composables-1>組合式函數 (Composables)</a><ol><li><a href=#建立組合式函數>建立組合式函數</a></li></ol></li><li><a href=#composables-組合式函數的名稱>Composables 組合式函數的名稱</a><ol><li><a href=#1-使用預設匯出-default-export>1. 使用預設匯出 (Default export)</a></li><li><a href=#2-使用具名匯出-named-export>2. 使用具名匯出 (Named export)</a></li></ol></li><li><a href=#composables-自動載入的規則>Composables 自動載入的規則</a><ol><li><a href=#一重新匯出-span-classfocus推薦span>一、重新匯出 <span class=focus>[推薦]</span></a></li><li><a href=#二配置掃描巢狀目錄>二、配置掃描巢狀目錄</a></li></ol></li></ol></li><li><a href=#插件-plugins>插件 (Plugins)</a><ol><li><a href=#nuxt-3-插件目錄>Nuxt 3 插件目錄</a></li><li><a href=#如何建立插件>如何建立插件</a></li><li><a href=#在插件中使用組合式函數-composables>在插件中使用組合式函數 (Composables)</a><ol><li><a href=#插件的載入順序>插件的載入順序</a></li><li><a href=#依賴-vue-的生命週期>依賴 Vue 的生命週期</a></li></ol></li><li><a href=#automatically-providing-helpers>Automatically Providing Helpers</a><ol><li></li><li><a href=#僅限伺服器端或客戶端中使用>僅限伺服器端或客戶端中使用</a></li></ol></li><li><a href=#vue-插件與指令>Vue 插件與指令</a></li><li><a href=#nuxt-3-中使用-vue-gtag-插件>Nuxt 3 中使用 vue-gtag 插件</a><ol><li><a href=#step-1-安裝套件>Step 1. 安裝套件</a></li><li><a href=#step-2-建立-nuxt-插件>Step 2. 建立 Nuxt 插件</a></li><li><a href=#完成效果>完成效果</a></li></ol></li><li><a href=#nuxt-3-中建立-vue-指令>Nuxt 3 中建立 Vue 指令</a><ol><li></li></ol></li></ol></li><li><a href=#模組-modules>模組 (Modules)</a><ol><li><a href=#nuxt-3-中插件與模組的差異>Nuxt 3 中插件與模組的差異</a></li><li><a href=#nuxt-3-安裝使用模組>Nuxt 3 安裝使用模組</a></li><li><a href=#nuxt-3-模組列表>Nuxt 3 模組列表</a></li><li><a href=#使用-nuxt-icon-模組>使用 Nuxt Icon 模組</a><ol><li><a href=#step-1-安裝套件-1>Step 1. 安裝套件</a></li><li><a href=#step-2-配置使用模組>Step 2. 配置使用模組</a></li><li><a href=#step-3-開始使用>Step 3. 開始使用</a></li></ol></li><li><a href=#如何建立-nuxt-模組>如何建立 Nuxt 模組</a></li><li><a href=#模組的載入>模組的載入</a></li></ol></li><li><a href=#中間件目錄-middleware-directory>中間件目錄 (Middleware Directory)</a><ol><li><a href=#vue-router-的導航守衛-navigation-guards>Vue Router 的導航守衛 (Navigation Guards)</a></li><li><a href=#全域>全域</a><ol><li><a href=#全域前置守衛-global-before-guards>全域前置守衛 (Global Before Guards)</a></li><li><a href=#全域解析守衛-global-resolve-guards>全域解析守衛 (Global Resolve Guards)</a></li><li><a href=#全域後置-hooks-global-after-hooks>全域後置 Hooks (Global After Hooks)</a></li></ol></li><li><a href=#路由獨有守衛-per-route-guard>路由獨有守衛 (Per-Route Guard)</a></li><li><a href=#元件內的守衛>元件內的守衛</a></li></ol></li><li><a href=#nuxt-3-路由中間件>Nuxt 3 路由中間件</a><ol><li><a href=#路由中間件格式>路由中間件格式</a></li><li><a href=#路由中間件的回傳>路由中間件的回傳</a><ol><li><a href=#navigatetoto-options>navigateTo(to, options)</a></li><li><a href=#abortnavigationerr>abortNavigation(err)</a></li></ol></li><li><a href=#路由中間件的種類>路由中間件的種類</a><ol><li><a href=#匿名或者是行內的路由中間件>匿名或者是行內的路由中間件</a></li><li><a href=#具名的路由中間件>具名的路由中間件</a></li><li><a href=#全域的路由中間件>全域的路由中間件</a></li><li><a href=#動態添加路由中間件>動態添加路由中間件</a></li></ol></li></ol></li><li><a href=#server-api-與-nitro-engine>Server API 與 Nitro Engine</a><ol><li><a href=#nitro-engine>Nitro Engine</a></li><li><a href=#nuxt-3-的-server-目錄>Nuxt 3 的 Server 目錄</a></li><li><a href=#建立第一個伺服器-api>建立第一個伺服器 API</a><ol><li></li></ol></li><li><a href=#伺服器路由>伺服器路由</a><ol><li><a href=#基於檔案的路由>基於檔案的路由</a></li><li><a href=#匹配路由參數>匹配路由參數</a></li><li><a href=#匹配-http-請求方法-http-request-method>匹配 HTTP 請求方法 (HTTP Request Method)</a></li><li><a href=#匹配包羅萬象的路由-catch-all-route>匹配包羅萬象的路由 (Catch-all Route)</a></li></ol></li><li><a href=#伺服器中間件>伺服器中間件</a><ol><li></li></ol></li><li><a href=#伺服器插件>伺服器插件</a></li><li><a href=#伺服器通用功能>伺服器通用功能</a></li><li><a href=#伺服器路由常用的-http-請求處理>伺服器路由常用的 HTTP 請求處理</a><ol><li><a href=#處理-http-請求中的-body>處理 HTTP 請求中的 Body</a></li><li><a href=#處理-url-中的查詢參數-query-parameters>處理 URL 中的查詢參數 (Query Parameters)</a></li><li><a href=#解析-http-請求所夾帶的-cookie>解析 HTTP 請求所夾帶的 Cookie</a></li></ol></li><li><a href=#進階使用範例>進階使用範例</a><ol><li><a href=#nitro-配置>Nitro 配置</a></li><li><a href=#使用巢狀路由>使用巢狀路由</a></li><li><a href=#伺服器儲存>伺服器儲存</a></li></ol></li></ol></li><li><a href=#資料獲取-data-fetching>資料獲取 (Data Fetching)</a><ol><li><a href=#useasyncdata>useAsyncData</a><ol><li></li><li><a href=#useasyncdata-傳入的參數>useAsyncData() 傳入的參數</a></li><li><a href=#useasyncdata-的回傳值>useAsyncData() 的回傳值</a></li></ol></li><li><a href=#usefetch>useFetch</a><ol><li><a href=#usefetch-傳入的參數>useFetch() 傳入的參數</a></li><li><a href=#usefetch-的回傳值>useFetch() 的回傳值</a></li></ol></li><li><a href=#攔截器>攔截器</a></li><li><a href=#uselazyasyncdata>useLazyAsyncData</a><ol><li></li></ol></li><li><a href=#uselazyfetch>useLazyFetch</a><ol><li><a href=#重新獲取資料>重新獲取資料</a></li><li><a href=#refreshnuxtdata>refreshNuxtData</a></li></ol></li></ol></li><li><a href=#狀態管理-state-management>狀態管理 (State Management)</a><ol><li><a href=#hydration>Hydration</a><ol><li></li></ol></li><li><a href=#nuxt-3-的狀態管理-state-management>Nuxt 3 的狀態管理 (State Management)</a><ol><li></li></ol></li><li><a href=#usestate-的基本用法>useState 的基本用法</a><ol><li></li></ol></li><li><a href=#usestate-的共享狀態>useState 的共享狀態</a><ol><li></li></ol></li><li><a href=#使用組合式函數建立共享狀態>使用組合式函數建立共享狀態</a><ol><li></li></ol></li></ol></li><li><a href=#狀態管理---store--pinia>狀態管理 - Store & Pinia</a><ol><li><a href=#pinia>Pinia</a></li><li><a href=#nuxt-3-安裝-pinia>Nuxt 3 安裝 Pinia</a><ol><li></li></ol></li><li><a href=#建立第一個-pinia-的-store>建立第一個 Pinia 的 Store</a><ol><li></li></ol></li><li><a href=#開始使用-store>開始使用 Store</a><ol><li></li></ol></li><li><a href=#pinia-store-的-state>Pinia Store 的 State</a><ol><li><a href=#改變狀態>改變狀態</a></li><li><a href=#重置狀態>重置狀態</a></li></ol></li><li><a href=#pinia-store-的-getters>Pinia Store 的 Getters</a><ol><li><a href=#使用同一個-store-中的其他-getter>使用同一個 store 中的其他 getter</a></li><li><a href=#使用其他-store-的-getter>使用其他 store 的 getter</a></li><li><a href=#pinia-store-的-actions>Pinia Store 的 Actions</a></li></ol></li><li><a href=#store-的解構>Store 的解構</a></li></ol></li><li><a href=#pinia-持久化插件---pinia-plugin-persistedstate>Pinia 持久化插件 - Pinia Plugin Persistedstate</a><ol><li><a href=#在-nuxt-3-中配置使用-pinia-plugin-persistedstate>在 Nuxt 3 中配置使用 Pinia Plugin Persistedstate</a><ol><li><a href=#step-1-安裝套件-2>Step 1. 安裝套件</a></li><li><a href=#step-2-在-nuxt-3-為-pinia-添加-persist-插件>Step 2. 在 Nuxt 3 為 Pinia 添加 Persist 插件</a></li><li><a href=#step-3-為你的-store-添加持久化配置>Step 3. 為你的 Store 添加持久化配置</a></li><li><a href=#step-4-持久化效果>Step 4. 持久化效果</a></li></ol></li></ol></li><li><a href=#runtime-config--app-config>Runtime Config & App Config</a><ol><li><a href=#runtime-config>Runtime Config</a><ol><li><a href=#配置-runtimeconfig>配置 runtimeConfig</a></li><li><a href=#客戶端使用-runtimeconfig>客戶端使用 runtimeConfig</a></li><li><a href=#使用-env-建立環境變數>使用 .env 建立環境變數</a></li><li><a href=#環境變數的覆蓋>環境變數的覆蓋</a></li></ol></li><li><a href=#app-config>App Config</a><ol><li><a href=#配置-appconfig>配置 appConfig</a></li><li><a href=#appconfig-檔案>app.config 檔案</a></li><li><a href=#具有響應式的設定>具有響應式的設定</a></li></ol></li><li><a href=#小結-1>小結</a></li></ol></li><li><a href=#實作練習>實作練習</a><ol><li><a href=#串接-google-oauth-登入>串接 Google OAuth 登入</a><ol><li></li></ol></li><li><a href=#one-tap-prompt>One Tap prompt</a></li><li><a href=#自訂按鈕>自訂按鈕</a></li><li><a href=#使用-googletokenlogin>使用 googleTokenLogin()</a></li><li><a href=#使用-googleauthcodelogin>使用 googleAuthCodeLogin()</a></li><li><a href=#伺服器端驗證>伺服器端驗證</a><ol><li><a href=#驗證-access-token>驗證 Access Token</a></li><li><a href=#驗證-credential>驗證 Credential</a></li><li><a href=#驗證-auth-code>驗證 Auth Code</a></li></ol></li></ol></li><li><a href=#cookie-的設置與-jwt-的搭配>Cookie 的設置與 JWT 的搭配</a><ol><li><a href=#nuxt-3-cookie-的設置方式>Nuxt 3 Cookie 的設置方式</a><ol><li><a href=#usecookie>useCookie</a></li></ol></li><li><a href=#伺服器端使用-getcookie-與-setcookie>伺服器端使用 getCookie 與 setCookie</a><ol><li></li></ol></li><li><a href=#使用-cookie-做使用者驗證>使用 Cookie 做使用者驗證</a><ol><li></li></ol></li><li><a href=#cookielocalstoragetoken-與-jwt>Cookie、LocalStorage、Token 與 JWT</a><ol><li><a href=#cookie>Cookie</a></li><li><a href=#localstorage>LocalStorage</a></li><li><a href=#token>Token</a></li><li><a href=#jwtjson-web-token>JWT(JSON Web Token)</a></li><li><a href=#token-或-jwt-選哪一個>Token 或 JWT 選哪一個？</a></li><li><a href=#token-要放在-cookie-還是-localstorage>Token 要放在 Cookie 還是 LocalStorage？</a></li></ol></li></ol></li><li><a href=#搜尋引擎最佳化-seo-與-html-meta-tag>搜尋引擎最佳化 (SEO) 與 HTML Meta Tag</a><ol><li><a href=#搜尋引擎最佳化-seo---網站的標題-title-與描述-description>搜尋引擎最佳化 (SEO) - 網站的標題 (Title) 與描述 (Description)</a></li><li><a href=#網站的-open-graph-og>網站的 Open Graph (OG)</a></li><li><a href=#usehead>useHead</a><ol><li><a href=#自訂-metadata>自訂 Metadata</a></li><li><a href=#添加動態網頁的標題>添加動態網頁的標題</a></li><li><a href=#添加外部-css>添加外部 CSS</a></li><li><a href=#添加第三方的-javascript>添加第三方的 JavaScript</a></li><li><a href=#在模板中使用相對應的元件設置屬性及標籤>在模板中使用相對應的元件設置屬性及標籤</a></li></ol></li><li><a href=#definepagemeta>definePageMeta()</a><ol><li></li></ol></li></ol></li><li><a href=#public-與-assets-資源目錄nuxt-3-的靜態資源>Public 與 Assets 資源目錄(Nuxt 3 的靜態資源)</a><ol><li><a href=#public-目錄>public 目錄</a><ol><li></li></ol></li><li><a href=#assets-目錄-1>assets 目錄</a><ol><li></li></ol></li></ol></li><li><a href=#發布網站前的建構打包-build-與靜態網站生成-static-site-generation>發布網站前的建構打包 (Build) 與靜態網站生成 (Static Site Generation)</a><ol><li><a href=#nuxt-3-專案如何建構正式環境版本>Nuxt 3 專案如何建構正式環境版本？</a></li><li><a href=#使用預設配置進行建構---建構通用渲染-universal-rendering-的網站>使用預設配置進行建構 - 建構通用渲染 (Universal Rendering) 的網站</a></li><li><a href=#使用預渲染建置全靜態頁面網站>使用預渲染建置全靜態頁面網站</a></li><li><a href=#手動設定預渲染的路由規則>手動設定預渲染的路由規則</a><ol><li></li><li><a href=#build>build</a></li><li><a href=#generate>generate</a></li></ol></li><li><a href=#建構僅在客戶端渲染的網站>建構僅在客戶端渲染的網站</a></li><li><a href=#整理這些排列建構參數的組合>整理這些排列建構參數的組合</a><ol><li><a href=#npm-run-build--ssr-true>npm run build + ssr: true</a></li><li><a href=#npm-run-build--ssr-false>npm run build + ssr: false</a></li><li><a href=#npm-run-generate--ssr-true>npm run generate + ssr: true</a></li></ol></li></ol></li><li><a href=#就剩最後一步了---部署-deployment>就剩最後一步了 - 部署 (Deployment)</a><ol><li><a href=#使用-nodejs-伺服器>使用 Node.js 伺服器</a></li><li><a href=#使用-pm2>使用 PM2</a><ol><li></li></ol></li><li><a href=#製作-docker-image>製作 Docker Image</a><ol><li></li></ol></li><li><a href=#部署至-cloudflare-workers>部署至 CloudFlare Workers</a><ol><li></li></ol></li><li><a href=#靜態的網站部署至-cloudflare-pages>靜態的網站部署至 CloudFlare Pages</a></li></ol></li><li><a href=#上線前的測試項目>上線前的測試項目</a><ol><li><a href=#前端細節>前端細節</a></li><li><a href=#瀏覽器相容性測試>瀏覽器相容性測試</a></li><li><a href=#api-測試>API 測試</a></li><li><a href=#壓力測試>壓力測試</a></li><li><a href=#api-或網站安全性>API 或網站安全性</a></li><li><a href=#開發或除錯用的訊息>開發或除錯用的訊息</a></li><li><a href=#網站相依性檢查>網站相依性檢查</a></li><li><a href=#部署相關>部署相關</a></li><li><a href=#備份機制>備份機制</a></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://wayneblog.ga/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script>"serviceWorker"in navigator&&(console.log("Check service worker register?"),navigator.serviceWorker.register("./service-worker.js").then(function(){console.log("service worker registed.")}).catch(function(e){console.log("service worker registed fail. This happened: ",e)}))</script><div id=fb-root></div><div id=fb-customer-chat class=fb-customerchat></div><script>var chatbox=document.getElementById("fb-customer-chat");chatbox.setAttribute("page_id","100278986238046"),chatbox.setAttribute("attribution","biz_inbox")</script><script>window.fbAsyncInit=function(){FB.init({xfbml:!0,version:"v15.0"})},function(e,t,n){var s,o=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;s=e.createElement(t),s.id=n,s.src="https://connect.facebook.net/zh_TW/sdk/xfbml.customerchat.js",o.parentNode.insertBefore(s,o)}(document,"script","facebook-jssdk")</script></body></html>